/*!
 * mapcan v0.40.2
 * LICENSE : BSD-3-Clause
 * (c) 2016-2018 mapcan.com.cn
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.mapcan=t.mapcan||{})}(this,function(t){"use strict";var d="_mapcan__internal_layer_",e=["MultiPoint","MultiLineString","MultiPolygon","GeometryCollection"],a=["FeatureCollection","Feature","Point","LineString","Polygon"].concat(e),f=["markerFile","polygonPatternFile","linePatternFile","markerFillPatternFile","markerLinePatternFile"],g=[["markerWidth","markerHeight"],[],[null,"lineWidth"],[],[null,"markerLineWidth"]],n={lineWidth:1,lineOpacity:1,lineDx:1,lineDy:1,polygonOpacity:1,markerWidth:1,markerHeight:1,markerDx:1,markerDy:1,markerOpacity:1,markerFillOpacity:1,markerLineWidth:1,markerLineOpacity:1,textSize:1,textOpacity:1,textHaloRadius:1,textWrapWidth:1,textLineSpacing:1,textDx:1,textDy:1},i=["lineColor","polygonFill","markerFill","markerLineColor","textFill"];var p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},u=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},m=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):function(t,e){for(var i=Object.getOwnPropertyNames(e),n=0;n<i.length;n++){var r=i[n],o=Object.getOwnPropertyDescriptor(e,r);o&&o.configurable&&void 0===t[r]&&Object.defineProperty(t,r,o)}}(t,e))},v=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e};function y(){return Date.now()}function _(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)t[n]=i[n]}return t}function Y(t){return null==t}function w(t){return"number"==typeof t&&!isNaN(t)}function r(t){return(0|t)===t}function x(t){return"object"===(void 0===t?"undefined":p(t))&&!!t}function S(t){return!Y(t)&&("string"==typeof t||null!==t.constructor&&t.constructor===String)}function b(t){return!Y(t)&&("function"==typeof t||null!==t.constructor&&t.constructor===Function)}var o=Object.prototype.hasOwnProperty;function M(t,e){return o.call(t,e)}var s=Math.PI/180;function T(t){return t*s}function l(t){return t/s}var C="[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0)&&!process.versions.electron&&!process.versions.nw&&!process.versions["node-webkit"],h=void 0,c=void 0;function A(t){var e="data:image/svg+xml";return 4<t.length&&".svg"===t.slice(-4)?1:t.slice(0,e.length)===e?2:0}function E(t,e){C&&E.node?E.node(t,e):t.src=e[0]}!function(){if(C)return h=function(t){return setTimeout(t,16)},c=clearTimeout;var e=void 0,i=void 0;function t(t){return setTimeout(t,1e3/30)}function n(t){return window["webkit"+t]||window["moz"+t]||window["ms"+t]}"undefined"!=typeof window?(e=window.requestAnimationFrame||n("RequestAnimationFrame")||t,i=window.cancelAnimationFrame||n("CancelAnimationFrame")||n("CancelRequestAnimationFrame")||function(t){window.clearTimeout(t)}):(e=t,i=clearTimeout),h=function(t){return e(t)},c=function(t){t&&i(t)}}();var P=0;function L(){return P++}var I=L;function R(t){return t&&S(t)?JSON.parse(t):t}function D(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];if(i)for(var n=0,r=i.length;n<r;n++)t.push(i[n])}return t.length}function O(t,e){var i=e.indexOf(t);-1<i&&e.splice(i,1)}function k(t,e,i){if(!Array.isArray(t))return i?e.call(i,t):e(t);for(var n=[],r=void 0,o=void 0,a=0,s=t.length;a<s;a++)Y(r=t[a])?n.push(null):Array.isArray(r)?n.push(k(r,e,i)):(o=i?e.call(i,r):e(r),n.push(o));return n}function z(t,e){return void 0===t?e:t}function N(t){return Math.sign?Math.sign(t):0===(t=+t)||isNaN(t)?Number(t):0<t?1:-1}function B(t){if(Math.log2)return Math.log2(t);var e=Math.log(t)*Math.LOG2E,i=Math.round(e);return Math.abs(i-e)<1e-14?i:e}function F(t,e,i){return t*(1-i)+e*i}function G(t,e,i){if(t===i||t===e)return t;var n=i-e;return((t-e)%n+n)%n+e}function V(t,e,i){return Math.min(i,Math.max(e,t))}function H(t){return Array.isArray(t)&&0<t.length}function U(t){if(!t)return!1;var e=t.slice(0,6);return"http:/"===e||"https:"===e||"file:/"===e}var W=/^url\((['"])(.+)\1\)$/i,j=/^url\(([^'"].*[^'"])\)$/i;function Z(t){if(!S(t))return 0;var e=t.slice(0,6);return"http:/"===e||"https:"===e?3:j.test(t)?1:W.test(t)?2:0}function X(t){var e=Z(t);return 3===e?t:1===e?j.exec(t)[1]:2===e?W.exec(t)[2]:t}var q="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function J(t){if("undefined"!=typeof window&&window.btoa)return window.btoa(t);for(var e,i,n=String(t),r="",o=0,a=q;n.charAt(0|o)||(a="=",o%1);r+=a.charAt(63&e>>8-o%1*8)){if(255<(i=n.charCodeAt(o+=.75)))throw new Error("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");e=e<<8|i}return r}function K(t,e){for(var i=atob(t),n=new ArrayBuffer(i.length),r=new Uint8Array(n),o=0;o<i.length;o++)r[o]=255&i.charCodeAt(o);return new Blob([n],{type:e})}function Q(t,e,i,n){var r=i-t,o=n-e;return Math.atan2(o,r)}var $="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7";function tt(t,e){if(!t&&!e)return!0;if(!t||!e)return!1;for(var i in t)if("center"===i){if(!e[i]||!et(t[i][0],e[i][0])||!et(t[i][1],e[i][1]))return!1}else if(t[i]!==e[i])return!1;return!0}function et(t,e,i){return null==i&&(i=1e-6),e-i<=t&&t<=e+i}function it(e,i,n,r){e||(e=100),i||(i=4);var o=this;return i*=2,this._flashTimeout&&clearTimeout(this._flashTimeout),this._flashTimeout=setTimeout(function t(){if(0===i)return o.show(),void(n&&(r?n.call(r):n()));i%2==0?o.hide():o.show(),i--,o._flashTimeout=setTimeout(t,e)},e),this}var nt=["Unknown","Point","LineString","Polygon","MultiPoint","MultiLineString","MultiPolygon","GeometryCollection"];function rt(t){return new Function("f","var p = (f && f.properties || {}); return "+ot(t))}function ot(t){if(!t)return"true";var e=t[0];return t.length<=1?"any"===e?"false":"true":"("+("=="===e?st(t[1],t[2],"===",!1):"!="===e?st(t[1],t[2],"!==",!1):"<"===e||">"===e||"<="===e||">="===e?st(t[1],t[2],e,!0):"any"===e?lt(t.slice(1),"||"):"all"===e?lt(t.slice(1),"&&"):"none"===e?ut(lt(t.slice(1),"||")):"in"===e?ht(t[1],t.slice(2)):"!in"===e?ut(ht(t[1],t.slice(2))):"has"===e?ct(t[1]):"!has"===e?ut(ct(t[1])):"true")+")"}function at(t){return"$"===t[0]?"f."+t.substring(1):"p["+JSON.stringify(t)+"]"}function st(t,e,i,n){var r=at(t),o="$type"===t?nt.indexOf(e):JSON.stringify(e);return(n?"typeof "+r+"=== typeof "+o+"&&":"")+r+i+o}function lt(t,e){return t.map(ot).join(e)}function ht(t,e){"$type"===t&&(e=e.map(function(t){return nt.indexOf(t)}));var i=JSON.stringify(e.sort(dt)),n=at(t);return e.length<=200?i+".indexOf("+n+") !== -1":"function(v, a, i, j) {while (i <= j) { var m = (i + j) >> 1;    if (a[m] === v) return true; if (a[m] > v) j = m - 1; else i = m + 1;}return false; }("+n+", "+i+",0,"+(e.length-1)+")"}function ct(t){return"$id"===t?'"id" in f':JSON.stringify(t)+" in p"}function ut(t){return"!("+t+")"}function dt(t,e){return t<e?-1:e<t?1:0}function pt(t){var e=t._toJSON(),i=e.feature;return i.type=nt.indexOf(i.geometry.type),i.subType=e.subType,i}function ft(t){if(!Array.isArray(t))return ft([t]);for(var e=[],i=0;i<t.length;i++){var n=void 0;n=!0===t[i].filter?function(){return!0}:rt(t[i].filter),e.push(_({},t[i],{filter:n}))}return e}function gt(i,t){var e;if(wt(i)){var n,r=i.stops&&"object"===p(i.stops[0][0]),o=r||void 0!==i.property,a=r||!o,s=i.type||t||"exponential";if("exponential"===s)n=yt;else if("interval"===s)n=vt;else if("categorical"===s)n=mt;else{if("identity"!==s)throw new Error('Unknown function type "'+s+'"');n=_t}if(r){for(var l={},h=[],c=0;c<i.stops.length;c++){var u=i.stops[c];void 0===l[u[0].zoom]&&(l[u[0].zoom]={zoom:u[0].zoom,type:i.type,property:i.property,stops:[]}),l[u[0].zoom].stops.push([u[0].value,u[1]])}for(var d in l)h.push([l[d].zoom,gt(l[d])]);(e=function(t,e){return yt({stops:h,base:i.base},t)(t,e)}).isFeatureConstant=!1,e.isZoomConstant=!1}else a?((e=function(t){return n(i,t)}).isFeatureConstant=!0,e.isZoomConstant=!1):((e=function(t,e){return n(i,e[i.property])}).isFeatureConstant=!1,e.isZoomConstant=!0)}else(e=function(){return i}).isFeatureConstant=!0,e.isZoomConstant=!0;return e}function mt(t,e){for(var i=0;i<t.stops.length;i++)if(e===t.stops[i][0])return t.stops[i][1];return t.stops[0][1]}function vt(t,e){for(var i=0;i<t.stops.length&&!(e<t.stops[i][0]);i++);return t.stops[Math.max(i-1,0)][1]}function yt(t,e){for(var i=void 0!==t.base?t.base:1,n=0;!(n>=t.stops.length||e<=t.stops[n][0]);)n++;return 0===n?t.stops[n][1]:n===t.stops.length?t.stops[n-1][1]:function i(n,r,o,a,s,l){return"function"==typeof s?function(){var t=s.apply(void 0,arguments),e=l.apply(void 0,arguments);return i(n,r,o,a,t,e)}:s.length?function(t,e,i,n,r,o){for(var a=[],s=0;s<r.length;s++)a[s]=xt(t,e,i,n,r[s],o[s]);return a}(n,r,o,a,s,l):xt(n,r,o,a,s,l)}(e,i,t.stops[n-1][0],t.stops[n][0],t.stops[n-1][1],t.stops[n][1])}function _t(t,e){return e}function xt(t,e,i,n,r,o){var a,s=n-i,l=t-i;return r*(1-(a=1===e?l/s:(Math.pow(e,l)-1)/(Math.pow(e,s)-1)))+o*a}function wt(t){return t&&"object"===(void 0===t?"undefined":p(t))&&(t.stops||t.property&&"identity"===t.type)}function bt(t){for(var e in t)if(wt(t[e]))return!0;return!1}function Mt(t){return gt(t,"exponential")}function St(t,i){if(!t)return null;var e=!1;if(Array.isArray(t)){for(var n,r=[],o=0;o<t.length;o++)(n=St(t[o],i))?(r.push(n),e=!0):r.push(t[o]);return e?r:t}var a,s={__fn_types_loaded:!0},l=[];for(a in t)t.hasOwnProperty(a)&&l.push(a);for(var h=0,c=l.length;h<c;h++)wt(t[a=l[h]])?(e=!0,s["_"+a]=t[a],function(e){Object.defineProperty(s,e,{get:function(){return this["__fn_"+e]||(this["__fn_"+e]=Mt(this["_"+e])),this["__fn_"+e].apply(this,i())},set:function(t){this["_"+e]=t},configurable:!0,enumerable:!0})}(a)):s[a]=t[a];return e?s:t}function Tt(t){if(!t||!t.stops)return[];for(var e=[],i=0,n=t.stops.length;i<n;i++)e.push(t.stops[i][1]);return e}var Ct=Object.freeze({createFilter:rt,getFilterFeature:pt,compileStyle:ft,isFunctionDefinition:wt,hasFunctionDefinition:bt,interpolated:Mt,piecewiseConstant:function(t){return gt(t,"interval")},loadFunctionTypes:St,getFunctionTypeResources:Tt});function At(t){var e={stroke:{stroke:t.markerLineColor,"stroke-width":t.markerLineWidth,"stroke-opacity":t.markerLineOpacity,"stroke-dasharray":null,"stroke-linecap":"butt","stroke-linejoin":"round"},fill:{fill:t.markerFill,"fill-opacity":t.markerFillOpacity}};return"butt"===e.stroke["stroke-linecap"]&&ae.vml&&(e.stroke["stroke-linecap"]="flat"),0===e.stroke["stroke-width"]&&(e.stroke["stroke-opacity"]=0),e}function Et(t,e,i){if(!t.markerPath)return null;var n=1,r=At(t);w(t.markerOpacity)&&(n=t.markerOpacity),w(t.opacity)&&(n*=t.opacity);var o={};if(r){for(var a in r.stroke)r.stroke.hasOwnProperty(a)&&(Y(r.stroke[a])||(o[a]=r.stroke[a]));for(var s in r.fill)r.fill.hasOwnProperty(s)&&(Y(r.fill[s])||(o[s]=r.fill[s]))}for(var l=Array.isArray(t.markerPath)?t.markerPath:[t.markerPath],h=void 0,c=[],u=0;u<l.length;u++)(h=_({},h=S(l[u])?{path:l[u]}:l[u],o)).d=h.path,delete h.path,c.push(h);var d=['<svg version="1.1"','xmlns="http://www.w3.org/2000/svg"'];n<1&&d.push('opacity="'+n+'"'),t.markerPathWidth&&t.markerPathHeight&&d.push('viewBox="0 0 '+t.markerPathWidth+" "+t.markerPathHeight+'"'),d.push('preserveAspectRatio="none"'),e&&d.push('width="'+e+'"'),i&&d.push('height="'+i+'"'),d.push("><defs></defs>");for(var p=0;p<c.length;p++){var f="<path ";for(var g in c[p])c[p].hasOwnProperty(g)&&(f+=" "+g+'="'+c[p][g]+'"');f+="></path>",d.push(f)}return d.push("</svg>"),"data:image/svg+xml;base64,"+J(d.join(" "))}function Pt(t,e){if(!t)return[];var i=t;Array.isArray(t)||(i=[t]);for(var n=[],r=f,o=void 0,a=void 0,s=void 0,l=void 0,h=i.length-1;0<=h;h--)if(t=i[h]){e&&(t=Lt(t));for(var c=0;c<r.length;c++)if(wt(o=t[r[c]])&&(o=Tt(o)),o){Array.isArray(o)||(o=[o]);for(var u=0;u<o.length;u++)"url("===o[u].slice(0,4)&&(o[u]=X(o[u])),a=g[c],n.push([o[u],t[a[0]],t[a[1]]])}if("path"===t.markerType&&t.markerPath)if(s=wt(t.markerWidth)?200:t.markerWidth,l=wt(t.markerHeight)?200:t.markerHeight,wt(t.markerPath)){o=Tt(t.markerPath);for(var d=t.markerPath,p=0;p<o.length;p++)t.markerPath=o[p],n.push([Et(t),s,l]);t.markerPath=d}else n.push([Et(t),s,l])}return n}function Lt(t){if(!t)return null;var e=t;if(C)return e;for(var i=f,n=void 0,r=0,o=i.length;r<o;r++)(n=e[i[r]])&&(e[i[r]]=It(n));return e}function It(t){if(wt(t)){for(var e=t.stops,i=0;i<e.length;i++)e[i][1]=It(e[i][1]);return t}return"url("===t.slice(0,4)&&(t=X(t)),!U(t)&&(t.length<="data:".length||"data:"!==t.substring(0,"data:".length))&&(t=function(t,e){var i=t.split("/"),n=e.split("/");{if(0===e.slice(0,1))return i.slice(0,3).join("/")+e;i.pop();for(var r=0;r<n.length;r++)"."!==n[r]&&(".."===n[r]?i.pop():i.push(n[r]));return i.join("/")}}(location.href,t)),t}function Rt(t){return t&&t.colorStops}function Dt(t){var e=[t.type];if(t.places&&e.push(t.places.join()),t.colorStops){for(var i=[],n=t.colorStops.length-1;0<=n;n--)i.push(t.colorStops[n].join());e.push(i.join(","))}return e.join("_")}function Ot(t){var e=[];if(Array.isArray(t)){for(var i=0;i<t.length;i++)e.push(Ot(t[i]));return"[ "+e.join(" , ")+" ]"}for(var n in t)M(t,n)&&(b(t[n])||(Rt(t[n])?e.push(n+"="+Dt(t[n])):e.push(n+"="+t[n])));return e.join(";")}function kt(t,e){function i(t,e){Y(t.opacity)?t.opacity=e:t.opacity*=e}var n=void 0;if(Array.isArray(t)){n=[];for(var r=0;r<t.length;r++){var o=_({},t[r]);i(o,e),n.push(o)}}else i(n=_({},t),e);return n}function zt(t){var e=Array.prototype.slice.call(arguments,1);if(e&&e.length||(e=[{}]),Array.isArray(t)){for(var i=void 0,n=void 0,r=[],o=0,a=t.length;o<a;o++){i=t[o],n={};for(var s=0,l=e.length;s<l;s++)Array.isArray(e[s])?Y(e[s][o])?_(n,i||{}):_(n,i,e[s][o]):_(n,i,e[s]?e[s]:{});r.push(n)}return r}var h=[{},t];return h.push.apply(h,e),_.apply(this,h)}var Nt=Object.freeze({now:y,extend:_,isNil:Y,isNumber:w,isInteger:r,isObject:x,isString:S,isFunction:b,hasOwn:M,join:function(t,e){return t.join?t.join(e||","):Array.prototype.join.call(t,e||",")},toRadian:T,toDegree:l,IS_NODE:C,get requestAnimFrame(){return h},get cancelAnimFrame(){return c},isSVG:A,loadImage:E,UID:L,GUID:I,parseJSON:R,pushIn:D,removeFromArray:O,forEachCoord:k,getValueOrDefault:z,sign:N,log2:B,interpolate:F,wrap:G,clamp:V,isArrayHasData:H,isURL:U,isCssUrl:Z,extractCssUrl:X,btoa:J,b64toBlob:K,computeDegree:Q,emptyImageUrl:$,equalMapView:tt,flash:it,translateToSVGStyles:At,getMarkerPathBase64:Et,getExternalResources:Pt,convertResourceUrl:Lt,isGradient:Rt,getGradientStamp:Dt,getSymbolStamp:Ot,lowerSymbolOpacity:kt,extendSymbol:zt}),Bt={};if(!C){var Ft=navigator.userAgent.toLowerCase(),Gt=document.documentElement,Vt="ActiveXObject"in window,Ht=-1!==Ft.indexOf("webkit"),Ut=-1!==Ft.indexOf("phantom"),Wt=-1!==Ft.search("android [23]"),jt=-1!==Ft.indexOf("chrome"),Zt=-1!==Ft.indexOf("gecko")&&!Ht&&!window.opera&&!Vt,Xt="undefined"!=typeof orientation||-1!==Ft.indexOf("mobile"),qt=!window.PointerEvent&&window.MSPointerEvent,Yt=window.PointerEvent&&navigator.pointerEnabled||qt,Jt=Vt&&"transition"in Gt.style,Kt="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!Wt,Qt="MozPerspective"in Gt.style,$t="OTransition"in Gt.style,te=(Jt||Kt||Qt)&&!$t&&!Ut,ee=0;jt&&(ee=Ft.match(/chrome\/([\d.]+)/)[1]);var ie=!Ut&&(Yt||"ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch),ne=void 0;try{var re=document.createElement("canvas"),oe=re.getContext("webgl")||re.getContext("experimental-webgl");ne=oe&&oe instanceof WebGLRenderingContext}catch(t){ne=!1}Bt={ie:Vt,ielt9:Vt&&!document.addEventListener,edge:"msLaunchUri"in navigator&&!("documentMode"in document),webkit:Ht,gecko:Zt,android:-1!==Ft.indexOf("android"),android23:Wt,chrome:jt,chromeVersion:ee,safari:!jt&&-1!==Ft.indexOf("safari"),phantomjs:Ut,ie3d:Jt,webkit3d:Kt,gecko3d:Qt,opera12:$t,any3d:te,mobile:Xt,mobileWebkit:Xt&&Ht,mobileWebkit3d:Xt&&Kt,mobileOpera:Xt&&window.opera,mobileGecko:Xt&&Zt,touch:!!ie,msPointer:!!qt,pointer:!!Yt,retina:1<(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI),language:navigator.browserLanguage?navigator.browserLanguage:navigator.language,ie9:Vt&&9===document.documentMode,ie10:Vt&&10===document.documentMode,webgl:ne}}var ae=Bt,se=function(){function i(t,e){if(u(this,i),Y(t)||Y(e)?Y(t.x)||Y(t.y)?Array.isArray(t)&&(this.x=+t[0],this.y=+t[1]):(this.x=+t.x,this.y=+t.y):(this.x=+t,this.y=+e),this._isNaN())throw new Error("Position is NaN")}return i.prototype.abs=function(){return new this.constructor(Math.abs(this.x),Math.abs(this.y))},i.prototype._abs=function(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this},i.prototype._round=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},i.prototype.round=function(){return new this.constructor(Math.round(this.x),Math.round(this.y))},i.prototype._ceil=function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},i.prototype.ceil=function(){return new this.constructor(Math.ceil(this.x),Math.ceil(this.y))},i.prototype._floor=function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},i.prototype.floor=function(){return new this.constructor(Math.floor(this.x),Math.floor(this.y))},i.prototype.copy=function(){return new this.constructor(this.x,this.y)},i.prototype._add=function(t,e){return Y(t.x)?Y(t[0])?(this.x+=t,this.y+=e):(this.x+=t[0],this.y+=t[1]):(this.x+=t.x,this.y+=t.y),this},i.prototype.add=function(t,e){var i=void 0,n=void 0;return Y(t.x)?Y(t[0])?(i=this.x+t,n=this.y+e):(i=this.x+t[0],n=this.y+t[1]):(i=this.x+t.x,n=this.y+t.y),new this.constructor(i,n)},i.prototype._sub=function(t,e){return Y(t.x)?Y(t[0])?(this.x-=t,this.y-=e):(this.x-=t[0],this.y-=t[1]):(this.x-=t.x,this.y-=t.y),this},i.prototype._substract=function(){return this._sub.apply(this,arguments)},i.prototype.sub=function(t,e){var i=void 0,n=void 0;return Y(t.x)?Y(t[0])?(i=this.x-t,n=this.y-e):(i=this.x-t[0],n=this.y-t[1]):(i=this.x-t.x,n=this.y-t.y),new this.constructor(i,n)},i.prototype.substract=function(){return this.sub.apply(this,arguments)},i.prototype.multi=function(t){return new this.constructor(this.x*t,this.y*t)},i.prototype._multi=function(t){return this.x*=t,this.y*=t,this},i.prototype.div=function(t){return this.multi(1/t)},i.prototype._div=function(t){return this._multi(1/t)},i.prototype.equals=function(t){return t instanceof this.constructor&&(this.x===t.x&&this.y===t.y)},i.prototype._isNaN=function(){return isNaN(this.x)||isNaN(this.y)},i.prototype.isZero=function(){return 0===this.x&&0===this.y},i.prototype.toArray=function(){return[this.x,this.y]},i.prototype.toFixed=function(t){return new this.constructor(this.x.toFixed(t),this.y.toFixed(t))},i.prototype.toJSON=function(){return{x:this.x,y:this.y}},i}(),le=function(t){function e(){return u(this,e),v(this,t.apply(this,arguments))}return m(e,t),e.prototype.closeTo=function(t,e){return e||(e=0),this.x>=t.x-e&&this.x<=t.x+e&&this.y>=t.y-e&&this.y<=t.y+e},e.prototype.distanceTo=function(t){var e=t.x-this.x,i=t.y-this.y;return Math.sqrt(e*e+i*i)},e.prototype.mag=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},e.prototype.unit=function(){return this.copy()._unit()},e.prototype._unit=function(){return this._div(this.mag()),this},e.prototype.perp=function(){return this.copy()._perp()},e.prototype._perp=function(){var t=this.y;return this.y=this.x,this.x=-t,this},e.prototype.angleWith=function(t){return this.angleWithSep(t.x,t.y)},e.prototype.angleWithSep=function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},e.prototype._rotate=function(t){var e=Math.cos(t),i=Math.sin(t),n=e*this.x-i*this.y,r=i*this.x+e*this.y;return this.x=n,this.y=r,this},e.prototype.rotate=function(t){return this.copy()._rotate(t)},e}(se),he=function(){function r(t,e){u(this,r),w(t)&&w(e)?(this.width=t,this.height=e):w(t.width)?(this.width=t.width,this.height=t.height):Array.isArray(t)&&(this.width=t[0],this.height=t[1])}return r.prototype.copy=function(){return new r(this.width,this.height)},r.prototype.add=function(t,e){var i=void 0,n=void 0;return t instanceof r?(i=this.width+t.width,n=this.height+t.height):(i=this.width+t,n=this.height+e),new r(i,n)},r.prototype.equals=function(t){return this.width===t.width&&this.height===t.height},r.prototype.multi=function(t){return new r(this.width*t,this.height*t)},r.prototype._multi=function(t){return this.width*=t,this.height*=t,this},r.prototype._round=function(){return this.width=Math.round(this.width),this.height=Math.round(this.height),this},r.prototype.toPoint=function(){return new le(this.width,this.height)},r.prototype.toArray=function(){return[this.width,this.height]},r.prototype.toJSON=function(){return{width:this.width,height:this.height}},r}();function ce(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}var ue=/[\b\t\r\v\f]/gim;function de(t){return S(t)?t.replace(ue,""):t}function pe(t){return ce(t).split(/\s+/)}var fe="undefined"!=typeof document?document.createElement("canvas").getContext("2d"):null;function ge(t,e){return ge.node?ge.node(t,e):(fe.font=e,fe.measureText(t).width)}var me={};function ve(t,e){if(ve.node)return ve.node(t,e);var i=ge(t,e);return e||(e="_default_"),me[e]||(me[e]=ye(e)),new he(i,me[e])}function ye(t){var e=Ke();"_default_"!==t&&(e.style.font=t),e.innerHTML="\u79e6";var i=e.clientHeight;return De(e),i}function _e(t,e,i,n){if(!t||0===t.length)return[{text:"",width:0}];var r=Y(n)?ge(t,e):n,o=r/t.length,a=Math.floor(i/o/2);if(i<=o||a<=0)return[{text:"",width:i}];if(r<=i)return[{text:t,width:r}];for(var s=[],l=t.substring(0,a),h=o*a,c=a,u=t.length;c<u;c++){var d=t[c],p=ge(l+d);i<=p?(s.push({text:l,width:h}),l=t.substring(c,a+c),c+=a-1,h=o*a):(l+=d,h=p),u-1<=c&&(h=ge(l),s.push({text:l,width:h}))}return s}var xe=/\{([\w_]+)\}/g;function we(t,n){return S(t)?t.replace(xe,function(t,e){if(!n)return"";var i=n[e];return Y(i)?"":Array.isArray(i)?i.join():i}):t}function be(t,e,i){var n=t.width,r=t.height;return new le("left"===e?-n:"right"===e?0:-n/2,"top"===i?-r:"bottom"===i?0:-r/2)}function Me(t){return t.textFont?t.textFont:(t.textStyle&&"normal"!==t.textStyle?t.textStyle+" ":"")+(t.textWeight&&"normal"!==t.textWeight?t.textWeight+" ":"")+t.textSize+"px "+('"'===t.textFaceName[0]?t.textFaceName:'"'+t.textFaceName+'"')}function Se(t,e){var i=Me(e),n=e.textLineSpacing||0,r=ve(t,i),o=r.width,a=r.height,s=e.textWrapCharacter,l=[],h=e.textWrapWidth;(!h||o<h)&&(h=o),S(t)||(t+="");var c=0;if(s&&0<=t.indexOf(s))for(var u=t.split(s),d=0,p=u.length;d<p;d++){var f=u[d],g=ge(f,i);if(h<g)for(var m=_e(f,i,h,g),v=0,y=m.length;v<y;v++){var _=m[v].width;c<_&&(c=_),l.push({text:m[v].text,size:new he(_,a)})}else c<g&&(c=g),l.push({text:f,size:new he(g,a)})}else if(h<o)for(var x=_e(t,i,h,o),w=0;w<x.length;w++){var b=x[w].width;c<b&&(c=b),l.push({text:x[w].text,size:new he(b,a)})}else c<o&&(c=o),l.push({text:t,size:r});var M=l.length;return{total:M,size:new he(c,a*M+n*(M-1)),rows:l,rawSize:r}}var Te=Object.freeze({trim:ce,escapeSpecialChars:de,splitWords:pe,stringWidth:ge,stringLength:ve,getFontHeight:ye,splitContent:_e,replaceVariable:we,getAlignPoint:be,getFont:Me,splitTextToRow:Se}),Ce=C?function(t){return t[0]}:function(t){for(var e=document.documentElement.style,i=0;i<t.length;i++)if(t[i]in e)return t[i];return!1},Ae=Ce(["transform","WebkitTransform","OTransform","MozTransform","msTransform"]),Ee=Ce(["transformOrigin","WebkitTransformOrigin","OTransformOrigin","MozTransformOrigin","msTransformOrigin"]),Pe=Ce(["transition","WebkitTransition","OTransition","MozTransition","msTransition"]),Le=Ce(["filter","WebkitFilter","OFilter","MozFilter","msFilter"]);function Ie(t,e){var i=document.createElement(t);return e&&Ze(i,e),i}function Re(t,e,i){var n=Ie(t);return e&&Ue(n,e),i&&i.appendChild(n),n}function De(t){if(!t)return this;if(ae.ielt9||ae.ie9){var e=Ie("div");e.appendChild(t),e.innerHTML="",e=null}else t.parentNode&&t.parentNode.removeChild(t);return this}function Oe(e,t,i,n){if(!(e&&e.addEventListener&&t&&i))return this;for(var r=function(t){t||(t=window.event),i.call(n||e,t)},o=t.split(" "),a=o.length-1;0<=a;a--){var s=o[a];if(s)e["Z__"+s]||(e["Z__"+s]=[]),0<=ze(e,s,i)&&ke(e,s,i),e["Z__"+s].push({callback:r,src:i}),"mousewheel"===s&&ae.gecko&&(s="DOMMouseScroll"),e.addEventListener(s,r,!1)}return this}function ke(i,t,e){function n(t,e){"mousewheel"===t&&ae.gecko&&(t="DOMMouseScroll"),i.removeEventListener(t,e,!1)}if(!i||!i.removeEventListener||!t)return this;for(var r=t.split(" "),o=r.length-1;0<=o;o--){var a=r[o];if(a){if(!e&&i["Z__"+a]){for(var s=i["Z__"+a],l=0,h=s.length;l<h;l++)n(s[l].callback);return delete i["Z__"+a],this}var c=ze(i,a,e);if(c<0)return this;n(a,i["Z__"+a][c].callback),i["Z__"+a].splice(c,1)}}return this}function ze(t,e,i){if(!t||!t["Z__"+e]||!i)return-1;for(var n=t["Z__"+e],r=0,o=n.length;r<o;r++)if(n[r].src===i)return r;return-1}function Ne(t){return t.preventDefault?t.preventDefault():t.returnValue=!1,this}function Be(t){return t.stopPropagation?t.stopPropagation():t.cancelBubble=!0,this}function Fe(t){return t.onselectstart=function(){return!1},t.ondragstart=function(){return!1},t.setAttribute("unselectable","on"),this}function Ge(t,e){return t?(ae.any3d?qe(t,e):(t.style.left=e.x+"px",t.style.top=e.y+"px"),e):null}function Ve(t){var e=window.getComputedStyle(t),i=[parseInt(e["padding-left"]),parseInt(e["padding-top"])],n=t.getBoundingClientRect(),r=t.offsetWidth,o=t.offsetHeight,a=r?n.width/r:1,s=o?n.height/o:1;return t.__position=[n.left+i[0],n.top+i[1],a,s],t.__position}function He(t,e){t||(t=window.event);var i=e.__position;return i||(i=Ve(e)),new le(t.clientX/i[2]-i[0]-e.clientLeft,t.clientY/i[3]-i[1]-e.clientTop)}function Ue(t,e){var i,n,r,o=t.style.cssText;return n=";",0<=(r=(i=o).length-n.length)&&i.indexOf(n,r)===r||(o+=";"),t.style.cssText=o+e,this}function We(t,e){if(void 0!==t.classList)return t.classList.contains(e);var i=Xe(t);return 0<i.length&&new RegExp("(^|\\s)"+e+"(\\s|$)").test(i)}function je(t,e){if(void 0===t.classList||We(t,e)){var i=Xe(t);Ze(t,(i?i+" ":"")+e)}else for(var n=pe(e),r=0,o=n.length;r<o;r++)t.classList.add(n[r]);return this}function Ze(t,e){return Y(t.className.baseVal)?t.className=e:t.className.baseVal=e,this}function Xe(t){return Y(t.className.baseVal)?t.className:t.className.baseVal}function qe(t,e){var i=e||new le(0,0);return t.style[Ae]=ae.any3d?"translate3d("+i.x+"px,"+i.y+"px,0px)":"translate("+i.x+"px,"+i.y+"px)",this}function Ye(t){return/<[a-z\][\s\S]*>/i.test(t)}function Je(t,e){var i=Ke(t);S(e)?i.innerHTML=e:i.appendChild(e);var n=new he(i.clientWidth,i.clientHeight);return De(i),n}function Ke(t){var e=document.createElement(t);return e.style.cssText="position:absolute;left:-10000px;top:-10000px;",document.body.appendChild(e),e}var Qe=Oe,$e=ke,ti=Object.freeze({TRANSFORM:Ae,TRANSFORMORIGIN:Ee,TRANSITION:Pe,CSSFILTER:Le,createEl:Ie,createElOn:Re,removeDomNode:De,addDomEvent:Oe,removeDomEvent:ke,listensDomEvent:ze,preventDefault:Ne,stopPropagation:Be,preventSelection:Fe,offsetDom:Ge,computeDomPosition:Ve,getEventContainerPoint:He,setStyle:Ue,hasClass:We,addClass:je,setClass:Ze,getClass:Xe,setOpacity:function(t,e){return t.style.opacity=e,this},setTransform:qe,setTransformMatrix:function(t,e){var i="matrix("+(S(e)?e:e.join())+")";return t.style[Ae]!==i&&(t.style[Ae]=i),this},removeTransform:function(t){return t.style[Ae]&&(t.style[Ae]=""),this},isHTML:Ye,measureDom:Je,getDomRuler:Ke,on:Qe,off:$e}),ei={jsonp:function(t,e){var i="_mapcan_jsonp_"+L();t.match(/\?/)?t+="&callback="+i:t+="?callback="+i;var n=document.createElement("script");return n.type="text/javascript",n.src=t,window[i]=function(t){e(null,t),document.getElementsByTagName("head")[0].removeChild(n),n=null,delete window[i]},document.getElementsByTagName("head")[0].appendChild(n),this},get:function(t,e,i){if(b(e)){var n=i;i=e,e=n}if(C&&ei.get.node)return ei.get.node(t,i,e);var r=ei._getClient(i);if(r.open("GET",t,!0),e){for(var o in e.headers)r.setRequestHeader(o,e.headers[o]);r.withCredentials="include"===e.credentials,e.responseType&&(r.responseType=e.responseType)}return r.send(null),r},post:function(t,e,i){var n=void 0;if(S(t)){if(b(e)){var r=i;i=e,e=r}n=(e=e||{}).postData}else{var o=i;n=e,t=(e=t).url,i=o}if(C&&ei.post.node)return e.url=t,ei.post.node(e,n,i);var a=ei._getClient(i);if(a.open("POST",e.url,!0),e.headers||(e.headers={}),e.headers["Content-Type"]||(e.headers["Content-Type"]="application/x-www-form-urlencoded"),"setRequestHeader"in a)for(var s in e.headers)e.headers.hasOwnProperty(s)&&a.setRequestHeader(s,e.headers[s]);return S(n)||(n=JSON.stringify(n)),a.send(n),a},_wrapCallback:function(t,e){return function(){4===t.readyState&&(200===t.status?"arraybuffer"===t.responseType?0===t.response.byteLength?e(new Error("http status 200 returned without content.")):e(null,{data:t.response,cacheControl:t.getResponseHeader("Cache-Control"),expires:t.getResponseHeader("Expires"),contentType:t.getResponseHeader("Content-Type")}):e(null,t.responseText):e(new Error(t.statusText+","+t.status)))}},_getClient:function(t){var e=void 0;try{e=new XMLHttpRequest}catch(t){try{e=new ActiveXObject("Msxml2.XMLHTTP")}catch(t){try{e=new ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}}return e.onreadystatechange=ei._wrapCallback(e,t),e},getArrayBuffer:function(t,e,i){if(b(e)){var n=i;i=e,e=n}return e||(e={}),e.responseType="arraybuffer",ei.get(t,e,i)},getImage:function(o,t,e){return ei.getArrayBuffer(t,e,function(t,e){if(t)o.onerror&&o.onerror(t);else if(e){var i=window.URL||window.webkitURL,n=o.onload;o.onload=function(){n&&n(),i.revokeObjectURL(o.src)};var r=new Blob([new Uint8Array(e.data)],{type:e.contentType});o.cacheControl=e.cacheControl,o.expires=e.expires,o.src=e.data.byteLength?i.createObjectURL(r):$}})},getJSON:function(t,e,n){if(b(e)){var i=n;n=e,e=i}var r=function(t,e){var i=e?R(e):null;n(t,i)};return e&&e.jsonp?ei.jsonp(t,r):ei.get(t,e,r)}},ii=!1,ni={setHitTesting:function(t){ii=t},createCanvas:function(t,e,i){var n=void 0;return C?n=new i(t,e):((n=Ie("canvas")).width=t,n.height=e),n},prepareCanvasFont:function(t,e){t.textBaseline="top",t.font=Me(e);var i=e.textFill;i||(i="#000"),t.fillStyle=ni.getRgba(i,e.textOpacity)},prepareCanvas:function(t,e,i,n){if(e){var r=e.lineWidth;Y(r)||t.lineWidth===r||(t.lineWidth=r);var o=e.linePatternFile||e.lineColor||"#000";if(n)t.strokeStyle="#000";else if(ai(o)&&i){var a=void 0;(e.linePatternDx||e.linePatternDy)&&(a=[e.linePatternDx,e.linePatternDy]),ni._setStrokePattern(t,o,r,a,i),e.lineDasharray=[]}else Rt(o)?e.lineGradientExtent?t.strokeStyle=ni._createGradient(t,o,e.lineGradientExtent):t.strokeStyle="#000":t.strokeStyle=o;e.lineJoin&&(t.lineJoin=e.lineJoin),e.lineCap&&(t.lineCap=e.lineCap),t.setLineDash&&H(e.lineDasharray)&&t.setLineDash(e.lineDasharray);var s=e.polygonPatternFile||e.polygonFill||"rgba(255,255,255,0)";if(n)t.fillStyle="#000";else if(ai(s)&&i){var l=si(s),h=i.getImage([l,null,null]);if(h||(h=i.getImage([l+"-texture",null,r])),A(l)&&h instanceof Image&&(ae.edge||ae.ie)){var c=h.width||20,u=h.height||20,d=ni.createCanvas(c,u);ni.image(d.getContext("2d"),h,0,0,c,u),h=d}h?(t.fillStyle=t.createPattern(h,"repeat"),(e.polygonPatternDx||e.polygonPatternDy)&&(t.fillStyle.polygonPatternOffset=[e.polygonPatternDx,e.polygonPatternDy])):"undefined"!=typeof console&&console.warn("img not found for",l)}else Rt(s)?e.polygonGradientExtent?t.fillStyle=ni._createGradient(t,s,e.polygonGradientExtent):t.fillStyle="rgba(255,255,255,0)":t.fillStyle=s}},_createGradient:function(t,e,i){var n=null,r=e.places,o=i.getMin(),a=i.getMax(),s=i.getWidth(),l=i.getHeight();if(e.type&&"linear"!==e.type){if("radial"===e.type){if(r){if(6!==r.length)throw new Error("A radial gradient's places should have 6 numbers.");r=[o.x+r[0]*s,o.y+r[1]*l,s*r[2],o.x+r[3]*s,o.y+r[4]*l,s*r[5]]}else{var h=i.getCenter()._round();r=[h.x,h.y,Math.abs(h.x-o.x),h.x,h.y,0]}n=t.createRadialGradient.apply(t,r)}}else{if(r){if(4!==r.length)throw new Error("A linear gradient's places should have 4 numbers.");r=[o.x+r[0]*s,o.y+r[1]*l,o.x+r[2]*s,o.y+r[3]*l]}else r=[o.x,o.y,a.x,o.y];n=t.createLinearGradient.apply(t,r)}return e.colorStops.forEach(function(t){n.addColorStop.apply(n,t)}),n},_setStrokePattern:function(t,e,i,n,r){var o=si(e),a=void 0;if(C)a=r.getImage([o,null,i]);else{var s=o+"-texture-"+i;if(!(a=r.getImage(s))){var l=r.getImage([o,null,null]);if(l){var h=void 0;h=l.width&&l.height?Math.round(l.width*i/l.height):i;var c=ni.createCanvas(h,i,t.canvas.constructor);ni.image(c.getContext("2d"),l,0,0,h,i),r.addResource([s,null,i],c),a=c}}}a?(t.strokeStyle=t.createPattern(a,"repeat"),t.strokeStyle.linePatternOffset=n):"undefined"!=typeof console&&console.warn("img not found for",o)},clearRect:function(t,e,i,n,r){t.canvas._drawn=!1,t.clearRect(e,i,n,r)},fillCanvas:function(t,e,i,n){if(ii&&(e=1),t.canvas._drawn=!0,0!==e){var r=ni._isPattern(t.fillStyle),o=t.fillStyle&&t.fillStyle.polygonPatternOffset,a=o?o[0]:0,s=o?o[1]:0;Y(e)&&(e=1);var l=void 0;e<1&&(l=t.globalAlpha,t.globalAlpha*=e),r&&(i=i||0,n=n||0,t.translate(i+a,n+s)),t.fill(),r&&t.translate(-i-a,-n-s),e<1&&(t.globalAlpha=l)}},getRgba:function(t,e){if(Y(e)&&(e=1),"#"!==t[0])return t;var i=void 0,n=void 0,r=void 0;return 7===t.length?(i=parseInt(t.substring(1,3),16),n=parseInt(t.substring(3,5),16),r=parseInt(t.substring(5,7),16)):(i=17*parseInt(t.substring(1,2),16),n=17*parseInt(t.substring(2,3),16),r=17*parseInt(t.substring(3,4),16)),"rgba("+i+","+n+","+r+","+e+")"},image:function(t,e,i,n,r,o){t.canvas._drawn=!0;try{w(r)&&w(o)?t.drawImage(e,i,n,r,o):t.drawImage(e,i,n)}catch(t){console&&(console.warn("error when drawing image on canvas:",t),console.warn(e))}},text:function(t,e,i,n,r){ni._textOnMultiRow(t,r.rows,n,i,r.size,r.rawSize)},_textOnMultiRow:function(t,e,i,n,r,o){for(var a=be(r,i.textHorizontalAlignment,i.textVerticalAlignment),s=o.height+i.textLineSpacing,l=n.add(0,a.y),h=i.textMaxHeight,c=void 0,u=void 0,d=0,p=0,f=e.length;p<f&&(c=e[p].text,u=be(e[p].size,i.textHorizontalAlignment,i.textVerticalAlignment),ni._textOnLine(t,c,l.add(u.x,p*s),i.textHaloRadius,i.textHaloFill,i.textHaloOpacity),!(0<h&&(d+=s)+o.height>=h));p++);},_textOnLine:function(t,e,i,n,r,o){ii&&(o=1);var a=0!==o&&0!==n;t.textBaseline="top";var s=void 0,l=void 0,h=t.shadowBlur,c=t.shadowOffsetX,u=t.shadowOffsetY;if(a){var d=t.globalAlpha;t.globalAlpha*=o,t.miterLimit=2,t.lineJoin="round",t.lineCap="round",t.lineWidth=2*n,t.strokeStyle=r,t.strokeText(e,Math.round(i.x),Math.round(i.y)),t.miterLimit=10,t.globalAlpha=d,s=t.globalCompositeOperation,t.globalCompositeOperation="destination-out",l=t.fillStyle,t.fillStyle="#000"}h&&a&&(t.shadowBlur=t.shadowOffsetX=t.shadowOffsetY=0),ni.fillText(t,e,i),s&&(t.globalCompositeOperation=s,ni.fillText(t,e,i,l),h&&(t.shadowBlur=h,t.shadowOffsetX=c,t.shadowOffsetY=u))},fillText:function(t,e,i,n){t.canvas._drawn=!0,n&&(t.fillStyle=n),t.fillText(e,Math.round(i.x),Math.round(i.y))},_stroke:function(t,e,i,n){if(ii&&(e=1),t.canvas._drawn=!0,0!==e){var r=t.strokeStyle&&t.strokeStyle.linePatternOffset,o=r?r[0]:0,a=r?r[1]:0,s=ni._isPattern(t.strokeStyle)&&(!Y(i)&&!Y(n)||!Y(o)&&!Y(a));Y(e)&&(e=1);var l=void 0;e<1&&(l=t.globalAlpha,t.globalAlpha*=e),s&&(i=i||0,n=n||0,t.translate(i+o,n+a)),t.stroke(),s&&t.translate(-i-o,-n-a),e<1&&(t.globalAlpha=l)}},_path:function(t,e,i,n,r){if(H(e))for(var o,a,s,l=H(i),h=!0!==r&&ni._isPattern(t.strokeStyle),c=void 0,u=void 0,d=void 0,p=0,f=e.length;p<f;p++)if(c=e[p],!l||t.setLineDash)t.lineTo(c.x,c.y),h&&0<p&&(u=e[p-1],a=c,void 0,s=Q((o=u).x,o.y,a.x,a.y),t.save(),t.translate(o.x,o.y-t.lineWidth/2/Math.cos(s)),t.rotate(s),ni._stroke(t,n),t.restore(),t.beginPath(),t.moveTo(c.x,c.y));else if(l){if(p===f-1)break;d=e[p+1],ri(t,c,d,i)}},path:function(t,e,i,n,r){H(e)&&(t.beginPath(),t.moveTo(e[0].x,e[0].y),ni._path(t,e,r,i),ni._stroke(t,i))},polygon:function(n,t,e,i,r,o){if(H(t)){var a=ni._isPattern(n.strokeStyle),s=H(r)&&!n.setLineDash||a&&!o;H(t[0])||(t=[t]);var l=void 0,h=void 0,c=void 0;if(s){for(n.save(),h=0,c=t.length;h<c;h++)H(t[h])&&(ni._ring(n,t[h],null,0,!0),l=i,0<h&&(n.globalCompositeOperation="destination-out",l=1),u(t,h,l),0<h?n.globalCompositeOperation="source-over":1<c&&(n.fillStyle="#fff"),ni._stroke(n,0));n.restore()}for(h=0,c=t.length;h<c;h++)H(t[h])&&(o?(ni.paintSmoothLine(n,t[h],e,o,!0),n.closePath()):ni._ring(n,t[h],r,e),s||(l=i,0<h&&(n.globalCompositeOperation="destination-out",l=1),u(t,h,l),0<h?n.globalCompositeOperation="source-over":1<c&&(n.fillStyle="#fff")),ni._stroke(n,e))}function u(t,e,i){ni.fillCanvas(n,i,t[e][0].x,t[e][0].y)}},_ring:function(t,e,i,n,r){var o=ni._isPattern(t.strokeStyle);r||!o||e[0].equals(e[e.length-1])||(e=e.concat([e[0]])),t.beginPath(),t.moveTo(e[0].x,e[0].y),ni._path(t,e,i,n,r),o||t.closePath()},paintSmoothLine:function(t,e,i,n,r){if(e)if(e.length<=2||!n)ni.path(t,e,i);else{var o=e.length,a=r?o:o-1;t.beginPath(),t.moveTo(e[0].x,e[0].y);for(var s,l,h,c,u,d,p,f,g,m,v,y,_,x,w,b,M,S,T,C,A,E,P,L=void 0,I=0;I<a;I++){var R=e[I].x,D=e[I].y,O=void 0,k=void 0,z=void 0,N=void 0,B=void 0,F=void 0;I-1<0?r?(O=e[a-1].x,k=e[a-1].y):(O=e[I+1].x,k=e[I+1].y):(O=e[I-1].x,k=e[I-1].y),I+1<o?(z=e[I+1].x,N=e[I+1].y):(z=e[I+1-o].x,N=e[I+1-o].y),I+2<o?(B=e[I+2].x,F=e[I+2].y):r?(B=e[I+2-o].x,F=e[I+2-o].y):(B=e[I].x,F=e[I].y);var G=(g=n,void 0,m=((s=O)+(h=R))/2,v=((l=k)+(c=D))/2,y=(h+(u=z))/2,_=(c+(d=N))/2,x=(u+(p=B))/2,w=(d+(f=F))/2,b=Math.sqrt((h-s)*(h-s)+(c-l)*(c-l)),M=Math.sqrt((u-h)*(u-h)+(d-c)*(d-c)),S=b/(b+M),T=M/(M+Math.sqrt((p-u)*(p-u)+(f-d)*(f-d))),[(C=m+(y-m)*S)+(y-C)*g+h-C,(A=v+(_-v)*S)+(_-A)*g+c-A,(E=y+(x-y)*T)+(y-E)*g+u-E,(P=_+(w-_)*T)+(_-P)*g+d-P]);t.bezierCurveTo(G[0],G[1],G[2],G[3],z,N),e[I].nextCtrlPoint=G.slice(0,2),e[I].prevCtrlPoint=L?L.slice(2):null,L=G}r||(e[0].nextCtrlPoint=e[1].prevCtrlPoint,delete e[0].prevCtrlPoint),e[o-1].prevCtrlPoint=e[o-2].nextCtrlPoint,ni._stroke(t,i)}},_arcBetween:function(t,e,i,n){var r=n,o=e.distanceTo(i),a=o/2/Math.sin(r/2),s=Math.asin((i.y-e.y)/o);e.x>i.x&&(s=Math.PI-s);var l=s-(90*Math.PI/180-r/2),h=Math.cos(l)*a,c=Math.sin(l)*a,u=e.x+h,d=e.y+c,p=Math.asin((i.y-d)/a);u>i.x&&(p=Math.PI-p);var f=p+r;return t.beginPath(),t.arc(u,d,a,p,f),[u,d]},_lineTo:function(t,e){t.lineTo(e.x,e.y)},bezierCurveAndFill:function(t,e,i,n){t.beginPath();var r=e[0];t.moveTo(r.x,r.y);var o=[t];o.push.apply(o,e.splice(1)),ni._bezierCurveTo.apply(ni,o),ni.fillCanvas(t,n),ni._stroke(t,i)},_bezierCurveTo:function(t,e,i,n){t.bezierCurveTo(e.x,e.y,i.x,i.y,n.x,n.y)},ellipse:function(t,e,i,n,r,o){var a,s,l,h,c,u;t.beginPath(),i===n?t.arc(e.x,e.y,i,0,2*Math.PI):t.ellipse?t.ellipse(e.x,e.y,i,n,0,0,Math.PI/180*360):(a=e.x,s=e.y,c=.5522848*(l=i),u=.5522848*(h=n),t.moveTo(a-l,s),t.bezierCurveTo(a-l,s-u,a-c,s-h,a,s-h),t.bezierCurveTo(a+c,s-h,a+l,s-u,a+l,s),t.bezierCurveTo(a+l,s+u,a+c,s+h,a,s+h),t.bezierCurveTo(a-c,s+h,a-l,s+u,a-l,s),t.closePath()),ni.fillCanvas(t,o,e.x-i,e.y-n),ni._stroke(t,r,e.x-i,e.y-n)},rectangle:function(t,e,i,n,r){t.beginPath(),t.rect(e.x,e.y,i.width,i.height),ni.fillCanvas(t,r,e.x,e.y),ni._stroke(t,n,e.x,e.y)},sector:function(t,e,i,n,l,h){var c=Math.PI/180,r=n[0],o=n[1];function a(t,e,i,n,r,o){var a=c*-o,s=c*-r;t.beginPath(),t.moveTo(e,i),t.arc(e,i,n,a,s),t.lineTo(e,i),ni.fillCanvas(t,h,e-n,i-n),ni._stroke(t,l,e-n,i-n)}a(t,e.x,e.y,i,r,o)},_isPattern:function(t){return!(S(t)||"addColorStop"in t)},drawCross:function(t,e,i,n){t.canvas._drawn=!0,t.strokeStyle=n,t.lineWidth=i,t.beginPath(),t.moveTo(e.x-5,e.y),t.lineTo(e.x+5,e.y),t.moveTo(e.x,e.y-5),t.lineTo(e.x,e.y+5),t.stroke()},copy:function(t,e){var i=e||Ie("canvas");return i.width=t.width,i.height=t.height,i.getContext("2d").drawImage(t,0,0),i}};function ri(t,e,i,n){var r=e.x,o=e.y,a=i.x,s=i.y,l=n,h=function(t,e){return t<=e},c=function(t,e){return e<=t},u=function(t,e){return Math.min(t,e)},d=function(t,e){return Math.max(t,e)},p={thereYet:c,cap:u},f={thereYet:c,cap:u};0<o-s&&(f.thereYet=h,f.cap=d),0<r-a&&(p.thereYet=h,p.cap=d),t.moveTo(r,o);for(var g=r,m=o,v=0,y=!0,_=void 0,x=void 0;!p.thereYet(g,a)||!f.thereYet(m,s);)_=Math.atan2(s-o,a-r),x=l[v],g=p.cap(a,g+Math.cos(_)*x),m=f.cap(s,m+Math.sin(_)*x),y?t.lineTo(g,m):t.moveTo(g,m),v=(v+1)%l.length,y=!y}var oi="data:image/";function ai(t){return t.length>oi.length&&t.substring(0,oi.length)===oi||Z(t)}function si(t){return t.substring(0,oi.length)===oi?t:X(t)}var li=function(t){return function(t){function e(){return u(this,e),v(this,t.apply(this,arguments))}return m(e,t),e.prototype.on=function(t,e,i){if(!t)return this;if(!S(t))return this._switch("on",t,e);if(!e)return this;this._eventMap||(this._eventMap={});var n=t.toLowerCase().split(" "),r=void 0;i||(i=this);for(var o=void 0,a=0,s=n.length;a<s;a++){r=n[a],(o=this._eventMap[r])||(o=[],this._eventMap[r]=o);var l=o.length;if(0<l)for(var h=0;h<l;h++)if(e===o[h].handler&&o[h].context===i)return this;o.push({handler:e,context:i})}return this},e.prototype.addEventListener=function(){return this.on.apply(this,arguments)},e.prototype.once=function(t,e,i){if(!S(t)){var n={};for(var r in t)t.hasOwnProperty(r)&&(n[r]=this._wrapOnceHandler(r,t[r],i));return this._switch("on",n)}for(var o=t.split(" "),a=0,s=o.length;a<s;a++)this.on(o[a],this._wrapOnceHandler(o[a],e,i));return this},e.prototype.off=function(t,e,i){if(!this._eventMap||!t)return this;if(!S(t))return this._switch("off",t,e);if(!e)return this;var n=t.split(" "),r=void 0,o=void 0,a=void 0;i||(i=this);for(var s=0,l=n.length;s<l;s++){if(a="Z__"+(r=n[s].toLowerCase()),!(o=this._eventMap[r]))return this;for(var h=o.length-1;0<=h;h--){var c=o[h];e!==c.handler&&e!==c.handler[a]||c.context!==i||(delete c.handler[a],o.splice(h,1))}}return this},e.prototype.removeEventListener=function(){return this.off.apply(this,arguments)},e.prototype.listens=function(t,e,i){if(!this._eventMap||!S(t))return 0;var n=this._eventMap[t.toLowerCase()];if(!n||!n.length)return 0;for(var r=0,o=0,a=n.length;o<a;o++)if(e){if(e===n[o].handler&&(Y(i)||n[o].context===i))return 1}else r++;return r},e.prototype.copyEventListeners=function(t){var e=t._eventMap;if(!e)return this;var i=void 0;for(var n in e)for(var r=0,o=(i=e[n]).length;r<o;r++)this.on(n,i[r].handler,i[r].context);return this},e.prototype.fire=function(){return this._eventParent?this._eventParent.fire.apply(this._eventParent,arguments):this._fire.apply(this,arguments)},e.prototype._wrapOnceHandler=function(e,i,n){var r=this,o="Z__"+e,a=!1,s=function t(){a||(delete s[o],a=!0,n?i.apply(n,arguments):i.apply(this,arguments),r.off(e,t,this))};return s[o]=i,s},e.prototype._switch=function(t,e,i){for(var n in e)e.hasOwnProperty(n)&&this[t](n,e[n],i);return this},e.prototype._clearListeners=function(t){this._eventMap&&S(t)&&(this._eventMap[t.toLowerCase()]&&(this._eventMap[t]=null))},e.prototype._clearAllListeners=function(){this._eventMap=null},e.prototype._setEventParent=function(t){return this._eventParent=t,this},e.prototype._fire=function(t,e){if(!this._eventMap)return this;var i=this._eventMap[t.toLowerCase()];if(!i)return this;e||(e={}),e.type=t,e.target=this;for(var n=i.slice(0),r=void 0,o=void 0,a=0,s=n.length;a<s;a++)n[a]&&(r=n[a].context,!0,o=_({},e),!1===(r?n[a].handler.call(r,o):n[a].handler(o))&&e.domEvent&&Be(e.domEvent));return this},e}(t)},hi=li(function(){function e(t){u(this,e),this.target=t}return e.prototype.enable=function(){return this._enabled||(this._enabled=!0,this.addHooks()),this},e.prototype.disable=function(){return this._enabled&&(this._enabled=!1,this.removeHooks()),this},e.prototype.enabled=function(){return!!this._enabled},e.prototype.remove=function(){this.disable(),delete this.target,delete this.dom},e}()),ci=function(){function e(t){if(u(this,e),!this||!this.setOptions)throw new Error('Class instance is being created without "new" operator.');this.setOptions(t),this.callInitHooks()}return e.prototype.callInitHooks=function(){var t=Object.getPrototypeOf(this);return this._visitInitHooks(t),this},e.prototype.setOptions=function(t){if(this.hasOwnProperty("options")||(this.options=this.options?Object.create(this.options):{}),!t)return this;for(var e in t)this.options[e]=t[e];return this},e.prototype.config=function(t){if(!t){var e={};for(var i in this.options)this.options.hasOwnProperty(i)&&(e[i]=this.options[i]);return e}if(2===arguments.length){var n={};n[t]=arguments[1],t=n}for(var r in t)this.options[r]=t[r],this[r]&&this[r]instanceof hi&&(t[r]?this[r].enable():this[r].disable());return this.onConfig(t),this},e.prototype.onConfig=function(){},e.prototype._visitInitHooks=function(t){if(!this._initHooksCalled){var e=Object.getPrototypeOf(t);e._visitInitHooks&&e._visitInitHooks.call(this,e),this._initHooksCalled=!0;var i=t._initHooks;if(i&&i!==e._initHooks)for(var n=0;n<i.length;n++)i[n].call(this)}},e.addInitHook=function(t){for(var e=arguments.length,i=Array(1<e?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];var r="function"==typeof t?t:function(){this[t].apply(this,i)},o=this.prototype,a=Object.getPrototypeOf(o);return o._initHooks&&o._initHooks!==a._initHooks||(o._initHooks=[]),o._initHooks.push(r),this},e.include=function(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];for(var n=0;n<e.length;n++)_(this.prototype,e[n]);return this},e.mergeOptions=function(t){var e=this.prototype,i=Object.getPrototypeOf(e);return e.options&&e.options!==i.options||(e.options=e.options?Object.create(e.options):{}),_(e.options,t),this},e}(),ui={},di=function(t){return function(t){function e(){return u(this,e),v(this,t.apply(this,arguments))}return m(e,t),e.registerJSONType=function(t){return t?ui[t]=this:this},e.getJSONClass=function(t){return t?ui[t]:null},e.prototype.getJSONType=function(){if(void 0===this._jsonType){var t=Object.getPrototypeOf(this).constructor;for(var e in ui)if(ui[e]===t){this._jsonType=e;break}}if(!this._jsonType)throw new Error("Found an unregistered geometry class!");return this._jsonType},e}(t)},pi=function(t){return function(t){function e(){return u(this,e),v(this,t.apply(this,arguments))}return m(e,t),e.prototype.addHandler=function(t,e){if(!e)return this;if(this._handlers||(this._handlers=[]),this[t])return this[t].enable(),this;var i=this[t]=new e(this);return this._handlers.push(i),this.options[t]&&i.enable(),this},e.prototype.removeHandler=function(t){if(!t)return this;var e=this[t];if(e){var i=this._handlers.indexOf(e);0<=i&&this._handlers.splice(i,1),this[t].remove(),delete this[t]}return this},e.prototype._clearHandlers=function(){for(var t=0,e=this._handlers.length;t<e;t++)this._handlers[t].remove();this._handlers=[]},e}(t)},fi="touchstart mousedown",gi={mousedown:"mousemove",touchstart:"touchmove",pointerdown:"touchmove",MSPointerDown:"touchmove"},mi={mousedown:"mouseup",touchstart:"touchend",pointerdown:"touchend",MSPointerDown:"touchend"},vi=function(n){function r(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};u(this,r);var i=v(this,n.call(this,null));return i.dom=t,i.options=e,i}return m(r,n),r.prototype.enable=function(){return this.dom&&(this._onMouseDown=function(t){return this.onMouseDown(t)},Qe(this.dom,fi,this._onMouseDown,this)),this},r.prototype.disable=function(){return this.dom&&(this._offEvents(),$e(this.dom,fi,this._onMouseDown),delete this._onMouseDown),this},r.prototype.onMouseDown=function(t){if((this.options.rightclick||2!==t.button)&&!(t.touches&&1<t.touches.length||this.options.cancelOn&&!0===this.options.cancelOn(t))){var e=this.dom;e.setCapture?e.setCapture():window.captureEvents&&window.captureEvents(window.Event.MOUSEMOVE|window.Event.MOUSEUP),e.ondragstart=function(){return!1},delete this.moved;var i=t.touches?t.touches[0]:t;this.startPos=new le(i.clientX,i.clientY),Qe(document,gi[t.type],this.onMouseMove,this),Qe(document,mi[t.type],this.onMouseUp,this),this.options.ignoreMouseleave||Qe(this.dom,"mouseleave",this.onMouseUp,this),this.fire("mousedown",{domEvent:t,mousePos:new le(i.clientX,i.clientY)})}},r.prototype.onMouseMove=function(t){if(t.touches&&1<t.touches.length)this.moved&&(this.interupted=!0,this.onMouseUp(t));else{var e=t.touches?t.touches[0]:t,i=new le(e.clientX,e.clientY).sub(this.startPos);(i.x||i.y)&&(this.moved?this.fire("dragging",{domEvent:t,mousePos:new le(e.clientX,e.clientY)}):(this.fire("dragstart",{domEvent:t,mousePos:this.startPos.copy()}),this.moved=!0))}},r.prototype.onMouseUp=function(t){var e=t.changedTouches?t.changedTouches[0]:t;this._offEvents();var i={domEvent:t};w(e.clientX)&&(i.mousePos=new le(parseInt(e.clientX,0),parseInt(e.clientY,0))),this.moved&&(i.interupted=this.interupted,this.fire("dragend",i),delete this.interupted,delete this.moved),this.fire("mouseup",i)},r.prototype._offEvents=function(){var t=this.dom;if($e(t,"mouseleave",this.onMouseUp,this),"undefined"!=typeof document&&"undefined"!=typeof window){for(var e in gi)$e(document,gi[e],this.onMouseMove,this),$e(document,mi[e],this.onMouseUp,this);t.releaseCapture?t.releaseCapture():window.captureEvents&&window.captureEvents(window.Event.MOUSEMOVE|window.Event.MOUSEUP)}},r}(hi),yi=function(t){function o(){return u(this,o),v(this,t.apply(this,arguments))}return m(o,t),o.toNumberArrays=function(t){return Array.isArray(t)?k(t,function(t){return[t.x,t.y]}):[t.x,t.y]},o.toCoordinates=function(t){if(w(t[0])&&w(t[1]))return new o(t);for(var e=[],i=0,n=t.length;i<n;i++){var r=t[i];Array.isArray(r)?w(r[0])?e.push(new o(r)):e.push(o.toCoordinates(r)):e.push(new o(r))}return e},o}(se),_i=function(){function i(t,e){u(this,i),this.type=t,this.properties=e}return i.createProj4=function(t){return new i("proj4",{proj:t})},i.fromProjectionCode=function(t){return t&&i[t=t.toUpperCase().replace(":","")]||null},i}();_i.WGS84=_i.createProj4("+proj=longlat +datum=WGS84 +no_defs"),_i.EPSG4326=_i.WGS84,_i.EPSG3857=_i.createProj4("+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +wktext  +no_defs"),_i.IDENTITY=_i.createProj4("+proj=identity +no_defs"),_i.CGCS2000=_i.createProj4("+proj=longlat +datum=CGCS2000"),_i.EPSG4490=_i.CGCS2000,_i.BD09LL=_i.createProj4("+proj=longlat +datum=BD09"),_i.GCJ02=_i.createProj4("+proj=longlat +datum=GCJ02");var xi,wi=function(){function a(t,e,i,n){u(this,a),this._clazz=yi;var r=arguments.length,o=0<r?arguments[r-1]:null;o&&o.unproject&&(this.projection=arguments[r-1]),this._dirty=!0,this._initialize(t,e,i,n)}return a.prototype._initialize=function(t,e,i,n){if(this.xmin=null,this.xmax=null,this.ymin=null,this.ymax=null,!Y(t)){var r=this.projection;w(t)&&w(e)&&w(i)&&w(n)?r?(this.xmin=t,this.ymin=e,this.xmax=i,this.ymax=n):(this.xmin=Math.min(t,i),this.ymin=Math.min(e,n),this.xmax=Math.max(t,i),this.ymax=Math.max(e,n)):Array.isArray(t)?r?(this.xmin=t[0],this.ymin=t[1],this.xmax=t[2],this.ymax=t[3]):(this.xmin=Math.min(t[0],t[2]),this.ymin=Math.min(t[1],t[3]),this.xmax=Math.max(t[0],t[2]),this.ymax=Math.max(t[1],t[3])):w(t.x)&&w(e.x)&&w(t.y)&&w(e.y)?r?(this.xmin=t.x,this.ymin=t.y,this.xmax=e.x,this.ymax=e.y):(t.x>e.x?(this.xmin=e.x,this.xmax=t.x):(this.xmin=t.x,this.xmax=e.x),t.y>e.y?(this.ymin=e.y,this.ymax=t.y):(this.ymin=t.y,this.ymax=e.y)):w(t.xmin)&&w(t.xmax)&&w(t.ymin)&&w(t.ymax)&&(this.xmin=t.xmin,this.ymin=t.ymin,this.xmax=t.xmax,this.ymax=t.ymax)}},a.prototype._add=function(t){return this._dirty=!0,Y(t.x)?Y(t.xmin)?Y(t[0])||(this.xmin+=t[0],this.ymin+=t[1],this.xmax+=t[0],this.ymax+=t[1]):(this.xmin+=t.xmin,this.ymin+=t.ymin,this.xmax+=t.xmax,this.ymax+=t.ymax):(this.xmin+=t.x,this.ymin+=t.y,this.xmax+=t.x,this.ymax+=t.y),this},a.prototype.add=function(){var t=new this.constructor(this.xmin,this.ymin,this.xmax,this.ymax,this.projection);return t._add.apply(t,arguments)},a.prototype._sub=function(t){return this._dirty=!0,Y(t.x)?Y(t.xmin)?Y(t[0])||(this.xmin-=t[0],this.ymin-=t[1],this.xmax-=t[0],this.ymax-=t[1]):(this.xmin-=t.xmin,this.ymin-=t.ymin,this.xmax-=t.xmax,this.ymax-=t.ymax):(this.xmin-=t.x,this.ymin-=t.y,this.xmax-=t.x,this.ymax-=t.y),this},a.prototype._substract=function(){return this._sub.apply(this,arguments)},a.prototype.sub=function(){var t=new this.constructor(this.xmin,this.ymin,this.xmax,this.ymax,this.projection);return t._sub.apply(t,arguments)},a.prototype.substract=function(){return this.sub.apply(this,arguments)},a.prototype.round=function(){return new this.constructor(Math.round(this.xmin),Math.round(this.ymin),Math.round(this.xmax),Math.round(this.ymax),this.projection)},a.prototype._round=function(){return this._dirty=!0,this.xmin=Math.round(this.xmin),this.ymin=Math.round(this.ymin),this.xmax=Math.round(this.xmax),this.ymax=Math.round(this.ymax),this},a.prototype.getMin=function(){return new this._clazz(this.xmin,this.ymin)},a.prototype.getMax=function(){return new this._clazz(this.xmax,this.ymax)},a.prototype.getCenter=function(){return new this._clazz((this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)},a.prototype.isValid=function(){return w(this.xmin)&&w(this.ymin)&&w(this.xmax)&&w(this.ymax)},a.prototype.equals=function(t){return this.xmin===t.xmin&&this.xmax===t.xmax&&this.ymin===t.ymin&&this.ymax===t.ymax},a.prototype.intersects=function(t){this._project(this),this._project(t);var e=Math.max(this.pxmin,t.pxmin),i=Math.max(this.pymin,t.pymin),n=Math.min(this.pxmax,t.pxmax),r=Math.min(this.pymax,t.pymax),o=!(n<e||r<i);return o},a.prototype.within=function(t){return this._project(this),this._project(t),this.pxmin>=t.pxmin&&this.pxmax<=t.pxmax&&this.pymin>=t.pymin&&this.pymax<=t.pymax},a.prototype.contains=function(t){if(!t)return!1;this._project(this);var e=this.projection;return Array.isArray(t)&&(t=new this._clazz(t)),e&&(t=e.project(t)),t.x>=this.pxmin&&t.x<=this.pxmax&&t.y>=this.pymin&&t.y<=this.pymax},a.prototype.getWidth=function(){return Math.abs(this.xmax-this.xmin)},a.prototype.getHeight=function(){return Math.abs(this.ymax-this.ymin)},a.prototype.getSize=function(){return new he(this.getWidth(),this.getHeight())},a.prototype.__combine=function(t){t instanceof this.constructor||(t=new this.constructor(t,t)),this._project(t),this._project(this);var e=this.pxmin;w(e)?w(t.pxmin)&&e>t.pxmin&&(e=t.pxmin):e=t.pxmin;var i=this.pxmax;w(i)?w(t.pxmax)&&i<t.pxmax&&(i=t.pxmax):i=t.pxmax;var n=this.pymin;w(n)?w(t.pymin)&&n>t.pymin&&(n=t.pymin):n=t.pymin;var r=this.pymax;w(r)?w(t.pymax)&&r<t.pymax&&(r=t.pymax):r=t.pymax;var o=this.projection;if(o){var a=o.unproject(new this._clazz(e,n)),s=o.unproject(new this._clazz(i,r));e=a.x,n=a.y,i=s.x,r=s.y}return[e,n,i,r]},a.prototype._combine=function(t){if(!t)return this;var e=this.__combine(t);return this.xmin=e[0],this.ymin=e[1],this.xmax=e[2],this.ymax=e[3],this._dirty=!0,this},a.prototype.combine=function(t){if(!t)return this;var e=this.__combine(t);return new this.constructor(e[0],e[1],e[2],e[3],this.projection)},a.prototype.intersection=function(t){if(!this.intersects(t))return null;var e=new this._clazz(Math.max(this.pxmin,t.pxmin),Math.max(this.pymin,t.pymin)),i=new this._clazz(Math.min(this.pxmax,t.pxmax),Math.min(this.pymax,t.pymax)),n=this.projection;return n&&(e=n.unproject(e),i=n.unproject(i)),new this.constructor(e,i,n)},a.prototype.expand=function(t){var e=void 0,i=void 0;return w(t)?e=i=t:(e=t.width||t.x||t[0]||0,i=t.height||t.y||t[1]||0),new this.constructor(this.xmin-e,this.ymin-i,this.xmax+e,this.ymax+i,this.projection)},a.prototype._expand=function(t){var e=void 0,i=void 0;return w(t)?e=i=t:(e=t.width||t.x||t[0]||0,i=t.height||t.y||t[1]||0),this.xmin-=e,this.ymin-=i,this.xmax+=e,this.ymax+=i,this._dirty=!0,this},a.prototype.toJSON=function(){return{xmin:this.xmin,ymin:this.ymin,xmax:this.xmax,ymax:this.ymax}},a.prototype.toArray=function(){var t=this.xmin,e=this.ymin,i=this.xmax,n=this.ymax;return[new this._clazz([t,n]),new this._clazz([i,n]),new this._clazz([i,e]),new this._clazz([t,e]),new this._clazz([t,n])]},a.prototype.toString=function(){return this.xmin+","+this.ymin+","+this.xmax+","+this.ymax},a.prototype.copy=function(){return new this.constructor(this.xmin,this.ymin,this.xmax,this.ymax,this.projection)},a.prototype.convertTo=function(t){if(!this.isValid())return null;var e=new this.constructor,i=new this._clazz(this.xmin,this.ymax);return e._combine(t(i)),i.x=this.xmax,e._combine(t(i)),i.y=this.ymin,e._combine(t(i)),i.x=this.xmin,e._combine(t(i)),e},a.prototype._project=function(t){if(t&&t.isValid()){var e=this.projection;if(e){if(t._dirty){var i=[t.getMin(),t.getMax()],n=(i=e.projectCoords(i))[0],r=i[1];t.pxmin=Math.min(n.x,r.x),t.pymin=Math.min(n.y,r.y),t.pxmax=Math.max(n.x,r.x),t.pymax=Math.max(n.y,r.y)}delete t._dirty}else t.pxmin=t.xmin,t.pxmax=t.xmax,t.pymin=t.ymin,t.pymax=t.ymax}},a}(),bi=function(o){function a(t,e,i,n){u(this,a);var r=v(this,o.call(this,t,e,i,n));return r._clazz=le,r}return m(a,o),a}(wi),Mi=function(){function e(t){u(this,e),this.matrix=t}return e.prototype.transform=function(t,e){return new le(this.matrix[0]*(t.x-this.matrix[2])/e,this.matrix[1]*(t.y-this.matrix[3])/e)},e.prototype.untransform=function(t,e){return new yi(t.x*e/this.matrix[0]+this.matrix[2],t.y*e/this.matrix[1]+this.matrix[3])},e}(),Si={project:function(){},unproject:function(){},projectCoords:function(t){var e=this;if(!t)return[];if(!Array.isArray(t))return this.project(t);if(0===t.length)return[];if(!this.isSphere())return k(t,this.project,this);if(Array.isArray(t[0]))return t.map(function(t){return e.projectCoords(t)});for(var i=this.getCircum(),n=this.getSphereExtent(),r=n.sx,o=n.sy,a=void 0,s=void 0,l=t[0],h=void 0,c=void 0,u=void 0,d=void 0,p=[this.project(l)],f=1,g=t.length;f<g;f++)c=(h=t[f]).x-l.x,u=h.y-l.y,d=this.project(h),180<Math.abs(c)&&(void 0===a&&(a=h.x<l.x),a&&(d._add(-i.x*N(c)*r,0),h._add(-360*N(c),0))),90<Math.abs(u)&&(void 0===s&&(s=h.y<l.y),s&&(d._add(0,-i.y*N(u)*o),h._add(0,-180*N(u)))),l=h,p.push(d);return p},unprojectCoords:function(t){return t?Array.isArray(t)?k(t,this.unproject,this):this.unproject(t):[]},isSphere:function(){return!!this.sphere},isOutSphere:function(t){return!!this.isSphere()&&!this.getSphereExtent().contains(t)},wrapCoord:function(t){if(!this.isSphere())return t;var e=this.getSphereExtent(),i=new yi(t);return e.contains(i)||(i.x=G(t.x,e.xmin,e.xmax),i.y=G(t.y,e.ymin,e.ymax)),i},getCircum:function(){if(!this.circum&&this.isSphere()){var t=this.getSphereExtent();this.circum={x:t.getWidth(),y:t.getHeight()}}return this.circum},getSphereExtent:function(){if(!this.extent&&this.isSphere()){var t=this.project(new yi(180,90)),e=this.project(new yi(-180,-90));this.extent=new wi(e,t,this),this.extent.sx=t.x>e.x?1:-1,this.extent.sy=t.y>e.y?1:-1}return this.extent}},Ti={measureLength:function(t,e){if(!Array.isArray(t))return this.measureLenBetween(t,e);for(var i=0,n=0,r=t.length;n<r-1;n++)i+=this.measureLenBetween(t[n],t[n+1]);return i}},Ci=_({measure:"IDENTITY",measureLenBetween:function(t,e){if(!t||!e)return 0;try{return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}catch(t){return 0}},measureArea:function(t){if(!Array.isArray(t))return 0;for(var e=0,i=0,n=t.length;i<n;i++){var r=t[i],o=null;o=i===n-1?t[0]:t[i+1],e+=r.x*o.y-r.y*o.x}return Math.abs(e/2)},locate:function(t,e,i){return t=new yi(t.x,t.y),this._locate(t,e,i)},_locate:function(t,e,i){return t?(e||(e=0),i||(i=0),(e||i)&&(t.x=t.x+e,t.y=t.y+i),t):null},rotate:function(t,e,i){return t=new yi(t.x,t.y),this._rotate(t,e,i)},_rotate:(xi=new le(0,0),function(t,e,i){return xi.x=t.x-e.x,xi.y=t.y-e.y,xi._rotate(i*Math.PI/180),t._add(xi.x,xi.y)})},Ti),Ai=function(){function e(t){u(this,e),this.radius=t}return e.prototype.measureLenBetween=function(t,e){if(!t||!e)return 0;var i=T(t.y),n=T(e.y),r=i-n,o=T(t.x)-T(e.x);return i=2*Math.asin(Math.sqrt(Math.pow(Math.sin(r/2),2)+Math.cos(i)*Math.cos(n)*Math.pow(Math.sin(o/2),2))),i*=this.radius,Math.round(1e5*i)/1e5},e.prototype.measureArea=function(t){var e=T(this.radius),i=0,n=t,r=n.length;if(r<3)return 0;var o=void 0;for(o=0;o<r-1;o++){var a=n[o],s=n[o+1];i+=a.x*e*Math.cos(T(a.y))*s.y*e-s.x*e*Math.cos(T(s.y))*a.y*e}return r=n[o],n=n[0],i+=r.x*e*Math.cos(T(r.y))*n.y*e-n.x*e*Math.cos(T(n.y))*r.y*e,.5*Math.abs(i)},e.prototype.locate=function(t,e,i){return t=new yi(t.x,t.y),this._locate(t,e,i)},e.prototype._locate=function(t,e,i){if(!t)return null;if(e||(e=0),i||(i=0),!e&&!i)return t;var n=void 0,r=void 0,o=T(t.y);if(0!==i){var a=Math.abs(i);r=G(180*(o+=2*Math.sin(a/(2*this.radius))*(0<i?1:-1))/Math.PI,-90,90)}else r=t.y;if(0!==e){var s=Math.abs(e),l=T(t.x);n=G(180*(l+=2*Math.sqrt(Math.pow(Math.sin(s/(2*this.radius)),2)/Math.pow(Math.cos(o),2))*(0<e?1:-1))/Math.PI,-180,180)}else n=t.x;return t.x=n,t.y=r,t},e.prototype.rotate=function(t,e,i){return t=new yi(t),this._rotate(t,e,i)},e.prototype._rotate=function(t,e,i){var n=function(t,e){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},n=void 0;n=i.final?Ei(e,t):Ei(t,e);return 180<n?-(360-n):n}(e,t)-i,r=this.measureLenBetween(e,t);return t.x=e.x,t.y=e.y,function(t,e,i,n){var r=e/n,o=t.x*Math.PI/180,a=T(t.y),s=T(i),l=r*Math.cos(s),h=a+l;Math.abs(h)>Math.PI/2&&(h=0<h?Math.PI-h:-Math.PI-h);var c=Math.log(Math.tan(h/2+Math.PI/4)/Math.tan(a/2+Math.PI/4)),u=1e-11<Math.abs(c)?l/c:Math.cos(a),d=r*Math.sin(s)/u,p=o+d;return t.x=(180*p/Math.PI+540)%360-180,t.y=180*h/Math.PI,t}(t,r,n,this.radius)},e}();function Ei(t,e){var i=T(t.y),n=T(e.y),r=T(e.x-t.x);r>Math.PI&&(r-=2*Math.PI),r<-Math.PI&&(r+=2*Math.PI);var o=Math.log(Math.tan(n/2+Math.PI/4)/Math.tan(i/2+Math.PI/4));return(l(Math.atan2(r,o))+360)%360}var Pi=_({measure:"EPSG:4326",sphere:new Ai(6378137),measureLenBetween:function(){return this.sphere.measureLenBetween.apply(this.sphere,arguments)},measureArea:function(){return this.sphere.measureArea.apply(this.sphere,arguments)},_locate:function(){return this.sphere._locate.apply(this.sphere,arguments)},locate:function(){return this.sphere.locate.apply(this.sphere,arguments)},_rotate:function(){return this.sphere._rotate.apply(this.sphere,arguments)},rotate:function(){return this.sphere.rotate.apply(this.sphere,arguments)}},Ti),Li=_({measure:"BAIDU",sphere:new Ai(6370996.81),measureLenBetween:function(){return this.sphere.measureLenBetween.apply(this.sphere,arguments)},measureArea:function(){return this.sphere.measureArea.apply(this.sphere,arguments)},_locate:function(){return this.sphere._locate.apply(this.sphere,arguments)},locate:function(){return this.sphere.locate.apply(this.sphere,arguments)},_rotate:function(){return this.sphere._rotate.apply(this.sphere,arguments)},rotate:function(){return this.sphere.rotate.apply(this.sphere,arguments)}},Ti),Ii=Pi,Ri={};function Di(t){Ri[t.measure]=t}Di(Ci),Di(Pi),Di(Li);var Oi={getInstance:function(t){if(!t)return Ii;for(var e in Ri)if(M(Ri,e)){var i=Ri[e].measure;if(!i)continue;if(t.toLowerCase()===i.toLowerCase())return Ri[e]}return null}},ki=Object.freeze({Identity:Ci,DEFAULT:Ii,Measurer:Oi,WGS84Sphere:Pi,BaiduSphere:Li}),zi=_({},Si,{code:"EPSG:3857",rad:Math.PI/180,metersPerDegree:6378137*Math.PI/180,maxLatitude:85.0511287798,project:function(t){var e=this.rad,i=this.metersPerDegree,n=this.maxLatitude,r=t.x,o=Math.max(Math.min(n,t.y),-n),a=void 0;return a=0===o?0:Math.log(Math.tan((90+o)*e/2))/e,new yi(r*i,a*i)},unproject:function(t){var e=t.x,i=t.y,n=this.rad,r=this.metersPerDegree,o=void 0;return 0===i?o=0:(o=i/r,o=(2*Math.atan(Math.exp(o*n))-Math.PI/2)/n),new yi(G(e/r,-180,180),G(o,-this.maxLatitude,this.maxLatitude))}},Pi),Ni=_({},Si,{code:"EPSG:4326",project:function(t){return new yi(t)},unproject:function(t){return new yi(t)}},Pi),Bi=_({},Ni,{code:"EPSG:4490"}),Fi=_({},Si,{code:"BAIDU",project:function(t){return this.convertLL2MC(t)},unproject:function(t){return this.convertMC2LL(t)}},Li,{EARTHRADIUS:6370996.81,MCBAND:[12890594.86,8362377.87,5591021,3481989.83,1678043.12,0],LLBAND:[75,60,45,30,15,0],MC2LL:[[1.410526172116255e-8,898305509648872e-20,-1.9939833816331,200.9824383106796,-187.2403703815547,91.6087516669843,-23.38765649603339,2.57121317296198,-.03801003308653,17337981.2],[-7.435856389565537e-9,8983055097726239e-21,-.78625201886289,96.32687599759846,-1.85204757529826,-59.36935905485877,47.40033549296737,-16.50741931063887,2.28786674699375,10260144.86],[-3.030883460898826e-8,898305509983578e-20,.30071316287616,59.74293618442277,7.357984074871,-25.38371002664745,13.45380521110908,-3.29883767235584,.32710905363475,6856817.37],[-1.981981304930552e-8,8983055099779535e-21,.03278182852591,40.31678527705744,.65659298677277,-4.44255534477492,.85341911805263,.12923347998204,-.04625736007561,4482777.06],[3.09191371068437e-9,8983055096812155e-21,6995724062e-14,23.10934304144901,-.00023663490511,-.6321817810242,-.00663494467273,.03430082397953,-.00466043876332,2555164.4],[2.890871144776878e-9,8983055095805407e-21,-3.068298e-8,7.47137025468032,-353937994e-14,-.02145144861037,-1234426596e-14,.00010322952773,-323890364e-14,826088.5]],LL2MC:[[-.0015702102444,111320.7020616939,0x60e374c3105a3,-0x24bb4115e2e164,0x5cc55543bb0ae8,-0x7ce070193f3784,0x5e7ca61ddf8150,-0x261a578d8b24d0,0x665d60f3742ca,82.5],[.0008277824516172526,111320.7020463578,647795574.6671607,-4082003173.641316,10774905663.51142,-15171875531.51559,12053065338.62167,-5124939663.577472,913311935.9512032,67.5],[.00337398766765,111320.7020202162,4481351.045890365,-23393751.19931662,79682215.47186455,-115964993.2797253,97236711.15602145,-43661946.33752821,8477230.501135234,52.5],[.00220636496208,111320.7020209128,51751.86112841131,3796837.749470245,992013.7397791013,-1221952.21711287,1340652.697009075,-620943.6990984312,144416.9293806241,37.5],[-.0003441963504368392,111320.7020576856,278.2353980772752,2485758.690035394,6070.750963243378,54821.18345352118,9540.606633304236,-2710.55326746645,1405.483844121726,22.5],[-.0003218135878613132,111320.7020701615,.00369383431289,823725.6402795718,.46104986909093,2351.343141331292,1.58060784298199,8.77738589078284,.37238884252424,7.45]],convertMC2LL:function(t){Math.abs(t.x);for(var e=Math.abs(t.y),i=void 0,n=0,r=this.MCBAND.length;n<r;n++)if(e>=this.MCBAND[n]){i=this.MC2LL[n];break}var o=this.convertor(t,i);return new yi(o.x,o.y)},convertLL2MC:function(t){var e,i=void 0,n=void 0;t.x=this.getLoop(t.x,-180,180),t.y=this.getRange(t.y,-74,74);var r=new yi(t.x,t.y);for(n=0,e=this.LLBAND.length;n<e;n++)if(r.y>=this.LLBAND[n]){i=this.LL2MC[n];break}if(!i)for(n=this.LLBAND.length-1;0<=n;n--)if(r.y<=-this.LLBAND[n]){i=this.LL2MC[n];break}var o=this.convertor(t,i);return new yi(o.x,o.y)},convertor:function(t,e){if(!t||!e)return null;var i=e[0]+e[1]*Math.abs(t.x),n=Math.abs(t.y)/e[9],r=e[2]+e[3]*n+e[4]*n*n+e[5]*n*n*n+e[6]*n*n*n*n+e[7]*n*n*n*n*n+e[8]*n*n*n*n*n*n;return i*=t.x<0?-1:1,r*=t.y<0?-1:1,new yi(i,r)},toRadians:function(t){return Math.PI*t/180},toDegrees:function(t){return 180*t/Math.PI},getRange:function(t,e,i){return null!=e&&(t=Math.max(t,e)),null!=i&&(t=Math.min(t,i)),t},getLoop:function(t,e,i){for(;i<t;)t-=i-e;for(;t<e;)t+=i-e;return t}}),Gi=_({},Si,{code:"IDENTITY",project:function(t){return t.copy()},unproject:function(t){return t.copy()}},Ci),Vi=zi,Hi=Object.freeze({EPSG3857:zi,DEFAULT:Vi,EPSG4326:Ni,EPSG4490:Bi,BAIDU:Fi,IDENTITY:Gi,Common:Si}),Ui=function(t){return function(t){function e(){return u(this,e),v(this,t.apply(this,arguments))}return m(e,t),e.registerRenderer=function(t,e){var i=this.prototype,n=Object.getPrototypeOf(i);return i._rendererClasses&&i._rendererClasses!==n._rendererClasses||(i._rendererClasses=i._rendererClasses?Object.create(i._rendererClasses):{}),i._rendererClasses[t.toLowerCase()]=e,this},e.getRendererClass=function(t){var e=this.prototype;return e._rendererClasses?e._rendererClasses[t.toLowerCase()]:null},e}(t)},Wi="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function ji(t,e){return t(e={exports:{}},e.exports),e.exports}var Zi=ji(function(t){!function(o){function a(t){if(t){var e=this;t(function(t){e.resolve(t)},function(t){e.reject(t)})}}function s(e,t){if("function"==typeof e.y)try{var i=e.y.call(h,t);e.p.resolve(i)}catch(t){e.p.reject(t)}else e.p.resolve(t)}function l(e,t){if("function"==typeof e.n)try{var i=e.n.call(h,t);e.p.resolve(i)}catch(t){e.p.reject(t)}else e.p.reject(t)}var h,c="undefined",u=function(){function e(){for(;i.length-n;){try{i[n]()}catch(t){o.console&&o.console.error(t)}i[n++]=h,1024==n&&(i.splice(0,1024),n=0)}}var i=[],n=0,r=function(){if(typeof MutationObserver!==c){var t=document.createElement("div");return new MutationObserver(e).observe(t,{attributes:!0}),function(){t.setAttribute("a",0)}}return typeof setImmediate!==c?function(){setImmediate(e)}:function(){setTimeout(e,0)}}();return function(t){i.push(t),i.length-n==1&&r()}}();a.prototype={resolve:function(i){if(void 0===this.state){if(i===this)return this.reject(new TypeError("Attempt to resolve promise with self"));var n=this;if(i&&("function"==typeof i||"object"==typeof i))try{var e=!0,t=i.then;if("function"==typeof t)return void t.call(i,function(t){e&&(e=!1,n.resolve(t))},function(t){e&&(e=!1,n.reject(t))})}catch(t){return void(e&&this.reject(t))}this.state="fulfilled",this.v=i,n.c&&u(function(){for(var t=0,e=n.c.length;t<e;t++)s(n.c[t],i)})}},reject:function(i){if(void 0===this.state){this.state="rejected",this.v=i;var n=this.c;n?u(function(){for(var t=0,e=n.length;t<e;t++)l(n[t],i)}):!a.suppressUncaughtRejectionError&&o.console&&o.console.log("You upset Zousan. Please catch rejections: ",i,i?i.stack:null)}},then:function(t,e){var i=new a,n={y:t,n:e,p:i};if(void 0===this.state)this.c?this.c.push(n):this.c=[n];else{var r=this.state,o=this.v;u(function(){"fulfilled"===r?s(n,o):l(n,o)})}return i},catch:function(t){return this.then(null,t)},finally:function(t){return this.then(t,t)},timeout:function(t,n){n=n||"Timeout";var r=this;return new a(function(e,i){setTimeout(function(){i(Error(n))},t),r.then(function(t){e(t)},function(t){i(t)})})}},a.resolve=function(t){var e=new a;return e.resolve(t),e},a.reject=function(t){var e=new a;return e.reject(t),e},a.all=function(i){function t(t,e){t&&"function"==typeof t.then||(t=a.resolve(t)),t.then(function(t){n[e]=t,++r==i.length&&o.resolve(n)},function(t){o.reject(t)})}for(var n=[],r=0,o=new a,e=0;e<i.length;e++)t(i[e],e);return i.length||o.resolve(n),o},t.exports&&(t.exports=a),o.define&&o.define.amd&&o.define([],function(){return a}),(o.Zousan=a).soon=u}(Wi)}),Xi="undefined"!=typeof Promise?Promise:Zi,qi=function(i){function n(t){u(this,n);var e=v(this,i.call(this));return e.layer=t,e._painted=!1,e._drawTime=0,e.setToRedraw(),e}return m(n,i),n.prototype.render=function(t){var e=this;if(this.prepareRender(),this.getMap()&&this.layer.isVisible())if(this.resources||(this.resources=new Yi),this.checkResources){var i=this.checkResources();0<i.length?(this._loadingResource=!0,this.loadResources(i).then(function(){e._loadingResource=!1,e.layer&&(e.layer.fire("resourceload"),e.setToRedraw())})):this._tryToDraw(t)}else this._tryToDraw(t)},n.prototype.testIfNeedRedraw=function(){return!(this._loadingResource||!this.drawOnInteracting)&&(!!this._toRedraw||!!this.needToRedraw())},n.prototype.needToRedraw=function(){var t=this.getMap();return!!t.isInteracting()&&!(!t.getPitch()&&t.isMoving()&&!t.isZooming()&&!t.isRotating()&&!this.layer.options.forceRenderOnMoving)},n.prototype.onSkipDrawOnInteracting=function(){},n.prototype.isRenderComplete=function(){return!!this._renderComplete},n.prototype.mustRenderOnInteracting=function(){return!this._painted||this.checkResources&&0<this.checkResources().length},n.prototype.setToRedraw=function(){return this._toRedraw=!0,this},n.prototype.setCanvasUpdated=function(){return this._canvasUpdated=!0,this},n.prototype.isCanvasUpdated=function(){return!!this._canvasUpdated},n.prototype.remove=function(){this.onRemove(),delete this._loadingResource,delete this._southWest,delete this.canvas,delete this.context,delete this._extent2D,delete this.resources,delete this.layer},n.prototype.onRemove=function(){},n.prototype.onAdd=function(){},n.prototype.getMap=function(){return this.layer?this.layer.getMap():null},n.prototype.getCanvasImage=function(){var t=this.getMap();if(this._canvasUpdated=!1,this._renderZoom!==t.getZoom()||!this.canvas||!this._extent2D)return null;if(this.isBlank())return null;if(this.layer.isEmpty&&this.layer.isEmpty())return null;var e=t._pointToContainerPoint(this._southWest)._add(0,-t.height);return{image:this.canvas,layer:this.layer,point:e}},n.prototype.clear=function(){this.clearCanvas()},n.prototype.isBlank=function(){return!this._painted},n.prototype.show=function(){this.setToRedraw()},n.prototype.hide=function(){this.clear(),this.setToRedraw()},n.prototype.setZIndex=function(){this.setToRedraw()},n.prototype.hitDetect=function(t){if(!this.context||this.layer.isEmpty&&this.layer.isEmpty()||this.isBlank()||this._errorThrown)return!1;var e=this.getMap(),i=ae.retina?2:1,n=e.getSize();if(t.x<0||t.x>n.width*i||t.y<0||t.y>n.height*i)return!1;try{if(0<this.context.getImageData(i*t.x,i*t.y,1,1).data[3])return!0}catch(t){return this._errorThrown||(console&&console.warn("hit detect failed with tainted canvas, some geometries have external resources in another domain:\n",t),this._errorThrown=!0),!1}return!1},n.prototype.loadResources=function(t){this.resources||(this.resources=new Yi);var e=this.resources,i=[];if(H(t))for(var n={},r=t.length-1;0<=r;r--){var o=t[r];o&&o.length&&!n[o.join("-")]&&(n[o.join("-")]=1,e.isResourceLoaded(o,!0)||i.push(new Xi(this._promiseResource(o))))}return Xi.all(i)},n.prototype.prepareRender=function(){delete this._renderComplete;var t=this.getMap();this._renderZoom=t.getZoom(),this._extent2D=t._get2DExtent(),this._southWest=t._containerPointToPoint(new le(0,t.height))},n.prototype.createCanvas=function(){if(!this.canvas){var t=this.getMap(),e=t.getSize(),i=ae.retina?2:1,n=i*e.width,r=i*e.height;if(this.layer._canvas){var o=this.layer._canvas;o.width=n,o.height=r,o.style&&(o.style.width=e.width+"px",o.style.height=e.height+"px"),this.canvas=this.layer._canvas}else this.canvas=ni.createCanvas(n,r,t.CanvasClass);this.onCanvasCreate()}},n.prototype.onCanvasCreate=function(){},n.prototype.createContext=function(){if(!(this.gl&&this.gl.canvas===this.canvas||this.context)&&(this.context=this.canvas.getContext("2d"),this.layer.options.globalCompositeOperation&&(this.context.globalCompositeOperation=this.layer.options.globalCompositeOperation),ae.retina)){this.context.scale(2,2)}},n.prototype.resetCanvasTransform=function(){if(this.context){var t=ae.retina?2:1;this.context.setTransform(t,0,0,t,0,0)}},n.prototype.resizeCanvas=function(t){var e=this.canvas;if(e){var i=t||this.getMap().getSize(),n=ae.retina?2:1;e.width===n*i.width&&e.height===n*i.height||(e.height=n*i.height,e.width=n*i.width,ae.retina&&this.context&&this.context.scale(n,n),this.layer._canvas&&e.style&&(e.style.width=i.width+"px",e.style.height=i.height+"px"))}},n.prototype.clearCanvas=function(){this.context&&ni.clearRect(this.context,0,0,this.canvas.width,this.canvas.height)},n.prototype.prepareCanvas=function(){this.canvas?(this.clearCanvas(),this.resizeCanvas(),this.resetCanvasTransform()):(this.createCanvas(),this.createContext(),this.layer.fire("canvascreate",{context:this.context,gl:this.gl})),delete this._maskExtent;var t=this.layer.getMask();if(!t)return this.layer.fire("renderstart",{context:this.context,gl:this.gl}),null;var e=this._maskExtent=t._getPainter().get2DExtent();return e.intersects(this._extent2D),this.layer.fire("renderstart",{context:this.context,gl:this.gl}),e},n.prototype.clipCanvas=function(t){var e=this.layer.getMask();if(!e)return!1;var i=this._southWest,n=this.getMap();return this._southWest=n._containerPointToPoint(new le(0,n.height)),t.save(),ae.retina&&(t.save(),t.scale(2,2)),e._getPainter().paint(null,t),ae.retina&&t.restore(),t.clip(),this._southWest=i,!0},n.prototype.getViewExtent=function(){return{extent:this._extent2D,maskExtent:this._maskExtent,zoom:this._renderZoom,southWest:this._southWest}},n.prototype.completeRender=function(){this.getMap()&&(this._renderComplete=!0,this.layer.fire("renderend",{context:this.context,gl:this.gl}),this.setCanvasUpdated())},n.prototype.getEvents=function(){return{_zoomstart:this.onZoomStart,_zooming:this.onZooming,_zoomend:this.onZoomEnd,_resize:this.onResize,_movestart:this.onMoveStart,_moving:this.onMoving,_moveend:this.onMoveEnd,_dragrotatestart:this.onDragRotateStart,_dragrotating:this.onDragRotating,_dragrotateend:this.onDragRotateEnd,_spatialreferencechange:this.onSpatialReferenceChange}},n.prototype.onZoomStart=function(){},n.prototype.onZoomEnd=function(){this.setToRedraw()},n.prototype.onZooming=function(){},n.prototype.onMoveStart=function(){},n.prototype.onMoving=function(){},n.prototype.onMoveEnd=function(){this.setToRedraw()},n.prototype.onResize=function(){delete this._extent2D,this.resizeCanvas(),this.setToRedraw()},n.prototype.onDragRotateStart=function(){},n.prototype.onDragRotating=function(){},n.prototype.onDragRotateEnd=function(){this.setToRedraw()},n.prototype.onSpatialReferenceChange=function(){},n.prototype.getDrawTime=function(){return this._drawTime},n.prototype._tryToDraw=function(t){this._toRedraw=!1,!this.canvas&&this.layer.isEmpty&&this.layer.isEmpty()?this._renderComplete=!0:this._drawAndRecord(t)},n.prototype._drawAndRecord=function(t){if(this.getMap()){var e=this._painted;this._painted=!0;var i=y();this.draw(t),i=y()-i,this._drawTime=e?i:i/2,e&&this.layer.options.logDrawTime&&console.log(this.layer.getId(),"frameTimeStamp:",t,"drawTime:",this._drawTime)}},n.prototype._promiseResource=function(i){var n=this,r=this.resources,o=this.layer.options.crossOrigin;return function(e){if(r.isResourceLoaded(i,!0))e(i);else{var t=new Image;Y(o)||(t.crossOrigin=o),A(i[0])&&!C&&(i[1]&&(i[1]*=2),i[2]&&(i[2]*=2)),t.onload=function(){n._cacheResource(i,t),e(i)},t.onabort=function(t){console&&console.warn("image loading aborted: "+i[0]),t&&console&&console.warn(t),e(i)},t.onerror=function(t){t&&"undefined"!=typeof console&&console.warn(t),r.markErrorResource(i),e(i)},E(t,i)}}},n.prototype._cacheResource=function(t,e){if(this.layer&&this.resources){var i=t[1],n=t[2];if(this.layer.options.cacheSvgOnCanvas&&1===A(t[0])&&(ae.edge||ae.ie)){Y(i)&&(i=e.width||this.layer.options.defaultIconSize[0]),Y(n)&&(n=e.height||this.layer.options.defaultIconSize[1]);var r=ni.createCanvas(i,n);ni.image(r.getContext("2d"),e,0,0,i,n),e=r}this.resources.addResource(t,e)}},n}(ci),Yi=function(){function t(){u(this,t),this.resources={},this._errors={}}return t.prototype.addResource=function(t,e){this.resources[t[0]]={image:e,width:+t[1],height:+t[2]}},t.prototype.isResourceLoaded=function(t,e){if(!t)return!1;var i=this._getImgUrl(t);if(this._errors[i])return!0;var n=this.resources[i];return!!n&&!(e&&A(t[0])&&(+t[1]>n.width||+t[2]>n.height))},t.prototype.getImage=function(t){var e=this._getImgUrl(t);return!this.isResourceLoaded(t)||this._errors[e]?null:this.resources[e].image},t.prototype.markErrorResource=function(t){this._errors[this._getImgUrl(t)]=1},t.prototype.merge=function(t){if(!t)return this;for(var e in t.resources){var i=t.resources[e];this.addResource([e,i.width,i.height],i.image)}return this},t.prototype.forEach=function(t){if(!this.resources)return this;for(var e in this.resources)M(this.resources,e)&&t(e,this.resources[e]);return this},t.prototype._getImgUrl=function(t){return Array.isArray(t)?t[0]:t},t}(),Ji=function(r){function o(t,e){u(this,o);var i=void 0;e&&(i=e.canvas,delete e.canvas);var n=v(this,r.call(this,e));return i&&(n._canvas=i),n.setId(t),e&&n.setZIndex(e.zIndex),n}return m(o,r),o.prototype.load=function(){if(!this.getMap())return this;if(this.onLoad()){this._initRenderer();var t=this.getZIndex();Y(t)||(this._renderer.setZIndex(t),this.isCanvasRender()||this._renderer.render())}return this},o.prototype.getId=function(){return this._id},o.prototype.setId=function(t){var e=this._id;return Y(t)||(t+=""),this._id=t,this.fire("idchange",{old:e,new:t}),this},o.prototype.addTo=function(t){return t.addLayer(this),this},o.prototype.setZIndex=function(t){return this._zIndex=t,this.map&&this.map._sortLayersByZIndex(),this._renderer&&this._renderer.setZIndex(t),this},o.prototype.getZIndex=function(){return this._zIndex||0},o.prototype.getMinZoom=function(){var t=this.getMap(),e=this.options.minZoom;return t?Math.max(t.getMinZoom(),e||0):e},o.prototype.getMaxZoom=function(){var t=this.getMap(),e=this.options.maxZoom;return t?Math.min(t.getMaxZoom(),Y(e)?1/0:e):e},o.prototype.getOpacity=function(){return this.options.opacity},o.prototype.setOpacity=function(t){return this.config("opacity",t),this},o.prototype.isCanvasRender=function(){var t=this._getRenderer();return t&&t instanceof qi},o.prototype.getMap=function(){return this.map?this.map:null},o.prototype.getProjection=function(){var t=this.getMap();return t?t.getProjection():null},o.prototype.bringToFront=function(){var t=this._getLayerList();if(!t.length)return this;var e=t[t.length-1];if(1===t.length||e===this)return this;var i=e.getZIndex();return this.setZIndex(i+1),this},o.prototype.bringToBack=function(){var t=this._getLayerList();if(!t.length)return this;var e=t[0];if(1===t.length||e===this)return this;var i=e.getZIndex();return this.setZIndex(i-1),this},o.prototype.show=function(){var t=this;if(!this.options.visible){this.options.visible=!0;var e=this.getRenderer();e&&e.show();var i=this.getMap();e&&i?i.once("renderend",function(){t.fire("show")}):this.fire("show")}return this},o.prototype.hide=function(){var t=this;if(this.options.visible){this.options.visible=!1;var e=this.getRenderer();e&&e.hide();var i=this.getMap();e&&i?i.once("renderend",function(){t.fire("hide")}):this.fire("hide")}return this},o.prototype.isVisible=function(){if(w(this.options.opacity)&&this.options.opacity<=0)return!1;var t=this.getMap();if(t){var e=t.getZoom();if(!Y(this.options.maxZoom)&&this.options.maxZoom<e||!Y(this.options.minZoom)&&this.options.minZoom>e)return!1}return Y(this.options.visible)&&(this.options.visible=!0),this.options.visible},o.prototype.remove=function(){return this.map&&this.map.removeLayer(this),this},o.prototype.getMask=function(){return this._mask},o.prototype.setMask=function(t){if(!("Point"===t.type&&t._isVectorMarker()||"Polygon"===t.type))throw new Error("Mask for a layer must be a marker with vector marker symbol, a Polygon or a MultiPolygon.");if("Point"===t.type?t.updateSymbol({markerLineColor:"rgba(0, 0, 0, 0)",markerFillOpacity:0}):t.setSymbol({lineColor:"rgba(0, 0, 0, 0)",polygonOpacity:0}),t._bindLayer(this),this._mask=t,!this.getMap()||this.getMap().isZooming())return this;var e=this._getRenderer();return e&&e.setToRedraw&&this._getRenderer().setToRedraw(),this},o.prototype.removeMask=function(){if(delete this._mask,!this.getMap()||this.getMap().isZooming())return this;var t=this._getRenderer();return t&&t.setToRedraw&&this._getRenderer().setToRedraw(),this},o.prototype.onLoad=function(){return!0},o.prototype.isLoaded=function(){return!!this._loaded},o.prototype.getRenderer=function(){return this._getRenderer()},o.prototype.onConfig=function(t){if(w(t.opacity)){var e=this.getRenderer();e&&e.setToRedraw()}},o.prototype.onAdd=function(){},o.prototype.onRemove=function(){},o.prototype._bindMap=function(t,e){t&&(this.map=t,Y(e)||this.setZIndex(e),this._switchEvents("on",this),this.onAdd(),this.fire("add"))},o.prototype._initRenderer=function(){var t=this.options.renderer;if(this.constructor.getRendererClass){var e=this.constructor.getRendererClass(t);if(!e)throw new Error("Invalid renderer for Layer("+this.getId()+"):"+t);this._renderer=new e(this),(this._renderer.layer=this)._renderer.setZIndex(this.getZIndex()),this._switchEvents("on",this._renderer),this._renderer.onAdd&&this._renderer.onAdd(),this.fire("renderercreate",{renderer:this._renderer})}},o.prototype._doRemove=function(){this._loaded=!1,this.onRemove(),this._switchEvents("off",this),this._renderer&&(this._switchEvents("off",this._renderer),this._renderer.remove(),delete this._renderer),delete this._mask,delete this.map},o.prototype._switchEvents=function(t,e){e&&e.getEvents&&this.getMap()[t](e.getEvents(),e)},o.prototype._getRenderer=function(){return this._renderer},o.prototype._getLayerList=function(){return this.map?this.map._layers:[]},o.prototype._getMask2DExtent=function(){if(!this._mask||!this.getMap())return null;var t=this._mask._getPainter();return t?t.get2DExtent():null},o}(di(li(Ui(ci))));Ji.mergeOptions({attribution:null,minZoom:null,maxZoom:null,visible:!0,opacity:1,globalCompositeOperation:null,renderer:"canvas",debugOutline:"#0f0",cssFilter:null,forceRenderOnMoving:!1,forceRenderOnZooming:!1,forceRenderOnRotating:!1});var Ki=Ji.prototype.fire;Ji.prototype.fire=function(t,e){return"layerload"===t&&(this._loaded=!0),this.map&&(e||(e={}),e.type=t,(e.target=this).map._onLayerEvent(e)),Ki.apply(this,arguments)};var Qi={"EPSG:3857":{resolutions:function(){for(var t=[],e=12756274*Math.PI,i=0;i<21;i++)t[i]=e/(256*Math.pow(2,i));return t}(),fullExtent:{top:6378137*Math.PI,left:-6378137*Math.PI,bottom:-6378137*Math.PI,right:6378137*Math.PI}},"EPSG:4326":{fullExtent:{top:90,left:-180,bottom:-90,right:180},resolutions:function(){for(var t=[],e=0;e<20;e++)t[e]=180/(128*Math.pow(2,e));return t}()},BAIDU:{resolutions:function(){for(var t=Math.pow(2,18),e=[],i=0;i<20;i++)e[i]=t,t*=.5;return e[0]=null,e[1]=null,e[2]=null,e}(),fullExtent:{top:33554432,left:-33554432,bottom:-33554432,right:33554432}},IDENTITY:{resolutions:function(){for(var t=Math.pow(2,8),e=[],i=0;i<18;i++)e[i]=t,t*=.5;return e}(),fullExtent:{top:2e5,left:-2e5,bottom:-2e5,right:2e5}}};Qi["EPSG:4490"]=Qi["EPSG:4326"];var $i=function(){function a(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};u(this,a),this.options=t,this._initSpatialRef()}return a.getProjectionInstance=function(t){if(!t)return null;if(x(t))return t;for(var e in t=(t+"").toLowerCase(),Hi)if(M(Hi,e)){var i=Hi[e].code;if(i&&i.toLowerCase()===t)return Hi[e]}return null},a.equals=function(t,e){if(!t&&!e)return!0;if(!t||!e)return!1;if(t.projection!==e.projection)return!1;var i=t.fullExtent,n=e.fullExtent;if(i&&n&&(i.top!==n.top||i.bottom!==n.bottom||i.left!==n.left||i.right!==n.right))return!1;var r=t.resolutions,o=e.resolutions;if(r&&o){if(r.length!==o.length)return!1;for(var a=0;a<r.length;a++)if(r[a]!==o[a])return!1}return!0},a.prototype._initSpatialRef=function(){var t=this.options.projection;if(!(t=t?a.getProjectionInstance(t):Vi))throw new Error("must provide a valid projection in map's spatial reference.");(t=_({},Si,t)).measureLength||_(t,Oi.DEFAULT),this._projection=t;var e=void 0,i=this.options.resolutions;if(!i&&(t.code&&(e=Qi[t.code])&&(i=e.resolutions),!i))throw new Error("must provide valid resolutions in map's spatial reference.");this._resolutions=i;var n=this.options.fullExtent;if(!n&&(t.code&&(e=Qi[t.code])&&(n=e.fullExtent),!n))throw new Error("must provide a valid fullExtent in map's spatial reference.");if(Y(n.left)?(this._fullExtent=new wi(n),n.left=n.xmin,n.right=n.xmax,n.top=n.ymax,n.bottom=n.ymin):this._fullExtent=new wi(new yi(n.left,n.top),new yi(n.right,n.bottom)),Y(n.top)||Y(n.bottom)||Y(n.left)||Y(n.right))throw new Error("must provide valid top/bottom/left/right in fullExtent.");_(this._fullExtent,n);var r=(this._projection.fullExtent=n).right>=n.left?1:-1,o=n.top>=n.bottom?-1:1;this._transformation=new Mi([r,o,0,0])},a.prototype.getResolutions=function(){return this._resolutions||[]},a.prototype.getResolution=function(t){var e=0|t;e<0?e=0:e>this._resolutions.length-1&&(e=this._resolutions.length-1);var i=this._resolutions[e];return r(t)||e===this._resolutions.length-1?i:i+(this._resolutions[e+1]-i)*(t-e)},a.prototype.getProjection=function(){return this._projection},a.prototype.getFullExtent=function(){return this._fullExtent},a.prototype.getTransformation=function(){return this._transformation},a.prototype.getMinZoom=function(){for(var t=0;t<this._resolutions.length;t++)if(!Y(this._resolutions[t]))return t;return 0},a.prototype.getMaxZoom=function(){for(var t=this._resolutions.length-1;0<=t;t--)if(!Y(this._resolutions[t]))return t;return this._resolutions.length-1},a.prototype.getZoomDirection=function(){return N(this._resolutions[this.getMinZoom()]-this._resolutions[this.getMaxZoom()])},a}(),tn={maxVisualPitch:60,maxPitch:80,centerCross:!1,zoomInCenter:!1,zoomAnimation:!C,zoomAnimationDuration:330,panAnimation:!C,panAnimationDuration:600,zoomable:!0,enableInfoWindow:!0,hitDetect:!ae.mobile,hitDetectLimit:5,fpsOnInteracting:25,layerCanvasLimitOnInteracting:-1,maxZoom:null,minZoom:null,maxExtent:null,checkSize:!0,renderer:"canvas"},en=function(l){function h(t,e){if(u(this,h),!e)throw new Error("Invalid options when creating map.");if(!e.center)throw new Error("Invalid center when creating map.");var i=_({},e),n=i.zoom;delete i.zoom;var r=new yi(i.center);delete i.center;var o=i.baseLayer;delete i.baseLayer;var a=i.layers;delete i.layers;var s=v(this,l.call(this,i));return Object.defineProperty(s,"id",{value:L(),writable:!1}),s._loaded=!1,s._initContainer(t),s._panels={},s._baseLayer=null,s._layers=[],s._zoomLevel=n,s._center=r,s.setSpatialReference(i.spatialReference||i.view),s._mapViewPoint=new le(0,0),s._initRenderer(),s._updateMapSize(s._getContainerDomSize()),o&&s.setBaseLayer(o),a&&s.addLayer(a),s._Load(),s}return m(h,l),h.addOnLoadHook=function(t){var e=Array.prototype.slice.call(arguments,1),i="function"==typeof t?t:function(){this[t].apply(this,e)};return this.prototype._onLoadHooks=this.prototype._onLoadHooks||[],this.prototype._onLoadHooks.push(i),this},h.prototype.isLoaded=function(){return!!this._loaded},h.prototype.getContainer=function(){return this._containerDOM},h.prototype.getSpatialReference=function(){return this._spatialReference},h.prototype.setSpatialReference=function(t){var e=this.options.spatialReference;if(this._loaded&&$i.equals(e,t))return this;if(t=_({},t),this._center=this.getCenter(),this.options.spatialReference=t,this._spatialReference=new $i(t),this.options.spatialReference&&b(this.options.spatialReference.projection)){var i=this._spatialReference.getProjection();this.options.spatialReference.projection=i.code}return this._resetMapStatus(),this._fireEvent("spatialreferencechange",{old:e,new:_({},this.options.spatialReference)}),this},h.prototype.onConfig=function(t){var e=t.spatialReference||t.view;return Y(e)||this.setSpatialReference(e),this},h.prototype.getProjection=function(){return this._spatialReference?this._spatialReference.getProjection():null},h.prototype.getFullExtent=function(){return this._spatialReference?this._spatialReference.getFullExtent():null},h.prototype.setCursor=function(t){return delete this._cursor,this._trySetCursor(t),this._cursor=t,this},h.prototype.resetCursor=function(){return this.setCursor(null)},h.prototype.getCenter=function(){return this._loaded&&this._prjCenter?this.getProjection().unproject(this._prjCenter):this._center},h.prototype.setCenter=function(t){if(!t)return this;if(t=new yi(t),!this._verifyExtent(t))return this;if(!this._loaded)return this._center=t,this;this.onMoveStart();var e=this.getProjection().project(t);return this._setPrjCenter(e),this.onMoveEnd(this._parseEventFromCoord(this.getCenter())),this},h.prototype.getSize=function(){return Y(this.width)||Y(this.height)?this._getContainerDomSize():new he(this.width,this.height)},h.prototype.getContainerExtent=function(){var t=this.height,e=this.getPitch(),i=this.options.maxVisualPitch;return i&&i<e&&(t=this._getVisualHeight(i)),new bi(0,this.height-t,this.width,this.height)},h.prototype._getVisualHeight=function(t){var e=this.getPitch(),i=this.height/2*Math.tan(t*Math.PI/180);return this.height/2+i*Math.tan((90-e)*Math.PI/180)},h.prototype.getExtent=function(){return this._pointToExtent(this._get2DExtent())},h.prototype.getProjExtent=function(){var t=this._get2DExtent();return new wi(this._pointToPrj(t.getMin()),this._pointToPrj(t.getMax()))},h.prototype.getPrjExtent=function(){return this.getProjExtent()},h.prototype.getMaxExtent=function(){return this.options.maxExtent?new wi(this.options.maxExtent,this.getProjection()):null},h.prototype.setMaxExtent=function(t){if(t){var e=new wi(t,this.getProjection());this.options.maxExtent=e;var i=this.getCenter();this._verifyExtent(i)||this.panTo(e.getCenter())}else delete this.options.maxExtent;return this},h.prototype.getZoom=function(){return this._zoomLevel},h.prototype.getZoomForScale=function(t,e,i){var n=this.getZoom();if(Y(e)&&(e=n),1===t&&e===n)return n;var r=this._getResolution(e)/t,o=this.getZoomFromRes(r);if(i)return o;return this.getSpatialReference().getZoomDirection()<0?Math.ceil(o-1e-6):Math.floor(o+1e-6)},h.prototype.getZoomFromRes=function(t){var e=this._getResolutions(),i=this._getResolution(this.getMinZoom()),n=this._getResolution(this.getMaxZoom());if(i<=n){if(t<=i)return this.getMinZoom();if(n<=t)return this.getMaxZoom()}else{if(i<=t)return this.getMinZoom();if(t<=n)return this.getMaxZoom()}for(var r=e.length,o=0;o<r-1;o++)if(e[o]){var a=e[o+1]-e[o],s=t-e[o];if(N(a)===N(s)&&Math.abs(a)>=Math.abs(s))return o+s/a}return r-1},h.prototype.setZoom=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{animation:!0};return isNaN(t)||Y(t)||(this._loaded&&this.options.zoomAnimation&&e.animation?this._zoomAnimation(t):this._zoom(t)),this},h.prototype.getMaxZoom=function(){return Y(this.options.maxZoom)?this.getMaxNativeZoom():this.options.maxZoom},h.prototype.setMaxZoom=function(t){var e=this.getMaxNativeZoom();return e<t&&(t=e),null!==t&&t<this._zoomLevel&&this.setZoom(t),this.options.maxZoom=t,this},h.prototype.getMinZoom=function(){return Y(this.options.minZoom)?this._spatialReference.getMinZoom():this.options.minZoom},h.prototype.setMinZoom=function(t){if(null!==t){var e=this._spatialReference.getMinZoom();t<e&&(t=e),t>this._zoomLevel&&this.setZoom(t)}return this.options.minZoom=t,this},h.prototype.getMaxNativeZoom=function(){var t=this.getSpatialReference();return t?t.getMaxZoom():null},h.prototype.getGLZoom=function(){return this.getMaxNativeZoom()/2},h.prototype.getGLScale=function(t){return Y(t)&&(t=this.getZoom()),this.getScale(t)/this.getScale(this.getGLZoom())},h.prototype.zoomIn=function(){return this.setZoom(this.getZoom()+1)},h.prototype.zoomOut=function(){return this.setZoom(this.getZoom()-1)},h.prototype.isZooming=function(){return!!this._zooming},h.prototype.isInteracting=function(){return this.isZooming()||this.isMoving()||this.isRotating()},h.prototype.setCenterAndZoom=function(t,e){return Y(e)||this._zoomLevel===e?this.setCenter(t):(this.setCenter(t),this.setZoom(e,{animation:!1})),this},h.prototype.getFitZoom=function(t){var e=this;if(!(t&&t instanceof wi))return this._zoomLevel;if(t.xmin===t.xmax&&t.ymin===t.ymax)return this.getMaxZoom();var i=this.getSize(),n=t.convertTo(function(t){return e.coordToContainerPoint(t)}),r=n.getWidth(),o=n.getHeight(),a=i.width/r,s=i.height/o,l=this.getSpatialReference().getZoomDirection()<0?Math.max(a,s):Math.min(a,s);return this.getZoomForScale(l)},h.prototype.getView=function(){return{center:this.getCenter().toArray(),zoom:this.getZoom(),pitch:this.getPitch(),bearing:this.getBearing()}},h.prototype.setView=function(t){return t&&(t.center&&this.setCenter(t.center),t.zoom&&this.setZoom(t.zoom,{animation:!1}),t.pitch&&this.setPitch(t.pitch),t.bearing&&this.setBearing(t.bearing)),this},h.prototype.getResolution=function(t){return this._getResolution(t)},h.prototype.getScale=function(t){var e=Y(t)?this.getZoom():t,i=this._getResolution(this.getMaxNativeZoom());return this._getResolution(e)/i},h.prototype.fitExtent=function(t,e){if(!t)return this;t=new wi(t,this.getProjection());var i=this.getFitZoom(t)+(e||0),n=t.getCenter();return this.setCenterAndZoom(n,i)},h.prototype.getBaseLayer=function(){return this._baseLayer},h.prototype.setBaseLayer=function(t){var e=!1;if(this._baseLayer&&(e=!0,this._fireEvent("baselayerchangestart"),this._baseLayer.remove()),!t)return delete this._baseLayer,this._fireEvent("baselayerchangeend"),this._fireEvent("setbaselayer"),this;return(this._baseLayer=t)._bindMap(this,-1),this._baseLayer.on("layerload",function(){this._fireEvent("baselayerload"),e&&(e=!1,this._fireEvent("baselayerchangeend"))},this),this._loaded&&this._baseLayer.load(),this._fireEvent("setbaselayer"),this},h.prototype.removeBaseLayer=function(){return this._baseLayer&&(this._baseLayer.remove(),delete this._baseLayer,this._fireEvent("baselayerremove")),this},h.prototype.getLayers=function(e){return this._getLayers(function(t){return!(t===this._baseLayer||0<=t.getId().indexOf(d))&&(!e||e(t))})},h.prototype.getLayer=function(t){if(!t)return null;var e=this._layerCache?this._layerCache[t]:null;if(e)return e;var i=this.getBaseLayer();return i&&i.getId()===t?i:null},h.prototype.addLayer=function(t){if(!t)return this;if(!Array.isArray(t))return t=Array.prototype.slice.call(arguments,0),this.addLayer(t);this._layerCache||(this._layerCache={});for(var e=this._layers,i=0,n=t.length;i<n;i++){var r=t[i],o=r.getId();if(Y(o))throw new Error("Invalid id for the layer: "+o);if(r.getMap()!==this){if(this._layerCache[o])throw new Error("Duplicate layer id in the map: "+o);(this._layerCache[o]=r)._bindMap(this),e.push(r),this._loaded&&r.load()}}return this._sortLayersByZIndex(),this._fireEvent("addlayer",{layers:t}),this},h.prototype.removeLayer=function(t){if(!t)return this;if(!Array.isArray(t))return this.removeLayer([t]);for(var e=[],i=0,n=t.length;i<n;i++){var r=t[i];if(r instanceof Ji||(r=this.getLayer(r)),r){var o=r.getMap();if(o&&o===this){e.push(r),this._removeLayer(r,this._layers),this._loaded&&r._doRemove();var a=r.getId();this._layerCache&&delete this._layerCache[a]}}}return 0<e.length&&this.once("frameend",function(){e.forEach(function(t){t.fire("remove")})}),this._fireEvent("removelayer",{layers:t}),this},h.prototype.sortLayers=function(t){if(!t||!Array.isArray(t))return this;for(var e=[],i=Number.MAX_VALUE,n=0,r=t.length;n<r;n++){var o=t[n];if(S(t[n])&&(o=this.getLayer(o)),!(o instanceof Ji&&o.getMap()&&o.getMap()===this))throw new Error("It must be a layer added to this map to order.");o.getZIndex()<i&&(i=o.getZIndex()),e.push(o)}for(var a=0,s=e.length;a<s;a++)e[a].setZIndex(i+a);return this},h.prototype.toDataURL=function(t){t||(t={});var e=t.mimeType;e||(e="image/png");var i=t.save,n=this._getRenderer();if(n&&n.toDataURL){var r=t.fileName;r||(r="export");var o=n.toDataURL(e);if(i&&o){var a=void 0;if("undefined"!=typeof Blob&&"undefined"!=typeof atob){var s=K(o.replace(/^data:image\/(png|jpeg|jpg);base64,/,""),e);a=URL.createObjectURL(s)}else a=o;var l=document.createElement("a");l.download=r,l.href=a,document.body.appendChild(l),l.click(),document.body.removeChild(l)}return o}return null},h.prototype.coordinateToPoint=function(t,e){var i=this.getProjection().project(t);return this._prjToPoint(i,e)},h.prototype.coordToPoint=function(t,e){return this.coordinateToPoint(t,e)},h.prototype.pointToCoordinate=function(t,e){var i=this._pointToPrj(t,e);return this.getProjection().unproject(i)},h.prototype.pointToCoord=function(t,e){return this.pointToCoordinate(t,e)},h.prototype.coordinateToViewPoint=function(t){return this._prjToViewPoint(this.getProjection().project(t))},h.prototype.coordToViewPoint=function(t){return this.coordinateToViewPoint(t)},h.prototype.viewPointToCoordinate=function(t){return this.getProjection().unproject(this._viewPointToPrj(t))},h.prototype.viewPointToCoord=function(t){return this.viewPointToCoordinate(t)},h.prototype.coordinateToContainerPoint=function(t,e){var i=this.getProjection().project(t);return this._prjToContainerPoint(i,e)},h.prototype.coordToContainerPoint=function(t,e){return this.coordinateToContainerPoint(t,e)},h.prototype.containerPointToCoordinate=function(t){var e=this._containerPointToPrj(t);return this.getProjection().unproject(e)},h.prototype.containerPointToCoord=function(t){return this.containerPointToCoordinate(t)},h.prototype.containerPointToViewPoint=function(t){return t.sub(this.getViewPoint())},h.prototype.viewPointToContainerPoint=function(t){return t.add(this.getViewPoint())},h.prototype.containerToExtent=function(t){var e=new bi(this._containerPointToPoint(t.getMin()),this._containerPointToPoint(t.getMax()));return this._pointToExtent(e)},h.prototype.checkSize=function(){var t=y()-this._initTime<1500&&0===this.width||0===this.height,e=this._getContainerDomSize(),i=this.height,n=this.width;if(e.width===n&&e.height===i)return this;var r=this.getCenter();this._updateMapSize(e);var o=new le((n-e.width)/2,(i-e.height)/2);this._offsetCenterByPixel(o),this._mapViewCoord=this._getPrjCenter();var a=0===e.width||0===e.height||0===n||0===i;return(t||a)&&(this._noEvent=!0,this.setCenter(r),delete this._noEvent),this._fireEvent("resize"),this},h.prototype.distanceToSize=function(t,e,i){return this.distanceToPixel(t,e,i)},h.prototype.distanceToPixel=function(t,e,i){var n=this.getProjection();if(!n)return null;var r=this.getScale()/this.getScale(i),o=this.getCenter(),a=n.locate(o,t,e),s=this.coordToContainerPoint(o),l=this.coordToContainerPoint(a);return l._sub(s)._multi(r)._abs(),new he(l.x,l.y)},h.prototype.distanceToPoint=function(t,e,i){var n=this.getProjection();if(!n)return null;var r=this.getCenter(),o=n.locate(r,t,e),a=this.coordToPoint(r,i),s=this.coordToPoint(o,i);return s._sub(a)._abs(),s},h.prototype.pixelToDistance=function(t,e){var i=this.getProjection();if(!i)return null;var n=this.getFullExtent(),r=n.top>n.bottom?-1:1,o=new le(this.width/2+t,this.height/2+r*e),a=this.containerPointToCoord(o);return i.measureLength(this.getCenter(),a)},h.prototype.locate=function(t,e,i){return this.getProjection()._locate(new yi(t),e,i)},h.prototype.locateByPoint=function(t,e,i){var n=this.coordToContainerPoint(t);return this.containerPointToCoord(n._add(e,i))},h.prototype.getMainPanel=function(){return this._getRenderer().getMainPanel()},h.prototype.getPanels=function(){return this._panels},h.prototype.remove=function(){if(this.isRemoved())return this;this._fireEvent("removestart"),this._removeDomEvents(),this._clearHandlers(),this.removeBaseLayer();for(var t=this.getLayers(),e=0;e<t.length;e++)t[e].remove();return this._getRenderer()&&this._getRenderer().remove(),this._containerDOM.innerHTML&&(this._containerDOM.innerHTML=""),delete this._panels,delete this._containerDOM,delete this.renderer,this._fireEvent("removeend"),this._clearAllListeners(),this},h.prototype.isRemoved=function(){return!this._containerDOM},h.prototype.isMoving=function(){return!!this._moving},h.prototype.onMoveStart=function(t){this._originCenter=this.getCenter(),this._moving=!0,this._trySetCursor("move"),this._fireEvent("movestart",this._parseEvent(t?t.domEvent:null,"movestart"))},h.prototype.onMoving=function(t){this._fireEvent("moving",this._parseEvent(t?t.domEvent:null,"moving"))},h.prototype.onMoveEnd=function(t){if(this._moving=!1,this._trySetCursor("default"),this._fireEvent("moveend",t&&t.domEvent?this._parseEvent(t.domEvent,"moveend"):t),!this._verifyExtent(this.getCenter())){var e=this._originCenter;this._verifyExtent(e)||(e=this.getMaxExtent().getCenter()),this.panTo(e)}},h.prototype.onDragRotateStart=function(t){this._dragRotating=!0,this._fireEvent("dragrotatestart",this._parseEvent(t?t.domEvent:null,"dragrotatestart"))},h.prototype.onDragRotating=function(t){this._fireEvent("dragrotating",this._parseEvent(t?t.domEvent:null,"dragrotating"))},h.prototype.onDragRotateEnd=function(t){this._dragRotating=!1,this._fireEvent("dragrotateend",this._parseEvent(t?t.domEvent:null,"dragrotateend"))},h.prototype.isDragRotating=function(){return!!this._dragRotating},h.prototype.getRenderer=function(){return this._getRenderer()},h.prototype._initContainer=function(t){if(S(t)){if(this._containerDOM=document.getElementById(t),!this._containerDOM)throw new Error("Invalid container when creating map: '"+t+"'")}else this._containerDOM=t,C&&(this.CanvasClass=this._containerDOM.constructor);if(this._containerDOM.childNodes&&0<this._containerDOM.childNodes.length&&"mapcan-wrapper"===this._containerDOM.childNodes[0].className)throw new Error("Container is already loaded with another map instance, use map.remove() to clear it.")},h.prototype._trySetCursor=function(t){return this._cursor||this._priorityCursor||(t||(t="default"),this._setCursorToPanel(t)),this},h.prototype._setPriorityCursor=function(t){if(t)this._priorityCursor=t,this._setCursorToPanel(t);else{var e=!1;this._priorityCursor&&(e=!0),delete this._priorityCursor,e&&this.setCursor(this._cursor)}return this},h.prototype._setCursorToPanel=function(t){var e=this.getMainPanel();e&&e.style&&e.style.cursor!==t&&(e.style.cursor=t)},h.prototype._get2DExtent=function(e){var i=this;return this.getContainerExtent().convertTo(function(t){return i._containerPointToPoint(t,e)})},h.prototype._pointToExtent=function(t){var e=t.getMin(),i=t.getMax(),n=this.getFullExtent(),r=!n||n.left<=n.right?[e.x,i.x]:[i.x,e.x],o=r[0],a=r[1],s=!n||n.top>n.bottom?[i.y,e.y]:[e.y,i.y],l=s[1],h=new yi(o,s[0]),c=new yi(a,l);return new wi(this.pointToCoord(h),this.pointToCoord(c),this.getProjection())},h.prototype._removeLayer=function(t,e){if(t&&e){var i=e.indexOf(t);-1<i&&e.splice(i,1)}},h.prototype._sortLayersByZIndex=function(){if(this._layers){for(var t=0,e=this._layers.length;t<e;t++)this._layers[t]._order=t;this._layers.sort(function(t,e){var i=t.getZIndex()-e.getZIndex();return 0===i?t._order-e._order:i})}},h.prototype._fireEvent=function(t,e){this._noEvent||(this.fire("_"+t,e),this.fire(t,e))},h.prototype._Load=function(){this._resetMapStatus(),this.options.pitch&&(this.setPitch(this.options.pitch),delete this.options.pitch),this.options.bearing&&(this.setBearing(this.options.bearing),delete this.options.bearing),this._loadAllLayers(),this._getRenderer().onLoad(),this._loaded=!0,this._callOnLoadHooks(),this._initTime=y()},h.prototype._initRenderer=function(){var t=this.options.renderer,e=h.getRendererClass(t);this._renderer=new e(this),this._renderer.load()},h.prototype._getRenderer=function(){return this._renderer},h.prototype._loadAllLayers=function(){this._baseLayer&&this._baseLayer.load(),this._eachLayer(function(t){t&&t.load()},this.getLayers())},h.prototype._getLayers=function(t){for(var e=this._baseLayer?[this._baseLayer].concat(this._layers):this._layers,i=[],n=0;n<e.length;n++)t&&!t.call(this,e[n])||i.push(e[n]);return i},h.prototype._eachLayer=function(t){if(!(arguments.length<2)){var e=Array.prototype.slice.call(arguments,1);e&&!Array.isArray(e)&&(e=[e]);for(var i=[],n=0,r=e.length;n<r;n++)i=i.concat(e[n]);for(var o=0,a=i.length;o<a;o++)t.call(t,i[o])}},h.prototype._onLayerEvent=function(t){t&&"idchange"===t.type&&(delete this._layerCache[t.old],this._layerCache[t.new]=t.target)},h.prototype._resetMapStatus=function(){var t=this.getMaxZoom(),e=this.getMinZoom(),i=this._spatialReference.getMaxZoom(),n=this._spatialReference.getMinZoom();(Y(t)||-1===t||i<t)&&this.setMaxZoom(i),(Y(e)||-1===e||e<n)&&this.setMinZoom(n),(t=this.getMaxZoom())<(e=this.getMinZoom())&&this.setMaxZoom(e),(Y(this._zoomLevel)||this._zoomLevel>t)&&(this._zoomLevel=t),this._zoomLevel<e&&(this._zoomLevel=e),delete this._prjCenter;var r=this.getProjection();this._prjCenter=r.project(this._center),this._calcMatrices();var o=this._getRenderer();o&&o.resetContainer()},h.prototype._getContainerDomSize=function(){if(!this._containerDOM)return null;var t=this._containerDOM,e=void 0,i=void 0;if(Y(t.width)||Y(t.height)){if(Y(t.clientWidth)||Y(t.clientHeight))throw new Error("can not get size of container");e=parseInt(t.clientWidth,0),i=parseInt(t.clientHeight,0)}else e=t.width,i=t.height,ae.retina&&t.layer&&(e/=2,i/=2);return new he(e,i)},h.prototype._updateMapSize=function(t){return this.width=t.width,this.height=t.height,this._getRenderer().updateMapSize(t),this._calcMatrices(),this},h.prototype._getPrjCenter=function(){return this._prjCenter},h.prototype._setPrjCenter=function(t){this._prjCenter=t,this.isInteracting()&&!this.isMoving()&&(this._mapViewCoord=t),this._calcMatrices()},h.prototype._setPrjCoordAtContainerPoint=function(t,e){if(e.x===this.width/2&&e.y===this.height/2)return this;var i=this._containerPointToPoint(e)._sub(this._prjToPoint(this._getPrjCenter())),n=this._pointToPrj(this._prjToPoint(t).sub(i));return this._setPrjCenter(n),this},h.prototype._verifyExtent=function(t){if(!t)return!1;var e=this.getMaxExtent();return!e||e.contains(t)},h.prototype._offsetCenterByPixel=function(t){var e=new le(this.width/2-t.x,this.height/2-t.y),i=this._containerPointToPrj(e);return this._setPrjCenter(i),i},h.prototype.offsetPlatform=function(t){return t?(this._getRenderer().offsetPlatform(t),this._mapViewCoord=this._getPrjCenter(),this._mapViewPoint=this._mapViewPoint.add(t),this):this._mapViewPoint},h.prototype.getViewPoint=function(){var t=this._getViewPointFrameOffset(),e=this.offsetPlatform();return t&&(e=e.add(t)),e},h.prototype._getViewPointFrameOffset=function(){if(this.isZooming())return null;var t=this._getPrjCenter();return this._mapViewCoord&&!this._mapViewCoord.equals(t)?this._prjToContainerPoint(this._mapViewCoord).sub(this._prjToContainerPoint(t)):null},h.prototype._resetMapViewPoint=function(){this._mapViewPoint=new le(0,0),this._mapViewCoord=this._getPrjCenter()},h.prototype._getResolution=function(t){return Y(t)&&(t=this.getZoom()),this._spatialReference.getResolution(t)},h.prototype._getResolutions=function(){return this._spatialReference.getResolutions()},h.prototype._prjToPoint=function(t,e){return e=Y(e)?this.getZoom():e,this._spatialReference.getTransformation().transform(t,this._getResolution(e))},h.prototype._pointToPrj=function(t,e){return e=Y(e)?this.getZoom():e,this._spatialReference.getTransformation().untransform(t,this._getResolution(e))},h.prototype._pointToPoint=function(t,e){return Y(e)?t.copy():t.multi(this._getResolution(e)/this._getResolution())},h.prototype._pointToPointAtZoom=function(t,e){return Y(e)?t.copy():t.multi(this._getResolution()/this._getResolution(e))},h.prototype._containerPointToPrj=function(t){return this._pointToPrj(this._containerPointToPoint(t))},h.prototype._viewPointToPrj=function(t){return this._containerPointToPrj(this.viewPointToContainerPoint(t))},h.prototype._prjToContainerPoint=function(t,e){return this._pointToContainerPoint(this._prjToPoint(t,e),e)},h.prototype._prjToViewPoint=function(t){var e=this._prjToContainerPoint(t);return this._containerPointToViewPoint(e)},h.prototype._containerPointToViewPoint=function(t){return t?t._sub(this.getViewPoint()):null},h.prototype._viewPointToPoint=function(t,e){return this._containerPointToPoint(this.viewPointToContainerPoint(t),e)},h.prototype._pointToViewPoint=function(t,e){return this._prjToViewPoint(this._pointToPrj(t,e))},h.prototype._callOnLoadHooks=function(){var t=h.prototype;if(t._onLoadHooks)for(var e=0,i=t._onLoadHooks.length;e<i;e++)t._onLoadHooks[e].call(this)},h}(pi(li(Ui(ci))));en.mergeOptions(tn);var nn=function(t){function e(){return u(this,e),v(this,t.apply(this,arguments))}return m(e,t),e.prototype.addHooks=function(){this.target&&this.target.on("_dblclick",this._onDoubleClick,this)},e.prototype.removeHooks=function(){this.target&&this.target.off("_dblclick",this._onDoubleClick,this)},e.prototype._onDoubleClick=function(t){var e=this.target;if(e.options.doubleClickZoom){var i=e.getZoom(),n=t.domEvent.shiftKey?Math.ceil(i)-1:Math.floor(i)+1;e._zoomAnimation(n,t.containerPoint)}},e}(hi);en.mergeOptions({doubleClickZoom:!0}),en.addOnLoadHook("addHandler","doubleClickZoom",nn);var rn=function(t){function e(){return u(this,e),v(this,t.apply(this,arguments))}return m(e,t),e.prototype.addHooks=function(){var t=this.target;if(t){var e=t._panels.mapWrapper||t._containerDOM;this._dragHandler=new vi(e,{cancelOn:this._cancelOn.bind(this),rightclick:!0}),this._dragHandler.on("mousedown",this._onMouseDown,this).on("dragstart",this._onDragStart,this).on("dragging",this._onDragging,this).on("dragend",this._onDragEnd,this).enable()}},e.prototype.removeHooks=function(){this._dragHandler.off("mousedown",this._onMouseDown,this).off("dragstart",this._onDragStart,this).off("dragging",this._onDragging,this).off("dragend",this._onDragEnd,this),this._dragHandler.remove(),delete this._dragHandler},e.prototype._cancelOn=function(t){return!(!this.target.isZooming()&&!this._ignore(t))},e.prototype._ignore=function(t){return!!t&&(t.domEvent&&(t=t.domEvent),this.target._ignoreEvent(t))},e.prototype._onMouseDown=function(t){delete this.startDragTime,delete this._mode,2===t.domEvent.button||t.domEvent.ctrlKey?(this.target.options.dragRotate||this.target.options.dragPitch)&&(this._mode="rotatePitch"):this.target.options.dragPan&&(this._mode="move"),this.target._stopAnim(this.target._animPlayer),Ne(t.domEvent)},e.prototype._onDragStart=function(t){this.startDragTime=y(),"move"===this._mode?this._moveStart(t):"rotatePitch"===this._mode&&this._rotateStart(t)},e.prototype._onDragging=function(t){this.target._isEventOutMap(t.domEvent)||("move"===this._mode?this._moving(t):"rotatePitch"===this._mode&&this._rotating(t))},e.prototype._onDragEnd=function(t){"move"===this._mode?this._moveEnd(t):"rotatePitch"===this._mode&&this._rotateEnd(t),delete this.startDragTime,delete this.startBearing},e.prototype._start=function(t){this.preX=t.mousePos.x,this.preY=t.mousePos.y,this.startX=this.preX,this.startY=this.preY},e.prototype._moveStart=function(t){this._start(t);var e=this.target;e.onMoveStart(t);var i=He(e._getActualEvent(t.domEvent),e.getContainer());this.startPrjCoord=e._containerPointToPrj(i)},e.prototype._moving=function(t){if(this.startDragTime){var e=this.target,i=He(e._getActualEvent(t.domEvent),e.getContainer());e._setPrjCoordAtContainerPoint(this.startPrjCoord,i),e.onMoving(t)}},e.prototype._moveEnd=function(t){if(this.startDragTime){var e=this.target,i=y()-this.startDragTime,n=t.mousePos.x,r=t.mousePos.y,o=n-this.startX,a=r-this.startY;this._clear(),!t.interupted&&e._verifyExtent(e.getCenter())&&i<280&&5<Math.abs(a)+Math.abs(o)?(i=5*i*(Math.abs(o)+Math.abs(a))/500,e.panBy(new le(o,a),{duration:i})):e.onMoveEnd(t)}},e.prototype._rotateStart=function(t){this._start(t),delete this._rotateMode,this.startBearing=this.target.getBearing(),this.target.onDragRotateStart(t),this._db=0},e.prototype._rotating=function(t){var e=this.target,i=t.mousePos.x,n=t.mousePos.y,r=e.getPitch(),o=e.getBearing(),a=Math.abs(i-this.preX),s=Math.abs(n-this.preY);if(this._rotateMode||(e.options.dragRotatePitch?this._rotateMode="rotate_pitch":this._rotateMode=s<a?"rotate":a<s?"pitch":"rotate"),!("pitch"===this._rotateMode&&0===r&&s<10)){if(0<=this._rotateMode.indexOf("rotate")&&e.options.dragRotate){var l=0;l=e.options.dragPitch||s<a?-.6*(this.preX-i):i>e.width/2?.6*(this.preY-n):-.6*(this.preY-n);var h=e.getBearing()+l;this._db=this._db||0,this._db+=l,e.setBearing(h)}0<=this._rotateMode.indexOf("pitch")&&e.options.dragPitch&&e.setPitch(e.getPitch()+.4*(this.preY-n)),this.preX=i,this.preY=n,e.getBearing()===o&&e.getPitch()===r||e.onDragRotating(t)}},e.prototype._rotateEnd=function(t){var e=this.target,i=e.getBearing();this._clear();var n=y()-this.startDragTime;if(e.onDragRotateEnd(t),20<Math.abs(i-this.startBearing)&&("rotate"===this._rotateMode||"rotate_pitch"===this._rotateMode)&&!t.interupted&&n<400){var r=e.getBearing();e.animateTo({bearing:r+this._db/2},{easing:"out",duration:800})}},e.prototype._clear=function(){delete this.startPrjCoord,delete this.preX,delete this.preY,delete this.startX,delete this.startY},e}(hi);function on(t,e,i,n){for(var r=[],o=0,a=void 0,s=0,l=t.length;s<l-1;s++)(a=sn(t[s],t[s+1],e,s,i,n))&&(r[o]=r[o]||[],r[o].push({point:a[0],index:s}),a[1]===t[s+1]&&s!==l-2||(r[o].push({point:a[1],index:s+1}),o++));return r}en.mergeOptions({draggable:!0,dragPan:!0,dragRotatePitch:!0,dragRotate:!0,dragPitch:!0}),en.addOnLoadHook("addHandler","draggable",rn);var an=void 0;function sn(t,e,i,n,r,o){var a=n?an:cn(t,i),s=cn(e,i),l=void 0,h=void 0,c=void 0;for(an=s;;){if(!(a|s))return[t,e];if(a&s)return!1;if(o)return[t,e];c=cn(h=hn(t,e,l=a||s,i,r),i),l===a?(t=h,a=c):(e=h,s=c)}}function ln(t,e,i){var n=[1,4,2,8],r=void 0,o=void 0,a=void 0,s=void 0,l=void 0,h=void 0,c=void 0,u=void 0,d=void 0;for(o=0,c=t.length;o<c;o++)t[o]._code=cn(t[o],e);for(s=0;s<4;s++){for(u=n[s],r=[],o=0,a=(c=t.length)-1;o<c;a=o++)l=t[o],h=t[a],l._code&u?h._code&u||((d=hn(h,l,u,e,i))._code=cn(d,e),r.push(d)):(h._code&u&&((d=hn(h,l,u,e,i))._code=cn(d,e),r.push(d)),r.push(l));t=r}return t}function hn(t,e,i,n,r){var o=e.x-t.x,a=e.y-t.y,s=n.getMin(),l=n.getMax(),h=void 0,c=void 0;8&i?(h=t.x+o*(l.y-t.y)/a,c=l.y):4&i?(h=t.x+o*(s.y-t.y)/a,c=s.y):2&i?(h=l.x,c=t.y+a*(l.x-t.x)/o):1&i&&(h=s.x,c=t.y+a*(s.x-t.x)/o);var u=new le(h,c);return r&&u._round(),u}function cn(t,e){var i=0;return t.x<e.getMin().x?i|=1:t.x>e.getMax().x&&(i|=2),t.y<e.getMin().y?i|=4:t.y>e.getMax().y&&(i|=8),i}function un(t,e,i,n){t=new le(t);var r=Math.abs(i.x-e.x),o=Math.abs(i.y-e.y),a=Math.sqrt(Math.abs(r*r-o*o)),s=void 0,l=void 0,h=void 0;return o<=r?(s=new le(e.x-a,e.y),l=new le(e.x+a,e.y),h=2*r):(s=new le(e.x,e.y-a),l=new le(e.x,e.y+a),h=2*o),t.distanceTo(s)+t.distanceTo(l)<=h+2*n}var dn=function(){function t(){u(this,t)}return t.prototype.getMap=function(){return this.geometry.getMap()},t.prototype.getPainter=function(){return this.painter},t.testColor=function(t){return!(!t||!S(t))&&0<=i.indexOf(t)},t}(),pn=function(t){function e(){return u(this,e),v(this,t.apply(this,arguments))}return m(e,t),e.prototype._prepareContext=function(t){w(this.symbol.opacity)?t.globalAlpha!==this.symbol.opacity&&(t.globalAlpha=this.symbol.opacity):1!==t.globalAlpha&&(t.globalAlpha=1)},e.prototype.prepareCanvas=function(t,e,i){ni.prepareCanvas(t,e,i,this.getPainter().isHitTesting())},e.prototype.remove=function(){},e.prototype.setZIndex=function(){},e.prototype.show=function(){},e.prototype.hide=function(){},e.prototype._defineStyle=function(t){return function(){var l=this,h=[],c={};return St(t,function(){var t,e,i,n,r,o,a,s=l.getMap();return t=h,e=s.getZoom(),i=_({},l.geometry.getProperties(),(n=c,r=s.getBearing(),o=s.getPitch(),a=s.getZoom(),n["{bearing}"]=r,n["{pitch}"]=o,n["{zoom}"]=a,n)),t[0]=e,t[1]=i,t})}.bind(this)()},e}(dn);var fn=function(r){function o(t,e,i){u(this,o);var n=v(this,r.call(this));return n.symbol=t,n.geometry=e,n.painter=i,n}return m(o,r),o.prototype.get2DExtent=function(){for(var t=this.getMap(),e=t.getGLZoom(),i=new bi,n=this._getRenderPoints()[0],r=n.length-1;0<=r;r--)n[r]&&i._combine(t._pointToPoint(n[r],e));return i},o.prototype._rotateExtent=function(t,e){return t.convertTo(function(t){return t._rotate(e)})},o.prototype._getRenderPoints=function(){return this.getPainter().getRenderPoints(this.getPlacement())},o.prototype._getRenderContainerPoints=function(t){var e=this.getPainter(),i=this._getRenderPoints()[0];if(e.isSpriting())return i;var n=this.getDxDy(),r=this.painter._pointContainerPoints(i,n.x,n.y,t,!0,this.getPlacement());if(!r||!Array.isArray(r[0]))return r;for(var o=[],a=0,s=r.length;a<s;a++)for(var l=0,h=r[a].length;l<h;l++)o.push(r[a][l]);return o},o.prototype._getRotationAt=function(t){var e=this.getRotation();e||(e=0);var i=this._getRenderPoints()[1];if(!i||!i[t])return e;var n=this.getMap(),r=i[t][0],o=i[t][1];if(n.isTransforming()){var a=n.getGLZoom();r=n._pointToContainerPoint(i[t][0],a),o=n._pointToContainerPoint(i[t][1],a)}return e+Q(r.x,r.y,o.x,o.y)},o.prototype._rotate=function(t,e,i){if(i){var n=this.getDxDy(),r=e.sub(n);return t.save(),t.translate(r.x,r.y),t.rotate(i),this.getDxDy()}return null},o}(pn),gn=function(o){function _(t,e,i){u(this,_);var n=v(this,o.call(this,t,e,i));n._dynamic=bt(t),n.style=n._defineStyle(n.translate()),n.strokeAndFill=n._defineStyle(_.translateLineAndFill(n.style));var r=n.strokeAndFill.lineWidth;return n.padding=r%2==0?2:1.5,n}return m(_,o),_.test=function(t){return!!t&&!(!Y(t.markerFile)||Y(t.markerType)||"path"===t.markerType)},_.prototype.symbolize=function(t,e){var i=this.style;if(this.painter.isHitTesting()||0!==i.markerWidth&&0!==i.markerHeight&&(0!==i.polygonOpacity||0!==i.lineOpacity)){var n=this._getRenderContainerPoints();H(n)&&(this._prepareContext(t),this.getPainter().isSpriting()||this.geometry.getLayer().getMask()===this.geometry||this._dynamic||!1===this.geometry.getLayer().options.cacheVectorOnCanvas?this._drawMarkers(t,n,e):this._drawMarkersWithCache(t,n,e))}},_.prototype.getDxDy=function(){var t=this.style,e=t.markerDx,i=t.markerDy;return new le(e,i)},_.prototype._drawMarkers=function(t,e,i){var n=this.strokeAndFill;Rt(n.lineColor)||Rt(n.polygonFill)||this.prepareCanvas(t,n,i);for(var r=e.length-1;0<=r;r--){var o=e[r],a=this._rotate(t,o,this._getRotationAt(r));a&&(o=a),this._drawVectorMarker(t,o,i),a&&t.restore()}},_.prototype._drawMarkersWithCache=function(t,e,i){var n=this._stampSymbol(),r=i.getImage(n);r||(r=this._createMarkerImage(t,i),i.addResource([n,r.width,r.height],r));for(var o=this._getAnchor(r.width,r.height),a=e.length-1;0<=a;a--){var s=e[a],l=this._rotate(t,s,this._getRotationAt(a));l&&(s=l),ni.image(t,r,s.x+o.x,s.y+o.y),l&&t.restore()}},_.prototype._calMarkerSize=function(){var t=this.strokeAndFill.lineWidth,e=2*(this.symbol.shadowBlur||0);return[Math.round(this.style.markerWidth+t+2*e+2*this.padding),Math.round(this.style.markerHeight+t+2*e+2*this.padding)]},_.prototype._createMarkerImage=function(t,e){var i=t.canvas.constructor,n=this._calMarkerSize(),r=ni.createCanvas(n[0],n[1],i),o=this._getCacheImageAnchor(n[0],n[1]),a=r.getContext("2d");return Rt(this.strokeAndFill.lineColor)||Rt(this.strokeAndFill.polygonFill)||this.prepareCanvas(a,this.strokeAndFill,e),this._drawVectorMarker(a,o,e),r},_.prototype._stampSymbol=function(){return this._stamp||(this._stamp=[this.style.markerType,Rt(this.style.markerFill)?Dt(this.style.markerFill):this.style.markerFill,this.style.markerFillOpacity,this.style.markerFillPatternFile,Rt(this.style.markerLineColor)?Dt(this.style.markerLineColor):this.style.markerLineColor,this.style.markerLineWidth,this.style.markerLineOpacity,this.style.markerLineDasharray?this.style.markerLineDasharray.join(","):"",this.style.markerLinePatternFile,this.style.markerWidth,this.style.markerHeight,this.style.markerHorizontalAlignment,this.style.markerVerticalAlignment].join("_")),this._stamp},_.prototype._getAnchor=function(t,e){var i=2*(this.symbol.shadowBlur||0)+this.padding,n=be(new he(t,e),this.style.markerHorizontalAlignment,this.style.markerVerticalAlignment);return n.x!==-t/2&&(n.x-=N(n.x+t/2)*i),n.y!==-e/2&&(n.y-=N(n.y+e/2)*i),n},_.prototype._getCacheImageAnchor=function(t,e){var i=2*(this.symbol.shadowBlur||0)+this.padding,n=this.style.markerType;return"bar"===n||"pie"===n||"pin"===n?new le(t/2,e-i):"rectangle"===n?new le(i,i):new le(t/2,e/2)},_.prototype._getGraidentExtent=function(t){var e=new bi,i=this.getFixedExtent();if(Array.isArray(t))for(var n=t.length-1;0<=n;n--)e._combine(t[n]);else e._combine(t);return e.xmin+=i.xmin,e.ymin+=i.ymin,e.xmax+=i.xmax,e.ymax+=i.ymax,e},_.prototype._drawVectorMarker=function(t,e,i){var n=this.style,r=this.strokeAndFill,o=n.markerType.toLowerCase(),a=_._getVectorPoints(o,n.markerWidth,n.markerHeight),s=r.lineOpacity,l=r.polygonOpacity;if(Rt(r.lineColor)||Rt(r.polygonFill)){var h=void 0;Rt(r.lineColor)&&(h=this._getGraidentExtent(e),r.lineGradientExtent=h.expand(r.lineWidth)),Rt(r.polygonFill)&&(h||(h=this._getGraidentExtent(e)),r.polygonGradientExtent=h),this.prepareCanvas(t,r,i)}var c=n.markerWidth,u=n.markerHeight,d=n.markerLineWidth/2;if("ellipse"===o)ni.ellipse(t,e,c/2,u/2,s,l);else if("cross"===o||"x"===o){for(var p=a.length-1;0<=p;p--)a[p]._add(e);ni.path(t,a.slice(0,2),s),ni.path(t,a.slice(2,4),s)}else if("diamond"===o||"bar"===o||"square"===o||"rectangle"===o||"triangle"===o){"bar"===o?e=e.add(0,-d):"rectangle"===o&&(e=e.add(d,d));for(var f=a.length-1;0<=f;f--)a[f]._add(e);ni.polygon(t,a,s,l)}else if("pin"===o){e=e.add(0,-d);for(var g=a.length-1;0<=g;g--)a[g]._add(e);var m=t.lineCap;t.lineCap="round",ni.bezierCurveAndFill(t,a,s,l),t.lineCap=m}else{if("pie"!==o)throw new Error("unsupported markerType: "+o);e=e.add(0,-d);var v=180*Math.atan(c/2/u)/Math.PI,y=t.lineCap;t.lineCap="round",ni.sector(t,e,u,[90-v,90+v],s,l),t.lineCap=y}},_.prototype.getPlacement=function(){return this.symbol.markerPlacement},_.prototype.getRotation=function(){var t=this.style.markerRotation;return w(t)?-t*Math.PI/180:null},_.prototype.getFixedExtent=function(){var t=this.getDxDy(),e=this.style,i=e.markerType.toLowerCase(),n=e.markerWidth,r=e.markerHeight,o=void 0;o="bar"===i||"pie"===i||"pin"===i?new bi(t.add(-n/2,-r),t.add(n/2,0)):new bi(t.add(-n/2,-r/2),t.add(n/2,r/2)),this.style.markerLineWidth&&o._expand(this.style.markerLineWidth/2);var a=this.getRotation();return a&&(o=this._rotateExtent(o,a)),o},_.prototype.translate=function(){var t=this.symbol,e={markerType:z(t.markerType,"ellipse"),markerFill:z(t.markerFill,"#00f"),markerFillOpacity:z(t.markerFillOpacity,1),markerFillPatternFile:z(t.markerFillPatternFile,null),markerLineColor:z(t.markerLineColor,"#000"),markerLineWidth:z(t.markerLineWidth,1),markerLineOpacity:z(t.markerLineOpacity,1),markerLineDasharray:z(t.markerLineDasharray,[]),markerLinePatternFile:z(t.markerLinePatternFile,null),markerDx:z(t.markerDx,0),markerDy:z(t.markerDy,0),markerWidth:z(t.markerWidth,10),markerHeight:z(t.markerHeight,10),markerRotation:z(t.markerRotation,0)},i=e.markerType,n=void 0,r=void 0;return"bar"===i||"pie"===i||"pin"===i?(n="middle",r="top"):"rectangle"===i?(n="right",r="bottom"):r=n="middle",e.markerHorizontalAlignment=z(t.markerHorizontalAlignment,n),e.markerVerticalAlignment=z(t.markerVerticalAlignment,r),w(t.markerOpacity)&&(w(t.markerFillOpacity)&&(e.markerFillOpacity*=t.markerOpacity),w(t.markerLineOpacity)&&(e.markerLineOpacity*=t.markerOpacity)),e},_.translateLineAndFill=function(t){var e={lineColor:t.markerLineColor,linePatternFile:t.markerLinePatternFile,lineWidth:t.markerLineWidth,lineOpacity:t.markerLineOpacity,lineDasharray:t.markerLineDasharray,lineCap:"butt",lineJoin:"round",polygonFill:t.markerFill,polygonPatternFile:t.markerFillPatternFile,polygonOpacity:t.markerFillOpacity};return 0===e.lineWidth&&(e.lineOpacity=0),e},_._getVectorPoints=function(t,e,i){var n=i/2,r=e/2,o=void 0,a=void 0,s=void 0,l=void 0;if("triangle"===t)return[o=new le(0,0-n),a=new le(0-r,0+n),s=new le(0+r,0+n)];if("cross"===t)return[o=new le(0-r,0),a=new le(0+r,0),s=new le(0,0-n),l=new le(0,0+n)];if("diamond"===t)return[o=new le(0-r,0),a=new le(0,0-n),s=new le(0+r,0),l=new le(0,0+n)];if("square"===t)return[o=new le(0-r,0+n),a=new le(0+r,0+n),s=new le(0+r,0-n),l=new le(0-r,0-n)];if("rectangle"===t)return a=(o=new le(0,0)).add(e,0),s=o.add(e,i),l=o.add(0,i),[o,a,s,l];if("x"===t)return[o=new le(0-r,0+n),a=new le(0+r,0-n),s=new le(0+r,0+n),l=new le(0-r,0-n)];if("bar"===t)return[o=new le(0-r,0-i),a=new le(0+r,0-i),s=new le(0+r,0),l=new le(0-r,0)];if("pin"===t){var h=i*Math.atan(r/n);return[o=new le(0,0),a=new le(0-h,0-i),s=new le(0+h,0-i),l=new le(0,0)]}return[]},_}(fn),mn=function(t){function e(){return u(this,e),v(this,t.apply(this,arguments))}return m(e,t),e.prototype.getPlacement=function(){return"point"},e.prototype.getDxDy=function(){return new le(0,0)},e.prototype.symbolize=function(t){var e=this.geometry,i=e.getLayer();if(e.options.debug||!i||i.options.debug){var n=this.getMap();if(n&&!n.isZooming()){var r=i.options.debugOutline;t.strokeStyle=r,t.fillStyle=r;var o=this.getPainter().getContainerExtent().toArray();ni.polygon(t,[o],1,0);for(var a=this._getRenderContainerPoints(),s=this.geometry.getId(),l=gn._getVectorPoints("cross",10,10),h=0;h<a.length;h++){var c=a[h];Y(s)||ni.fillText(t,s,c.add(8,-4),r);for(var u=[],d=0;d<l.length;d++)u.push(l[d].add(c));ni.path(t,u.slice(0,2),1),ni.path(t,u.slice(2,4),1)}}}},e}(fn),vn=function(r){function o(t,e,i){u(this,o);var n=v(this,r.call(this,t,e,i));return n.style=n._defineStyle(n.translate()),n}return m(o,r),o.test=function(t){return!!t&&!Y(t.markerFile)},o.prototype.symbolize=function(t,e){var i=this.style;if(this.painter.isHitTesting()||0!==i.markerWidth&&0!==i.markerHeight&&0!==i.markerOpacity){var n=this._getRenderContainerPoints();if(H(n)){var r=this._getImage(e);if(r){this._prepareContext(t);var o=i.markerWidth,a=i.markerHeight;if(!w(o)||!w(a)){o=r.width,a=r.height,i.markerWidth=o,i.markerHeight=a;var s=[i.markerFile,i.markerWidth,i.markerHeight];e.isResourceLoaded(s)||e.addResource(s,r);var l=this.getPainter();l.isSpriting()||l.removeCache()}var h=void 0;"path"!==this.symbol.markerType&&w(i.markerOpacity)&&i.markerOpacity<1&&(h=t.globalAlpha,t.globalAlpha*=i.markerOpacity);for(var c=be(new he(o,a),i.markerHorizontalAlignment,i.markerVerticalAlignment),u=0,d=n.length;u<d;u++){var p=n[u],f=this._rotate(t,p,this._getRotationAt(u));f&&(p=f),ni.image(t,r,p.x+c.x,p.y+c.y,o,a),f&&t.restore()}void 0!==h&&(t.globalAlpha=h)}else"undefined"!=typeof console&&console.warn("no img found for "+(this.style.markerFile||this._url[0]))}}},o.prototype._getImage=function(t){return t?t.getImage([this.style.markerFile,this.style.markerWidth,this.style.markerHeight]):null},o.prototype.getPlacement=function(){return this.symbol.markerPlacement},o.prototype.getRotation=function(){var t=this.style.markerRotation;return w(t)?-t*Math.PI/180:null},o.prototype.getDxDy=function(){var t=this.style,e=t.markerDx,i=t.markerDy;return new le(e,i)},o.prototype.getFixedExtent=function(t){var e=this.style.markerFile,i=t?t.getImage(e):null,n=this.style.markerWidth||(i?i.width:0),r=this.style.markerHeight||(i?i.height:0),o=this.getDxDy(),a=new bi(o.add(-n/2,0),o.add(n/2,-r)),s=this.getRotation();return s&&(a=this._rotateExtent(a,s)),a},o.prototype.translate=function(){var t=this.symbol;return{markerFile:t.markerFile,markerOpacity:z(t.markerOpacity,1),markerWidth:z(t.markerWidth,null),markerHeight:z(t.markerHeight,null),markerRotation:z(t.markerRotation,0),markerDx:z(t.markerDx,0),markerDy:z(t.markerDy,0),markerHorizontalAlignment:z(t.markerHorizontalAlignment,"middle"),markerVerticalAlignment:z(t.markerVerticalAlignment,"top")}},o}(fn),yn=function(r){function o(t,e,i){u(this,o);var n=v(this,r.call(this));return n.symbol=t,n.geometry=e,n.painter=i,"Point"===e.type?v(n):(n.style=n._defineStyle(n.translate()),n)}return m(o,r),o.test=function(t,e){if(!t)return!1;if(e&&"Point"===e.type)return!1;for(var i in t){var n=i.slice(0,4);if("line"===n||"poly"===n)return!0}return!1},o.prototype.symbolize=function(t,e){var i=this.style;if(0!==i.polygonOpacity||0!==i.lineOpacity||this.painter.isHitTesting()){var n=this._getPaintParams();if(n){this._prepareContext(t);var r=Rt(i.lineColor),o="Polygon"===this.geometry.getJSONType()||"LineString"===this.geometry.type;!r||!i.lineColor.places&&o||(i.lineGradientExtent=this.getPainter().getContainerExtent()._expand(i.lineWidth)),Rt(i.polygonFill)&&(i.polygonGradientExtent=this.getPainter().getContainerExtent());var a=n[0];if("Polygon"===this.geometry.getJSONType()&&0<a.length&&Array.isArray(a[0][0])||"LineString"===this.geometry.type&&0<a.length&&Array.isArray(a[0]))for(var s=0;s<a.length;s++){this.prepareCanvas(t,i,e),r&&o&&!i.lineColor.places&&this._createGradient(t,a[s],i.lineColor);var l=[t,a[s]];1<n.length&&l.push.apply(l,n.slice(1)),l.push(i.lineOpacity,i.polygonOpacity,i.lineDasharray),this.geometry._paintOn.apply(this.geometry,l)}else{this.prepareCanvas(t,i,e),r&&o&&!i.lineColor.places&&this._createGradient(t,a,i.lineColor);var h=[t];h.push.apply(h,n),h.push(i.lineOpacity,i.polygonOpacity,i.lineDasharray),this.geometry._paintOn.apply(this.geometry,h)}t.setLineDash&&Array.isArray(i.lineDasharray)&&t.setLineDash([])}}},o.prototype.get2DExtent=function(){var t=this.getMap(),e=this.geometry._getPrjExtent();if(!e)return null;this._extMin&&this._extMax||(this._extMin=new yi(0,0),this._extMax=new yi(0,0)),this._extMin.x=e.xmin,this._extMin.y=e.ymin,this._extMax.x=e.xmax,this._extMax.y=e.ymax;var i=t._prjToPoint(this._extMin),n=t._prjToPoint(this._extMax);return this._pxExtent?(this._pxExtent.xmin=Math.min(i.x,n.x),this._pxExtent.xmax=Math.max(i.x,n.x),this._pxExtent.ymin=Math.min(i.y,n.y),this._pxExtent.ymax=Math.max(i.y,n.y)):this._pxExtent=new bi(i,n),this._pxExtent},o.prototype.getFixedExtent=function(){var t=this.style.lineWidth/2;return new bi(-t,-t,t,t)},o.prototype._getPaintParams=function(){return this.getPainter().getPaintParams(this.style.lineDx,this.style.lineDy)},o.prototype.translate=function(){var t=this.symbol,e={lineColor:z(t.lineColor,"#000"),lineWidth:z(t.lineWidth,2),lineOpacity:z(t.lineOpacity,1),lineDasharray:z(t.lineDasharray,[]),lineCap:z(t.lineCap,"butt"),lineJoin:z(t.lineJoin,"miter"),linePatternFile:z(t.linePatternFile,null),lineDx:z(t.lineDx,0),lineDy:z(t.lineDy,0),polygonFill:z(t.polygonFill,null),polygonOpacity:z(t.polygonOpacity,1),polygonPatternFile:z(t.polygonPatternFile,null),polygonPatternDx:z(t.polygonPatternDx,0),polygonPatternDy:z(t.polygonPatternDy,0),linePatternDx:z(t.linePatternDx,0),linePatternDy:z(t.linePatternDy,0)};return 0===e.lineWidth&&(e.lineOpacity=0),"LineString"!==this.geometry.type||e.polygonFill||(e.polygonFill=e.lineColor),e},o.prototype._createGradient=function(t,e,i){if(Array.isArray(e)){var n=e.length,r=t.createLinearGradient(e[0].x,e[0].y,e[n-1].x,e[n-1].y);i.colorStops.forEach(function(t){r.addColorStop.apply(r,t)}),t.strokeStyle=r}},o}(pn),_n="___text_symbol_cache",xn=function(o){function a(t,e,i){u(this,a);var n=v(this,o.call(this,t,e,i));if(n._dynamic=bt(t),n.style=n._defineStyle(n.translate()),0===n.style.textWrapWidth)return v(n);n.strokeAndFill=n._defineStyle(n.translateLineAndFill(n.style));var r=we(n.style.textName,n.geometry.getProperties());return n._dynamic||(n._cacheKey=function(t,e){var i=[t];for(var n in e)e.hasOwnProperty(n)&&4<n.length&&"text"===n.substring(0,4)&&i.push(n+"="+e[n]);return i.join("-")}(r,n.style)),n._descText(r),n}return m(a,o),a.test=function(t){return!!t&&!Y(t.textName)},a.prototype.symbolize=function(t,e){if(this.painter.isHitTesting()||0!==this.style.textSize&&(this.style.textOpacity||this.style.textHaloRadius&&this.style.textHaloOpacity)&&0!==this.style.textWrapWidth){var i=this._getRenderContainerPoints();if(H(i)){var n=this.style,r=this.strokeAndFill,o=we(this.style.textName,this.geometry.getProperties());this._descText(o),this._prepareContext(t),this.prepareCanvas(t,r,e),ni.prepareCanvasFont(t,n);for(var a=0,s=i.length;a<s;a++){var l=i[a],h=this._rotate(t,l,this._getRotationAt(a));h&&(l=h),ni.text(t,o,l,n,this.textDesc),h&&t.restore()}}}},a.prototype.getPlacement=function(){return this.symbol.textPlacement},a.prototype.getRotation=function(){var t=this.style.textRotation;return w(t)?-t*Math.PI/180:null},a.prototype.getDxDy=function(){var t=this.style;return new le(t.textDx,t.textDy)},a.prototype.getFixedExtent=function(){var t=this.getDxDy(),e=this.style,i=this.textDesc.size,n=be(i,e.textHorizontalAlignment,e.textVerticalAlignment),r=n.x,o=n.y;if(e.textHaloRadius){var a=e.textHaloRadius;i=i.add(2*a,2*a)}var s=new bi(t.add(r,o),t.add(r+i.width,o+i.height)),l=this.getRotation();return l&&(s=this._rotateExtent(s,l)),s},a.prototype.translate=function(){var t=this.symbol,e={textName:t.textName,textFaceName:z(t.textFaceName,"monospace"),textWeight:z(t.textWeight,"normal"),textStyle:z(t.textStyle,"normal"),textSize:z(t.textSize,10),textFont:z(t.textFont,null),textFill:z(t.textFill,"#000"),textOpacity:z(t.textOpacity,1),textHaloFill:z(t.textHaloFill,"#ffffff"),textHaloRadius:z(t.textHaloRadius,0),textHaloOpacity:z(t.textHaloOpacity,1),textWrapWidth:z(t.textWrapWidth,null),textWrapCharacter:z(t.textWrapCharacter,"\n"),textLineSpacing:z(t.textLineSpacing,0),textDx:z(t.textDx,0),textDy:z(t.textDy,0),textHorizontalAlignment:z(t.textHorizontalAlignment,"middle"),textVerticalAlignment:z(t.textVerticalAlignment,"middle"),textAlign:z(t.textAlign,"center"),textRotation:z(t.textRotation,0),textMaxWidth:z(t.textMaxWidth,0),textMaxHeight:z(t.textMaxHeight,0)};return 0<e.textMaxWidth&&(!e.textWrapWidth||e.textWrapWidth>e.textMaxWidth)&&(e.textWrapWidth||(e.textMaxHeight=1),e.textWrapWidth=e.textMaxWidth),e},a.prototype.translateLineAndFill=function(t){return{lineColor:t.textHaloRadius?t.textHaloFill:t.textFill,lineWidth:t.textHaloRadius,lineOpacity:t.textOpacity,lineDasharray:null,lineCap:"butt",lineJoin:"round",polygonFill:t.textFill,polygonOpacity:t.textOpacity}},a.prototype._descText=function(t){this._dynamic?this.textDesc=this._measureText(t):(this.textDesc=this._loadFromCache(),this.textDesc||(this.textDesc=this._measureText(t),this._storeToCache(this.textDesc)))},a.prototype._measureText=function(t){var e=this.style.textMaxHeight,i=Se(t,this.style);return e&&e<i.size.height&&(i.size.height=e),i},a.prototype._storeToCache=function(t){C||(this.geometry[_n]||(this.geometry[_n]={}),this.geometry[_n][this._cacheKey]={desc:t,active:!0})},a.prototype._loadFromCache=function(){if(!this.geometry[_n])return null;var t=this.geometry[_n][this._cacheKey];return t?(t.active=!0,t.desc):null},a}(fn);xn.CACHE_KEY=_n;var wn=function(r){function o(t,e,i){u(this,o);var n=v(this,r.call(this,t,e,i));return n.style=n._defineStyle(n.translate()),Y(n.style.markerWidth)&&(n.style.markerWidth=80),Y(n.style.markerHeight)&&(n.style.markerHeight=80),ae.gecko?n._url=[Et(t,n.style.markerWidth,n.style.markerHeight),n.style.markerWidth,n.style.markerHeight]:n._url=[Et(t),t.markerWidth,t.markerHeight],n}return m(o,r),o.test=function(t){return!!t&&!(!Y(t.markerFile)||"path"!==t.markerType)},o.prototype._prepareContext=function(){},o.prototype._getImage=function(t){if(t&&t.isResourceLoaded(this._url))return t.getImage(this._url);var e=new Image;return e.src=this._url[0],t&&t.addResource(this._url,e),e},o}(vn),bn={lineWidth:1,polygonFill:"#fff",polygonOpacity:.5},Mn=function(r){function o(t,e,i){u(this,o);var n=v(this,r.call(this,t,e,i));return n.style=e.getLayer().options.drawAltitude,n.style&&x(n.style)||(n.style={lineWidth:2}),n.style.lineWidth||(n.style.lineWidth=0),n.dxdy=n._defineStyle({dx:t.textDx||t.markerDx,dy:t.textDy||t.markerDy}),n}return m(o,r),o.test=function(t,e){if(!e.getLayer())return!1;var i=e.getJSONType();return"Marker"===i||"LineString"===i},o.prototype.symbolize=function(t){var e=this.geometry.getLayer();if(e.options.drawAltitude){var i=this.geometry.getProperties();if(i&&i[e.options.altitudeProperty]){var n=this._getStyle();if(this._prepareContext(t),"LineString"===this.geometry.type){var r=this._getPaintParams(n.lineDx,n.lineDy);if(!r)return;var o=this.getPainter().getPaintParams(n.lineDx,n.lineDy,!0)[0];this._drawLineAltitude(t,r[0],o)}else{var a=this._getRenderContainerPoints(),s=this._getRenderContainerPoints(!0);if(!a||0===a.length)return;this._drawMarkerAltitude(t,a[0],s[0])}}}},o.prototype.getDxDy=function(){var t=this.dxdy;return new le(t.dx||0,t.dy||0)},o.prototype.get2DExtent=function(){return"LineString"===this.geometry.type?yn.prototype.get2DExtent.apply(this):r.prototype.get2DExtent.call(this)},o.prototype.getPlacement=function(){return"point"},o.prototype._getPaintParams=function(t,e){return this.getPainter().getPaintParams(t||0,e||0)},o.prototype._drawMarkerAltitude=function(t,e,i){var n=this._getStyle();this.prepareCanvas(t,n),ni.path(t,[e,i],n.lineOpacity,null,n.lineDasharray)},o.prototype._drawLineAltitude=function(t,e,i){var n=this._getStyle();if(0<e.length&&Array.isArray(e[0]))for(var r=0;r<e.length;r++)this._drawLine(t,e[r],i[r]);else this._drawLine(t,e,i);t.setLineDash&&Array.isArray(n.lineDasharray)&&t.setLineDash([])},o.prototype._drawLine=function(t,e,i){var n=this._getStyle();this.prepareCanvas(t,n);for(var r=0,o=e.length-1;r<o;r++)ni.polygon(t,[e[r],e[r+1],i[r+1],i[r]],n.lineOpacity,n.polygonOpacity,n.lineDasharray)},o.prototype._getStyle=function(){var t=this.geometry.getLayer().options.drawAltitude;return x(t)||(t=bn),t.lineWidth||(t.lineWidth=0,t.lineOpacity=0),t},o}(fn),Sn=Object.freeze({Symbolizer:dn,CanvasSymbolizer:pn,DebugSymbolizer:mn,ImageMarkerSymbolizer:vn,PointSymbolizer:fn,StrokeAndFillSymbolizer:yn,TextMarkerSymbolizer:xn,VectorMarkerSymbolizer:gn,VectorPathMarkerSymbolizer:wn,DrawAltitudeSymbolizer:Mn}),Tn=[Mn,yn,vn,wn,gn,xn],Cn=void 0,An=function(i){function n(t){u(this,n);var e=v(this,i.call(this));return e.geometry=t,e.symbolizers=e._createSymbolizers(),e._altAtGLZoom=e._getGeometryAltitude(),e}return m(n,i),n.prototype.getMap=function(){return this.geometry.getMap()},n.prototype.getLayer=function(){return this.geometry.getLayer()},n.prototype._createSymbolizers=function(){var t=this.getSymbol(),e=[],i=Tn,n=t;Array.isArray(t)||(n=[t]);for(var r=n.length-1;0<=r;r--)for(var o=n[r],a=i.length-1;0<=a;a--)if(i[a].test(o,this.geometry)){var s=new i[a](o,this.geometry,this);e.push(s),s instanceof fn&&(this._hasPoint=!0)}if(!e.length&&console){var l=this.geometry.getId();console.warn("invalid symbol for geometry("+(this.geometry?this.geometry.getType()+(l?":"+l:""):"")+") to draw : "+JSON.stringify(t))}return this._debugSymbolizer=new mn(t,this.geometry,this),e},n.prototype.hasPoint=function(){return!!this._hasPoint},n.prototype.getRenderPoints=function(t){return this._renderPoints||(this._renderPoints={}),t||(t="center"),this._renderPoints[t]||(this._renderPoints[t]=this.geometry._getRenderPoints(t)),this._renderPoints[t]},n.prototype.getPaintParams=function(t,e,i){var n=this.getMap(),r=this.geometry,o=n.getResolution(),a=0!==n.getPitch(),s=0!==n.getBearing(),l=this._cachedParams,h=r._paintAsPath&&r._paintAsPath();if(h&&this._unsimpledParams&&o<=this._unsimpledParams._res)l=this._unsimpledParams;else if(!l||l._res!==n.getResolution()||this._pitched!==a&&r._redrawWhenPitch()||this._rotated!==s&&r._redrawWhenRotate()){if(!(l=r._getPaintParams()))return null;l._res=o,!r._simplified&&h&&(this._unsimpledParams||(this._unsimpledParams=l),o>this._unsimpledParams._res&&(this._unsimpledParams._res=o)),this._cachedParams=l}if(!l)return null;this._pitched=a,this._rotated=s;var c=n.getGLScale(),u=[],d=l[0],p=n.getContainerExtent(),f=this._pointContainerPoints(d,t,e,i,!p.contains(this._hitPoint));if(!f)return null;u.push(f);for(var g=1,m=l.length;g<m;g++)w(l[g])||l[g]instanceof he?w(l[g])?u.push(l[g]/c):u.push(l[g].multi(1/c)):u.push(l[g]);return u},n.prototype._pointContainerPoints=function(t,n,r,e,i,o){if(!this.getContainerExtent())return null;var a=this.getMap(),s=a.getGLZoom(),l=this.containerOffset,h=void 0;function c(t,e){var i=a._pointToContainerPoint(t,s,e)._sub(l);return(n||r)&&i._add(n||0,r||0),i}var u=this.getAltitude();if(Array.isArray(t)){var d=this.geometry,p=void 0,f=(p=!i&&d.options.enableClip?this._clip(t,u):{points:t,altitude:u}).points;u=p.altitude,e&&(u=0);var g=u;h=[];for(var m=0,v=f.length;m<v;m++){var y=f[m];if(Array.isArray(y)){for(var _=[],x=0,w=y.length;x<w;x++){var b=y[x];Array.isArray(u)&&(g=u[m]?u[m][x]:0),_.push(c(b,g))}h.push(_)}else Array.isArray(u)&&(g="vertex-last"===o?u[u.length-1-m]:"line"===o?(u[m]+u[m+1])/2:u[m]),h.push(c(y,g))}}else t instanceof le&&(e&&(u=0),h=a._pointToContainerPoint(t,s,u)._sub(l),(n||r)&&h._add(n,r));return h},n.prototype._clip=function(t,e){var i=this.getMap(),n=this.geometry,r=i.getGLZoom(),o=this.getSymbol().lineWidth;w(o)||(o=4);var a=i.getContainerExtent().expand(o).convertTo(function(t){return i._containerPointToPoint(t,r)});if(0<i.getPitch()&&e){var s=i.cameraLookAt,l=i.cameraPosition;a=a.combine(new le(l)._add(N(s[0]-l[0]),N(s[1]-l[1])))}var h=t;if(this.get2DExtent().within(a))return{points:h,altitude:e};var c=n.options.smoothness;if(n.getShell&&this.geometry.getHoles&&!c)if(Array.isArray(t[0])){h=[];for(var u=0;u<t.length;u++){var d=ln(t[u],a);d.length&&h.push(d)}}else h=ln(t,a);else if("LineString"===n.getJSONType()){if(Array.isArray(t[0])){h=[];for(var p=0;p<t.length;p++)D(h,on(t[p],a,!1,!!c))}else h=on(t,a,!1,!!c);return this._interpolateSegAlt(h,t,e)}return{points:h,altitude:e}},n.prototype._interpolateSegAlt=function(t,e,n){if(!Array.isArray(n)){var i=function(t){return t.point};return{points:t.map(function(t){return Array.isArray(t)?t.map(i):t.point}),altitude:n}}var r=function t(e,i,n){if(!Array.isArray(n))return e;var r=[];for(var o=0,a=e.length;o<a;o++)if(Array.isArray(e[o]))r.push(t(e[o],i,n));else{var s=e[o];if(s.point.equals(i[s.index]))s.altitude=n[s.index],r.push(s);else{var l=void 0,h=void 0;0===s.index?(l=s.index,h=s.index+1):(l=s.index-1,h=s.index);var c=s.point.distanceTo(i[h]),u=c/(c+i[l].distanceTo(s.point)),d=F(n[l],n[h],1-u);s.altitude=d,r.push(s)}}return r}(t,e,n);return n=[],{points:r.map(function(t){if(Array.isArray(t)){var e=[],i=t.map(function(t){return e.push(t.altitude),t.point});return n.push(e),i}return n.push(t.altitude),t.point}),altitude:n}},n.prototype.getSymbol=function(){return this.geometry._getInternalSymbol()},n.prototype.paint=function(t,e,i){if(this.symbolizers){var n=this.getLayer()._getRenderer();if(n&&n.context&&(!t||t.intersects(this.get2DExtent(n.resources)))){var r=this.getMap(),o=this.getMinAltitude(),a=r.getFrustumAltitude();if(!(o&&a&&a<o)){this.containerOffset=i||r._pointToContainerPoint(n._southWest)._add(0,-r.height),this._beforePaint();for(var s=e||n.context,l=[s,n.resources],h=this.symbolizers.length-1;0<=h;h--)this._prepareShadow(s,this.symbolizers[h].symbol),this.symbolizers[h].symbolize.apply(this.symbolizers[h],l);this._afterPaint(),this._painted=!0,this._debugSymbolizer.symbolize.apply(this._debugSymbolizer,l)}}}},n.prototype.getSprite=function(i,t){if("Point"!==this.geometry.type)return null;if(this._spriting=!0,!this._sprite&&0<this.symbolizers.length){var n=new bi;this.symbolizers.forEach(function(t){var e=t.getFixedExtent(i);n._combine(e)});var e=n.getMin().multi(-1),r=t||(this.getMap()?this.getMap().CanvasClass:null),o=ni.createCanvas(n.getWidth(),n.getHeight(),r),a=void 0;this._renderPoints&&(a=this._renderPoints);for(var s=o.getContext("2d"),l=[s,i],h=this.symbolizers.length-1;0<=h;h--){var c=this.symbolizers[h].getDxDy();this._renderPoints={center:[[e.add(c)]]},this._prepareShadow(s,this.symbolizers[h].symbol),this.symbolizers[h].symbolize.apply(this.symbolizers[h],l)}a&&(this._renderPoints=a),this._sprite={canvas:o,offset:n.getCenter()}}return this._spriting=!1,this._sprite},n.prototype.isSpriting=function(){return!!this._spriting},n.prototype.hitTest=function(t,e){(!e||e<.5)&&(e=.5),Cn||(Cn=ni.createCanvas(1,1)),ni.setHitTesting(!0),Cn.width=Cn.height=2*e;var i=Cn.getContext("2d");this._hitPoint=t.sub(e,e);try{this.paint(null,i,this._hitPoint)}catch(t){throw t}finally{ni.setHitTesting(!1)}delete this._hitPoint;for(var n=i.getImageData(0,0,Cn.width,Cn.height).data,r=3,o=n.length;r<o;r+=4)if(0<n[r])return!0;return!1},n.prototype.isHitTesting=function(){return!!this._hitPoint},n.prototype._prepareShadow=function(t,e){e.shadowBlur?(t.shadowBlur=e.shadowBlur,t.shadowColor=e.shadowColor||"#000",t.shadowOffsetX=e.shadowOffsetX||0,t.shadowOffsetY=e.shadowOffsetY||0):t.shadowBlur&&(t.shadowBlur=null,t.shadowColor=null,t.shadowOffsetX=null,t.shadowOffsetY=null)},n.prototype._eachSymbolizer=function(t,e){if(this.symbolizers){e||(e=this);for(var i=this.symbolizers.length-1;0<=i;i--)t.apply(e,[this.symbolizers[i]])}},n.prototype.get2DExtent=function(t){this._verifyProjection();var e=this.getMap();t=t||this.getLayer()._getRenderer().resources;var i=e.getZoom();if((!this._extent2D||this._extent2D._zoom!==i)&&(delete this._extent2D,delete this._fixedExtent,this.symbolizers)){for(var n=this._extent2D=new bi,r=this._fixedExtent=new bi,o=this.symbolizers.length-1;0<=o;o--){var a=this.symbolizers[o];n._combine(a.get2DExtent()),a.getFixedExtent&&r._combine(a.getFixedExtent(t))}n._zoom=i}return this._extent2D.add(this._fixedExtent)},n.prototype.getContainerExtent=function(){this._verifyProjection();var e=this.getMap(),i=e.getZoom(),n=e.getGLScale();this._extent2D&&this._extent2D._zoom===i||this.get2DExtent();var r=this.getMinAltitude(),t=e.getFrustumAltitude();if(r&&t&&t<r)return null;var o=this._extent2D.convertTo(function(t){return e._pointToContainerPoint(t,i,r/n)}),a=this.getMaxAltitude();if(a!==r){var s=this._extent2D.convertTo(function(t){return e._pointToContainerPoint(t,i,a/n)});o._combine(s)}return o&&o._add(this._fixedExtent),this.geometry.options.smoothness&&o._expand(.15*o.getWidth()),o},n.prototype.setZIndex=function(e){this._eachSymbolizer(function(t){t.setZIndex(e)})},n.prototype.show=function(){this._painted?(this.removeCache(),this._eachSymbolizer(function(t){t.show()})):this.getLayer().isCanvasRender()||this.paint()},n.prototype.hide=function(){this._eachSymbolizer(function(t){t.hide()})},n.prototype.repaint=function(){this._altAtGLZoom=this._getGeometryAltitude(),this.removeCache();var t=this.getLayer();if(t){var e=t.getRenderer();e&&e.setToRedraw()&&e.setToRedraw()}},n.prototype.refreshSymbol=function(){this.removeCache(),this._removeSymbolizers(),this.symbolizers=this._createSymbolizers()},n.prototype.remove=function(){this.removeCache(),this._removeSymbolizers()},n.prototype._removeSymbolizers=function(){this._eachSymbolizer(function(t){delete t.painter,t.remove()}),delete this.symbolizers},n.prototype.removeCache=function(){delete this._renderPoints,delete this._paintParams,delete this._sprite,delete this._extent2D,delete this._fixedExtent,delete this._cachedParams,delete this._unsimpledParams,this.geometry&&delete this.geometry[xn.CACHE_KEY]},n.prototype.getAltitude=function(){return this._getAltitudeProperty()!==this._propAlt&&(this._altAtGLZoom=this._getGeometryAltitude()),this._altAtGLZoom?this._altAtGLZoom:0},n.prototype.getMinAltitude=function(){return this.minAltitude?this.minAltitude:0},n.prototype.getMaxAltitude=function(){return this.maxAltitude?this.maxAltitude:0},n.prototype._getGeometryAltitude=function(){var i=this;if(!this.getMap())return 0;var t=this._getAltitudeProperty();if(!(this._propAlt=t))return this.minAltitude=this.maxAltitude=0,0;var n=this.geometry.getCenter();return Array.isArray(t)?(this.minAltitude=Number.MAX_VALUE,this.maxAltitude=Number.MIN_VALUE,t.map(function(t){var e=i._meterToPoint(n,t);return e<i.minAltitude&&(i.minAltitude=e),e>i.maxAltitude&&(i.maxAltitude=e),e})):(this.minAltitude=this.maxAltitude=this._meterToPoint(n,t),this.minAltitude)},n.prototype._meterToPoint=function(t,e){var i=this.getMap(),n=i.getGLZoom(),r=i.locate(t,e,0),o=i.coordToPoint(t,n),a=i.coordToPoint(r,n);return Math.abs(a.x-o.x)*N(e)},n.prototype._getAltitudeProperty=function(){var t=this.geometry,e=t.getLayer().options,i=t.getProperties();return e.enableAltitude&&i?i[e.altitudeProperty]:0},n.prototype._verifyProjection=function(){var t=this.geometry._getProjection();this._projCode&&this._projCode!==t.code&&this.removeCache(),this._projCode=t.code},n.prototype._beforePaint=function(){var t=this.geometry[xn.CACHE_KEY];if(t)for(var e in t)M(t,e)&&(t[e].active=!1)},n.prototype._afterPaint=function(){var t=this.geometry[xn.CACHE_KEY];if(t)for(var e in t)M(t,e)&&(t[e].active||delete t[e])},n}(ci);var En=function(i){function n(t){u(this,n);var e=v(this,i.call(this));return e.geometry=t,e}return m(n,i),n.prototype._eachPainter=function(t){for(var e=this.geometry.getGeometries(),i=void 0,n=0,r=e.length;n<r&&(!(i=e[n]._getPainter())||!i||!1!==t.call(this,i));n++);},n.prototype.paint=function(e){this.geometry&&this._eachPainter(function(t){t.paint(e)})},n.prototype.get2DExtent=function(e){var i=new bi;return this._eachPainter(function(t){i=i.combine(t.get2DExtent(e))}),i},n.prototype.getContainerExtent=function(){var e=new bi;return this._eachPainter(function(t){e=e.combine(t.getContainerExtent())}),e},n.prototype.remove=function(){var e=arguments;this._eachPainter(function(t){t.remove.apply(t,e)})},n.prototype.setZIndex=function(){var e=arguments;this._eachPainter(function(t){t.setZIndex.apply(t,e)})},n.prototype.show=function(){var e=arguments;this._eachPainter(function(t){t.show.apply(t,e)})},n.prototype.hide=function(){var e=arguments;this._eachPainter(function(t){t.hide.apply(t,e)})},n.prototype.repaint=function(){var e=arguments;this._eachPainter(function(t){t.repaint.apply(t,e)})},n.prototype.refreshSymbol=function(){var e=arguments;this._eachPainter(function(t){t.refreshSymbol.apply(t,e)})},n.prototype.hasPoint=function(){var e=!1;return this._eachPainter(function(t){return!t.hasPoint()||!(e=!0)}),e},n.prototype.getMinAltitude=function(){var i=!0,n=0;return this._eachPainter(function(t){var e=t.getMinAltitude();(i||e<n)&&(i=!1,n=e)}),n},n.prototype.getMaxAltitude=function(){var i=0;return this._eachPainter(function(t){var e=t.getMaxAltitude();i<e&&(i=e)}),i},n}(ci),Pn=function(a){function s(t){u(this,s);var e=_({},t),i=e.symbol,n=e.properties,r=e.id;delete e.symbol,delete e.id,delete e.properties;var o=v(this,a.call(this,e));return i&&o.setSymbol(i),n&&o.setProperties(n),Y(r)||o.setId(r),o}return m(s,a),s.prototype.getFirstCoordinate=function(){if("GeometryCollection"===this.type){var t=this.getGeometries();return t.length?t[0].getFirstCoordinate():null}var e=this.getCoordinates();if(!Array.isArray(e))return e;for(;e=e[0],Array.isArray(e)&&0<e.length;);return e},s.prototype.getLastCoordinate=function(){if("GeometryCollection"===this.type){var t=this.getGeometries();return t.length?t[t.length-1].getLastCoordinate():null}var e=this.getCoordinates();if(!Array.isArray(e))return e;for(;e=e[e.length-1],Array.isArray(e)&&0<e.length;);return e},s.prototype.addTo=function(t,e){return t.addGeometry(this,e),this},s.prototype.getLayer=function(){return this._layer?this._layer:null},s.prototype.getMap=function(){return this._layer?this._layer.getMap():null},s.prototype.getId=function(){return this._id},s.prototype.setId=function(t){var e=this.getId();return this._id=t,this._fireEvent("idchange",{old:e,new:t}),this},s.prototype.getProperties=function(){return this.properties?this.properties:this._getParent()?this._getParent().getProperties():null},s.prototype.setProperties=function(t){var e=this.properties;return this.properties=x(t)?_({},t):t,this._repaint(),this._fireEvent("propertieschange",{old:e,new:t}),this},s.prototype.getType=function(){return this.type},s.prototype.getSymbol=function(){var t=this._symbol;return t?Array.isArray(t)?zt(t):_({},t):null},s.prototype.setSymbol=function(t){return this._symbol=this._prepareSymbol(t),this.onSymbolChanged(),this},s.prototype.updateSymbol=function(t){if(!t)return this;var e=this._getSymbol();return e=zt(e||this._getInternalSymbol(),t),this.setSymbol(e)},s.prototype.getCenter=function(){return this._computeCenter(this._getMeasurer())},s.prototype.getExtent=function(){var t=this._getPrjExtent();if(t){var e=this._getProjection(),i=e.unproject(new yi(t.xmin,t.ymin)),n=e.unproject(new yi(t.xmax,t.ymax));return new wi(i,n,this._getProjection())}return this._computeExtent(this._getMeasurer())},s.prototype.getContainerExtent=function(){var t=this._getPainter();return t?t.getContainerExtent():null},s.prototype.getSize=function(){var t=this.getContainerExtent();return t?t.getSize():null},s.prototype.containsPoint=function(t,e){if(!this.getMap())throw new Error('The geometry is required to be added on a map to perform "containsPoint".');return t instanceof yi&&(t=this.getMap().coordToContainerPoint(t)),this._containsPoint(t,e)},s.prototype._containsPoint=function(t,e){var i=this._getPainter();return!!i&&(Y(e)&&this._hitTestTolerance&&(e=this._hitTestTolerance()),i.hitTest(t,e))},s.prototype.show=function(){if(this.options.visible=!0,this.getMap()){var t=this._getPainter();t&&t.show(),this._fireEvent("show")}return this},s.prototype.hide=function(){if(this.options.visible=!1,this.getMap()){this.onHide();var t=this._getPainter();t&&t.hide(),this._fireEvent("hide")}return this},s.prototype.isVisible=function(){if(!this.options.visible)return!1;var t=this._getInternalSymbol();if(!t)return!0;if(Array.isArray(t)){if(!t.length)return!0;for(var e=0,i=t.length;e<i;e++)if(Y(t[e].opacity)||0<t[e].opacity)return!0;return!1}return Y(t.opacity)||w(t.opacity)&&0<t.opacity},s.prototype.getZIndex=function(){return this.options.zIndex||0},s.prototype.setZIndex=function(t){var e=this.options.zIndex;return this.options.zIndex=t,this._fireEvent("zindexchange",{old:e,new:t}),this},s.prototype.setZIndexSilently=function(t){return this.options.zIndex=t,this},s.prototype.bringToFront=function(){var t=this.getLayer();if(!t||!t.getGeoMaxZIndex)return this;var e=t.getGeoMaxZIndex();return this.setZIndex(e+1),this},s.prototype.bringToBack=function(){var t=this.getLayer();if(!t||!t.getGeoMinZIndex)return this;var e=t.getGeoMinZIndex();return this.setZIndex(e-1),this},s.prototype.translate=function(t,e){if(Y(t))return this;var i=new yi(t,e);if(0===i.x&&0===i.y)return this;var n=this.getCoordinates();if(n)if(Array.isArray(n)){var r=k(n,function(t){return t.add(i)});this.setCoordinates(r)}else this.setCoordinates(n.add(i));return this},s.prototype.flash=function(t,e,i,n){return it.call(this,t,e,i,n)},s.prototype.copy=function(){var t=this.toJSON(),e=s.fromJSON(t);return e.options.visible=!0,e},s.prototype.remove=function(){return this.getLayer()&&(this._fireEvent("removestart"),this._unbind(),this._fireEvent("removeend"),this._fireEvent("remove")),this},s.prototype.toGeoJSONGeometry=function(){return this._exportGeoJSONGeometry()},s.prototype.toGeoJSON=function(t){t||(t={});var e={type:"Feature",geometry:null};if(Y(t.geometry)||t.geometry){var i=this._exportGeoJSONGeometry();e.geometry=i}var n=this.getId();Y(n)||(e.id=n);var r=void 0;return(Y(t.properties)||t.properties)&&(r=this._exportProperties()),e.properties=r,e},s.prototype.toJSON=function(t){t||(t={});var e=this._toJSON(t);return _(e,this._exportGraphicOptions(t)),e},s.prototype.getLength=function(){return this._computeGeodesicLength(this._getMeasurer())},s.prototype.getArea=function(){return this._computeGeodesicArea(this._getMeasurer())},s.prototype.rotate=function(e,i){if("GeometryCollection"===this.type)return this.getGeometries().forEach(function(t){return t.rotate(e,i)}),this;i=i?new yi(i):this.getCenter();var n=this._getMeasurer(),t=this.getCoordinates();if(!Array.isArray(t)){if(i.x!==t.x||i.y!==t.y){var r=n._rotate(t,i,e);this.setCoordinates(r)}return this}return k(t,function(t){return n._rotate(t,i,e)}),this.setCoordinates(t),this},s.prototype._getConnectPoints=function(){return[this.getCenter()]},s.prototype._initOptions=function(t){var e=_({},t),i=e.symbol,n=e.properties,r=e.id;delete e.symbol,delete e.id,delete e.properties,this.setOptions(e),i&&this.setSymbol(i),n&&this.setProperties(n),Y(r)||this.setId(r)},s.prototype._bindLayer=function(t){if(this.getLayer())throw new Error("Geometry cannot be added to two or more layers at the same time.");this._layer=t,this._clearCache(),this._clearProjection()},s.prototype._prepareSymbol=function(t){if(Array.isArray(t)){for(var e=[],i=0;i<t.length;i++)e.push(Lt(this._checkAndCopySymbol(t[i])));return e}return t?Lt(t=this._checkAndCopySymbol(t)):null},s.prototype._checkAndCopySymbol=function(t){var e={};for(var i in t)n[i]&&S(t[i])?e[i]=+t[i]:e[i]=t[i];return e},s.prototype._getSymbol=function(){return this._symbol},s.prototype._setExternSymbol=function(t){return this._externSymbol=this._prepareSymbol(t),this.onSymbolChanged(),this},s.prototype._getInternalSymbol=function(){return this._symbol?this._symbol:this._externSymbol?this._externSymbol:this.options.symbol?this.options.symbol:null},s.prototype._getPrjExtent=function(){var t=this._getProjection();return this._verifyProjection(),!this._extent&&t&&(this._extent=this._computePrjExtent(t)),this._extent},s.prototype._unbind=function(){var t=this.getLayer();t&&(this._animPlayer&&this._animPlayer.finish(),this._clearHandlers(),this._unbindMenu(),this._unbindInfoWindow(),this.isEditing()&&this.endEdit(),this._removePainter(),this.onRemove&&this.onRemove(),t.onRemoveGeometry&&t.onRemoveGeometry(this),delete this._layer,delete this._internalId,delete this._extent)},s.prototype._getInternalId=function(){return this._internalId},s.prototype._setInternalId=function(t){this._internalId=t},s.prototype._getMeasurer=function(){return this._getProjection()?this._getProjection():$i.getProjectionInstance(this.options.defaultProjection)},s.prototype._getProjection=function(){var t=this.getMap();return t?t.getProjection():null},s.prototype._verifyProjection=function(){var t=this._getProjection();!this._projCode||t&&this._projCode===t.code||this._clearProjection(),this._projCode=t?t.code:null},s.prototype._getExternalResources=function(){return Pt(this._getInternalSymbol())},s.prototype._getPainter=function(){return!this._painter&&this.getMap()&&(-1!==e.indexOf(this.type)?this._painter=new En(this):this._painter=new An(this)),this._painter},s.prototype._removePainter=function(){this._painter&&this._painter.remove(),delete this._painter},s.prototype._paint=function(t){this._painter&&this._painter.paint(t)},s.prototype._clearCache=function(){delete this._extent},s.prototype._clearProjection=function(){delete this._extent},s.prototype._repaint=function(){this._painter&&this._painter.repaint()},s.prototype.onHide=function(){this.closeMenu(),this.closeInfoWindow()},s.prototype.onShapeChanged=function(){this._clearCache(),this._repaint(),this._fireEvent("shapechange")},s.prototype.onPositionChanged=function(){this._clearCache(),this._repaint(),this._fireEvent("positionchange")},s.prototype.onSymbolChanged=function(){this._painter&&this._painter.refreshSymbol(),this._fireEvent("symbolchange")},s.prototype.onConfig=function(t){var e=void 0;t.properties&&(e=t.properties,delete t.properties);var i=!1;for(var n in t)if(t.hasOwnProperty(n)){var r=n.slice(0,5);if("arrow"===r||"smoot"===r){i=!0;break}}e?(this.setProperties(e),this._repaint()):i&&this._repaint()},s.prototype._setParent=function(t){t&&(this._parent=t)},s.prototype._getParent=function(){return this._parent},s.prototype._fireEvent=function(t,e){this.getLayer()&&this.getLayer()._onGeometryEvent&&(e||(e={}),e.type=t,(e.target=this).getLayer()._onGeometryEvent(e)),this.fire(t,e)},s.prototype._toJSON=function(t){return{feature:this.toGeoJSON(t)}},s.prototype._exportGraphicOptions=function(t){var e={};return(Y(t.options)||t.options)&&(e.options=this.config()),(Y(t.symbol)||t.symbol)&&(e.symbol=this.getSymbol()),(Y(t.infoWindow)||t.infoWindow)&&this._infoWinOptions&&(e.infoWindow=this._infoWinOptions),e},s.prototype._exportGeoJSONGeometry=function(){var t=this.getCoordinates(),e=yi.toNumberArrays(t);return{type:this.getType(),coordinates:e}},s.prototype._exportProperties=function(){var t=null,e=this.getProperties();return Y(e)||(t=x(e)?_({},e):e),t},s}(di(li(pi(ci))));Pn.mergeOptions({id:null,visible:!0,editable:!0,cursor:null,defaultProjection:"EPSG:4326"});var Ln="mousedown mouseup mousemove click dblclick contextmenu touchstart touchmove touchend",In=function(t){function e(){return u(this,e),v(this,t.apply(this,arguments))}return m(e,t),e.prototype.addHooks=function(){var t=this.target,e=t._panels.allLayers||t._containerDOM;Qe(e,Ln,this._identifyGeometryEvents,this)},e.prototype.removeHooks=function(){var t=this.target,e=t._panels.allLayers||t._containerDOM;$e(e,Ln,this._identifyGeometryEvents,this)},e.prototype._identifyGeometryEvents=function(u,t){var d=this.target;if(!d.isInteracting()&&!d._ignoreEvent(u)){var e=d._getLayers(function(t){return!(!t.identify||!t.options.geometryEvents)});if(e.length){var p=null,f=t||u.type;if("mousedown"===f||"touchstart"===f&&1===u.touches.length)this._mouseDownTime=y();else if(("click"===f||"touchend"===f)&&this._mouseDownTime){var i=this._mouseDownTime;if(delete this._mouseDownTime,300<y()-i){if("click"===f)return}else"touchend"===f&&(p="click")}var n=u.touches&&0<u.touches.length?u.touches[0]:u.changedTouches&&0<u.changedTouches.length?u.changedTouches[0]:u;if(n){var r=He(n,d._containerDOM),o=d.containerPointToCoordinate(r);"touchstart"===f&&Ne(u);var g=null,a={includeInternals:!0,filter:function(t){if(!(t instanceof Pn))return!1;var e=t._getEventTypeToFire(u);if("mousemove"===f){if(!g&&t.options.cursor&&(g=t.options.cursor),!t.listens("mousemove")&&!t.listens("mouseover")&&!t.listens("mouseenter"))return!1}else if(!t.listens(e)&&!t.listens(p))return!1;return!0},count:1,coordinate:o,onlyVisible:d.options.onlyVisibleGeometryEvents,layers:e},s=function(t){var e=!0;if("mousemove"===f){var i={};if(0<t.length)for(var n=t.length-1;0<=n;n--){var r=t[n];if(r instanceof Pn){var o=r._getInternalId();(i[o]=r)._onEvent(u),this._prevOverGeos&&this._prevOverGeos.geomap[o]||r._onEvent(u,"mouseenter"),e=r._onEvent(u,"mouseover")}}d._setPriorityCursor(g);var a=this._prevOverGeos&&this._prevOverGeos.geos;if(this._prevOverGeos={geos:t,geomap:i},a&&0<a.length)for(var s=a.length-1;0<=s;s--){var l=a[s];if(l instanceof Pn){var h=a[s]._getInternalId();i[h]||(e=l._onEvent(u,"mouseout"))}}}else{if(!t||!t.length)return;for(var c=t.length-1;0<=c;c--)if(t[c]instanceof Pn){e=t[c]._onEvent(u),p&&t[c]._onEvent(u,p);break}}!1===e&&Be(u)}.bind(this);this._queryIdentifyTimeout&&c(this._queryIdentifyTimeout),"mousemove"===f||"touchmove"===f?this._queryIdentifyTimeout=h(function(){d.isInteracting()||d.identify(a,s)}):d.identify(a,s)}}}},e}(hi);en.mergeOptions({geometryEvents:!0,onlyVisibleGeometryEvents:!0}),en.addOnLoadHook("addHandler","geometryEvents",In);var Rn=function(t){function e(){return u(this,e),v(this,t.apply(this,arguments))}return m(e,t),e.prototype.addHooks=function(){Oe(this.target._containerDOM,"mousewheel",this._onWheelScroll,this)},e.prototype.removeHooks=function(){ke(this.target._containerDOM,"mousewheel",this._onWheelScroll)},e.prototype._onWheelScroll=function(e){var i=this,n=this.target;if(n._ignoreEvent(e)||!n.options.zoomable)return!1;if(Ne(e),Be(e),this._zooming)return this._requesting++,!1;this._requesting=0;var t=n._containerDOM,r=0<(e.wheelDelta?e.wheelDelta:e.detail)?1:-1;e.detail&&(r*=-1);var o=n.getZoom(),a=o+r;if((a=n._checkZoom(0<r?Math.ceil(a):Math.floor(a)))===o)return!1;this._zooming=!0;var s=n._checkZoomOrigin(He(e,t));this._delta||(n.onZoomStart(null,s),this._origin=s,this._delta=r,this._startZoom=n.getZoom());return n.animateTo({zoom:a-1*this._delta/2,around:this._origin},{continueOnViewChanged:!0,easing:"linear",duration:90,wheelZoom:!0},function(t){"finished"===t.state.playState&&(i._requesting<1||2<Math.abs(a-i._startZoom)||a===n.getMaxZoom()||a===n.getMinZoom()?(n.animateTo({zoom:a,around:i._origin},{continueOnViewChanged:!0,duration:100},function(t){"finished"===t.state.playState&&setTimeout(function(){delete i._zooming,delete i._requesting},200)}),delete i._startZoom,delete i._origin,delete i._delta,i._requesting=0):Y(i._requesting)||(delete i._zooming,i._onWheelScroll(e)))}),!1},e}(hi);en.mergeOptions({scrollWheelZoom:!0}),en.addOnLoadHook("addHandler","scrollWheelZoom",Rn);var Dn=function(t){function e(){return u(this,e),v(this,t.apply(this,arguments))}return m(e,t),e.prototype.addHooks=function(){Oe(this.target.getContainer(),"touchstart",this._onTouchStart,this)},e.prototype.removeHooks=function(){ke(this.target.getContainer(),"touchstart",this._onTouchStart)},e.prototype._onTouchStart=function(t){var e=this.target;if(t.touches&&2===t.touches.length&&!e.isInteracting()){var i=e.getContainer(),n=He(t.touches[0],i),r=He(t.touches[1],i);this.preY=n.y,this._startP1=n,this._startP2=r,this._startDist=n.distanceTo(r),this._startVector=n.sub(r),this._startZoom=e.getZoom(),this._startBearing=e.getBearing(),Oe(document,"touchmove",this._onTouchMove,this),Oe(document,"touchend",this._onTouchEnd,this),Ne(t),e._fireEvent("touchactstart")}},e.prototype._onTouchMove=function(t){var e=this.target;if(t.touches&&2===t.touches.length){var i=e.getContainer(),n=He(t.touches[0],i),r=He(t.touches[1],i),o=n.sub(this._startP1),a=r.sub(this._startP2),s=n.sub(r),l=n.distanceTo(r)/this._startDist,h=180*s.angleWith(this._startVector)/Math.PI,c=.4*((this.preY||n.y)-n.y);this.preY=n.y;var u={domEvent:t,mousePos:[n,r]};if(this.mode||(e.options.touchRotate&&8<Math.abs(h)?this.mode=e.options.touchZoomRotate?"rotate_zoom":"rotate":e.options.touchPitch&&0<o.y*a.y&&10<Math.abs(o.y)&&10<Math.abs(a.y)?this.mode="pitch":e.options.zoomable&&e.options.touchZoom&&.15<Math.abs(1-l)&&(this.mode=e.options.touchZoomRotate&&e.options.touchRotate?"rotate_zoom":"zoom"),this._startTouching(u)),"zoom"===this.mode||"rotate_zoom"===this.mode){this._scale=l;var d=e._getResolution(this._startZoom)/l,p=e.getZoomFromRes(d);e.onZooming(p,this._Origin)}"rotate"===this.mode||"rotate_zoom"===this.mode?(e.setBearing(this._startBearing+h),e.onDragRotating(u)):"pitch"===this.mode&&(e.setPitch(e.getPitch()+c),e.onDragRotating(u)),e._fireEvent("touchactinging")}},e.prototype._startTouching=function(t){var e=this.target;if("zoom"===this.mode||"rotate_zoom"===this.mode){var i=e.getSize();this._Origin=new le(i.width/2,i.height/2),e.onZoomStart(null,this._Origin)}"rotate"!==this.mode&&"pitch"!==this.mode&&"rotate_zoom"!==this.mode||e.onDragRotateStart(t)},e.prototype._onTouchEnd=function(t){delete this.preY;var e=this.target;if($e(document,"touchmove",this._onTouchMove,this),$e(document,"touchend",this._onTouchEnd,this),"zoom"===this.mode||"rotate_zoom"===this.mode){var i=this._scale,n=e._getResolution(this._startZoom)/i,r=e.getZoomFromRes(n);e.onZoomEnd(r,this._Origin)}"pitch"!==this.mode&&"rotate"!==this.mode&&"rotate_zoom"!==this.mode||e.onDragRotateEnd({domEvent:t}),delete this.mode,e._fireEvent("touchactend")},e}(hi);en.mergeOptions({touchGesture:!0,touchZoom:!0,touchPitch:!0,touchRotate:!0,touchZoomRotate:!1}),en.addOnLoadHook("addHandler","touchGesture",Dn);var On={in:function(t){return Math.pow(t,2)},out:function(t){return 1-On.in(1-t)},inAndOut:function(t){return 3*t*t-2*t*t*t},linear:function(t){return t},upAndDown:function(t){return t<.5?On.inAndOut(2*t):1-On.inAndOut(2*(t-.5))}},kn=function t(e,i){u(this,t),this.state=e,this.styles=i},zn=function t(e,i,n){u(this,t),this._animation=e,this.options=i,this._onFrame=n,this.playState="idle",this.ready=!0,this.finished=!1},Nn={speed:{slow:2e3,normal:1e3,fast:500},_resolveStyles:function(t){if(!t)return null;function e(t){if(!Array.isArray(t))return Nn._resolveStyles(t);for(var e=[],i=[],n=[],r=0;r<t.length;r++){var o=Nn._resolveStyles(t[r]);o&&(e.push(o[0]),i.push(o[1]),n.push(o[2]))}return e.length?[e,i,n]:null}function i(t){var e=t,i=void 0;Array.isArray(t)||(e=w(t)?[0,t]:t instanceof le||t instanceof yi?[new(i=t.constructor)(0,0),t]:[t,t]);var n=e[0],r=e[1];return w(n)&&w(r)?n===r?null:[n,r-n,r]:Array.isArray(n)||n instanceof yi||n instanceof le?(Array.isArray(n)?(n=new yi(n),r=new yi(r)):(n=new(i=n.constructor)(n),r=new i(r)),n.equals(r)?null:[n,r.sub(n),r]):[n,0,r]}var n,r={},o={},a={};for(var s in t)if(t.hasOwnProperty(s)){var l=t[s];if(!l)continue;if(Array.isArray(l)&&(Y(l[0])||Y(l[1])))continue;var h=void 0;n=l,(h=!Array.isArray(n)&&n.constructor===Object||Array.isArray(n)&&n[0].constructor===Object?e(l):i(l))&&(o[s]=h[0],r[s]=h[1],a[s]=h[2])}return[o,r,a]},framing:function(t,e){e||(e={});var o=e.easing?On[e.easing]:On.linear;o||(o=On.linear);var a=void 0,s=void 0,c=void 0;(t=Nn._resolveStyles(t))&&(s=t[0],a=t[1],c=t[2]);return function(t,e){var i=void 0,n=void 0;if(t<0)i={playState:"idle",delta:0},n=s;else if(t<e){var r=o(t/e);i={playState:"running",delta:r},n=function t(e,i,n){if(!i||!n)return null;var r={};for(var o in n)if(n.hasOwnProperty(o)){if(i[o]===c[o]){r[o]=i[o];continue}var a=i[o],s=n[o];if(w(s))r[o]=a+e*s;else if(Array.isArray(s)){for(var l=[],h=0;h<s.length;h++)l.push(t(e,a[h],s[h]));r[o]=l}else s.constructor===Object?r[o]=t(e,a,s):(a instanceof le||a instanceof yi)&&(r[o]=a.add(s.multi(e)))}return r}(r,s,a)}else i={playState:"finished",delta:1},n=c;return i.startStyles=s,i.destStyles=c,i.progress=t,i.remainingMs=e-t,new kn(i,n)}},_requestAnimFrame:function(t){this._frameQueue||(this._frameQueue=[]),this._frameQueue.push(t),this._a()},_a:function(){this._animationFrameId||(this._animationFrameId=h(Nn._frameFn))},_run:function(){if(this._frameQueue.length){var t=this._frameQueue;this._frameQueue=[];for(var e=0,i=t.length;e<i;e++)t[e]();this._frameQueue.length?this._animationFrameId=h(Nn._frameFn):delete this._animationFrameId}},animate:function(t,e,i){e||(e={});var n=Nn.framing(t,e);return new zn(n,e,i)}};Nn._frameFn=Nn._run.bind(Nn),_(zn.prototype,{_prepare:function(){var t=this.options,e=t.speed||t.duration;S(e)&&((e=Nn.speed[e])||(e=+e)),e||(e=Nn.speed.normal),this.duration=e,this._framer=t.framer||Nn._requestAnimFrame.bind(Nn)},play:function(){if("idle"!==this.playState&&"paused"!==this.playState)return this;"idle"===this.playState&&(this.currentTime=0,this._prepare());var t=y();if(!this.startTime){var e=this.options;this.startTime=e.startTime?e.startTime:t}return this._playStartTime=Math.max(t,this.startTime),"paused"===this.playState&&(this._playStartTime-=this.currentTime),this.playState="running",this._run(),this},pause:function(){return"paused"===this.playState||(this.playState="paused",this._run()),this},cancel:function(){return"idle"===this.playState||(this.playState="idle",this.finished=!1,this._run()),this},finish:function(){return"finished"===this.playState||(this.playState="finished",this.finished=!0,this._run()),this},reverse:function(){},_run:function(){var t=this,e=this._onFrame,i=y(),n=i-this._playStartTime;if(this.options.repeat&&n>=this.duration&&(this._playStartTime=i,n=0),"running"===this.playState){var r=this._animation(n,this.duration);this.playState=r.state.playState,"idle"===this.playState?this.startTime>i&&setTimeout(this._run.bind(this),this.startTime-i):"running"===this.playState?this._framer(function(){"running"===t.playState&&(t.currentTime=n,e&&e(r),t._run())}):"finished"===this.playState&&(this.finished=!0,e&&e(r))}else if(e){"finished"===this.playState?n=this.duration:"idle"===this.playState&&(n=0);var o=this._animation(n,this.duration);o.state.playState=this.playState,e(o)}}});var Bn=Object.freeze({Animation:Nn,Easing:On,Player:zn,Frame:kn}),Fn=ji(function(e){!function(){function c(t,e,i){var n=e.x,r=e.y,o=i.x-n,a=i.y-r;if(0!==o||0!==a){var s=((t.x-n)*o+(t.y-r)*a)/(o*o+a*a);1<s?(n=i.x,r=i.y):0<s&&(n+=o*s,r+=a*s)}return(o=t.x-n)*o+(a=t.y-r)*a}function r(t,e){var i=t.length-1,n=[t[0]];return function t(e,i,n,r,o){for(var a,s=r,l=i+1;l<n;l++){var h=c(e[l],e[i],e[n]);s<h&&(a=l,s=h)}r<s&&(1<a-i&&t(e,i,a,r,o),o.push(e[a]),1<n-a&&t(e,a,n,r,o))}(t,0,i,e,n),n.push(t[i]),n}function t(t,e,i){if(t.length<=2)return t;var n=void 0!==e?e*e:1;return t=r(t=i?t:function(t,e){for(var i,n,r,o,a,s=t[0],l=[s],h=1,c=t.length;h<c;h++)i=t[h],r=s,o=(n=i).x-r.x,a=n.y-r.y,e<o*o+a*a&&(l.push(i),s=i);return s!==i&&l.push(i),l}(t,n),n)}e.exports=t,e.exports.default=t}()}),Gn=function(t){function e(){return u(this,e),v(this,t.apply(this,arguments))}return m(e,t),e.prototype.getOutline=function(){var t=this._getPainter();if(!t)return null;var e=this.getMap(),i=t.getContainerExtent().convertTo(function(t){return e.containerPointToCoord(t)});return new Hn(i.toArray(),{symbol:{lineWidth:1,lineColor:"6b707b"}})},e.prototype.animateShow=function(){var n=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},r=arguments[1];this._showPlayer&&this._showPlayer.finish(),b(t)&&(r=t={});var o=this.getCoordinates();if(0===o.length)return this;this._animIdx=0,this._animLenSoFar=0,this.show();var a=!!this.getShell?this.getShell().concat(this.getShell()[0]):this.getCoordinates(),e=this._getProjection();this._aniShowCenter=e.unproject(this._getPrjExtent().getCenter());var s=t.duration||1e3,l=this.getLength(),i=t.easing||"out";this.setCoordinates([]);var h=this._showPlayer=Nn.animate({t:s},{duration:s,easing:i},function(t){if(n.getMap()){var e=n._drawAnimShowFrame(t.styles.t,s,l,a);"finished"===t.state.playState&&(delete n._showPlayer,delete n._aniShowCenter,delete n._animIdx,delete n._animLenSoFar,n.setCoordinates(o)),r&&r(t,e)}else if("finished"!==h.playState&&(h.finish(),r)){var i=n.getCoordinates();r(t,i[i.length-1])}});return h.play(),h},e.prototype._drawAnimShowFrame=function(t,e,i,n){if(0===t)return n[0];var r,o=this.getMap(),a=t/e*i,s=0,l=void 0;for(l=this._animIdx,r=n.length;l<r-1&&(s=o.computeLength(n[l],n[l+1]),!(this._animLenSoFar+s>a));l++)this._animLenSoFar+=s;if(this._animIdx=l,this._animIdx>=r-1)return this.setCoordinates(n),n[n.length-1];var h=this._animIdx,c=n[h],u=n[h+1],d=(a-this._animLenSoFar)/s,p=c.x+(u.x-c.x)*d,f=c.y+(u.y-c.y)*d,g=new yi(p,f),m=n.slice(0,this._animIdx+1);return m.push(g),!!this.getShell?this.setCoordinates([this._aniShowCenter].concat(m)):this.setCoordinates(m),m[m.length-1]},e.prototype._getCenterInExtent=function(t,e,i){var n=this.getExtent();if(!t.intersects(n))return null;var r=i(e,t);if(0===r.length)return null;var o=0,a=0,s=0;r.forEach(function(t){Array.isArray(t)?t.forEach(function(t){t.point&&(t=t.point),o+=t.x,a+=t.y,s++}):(t.point&&(t=t.point),o+=t.x,a+=t.y,s++)});var l=new yi(o,a)._multi(1/s);return l.count=s,l},e.prototype._getPath2DPoints=function(t,e,i){if(!H(t))return[];var n=this.getMap(),r=!e&&this._shouldSimplify(),o=2*n._getResolution(),a=Array.isArray(t[0]);if(delete this._simplified,r&&!a){var s=t.length;t=Fn(t,o,!1),this._simplified=t.length<s}return Y(i)&&(i=n.getZoom()),k(t,function(t){return n._prjToPoint(t,i)})},e.prototype._shouldSimplify=function(){var t=this.getLayer(),e=this.getProperties(),i=e&&t.options.enableAltitude&&!Y(e[t.options.altitudeProperty]);return t&&t.options.enableSimplify&&!i&&this.options.enableSimplify},e.prototype._setPrjCoordinates=function(t){this._prjCoords=t,this.onShapeChanged()},e.prototype._getPrjCoordinates=function(){return this._getProjection()?(this._verifyProjection(),this._prjCoords||(this._prjCoords=this._projectCoords(this._coordinates)),this._prjCoords):null},e.prototype._updateCache=function(){this._clearCache(),this._getProjection()&&this._prjCoords&&(this._coordinates=this._unprojectCoords(this._getPrjCoordinates()))},e.prototype._clearProjection=function(){this._prjCoords=null,t.prototype._clearProjection.call(this)},e.prototype._projectCoords=function(t){var e=this._getProjection();return e?e.projectCoords(t):[]},e.prototype._unprojectCoords=function(t){var e=this._getProjection();return e?e.unprojectCoords(t):[]},e.prototype._computeCenter=function(){var t=this._coordinates;if(!H(t))return null;for(var e=0,i=0,n=0,r=t.length,o=0;o<r;o++)t[o]&&w(t[o].x)&&w(t[o].y)&&(e+=t[o].x,i+=t[o].y,n++);return new yi(e/n,i/n)},e.prototype._computeExtent=function(){var t=this._coordinates;if(!H(t))return null;var e=[t];return this.hasHoles&&this.hasHoles()&&e.push.apply(e,this.getHoles()),this._coords2Extent(e,this._getProjection())},e.prototype._computePrjExtent=function(){var t=[this._getPrjCoordinates()];return this.hasHoles&&this.hasHoles()&&t.push.apply(t,this._getPrjHoles()),this._coords2Extent(t)},e.prototype._get2DLength=function(){for(var t=this._getPath2DPoints(this._getPrjCoordinates(),!0),e=0,i=1,n=t.length;i<n;i++)e+=t[i].distanceTo(t[i-1]);return e},e.prototype._hitTestTolerance=function(){var t=this._getInternalSymbol(),e=void 0;if(Array.isArray(t))for(var i=e=0;i<t.length;i++)w(t[i].lineWidth)&&t[i].lineWidth>e&&(e=t[i].lineWidth);else e=t.lineWidth;return w(e)?e/2:1.5},e.prototype._coords2Extent=function(t,e){for(var i=new wi(e),n=0,r=t.length;n<r;n++)for(var o=0,a=t[n].length;o<a;o++)i._combine(t[n][o]);return i},e}(Pn);Gn.mergeOptions({smoothness:0,enableClip:!0,enableSimplify:!0,symbol:{lineColor:"#000",lineWidth:2,lineOpacity:1,polygonFill:"#fff",polygonOpacity:1,opacity:1}});var Vn="Polygon",Hn=function(n){function r(t,e){u(this,r);var i=v(this,n.call(this,e));return i.type="Polygon",t&&i.setCoordinates(t),i}return m(r,n),r.prototype.setCoordinates=function(t){if(!t)return this._coordinates=null,this._holes=null,this._projectRings(),this;var e=yi.toCoordinates(t),i=e.length;if(Array.isArray(e[0])){if(this._coordinates=this._trimRing(e[0]),1<i){for(var n=[],r=1;r<i;r++)e[r]&&n.push(this._trimRing(e[r]));this._holes=n}}else this._coordinates=this._trimRing(e);return this._projectRings(),this},r.prototype.getCoordinates=function(){if(!this._coordinates)return[];for(var t=this.getHoles(),e=[this._copyAndCloseRing(this._coordinates)],i=0,n=t.length;i<n;i++)e.push(this._copyAndCloseRing(t[i]));return e},r.prototype.getCenterInExtent=function(t){return this._getCenterInExtent(t,this.getShell(),ln)},r.prototype.getShell=function(){return this._coordinates||[]},r.prototype.getHoles=function(){return this._holes||[]},r.prototype.hasHoles=function(){return 0<this.getHoles().length},r.prototype._projectRings=function(){this.getMap()&&(this._prjCoords=this._projectCoords(this._coordinates),this._prjHoles=this._projectCoords(this._holes)),this.onShapeChanged()},r.prototype._cleanRing=function(t){for(var e=t.length-1;0<=e;e--)t[e]||t.splice(e,1)},r.prototype._checkRing=function(t){if(this._cleanRing(t),!t||!H(t))return!1;var e=t[t.length-1],i=!0;return t[0].x===e.x&&t[0].y===e.y||(i=!1),i},r.prototype._trimRing=function(t){var e=this._checkRing(t);return H(t)&&e&&t.splice(t.length-1,1),t},r.prototype._copyAndCloseRing=function(t){t=t.slice(0);var e=this._checkRing(t);return H(t)&&!e&&t.push(t[0].copy()),t},r.prototype._getPrjShell=function(){return this.getJSONType()===Vn?this._getPrjCoordinates():this._getProjection()?(this._verifyProjection(),this._prjShell||(this._prjShell=this._projectCoords(this.getShell())),this._prjShell):null},r.prototype._getPrjHoles=function(){return this._getProjection()?(this._verifyProjection(),this._prjHoles||(this._prjHoles=this._projectCoords(this.getHoles())),this._prjHoles):null},r.prototype._computeGeodesicLength=function(t){var e=this.getCoordinates();if(!H(e))return 0;for(var i=0,n=0,r=e.length;n<r;n++)i+=t.measureLength(e[n]);return i},r.prototype._computeGeodesicArea=function(t){var e=this.getCoordinates();if(!H(e))return 0;for(var i=t.measureArea(e[0]),n=1,r=e.length;n<r;n++)i-=t.measureArea(e[n]);return i},r.prototype._updateCache=function(){n.prototype._updateCache.call(this),this._prjHoles&&(this._holes=this._unprojectCoords(this._getPrjHoles()))},r.prototype._clearCache=function(){return delete this._prjShell,n.prototype._clearCache.call(this)},r.prototype._clearProjection=function(){this._prjHoles&&(this._prjHoles=null),this._prjShell&&(this._prjShell=null),n.prototype._clearProjection.call(this)},r}(Gn);Hn.registerJSONType(Vn);var Un=function(t){return function(t){function e(){return u(this,e),v(this,t.apply(this,arguments))}return m(e,t),e.prototype.getCoordinates=function(){return this._coordinates},e.prototype.setCoordinates=function(t){var e=t instanceof yi?t:new yi(t);if(e.equals(this._coordinates))return this;if(this._coordinates=e,!this.getMap())return this.onPositionChanged(),this;var i=this._getProjection();return this._setPrjCoordinates(i.project(this._coordinates)),this},e.prototype._getCenter2DPoint=function(t){var e=this.getMap();if(!e)return null;var i=Y(t)?e.getZoom():e.getGLZoom(),n=this._getPrjCoordinates();return n?e._prjToPoint(n,i):null},e.prototype._getPrjCoordinates=function(){var t=this._getProjection();return t?(this._verifyProjection(),this._pcenter||this._coordinates&&(this._pcenter=t.project(this._coordinates)),this._pcenter):null},e.prototype._setPrjCoordinates=function(t){this._pcenter=t,this.onPositionChanged()},e.prototype._updateCache=function(){this._clearCache();var t=this._getProjection();this._pcenter&&t&&(this._coordinates=t.unproject(this._pcenter))},e.prototype._clearProjection=function(){this._pcenter=null,t.prototype._clearProjection.call(this)},e.prototype._computeCenter=function(){return this._coordinates?this._coordinates.copy():null},e}(t)},Wn=function(n){function r(t,e){u(this,r);var i=v(this,n.call(this,e));return i.type="Point",t&&i.setCoordinates(t),i}return m(r,n),r.prototype.getOutline=function(){var t=this._getPainter();if(!t)return null;var e=this.getCoordinates(),i=t.getContainerExtent(),n=this.getMap().coordToContainerPoint(e);return new r(e,{symbol:{markerType:"square",markerWidth:i.getWidth(),markerHeight:i.getHeight(),markerLineWidth:1,markerLineColor:"6b707b",markerFill:"rgba(0, 0, 0, 0)",markerDx:i.xmin-(n.x-i.getWidth()/2),markerDy:i.ymin-(n.y-i.getHeight()/2)}})},r.prototype._isVectorMarker=function(){var t=this._getInternalSymbol();return!Array.isArray(t)&&gn.test(t)},r.prototype._canEdit=function(){var t=this._getInternalSymbol();return!Array.isArray(t)&&(gn.test(t)||wn.test(t)||vn.test(t))},r.prototype._containsPoint=function(t,e){var i=this.getContainerExtent();return e&&(i=i.expand(e)),!!i.contains(t)&&(!this.options.hitTestForEvent||n.prototype._containsPoint.call(this,t,e))},r.prototype._computeExtent=function(){return jn.call(this,"getCenter")},r.prototype._computePrjExtent=function(){return jn.call(this,"_getPrjCoordinates")},r.prototype._computeGeodesicLength=function(){return 0},r.prototype._computeGeodesicArea=function(){return 0},r.prototype._getSprite=function(t,e){return this._getPainter()?this._getPainter().getSprite(t,e):new An(this).getSprite(t,e)},r}(Un(Pn));function jn(t){var e=this[t]();return e?new wi(e,e,this._getProjection()):null}Wn.mergeOptions({symbol:{markerType:"path",markerPath:[{path:"M8 23l0 0 0 0 0 0 0 0 0 0c-4,-5 -8,-10 -8,-14 0,-5 4,-9 8,-9l0 0 0 0c4,0 8,4 8,9 0,4 -4,9 -8,14z M3,9 a5,5 0,1,0,0,-0.9Z",fill:"#DE3333"}],markerPathWidth:16,markerPathHeight:23,markerWidth:24,markerHeight:34},hitTestForEvent:!1}),Wn.registerJSONType("Marker");var Zn=function(n){function r(t,e){u(this,r);var i=v(this,n.call(this,e));return i.type="LineString",t&&i.setCoordinates(t),i}return m(r,n),r.prototype.setCoordinates=function(t){return t?(this._coordinates=yi.toCoordinates(t),this.getMap()?this._setPrjCoordinates(this._projectCoords(this._coordinates)):this.onShapeChanged()):(this._coordinates=null,this._setPrjCoordinates(null)),this},r.prototype.getCoordinates=function(){return this._coordinates||[]},r.prototype.getCenterInExtent=function(t){return this._getCenterInExtent(t,this.getCoordinates(),on)},r.prototype._computeGeodesicLength=function(t){return t.measureLength(this.getCoordinates())},r.prototype._computeGeodesicArea=function(){return 0},r}(Gn);Zn.mergeOptions({arrowStyle:null,arrowPlacement:"vertex-last"}),Zn.registerJSONType("LineString");var Xn=function(n){function a(t,e){u(this,a);var i=v(this,n.call(this,e));return i.type="GeometryCollection",i.setGeometries(t),i}return m(a,n),a.prototype.setGeometries=function(t){for(var e=this._checkGeometries(t||[]),i=this._getSymbol(),n=this.config(),r=e.length-1;0<=r;r--)e[r]._initOptions(n),e[r]._setParent(this),e[r]._setEventParent(this),i&&e[r].setSymbol(i);return this._geometries=e,this.getLayer()&&(this._bindGeometriesToLayer(),this.onShapeChanged()),this},a.prototype.getGeometries=function(){return this._geometries||[]},a.prototype.forEach=function(t,e){for(var i=this.getGeometries(),n=0,r=i.length;n<r;n++)i[n]&&(e?t.call(e,i[n],n):t(i[n],n));return this},a.prototype.filter=function(t,i){if(!t)return new a;var n=[],r=b(t),o=r?t:rt(t);return this.forEach(function(t){var e=r?t:pt(t);(i?o.call(i,e):o(e))&&n.push(t)},this),new a(n)},a.prototype.translate=function(t){if(!t)return this;if(this.isEmpty())return this;var e=arguments;return this.forEach(function(t){t&&t.translate&&t.translate.apply(t,e)}),this},a.prototype.isEmpty=function(){return!H(this.getGeometries())},a.prototype.remove=function(){return this.forEach(function(t){t._unbind()}),Pn.prototype.remove.apply(this,arguments)},a.prototype.show=function(){return this.options.visible=!0,this.forEach(function(t){t.show()}),this},a.prototype.hide=function(){return this.options.visible=!1,this.forEach(function(t){t.hide()}),this},a.prototype.onConfig=function(e){this.forEach(function(t){t.config(e)})},a.prototype.getSymbol=function(){var t=n.prototype.getSymbol.call(this);if(!t){var e=[],i=!1;this.forEach(function(t){t.getSymbol()&&!i&&(i=!0),e.push(t.getSymbol())}),i&&(t={children:e})}return t},a.prototype.setSymbol=function(i){if(i&&i.children)this._symbol=null,this.forEach(function(t,e){t.setSymbol(i.children[e])});else{var e=this._prepareSymbol(i);this._symbol=e,this.forEach(function(t){t.setSymbol(e)})}return this.onSymbolChanged(),this},a.prototype._setExternSymbol=function(e){return e=this._prepareSymbol(e),this._externSymbol=e,this.forEach(function(t){t._setExternSymbol(e)}),this.onSymbolChanged(),this},a.prototype._bindLayer=function(){n.prototype._bindLayer.apply(this,arguments),this._bindGeometriesToLayer()},a.prototype._bindGeometriesToLayer=function(){var e=this.getLayer();this.forEach(function(t){t._bindLayer(e)})},a.prototype._checkGeometries=function(t){var e="The geometry added to collection is invalid.";if(t&&!Array.isArray(t)){if(t instanceof Pn)return[t];throw new Error(e)}for(var i=0,n=t.length;i<n;i++)if(!this._checkGeo(t[i]))throw new Error(e+" Index: "+i);return t},a.prototype._checkGeo=function(t){return t instanceof Pn},a.prototype._updateCache=function(){this._clearCache(),this.isEmpty()||this.forEach(function(t){t&&t._updateCache&&t._updateCache()})},a.prototype._removePainter=function(){this._painter&&this._painter.remove(),delete this._painter,this.forEach(function(t){t._removePainter()})},a.prototype._computeCenter=function(t){if(!t||this.isEmpty())return null;for(var e=0,i=0,n=0,r=this.getGeometries(),o=0,a=r.length;o<a;o++)if(r[o]){var s=r[o]._computeCenter(t);s&&(e+=s.x,i+=s.y,n++)}return 0===n?null:new yi(e/n,i/n)},a.prototype._containsPoint=function(t,e){if(this.isEmpty())return!1;for(var i=this.getGeometries(),n=0,r=i.length;n<r;n++)if(i[n]._containsPoint(t,e))return!0;return!1},a.prototype._computeExtent=function(t){return qn.call(this,t,"_computeExtent")},a.prototype._computePrjExtent=function(t){return qn.call(this,t,"_computePrjExtent")},a.prototype._computeGeodesicLength=function(t){if(!t||this.isEmpty())return 0;for(var e=this.getGeometries(),i=0,n=0,r=e.length;n<r;n++)e[n]&&(i+=e[n]._computeGeodesicLength(t));return i},a.prototype._computeGeodesicArea=function(t){if(!t||this.isEmpty())return 0;for(var e=this.getGeometries(),i=0,n=0,r=e.length;n<r;n++)e[n]&&(i+=e[n]._computeGeodesicArea(t));return i},a.prototype._exportGeoJSONGeometry=function(){var t=[];if(!this.isEmpty())for(var e=this.getGeometries(),i=0,n=e.length;i<n;i++)e[i]&&t.push(e[i]._exportGeoJSONGeometry());return{type:"GeometryCollection",geometries:t}},a.prototype._clearProjection=function(){if(!this.isEmpty())for(var t=this.getGeometries(),e=0,i=t.length;e<i;e++)t[e]&&t[e]._clearProjection()},a.prototype._getConnectPoints=function(){var t=this.getExtent();return[new yi(t.xmin,t.ymax),new yi(t.xmax,t.ymin),new yi(t.xmin,t.ymin),new yi(t.xmax,t.ymax)]},a.prototype._getExternalResources=function(){if(this.isEmpty())return[];for(var t=this.getGeometries(),e=[],i={},n=void 0,r=void 0,o=0,a=t.length;o<a;o++)if(t[o])for(var s=0,l=(n=Pt(t[o]._getInternalSymbol())).length;s<l;s++)i[r=n[s].join()]||(e.push(n[s]),i[r]=1);return e},a.prototype.startEdit=function(t){var e=this;if(this.isEmpty())return this;t||(t={}),t.symbol&&(this._originalSymbol=this.getSymbol(),this.setSymbol(t.symbol)),this._draggbleBeforeEdit=this.options.draggable,this.config("draggable",!1);for(var i=this.getGeometries(),n=0,r=i.length;n<r;n++)i[n].startEdit(t);return this._editing=!0,this.hide(),setTimeout(function(){e.fire("editstart")},1),this},a.prototype.endEdit=function(){if(this.isEmpty())return this;for(var t=this.getGeometries(),e=0,i=t.length;e<i;e++)t[e].endEdit();return this._originalSymbol&&(this.setSymbol(this._originalSymbol),delete this._originalSymbol),this._editing=!1,this.show(),this.config("draggable",this._draggbleBeforeEdit),this.fire("editend"),this},a.prototype.isEditing=function(){return!!this._editing},a}(Pn);function qn(t,e){if(this.isEmpty())return null;for(var i=this.getGeometries(),n=null,r=0,o=i.length;r<o;r++){var a=i[r];if(a){var s=a[e](t);s&&(n=s.combine(n))}}return n}Xn.registerJSONType("GeometryCollection");var Yn=function(o){function a(t,e,i,n){u(this,a);var r=v(this,o.call(this,null,n));return r.GeometryType=t,r.type=e,r._initData(i),r}return m(a,o),a.prototype.getCoordinates=function(){for(var t=[],e=this.getGeometries(),i=0,n=e.length;i<n;i++)t.push(e[i].getCoordinates());return t},a.prototype.setCoordinates=function(t){for(var e=[],i=0,n=(t=t||[]).length;i<n;i++){var r=new this.GeometryType(t[i],this.config());e.push(r)}return this.setGeometries(e),this},a.prototype._initData=function(t){(t=t||[]).length&&(t[0]instanceof this.GeometryType?this.setGeometries(t):this.setCoordinates(t))},a.prototype._checkGeo=function(t){return t instanceof this.GeometryType},a.prototype._exportGeoJSONGeometry=function(){var t=this.getCoordinates(),e=yi.toNumberArrays(t);return{type:this.getType(),coordinates:e}},a}(Xn),Jn=function(i){function n(t,e){return u(this,n),v(this,i.call(this,Wn,"MultiPoint",t,e))}return m(n,i),n}(Yn);Jn.registerJSONType("MultiPoint");var Kn=function(t){function e(){return u(this,e),v(this,t.apply(this,arguments))}return m(e,t),e.prototype.getCenterInExtent=function(i){var t=this.getGeometries(),n=0,r=0,o=0;return t.forEach(function(t){var e=t.getCenterInExtent(i);e&&(n+=e.x*e.count,r+=e.y*e.count,o+=e.count)}),0===o?null:new yi(n,r)._multi(1/o)},e}(Yn),Qn=function(i){function n(t,e){return u(this,n),v(this,i.call(this,Zn,"MultiLineString",t,e))}return m(n,i),n}(Kn);Qn.registerJSONType("MultiLineString");var $n=function(i){function n(t,e){return u(this,n),v(this,i.call(this,Hn,"MultiPolygon",t,e))}return m(n,i),n}(Kn);$n.registerJSONType("MultiPolygon");var tr={Marker:Wn,LineString:Zn,Polygon:Hn,MultiPoint:Jn,MultiLineString:Qn,MultiPolygon:$n},er={toGeometry:function(t){if(S(t)&&(t=R(t)),Array.isArray(t)){for(var e=[],i=0,n=t.length;i<n;i++){var r=er._convert(t[i]);Array.isArray(r)?D(e,r):e.push(r)}return e}return er._convert(t)},_convert:function(t){if(!t||Y(t.type))return null;var e=t.type;if("Feature"===e){var i=t.geometry,n=er._convert(i);return n?(n.setId(t.id),n.setProperties(t.properties),n):null}if("FeatureCollection"===e){var r=t.features;return r?er.toGeometry(r):null}if(0<=["Point","LineString","Polygon","MultiPoint","MultiLineString","MultiPolygon"].indexOf(e))return new tr["Point"===e?"Marker":e](t.coordinates);if("GeometryCollection"===e){var o=t.geometries;if(!H(o))return new Xn;for(var a=[],s=o.length,l=0;l<s;l++)a.push(er._convert(o[l]));return new Xn(a)}return null}},ir=function(a){function r(t,e,i){u(this,r);var n=v(this,a.call(this,null,i));return t&&n.setCoordinates(t),n._radius=e,n}return m(r,a),r.fromJSON=function(t){var e=t.feature,i=new r(t.coordinates,t.radius,t.options);return i.setProperties(e.properties),i},r.prototype.getRadius=function(){return this._radius},r.prototype.setRadius=function(t){return this._radius=t,this.onShapeChanged(),this},r.prototype.getShell=function(){for(var t=this._getMeasurer(),e=this.getCoordinates(),i=this.options.numberOfShellPoints,n=this.getRadius(),r=[],o=void 0,a=void 0,s=void 0,l=0;l<i;l++){o=360*l/i*Math.PI/180,a=n*Math.cos(o),s=n*Math.sin(o);var h=t.locate(e,a,s);r.push(h)}return r},r.prototype.getHoles=function(){return[]},r.prototype.animateShow=function(){return this.show()},r.prototype._containsPoint=function(t,e){var i=this.getMap();if(i.getPitch())return a.prototype._containsPoint.call(this,t,e);var n=i._pointToContainerPoint(this._getCenter2DPoint()),r=this.getSize(),o=Y(e)?this._hitTestTolerance():e;return un(t,n,n.add(r.width/2,r.height/2),o)},r.prototype._computePrjExtent=function(e){var t=this._getMinMax(e);if(!t)return null;var i=this._getPrjCoordinates(),n=t.map(function(t){return e.project(t)}),r=Math.min(Math.abs(n[0].x-i.x),Math.abs(n[1].x-i.x)),o=Math.min(Math.abs(n[2].y-i.y),Math.abs(n[3].y-i.y));return new wi(i.sub(r,o),i.add(r,o))},r.prototype._computeExtent=function(t){var e=this._getMinMax(t);return e?new wi(e[0].x,e[2].y,e[1].x,e[3].y,this._getProjection()):null},r.prototype._getMinMax=function(t){if(!t||!this._coordinates||Y(this._radius))return null;var e=this._radius;return[t.locate(this._coordinates,-e,0),t.locate(this._coordinates,e,0),t.locate(this._coordinates,0,e),t.locate(this._coordinates,0,-e)]},r.prototype._computeGeodesicLength=function(){return Y(this._radius)?0:2*Math.PI*this._radius},r.prototype._computeGeodesicArea=function(){return Y(this._radius)?0:Math.PI*Math.pow(this._radius,2)},r.prototype._exportGeoJSONGeometry=function(){return{type:"Polygon",coordinates:yi.toNumberArrays([this.getShell()])}},r.prototype._toJSON=function(t){var e=this.getCenter(),i=_({},t);i.geometry=!1;var n=this.toGeoJSON(i);return n.geometry={type:"Polygon"},{feature:n,subType:"Circle",coordinates:[e.x,e.y],radius:this.getRadius()}},r}(Un(Hn));ir.mergeOptions({numberOfShellPoints:60}),ir.registerJSONType("Circle");var nr=function(a){function o(t,e,i,n){u(this,o);var r=v(this,a.call(this,null,n));return t&&r.setCoordinates(t),r.width=e,r.height=i,r}return m(o,a),o.fromJSON=function(t){var e=t.feature,i=new o(t.coordinates,t.width,t.height,t.options);return i.setProperties(e.properties),i},o.prototype.getWidth=function(){return this.width},o.prototype.setWidth=function(t){return this.width=t,this.onShapeChanged(),this},o.prototype.getHeight=function(){return this.height},o.prototype.setHeight=function(t){return this.height=t,this.onShapeChanged(),this},o.prototype.getShell=function(){for(var t=this._getMeasurer(),e=this.getCoordinates(),i=this.options.numberOfShellPoints,n=this.getWidth(),r=this.getHeight(),o=[],a=Math.pow(n/2,2)*Math.pow(r/2,2),s=Math.pow(n/2,2),l=Math.pow(r/2,2),h=void 0,c=void 0,u=void 0,d=void 0,p=0;p<i;p++){c=(h=360*p/i)*Math.PI/180,u=Math.sqrt(a/(s*Math.pow(Math.tan(c),2)+l)),d=Math.sqrt(a/(l*Math.pow(1/Math.tan(c),2)+s)),90<h&&h<270&&(u*=-1),180<h&&h<360&&(d*=-1);var f=t.locate(e,u,d);o.push(f)}return o},o.prototype.getHoles=function(){return[]},o.prototype.animateShow=function(){return this.show()},o.prototype._containsPoint=function(t,e){var i=this.getMap();if(i.isTransforming())return a.prototype._containsPoint.call(this,t,e);var n=i.getProjection(),r=Y(e)?this._hitTestTolerance():e,o=n.projectCoords([this._coordinates,i.locate(this._coordinates,this.getWidth()/2,this.getHeight()/2)]);return un(t,i._prjToContainerPoint(o[0]),i._prjToContainerPoint(o[1]),r)},o.prototype._computePrjExtent=function(){return ir.prototype._computePrjExtent.apply(this,arguments)},o.prototype._computeExtent=function(){return ir.prototype._computeExtent.apply(this,arguments)},o.prototype._getMinMax=function(t){if(!t||!this._coordinates||Y(this.width)||Y(this.height))return null;var e=this.getWidth(),i=this.getHeight();return[t.locate(this._coordinates,-e/2,0),t.locate(this._coordinates,e/2,0),t.locate(this._coordinates,0,-i/2),t.locate(this._coordinates,0,i/2)]},o.prototype._computeGeodesicLength=function(){if(Y(this.width)||Y(this.height))return 0;var t=this.width>this.height?this.width:this.height;return 2*Math.PI*t/2-4*Math.abs(this.width-this.height)},o.prototype._computeGeodesicArea=function(){return Y(this.width)||Y(this.height)?0:Math.PI*this.width*this.height/4},o.prototype._exportGeoJSONGeometry=function(){return{type:"Polygon",coordinates:yi.toNumberArrays([this.getShell()])}},o.prototype._toJSON=function(t){var e=_({},t),i=this.getCenter();e.geometry=!1;var n=this.toGeoJSON(e);return n.geometry={type:"Polygon"},{feature:n,subType:"Ellipse",coordinates:[i.x,i.y],width:this.getWidth(),height:this.getHeight()}},o}(Un(Hn));nr.mergeOptions({numberOfShellPoints:80}),nr.registerJSONType("Ellipse");var rr=function(d){function o(t,e,i,n){u(this,o);var r=v(this,d.call(this,null,n));return t&&r.setCoordinates(t),r._width=e,r._height=i,r}return m(o,d),o.fromJSON=function(t){var e=t.feature,i=new o(t.coordinates,t.width,t.height,t.options);return i.setProperties(e.properties),i},o.prototype.getCoordinates=function(){return this._coordinates},o.prototype.setCoordinates=function(t){if(this._coordinates=t instanceof yi?t:new yi(t),!this._coordinates||!this.getMap())return this.onPositionChanged(),this;var e=this._getProjection();return this._setPrjCoordinates(e.project(this._coordinates)),this},o.prototype.getWidth=function(){return this._width},o.prototype.setWidth=function(t){return this._width=t,this.onShapeChanged(),this},o.prototype.getHeight=function(){return this._height},o.prototype.setHeight=function(t){return this._height=t,this.onShapeChanged(),this},o.prototype.getShell=function(){var t=this._getMeasurer(),e=this._coordinates,i=this.getMap(),n=1,r=-1;if(i){var o=i.getFullExtent();o.left>o.right&&(n=-1),o.bottom>o.top&&(r=1)}var a=[];return a.push(e),a.push(t.locate(e,n*this._width,0)),a.push(t.locate(e,n*this._width,r*this._height)),a.push(t.locate(e,0,r*this._height)),a.push(e),a},o.prototype.getHoles=function(){return[]},o.prototype.animateShow=function(){return this.show()},o.prototype._getPrjCoordinates=function(){var t=this._getProjection();return t?(this._verifyProjection(),this._pnw||this._coordinates&&(this._pnw=t.project(this._coordinates)),this._pnw):null},o.prototype._setPrjCoordinates=function(t){this._pnw=t,this.onPositionChanged()},o.prototype._getPrjShell=function(){var t=d.prototype._getPrjShell.call(this),e=this._getProjection();if(!e.isSphere())return t;for(var i=e.getSphereExtent(),n=i.sx,r=i.sy,o=this._getProjection().getCircum(),a=t[0],s=1,l=t.length;s<l;s++){var h=t[s],c=0,u=0;0<n*(a.x-h.x)&&(c=o.x*n),r*(a.y-h.y)<0&&(u=o.y*r),t[s]._add(c,u)}return t},o.prototype._updateCache=function(){this._clearCache();var t=this._getProjection();this._pnw&&t&&(this._coordinates=t.unproject(this._pnw))},o.prototype._clearProjection=function(){this._pnw=null,d.prototype._clearProjection.call(this)},o.prototype._computeCenter=function(t){return t.locate(this._coordinates,this._width/2,-this._height/2)},o.prototype._containsPoint=function(t,e){var i=this.getMap();if(i.isTransforming())return d.prototype._containsPoint.call(this,t,e);var n=Y(e)?this._hitTestTolerance():e,r=i._getResolution()*n,o=this._getPrjExtent().expand(r),a=i._containerPointToPrj(t);return o.contains(a)},o.prototype._computePrjExtent=function(t){var e=this._getSouthEast(t);if(!e)return null;var i=t.projectCoords([new yi(this._coordinates.x,e.y),new yi(e.x,this._coordinates.y)]);return new wi(i[0],i[1])},o.prototype._computeExtent=function(t){var e=this._getSouthEast(t);return e?new wi(this._coordinates,e,this._getProjection()):null},o.prototype._getSouthEast=function(t){if(!t||!this._coordinates||Y(this._width)||Y(this._height))return null;var e=this.getWidth(),i=-this.getHeight();if(t.fullExtent){var n=t.fullExtent;e*=n.right>n.left?1:-1,i*=n.top>n.bottom?1:-1}return t.locate(this._coordinates,e,i)},o.prototype._computeGeodesicLength=function(){return Y(this._width)||Y(this._height)?0:2*(this._width+this._height)},o.prototype._computeGeodesicArea=function(){return Y(this._width)||Y(this._height)?0:this._width*this._height},o.prototype._exportGeoJSONGeometry=function(){return{type:"Polygon",coordinates:yi.toNumberArrays([this.getShell()])}},o.prototype._toJSON=function(t){var e=_({},t),i=this.getCoordinates();e.geometry=!1;var n=this.toGeoJSON(e);return n.geometry={type:"Polygon"},{feature:n,subType:"Rectangle",coordinates:[i.x,i.y],width:this.getWidth(),height:this.getHeight()}},o}(Hn);rr.registerJSONType("Rectangle");var or=function(g){function a(t,e,i,n,r){u(this,a);var o=v(this,g.call(this,t,e,r));return o.startAngle=i,o.endAngle=n,o}return m(a,g),a.fromJSON=function(t){var e=t.feature,i=new a(t.coordinates,t.radius,t.startAngle,t.endAngle,t.options);return i.setProperties(e.properties),i},a.prototype.getStartAngle=function(){return this.startAngle},a.prototype.setStartAngle=function(t){return this.startAngle=t,this.onShapeChanged(),this},a.prototype.getEndAngle=function(){return this.endAngle},a.prototype.setEndAngle=function(t){return this.endAngle=t,this.onShapeChanged(),this},a.prototype.getShell=function(){for(var t=this._getMeasurer(),e=this.getCoordinates(),i=this.options.numberOfShellPoints-2,n=this.getRadius(),r=[e.copy()],o=this.getStartAngle(),a=this.getEndAngle()-o,s=void 0,l=void 0,h=void 0,c=0;c<i;c++){s=(a*c/(i-1)+o)*Math.PI/180,l=n*Math.cos(s),h=n*Math.sin(s);var u=t.locate(e,l,h);r.push(u)}return r.push(e.copy()),r},a.prototype._containsPoint=function(t,e){var i=this.getMap();if(i.isTransforming())return g.prototype._containsPoint.call(this,t,e);var n=i._pointToContainerPoint(this._getCenter2DPoint()),r=Y(e)?this._hitTestTolerance():e,o=this.getSize(),a=n,s=t,l=s.x-a.x,h=a.y-s.y,c=Math.atan2(h,l),u=c<0?360*(c+2*Math.PI)/(2*Math.PI):360*c/(2*Math.PI),d=this.startAngle%360,p=this.endAngle%360,f=!1;return f=p<d?!(p<u&&u<d):d<=u&&u<=p,s.distanceTo(a)<=o.width/2+r&&f},a.prototype._computeGeodesicLength=function(){return Y(this._radius)?0:2*Math.PI*this._radius*Math.abs(this.startAngle-this.endAngle)/360+2*this._radius},a.prototype._computeGeodesicArea=function(){return Y(this._radius)?0:Math.PI*Math.pow(this._radius,2)*Math.abs(this.startAngle-this.endAngle)/360},a.prototype._toJSON=function(t){var e=_({},t),i=this.getCenter();e.geometry=!1;var n=this.toGeoJSON(e);return n.geometry={type:"Polygon"},{feature:n,subType:"Sector",coordinates:[i.x,i.y],radius:this.getRadius(),startAngle:this.getStartAngle(),endAngle:this.getEndAngle()}},a}(ir);or.mergeOptions({numberOfShellPoints:60}),or.registerJSONType("Sector");var ar=function(t){function e(){return u(this,e),v(this,t.apply(this,arguments))}return m(e,t),e.prototype._arc=function(t,e,i){for(var n=this.options.arcDegree*Math.PI/180,r=1,o=e.length;r<o;r++){var a=ni._arcBetween(t,e[r-1],e[r],n),s=[e[r-1].x+e[r].x-a[0],e[r-1].y+e[r].y-a[1]];e[r-1].nextCtrlPoint=s,e[r].prevCtrlPoint=s,ni._stroke(t,i)}},e.prototype._quadraticCurve=function(t,e){if(e.length<=2)ni._path(t,e);else{var i,n=void 0;for(n=2,i=e.length;n<i;n+=2)t.quadraticCurveTo(e[n-1].x,e[n-1].y,e[n].x,e[n].y);if((n-=1)<i)for(;n<i;n++)t.lineTo(e[n].x,e[n].y)}},e.prototype._bezierCurve=function(t,e){if(e.length<=3)ni._path(t,e);else{var i,n=void 0;for(n=1,i=e.length;n+2<i;n+=3)t.bezierCurveTo(e[n].x,e[n].y,e[n+1].x,e[n+1].y,e[n+2].x,e[n+2].y);if(n<i)for(;n<i;n++)t.lineTo(e[n].x,e[n].y)}},e.prototype._getCurveArrowPoints=function(t,e,i,n,r,o){var a=e.length,s=void 0;for(s=o;s<a;s+=o)t.push(this._getArrowShape(e[s-1],e[s],i,n,r));if((s-=o)<a-1)for(s+=1;s<a;s++)t.push(this._getArrowShape(e[s-1],e[s],i,n,r))},e}(Zn);ar.mergeOptions({enableSimplify:!1,enableClip:!1});var sr=function(t){function n(){return u(this,n),v(this,t.apply(this,arguments))}return m(n,t),n.prototype._toJSON=function(t){return{feature:this.toGeoJSON(t),subType:"ArcCurve"}},n.prototype._paintOn=function(t,e,i){t.beginPath(),this._arc(t,e,i),ni._stroke(t,i),this._paintArrow(t,e,i)},n.fromJSON=function(t){var e=t.feature,i=new n(e.geometry.coordinates,t.options);return i.setProperties(e.properties),i},n}(ar);sr.registerJSONType("ArcCurve"),sr.mergeOptions({arcDegree:90});var lr=function(t){function n(){return u(this,n),v(this,t.apply(this,arguments))}return m(n,t),n.fromJSON=function(t){var e=t.feature,i=new n(e.geometry.coordinates,t.options);return i.setProperties(e.properties),i},n.prototype._toJSON=function(t){return{feature:this.toGeoJSON(t),subType:"CubicBezierCurve"}},n.prototype._paintOn=function(t,e,i){t.beginPath(),t.moveTo(e[0].x,e[0].y),this._bezierCurve(t,e),ni._stroke(t,i),this._paintArrow(t,e,i)},n.prototype._getArrowPoints=function(t,e,i,n,r){return this._getCurveArrowPoints(t,e,i,n,r,3)},n}(ar);lr.registerJSONType("CubicBezierCurve");var hr=function(t){function n(){return u(this,n),v(this,t.apply(this,arguments))}return m(n,t),n.fromJSON=function(t){var e=t.feature,i=new n(e.geometry.coordinates,t.options);return i.setProperties(e.properties),i},n.prototype._toJSON=function(t){return{feature:this.toGeoJSON(t),subType:"QuadBezierCurve"}},n.prototype._paintOn=function(t,e,i){t.beginPath(),t.moveTo(e[0].x,e[0].y),this._quadraticCurve(t,e,i),ni._stroke(t,i),this._paintArrow(t,e,i)},n.prototype._getArrowPoints=function(t,e,i,n,r){return this._getCurveArrowPoints(t,e,i,n,r,2)},n}(ar);hr.registerJSONType("QuadBezierCurve");var cr={textFaceName:"monospace",textSize:12,textLineSpacing:8,textWrapCharacter:"\n",textHorizontalAlignment:"middle",textVerticalAlignment:"middle"},ur={markerType:"square",markerLineColor:"#000",markerLineWidth:2,markerLineOpacity:1,markerFill:"#fff",markerOpacity:1},dr=function(r){function t(){return u(this,t),v(this,r.apply(this,arguments))}return m(t,r),t.prototype.getContent=function(){return this._content},t.prototype.setContent=function(t){var e=this._content;return this._content=de(t),this._refresh(),this._fireEvent("contentchange",{old:e,new:t}),this},t.prototype.onAdd=function(){this._refresh()},t.prototype.toJSON=function(){var t=r.prototype.toJSON.call(this);return delete t.symbol,t},t.prototype.setSymbol=function(t){if(this._refreshing||!t)return r.prototype.setSymbol.call(this,t);var e=this._parseSymbol(t);if(this.setTextStyle){var i=this.getTextStyle()||{};i.symbol=e[0],this.setTextStyle(i)}else this.setTextSymbol&&this.setTextSymbol(e[0]);if(this.setBoxStyle){var n=this.getBoxStyle()||{};n.symbol=e[1],this.setBoxStyle(n)}else this.setBoxSymbol&&this.setBoxSymbol(e[1]);return this},t.prototype._parseSymbol=function(t){var e={},i={};for(var n in t)M(t,n)&&(0===n.indexOf("text")?e[n]=t[n]:i[n]=t[n]);return[e,i]},t.prototype._getTextSize=function(t){return Se(this._content,t).size},t.prototype._getInternalSymbol=function(){return this._symbol},t.prototype._getDefaultTextSymbol=function(){return _({},cr)},t.prototype._getDefaultBoxSymbol=function(){return _({},ur)},t.prototype._getDefaultPadding=function(){return[12,8]},t}(Wn),pr=function(a){function s(t,e,i,n){var r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:{};u(this,s);var o=v(this,a.call(this,e,r));return o._content=de(t),o._width=Y(i)?100:i,o._height=Y(n)?40:n,r.boxSymbol&&o.setBoxSymbol(r.boxSymbol),r.textStyle&&o.setTextStyle(r.textStyle),o._refresh(),o}return m(s,a),s.prototype.getWidth=function(){return this._width},s.prototype.setWidth=function(t){return this._width=t,this._refresh(),this},s.prototype.getHeight=function(){return this._height},s.prototype.setHeight=function(t){return this._height=t,this._refresh(),this},s.prototype.getBoxSymbol=function(){return _({},this.options.boxSymbol)},s.prototype.setBoxSymbol=function(t){return this.options.boxSymbol=t?_({},t):t,this.getSymbol()&&this._refresh(),this},s.prototype.getTextStyle=function(){return this.options.textStyle?_({},this.options.textStyle):null},s.prototype.setTextStyle=function(t){return this.options.textStyle=t?_({},t):t,this.getSymbol()&&this._refresh(),this},s.fromJSON=function(t){var e=t.feature,i=new s(t.content,e.geometry.coordinates,t.width,t.height,t.options);return i.setProperties(e.properties),i.setId(e.id),t.symbol&&i.setSymbol(t.symbol),i},s.prototype._toJSON=function(t){return{feature:this.toGeoJSON(t),width:this.getWidth(),height:this.getHeight(),subType:"TextBox",content:this._content}},s.prototype._refresh=function(){var t=this.getTextStyle()||{},e=t.padding||[12,8],i=this._width-2*e[0],n=this._height-2*e[1],r=_({},t.symbol||this._getDefaultTextSymbol(),this.options.boxSymbol||this._getDefaultBoxSymbol(),{textName:this._content,markerWidth:this._width,markerHeight:this._height,textHorizontalAlignment:"middle",textVerticalAlignment:"middle",textMaxWidth:i,textMaxHeight:n});t.wrap&&!r.textWrapWidth&&(r.textWrapWidth=i);var o=t.horizontalAlignment;r.textDx=r.markerDx||0;var a=r.markerWidth/2-e[0];"left"===o?(r.textHorizontalAlignment="right",r.textDx=r.textDx-a):"right"===o&&(r.textHorizontalAlignment="left",r.textDx=r.textDx+a);var s=t.verticalAlignment;r.textDy=r.markerDy||0;var l=r.markerHeight/2-e[1];"top"===s?(r.textVerticalAlignment="bottom",r.textDy-=l):"bottom"===s&&(r.textVerticalAlignment="top",r.textDy+=l),this._refreshing=!0,this.updateSymbol(r),delete this._refreshing},s}(dr);pr.mergeOptions({textStyle:{wrap:!0,padding:[12,8],verticalAlignment:"middle",horizontalAlignment:"middle"},boxSymbol:null}),pr.registerJSONType("TextBox");var fr=function(r){function o(t,e){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};u(this,o);var n=v(this,r.call(this,e,i));return i.textSymbol&&n.setTextSymbol(i.textSymbol),i.boxStyle&&n.setBoxStyle(i.boxStyle),n._content=de(t),n._refresh(),n}return m(o,r),o.prototype.getBoxStyle=function(){return this.options.boxStyle?_({},this.options.boxStyle):null},o.prototype.setBoxStyle=function(t){return this.options.boxStyle=t?_({},t):t,this._refresh(),this},o.prototype.getTextSymbol=function(){return _({},this._getDefaultTextSymbol(),this.options.textSymbol)},o.prototype.setTextSymbol=function(t){return this.options.textSymbol=t?_({},t):t,this._refresh(),this},o.fromJSON=function(t){var e=t.feature,i=new o(t.content,e.geometry.coordinates,t.options);return i.setProperties(e.properties),i.setId(e.id),t.symbol&&i.setSymbol(t.symbol),i},o.prototype._canEdit=function(){return!1},o.prototype._toJSON=function(t){return{feature:this.toGeoJSON(t),subType:"Label",content:this._content}},o.prototype._refresh=function(){var t=_({},this.getTextSymbol(),{textName:this._content}),e=this.getBoxStyle();if(e){_(t,e.symbol);var i=this._getBoxSize(t),n=i[1],r=e.padding||this._getDefaultPadding(),o=i[0];t.markerWidth=o.width,t.markerHeight=o.height;var a=t.textDx||0,s=t.textDy||0,l=be(n,t.textHorizontalAlignment,t.textVerticalAlignment)._add(a,s),h=e.horizontalAlignment||"middle";t.markerDx=l.x,"left"===h?t.markerDx+=t.markerWidth/2-r[0]:"right"===h?t.markerDx-=t.markerWidth/2-n.width-r[0]:t.markerDx+=n.width/2;var c=e.verticalAlignment||"middle";t.markerDy=l.y,"top"===c?t.markerDy+=t.markerHeight/2-r[1]:"bottom"===c?t.markerDy-=t.markerHeight/2-n.height-r[1]:t.markerDy+=n.height/2}this._refreshing=!0,this.updateSymbol(t),delete this._refreshing},o.prototype._getBoxSize=function(t){t.markerType||(t.markerType="square");var e=this.getBoxStyle(),i=this._getTextSize(t),n=void 0,r=void 0,o=e.padding||this._getDefaultPadding();return n=i.width+2*o[0],r=i.height+2*o[1],e.minWidth&&(!n||n<e.minWidth)&&(n=e.minWidth),e.minHeight&&(!r||r<e.minHeight)&&(r=e.minHeight),[new he(n,r),i]},o}(dr);fr.mergeOptions({boxStyle:null,textSymbol:null}),fr.registerJSONType("Label");var gr=function(t){return function(t){function e(){return u(this,e),v(this,t.apply(this,arguments))}return m(e,t),e._hasConnectors=function(t){return!Y(t.__connectors)&&0<t.__connectors.length},e._getConnectors=function(t){return t.__connectors},e.prototype.getConnectSource=function(){return this._connSource},e.prototype.setConnectSource=function(t){var e=this._connTarget;return this.onRemove(),this._connSource=t,this._connTarget=e,this.onAdd(),this},e.prototype.getConnectTarget=function(){return this._connTarget},e.prototype.setConnectTarget=function(t){var e=this._connSource;return this.onRemove(),this._connSource=e,this._connTarget=t,this._updateCoordinates(),this._registerEvents(),this},e.prototype._updateCoordinates=function(){var t=this.getMap();if(!t&&this._connSource&&(t=this._connSource.getMap()),!t&&this._connTarget&&(t=this._connTarget.getMap()),t&&this._connSource&&this._connTarget){for(var e=this._connSource._getConnectPoints(),i=this._connTarget._getConnectPoints(),n=0,r=this.getCoordinates(),o=void 0,a=void 0,s=0,l=e.length;s<l;s++)for(var h=e[s],c=0,u=i.length;c<u;c++){var d=i[c],p=t.computeLength(h,d);0===s&&0===c?(o=h,a=d,n=p):p<n&&(o=h,a=d)}H(r)&&r[0].equals(o)&&r[1].equals(a)||this.setCoordinates([o,a])}},e.prototype.onAdd=function(){this._registerEvents(),this._updateCoordinates()},e.prototype.onRemove=function(){if(this._connSource&&(this._connSource.__connectors&&O(this,this._connSource.__connectors),this._connSource.off("dragging positionchange",this._updateCoordinates,this).off("remove",this.onRemove,this),this._connSource.off("dragstart mousedown mouseover",this._showConnect,this),this._connSource.off("dragend mouseup mouseout",this.hide,this),this._connSource.off("show",this._showConnect,this).off("hide",this.hide,this),delete this._connSource),this._connTarget&&(O(this,this._connTarget.__connectors),this._connTarget.off("dragging positionchange",this._updateCoordinates,this).off("remove",this.onRemove,this),this._connTarget.off("show",this._showConnect,this).off("hide",this.hide,this),delete this._connTarget),!(this._connSource instanceof Pn&&this._connTarget instanceof Pn)){var t=this.getMap();t&&t.off("movestart moving moveend zoomstart zooming zoomend rotate pitch fovchange spatialreferencechange",this._updateCoordinates,this)}},e.prototype._showConnect=function(){this._connSource&&this._connTarget&&this._connSource.isVisible()&&this._connTarget.isVisible()&&(this._updateCoordinates(),this.show())},e.prototype._registerEvents=function(){if(this._connSource&&this._connTarget){this._connSource.__connectors||(this._connSource.__connectors=[]),this._connTarget.__connectors||(this._connTarget.__connectors=[]),this._connSource.__connectors.push(this),this._connTarget.__connectors.push(this),this._connSource.on("dragging positionchange",this._updateCoordinates,this).on("remove",this.remove,this),this._connTarget.on("dragging positionchange",this._updateCoordinates,this).on("remove",this.remove,this),this._connSource.on("show",this._showConnect,this).on("hide",this.hide,this),this._connTarget.on("show",this._showConnect,this).on("hide",this.hide,this);var t=this.options.showOn;if(this.hide(),"moving"===t?(this._connSource.on("dragstart",this._showConnect,this).on("dragend",this.hide,this),this._connTarget.on("dragstart",this._showConnect,this).on("dragend",this.hide,this)):"click"===t?(this._connSource.on("mousedown",this._showConnect,this).on("mouseup",this.hide,this),this._connTarget.on("mousedown",this._showConnect,this).on("mouseup",this.hide,this)):"mouseover"===t?(this._connSource.on("mouseover",this._showConnect,this).on("mouseout",this.hide,this),this._connTarget.on("mouseover",this._showConnect,this).on("mouseout",this.hide,this)):this._showConnect(),!(this._connSource instanceof Pn&&this._connTarget instanceof Pn)){var e=this.getMap();e&&e.on("movestart moving moveend zoomstart zooming zoomend rotate pitch fovchange spatialreferencechange",this._updateCoordinates,this)}}},e}(t)},mr={showOn:"always"},vr=function(r){function o(t,e,i){u(this,o);var n=v(this,r.call(this,null,i));return 1===arguments.length&&(i=t,e=t=null),n._connSource=t,n._connTarget=e,n}return m(o,r),o}(gr(Zn));vr.mergeOptions(mr),vr.registerJSONType("ConnectorLine");var yr=function(r){function o(t,e,i){u(this,o);var n=v(this,r.call(this,null,i));return 1===arguments.length&&(i=t,e=t=null),n._connSource=t,n._connTarget=e,n}return m(o,r),o}(gr(sr));yr.mergeOptions(mr),yr.registerJSONType("ArcConnectorLine");var _r=function(r){function o(t,e,i){u(this,o),e&&!(e instanceof Pn)&&!Array.isArray(e)&&a.indexOf(e.type)<0&&(i=e,e=null);var n=v(this,r.call(this,t,i));return n._maxZIndex=0,n._minZIndex=0,n._initCache(),e&&n.addGeometry(e),n}return m(o,r),o.prototype.getGeometryById=function(t){return Y(t)||""===t?null:this._geoMap[t]?this._geoMap[t]:null},o.prototype.getGeometries=function(t,e){if(!t)return this._geoList.slice(0);for(var i=[],n=void 0,r=0,o=this._geoList.length;r<o;r++)n=this._geoList[r],(e?t.call(e,n):t(n))&&i.push(n);return i},o.prototype.getFirstGeometry=function(){return this._geoList.length?this._geoList[0]:null},o.prototype.getLastGeometry=function(){var t=this._geoList.length;return 0===t?null:this._geoList[t-1]},o.prototype.getCount=function(){return this._geoList.length},o.prototype.getExtent=function(){if(0===this.getCount())return null;var e=new wi(this.getProjection());return this.forEach(function(t){e._combine(t.getExtent())}),e},o.prototype.forEach=function(t,e){for(var i=this._geoList.slice(0),n=0,r=i.length;n<r;n++)e?t.call(e,i[n],n):t(i[n],n);return this},o.prototype.filter=function(){return Xn.prototype.filter.apply(this,arguments)},o.prototype.isEmpty=function(){return!this._geoList.length},o.prototype.addGeometry=function(t,e){if(!t)return this;if("FeatureCollection"===t.type)return this.addGeometry(er.toGeometry(t),e);if(!Array.isArray(t)){var i=arguments.length,n=arguments[i-1];return t=Array.prototype.slice.call(arguments,0,i-1),x(e=n)&&(t.push(n),e=!1),this.addGeometry(t,e)}if(0===t.length)return this;this._initCache();var r=void 0;!0===e&&(r=new wi),this._toSort=0<this._maxZIndex;for(var o=[],a=0,s=t.length;a<s;a++){var l=t[a];if(!l)throw new Error("Invalid geometry to add to layer("+this.getId()+") at index:"+a);if(!(l instanceof Pn)&&(l=Pn.fromJSON(l),Array.isArray(l)))for(var h=0,c=l.length;h<c;h++)this._add(l[h],r,a),o.push(l[h]);Array.isArray(l)||(this._add(l,r,a),o.push(l))}var u=this.getMap();if(u&&(this._getRenderer().onGeometryAdd(o),!0===e&&!Y(r.xmin))){var d=u.getFitZoom(r);u.setCenterAndZoom(r.getCenter(),d)}return this.fire("addgeo",{geometries:t}),this},o.prototype.getGeoMinZIndex=function(){return this._minZIndex},o.prototype.getGeoMaxZIndex=function(){return this._maxZIndex},o.prototype._add=function(t,e,i){this._toSort||(this._toSort=0!==t.getZIndex()),this._updateZIndex(t.getZIndex());var n=t.getId();if(!Y(n)){if(!Y(this._geoMap[n]))throw new Error("Duplicate geometry id in layer("+this.getId()+"):"+n+", at index:"+i);this._geoMap[n]=t}var r=L();t._setInternalId(r),this._geoList.push(t),this.onAddGeometry&&this.onAddGeometry(t),t._bindLayer(this),t.onAdd&&t.onAdd(),e&&e._combine(t.getExtent()),t._fireEvent("add",{layer:this})},o.prototype.removeGeometry=function(t){if(!Array.isArray(t))return this.removeGeometry([t]);for(var e=t.length-1;0<=e;e--)t[e]instanceof Pn||(t[e]=this.getGeometryById(t[e])),t[e]&&this===t[e].getLayer()&&t[e].remove();return this.fire("removegeo",{geometries:t}),this},o.prototype.clear=function(){this._clearing=!0,this.forEach(function(t){t.remove()}),this._geoMap={};var t=this._geoList;return this._geoList=[],this._getRenderer()&&this._getRenderer().onGeometryRemove(t),this._clearing=!1,this.fire("clear"),this},o.prototype.onRemoveGeometry=function(t){if(t&&!this._clearing&&(this===t.getLayer()&&!Y(t._getInternalId()))){var e=t.getId();Y(e)||delete this._geoMap[e];var i=this._findInList(t);0<=i&&this._geoList.splice(i,1),this._getRenderer()&&this._getRenderer().onGeometryRemove([t])}},o.prototype.hide=function(){for(var t=0,e=this._geoList.length;t<e;t++)this._geoList[t].onHide();return Ji.prototype.hide.call(this)},o.prototype.identify=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return this._hitGeos(this._geoList,t,e)},o.prototype._hitGeos=function(t,e){for(var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},n=i.filter,r=i.tolerance,o=[],a=this.getMap(),s=a.coordToPoint(e),l=a._pointToContainerPoint(s),h=t.length-1;0<=h;h--){var c=t[h];if(c&&c.isVisible()&&c._getPainter()){if(!(c instanceof Zn&&(c._getArrowStyle()||c instanceof ar))){var u=c.getContainerExtent();if(r&&(u=u.expand(r)),!u||!u.contains(l))continue}if(c._containsPoint(l,r)&&(!n||n(c))&&(o.push(c),i.count&&o.length>=i.count))break}}return o},o.prototype._initCache=function(){this._geoList||(this._geoList=[],this._geoMap={})},o.prototype._updateZIndex=function(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];this._maxZIndex=Math.max(this._maxZIndex,Math.max.apply(Math,e)),this._minZIndex=Math.min(this._minZIndex,Math.min.apply(Math,e))},o.prototype._sortGeometries=function(){var i=this;this._toSort&&(this._maxZIndex=0,this._minZIndex=0,this._geoList.sort(function(t,e){return i._updateZIndex(t.getZIndex(),e.getZIndex()),i._compare(t,e)}),this._toSort=!1)},o.prototype._compare=function(t,e){return t.getZIndex()===e.getZIndex()?t._getInternalId()-e._getInternalId():t.getZIndex()-e.getZIndex()},o.prototype._findInList=function(t){var e=this._geoList.length;if(0===e)return-1;for(var i=0,n=e-1,r=void 0;i<=n;){if(r=Math.floor((i+n)/2),this._geoList[r]===t)return r;0<this._compare(this._geoList[r],t)?n=r-1:i=r+1}return-1},o.prototype._onGeometryEvent=function(t){if(t&&t.target){var e=t.type;"idchange"===e?this._onGeometryIdChange(t):"zindexchange"===e?this._onGeometryZIndexChange(t):"positionchange"===e?this._onGeometryPositionChange(t):"shapechange"===e?this._onGeometryShapeChange(t):"symbolchange"===e?this._onGeometrySymbolChange(t):"show"===e?this._onGeometryShow(t):"hide"===e?this._onGeometryHide(t):"propertieschange"===e&&this._onGeometryPropertiesChange(t)}},o.prototype._onGeometryIdChange=function(t){if(t.new!==t.old||!this._geoMap[t.old]||this._geoMap[t.old]!==t.target){if(!Y(t.new)){if(this._geoMap[t.new])throw new Error("Duplicate geometry id in layer("+this.getId()+"):"+t.new);this._geoMap[t.new]=t.target}Y(t.old)||t.new===t.old||delete this._geoMap[t.old]}},o.prototype._onGeometryZIndexChange=function(t){t.old!==t.new&&(this._updateZIndex(t.new),this._toSort=!0,this._getRenderer()&&this._getRenderer().onGeometryZIndexChange(t))},o.prototype._onGeometryPositionChange=function(t){this._getRenderer()&&this._getRenderer().onGeometryPositionChange(t)},o.prototype._onGeometryShapeChange=function(t){this._getRenderer()&&this._getRenderer().onGeometryShapeChange(t)},o.prototype._onGeometrySymbolChange=function(t){this._getRenderer()&&this._getRenderer().onGeometrySymbolChange(t)},o.prototype._onGeometryShow=function(t){this._getRenderer()&&this._getRenderer().onGeometryShow(t)},o.prototype._onGeometryHide=function(t){this._getRenderer()&&this._getRenderer().onGeometryHide(t)},o.prototype._onGeometryPropertiesChange=function(t){this._getRenderer()&&this._getRenderer().onGeometryPropertiesChange(t)},o}(Ji);_r.mergeOptions({drawImmediate:!1});var xr={debug:!1,enableSimplify:!0,geometryEvents:!0,defaultIconSize:[20,20],cacheVectorOnCanvas:!0,cacheSvgOnCanvas:ae.gecko,enableAltitude:!1,altitudeProperty:"altitude",drawAltitude:!1},wr=function(o){function a(t,e,i){u(this,a);var n=v(this,o.call(this,t,e,i)),r=n.options.style;return delete n.options.style,r&&n.setStyle(r),n}return m(a,o),a.prototype.getStyle=function(){return this._style?this._style:null},a.prototype.setStyle=function(t){return this._style=t,this._cookedStyles=ft(t),this.forEach(function(t){this._styleGeometry(t)},this),this.fire("setstyle",{style:t}),this},a.prototype.removeStyle=function(){return this._style&&(delete this._style,delete this._cookedStyles,this.forEach(function(t){t._setExternSymbol(null)},this),this.fire("removestyle")),this},a.prototype.onAddGeometry=function(t){this.getStyle()&&this._styleGeometry(t)},a.prototype.onConfig=function(t){if(o.prototype.onConfig.call(this,t),t.enableAltitude||t.drawAltitude||t.altitudeProperty){var e=this.getRenderer();e&&e.setToRedraw&&e.setToRedraw()}},a.prototype._styleGeometry=function(t){if(!this._cookedStyles)return!1;for(var e=pt(t),i=0,n=this._cookedStyles.length;i<n;i++)if(!0===this._cookedStyles[i].filter(e))return t._setExternSymbol(this._cookedStyles[i].symbol),!0;return!1},a.prototype.identify=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},i=this.getRenderer();return e.onlyVisible&&i&&i.identify?i.identify(t,e):o.prototype.identify.call(this,t,e)},a.prototype.toJSON=function(t){t||(t={});var e={type:this.getJSONType(),id:this.getId(),options:this.config()};if((Y(t.style)||t.style)&&this.getStyle()&&(e.style=this.getStyle()),Y(t.geometries)||t.geometries){var i=void 0;if(t.clipExtent){var n=this.getMap(),r=n?n.getProjection():null;i=new wi(t.clipExtent,r)}for(var o=[],a=this.getGeometries(),s=0,l=a.length;s<l;s++){var h=a[s],c=h.getExtent();if(c&&(!i||i.intersects(c))){var u=h.toJSON(t.geometries);o.push(u)}}e.geometries=o}return e},a.fromJSON=function(t){if(!t||"VectorLayer"!==t.type)return null;for(var e=new a(t.id,t.options),i=t.geometries,n=[],r=0;r<i.length;r++){var o=Pn.fromJSON(i[r]);o&&n.push(o)}return e.addGeometry(n),t.style&&e.setStyle(t.style),e},a}(_r);wr.mergeOptions(xr),wr.registerJSONType("VectorLayer");var br="_map_tool",Mr=function(t){function e(){return u(this,e),v(this,t.apply(this,arguments))}return m(e,t),e.prototype.addTo=function(t){return t&&((this._map=t)[br]&&t[br].disable(),this.onAdd&&this.onAdd(),this.enable(),(t[br]=this)._fireEvent("add")),this},e.prototype.getMap=function(){return this._map},e.prototype.enable=function(){return!this._map||this._enabled||(this._enabled=!0,this._switchEvents("off"),this._registerEvents(),this.onEnable&&this.onEnable(),this._fireEvent("enable")),this},e.prototype.disable=function(){return this._enabled&&this._map&&(this._enabled=!1,this._switchEvents("off"),this.onDisable&&this.onDisable(),this._fireEvent("disable")),this},e.prototype.isEnabled=function(){return!!this._enabled},e.prototype.remove=function(){return this._map&&(this.disable(),this._map&&(delete this._map[br],delete this._map),this._fireEvent("remove")),this},e.prototype._registerEvents=function(){this._switchEvents("on")},e.prototype._switchEvents=function(t){var e=this.getEvents();e&&this._map[t](e,this)},e.prototype._fireEvent=function(t,e){e||(e={}),this.fire(t,e)},e}(li(ci)),Sr={},Tr=function(i){function n(t){u(this,n);var e=v(this,i.call(this,t));return e._checkMode(),e._events={click:e._firstClickHandler,mousemove:e._mouseMoveHandler,dblclick:e._doubleClickHandler,mousedown:e._mouseDownHandler,mouseup:e._mouseUpHandler},e}return m(n,i),n.registerMode=function(t,e){Sr[t.toLowerCase()]=e},n.getRegisterMode=function(t){return Sr[t.toLowerCase()]},n.prototype.getMode=function(){return this.options.mode?this.options.mode.toLowerCase():null},n.prototype.setMode=function(t){return this._geometry&&(this._geometry.remove(),delete this._geometry),this._clearStage(),this._switchEvents("off"),this.options.mode=t,this._checkMode(),this.isEnabled()&&(this._switchEvents("on"),this._restoreMapCfg(),this._saveMapCfg()),this},n.prototype.getSymbol=function(){var t=this.options.symbol;return zt(t||this.options.symbol)},n.prototype.setSymbol=function(t){return t&&(this.options.symbol=t,this._geometry&&this._geometry.setSymbol(t)),this},n.prototype.getCurrentGeometry=function(){return this._geometry},n.prototype.onAdd=function(){this._checkMode()},n.prototype.onEnable=function(){return this._saveMapCfg(),this._drawToolLayer=this._getDrawLayer(),this._clearStage(),this._loadResources(),this},n.prototype.onDisable=function(){var t=this.getMap();return this._restoreMapCfg(),this.endDraw(),this._map&&t.removeLayer(this._getDrawLayer()),this},n.prototype.undo=function(){var t=this._getRegisterMode(),e=t.action;if(!this._shouldRecordHistory(e)||!this._historyPointer)return this;var i=this._clickCoords.slice(0,--this._historyPointer);return t.update(i,this._geometry),this},n.prototype.redo=function(){var t=this._getRegisterMode(),e=t.action;if(!this._shouldRecordHistory(e)||Y(this._historyPointer)||this._historyPointer===this._clickCoords.length)return this;var i=this._clickCoords.slice(0,++this._historyPointer);return t.update(i,this._geometry),this},n.prototype._shouldRecordHistory=function(t){return Array.isArray(t)&&"click"===t[0]&&"mousemove"===t[1]&&"dblclick"===t[2]},n.prototype._checkMode=function(){this._getRegisterMode()},n.prototype._saveMapCfg=function(){var t=this.getMap();if(this._mapDoubleClickZoom=t.options.doubleClickZoom,t.config({doubleClickZoom:this.options.doubleClickZoom}),-1<this._getRegisterMode().action.indexOf("mousedown")){var e=this.getMap();this._mapDraggable=e.options.draggable,e.config({draggable:!1})}},n.prototype._restoreMapCfg=function(){var t=this.getMap();t.config({doubleClickZoom:this._mapDoubleClickZoom}),Y(this._mapDraggable)||t.config("draggable",this._mapDraggable),delete this._mapDraggable,delete this._mapDoubleClickZoom},n.prototype._loadResources=function(){var t=Pt(this.getSymbol());0<t.length&&this._drawToolLayer._getRenderer().loadResources(t)},n.prototype._getProjection=function(){return this._map.getProjection()},n.prototype._getRegisterMode=function(){var t=this.getMode(),e=n.getRegisterMode(t);if(!e)throw new Error(t+" is not a valid mode of DrawTool.");return e},n.prototype.getEvents=function(){var t=this._getRegisterMode().action,e={};if(Array.isArray(t)){for(var i=0;i<t.length;i++)e[t[i]]=this._events[t[i]];return e}return null},n.prototype._mouseDownHandler=function(t){this._createGeometry(t)},n.prototype._mouseUpHandler=function(t){this.endDraw(t)},n.prototype._firstClickHandler=function(t){var e=this._getRegisterMode(),i=t.coordinate;this._geometry?(Y(this._historyPointer)||(this._clickCoords=this._clickCoords.slice(0,this._historyPointer)),this._clickCoords.push(i),this._historyPointer=this._clickCoords.length,e.clickLimit&&e.clickLimit===this._historyPointer?(e.update([i],this._geometry,t),this.endDraw(t)):e.update(this._clickCoords,this._geometry,t),this._fireEvent("drawvertex",t)):this._createGeometry(t)},n.prototype._createGeometry=function(t){var e=this.getMode(),i=this._getRegisterMode(),n=t.coordinate,r=this.getSymbol();this._geometry||(this._clickCoords=[n],this._geometry=i.create(this._clickCoords,t),r&&"point"!==e?this._geometry.setSymbol(r):this.options.hasOwnProperty("symbol")&&this._geometry.setSymbol(this.options.symbol),this._addGeometryToStage(this._geometry),this._fireEvent("drawstart",t)),"point"===e&&this.endDraw(t)},n.prototype._mouseMoveHandler=function(t){var e=this.getMap(),i=t.coordinate;if(this._geometry&&e&&!e.isInteracting()){var n=this._getMouseContainerPoint(t);if(this._isValidContainerPoint(n)){var r=this._getRegisterMode();if(this._shouldRecordHistory(r.action)){var o=this._clickCoords.slice(0,this._historyPointer);if(o&&0<o.length&&i.equals(o[o.length-1]))return;null!==this._historyPointer&&(this._clickCoords=this._clickCoords.slice(0,this._historyPointer)),this._historyPointer=this._clickCoords.length,r.update(o.concat([i]),this._geometry,t)}else r.update([i],this._geometry,t);this._fireEvent("mousemove",t)}}},n.prototype._doubleClickHandler=function(t){if(this._geometry){var e=this._getMouseContainerPoint(t);if(this._isValidContainerPoint(e)){var i=this._getRegisterMode(),n=this._clickCoords;if(!(n.length<2)){for(var r=[n[0]],o=1,a=n.length;o<a;o++)n[o].x===n[o-1].x&&n[o].y===n[o-1].y||r.push(n[o]);r.length<2||this._geometry&&this._geometry instanceof Hn&&r.length<3||(i.update(r,this._geometry,t),this.endDraw(t))}}}},n.prototype._addGeometryToStage=function(t){this._getDrawLayer().addGeometry(t)},n.prototype.endDraw=function(t){if(!this._geometry||this._ending)return this;this._ending=!0;var e=this._geometry;return this._clearStage(),t=t||{},this._geometry=e,this._fireEvent("drawend",t),delete this._geometry,this.options.once&&this.disable(),delete this._ending,this},n.prototype._clearStage=function(){this._getDrawLayer().clear(),delete this._geometry,delete this._clickCoords},n.prototype._getMouseContainerPoint=function(t){return"mousedown"===this._getRegisterMode().action&&Be(t.domEvent),t.containerPoint},n.prototype._isValidContainerPoint=function(t){var e=this._map.getSize(),i=e.width,n=e.height;return!(t.x<0||t.y<0)&&!(t.x>i||t.y>n)},n.prototype._getDrawLayer=function(){var t=d+"drawtool",e=this._map.getLayer(t);return e||(e=new wr(t,{enableSimplify:!1}),this._map.addLayer(e)),e},n.prototype._fireEvent=function(t,e){e||(e={}),this._geometry&&(e.geometry=this._getRegisterMode().generate(this._geometry).copy()),Mr.prototype._fireEvent.call(this,t,e)},n}(Mr);Tr.mergeOptions({symbol:{lineColor:"#000",lineWidth:2,lineOpacity:1,polygonFill:"#fff",polygonOpacity:.3},doubleClickZoom:!1,mode:null,once:!1,ignoreMouseleave:!0});var Cr=function(i){function n(t){u(this,n);var e=v(this,i.call(this,t));return e.drawTool=new Tr({mode:"boxZoom",ignoreMouseleave:!1}),e}return m(n,i),n.prototype.addHooks=function(){this.target.on("_mousedown",this._onMouseDown,this)},n.prototype.removeHooks=function(){this.target.off("_mousedown",this._onMouseDown,this),this.drawTool.isEnabled()&&this.drawTool.remove()},n.prototype._onMouseDown=function(t){this.target.options.boxZoom&&t.domEvent.shiftKey&&this.drawTool.setSymbol(this.target.options.boxZoomSymbol).on("drawend",this._boxZoom,this).addTo(this.target)},n.prototype._boxZoom=function(t){var e=this.target;this.drawTool.remove();var i=t.geometry,n=i.getCenter(),r=i.getSymbol(),o=r.markerWidth,a=r.markerHeight,s=new wi(n,e.locateByPoint(n,o,a),e.getProjection()),l=e.getFitZoom(s);e.animateTo({center:s.getCenter(),zoom:l})},n}(hi);en.mergeOptions({boxZoom:!0,boxZoomSymbol:{markerType:"rectangle",markerLineWidth:3,markerLineColor:"#1bbc9b",markerLineDasharray:[10,5],markerFillOpacity:.1,markerFill:"#1bbc9b",markerWidth:1,markerHeight:1}}),en.addOnLoadHook("addHandler","boxZoom",Cr),en.include({animateTo:function(t){var n=this,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},o=arguments[2];this._stopAnim(this._animPlayer),b(r)&&(o=r,r={});var a=this.getProjection(),e=this.getView(),s={},i=!0;for(var l in t)if(M(t,l)&&!Y(e[l]))if(i=!1,"center"===l){var h=new yi(e[l]).toFixed(7),c=new yi(t[l]).toFixed(7);h.equals(c)||(s.center=[h,c])}else e[l]!==t[l]&&"around"!==l&&(s[l]=[e[l],t[l]]);if(i)return null;var u=t.around||new le(this.width/2,this.height/2),d=this.getView(),p=this._getRenderer(),f=this._animPlayer=Nn.animate(s,{easing:r.easing||"out",duration:r.duration||this.options.zoomAnimationDuration,framer:function(t){p.callInNextFrame(t)}},function(t){if(n.isRemoved())f.finish();else{if("running"===f.playState){var e=n.getView();if(!r.continueOnViewChanged&&!function(t,e){for(var i in t)if(M(t,i))if("center"===i){if(t[i][0]!==e[i][0]||t[i][1]!==e[i][1])return!1}else if(t[i]!==e[i])return!1;return!0}(e,d))return void n._stopAnim(f);if(t.styles.center){var i=t.styles.center;n._setPrjCenter(a.project(i)),n.onMoving(n._parseEventFromCoord(n.getCenter()))}Y(t.styles.zoom)||n.onZooming(t.styles.zoom,u),Y(t.styles.pitch)||n.setPitch(t.styles.pitch),Y(t.styles.bearing)||n.setBearing(t.styles.bearing),d=n.getView(),n._fireEvent("animating")}else"finished"===f.playState&&(f._interupted||(s.center&&n._setPrjCenter(a.project(s.center[1])),Y(s.pitch)||n.setPitch(s.pitch[1]),Y(s.bearing)||n.setBearing(s.bearing[1])),n._endAnim(f,s,u,r),d=n.getView());o&&o(t)}});return this._startAnim(s,u),f},isAnimating:function(){return!!this._animPlayer},isRotating:function(){return this.isDragRotating()||!!this._animRotating},_endAnim:function(t,e,i,n){delete this._animRotating;var r=t._interupted?"animateinterupted":"animateend";if(t===this._animPlayer&&delete this._animPlayer,e.center){var o=void 0;o=t._interupted?this.getCenter():e.center[1],this.onMoveEnd(this._parseEventFromCoord(o))}Y(e.zoom)||(t._interupted?this.onZoomEnd(this.getZoom(),i):n.wheelZoom?this.onZooming(e.zoom[1],i):this.onZoomEnd(e.zoom[1],i)),r&&this._fireEvent(r)},_startAnim:function(t,e){this._animPlayer&&(t.center&&this.onMoveStart(),t.zoom&&!this.isZooming()&&this.onZoomStart(t.zoom[1],e),(t.pitch||t.bearing)&&(this._animRotating=!0),this._fireEvent("animatestart"),this._animPlayer.play())},_stopAnim:function(t){t&&"finished"!==t.playState&&(t._interupted=!0,t.finish())}});var Ar="mousedown mouseup mouseover mouseout mouseenter mouseleave mousemove click dblclick contextmenu keypress touchstart touchmove touchend ";function Er(t,e,i){var n,r,o,a,s,l,h,c,u,d,p,f,g=i[0],m=i[1],v=i[2];return e===t?(t[12]=e[0]*g+e[4]*m+e[8]*v+e[12],t[13]=e[1]*g+e[5]*m+e[9]*v+e[13],t[14]=e[2]*g+e[6]*m+e[10]*v+e[14],t[15]=e[3]*g+e[7]*m+e[11]*v+e[15]):(n=e[0],r=e[1],o=e[2],a=e[3],s=e[4],l=e[5],h=e[6],c=e[7],u=e[8],d=e[9],p=e[10],f=e[11],t[0]=n,t[1]=r,t[2]=o,t[3]=a,t[4]=s,t[5]=l,t[6]=h,t[7]=c,t[8]=u,t[9]=d,t[10]=p,t[11]=f,t[12]=n*g+s*m+u*v+e[12],t[13]=r*g+l*m+d*v+e[13],t[14]=o*g+h*m+p*v+e[14],t[15]=a*g+c*m+f*v+e[15]),t}function Pr(t,e,i){var n=i[0],r=i[1],o=i[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Lr(t,e,i){var n=e[0],r=e[1],o=e[2],a=e[3],s=e[4],l=e[5],h=e[6],c=e[7],u=e[8],d=e[9],p=e[10],f=e[11],g=e[12],m=e[13],v=e[14],y=e[15],_=i[0],x=i[1],w=i[2],b=i[3];return t[0]=_*n+x*s+w*u+b*g,t[1]=_*r+x*l+w*d+b*m,t[2]=_*o+x*h+w*p+b*v,t[3]=_*a+x*c+w*f+b*y,_=i[4],x=i[5],w=i[6],b=i[7],t[4]=_*n+x*s+w*u+b*g,t[5]=_*r+x*l+w*d+b*m,t[6]=_*o+x*h+w*p+b*v,t[7]=_*a+x*c+w*f+b*y,_=i[8],x=i[9],w=i[10],b=i[11],t[8]=_*n+x*s+w*u+b*g,t[9]=_*r+x*l+w*d+b*m,t[10]=_*o+x*h+w*p+b*v,t[11]=_*a+x*c+w*f+b*y,_=i[12],x=i[13],w=i[14],b=i[15],t[12]=_*n+x*s+w*u+b*g,t[13]=_*r+x*l+w*d+b*m,t[14]=_*o+x*h+w*p+b*v,t[15]=_*a+x*c+w*f+b*y,t}function Ir(t,e){var i=e[0],n=e[1],r=e[2],o=e[3],a=e[4],s=e[5],l=e[6],h=e[7],c=e[8],u=e[9],d=e[10],p=e[11],f=e[12],g=e[13],m=e[14],v=e[15],y=i*s-n*a,_=i*l-r*a,x=i*h-o*a,w=n*l-r*s,b=n*h-o*s,M=r*h-o*l,S=c*g-u*f,T=c*m-d*f,C=c*v-p*f,A=u*m-d*g,E=u*v-p*g,P=d*v-p*m,L=y*P-_*E+x*A+w*C-b*T+M*S;return L?(L=1/L,t[0]=(s*P-l*E+h*A)*L,t[1]=(r*E-n*P-o*A)*L,t[2]=(g*M-m*b+v*w)*L,t[3]=(d*b-u*M-p*w)*L,t[4]=(l*C-a*P-h*T)*L,t[5]=(i*P-r*C+o*T)*L,t[6]=(m*x-f*M-v*_)*L,t[7]=(c*M-d*x+p*_)*L,t[8]=(a*E-s*C+h*S)*L,t[9]=(n*C-i*E-o*S)*L,t[10]=(f*b-g*x+v*y)*L,t[11]=(u*x-c*b-p*y)*L,t[12]=(s*T-a*A-l*S)*L,t[13]=(i*A-n*T+r*S)*L,t[14]=(g*_-f*w-m*y)*L,t[15]=(c*w-u*_+d*y)*L,t):null}function Rr(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Dr(t,e,i,n){return t[0]=e,t[1]=i,t[2]=n,t}function Or(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}function kr(t){var e=t[0],i=t[1],n=t[2];return Math.sqrt(e*e+i*i+n*n)}function zr(t,e){var i=e[0],n=e[1],r=e[2],o=i*i+n*n+r*r;return 0<o&&(o=1/Math.sqrt(o),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o),t}function Nr(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Br(t,e,i){var n=e[0],r=e[1],o=e[2],a=i[0],s=i[1],l=i[2];return t[0]=r*l-o*s,t[1]=o*a-n*l,t[2]=n*s-r*a,t}function Fr(t,e,i){var n=e[0],r=e[1],o=e[2],a=1/(i[3]*n+i[7]*r+i[11]*o+i[15]);return t[0]=(i[0]*n+i[4]*r+i[8]*o+i[12])*a,t[1]=(i[1]*n+i[5]*r+i[9]*o+i[13])*a,t[2]=(i[2]*n+i[6]*r+i[10]*o+i[14])*a,t}en.include({_registerDomEvents:function(){Oe(this._panels.mapWrapper||this._containerDOM,Ar,this._handleDOMEvent,this)},_removeDomEvents:function(){ke(this._panels.mapWrapper||this._containerDOM,Ar,this._handleDOMEvent)},_handleDOMEvent:function(t){var e=t.type;if("contextmenu"===e&&Ne(t),!this._ignoreEvent(t)){var i=!1;if("mousedown"===e||"touchstart"===e&&1===t.touches.length)this._mouseDownTime=y();else if("click"===e||"touchend"===e||"contextmenu"===e){if(!this._mouseDownTime)return;var n=this._mouseDownTime;if(delete this._mouseDownTime,300<y()-n){if("click"===e||"contextmenu"===e)return}else"touchend"===e&&(i=!0)}this._fireDOMEvent(this,t,e),i&&(this._clickTime&&y()-this._clickTime<=300?(delete this._clickTime,this._fireDOMEvent(this,t,"dblclick")):(this._clickTime=y(),this._fireDOMEvent(this,t,"click")))}},_ignoreEvent:function(t){if(!t||!this._panels.control)return!1;if(this._isEventOutMap(t))return!0;var e=t.srcElement||t.target,i=void 0;if(e)for(;e&&e!==this._containerDOM;){if(e.className&&e.className.indexOf&&(0<=e.className.indexOf("mapcan-control")||0<=e.className.indexOf("mapcan-ui")&&!i.eventsPropagation))return!0;e=(i=e).parentNode}return!1},_isEventOutMap:function(t){if(this.getPitch()>this.options.maxVisualPitch){var e=He(this._getActualEvent(t),this._containerDOM);if(!this.getContainerExtent().contains(e))return!0}return!1},_parseEvent:function(t,e){if(!t)return null;var i={domEvent:t};if("keypress"!==e){var n=this._getActualEvent(t);if(n){var r=He(n,this._containerDOM);i=_(i,{coordinate:this.containerPointToCoord(r),containerPoint:r,viewPoint:this.containerPointToViewPoint(r),point2d:this._containerPointToPoint(r)})}}return i},_parseEventFromCoord:function(t){var e=this.coordToContainerPoint(t);return{coordinate:t,containerPoint:e,viewPoint:this.containerPointToViewPoint(e),point2d:this.coordToPoint(t)}},_getActualEvent:function(t){return t.touches&&0<t.touches.length?t.touches[0]:t.changedTouches&&0<t.changedTouches.length?t.changedTouches[0]:t},_fireDOMEvent:function(t,e,i){if(!this.isRemoved()){var n=this._parseEvent(e,i);this._fireEvent(i,n)}}}),en.addOnLoadHook("_registerDomEvents"),en.include({isFullScreen:function(){return!!(document.webkitIsFullScreen||document.mozFullScreen||document.msFullscreenElement||document.fullscreenElement)},requestFullScreen:function(t){return this._fireEvent("fullscreenstart"),this._requestFullScreen(t||this._containerDOM),this._fireEvent("fullscreenend"),this},cancelFullScreen:function(){return this._cancelFullScreen(),this._fireEvent("cancelfullscreen"),this},_requestFullScreen:function(t){if(t.requestFullScreen)t.requestFullScreen();else if(t.mozRequestFullScreen)t.mozRequestFullScreen();else if(t.webkitRequestFullScreen)t.webkitRequestFullScreen();else if(t.msRequestFullScreen)t.msRequestFullScreen();else{var e="fullscreen=1,status=no,resizable=yes,top=0,left=0,scrollbars=no,titlebar=no,menubar=no,location=no,toolbar=no,z-look=yes,width="+(screen.availWidth-8)+",height="+(screen.availHeight-45);null!==window.open(location.href,"_blank",e)&&(window.opener=null,window.close())}},_cancelFullScreen:function(){if(document.cancelFullScreen)document.cancelFullScreen();else if(document.mozCancelFullScreen)document.mozCancelFullScreen();else if(document.webkitCancelFullScreen)document.webkitCancelFullScreen();else{null!==window.open(location.href,"_blank","fullscreen=no,status=yes,resizable=yes,scrollbars=no,titlebar=no,menubar=yes,location=yes,toolbar=yes,z-look=yes")&&(window.opener=null,window.close())}}}),en.include({panTo:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},i=arguments[2];return t?(b(e)&&(i=e,e={}),t=new yi(t),void 0===e.animation||e.animation?this._panAnimation(t,e.duration,i):(this.setCenter(t),this)):this},panBy:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},i=arguments[2];if(!t)return this;if(b(e)&&(i=e,e={}),t=new le(t).multi(-1),this.onMoveStart(),void 0===e.animation||e.animation){var n=this.locateByPoint(this.getCenter(),t.x,t.y);this._panAnimation(n,e.duration,i)}else this._offsetCenterByPixel(t),this.onMoveEnd(this._parseEventFromCoord(this.getCenter()));return this},_panAnimation:function(t,e,i){return this.options.panAnimation?this.animateTo({center:t},{duration:e||this.options.panAnimationDuration},i):this.setCenter(t)}}),Pn.fromJSON=function(t){if(Array.isArray(t)){for(var e=[],i=0,n=t.length;i<n;i++){var r=Pn.fromJSON(t[i]);Array.isArray(t)?e=e.concat(r):e.push(r)}return e}if(t&&!t.feature)return er.toGeometry(t);var o=void 0;return t.subType?(o=Pn.getJSONClass(t.subType).fromJSON(t),Y(t.feature.id)||o.setId(t.feature.id)):(o=er.toGeometry(t.feature),t.options&&o.config(t.options)),t.symbol&&o.setSymbol(t.symbol),t.infoWindow&&o.setInfoWindow(t.infoWindow),o},Ji.fromJSON=function(t){if(!t)return null;var e=t.type,i=Ji.getJSONClass(e);if(!i||!i.fromJSON)throw new Error("unsupported layer type:"+e);return i.fromJSON(t)},en.include({JSON_VERSION:"1.0",toJSON:function(t){t||(t={});var e={version:this.JSON_VERSION,extent:this.getExtent().toJSON()};e.options=this.config(),e.options.center=this.getCenter(),e.options.zoom=this.getZoom();var i=this.getBaseLayer();(Y(t.baseLayer)||t.baseLayer)&&i&&(e.baseLayer=i.toJSON(t.baseLayer));var n={};t.clipExtent&&(!0===t.clipExtent?n.clipExtent=this.getExtent():n.clipExtent=t.clipExtent);var r=[];if(Y(t.layers)||t.layers&&!Array.isArray(t.layers)){for(var o=this.getLayers(),a=0,s=o.length;a<s;a++)if(o[a].toJSON){var l=_({},x(t.layers)?t.layers:{},n);r.push(o[a].toJSON(l))}e.layers=r}else if(H(t.layers)){for(var h=t.layers,c=0;c<h.length;c++){var u=h[c],d=this.getLayer(u.id);if(d.toJSON){var p=_({},u.options,n);r.push(d.toJSON(p))}}e.layers=r}else e.layers=[];return e}}),en.fromJSON=function(t,e,i){if(!t||!e)return null;i||(i={});var n=new en(t,e.options);if(Y(i.baseLayer)||i.baseLayer){var r=Ji.fromJSON(e.baseLayer);r&&n.setBaseLayer(r)}if(Y(i.layers)||i.layers){for(var o=[],a=e.layers,s=0;s<a.length;s++){var l=Ji.fromJSON(a[s]);o.push(l)}n.addLayer(o)}return n},en.include({computeLength:function(t,e){if(!this.getProjection())return null;var i=new yi(t),n=new yi(e);return i.equals(n)?0:this.getProjection().measureLength(i,n)},computeGeometryLength:function(t){return t._computeGeodesicLength(this.getProjection())},computeGeometryArea:function(t){return t._computeGeodesicArea(this.getProjection())},identify:function(t,e){if(!t)return this;var i=t.layers;if(!H(i))return this;for(var n=[],r=0,o=i.length;r<o;r++)S(i[r])?n.push(this.getLayer(i[r])):n.push(i[r]);for(var a=new yi(t.coordinate),s=_({},t),l=[],h=n.length-1;0<=h&&!(t.count&&l.length>=t.count);h--){var c=n[h];if(c&&c.getMap()&&(t.includeInvisible||c.isVisible())&&(t.includeInternals||!(0<=c.getId().indexOf(d)))){var u=c.identify(a,s);u&&(Array.isArray(u)?D(l,u):l.push(u))}}return e.call(this,l),this}}),en.include({_zoom:function(t,e){this.options.zoomable&&!this.isZooming()&&(e=this._checkZoomOrigin(e),t=this._checkZoom(t),this.onZoomStart(t,e),this._frameZoom=this.getZoom(),this.onZoomEnd(t,e))},_zoomAnimation:function(t,e,i){this.options.zoomable&&!this.isZooming()&&(t=this._checkZoom(t),this.getZoom()!==t&&(e=this._checkZoomOrigin(e),this._startZoomAnim(t,e,i)))},_checkZoomOrigin:function(t){return t&&!this.options.zoomInCenter||(t=new le(this.width/2,this.height/2)),t},_startZoomAnim:function(t,e,i){Y(i)&&(i=1);var n=this._getResolution(this._startZoomVal)/this._getResolution(t),r=this.options.zoomAnimationDuration*Math.abs(n-i)/Math.abs(n-1);this._frameZoom=this._startZoomVal,this.animateTo({zoom:t,around:e},{continueOnViewChanged:!0,duration:r})},onZoomStart:function(t,e){this.options.zoomable&&!this.isZooming()&&(this._zooming=!0,this._startZoomVal=this.getZoom(),this._startZoomCoord=this._containerPointToPrj(e),this._fireEvent("zoomstart",{from:this._startZoomVal,to:t}))},onZooming:function(t,e,i){if(this.options.zoomable&&this._frameZoom!==t){Y(i)&&(i=1),this._zoomTo(t,e);var n=this.getResolution(t),r=this.getResolution(this._startZoomVal)/n/i,o=this._prjToContainerPoint(this._startZoomCoord,this._startZoomVal),a=this.getViewPoint();if(!this.isRotating()&&!o.equals(e)&&1!==r){var s=this.getPitch(),l=o._sub(e)._multi(1/(1-r));s&&(l.y/=Math.cos(s*Math.PI/180)),e=e.add(l)}var h={view:[r,0,0,r,(e.x-a.x)*(1-r),(e.y-a.y)*(1-r)]};ae.retina&&(e=e.multi(2)),h.container=[r,0,0,r,e.x*(1-r),e.y*(1-r)],this._fireEvent("zooming",{from:this._startZoomVal,to:t,origin:e,matrix:h}),this._frameZoom=t}},onZoomEnd:function(t,e){if(this.options.zoomable){var i=this._startZoomVal;this._zoomTo(t,e),this._zooming=!1,this._getRenderer().onZoomEnd(),this._fireEvent("zoomend",{from:i,to:t}),this._verifyExtent(this.getCenter())||this.panTo(this.getMaxExtent().getCenter())}},_zoomTo:function(t,e){this._zoomLevel=t,this._calcMatrices(),e&&this._setPrjCoordAtContainerPoint(this._startZoomCoord,e)},_checkZoom:function(t){var e=this.getMaxZoom(),i=this.getMinZoom();return t<i&&(t=i),e<t&&(t=e),t}});var Gr,Vr,Hr,Ur,Wr,jr,Zr,Xr,qr,Yr,Jr,Kr,Qr,$r,to,eo=Math.PI/180;function io(){return Rr(new Array(16))}en.include({getFov:function(){return this._fov||(this._fov=.6435011087932844),this._fov/eo},setFov:function(t){if(this.isZooming())return this;if(t=Math.max(.01,Math.min(60,t)),this._fov===t)return this;var e=this.getFov();return this._fov=t*eo,this._calcMatrices(),this._renderLayers(),this._fireEvent("fovchange",{from:e,to:this.getFov()}),this},getBearing:function(){return this._angle?-this._angle/eo:0},setBearing:function(t){if(ae.ie9)throw new Error("map can't rotate in IE9.");var e=-G(t,-180,180)*eo;if(this._angle===e)return this;var i=this.getBearing();return this._fireEvent("rotatestart",{from:i,to:e}),this._angle=e,this._calcMatrices(),this._renderLayers(),this._fireEvent("rotate",{from:i,to:e}),this._fireEvent("rotateend",{from:i,to:e}),this},getPitch:function(){return this._pitch?this._pitch/Math.PI*180:0},setPitch:function(t){if(ae.ie9)throw new Error("map can't tilt in IE9.");var e=V(t,0,this.options.maxPitch)*eo;if(this._pitch===e)return this;var i=this.getPitch();return this._fireEvent("pitchstart",{from:i,to:e}),this._pitch=e,this._calcMatrices(),this._renderLayers(),this._fireEvent("pitch",{from:i,to:e}),this._fireEvent("pitchend",{from:i,to:e}),this},isTransforming:function(){return!(!this._pitch&&!this._angle)},getFrustumAltitude:function(){var t=90-this.getPitch(),e=this.getFov()/2,i=this.cameraPosition?this.cameraPosition[2]:0;if(e<=t)return i;e=Math.PI*e/180;var n=new le(this.cameraPosition).distanceTo(new le(this.cameraLookAt)),r=i*Math.tan(2*e);return i+Math.tan(e)*(n+r)},_pointToContainerPoint:(to=[0,0,0],function(t,e){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;if(t=this._pointToPoint(t,e),this.isTransforming()||i){i*=this.getResolution(e)/this.getResolution();var n=this._glScale;Dr(to,t.x*n,t.y*n,i*n);var r=this._projIfBehindCamera(to,this.cameraPosition,this.cameraForward);Fr(r,r,this.projViewMatrix);var o=this.width/2,a=this.height/2;return r[0]=r[0]*o+o,r[1]=-r[1]*a+a,new le(r[0],r[1])}var s=this._prjToPoint(this._getPrjCenter());return t._sub(s)._add(this.width/2,this.height/2)}),_projIfBehindCamera:(Jr=new Array(3),Kr=new Array(3),Qr=new Array(3),$r=new Array(3),function(t,e,i){var n,r,o,a,s,l;if(Or(Jr,t,e),Nr(i,zr(Kr,Jr))<=0){var h=Nr(i,Jr);s=i,l=1.01*h,(a=Qr)[0]=s[0]*l,a[1]=s[1]*l,a[2]=s[2]*l,n=t,r=e,o=Or($r,Jr,Qr),n[0]=r[0]+o[0],n[1]=r[1]+o[1],n[2]=r[2]+o[2]}return t}),_containerPointToPoint:(Xr=[0,0,0],qr=[0,0,0,1],Yr=[0,0,0,1],function(t,e){if(this.isTransforming()){var i=this.width/2||1,n=this.height/2||1;Dr(Xr,(t.x-i)/i,(n-t.y)/n,0),Dr(qr,Xr[0],Xr[1],0),Dr(Yr,Xr[0],Xr[1],1),qr[3]=Yr[3]=1,Fr(qr,qr,this.projViewMatrixInverse),Fr(Yr,Yr,this.projViewMatrixInverse);var r=qr[0],o=Yr[0],a=qr[1],s=Yr[1],l=qr[2],h=Yr[2],c=l===h?0:(0-l)/(h-l),u=new le(F(r,o,c),F(a,s,c))._multi(1/this._glScale);return void 0===e||this.getZoom()===e?u:this._pointToPointAtZoom(u,e)}var d=this._prjToPoint(this._getPrjCenter(),e),p=void 0!==e?this._getResolution()/this._getResolution(e):1,f=p*(t.x-this.width/2),g=p*(t.y-this.height/2);return d._add(f,g)}),_calcMatrices:(jr=ae.ie9?null:io(),Zr=ae.ie9?null:io(),function(){if(!ae.ie9){var t=this.getSize(),e=t.width||1,i=t.height||1;this._glScale=this.getGLScale();var n,r,o,a,s,l,h,c=this.getFov()*Math.PI/180,u=this.getScale(this.getMinZoom())/this.getScale(this.getMaxNativeZoom())*i/2/this._getFovRatio()*1.4,d=this.projMatrix||io();n=d,r=c,o=e/i,a=.1,s=u,l=1/Math.tan(r/2),h=1/(a-s),n[0]=l/o,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=l,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=(s+a)*h,n[11]=-1,n[12]=0,n[13]=0,n[14]=2*s*a*h,n[15]=0,this.projMatrix=d;var p=this._getCameraWorldMatrix();this.viewMatrix=Ir(jr,p),this.projViewMatrix=Lr(this.projViewMatrix||io(),d,this.viewMatrix),this.projViewMatrixInverse=Lr(this.projViewMatrixInverse||io(),p,Ir(Zr,d)),this.domCssMatrix=this._calcDomMatrix()}}),_calcDomMatrix:(Hr=ae.ie9?null:io(),Ur=[1,-1,1],Wr=[0,0,0],function(){var t,e,i,n,r,o,a,s,l,h,c,u,d,p,f,g,m,v,y,_,x,w,b,M,S,T,C=.5/Math.tan(this._fov/2)*this.height;Pr(Hr,this.projMatrix,Ur),Er(Hr,Hr,Dr(Wr,0,0,-C)),this._pitch&&(e=t=Hr,i=this._pitch,n=Math.sin(i),r=Math.cos(i),o=e[4],a=e[5],s=e[6],l=e[7],h=e[8],c=e[9],u=e[10],d=e[11],e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*r+h*n,t[5]=a*r+c*n,t[6]=s*r+u*n,t[7]=l*r+d*n,t[8]=h*r-o*n,t[9]=c*r-a*n,t[10]=u*r-s*n,t[11]=d*r-l*n),this._angle&&(f=p=Hr,g=this._angle,m=Math.sin(g),v=Math.cos(g),y=f[0],_=f[1],x=f[2],w=f[3],b=f[4],M=f[5],S=f[6],T=f[7],f!==p&&(p[8]=f[8],p[9]=f[9],p[10]=f[10],p[11]=f[11],p[12]=f[12],p[13]=f[13],p[14]=f[14],p[15]=f[15]),p[0]=y*v+b*m,p[1]=_*v+M*m,p[2]=x*v+S*m,p[3]=w*v+T*m,p[4]=b*v-y*m,p[5]=M*v-_*m,p[6]=S*v-x*m,p[7]=T*v-w*m);var A=io();return Pr(A,A,Dr(Wr,this.width/2,-this.height/2,1)),Lr(this.domCssMatrix||io(),A,Hr)}),_getCameraWorldMatrix:(Gr={},Vr=[1,-1,1],function(){var t=this.getGLZoom(),e=this.getSize(),i=this.getGLScale(),n=this._prjToPoint(this._prjCenter,t);this.cameraLookAt=Dr(this.cameraLookAt||[0,0,0],n.x,n.y,0);var r=this.getPitch()*eo,o=-this.getBearing()*eo,a=this._getFovRatio(),s=i*(e.height||1)/2/a,l=s*Math.cos(r),h=Math.sin(r)*s,c=n.x+h*Math.sin(o),u=n.y+h*Math.cos(o);this.cameraPosition=Dr(this.cameraPosition||[0,0,0],c,u,l);var d,p,f,g,m,v,y,_=h||1,x=this.cameraUp=Dr(this.cameraUp||[0,0,0],Math.sin(o)*_,Math.cos(o)*_,0),w=this.cameraWorldMatrix=this.cameraWorldMatrix||io();d=w,p=this.cameraPosition,f=this.cameraLookAt,g=x,m=[0,0,0],v=[0,0,0],Or(y=[0,0,0],p,f),0===kr(y)&&(y[2]=1),zr(y,y),Br(m,g,y),0===kr(y)&&(1===Math.abs(g[2])?y[0]+=1e-4:y[2]+=1e-4,zr(y,y),Br(m,g,y)),zr(m,m),Br(v,y,m),d[0]=m[0],d[4]=v[0],d[8]=y[0],d[1]=m[1],d[5]=v[1],d[9]=y[1],d[2]=m[2],d[6]=v[2],d[10]=y[2];var b,M,S,T,C,A,E,P,L,I,R,D,O,k,z,N,B,F,G,V,H,U,W,j,Z,X,q,Y,J,K,Q,$,tt,et,it=this.cameraForward||[0,0,0];return Or(it,this.cameraLookAt,this.cameraPosition),this.cameraForward=zr(it,it),b=Gr,S=(M=w)[0],T=M[4],C=M[8],A=M[1],E=M[5],P=M[9],L=M[2],I=M[6],R=M[10],O=void 0,0<(D=S+E+R)?(O=.5/Math.sqrt(D+1),b.w=.25/O,b.x=(I-P)*O,b.y=(C-L)*O,b.z=(A-T)*O):E<S&&R<S?(O=2*Math.sqrt(1+S-E-R),b.w=(I-P)/O,b.x=.25*O,b.y=(T+A)/O,b.z=(C+L)/O):R<E?(O=2*Math.sqrt(1+E-S-R),b.w=(C-L)/O,b.x=(T+A)/O,b.y=.25*O,b.z=(P+I)/O):(O=2*Math.sqrt(1+R-S-E),b.w=(A-T)/O,b.x=(C+L)/O,b.y=(P+I)/O,b.z=.25*O),z=w,N=(k=Gr).x,B=k.y,F=k.z,G=k.w,W=N*(V=N+N),j=N*(H=B+B),Z=N*(U=F+F),X=B*H,q=B*U,Y=F*U,J=G*V,K=G*H,Q=G*U,z[0]=1-(X+Y),z[4]=j-Q,z[8]=Z+K,z[1]=j+Q,z[5]=1-(W+Y),z[9]=q-J,z[2]=Z-K,z[6]=q+J,z[10]=1-(W+X),z[3]=0,z[7]=0,z[11]=0,z[12]=0,z[13]=0,z[14]=0,z[15]=1,$=w,tt=this.cameraPosition,(et=$)[12]=tt[0],et[13]=tt[1],et[14]=tt[2],Pr(w,w,Vr),w}),_getFovRatio:function(){var t=this.getFov();return Math.tan(t/2*eo)},_renderLayers:function(){this.isInteracting()||this._getLayers().forEach(function(t){if(t){var e=t._getRenderer();e&&e.setToRedraw&&e.setToRedraw()}})}}),en.include({_onViewChange:function(t){this._viewHistory||(this._viewHistory=[],this._viewHistoryPointer=0);for(var e=this._getCurrentView(),i=this._viewHistory.length-1;0<=i;i--)if(tt(t,this._viewHistory[i]))return this._viewHistoryPointer=i,void this._fireViewChange(e,t);this._viewHistoryPointer<this._viewHistory.length-1&&this._viewHistory.splice(this._viewHistoryPointer+1),this._viewHistory.push(t);var n=this.options.viewHistoryCount;0<n&&this._viewHistory.length>n&&this._viewHistory.splice(0,this._viewHistory.length-n),this._viewHistoryPointer=this._viewHistory.length-1,this._fireViewChange(e,t)},zoomToPreviousView:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};if(!this.hasPreviousView())return null;var e=this._viewHistory[--this._viewHistoryPointer];return this._zoomToView(e,t),e},hasPreviousView:function(){return!(!this._viewHistory||0===this._viewHistoryPointer)},zoomToNextView:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};if(!this.hasNextView())return null;var e=this._viewHistory[++this._viewHistoryPointer];return this._zoomToView(e,t),e},hasNextView:function(){return!(!this._viewHistory||this._viewHistoryPointer===this._viewHistory.length-1)},_zoomToView:function(e,t){var i=this,n=this.getView();t.animation?this.animateTo(e,{duration:t.duration},function(t){"finished"===t.state.playState&&i._fireViewChange(n,e)}):(this.setView(e),this._fireViewChange(n,e))},getViewHistory:function(){return this._viewHistory},_fireViewChange:function(t,e){this._fireEvent("viewchange",{old:t,new:e})},_getCurrentView:function(){return this._viewHistory?this._viewHistory[this._viewHistoryPointer]:null}}),en.mergeOptions({viewHistory:!0,viewHistoryCount:10});var no=function(i){function n(t){u(this,n);var e=v(this,i.call(this,t));return e.on("enable",e._afterEnable,e).on("disable",e._afterDisable,e),e._measureLayers=[],e}return m(n,i),n.prototype.clear=function(){if(H(this._measureLayers))for(var t=0;t<this._measureLayers.length;t++)this._measureLayers[t].remove();return delete this._lastMeasure,delete this._lastVertex,this._measureLayers=[],this},n.prototype.getMeasureLayers=function(){return this._measureLayers},n.prototype.getLastMeasure=function(){return this._lastMeasure?this._lastMeasure:0},n.prototype._measure=function(t){var e=this.getMap(),i=void 0;t instanceof Pn?i=e.computeGeometryLength(t):Array.isArray(t)&&(i=e.getProjection().measureLength(t)),this._lastMeasure=i;var n=void 0;n="zh-CN"===this.options.language?[" \u7c73"," \u516c\u91cc"," \u82f1\u5c3a"," \u82f1\u91cc"]:[" m"," km"," feet"," mile"];var r="";return this.options.metric&&(r+=i<1e3?i.toFixed(0)+n[0]:(i/1e3).toFixed(2)+n[1]),this.options.imperial&&(i*=3.2808399,0<r.length&&(r+="\n"),r+=i<5280?i.toFixed(0)+n[2]:(i/5280).toFixed(2)+n[3]),r},n.prototype._registerMeasureEvents=function(){this.on("drawstart",this._msOnDrawStart,this).on("drawvertex",this._msOnDrawVertex,this).on("mousemove",this._msOnMouseMove,this).on("drawend",this._msOnDrawEnd,this)},n.prototype._afterEnable=function(){this._registerMeasureEvents()},n.prototype._afterDisable=function(){this.off("drawstart",this._msOnDrawStart,this).off("drawvertex",this._msOnDrawVertex,this).off("mousemove",this._msOnMouseMove,this).off("drawend",this._msOnDrawEnd,this)},n.prototype._msOnDrawStart=function(t){var e=this.getMap(),i=L(),n="distancetool_"+i,r="distancetool_markers_"+i;e.getLayer(n)?(this._measureLineLayer=e.getLayer(n),this._measureMarkerLayer=e.getLayer(r)):(this._measureLineLayer=new wr(n).addTo(e),this._measureMarkerLayer=new wr(r).addTo(e)),this._measureLayers.push(this._measureLineLayer),this._measureLayers.push(this._measureMarkerLayer),new Wn(t.coordinate,{symbol:this.options.vertexSymbol}).addTo(this._measureMarkerLayer);var o="zh-CN"===this.options.language?"\u8d77\u70b9":"start",a=new fr(o,t.coordinate,this.options.labelOptions);this._measureMarkerLayer.addGeometry(a)},n.prototype._msOnMouseMove=function(t){var e=this._measure(this._msGetCoordsToMeasure(t));if(!this._tailMarker){var i=zt(this.options.vertexSymbol);i.markerWidth/=2,i.markerHeight/=2,this._tailMarker=new Wn(t.coordinate,{symbol:i}).addTo(this._measureMarkerLayer),this._tailLabel=new fr(e,t.coordinate,this.options.labelOptions).addTo(this._measureMarkerLayer)}this._tailMarker.setCoordinates(t.coordinate),this._tailLabel.setContent(e),this._tailLabel.setCoordinates(t.coordinate)},n.prototype._msGetCoordsToMeasure=function(t){return t.geometry.getCoordinates().concat([t.coordinate])},n.prototype._msOnDrawVertex=function(t){var e=t.geometry;new Wn(t.coordinate,{symbol:this.options.vertexSymbol}).addTo(this._measureMarkerLayer);var i=this._measure(e),n=new fr(i,t.coordinate,this.options.labelOptions);this._measureMarkerLayer.addGeometry(n),this._lastVertex=n},n.prototype._msOnDrawEnd=function(t){this._clearTailMarker();var e=this._lastVertex.getSize();e||(e=new he(10,10)),this._addClearMarker(this._lastVertex.getCoordinates(),e.width);var i=t.geometry.copy();i.addTo(this._measureLineLayer),this._lastMeasure=i.getLength()},n.prototype._addClearMarker=function(t,e){var i=this.options.clearButtonSymbol,n={markerDx:(i.markerDx||0)+e,textDx:(i.textDx||0)+e};Array.isArray(i)&&(n=i.map(function(t){return t?{markerDx:(t.markerDx||0)+e,textDx:(t.textDx||0)+e}:null})),i=zt(i,n);var r=new Wn(t,{symbol:i}),o=this._measureLineLayer,a=this._measureMarkerLayer;r.on("click",function(){return o.remove(),a.remove(),!1},this),r.addTo(this._measureMarkerLayer)},n.prototype._clearTailMarker=function(){this._tailMarker&&(this._tailMarker.remove(),delete this._tailMarker),this._tailLabel&&(this._tailLabel.remove(),delete this._tailLabel)},n}(Tr);no.mergeOptions({mode:"LineString",language:"zh-CN",metric:!0,imperial:!1,symbol:{lineColor:"#000",lineWidth:3,lineOpacity:1},vertexSymbol:{markerType:"ellipse",markerFill:"#fff",markerLineColor:"#000",markerLineWidth:3,markerWidth:11,markerHeight:11},labelOptions:{textSymbol:{textFaceName:"monospace",textLineSpacing:1,textHorizontalAlignment:"right",textDx:15},boxStyle:{padding:[6,2],symbol:{markerType:"square",markerFill:"#fff",markerFillOpacity:.9,markerLineColor:"#b4b3b3"}}},clearButtonSymbol:[{markerType:"square",markerFill:"#fff",markerLineColor:"#b4b3b3",markerLineWidth:2,markerWidth:15,markerHeight:15,markerDx:20},{markerType:"x",markerWidth:10,markerHeight:10,markerDx:20}]});var ro=function(i){function n(t){u(this,n);var e=v(this,i.call(this,t));return e.on("enable",e._afterEnable,e).on("disable",e._afterDisable,e),e._measureLayers=[],e}return m(n,i),n.prototype._measure=function(t){var e=this.getMap(),i=void 0;t instanceof Pn?i=e.computeGeometryArea(t):Array.isArray(t)&&(i=e.getProjection().measureArea(t)),this._lastMeasure=i;var n=void 0;n="zh-CN"===this.options.language?[" \u5e73\u65b9\u7c73"," \u5e73\u65b9\u516c\u91cc"," \u5e73\u65b9\u82f1\u5c3a"," \u5e73\u65b9\u82f1\u91cc"]:[" sq.m"," sq.km"," sq.ft"," sq.mi"];var r="";if(this.options.metric&&(r+=i<1e6?i.toFixed(0)+n[0]:(i/1e6).toFixed(2)+n[1]),this.options.imperial){i*=3.2808399,0<r.length&&(r+="\n");r+=i<27878400?i.toFixed(0)+n[2]:(i/27878400).toFixed(2)+n[3]}return r},n.prototype._msGetCoordsToMeasure=function(t){return t.geometry.getShell().concat([t.coordinate])},n.prototype._msOnDrawVertex=function(t){var e=new Wn(t.coordinate,{symbol:this.options.vertexSymbol}).addTo(this._measureMarkerLayer);this._measure(t.geometry),this._lastVertex=e},n.prototype._msOnDrawEnd=function(t){this._clearTailMarker();var e=this._measure(t.geometry),i=new fr(e,t.coordinate,this.options.labelOptions).addTo(this._measureMarkerLayer).getSize();i||(i=new he(10,10)),this._addClearMarker(t.coordinate,i.width);var n=t.geometry.copy();n.addTo(this._measureLineLayer),this._lastMeasure=n.getArea()},n}(no);function oo(t){for(var e=t.tileInfo,i=[e.cols,e.rows],n=[],r=e.lods,o=0,a=r.length;o<a;o++)n.push(r[o].resolution);var s=t.fullExtent,l=e.origin,h=[1,-1,l.x,l.y];return delete s.spatialReference,{spatialReference:{resolutions:n,fullExtent:s},tileSystem:h,tileSize:i}}ro.mergeOptions({mode:"Polygon",symbol:{lineColor:"#000000",lineWidth:2,lineOpacity:1,lineDasharray:"",polygonFill:"#ffffff",polygonOpacity:.5}}),Tr.registerMode("circle",{clickLimit:2,action:["click","mousemove","click"],create:function(t){return new ir(t[0],0)},update:function(t,e){var i=e.getMap().computeLength(e.getCenter(),t[t.length-1]);e.setRadius(i)},generate:function(t){return t}}),Tr.registerMode("freeHandCircle",{action:["mousedown","mousemove","mouseup"],create:function(t){return new ir(t[0],0)},update:function(t,e){var i=e.getMap().computeLength(e.getCenter(),t[t.length-1]);e.setRadius(i)},generate:function(t){return t}}),Tr.registerMode("ellipse",{clickLimit:2,action:["click","mousemove","click"],create:function(t){return new nr(t[0],0,0)},update:function(t,e){var i=e.getMap(),n=e.getCenter(),r=i.computeLength(n,new yi({x:t[t.length-1].x,y:n.y})),o=i.computeLength(n,new yi({x:n.x,y:t[t.length-1].y}));e.setWidth(2*r),e.setHeight(2*o)},generate:function(t){return t}}),Tr.registerMode("freeHandEllipse",{action:["mousedown","mousemove","mouseup"],create:function(t){return new nr(t[0],0,0)},update:function(t,e){var i=e.getMap(),n=e.getCenter(),r=i.computeLength(n,new yi({x:t[t.length-1].x,y:n.y})),o=i.computeLength(n,new yi({x:n.x,y:t[t.length-1].y}));e.setWidth(2*r),e.setHeight(2*o)},generate:function(t){return t}}),Tr.registerMode("rectangle",{clickLimit:2,action:["click","mousemove","click"],create:function(t){var e=new Hn([]);return e._firstClick=t[0],e},update:function(t,e){var i=e._firstClick,n=[[i.x,i.y],[t[0].x,i.y],[t[0].x,t[0].y],[i.x,t[0].y]];e.setCoordinates(n)},generate:function(t){return t}}),Tr.registerMode("freeHandRectangle",{action:["mousedown","mousemove","mouseup"],create:function(t){var e=new Hn([]);return e._firstClick=t[0],e},update:function(t,e){var i=e._firstClick,n=[[i.x,i.y],[t[0].x,i.y],[t[0].x,t[0].y],[i.x,t[0].y]];e.setCoordinates(n)},generate:function(t){return t}}),Tr.registerMode("point",{clickLimit:1,action:["click"],create:function(t){return new Wn(t[0])},generate:function(t){return t}}),Tr.registerMode("polygon",{action:["click","mousemove","dblclick"],create:function(t){return new Zn(t)},update:function(t,e){var i=e.getSymbol();e.setCoordinates(t);var n=e.getLayer();if(n){var r=n.getGeometryById("polygon");if(!r&&3<=t.length){if(r=new Hn([t],{id:"polygon"}),i){var o=zt(i,{lineOpacity:0});r.setSymbol(o)}r.addTo(n)}r&&r.setCoordinates(t)}},generate:function(t){return new Hn(t.getCoordinates(),{symbol:t.getSymbol()})}}),Tr.registerMode("freeHandPolygon",{action:["mousedown","mousemove","mouseup"],create:function(t){return new Zn(t)},update:function(t,e){var i=e.getCoordinates(),n=e.getSymbol();e.setCoordinates(i.concat(t));var r=e.getLayer();if(r){var o=r.getGeometryById("polygon");if(!o&&3<=t.length){if(o=new Hn([t],{id:"polygon"}),n){var a=zt(n,{lineOpacity:0});o.setSymbol(a)}o.addTo(r)}o&&o.setCoordinates(t)}},generate:function(t){return new Hn(t.getCoordinates(),{symbol:t.getSymbol()})}}),Tr.registerMode("linestring",{action:["click","mousemove","dblclick"],create:function(t){return new Zn(t)},update:function(t,e){e.setCoordinates(t)},generate:function(t){return t}}),Tr.registerMode("freeHandLinestring",{action:["mousedown","mousemove","mouseup"],create:function(t){return new Zn(t)},update:function(t,e){var i=e.getCoordinates();e.setCoordinates(i.concat(t))},generate:function(t){return t}}),Tr.registerMode("arccurve",{action:["click","mousemove","dblclick"],create:function(t){return new sr(t)},update:function(t,e){e.setCoordinates(t)},generate:function(t){return t}}),Tr.registerMode("quadbeziercurve",{action:["click","mousemove","dblclick"],create:function(t){return new hr(t)},update:function(t,e){e.setCoordinates(t)},generate:function(t){return t}}),Tr.registerMode("cubicbeziercurve",{action:["click","mousemove","dblclick"],create:function(t){return new lr(t)},update:function(t,e){e.setCoordinates(t)},generate:function(t){return t}}),Tr.registerMode("boxZoom",{action:["mousedown","mousemove","mouseup"],create:function(t){var e=new Wn(t[0]);return e._firstClick=t[0],e},update:function(t,e,i){var n=e.getMap(),r=n.coordToContainerPoint(e._firstClick),o=i.containerPoint,a=n.containerPointToCoordinate(new yi(Math.min(r.x,o.x),Math.min(r.y,o.y)));e.setCoordinates(a).updateSymbol({markerWidth:Math.abs(r.x-o.x),markerHeight:Math.abs(r.y-o.y)})},generate:function(t){return t}});$i.loadArcgis=function(t,n){var e=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{jsonp:!0};if(S(t)&&"{"!==t.substring(0,1))ei.getJSON(t,function(t,e){if(t)n(t);else{var i=oo(e);n(null,i)}},e);else{S(t)&&(t=R(t));var i=oo(t);n(null,i)}return this};var ao=function(e){function i(t){return u(this,i),v(this,e.call(this,t))}return m(i,e),i.prototype.addTo=function(t){return this._owner=t,this._switchEvents("on"),this.onAdd&&this.onAdd(),this.fire("add"),this},i.prototype.getMap=function(){return this._owner?this._owner.getBaseLayer?this._owner:this._owner.getMap():null},i.prototype.show=function(t){var e=this.getMap();if(!e)return this;this._mapEventsOn||this._switchMapEvents("on"),t=t||this._coordinate||this._owner.getCenter();var i=this.isVisible();this.fire("showstart");var n=this._getUIContainer();this._coordinate=t,this._removePrevDOM();var r=this.__uiDOM=this.buildOn(e);if(r.eventsPropagation=this.options.eventsPropagation,!r)return this.fire("showend"),this;this._measureSize(r),this._singleton()&&(e[this._uiDomKey()]=r),this._setPosition(),r.style[Pe]=null,n.appendChild(r);var o=this._getAnimation();if(i&&(o.ok=!1),o.ok&&(o.fade&&(r.style.opacity=0),o.scale)){if(this.getTransformOrigin){var a=this.getTransformOrigin();r.style[Ee]=a}r.style[Ae]=so(this._pos)+" scale(0)"}r.style.display="",this.options.eventsToStop&&Qe(r,this.options.eventsToStop,Be),this.options.autoPan&&this._autoPan();var s=o.transition;return o.ok&&s&&(r.offsetHeight,s&&(r.style[Pe]=s),o.fade&&(r.style.opacity=1),o.scale&&(r.style[Ae]=so(this._pos)+" scale(1)")),this.fire("showend"),this},i.prototype.hide=function(){if(!this.getDOM()||!this.getMap())return this;var t=this._getAnimation(),e=this.getDOM();return this.options.animationOnHide||(t.ok=!1),t.ok?(e.offsetHeight,e.style[Pe]=t.transition,setTimeout(function(){e.style.display="none"},this.options.animationDuration)):e.style.display="none",t.fade&&(e.style.opacity=0),t.scale&&(e.style[Ae]=so(this._pos)+" scale(0)"),this.fire("hide"),this},i.prototype.isVisible=function(){var t=this.getDOM();return this.getMap()&&t&&t.parentNode&&"none"!==t.style.display},i.prototype.remove=function(){return delete this._mapEventsOn,this._owner&&(this.hide(),this._switchEvents("off"),this.onRemove&&this.onRemove(),!this._singleton()&&this.__uiDOM&&this._removePrevDOM(),delete this._owner,this.fire("remove")),this},i.prototype.getSize=function(){return this._size?this._size.copy():null},i.prototype.getOwner=function(){return this._owner},i.prototype.getDOM=function(){return this.__uiDOM},i.prototype.getPosition=function(){if(!this.getMap())return null;var t=this._getViewPoint()._round();if(this.getOffset){var e=this.getOffset()._round();e&&t._add(e)}return t},i.prototype._getAnimation=function(){for(var t={fade:!1,scale:!1},e=this.options.animation?this.options.animation.split(","):[],i=0;i<e.length;i++){var n=ce(e[i]);"fade"===n?t.fade=!0:"scale"===n&&(t.scale=!0)}var r=null;return t.fade&&(r="opacity "+this.options.animationDuration+"ms"),t.scale&&(r=r?r+",":"",r+=Ae+" "+this.options.animationDuration+"ms"),t.transition=r,t.ok=null!==r,t},i.prototype._getViewPoint=function(){return this.getMap().coordToViewPoint(this._coordinate)._add(this.options.dx,this.options.dy)},i.prototype._autoPan=function(){var t=this.getMap(),e=this.getDOM();if(!t.isMoving()){var i=this._pos,n=t.getSize(),r=n.width,o=n.height,a=t.viewPointToContainerPoint(i),s=parseInt(e.clientWidth),l=parseInt(e.clientHeight),h=0,c=0;a.x<0?h=-(a.x-s/2):a.x+s-35>r&&(h=r-(a.x+3*s/2)),a.y<0?c=50-a.y:a.y>o&&(c=o-a.y-l-30),0===c&&0===h||t.panBy(new le(h,c),{duration:this.options.autoPanDuration})}},i.prototype._measureSize=function(t){var e=this._getUIContainer();t.style.position="absolute",t.style.left="-99999px";var i=t.style.bottom?"bottom":"top";return t.style[i]="-99999px",t.style.display="",e.appendChild(t),this._size=new he(t.clientWidth,t.clientHeight),t.style.display="none",t.style.left="0px",t.style[i]="0px",this._size},i.prototype._removePrevDOM=function(){this.onDomRemove&&this.onDomRemove();var t=this.options.eventsToStop;if(this._singleton()){var e=this.getMap(),i=this._uiDomKey();e[i]&&(t&&$e(e[i],t,Be),De(e[i]),delete e[i]),delete this.__uiDOM}else this.__uiDOM&&(t&&$e(this.__uiDOM,t,Be),De(this.__uiDOM),delete this.__uiDOM)},i.prototype._uiDomKey=function(){return"__ui_"+this._getClassName()},i.prototype._singleton=function(){return this.options.single},i.prototype._getUIContainer=function(){return this.getMap()._panels.ui},i.prototype._getClassName=function(){return"UIComponent"},i.prototype._switchMapEvents=function(t){var e=this.getMap();if(e){this._mapEventsOn="on"===t;var i=this._getDefaultEvents();if(this.getEvents&&_(i,this.getEvents()),i)for(var n in i)i.hasOwnProperty(n)&&e[t](n,i[n],this)}},i.prototype._switchEvents=function(t){this._switchMapEvents(t);var e=this._getOwnerEvents();if(this._owner)for(var i in e)e.hasOwnProperty(i)&&this._owner[t](i,e[i],this)},i.prototype._getDefaultEvents=function(){return{"zooming rotate pitch":this.onEvent,zoomend:this.onZoomEnd,moving:this.onMoving}},i.prototype._getOwnerEvents=function(){var t={};return this._owner&&this._owner instanceof Pn&&(t.positionchange=this.onGeometryPositionChange),this.getOwnerEvents&&_(t,this.getOwnerEvents()),t},i.prototype.onGeometryPositionChange=function(t){this._owner&&this.isVisible()&&this.show(t.target.getCenter())},i.prototype.onMoving=function(){this.isVisible()&&this.getMap().isTransforming()&&this._updatePosition()},i.prototype.onEvent=function(){this.isVisible()&&this._updatePosition()},i.prototype.onZoomEnd=function(){this.isVisible()&&this._setPosition()},i.prototype._updatePosition=function(){this.getMap()._getRenderer().callInNextFrame(this._setPosition.bind(this))},i.prototype._setPosition=function(){var t=this.getDOM(),e=this.getPosition();this._pos=e;if(!t)return;t.style[Pe]=null,t.style[Ae]=so(e)+" scale(1)"},i}(li(ci));function so(t){return t?ae.any3d?"translate3d("+t.x+"px,"+t.y+"px, 0px)":"translate("+t.x+"px,"+t.y+"px)":""}ao.mergeOptions({eventsPropagation:!1,eventsToStop:null,dx:0,dy:0,autoPan:!1,autoPanDuration:600,single:!0,animation:"scale",animationOnHide:!0,animationDuration:500});var lo="mousedown mouseup mouseenter mouseover mouseout mousemove click dblclick contextmenu keypress touchstart touchmove touchend",ho=function(n){function r(t,e){u(this,r);var i=v(this,n.call(this,e));return i._markerCoord=new yi(t),i}return m(r,n),r.prototype._getClassName=function(){return"UIMarker"},r.prototype.setCoordinates=function(t){return this._markerCoord=t,this.fire("positionchange"),this.isVisible()&&this.show(),this},r.prototype.getCoordinates=function(){return this._markerCoord},r.prototype.setContent=function(t){var e=this.options.content;return this.options.content=t,this.fire("contentchange",{old:e,new:t}),this.isVisible()&&this.show(),this},r.prototype.getContent=function(){return this.options.content},r.prototype.onAdd=function(){this.show()},r.prototype.show=function(){return n.prototype.show.call(this,this._markerCoord)},r.prototype.flash=function(t,e,i,n){return it.call(this,t,e,i,n)},r.prototype.buildOn=function(){var t=void 0;return S(this.options.content)?(t=Ie("div")).innerHTML=this.options.content:t=this.options.content,this._registerDOMEvents(t),t},r.prototype.getOffset=function(){var t=this.getSize();return new le(-t.width/2,-t.height/2)},r.prototype.getTransformOrigin=function(){return"center center"},r.prototype.onDomRemove=function(){var t=this.getDOM();this._removeDOMEvents(t)},r.prototype.isDragging=function(){return!!this.draggable&&this.draggable.isDragging()},r.prototype._registerDOMEvents=function(t){Qe(t,lo,this._onDomEvents,this)},r.prototype._onDomEvents=function(t){var e=this.getMap()._parseEvent(t,t.type);this.fire(t.type,e)},r.prototype._removeDOMEvents=function(t){$e(t,lo,this._onDomEvents,this)},r.prototype._getConnectPoints=function(){var t=this.getMap(),e=t.coordToContainerPoint(this.getCoordinates()),i=this.getSize(),n=i.width,r=i.height;return[t.containerPointToCoordinate(e.add(-n/2,0)),t.containerPointToCoordinate(e.add(n/2,0)),t.containerPointToCoordinate(e.add(0,r/2)),t.containerPointToCoordinate(e.add(0,-r/2))]},r}(pi(ao));ho.mergeOptions({eventsPropagation:!0,draggable:!1,single:!1,content:null});var co=ae.touch?"touchstart mousedown":"mousedown",uo=function(e){function i(t){return u(this,i),v(this,e.call(this,t))}return m(i,e),i.prototype.addHooks=function(){this.target.on(co,this._startDrag,this)},i.prototype.removeHooks=function(){this.target.off(co,this._startDrag,this)},i.prototype._startDrag=function(t){var e=t.domEvent;e.touches&&1<e.touches.length||2===e.button||this.isDragging()||(this.target.on("click",this._endDrag,this),this._lastCoord=t.coordinate,this._lastPoint=t.containerPoint,this._prepareDragHandler(),this._dragHandler.onMouseDown(t.domEvent),this.target.fire("dragstart",t))},i.prototype._prepareDragHandler=function(){this._dragHandler=new vi(this.target.getDOM(),{cancelOn:this._cancelOn.bind(this),ignoreMouseleave:!0}),this._dragHandler.on("mousedown",this._onMouseDown,this),this._dragHandler.on("dragging",this._dragging,this),this._dragHandler.on("mouseup",this._endDrag,this),this._dragHandler.enable()},i.prototype._cancelOn=function(t){var e=(t.srcElement||t.target).tagName.toLowerCase();return"button"===e||"input"===e||"select"===e||"option"===e||"textarea"===e},i.prototype._onMouseDown=function(t){Be(t.domEvent)},i.prototype._dragging=function(t){var e=this.target,i=e.getMap()._parseEvent(t.domEvent),n=i.domEvent;if(!(n.touches&&1<n.touches.length))if(this._isDragging){var r=i.coordinate,o=i.containerPoint;this._lastCoord||(this._lastCoord=r),this._lastPoint||(this._lastPoint=o);var a=r.sub(this._lastCoord),s=o.sub(this._lastPoint);this._lastCoord=r,this._lastPoint=o,this.target.setCoordinates(this.target.getCoordinates().add(a)),i.coordOffset=a,i.pointOffset=s,e.fire("dragging",i)}else this._isDragging=!0},i.prototype._endDrag=function(t){var e=this.target,i=e.getMap();if(this._dragHandler&&(e.off("click",this._endDrag,this),this._dragHandler.disable(),delete this._dragHandler),delete this._lastCoord,delete this._lastPoint,this._isDragging=!1,i){var n=i._parseEvent(t.domEvent);e.fire("dragend",n)}},i.prototype.isDragging=function(){return!!this._isDragging},i}(hi);ho.addInitHook("addHandler","draggable",uo);var po=function(e){function t(){return u(this,t),v(this,e.apply(this,arguments))}return m(t,e),t.prototype._getClassName=function(){return"InfoWindow"},t.prototype.addTo=function(t){return t instanceof Pn&&(t.getInfoWindow()&&t.getInfoWindow()!==this&&t.removeInfoWindow(),t._infoWindow=this),e.prototype.addTo.call(this,t)},t.prototype.setContent=function(t){var e=this.options.content;return this.options.content=t,this.fire("contentchange",{old:e,new:t}),this.isVisible()&&this.show(this._coordinate),this},t.prototype.getContent=function(){return this.options.content},t.prototype.setTitle=function(t){var e=t;return this.options.title=t,this.fire("contentchange",{old:e,new:t}),this.isVisible()&&this.show(this._coordinate),this},t.prototype.getTitle=function(){return this.options.title},t.prototype.buildOn=function(){if(this.options.custom){if(S(this.options.content)){var t=Ie("div");return t.innerHTML=this.options.content,t}return this.options.content}var e=Ie("div");e.className="mapcan-msgBox",e.style.width=this._getWindowWidth()+"px",e.style.bottom="0px";var i='<em class="mapcan-ico"></em>';this.options.title&&(i+="<h2>"+this.options.title+"</h2>");var n="\"this.parentNode.style.display='none';return false;\"";return i+='<a href="javascript:void(0);" onclick='+n+" ontouchend="+n+' class="mapcan-close"></a><div class="mapcan-msgContent">'+this.options.content+"</div>",e.innerHTML=i,e},t.prototype.getTransformOrigin=function(){return this.getSize().width/2+"px bottom"},t.prototype.getOffset=function(){var t=this.getSize(),e=new le(-t.width/2,0);if(this.options.custom||e._sub(4,12),this.getOwner()instanceof Wn){var i=this.getOwner().getSize();i&&e._add(0,-i.height)}return e},t.prototype.show=function(t){return this.getMap()&&this.getMap().options.enableInfoWindow?e.prototype.show.call(this,t):this},t.prototype.getEvents=function(){if(!this.options.autoCloseOn)return null;var t={};return t[this.options.autoCloseOn]=this.hide,t},t.prototype.getOwnerEvents=function(){var t=this.getOwner();if(!this.options.autoOpenOn||!t)return null;var e={};return e[this.options.autoOpenOn]=this._onAutoOpen,e},t.prototype._onAutoOpen=function(t){var e=this,i=this.getOwner();setTimeout(function(){i instanceof Wn?e.show(i.getCoordinates()):e.show(t.coordinate)},1)},t.prototype._getWindowWidth=function(){var t=this.options.width;return t||(t=300),t},t}(ao);po.mergeOptions({autoPan:!0,autoCloseOn:null,autoOpenOn:"click",width:300,minHeight:120,custom:!1,title:null,content:null});var fo={width:0,height:0,animation:"fade",cssName:"mapcan-tooltip"},go=function(n){function r(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};u(this,r);var i=v(this,n.call(this,e));return i._content=t,i}return m(r,n),r.prototype._getClassName=function(){return"ToolTip"},r.prototype.addTo=function(t){if(t instanceof Pn)return t.on("mouseover",this.onMouseOver,this),t.on("mouseout",this.onMouseOut,this),n.prototype.addTo.call(this,t);throw new Error("Invalid geometry the tooltip is added to.")},r.prototype.setStyle=function(t){return this.options.cssName=t,this},r.prototype.getStyle=function(){return this.options.cssName},r.prototype.getContent=function(){return this._content},r.prototype.buildOn=function(){var t=Ie("div");fo.height&&(t.style.height=fo.height+"px"),fo.width&&(t.style.width=fo.width+"px");var e=this.options.cssName;return!e&&fo.height&&(t.style.lineHeight=fo.height+"px"),t.innerHTML='<div class="'+e+'">'+this._content+"</div>",t},r.prototype.onMouseOver=function(t){if(!this.isVisible()){var e=this.getMap();this.show(e.locateByPoint(t.coordinate,-5,25))}},r.prototype.onMouseOut=function(){this.isVisible()&&this._removePrevDOM()},r.prototype.onRemove=function(){this._owner&&(this._owner.off("mouseover",this.onMouseOver,this),this._owner.off("mouseout",this.onMouseOut,this))},r}(ao);go.mergeOptions(fo);var mo=function(e){function i(t){return u(this,i),v(this,e.call(this,t))}return m(i,e),i.prototype._getClassName=function(){return"Menu"},i.prototype.addTo=function(t){return t._menu&&t._menu!==this&&t.removeMenu(),t._menu=this,ao.prototype.addTo.apply(this,arguments)},i.prototype.setItems=function(t){return this.options.items=t,this},i.prototype.getItems=function(){return this.options.items||[]},i.prototype.buildOn=function(){if(this.options.custom){if(S(this.options.items)){var t=Ie("div");return t.innerHTML=this.options.items,t}return this.options.items}var e=Ie("div");je(e,"mapcan-menu"),e.style.width=this._getMenuWidth()+"px";var i=this._createMenuItemDom();return e.appendChild(i),Qe(e,"contextmenu",Ne),e},i.prototype.getOffset=function(){if(!this.getMap())return null;var t=this.getMap().getSize(),e=this.getMap().viewPointToContainerPoint(this._getViewPoint()),i=this.getSize(),n=0,r=0;return e.x+i.width>t.width&&(n=-i.width),e.y+i.height>t.height&&(r=-i.height),new le(n,r)},i.prototype.getTransformOrigin=function(){var t=this.getOffset()._multi(-1);return t.x+"px "+t.y+"px"},i.prototype.getEvents=function(){return{"_zoomstart _zoomend _movestart _dblclick _click":this._removePrevDOM}},i.prototype._createMenuItemDom=function(){var n=this,r=this.getMap(),t=Ie("ul");je(t,"mapcan-menu-items");var e=this.getItems();function i(i){return function(t){var e=r._parseEvent(t,"click");e.target=n,e.owner=n._owner,e.index=i,!1!==this._callback(e)&&n.hide()}}for(var o=void 0,a=void 0,s=0,l=e.length;s<l;s++){if("-"===(o=e[s])||"_"===o)je(a=Ie("li"),"mapcan-menu-splitter");else{a=Ie("li");var h=o.item;b(h)&&(h=h({owner:this._owner,index:s})),a.innerHTML=h,a._callback=o.click,Qe(a,"click",i(s))}t.appendChild(a)}var c=this.options.maxHeight||0;return 0<c&&Ue(t,"max-height: "+c+"px; overflow-y: auto;"),t},i.prototype._getMenuWidth=function(){return this.options.width||160},i}(ao);mo.mergeOptions({animation:null,animationDelay:10,animationOnHide:!1,autoPan:!1,width:160,maxHeight:0,custom:!1,items:[]});var vo={setMenu:function(t){return this._menuOptions=t,this._menu?this._menu.setOptions(t):this.on("contextmenu",this._defaultOpenMenu,this),this},openMenu:function(t){var e=this instanceof en?this:this.getMap();return t||(t=this.getCenter()),this._menu?this._menu.show(t):this._menuOptions&&e&&(this._bindMenu(this._menuOptions),this._menu.show(t)),this},setMenuItems:function(t){return this._menuOptions||(this._menuOptions={}),Array.isArray(t)&&(this._menuOptions.custom=!1),this._menuOptions.items=t,this.setMenu(this._menuOptions),this},getMenuItems:function(){return this._menu?this._menu.getItems():this._menuOptions&&this._menuOptions.items||[]},closeMenu:function(){return this._menu&&this._menu.hide(),this},removeMenu:function(){return this.off("contextmenu",this._defaultOpenMenu,this),this._unbindMenu(),delete this._menuOptions,this},_bindMenu:function(t){return this._menu=new mo(t),this._menu.addTo(this),this},_unbindMenu:function(){return this._menu&&(this.closeMenu(),this._menu.remove(),delete this._menu),this},_defaultOpenMenu:function(t){return 1<this.listens("contextmenu")||(this.openMenu(t.coordinate),!1)}};en.include(vo),Pn.include(vo);var yo=Object.freeze({UIComponent:ao,UIMarker:ho,InfoWindow:po,ToolTip:go,Menuable:vo,Menu:mo}),_o=function(e){function i(t){return u(this,i),t&&t.position&&!S(t.position)&&(t.position=_({},t.position)),v(this,e.call(this,t))}return m(i,e),i.prototype.addTo=function(t){if(this.remove(),!t.options.control)return this;var e=(this._map=t)._panels.control;return this.__ctrlContainer=Ie("div"),Ue(this.__ctrlContainer,"position:absolute;overflow:visible;"),this.update(),e.appendChild(this.__ctrlContainer),this.onAdd&&this.onAdd(),this.fire("add",{dom:e}),this},i.prototype.update=function(){return this.__ctrlContainer.innerHTML="",this._controlDom=this.buildOn(this.getMap()),this._controlDom&&(this._updatePosition(),this.__ctrlContainer.appendChild(this._controlDom)),this},i.prototype.getMap=function(){return this._map},i.prototype.getPosition=function(){return _({},this._parse(this.options.position))},i.prototype.setPosition=function(t){return S(t)?this.options.position=t:this.options.position=_({},t),this._updatePosition(),this},i.prototype.getContainerPoint=function(){var t=this.getPosition(),e=this.getMap().getSize(),i=void 0,n=void 0;return Y(t.left)?Y(t.right)||(i=e.width-parseInt(t.right)):i=parseInt(t.left),Y(t.top)?Y(t.bottom)||(n=e.height-parseInt(t.bottom)):n=parseInt(t.top),new le(i,n)},i.prototype.getContainer=function(){return this.__ctrlContainer},i.prototype.getDOM=function(){return this._controlDom},i.prototype.show=function(){return this.__ctrlContainer.style.display="",this},i.prototype.hide=function(){return this.__ctrlContainer.style.display="none",this},i.prototype.isVisible=function(){return this.__ctrlContainer&&""===this.__ctrlContainer.style.display},i.prototype.remove=function(){return this._map&&(De(this.__ctrlContainer),this.onRemove&&this.onRemove(),delete this._map,delete this.__ctrlContainer,delete this._controlDom,this.fire("remove")),this},i.prototype._parse=function(t){var e=t;return S(t)&&(e=i.positions[e]),e},i.prototype._updatePosition=function(){var t=this.getPosition();for(var e in t||(t={top:20,left:20}),t)t.hasOwnProperty(e)&&(t[e]=parseInt(t[e]),this.__ctrlContainer.style[e]=t[e]+"px");this.fire("positionchange",{position:_({},t)})},i}(li(ci));_o.positions={"top-left":{top:20,left:20},"top-right":{top:20,right:20},"bottom-left":{bottom:20,left:20},"bottom-right":{bottom:20,right:20}},en.mergeOptions({control:!0}),en.include({addControl:function(t){return this._containerDOM.getContext||t.addTo(this),this},removeControl:function(t){return t&&t.getMap()===this&&t.remove(),this}});var xo="addlayer removelayer setbaselayer baselayerremove",wo=function(t){function e(){return u(this,e),v(this,t.apply(this,arguments))}return m(e,t),e.prototype.buildOn=function(){return this._attributionContainer=Ie("div"),this._attributionContainer.className="mapcan-attribution",this._update(),this._attributionContainer},e.prototype.onAdd=function(){this.getMap().on(xo,this._update,this)},e.prototype.onRemove=function(){this.getMap().off(xo,this._update,this)},e.prototype._update=function(){var t=this.getMap();if(t){var e=t._getLayers(function(t){return t.options.attribution}).reverse().map(function(t){return t.options.attribution}),i=this.options.content+(0<e.length?" - "+e.join(", "):"");this._attributionContainer.innerHTML='<span style="padding:0px 4px">'+i+"</span>"}},e}(_o);wo.mergeOptions({position:{bottom:0,left:0},content:'<a href="http://mapcan.com.cn" target="_blank">mapcan</a>'}),en.mergeOptions({attribution:!0}),en.addOnLoadHook(function(){var t=this.options.attribution||this.options.attributionControl;t&&(this.attributionControl=new wo(t),this.addControl(this.attributionControl))});var bo=function(t){function e(){return u(this,e),v(this,t.apply(this,arguments))}return m(e,t),e.prototype.buildOn=function(){var t=this.container=Ie("div",this.options.containerClass),e=this.panel=Ie("div","panel"),i=this.button=Ie("button");return t.appendChild(i),t.appendChild(e),t},e.prototype.onAdd=function(){Qe(this.button,"mouseover",this._show,this),Qe(this.panel,"mouseleave",this._hide,this),Qe(this.getMap(),"click",this._hide,this)},e.prototype.onRemove=function(){this.panel&&($e(this.button,"mouseover",this._show,this),$e(this.panel,"mouseleave",this._hide,this),$e(this.getMap(),"click",this._hide,this),De(this.panel),De(this.button),delete this.panel,delete this.button,delete this.container)},e.prototype._show=function(){We(this.container,"shown")||(je(this.container,"shown"),this._createPanel())},e.prototype._hide=function(t){this.panel.contains(t.toElement||t.relatedTarget)||Ze(this.container,this.options.containerClass)},e.prototype._createPanel=function(){this.panel.innerHTML="";var t=Ie("ul");this.panel.appendChild(t),this._renderLayers(this.getMap(),t)},e.prototype._renderLayers=function(t,e){var i=t.getBaseLayer(),n=t.getLayers(),r=n.length;if(i){var o=i.layers||[i],a=Ie("li","group"),s=Ie("ul"),l=Ie("label");l.innerHTML=this.options.baseTitle,a.appendChild(l);for(var h=0,c=o.length;h<c;h++){var u=o[h];this._isExcluded(u)&&(s.appendChild(this._renderLayer(o[h],!0)),a.appendChild(s),e.appendChild(a))}}if(r){var d=Ie("li","group"),p=Ie("ul"),f=Ie("label");f.innerHTML=this.options.overlayTitle,d.appendChild(f);for(var g=0;g<r;g++){var m=n[g];this._isExcluded(m)&&p.appendChild(this._renderLayer(m))}d.appendChild(p),e.appendChild(d)}},e.prototype._isExcluded=function(t){var e=t.getId(),i=this.options.excludeLayers;return!(i.length&&0<=i.indexOf(e))},e.prototype._renderLayer=function(a,t){var s=this,e=Ie("li","layer"),i=Ie("label"),n=Ie("input"),l=this.getMap(),r=a.options.visible;a.options.visible=!0;var o=a.isVisible();return a.options.visible=r,e.className="layer",t?(n.type="radio",n.name="base"):n.type="checkbox",n.checked=r&&o,o||n.setAttribute("disabled","disabled"),n.onchange=function(t){if("radio"===t.target.type){var e=l.getBaseLayer(),i=e.layers;if(i)for(var n=0,r=i.length;n<r;n++){var o=i[n];o[o===a?"show":"hide"]()}else e.isVisible()||e.show();l._fireEvent("setbaselayer")}else a[t.target.checked?"show":"hide"]();s.fire("layerchange",{target:a})},e.appendChild(n),i.innerHTML=a.getId(),e.appendChild(i),e},e}(_o);bo.mergeOptions({position:"top-right",baseTitle:"Base Layers",overlayTitle:"Layers",excludeLayers:[],containerClass:"mapcan-layer-switcher"}),en.mergeOptions({layerSwitcherControl:!1}),en.addOnLoadHook(function(){this.options.layerSwitcherControl&&(this.layerSwitcherControl=new bo(this.options.layerSwitcherControl),this.addControl(this.layerSwitcherControl))});var Mo=function(t){function e(){return u(this,e),v(this,t.apply(this,arguments))}return m(e,t),e.prototype.buildOn=function(){var t=this.options.size;this.options.maximize||(t=[0,0]);var e=Ie("div"),i=this.mapContainer=Ie("div");i.style.width=t[0]+"px",i.style.height=t[1]+"px",i.className=this.options.containerClass;var n=this.button=Ie("div");return n.className=this.options.buttonClass,e.appendChild(i),e.appendChild(n),e},e.prototype.onAdd=function(){this.options.maximize&&this._createOverview(),this.getMap().on("resize moving dragrotating viewchange",this._update,this).on("setbaselayer",this._updateBaseLayer,this).on("spatialreferencechange",this._updateSpatialReference,this),Qe(this.button,"click",this._onButtonClick,this),this._updateButtonText()},e.prototype.onRemove=function(){this.getMap().off("resize moving dragrotating viewchange",this._update,this).off("setbaselayer",this._updateBaseLayer,this).off("spatialreferencechange",this._updateSpatialReference,this),this._overview&&(this._overview.remove(),delete this._overview,delete this._perspective),$e(this.button,"click",this._onButtonClick,this)},e.prototype.maxmize=function(){var t=this.options.size,e=this.mapContainer;e.style.width=t[0]+"px",e.style.height=t[1]+"px",this._createOverview()},e.prototype.minimize=function(){this._overview&&this._overview.remove(),delete this._overview,delete this._perspective;var t=this.mapContainer;t.style.width="0px",t.style.height="0px"},e.prototype._onButtonClick=function(){this._overview?this.minimize():this.maxmize(),this._updateButtonText()},e.prototype._updateButtonText=function(){this._overview?this.button.innerHTML="-":this.button.innerHTML="+"},e.prototype._createOverview=function(){var t=this.getMap(),e=this.mapContainer,i=t.config();_(i,{center:t.getCenter(),zoom:this._getOverviewZoom(),zoomAnimationDuration:150,pitch:0,bearing:0,scrollWheelZoom:!1,checkSize:!1,doubleClickZoom:!1,touchZoom:!1,control:!1,draggable:!1,maxExtent:null}),this._overview=new en(e,i),this._updateBaseLayer(),this._perspective=new Hn(this._getPerspectiveCoords(),{draggable:!0,cursor:"move",symbol:this.options.symbol}).on("dragend",this._onDragEnd,this),new wr("perspective_layer",this._perspective).addTo(this._overview),this.fire("load")},e.prototype._getOverviewZoom=function(){var t=this.getMap(),e=t.getZoom(),i=t.getMinZoom(),n=this.options.level;if(0<n){for(var r=n;0<r;r--)if(i<=e-r)return e-r}else for(var o=n;o<0;o++)if(i<=e-o)return e-o;return e},e.prototype._onDragEnd=function(){var t=this._perspective.getCenter();this._overview.setCenter(t),this.getMap().panTo(t)},e.prototype._getPerspectiveCoords=function(){var e=this.getMap();return e.getContainerExtent().toArray().map(function(t){return e.containerPointToCoordinate(t)})},e.prototype._update=function(){if(this._overview){var t=this._getPerspectiveCoords();this._perspective.setCoordinates(t),this._overview.setCenterAndZoom(this.getMap().getCenter(),this._getOverviewZoom())}},e.prototype._updateSpatialReference=function(){if(this._overview){var t=this.getMap().options.spatialReference;this._overview.setSpatialReference(t)}},e.prototype._updateBaseLayer=function(){if(this._overview){var t=this.getMap().getBaseLayer();if(t){var e=t.layers,i=0;if(e)for(var n=0,r=e.length;n<r;n++){if(e[n].isVisible()){i=n;break}}var o=t.toJSON(),a=null;e?(a=o.layers[i].options).visible=!0:a=o.options,this._overview.setMinZoom(a.minZoom||null).setMaxZoom(a.maxZoom||null),delete a.minZoom,delete a.maxZoom,delete o.options.canvas,o.options.visible=!0,o.options.renderer="canvas";var s=Ji.fromJSON(o);for(var l in t)b(t[l])&&t.hasOwnProperty(l)&&t[l]!==t.constructor.prototype[l]&&(s[l]=t[l]);this._overview.setBaseLayer(s)}else this._overview.setBaseLayer(null)}},e}(_o);Mo.mergeOptions({level:4,position:{right:1,bottom:1},size:[300,200],maximize:!0,symbol:{lineWidth:3,lineColor:"#1bbc9b",polygonFill:"#1bbc9b",polygonOpacity:.4},containerClass:"mapcan-overview",buttonClass:"mapcan-overview-button"}),en.mergeOptions({overviewControl:!1}),en.addOnLoadHook(function(){this.options.overviewControl&&(this.overviewControl=new Mo(this.options.overviewControl),this.addControl(this.overviewControl))});var So=function(t){function e(){return u(this,e),v(this,t.apply(this,arguments))}return m(e,t),e.prototype.buildOn=function(){var t=void 0;if(this.options.custom)S(this.options.content)?(t=Ie("div")).innerHTML=this.options.content:t=this.options.content;else{if(t=Ie("div","mapcan-panel"),this.options.closeButton){var e=Ie("a","mapcan-close");e.href="javascript:;",e.onclick=function(){t.style.display="none"},t.appendChild(e)}var i=Ie("div","mapcan-panel-content");i.innerHTML=this.options.content,t.appendChild(i)}return this.draggable=new vi(t,{cancelOn:this._cancelOn.bind(this),ignoreMouseleave:!0}),this.draggable.on("dragstart",this._onDragStart,this).on("dragging",this._onDragging,this).on("dragend",this._onDragEnd,this),this.options.draggable&&this.draggable.enable(),t},e.prototype.update=function(){return this.draggable&&(this.draggable.disable(),delete this.draggable),_o.prototype.update.call(this)},e.prototype.setContent=function(t){var e=this.options.content;return this.options.content=t,this.fire("contentchange",{old:e,new:t}),this.isVisible()&&this.update(),this},e.prototype.getContent=function(){return this.options.content},e.prototype._cancelOn=function(t){var e=(t.srcElement||t.target).tagName.toLowerCase();return"button"===e||"input"===e||"select"===e||"option"===e||"textarea"===e},e.prototype._onDragStart=function(t){this._startPos=t.mousePos,this._startPosition=_({},this.getPosition()),this.fire("dragstart",t)},e.prototype._onDragging=function(t){var e=t.mousePos.sub(this._startPos),i=this._startPosition,n=this.getPosition();Y(n.top)||(n.top=parseInt(i.top)+e.y),Y(n.bottom)||(n.bottom=parseInt(i.bottom)-e.y),Y(n.left)||(n.left=parseInt(i.left)+e.x),Y(n.right)||(n.right=parseInt(i.right)-e.x),this.setPosition(n),this.fire("dragging",t)},e.prototype._onDragEnd=function(t){delete this._startPos,delete this._startPosition,this.fire("dragend",t)},e.prototype._getConnectPoints=function(){var t=this.getMap(),e=this.getContainerPoint(),i=this.getDOM(),n=parseInt(i.clientWidth),r=parseInt(i.clientHeight);return[t.containerPointToCoordinate(e.add(n/2,0)),t.containerPointToCoordinate(e.add(n,r/2)),t.containerPointToCoordinate(e.add(n/2,r)),t.containerPointToCoordinate(e.add(0,r/2))]},e}(_o);So.mergeOptions({position:"top-right",draggable:!0,custom:!1,content:"",closeButton:!0});var To=function(t){function e(){return u(this,e),v(this,t.apply(this,arguments))}return m(e,t),e.prototype.buildOn=function(t){return this._map=t,this._scaleContainer=Ie("div"),this._addScales(),t.on("zoomend",this._update,this),this._map._loaded&&this._update(),this._scaleContainer},e.prototype.onRemove=function(){this.getMap().off("zoomend",this._update,this)},e.prototype._addScales=function(){var t="border: 2px solid #000000;border-top: none;line-height: 1.1;padding: 2px 5px 1px;color: #000000;font-size: 11px;text-align:center;white-space: nowrap;overflow: hidden;-moz-box-sizing: content-box;box-sizing: content-box;background: #fff; background: rgba(255, 255, 255, 0);";this.options.metric&&(this._mScale=Re("div",t,this._scaleContainer)),this.options.imperial&&(this._iScale=Re("div",t,this._scaleContainer))},e.prototype._update=function(){var t=this._map.pixelToDistance(this.options.maxWidth,0);this._updateScales(t)},e.prototype._updateScales=function(t){this.options.metric&&t&&this._updateMetric(t),this.options.imperial&&t&&this._updateImperial(t)},e.prototype._updateMetric=function(t){var e=this._getRoundNum(t),i=e<1e3?e+" m":e/1e3+" km";this._updateScale(this._mScale,i,e/t)},e.prototype._updateImperial=function(t){var e=3.2808399*t,i=void 0,n=void 0,r=void 0;5280<e?(i=e/5280,n=this._getRoundNum(i),this._updateScale(this._iScale,n+" mile",n/i)):(r=this._getRoundNum(e),this._updateScale(this._iScale,r+" feet",r/e))},e.prototype._updateScale=function(t,e,i){t.style.width=Math.round(this.options.maxWidth*i)+"px",t.innerHTML=e},e.prototype._getRoundNum=function(t){var e=Math.pow(10,(Math.floor(t)+"").length-1),i=t/e;return e*(i=10<=i?10:5<=i?5:3<=i?3:2<=i?2:1)},e}(_o);To.mergeOptions({position:"bottom-left",maxWidth:100,metric:!0,imperial:!1}),en.mergeOptions({scaleControl:!1}),en.addOnLoadHook(function(){this.options.scaleControl&&(this.scaleControl=new To(this.options.scaleControl),this.addControl(this.scaleControl))});var Co=function(t){function e(){return u(this,e),v(this,t.apply(this,arguments))}return m(e,t),e.prototype.buildOn=function(t){this._map=t;var e=Ie("div"),i=Ie("ul","mapcan-toolbar-hx");e.appendChild(i),this.options.vertical?je(e,"mapcan-toolbar-vertical"):je(e,"mapcan-toolbar-horizonal");var a=this;function n(e,i,n,r){var o=a._getItems()[i];return function(t){return Be(t),e({target:o,index:i,childIndex:n,dom:r})}}var r=this.options.items;if(H(r))for(var o=0,s=r.length;o<s;o++){var l=r[o],h=Ie("li");if(28!==this.options.height&&(h.style.lineHeight=this.options.height+"px"),h.style.height=this.options.height+"px",h.style.cursor="pointer",Ye(l.item)){h.style.textAlign="center";var c=Je("div",l.item);h.innerHTML='<div style="margin-top:'+(this.options.height-c.height)/2+'px;">'+l.item+"</div>"}else h.innerHTML=l.item;if(l.click&&Qe(h,"click",n(l.click,o,null,h)),H(l.children)){var u=this._createDropMenu(o);h.appendChild(u),h._menu=u,Qe(h,"mouseover",function(){this._menu.style.display=""}),Qe(h,"mouseout",function(){this._menu.style.display="none"})}i.appendChild(h)}return e},e.prototype._createDropMenu=function(t){var o=this;function e(e,i,n){var r=o._getItems()[i].children[n];return function(t){return Be(t),e({target:r,index:i,childIndex:n})}}var i=Ie("div","mapcan-dropMenu"),n=this._getItems(),r=n.length,a=Ie("ul"),s=n[t].children;t===r-1&&s&&(i.style.cssText="right: 0px;",a.style.cssText="right: 0px;position: absolute;",this.options.reverseMenu&&(a.style.bottom=0)),i.appendChild(Ie("em","mapcan-ico"));for(var l=0,h=0,c=s.length;h<c;h++){var u=ve(s[h].item,"12px");u.width>l&&(l=u.width)}for(var d=0,p=s.length;d<p;d++){var f=s[d],g=Ie("li");g.innerHTML='<a href="javascript:;">'+f.item+"</a>",g.style.cursor="pointer",g.style.width=l+24+"px",Qe(g.childNodes[0],"click",e(f.click,t,d)),a.appendChild(g)}if(this.options.vertical){var m=l<95?95:l;this.options.reverseMenu?i.style.right=-(m+20)+"px":i.style.left=-(m+20)+"px"}else this.options.reverseMenu?i.style.bottom="28px":i.style.top="28px";return i.appendChild(a),i.style.display="none",i},e.prototype._getItems=function(){return this.options.items||[]},e}(_o);Co.mergeOptions({height:28,vertical:!1,position:"top-right",reverseMenu:!1,items:{}});var Ao=function(t){function e(){return u(this,e),v(this,t.apply(this,arguments))}return m(e,t),e.prototype.buildOn=function(t){var e=this.options,i=Ie("div","mapcan-zoom");if(e.zoomLevel){var n=Ie("span","mapcan-zoom-zoomlevel");i.appendChild(n),this._levelDOM=n}var r=Ie("div","mapcan-zoom-slider"),o=Ie("a","mapcan-zoom-zoomin");if(o.href="javascript:;",o.innerHTML="+",r.appendChild(o),this._zoomInButton=o,e.slider){var a=Ie("div","mapcan-zoom-slider-box"),s=Ie("div","mapcan-zoom-slider-ruler"),l=Ie("span","mapcan-zoom-slider-reading"),h=Ie("span","mapcan-zoom-slider-dot");s.appendChild(l),a.appendChild(s),a.appendChild(h),r.appendChild(a),this._sliderBox=a,this._sliderRuler=s,this._sliderReading=l,this._sliderDot=h}var c=Ie("a","mapcan-zoom-zoomout");return c.href="javascript:;",c.innerHTML="-",r.appendChild(c),this._zoomOutButton=c,i.appendChild(r),t.on("_zoomend _zoomstart _spatialreferencechange",this._update,this),this._update(),this._registerDomEvents(),i},e.prototype.onRemove=function(){this.getMap().off("_zoomend _zoomstart _spatialreferencechange",this._update,this),this._zoomInButton&&$e(this._zoomInButton,"click",this._onZoomInClick,this),this._zoomOutButton&&$e(this._zoomOutButton,"click",this._onZoomOutClick,this),this._sliderRuler&&($e(this._sliderRuler,"click",this._onClickRuler,this),this.dotDragger.disable(),delete this.dotDragger)},e.prototype._update=function(){var t=this.getMap();if(this._sliderBox){var e=10*(t.getMaxZoom()-t.getMinZoom());this._sliderBox.style.height=e+16+"px",this._sliderRuler.style.height=e+8+"px",this._sliderRuler.style.cursor="pointer";var i=10*(t.getMaxZoom()-t.getZoom());this._sliderReading.style.height=10*(t.getZoom()-t.getMinZoom()+1)+"px",this._sliderDot.style.top=i+"px"}this._updateText()},e.prototype._updateText=function(){if(this._levelDOM){var t=this.getMap().getZoom();r(t)||(t=t.toFixed(1)),this._levelDOM.innerHTML=t}},e.prototype._registerDomEvents=function(){this._zoomInButton&&Qe(this._zoomInButton,"click",this._onZoomInClick,this),this._zoomOutButton&&Qe(this._zoomOutButton,"click",this._onZoomOutClick,this),this._sliderRuler&&(Qe(this._sliderRuler,"click",this._onClickRuler,this),this.dotDragger=new vi(this._sliderDot,{ignoreMouseleave:!0}),this.dotDragger.on("dragstart",this._onDotDragstart,this).on("dragging dragend",this._onDotDrag,this).enable())},e.prototype._onZoomInClick=function(t){Ne(t),this.getMap().zoomIn()},e.prototype._onZoomOutClick=function(t){Ne(t),this.getMap().zoomOut()},e.prototype._onClickRuler=function(t){Ne(t);var e=this.getMap(),i=He(t,this._sliderRuler).y,n=e.getMaxZoom(),r=Math.floor(n-i/10);e.setZoom(r)},e.prototype._onDotDragstart=function(t){Ne(t.domEvent);var e=this.getMap(),i=e.getSize().toPoint()._multi(.5);e.onZoomStart(e.getZoom(),i)},e.prototype._onDotDrag=function(t){Ne(t.domEvent);var e=this.getMap(),i=e.getSize().toPoint()._multi(.5),n=He(t.domEvent,this._sliderRuler),r=e.getMaxZoom(),o=e.getMinZoom(),a=n.y,s=r-a/10;r<s?(s=r,a=0):s<o&&(a=10*(r-(s=o))),"dragging"===t.type?e.onZooming(s,i,1):"dragend"===t.type&&(this.options.seamless?e.onZoomEnd(s,i):e.onZoomEnd(Math.round(s),i)),this._sliderDot.style.top=a+"px",this._sliderReading.style.height=10*(e.getZoom()-o+1)+"px",this._updateText()},e}(_o);Ao.mergeOptions({position:"top-left",slider:!0,zoomLevel:!0,seamless:!1}),en.mergeOptions({zoomControl:!1}),en.addOnLoadHook(function(){this.options.zoomControl&&(this.zoomControl=new Ao(this.options.zoomControl),this.addControl(this.zoomControl))});var Eo=Object.freeze({Control:_o,Attribution:wo,LayerSwitcher:bo,Overview:Mo,Panel:So,Scale:To,Toolbar:Co,Zoom:Ao}),Po=function(){function r(t,e,i,n){u(this,r),Array.isArray(t)?(this.scale={x:t[0],y:t[1]},this.origin={x:t[2],y:t[3]}):(this.scale={x:t,y:e},this.origin={x:i,y:n})}return r.getDefault=function(t){return"baidu"===t.code.toLowerCase()?"baidu":t.code.toLowerCase()==="EPSG:4326".toLowerCase()?"tms-global-geodetic":"identity"===t.code.toLowerCase()?[1,-1,0,0]:"web-mercator"},r}(),Lo=6378137*Math.PI;_(Po,{"web-mercator":new Po([1,-1,-Lo,Lo]),"tms-global-mercator":new Po([1,1,-Lo,-Lo]),"tms-global-geodetic":new Po([1,1,-180,-90]),baidu:new Po([1,1,0,0])});var Io=function(){function n(t,e,i){u(this,n),this.tileSize=i,this.fullExtent=e,this.prepareTileInfo(t,e)}return n.prototype.prepareTileInfo=function(t,e){if(S(t)?t=Po[t.toLowerCase()]:Array.isArray(t)&&(t=new Po(t)),!t)throw new Error("Invalid TileSystem");this.tileSystem=t;var i=e.right>e.left?1:-1,n=e.top>e.bottom?-1:1,r=t.origin.x,o=t.origin.y;this.transformation=new Mi([i,n,r,o])},n.prototype._getTileNum=function(t,e){var i=this.tileSystem,n=this.tileSize,r=Math.floor(1e-7+t.x/(n.width*e)),o=-Math.floor(1e-7+t.y/(n.height*e));return{x:i.scale.x*r,y:i.scale.y*o}},n.prototype.getTileIndex=function(t,e){var i=this.tileSystem,n=this.transformation.transform(t,1),r=this._getTileNum(n,e);return i.scale.x<0&&(r.x-=1),0<i.scale.y&&(r.y-=1),this.getNeighorTileIndex(r.x,r.y,0,0,!0)},n.prototype.getNeighorTileIndex=function(t,e,i,n,r,o){var a=this.tileSystem,s=t+a.scale.x*i,l=e-a.scale.y*n,h=s,c=l;if(o){var u=this._getTileFullIndex(r);s<u.xmin?(s=u.xmax-(u.xmin-s)%(u.xmax-u.xmin))===u.xmax&&(s=u.xmin):s>=u.xmax&&(s=u.xmin+(s-u.xmin)%(u.xmax-u.xmin)),l>=u.ymax?l=u.ymin+(l-u.ymin)%(u.ymax-u.ymin):l<u.ymin&&(l=u.ymax-(u.ymin-l)%(u.ymax-u.ymin))===u.ymax&&(l=u.ymin)}return{x:s,y:l,idx:h,idy:c}},n.prototype._getTileFullIndex=function(t){var e=this.fullExtent,i=this.transformation,n=this._getTileNum(i.transform(new yi(e.left,e.top),1),t),r=this._getTileNum(i.transform(new yi(e.right,e.bottom),1),t);return new wi(n,r)},n.prototype.getTilePrjNW=function(t,e,i){var n=this.tileSystem,r=this.tileSize,o=n.origin.y+n.scale.y*(e+(1===n.scale.y?1:0))*(i*r.height),a=n.scale.x*(t+(1===n.scale.x?0:1))*i*r.width+n.origin.x;return new yi(a,o)},n.prototype.getTilePrjSE=function(t,e,i){var n=this.tileSystem,r=this.tileSize,o=n.origin.y+n.scale.y*(e+(1===n.scale.y?0:1))*(i*r.height),a=n.scale.x*(t+(1===n.scale.x?1:0))*i*r.width+n.origin.x;return new yi(a,o)},n.prototype.getTilePrjExtent=function(t,e,i){var n=this.getTilePrjNW(t,e,i),r=this.getTilePrjSE(t,e,i);return new wi(n,r)},n}(),Ro={urlTemplate:null,subdomains:null,repeatWorld:!0,background:!0,backgroundZoomDiff:6,loadingLimitOnInteracting:3,placeholder:!1,crossOrigin:null,tileSize:[256,256],offset:[0,0],tileSystem:null,fadeAnimation:!C,debug:!1,spatialReference:null,maxCacheSize:256,renderer:ae.webgl?"gl":"canvas",clipByPitch:!0,maxAvailableZoom:null,cascadeTiles:!0,minPitchToCascade:35},Do=/\{ *([\w_]+) *\}/g,Oo=function(i){function e(){return u(this,e),v(this,i.apply(this,arguments))}return m(e,i),e.fromJSON=function(t){return t&&"TileLayer"===t.type?new e(t.id,t.options):null},e.prototype.getTileSize=function(){return new he(this.options.tileSize)},e.prototype.getTiles=function(t){var e=this.getMap(),i=e.getContainerExtent(),n=[],r=0,o=this.getMinZoom(),a=this.options.minPitchToCascade,s=Y(t)?this._getTileZoom(e.getZoom()):t;if(!Y(t)||!this.options.cascadeTiles||e.getPitch()<=a||!Y(o)&&s<=o){var l=this._getTiles(s,i);return r+=l?l.tiles.length:0,n.push(l),{tileGrids:n,count:r}}var h=Math.floor(e._getVisualHeight(a)),c=new bi(0,e.height-h,e.width,e.height),u=this._getTiles(s,c,0);r+=u?u.tiles.length:0;var d=new bi(0,i.ymin,e.width,c.ymin),p=e.getSpatialReference().getZoomDirection(),f=this._getTiles(s-p,d,1);return r+=f?f.tiles.length:0,n.push(u,f),{tileGrids:n,count:r}},e.prototype.getTileUrl=function(t,e,i){var n=this.options.urlTemplate,r="";if(this.options.subdomains){var o=this.options.subdomains;if(H(o)){var a=(t+e)%o.length;a<0&&(a=0),r=o[a]}}if(b(n))return n(t,e,i,r);var s={x:t,y:e,z:i,s:r};return n.replace(Do,function(t,e){var i=s[e];if(void 0===i)throw new Error("No value provided for variable "+t);return"function"==typeof i&&(i=i(s)),i})},e.prototype.clear=function(){return this._renderer&&this._renderer.clear(),this.fire("clear"),this},e.prototype.toJSON=function(){return{type:this.getJSONType(),id:this.getId(),options:this.config()}},e.prototype.getSpatialReference=function(){var t=this.getMap();return!t||this.options.spatialReference&&!$i.equals(this.options.spatialReference,t.options.spatialReference)?(this._sr=this._sr||new $i(this.options.spatialReference),this._sr):t.getSpatialReference()},e.prototype._getTileZoom=function(t){var e=this.getMap();r(t)||(t=e.isZooming()?t>e._frameZoom?Math.floor(t):Math.ceil(t):Math.round(t));var i=this.options.maxAvailableZoom;return!Y(i)&&i<t&&(t=i),t},e.prototype._getTiles=function(t,e,i){var n=this.getMap();if(!(n&&this.isVisible()&&n.width&&n.height))return null;var r=this.getMinZoom(),o=this.getMaxZoom();if(!Y(r)&&t<r||!Y(o)&&o<t)return null;var a=this._getTileConfig();if(!a)return null;var s=t,l=this.getSpatialReference(),h=n.getSpatialReference(),c=l.getResolution(s),u={zoom:s,extent:null,tiles:[]},d=this._getTileOffset(s),p=d[0]||d[1],f=e.convertTo(function(t){return n._containerPointToPoint(t)})._add(d),g=this._getInnerExtent(s,e,f),m=this._getMask2DExtent();if(m){var v=m.intersection(f);if(!v)return u;e=v.convertTo(function(t){return n._pointToContainerPoint(t)})}var y=n._containerPointToPrj(e.getCenter()),_=void 0;_=p?this._project(n._pointToPrj(n._prjToPoint(y)._add(d))):this._project(y);for(var x=this._project(n._pointToPrj(f.getMin())),w=this._project(n._pointToPrj(f.getMax())),b=a.getTileIndex(_,c),M=a.getTileIndex(x,c),S=a.getTileIndex(w,c),T=Math.ceil(Math.abs(b.y-M.y)),C=Math.ceil(Math.abs(b.x-M.x)),A=Math.ceil(Math.abs(b.y-S.y)),E=Math.ceil(Math.abs(b.x-S.x)),P=this.getId(),L=this.getRenderer(),I=this.getTileSize(),R=this._getTileConfig().tileSystem.scale,D=[],O=new bi,k=-C;k<=E;k++)for(var z=-T;z<=A;z++){var N=a.getNeighorTileIndex(b.x,b.y,k,z,c,this.options.repeatWorld),B=a.getTilePrjNW(N.x,N.y,c),F=n._prjToPoint(this._unproject(B),s),G=void 0,V=void 0;if(l===h)G=I.width,V=I.height;else{var H=a.getTilePrjSE(N.x,N.y,c),U=n._prjToPoint(this._unproject(H),s);G=Math.abs(Math.round(U.x-F.x)),V=Math.abs(Math.round(U.y-F.y))}var W=R.x*(N.idx-N.x)*G,j=-R.y*(N.idy-N.y)*V;(W||j)&&F._add(W,j),l!==h&&(G++,V++),p&&F._sub(d);var Z=new bi(F,F.add(G,V)),X={point:F,z:s,x:N.x,y:N.y,extent2d:Z,mask:i};(g.intersects(Z)||this._isTileInExtent(X,e))&&(p&&(X.point._add(d),X.extent2d._add(d)),X.size=[G,V],X.dupKey=F.round().toArray().join()+","+G+","+V+","+P,X.id=this._getTileId(N,s),X.layer=P,L&&L.isTileCachedOrLoading(X.id)||(X.url=this.getTileUrl(N.x,N.y,s)),D.push(X),O._combine(Z))}var q=n._containerPointToPoint(e.getCenter(),s)._add(d);return D.sort(function(t,e){return t.point.distanceTo(q)-e.point.distanceTo(q)}),{offset:d,zoom:s,extent:O,tiles:D}},e.prototype._getInnerExtent=function(t,e,i){var n=this.getMap(),r=n.getResolution(t),o=n.getResolution()/r,a=i.getCenter()._multi(o),s=n.getBearing()*Math.PI/180,l=e.getHeight()/2*o,h=e.getWidth()/2*o,c=Math.abs(Math.cos(s)*l)||l,u=Math.abs(Math.sin(s)*l)||h;return new bi(a.sub(u,c),a.add(u,c))},e.prototype._getTileOffset=function(t){var e=this.getMap(),i=e._getResolution()/e._getResolution(t),n=this.options.offset;return b(n)&&(n=n(this)),n[0]*=i,n[1]*=i,n},e.prototype._getTileId=function(t,e,i){return[i||this.getId(),t.idy,t.idx,e].join("__")},e.prototype._project=function(t){var e=this.getMap(),i=this.getSpatialReference();return i!==e.getSpatialReference()?i.getProjection().project(e.getProjection().unproject(t)):t},e.prototype._unproject=function(t){var e=this.getMap(),i=this.getSpatialReference();return i!==e.getSpatialReference()?e.getProjection().project(i.getProjection().unproject(t)):t},e.prototype._initTileConfig=function(){var t=this.getMap(),e=this.getTileSize(),i=this.getSpatialReference(),n=i.getProjection(),r=i.getFullExtent();if(this._defaultTileConfig=new Io(Po.getDefault(n),r,e),this.options.tileSystem&&(this._tileConfig=new Io(this.options.tileSystem,r,e)),t&&!this._tileConfig&&t.getSpatialReference()===i&&t.getBaseLayer()&&t.getBaseLayer()!==this&&t.getBaseLayer()._getTileConfig){var o=t.getBaseLayer()._getTileConfig();this._tileConfig=new Io(o.tileSystem,o.fullExtent,e)}},e.prototype._getTileConfig=function(){return this._defaultTileConfig||this._initTileConfig(),this._tileConfig||this._defaultTileConfig},e.prototype._bindMap=function(t){var e=t.getBaseLayer();return e===this&&(e.options.hasOwnProperty("forceRenderOnMoving")||this.config({forceRenderOnMoving:!0})),i.prototype._bindMap.apply(this,arguments)},e.prototype._isTileInExtent=function(t,e){var i=this.getMap();if(!i)return!1;var n=t.z,r=t.extent2d.convertTo(function(t){return i._pointToContainerPoint(t,n)});return!(r.getWidth()<5||r.getHeight()<5)&&e.intersects(r)},e.prototype.getEvents=function(){return{spatialreferencechange:this._onSpatialReferenceChange}},e.prototype._onSpatialReferenceChange=function(){delete this._tileConfig,delete this._defaultTileConfig,delete this._sr},e}(Ji);Oo.registerJSONType("TileLayer"),Oo.mergeOptions(Ro);var ko=function(r){function o(t,e,i){u(this,o);var n=v(this,r.call(this,t,i));return n.layers=e||[],n._checkChildren(),n.layerMap={},n._groupChildren=[],n}return m(o,r),o.fromJSON=function(t){if(!t||"GroupTileLayer"!==t.type)return null;var e=t.layers.map(function(t){return Ji.fromJSON(t)});return new o(t.id,e,t.options)},o.prototype.getLayers=function(){return this.layers},o.prototype.toJSON=function(){return{type:this.getJSONType(),id:this.getId(),layers:this.layers.map(function(t){return t.toJSON()}),options:this.config()}},o.prototype.getTiles=function(t){for(var e=this.layers,i=[],n=0,r=0,o=e.length;r<o;r++){var a=e[r];if(a.options.visible){var s=a.getTiles(t);s&&0!==s.count&&(n+=s.count,D(i,s.tileGrids))}}return{count:n,tileGrids:i}},o.prototype.onAdd=function(){var e=this,i=this.getMap();this.layers.forEach(function(t){(e.layerMap[t.getId()]=t).getChildLayer&&e._groupChildren.push(t),t._bindMap(i),t.on("show hide",e._onLayerShowHide,e)}),r.prototype.onAdd.call(this)},o.prototype.onRemove=function(){var e=this;this.layers.forEach(function(t){t._doRemove(),t.off("show hide",e._onLayerShowHide,e)}),delete this.layerMap,delete this._groupChildren,r.prototype.onRemove.call(this)},o.prototype.getChildLayer=function(t){var e=this.layerMap[t];if(e)return e;for(var i=0;i<this._groupChildren.length;i++){var n=this._groupChildren[i].getChildLayer(t);if(n)return n}return null},o.prototype._onLayerShowHide=function(){var t=this.getRenderer();t&&t.setToRedraw()},o.prototype.isVisible=function(){if(!r.prototype.isVisible.call(this))return!1;for(var t=this.layers,e=0,i=t.length;e<i;e++)if(t[e].isVisible())return!0;return!1},o.prototype._checkChildren=function(){var i=this,n={};this.layers.forEach(function(t){var e=t.getId();if(n[e])throw new Error("Duplicate child layer id ("+e+") in the GroupTileLayer ("+i.getId()+")");n[e]=1})},o}(Oo);ko.registerJSONType("GroupTileLayer");var zo={service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},No=function(h){function s(t,e){u(this,s);var i=v(this,h.call(this,t)),n=_({},zo);for(var r in e)r in i.options||(n[r]=e[r]);i.setOptions(e);var o=e.detectRetina&&ae.retina?2:1,a=i.getTileSize();return n.width=a.width*o,n.height=a.height*o,i.wmsParams=n,i._wmsVersion=parseFloat(n.version),i}return m(s,h),s.prototype.onAdd=function(){var t=this.options.crs||this.getMap().getProjection().code,e=1.3<=this._wmsVersion?"crs":"srs";this.wmsParams[e]=t,h.prototype.onAdd.call(this)},s.prototype.getTileUrl=function(t,e,i){var n=this.getMap()._getResolution(i),r=this._getTileConfig().getTilePrjExtent(t,e,n),o=r.getMax(),a=r.getMin(),s=(1.3<=this._wmsVersion&&"EPSG:4326"===this.wmsParams.crs?[a.y,a.x,o.y,o.x]:[a.x,a.y,o.x,o.y]).join(","),l=h.prototype.getTileUrl.call(this,t,e,i);return l+function(t,e,i){var n=[];for(var r in t)n.push(encodeURIComponent(i?r.toUpperCase():r)+"="+encodeURIComponent(t[r]));return(e&&-1!==e.indexOf("?")?"&":"?")+n.join("&")}(this.wmsParams,l,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+s},s.prototype.toJSON=function(){return{type:"WMSTileLayer",id:this.getId(),options:this.config()}},s.fromJSON=function(t){return t&&"WMSTileLayer"===t.type?new s(t.id,t.options):null},s}(Oo);No.registerJSONType("WMSTileLayer"),No.mergeOptions({crs:null,uppercase:!1,detectRetina:!1});var Bo=function(n){function r(t,e){u(this,r);var i=v(this,n.call(this,t,e));return i.options.hasOwnProperty("forceRenderOnMoving")||(i.options.forceRenderOnMoving=!1),i}return m(r,n),r.prototype.drawTile=function(){},r.prototype.toJSON=function(){return{type:"CanvasTileLayer",id:this.getId(),options:this.config()}},r.fromJSON=function(t){return t&&"CanvasTileLayer"===t.type?new r(t.id,t.options):null},r}(Oo);function Fo(t,e,i){var n=t.createShader(e);if(t.shaderSource(n,i),t.compileShader(n),!t.getShaderParameter(n,t.COMPILE_STATUS)){var r=t.getShaderInfoLog(n);throw t.deleteShader(n),new Error("Failed to compile shader: "+r)}return n}Bo.registerJSONType("CanvasTileLayer");var Go="\n        attribute vec3 a_position;\n\n        attribute vec2 a_texCoord;\n\n        uniform mat4 u_matrix;\n\n        varying vec2 v_texCoord;\n\n        void main() {\n            gl_Position = u_matrix * vec4(a_position, 1.0);\n\n            v_texCoord = a_texCoord;\n        }\n    ",Vo="\n        precision mediump float;\n\n        uniform sampler2D u_image;\n\n        uniform float u_opacity;\n\n        varying vec2 v_texCoord;\n\n        void main() {\n\n            gl_FragColor = texture2D(u_image, v_texCoord) * u_opacity;\n\n        }\n    ",Ho=[0,0],Uo=[0,0,0],Wo=new Array(16),jo=function(t){var d,e=function(t){function e(){return u(this,e),v(this,t.apply(this,arguments))}return m(e,t),e.prototype.drawGLImage=function(t,e,i,n,r,o){var a=this.gl;this.loadTexture(t),Uo[0]=e||0,Uo[1]=i||0;var s=Rr(Wo);Er(s,s,Uo),Lr(s,this.getMap().projViewMatrix,s),a.uniformMatrix4fv(this.program.u_matrix,!1,s),a.uniform1f(this.program.u_opacity,o),t.glBuffer?a.bindBuffer(a.ARRAY_BUFFER,t.glBuffer):t.glBuffer=this.bufferTileData(0,0,n,r),Ho[0]="a_position",Ho[1]=3,this.enableVertexAttrib(Ho),a.drawArrays(a.TRIANGLE_STRIP,0,4)},e.prototype.bufferTileData=function(t,e,i,n,r){var o=t,a=t+i,s=e,l=e+n;return this.loadImageBuffer(this.set12(o,s,0,o,l,0,a,s,0,a,l,0),r)},e.prototype.drawTinImage=function(t,e,i,n,r){var o=this.gl;this.loadTexture(t),o.uniformMatrix4fv(this.program.u_matrix,!1,this.getMap().projViewMatrix),o.uniform1f(this.program.u_opacity,r),o.bindBuffer(o.ARRAY_BUFFER,this.posBuffer),this.enableVertexAttrib(["a_position",3]),o.bufferData(o.ARRAY_BUFFER,new Float32Array(e),o.DYNAMIC_DRAW),o.bindBuffer(o.ARRAY_BUFFER,this.texBuffer),this.enableVertexAttrib(["a_texCoord",2]),o.bufferData(o.ARRAY_BUFFER,new Float32Array(i),o.DYNAMIC_DRAW),o.bufferData(o.ELEMENT_ARRAY_BUFFER,new Uint16Array(n),o.DYNAMIC_DRAW),o.drawElements(o.TRIANGLES,n.length,o.UNSIGNED_SHORT,0)},e.prototype.createCanvas2=function(){this.canvas2=ni.createCanvas(this.canvas.width,this.canvas.height)},e.prototype.createGLContext=function(){var t=this.gl=function(t,e){for(var i={alpha:!0,stencil:!0,preserveDrawingBuffer:!0,antialias:!1},n=["webgl","experimental-webgl"],r=null,o=0;o<n.length;++o){try{r=t.getContext(n[o],e||i)}catch(t){}if(r)break}return r}(this.canvas2||this.canvas,this.layer.options.glOptions);t.clearColor(0,0,0,0),t.disable(t.DEPTH_TEST),t.enable(t.STENCIL_TEST),t.enable(t.BLEND),t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA),this.program=this.createProgram(Go,this.layer.options.fragmentShader||Vo,["u_matrix","u_image","u_opacity"]),this.useProgram(this.program),this.texBuffer=this.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.texBuffer),this.enableVertexAttrib(["a_texCoord",2]),t.bufferData(t.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,1]),t.STATIC_DRAW),this.enableSampler("u_image"),t.activeTexture(t.TEXTURE0),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),this.posBuffer=this.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.posBuffer),this.enableVertexAttrib(["a_position",3]),this.indicesBuffer=this.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indicesBuffer)},e.prototype.resizeGLCanvas=function(){this.gl&&this.gl.viewport(0,0,this.canvas.width,this.canvas.height),this.canvas2&&(this.canvas2.width===this.canvas.width&&this.canvas2.height===this.canvas.height||(this.canvas2.width=this.canvas.width,this.canvas2.height=this.canvas.height))},e.prototype.clearGLCanvas=function(){this.gl&&this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.STENCIL_BUFFER_BIT)},e.prototype.disposeImage=function(t){t&&(t.texture&&this.saveTexture(t.texture),t.glBuffer&&this.saveImageBuffer(t.glBuffer),delete t.texture,delete t.glBuffer)},e.prototype._createTexture=function(t){var e=this.gl,i=this.getTexture()||e.createTexture();return e.bindTexture(e.TEXTURE_2D,i),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),r(B(t.width))&&r(B(t.width))&&e.generateMipmap(e.TEXTURE_2D),i},e.prototype.getTexture=function(){this._textures||(this._textures=[]);var t=this._textures;return t&&0<t.length?t.pop():null},e.prototype.saveTexture=function(t){this._textures.push(t)},e.prototype.loadTexture=function(t){var e=this.gl,i=t.texture;return i||(i=this._createTexture(t),t.texture=i),e.bindTexture(e.TEXTURE_2D,i),i},e.prototype.getImageBuffer=function(){this._imageBuffers||(this._imageBuffers=[]);var t=this._imageBuffers;return t&&0<t.length?t.pop():null},e.prototype.saveImageBuffer=function(t){this._imageBuffers.push(t)},e.prototype.loadImageBuffer=function(t,e){var i=this.gl,n=e||this.createImageBuffer();return i.bindBuffer(i.ARRAY_BUFFER,n),i.bufferData(i.ARRAY_BUFFER,t,i.STATIC_DRAW),n},e.prototype.createImageBuffer=function(){return this.getImageBuffer()||this.createBuffer()},e.prototype.removeGLCanvas=function(){var e=this.gl;if(e){this._buffers&&(this._buffers.forEach(function(t){e.deleteBuffer(t)}),delete this._buffers),this._textures&&(this._textures.forEach(function(t){return e.deleteTexture(t)}),delete this._textures),delete this.posBuffer;var t=e.program;e.deleteShader(t.fragmentShader),e.deleteShader(t.vertexShader),e.deleteProgram(t),delete this.gl,delete this.canvas2}},e.prototype.createBuffer=function(){var t=this.gl.createBuffer();if(!t)throw new Error("Failed to create the buffer object");return this._buffers||(this._buffers=[]),this._buffers.push(t),t},e.prototype.enableVertexAttrib=function(t){!function(t,e,i){if(Array.isArray(i[0])){for(var n=Float32Array.BYTES_PER_ELEMENT,r=0,o=0;o<i.length;o++)r+=i[o][1]||0;for(var a=0,s=0;s<i.length;s++){var l=t.getAttribLocation(e,i[s][0]);if(l<0)throw new Error("Failed to get the storage location of "+i[s][0]);t.vertexAttribPointer(l,i[s][1],t[i[s][2]||"FLOAT"],!1,n*r,n*a),a+=i[s][1]||0,t.enableVertexAttribArray(l)}}else{var h=t.getAttribLocation(e,i[0]);t.vertexAttribPointer(h,i[1],t[i[2]||"FLOAT"],!1,0,0),t.enableVertexAttribArray(h)}}(this.gl,this.gl.program,t)},e.prototype.createProgram=function(t,e,i){var n=function(t,e,i){var n=Fo(t,t.VERTEX_SHADER,e),r=Fo(t,t.FRAGMENT_SHADER,i);if(!n||!r)return null;var o=t.createProgram();return o?(t.attachShader(o,n),t.attachShader(o,r),t.linkProgram(o),{program:o,vertexShader:n,fragmentShader:r}):null}(this.gl,t,e),r=n.program,o=n.vertexShader,a=n.fragmentShader;return r.vertexShader=o,r.fragmentShader=a,this._initUniforms(r,i),r},e.prototype.useProgram=function(t){var e=this.gl;return e.useProgram(t),e.program=t,this},e.prototype.enableSampler=function(t,e){var i=this.gl,n=this._getUniform(i.program,t);return e||(e=0),i.uniform1i(n,e),n},e.prototype._initUniforms=function(t,e){for(var i=0;i<e.length;i++){var n=e[i],r=e[i],o=n.indexOf("[");0<=o&&(n=n.substring(0,o),C||(r=r.substring(0,o))),t[n]=this._getUniform(t,r)}},e.prototype._getUniform=function(t,e){var i=this.gl.getUniformLocation(t,e);if(!i)throw new Error("Failed to get the storage location of "+e);return i},e}(t);return _(e.prototype,{set12:(d=ae.ie9?null:new Float32Array(12),function(t,e,i,n,r,o,a,s,l,h,c,u){return d[0]=t,d[1]=e,d[2]=i,d[3]=n,d[4]=r,d[5]=o,d[6]=a,d[7]=s,d[8]=l,d[9]=h,d[10]=c,d[11]=u,d})}),e},Zo={renderer:ae.webgl?"gl":"canvas",crossOrigin:null},Xo=function(r){function o(t,e,i){u(this,o),Array.isArray(e)||e.url||(i=e,e=null);var n=v(this,r.call(this,t,i));return n._prepareImages(e),n}return m(o,r),o.prototype.setImages=function(t){return this._images=t,this._prepareImages(t),this},o.prototype.getImages=function(){return this._images},o.prototype._prepareImages=function(t){t=t||[],Array.isArray(t)||(t=[t]),this._imageData=t.map(function(t){return _({},t,{extent:new wi(t.extent)})}),this._images=t;var e=this.getRenderer();e&&e.refreshImages()},o}(Ji);Xo.mergeOptions(Zo);var qo=[],Yo=function(e){function t(){return u(this,t),v(this,e.apply(this,arguments))}return m(t,e),t.prototype.isDrawable=function(){return!this.getMap().getPitch()||(console&&console.warn("ImageLayer with canvas renderer can't be pitched, use gl renderer ('renderer' : 'gl') instead."),!1)},t.prototype.checkResources=function(){var i=this;if(this._imageLoaded)return qo;var t=this.layer._imageData.map(function(t){return[t.url,null,null]});if(this.resources){var n=[],r=new Yi;t.forEach(function(t){if(i.resources.isResourceLoaded(t)){var e=i.resources.getImage(t);r.addResource(t,e)}else n.push(t)}),this.resources.forEach(function(t,e){r.isResourceLoaded(t)||i.retireImage(e.image)}),this.resources=r,t=n}return this._imageLoaded=!0,t},t.prototype.retireImage=function(){},t.prototype.refreshImages=function(){this._imageLoaded=!1,this.setToRedraw()},t.prototype.needToRedraw=function(){var t=this.getMap();return!(t.isZooming()&&!t.getPitch())&&e.prototype.needToRedraw.call(this)},t.prototype.draw=function(){this.isDrawable()&&(this.prepareCanvas(),this._painted=!1,this._drawImages(),this.completeRender())},t.prototype._drawImages=function(){var t=this.layer._imageData,e=this.getMap().getExtent();if(t&&t.length)for(var i=0;i<t.length;i++){var n=t[i].extent,r=this.resources&&this.resources.getImage(t[i].url);r&&e.intersects(n)&&(this._painted=!0,this._drawImage(r,n,t[i].opacity||1))}},t.prototype._drawImage=function(t,e,i){var n=0,r=this.context;i<1&&(n=r.globalAlpha,r.globalAlpha=i);var o=this.getMap(),a=o.coordToPoint(e.getMin()),s=o.coordToPoint(e.getMax()),l=o._pointToContainerPoint(a),h=l.x,c=l.y,u=o.getBearing();u&&(r.save(),r.translate(h,c),u&&r.rotate(-u*Math.PI/180),h=c=0),r.drawImage(t,h,c,s.x-a.x,s.y-a.y),u&&r.restore(),n&&(r.globalAlpha=n)},t.prototype.drawOnInteracting=function(){this.draw()},t}(qi),Jo=function(e){function t(){return u(this,t),v(this,e.apply(this,arguments))}return m(t,e),t.prototype.isDrawable=function(){return!0},t.prototype._drawImage=function(t,e,i){var n=this.getMap(),r=e.__imagelayerposition;r||(r=e.__imagelayerposition=e.convertTo(function(t){return n.coordToPoint(t,n.getGLZoom())})),this.drawGLImage(t,r.xmin,r.ymin,r.getWidth(),r.getHeight(),i)},t.prototype.createContext=function(){this.createGLContext()},t.prototype.resizeCanvas=function(t){this.canvas&&(e.prototype.resizeCanvas.call(this,t),this.resizeGLCanvas())},t.prototype.clearCanvas=function(){this.canvas&&(e.prototype.clearCanvas.call(this),this.clearGLCanvas())},t.prototype.retireImage=function(t){this.disposeImage(t)},t.prototype.onRemove=function(){this.removeGLCanvas(),e.prototype.onRemove.call(this)},t}(jo(Yo));Xo.registerRenderer("canvas",Yo),Xo.registerRenderer("gl",Jo);var Ko=function(r){function t(){return u(this,t),v(this,r.apply(this,arguments))}return m(t,r),t.prototype.getPrepareParams=function(){return[]},t.prototype.getDrawParams=function(){return[]},t.prototype.onCanvasCreate=function(){this.canvas&&this.layer.options.doubleBuffer&&(this.buffer=ni.createCanvas(this.canvas.width,this.canvas.height,this.getMap().CanvasClass))},t.prototype.needToRedraw=function(){return!!this.layer.options.animation||!(this.getMap().isInteracting()&&!this.layer.drawOnInteracting)&&r.prototype.needToRedraw.call(this)},t.prototype.draw=function(){this.prepareCanvas(),this.prepareDrawContext(),this._drawLayer()},t.prototype.drawOnInteracting=function(){this._drawLayerOnInteracting()},t.prototype.getCanvasImage=function(){var t=r.prototype.getCanvasImage.call(this);if(t&&t.image&&this.layer.options.doubleBuffer){var e=t.image;this.buffer.width===e.width&&this.buffer.height===e.height||(this.buffer.width=e.width,this.buffer.height=e.height);var i=this.buffer.getContext("2d"),n=this.layer.doubleBuffer(i,this.context);(void 0===n||n)&&(ni.image(i,e,0,0),t.image=this.buffer)}return t},t.prototype.remove=function(){return delete this._drawContext,r.prototype.remove.call(this)},t.prototype.onZoomStart=function(t){this.layer.onZoomStart(t),r.prototype.onZoomStart.call(this,t)},t.prototype.onZooming=function(t){this.layer.onZooming(t),r.prototype.onZooming.call(this,t)},t.prototype.onZoomEnd=function(t){this.layer.onZoomEnd(t),r.prototype.onZoomEnd.call(this,t)},t.prototype.onMoveStart=function(t){this.layer.onMoveStart(t),r.prototype.onMoveStart.call(this,t)},t.prototype.onMoving=function(t){this.layer.onMoving(t),r.prototype.onMoving.call(this,t)},t.prototype.onMoveEnd=function(t){this.layer.onMoveEnd(t),r.prototype.onMoveEnd.call(this,t)},t.prototype.onResize=function(t){this.layer.onResize(t),r.prototype.onResize.call(this,t)},t.prototype.prepareDrawContext=function(){if(!this._predrawed){var t=Qo(this.getPrepareParams());this._drawContext=this.layer.prepareToDraw.apply(this.layer,[this.context].concat(t)),this._drawContext||(this._drawContext=[]),Array.isArray(this._drawContext)||(this._drawContext=[this._drawContext]),this._predrawed=!0}},t.prototype._prepareDrawParams=function(){if(!this.getMap())return null;var t=this.getViewExtent();if(t.maskExtent&&!t.extent.intersects(t.maskExtent))return this.completeRender(),null;var e=[this.context,t],i=Qo(this.getDrawParams());return e.push.apply(e,i),e.push.apply(e,this._drawContext),e},t.prototype._drawLayer=function(){var t=this._prepareDrawParams();t&&(this.layer.draw.apply(this.layer,t),this.completeRender())},t.prototype._drawLayerOnInteracting=function(){if(this.layer.drawOnInteracting){var t=this._prepareDrawParams();t&&(this.layer.drawOnInteracting.apply(this.layer,t),this.completeRender())}},t}(qi);function Qo(t){return t||(t=[]),Array.isArray(t)||(t=[t]),t}var $o=function(t){function e(){return u(this,e),v(this,t.apply(this,arguments))}return m(e,t),e.prototype.isCanvasRender=function(){return!0},e.prototype.prepareToDraw=function(){},e.prototype.draw=function(){},e.prototype.redraw=function(){return this._getRenderer()&&this._getRenderer().setToRedraw(),this},e.prototype.play=function(){return this.config("animation",!0),this},e.prototype.pause=function(){return this.config("animation",!1),this},e.prototype.isPlaying=function(){return this.options.animation},e.prototype.clearCanvas=function(){return this._getRenderer()&&this._getRenderer().clearCanvas(),this},e.prototype.requestMapToRender=function(){return this._getRenderer()&&this._getRenderer().requestMapToRender(),this},e.prototype.completeRender=function(){return this._getRenderer()&&this._getRenderer().completeRender(),this},e.prototype.onCanvasCreate=function(){return this},e.prototype.onZoomStart=function(){},e.prototype.onZooming=function(){},e.prototype.onZoomEnd=function(){},e.prototype.onMoveStart=function(){},e.prototype.onMoving=function(){},e.prototype.onMoveEnd=function(){},e.prototype.onResize=function(){},e.prototype.doubleBuffer=function(t){return t.clearRect(0,0,t.canvas.width,t.canvas.height),this},e}(Ji);$o.mergeOptions({doubleBuffer:!1,animation:!1}),$o.registerRenderer("canvas",Ko);var ta=function(t){function e(){return u(this,e),v(this,t.apply(this,arguments))}return m(e,t),e.prototype.getParticles=function(){},e.prototype.draw=function(t,e){var i=this.getParticles(y());if(i&&0!==i.length){var n=this.getMap(),r=e.extent;e.maskExtent&&(r=e.extent.intersection(e.maskExtent)),r=r.convertTo(function(t){return n._pointToContainerPoint(t)});for(var o=2*Math.PI,a=0,s=i.length;a<s;a++){var l=i[a].point;if(r.contains(l)){var h=i[a].color||this.options.lineColor||"#fff",c=i[a].r;t.fillStyle!==h&&(t.fillStyle=h),c<=2?t.fillRect(l.x-c/2,l.y-c/2,c,c):(t.beginPath(),t.arc(l.x,l.y,c/2,0,o),t.fill())}}this._fillCanvas(t)}else{this._getRenderer()&&(this._getRenderer()._shouldClear=!0)}},e.prototype._fillCanvas=function(t){var e=t.globalCompositeOperation;t.globalCompositeOperation="destination-out";var i=this.options.trail||30;t.fillStyle="rgba(0, 0, 0, "+1/i+")",t.fillRect(0,0,t.canvas.width,t.canvas.height),t.globalCompositeOperation=e},e}($o);ta.mergeOptions({animation:!0}),ta.registerRenderer("canvas",function(t){function e(){return u(this,e),v(this,t.apply(this,arguments))}return m(e,t),e.prototype.draw=function(){this.canvas&&this.layer.options.animation&&!this._shouldClear||(this.prepareCanvas(),this._shouldClear=!1),this.prepareDrawContext(),this._drawLayer()},e.prototype.drawOnInteracting=function(){this.draw(),this._shouldClear=!1},e.prototype.onSkipDrawOnInteracting=function(){this._shouldClear=!0},e}(Ko));var ea=function(t){function e(){return u(this,e),v(this,t.apply(this,arguments))}return m(e,t),e.prototype.checkResources=function(){var t=this._geosToCheck;if(this._resourceChecked||t||(t=this.layer._geoList),!H(t))return[];for(var e=[],i={},n=t.length-1;0<=n;n--){var r=t[n]._getExternalResources();if(r.length)if(this.resources)for(var o=0;o<r.length;o++){var a=r[o][0];this.resources.isResourceLoaded(r[o])||i[a]||(e.push(r[o]),i[a]=1)}else e.push.apply(e,r)}return this._resourceChecked=!0,delete this._geosToCheck,e},e.prototype.render=function(){return this.layer._sortGeometries(),t.prototype.render.apply(this,arguments)},e.prototype._addGeoToCheckRes=function(t){t&&(Array.isArray(t)||(t=[t]),this._geosToCheck||(this._geosToCheck=[]),D(this._geosToCheck,t))},e.prototype.onGeometryAdd=function(t){this._addGeoToCheckRes(t),ia(this)},e.prototype.onGeometryRemove=function(){ia(this)},e.prototype.onGeometrySymbolChange=function(t){this._addGeoToCheckRes(t.target),ia(this)},e.prototype.onGeometryShapeChange=function(){ia(this)},e.prototype.onGeometryPositionChange=function(){ia(this)},e.prototype.onGeometryZIndexChange=function(){ia(this)},e.prototype.onGeometryShow=function(){ia(this)},e.prototype.onGeometryHide=function(){ia(this)},e.prototype.onGeometryPropertiesChange=function(){ia(this)},e}(qi);function ia(t){t.layer.options.drawImmediate&&t.render(),t.setToRedraw()}var na=function(e){function t(){return u(this,t),v(this,e.apply(this,arguments))}return m(t,e),t.prototype.checkResources=function(){var r=this,o=e.prototype.checkResources.apply(this,arguments),t=this.layer.getStyle();return t&&(Array.isArray(t)||(t=[t]),t.forEach(function(t){for(var e=Pt(t.symbol,!0),i=0,n=e.length;i<n;i++)r.resources.isResourceLoaded(e[i])||o.push(e[i])})),o},t.prototype.needToRedraw=function(){var t=this.getMap();return!(!t.isInteracting()||!this.layer.options.enableAltitude)||!(t.isZooming()&&!t.isRotating()&&!t.getPitch()&&!this._hasPoint&&this.layer.constructor===wr)&&e.prototype.needToRedraw.call(this)},t.prototype.draw=function(){if(this.getMap()){if(!this.layer.isVisible()||this.layer.isEmpty())return this.clearCanvas(),void this.completeRender();this.prepareCanvas(),this.drawGeos(),this.completeRender()}},t.prototype.isBlank=function(){return!!this.context&&!this.context.canvas._drawn},t.prototype.drawOnInteracting=function(){if(this._geosToDraw){this._getDisplayExtent();for(var t=0,e=this._geosToDraw.length;t<e;t++)this._geosToDraw[t].isVisible()&&this._geosToDraw[t]._paint(this._displayExtent)}},t.prototype.show=function(){this.layer.forEach(function(t){t._repaint()}),e.prototype.show.apply(this,arguments)},t.prototype.forEachGeo=function(t,e){this.layer.forEach(t,e)},t.prototype.drawGeos=function(){this._getDisplayExtent(),this.prepareToDraw(),this.forEachGeo(this.checkGeo,this);for(var t=0,e=this._geosToDraw.length;t<e;t++)this._geosToDraw[t]._paint()},t.prototype.prepareToDraw=function(){this._hasPoint=!1,this._geosToDraw=[]},t.prototype.checkGeo=function(t){if(t&&t.isVisible()&&t.getMap()&&t.getLayer()&&t.getLayer().isCanvasRender()){var e=t._getPainter(),i=e.get2DExtent(this.resources);i&&i.intersects(this._displayExtent)&&(e.hasPoint()&&(this._hasPoint=!0),this._geosToDraw.push(t))}},t.prototype.onZoomEnd=function(){delete this._extent2D,e.prototype.onZoomEnd.apply(this,arguments)},t.prototype.onRemove=function(){this.forEachGeo(function(t){t.onHide()}),delete this._geosToDraw},t.prototype.onGeometryPropertiesChange=function(t){t&&this.layer._styleGeometry(t.target),e.prototype.onGeometryPropertiesChange.call(this,t)},t.prototype._getDisplayExtent=function(){var t=this._extent2D;if(this._maskExtent){if(!this._maskExtent.intersects(t))return void this.completeRender();t=t.intersection(this._maskExtent)}this._displayExtent=t},t.prototype.identify=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},i=this._geosToDraw;return i?this.layer._hitGeos(i,t,e):[]},t}(ea);wr.registerRenderer("canvas",na);var ra=function(r){function a(){return u(this,a),v(this,r.apply(this,arguments))}return m(a,r),a.fromJSON=function(t){if(!t||"ClusterLayer"!==t.type)return null;for(var e=new a(t.id,t.options),i=t.geometries,n=[],r=0;r<i.length;r++){var o=Pn.fromJSON(i[r]);o&&n.push(o)}return e.addGeometry(n),e},a.prototype.addMarker=function(t){return this.addGeometry(t)},a.prototype.addGeometry=function(t){for(var e=0,i=t.length;e<=i;e++)if(!t[e]instanceof Wn)throw new Error("Only a point(Marker) can be added into a ClusterLayer");return r.prototype.addGeometry.apply(this,arguments)},a.prototype.onConfig=function(t){if(r.prototype.onConfig.call(this,t),t.maxClusterRadius||t.symbol||t.drawClusterText||t.textSymbol||t.maxClusterZoom){var e=this._getRenderer();e&&e.render()}return this},a.prototype.identify=function(t,e){var i=this.getMap(),n=this.options.maxClusterZoom;return n&&i&&i.getZoom()>n?r.prototype.identify.call(this,t,e):this._getRenderer()?this._getRenderer().identify(t,e):null},a.prototype.toJSON=function(){var t=r.prototype.toJSON.call(this);return t.type="ClusterLayer",t},a.prototype.getClusters=function(){var t=this._getRenderer();return t&&t._currentClusters||[]},a}(wr);ra.mergeOptions({maxClusterRadius:160,textSumProperty:null,symbol:null,drawClusterText:!0,textSymbol:null,animation:!0,animationDuration:450,maxClusterZoom:null,noClusterWithOneMarker:!0,forceRenderOnZooming:!0}),ra.registerJSONType("ClusterLayer");var oa,aa={textFaceName:'"microsoft yahei"',textSize:16,textDx:0,textDy:0},sa={markerType:"ellipse",markerFill:{property:"count",type:"interval",stops:[[0,"rgb(135, 196, 240)"],[9,"#1bbc9b"],[99,"rgb(216, 115, 149)"]]},markerFillOpacity:.7,markerLineOpacity:1,markerLineWidth:3,markerLineColor:"#fff",markerWidth:{property:"count",type:"interval",stops:[[0,40],[9,60],[99,80]]},markerHeight:{property:"count",type:"interval",stops:[[0,40],[9,60],[99,80]]}};ra.registerRenderer("canvas",function(c){function i(t){u(this,i);var e=v(this,c.call(this,t));return e._animated=!0,e._refreshStyle(),e._clusterNeedRedraw=!0,e}return m(i,c),i.prototype.checkResources=function(){var t=this.layer.options.symbol||sa,e=c.prototype.checkResources.apply(this,arguments);if(t!==this._symbolResourceChecked){var i=Pt(t,!0);i&&e.push.apply(e,i),this._symbolResourceChecked=t}return e},i.prototype.draw=function(){this.canvas||this.prepareCanvas();var t=this.getMap().getZoom(),e=this.layer.options.maxClusterZoom;if(e&&e<t)return delete this._currentClusters,this._markersToDraw=this.layer._geoList,void c.prototype.draw.apply(this,arguments);this._clusterNeedRedraw&&(this._clearDataCache(),this._computeGrid(),this._clusterNeedRedraw=!1);var i=this._clusterCache[t]?this._clusterCache[t].clusters:null,n=this._getClustersToDraw(i);n.zoom=t,this._drawLayer(n)},i.prototype._getClustersToDraw=function(t){this._markersToDraw=[];var e=this.getMap(),i=ve("9",Me(this._textSymbol)).toPoint(),n=e.getContainerExtent(),r=[],o=void 0,a=void 0,s=void 0,l=void 0,h=void 0;for(var c in t)if(this._currentGrid=t[c],1===t[c].count&&this.layer.options.noClusterWithOneMarker){var u=t[c].children[0];u._cluster=t[c],this._markersToDraw.push(u)}else if(l=(s=this._getSprite()).canvas.width,h=s.canvas.height,o=e._prjToContainerPoint(t[c].center),a=new bi(o.sub(l,h),o.add(l,h)),n.intersects(a)){if(!t[c].textSize){var d=this._getClusterText(t[c]);t[c].textSize=new le(i.x*d.length,i.y)._multi(.5)}r.push(t[c])}return r},i.prototype.drawOnInteracting=function(){this._currentClusters&&this._drawClusters(this._currentClusters,1),c.prototype.drawOnInteracting.apply(this,arguments)},i.prototype.forEachGeo=function(e,i){this._markersToDraw&&this._markersToDraw.forEach(function(t){i?e.call(i,t):e(t)})},i.prototype.onGeometryAdd=function(){this._clusterNeedRedraw=!0,c.prototype.onGeometryAdd.apply(this,arguments)},i.prototype.onGeometryRemove=function(){this._clusterNeedRedraw=!0,c.prototype.onGeometryRemove.apply(this,arguments)},i.prototype.onGeometryPositionChange=function(){this._clusterNeedRedraw=!0,c.prototype.onGeometryPositionChange.apply(this,arguments)},i.prototype.onRemove=function(){this._clearDataCache()},i.prototype.identify=function(t,e){var i=this.getMap(),n=this.layer.options.maxClusterZoom;if(n&&i.getZoom()>n)return c.prototype.identify.call(this,t,e);if(this._currentClusters){for(var r=i.coordinateToContainerPoint(t),o=this._currentGrid,a=0;a<this._currentClusters.length;a++){var s=this._currentClusters[a],l=i._prjToContainerPoint(s.center);this._currentGrid=s;var h=this._getSprite().canvas.width;if(r.distanceTo(l)<=h)return{center:i.getProjection().unproject(s.center.copy()),children:s.children.slice(0)}}this._currentGrid=o}return this._markersToDraw?this.layer._hitGeos(this._markersToDraw,t,e):null},i.prototype.onSymbolChanged=function(){this._refreshStyle(),this._computeGrid(),this._stopAnim(),this.setToRedraw()},i.prototype._refreshStyle=function(){var t=this,e=this.layer.options.symbol||sa,i=this.layer.options.textSymbol||aa,n=function(){return[t.getMap().getZoom(),t._currentGrid]};this._symbol=St(e,n),this._textSymbol=St(i,n)},i.prototype._drawLayer=function(e){var i=this,n=this._currentClusters||e;this._currentClusters=e,delete this._clusterMaskExtent;var t=this.layer;if(t.options.animation&&this._animated&&this._inout){var r=[0,1];"in"===this._inout&&(r=[1,0]),this._player=Nn.animate({d:r},{speed:t.options.animationDuration,easing:"inAndOut"},function(t){"finished"===t.state.playState?(i._animated=!1,i._drawClusters(e,1),i._drawMarkers(),i.completeRender()):("in"===i._inout?i._drawClustersFrame(e,n,t.styles.d):i._drawClustersFrame(n,e,t.styles.d),i.setCanvasUpdated())}).play()}else this._animated=!1,this._drawClusters(e,1),this._drawMarkers(),this.completeRender()},i.prototype._drawMarkers=function(){c.prototype.drawGeos.call(this,this._clusterMaskExtent)},i.prototype._drawClustersFrame=function(t,e,a){var s=this;this._clusterMaskExtent=this.prepareCanvas();var l=this.getMap(),i={};if(t&&t.forEach(function(t){var e=l._prjToContainerPoint(t.center);i[t.key]||(i[t.key]=1,s._drawCluster(e,t,1-a))}),0!==a&&e){var h=t.zoom,c=l._getResolution(h)*this.layer.options.maxClusterRadius,u=this._markerExtent.getMin();e.forEach(function(t){var e=l._prjToContainerPoint(t.center),i=t.center,n=Math.floor((i.x-u.x)/c)+"_"+Math.floor((i.y-u.y)/c),r=s._clusterCache[h].clusterMap[n];if(r){var o=l._prjToContainerPoint(r.center);e=o.add(e.sub(o)._multi(a))}s._drawCluster(e,t,.5<a?1:a)})}},i.prototype._drawClusters=function(t,i){var n=this;if(t){this._clusterMaskExtent=this.prepareCanvas();var r=this.getMap();t.forEach(function(t){var e=r._prjToContainerPoint(t.center);n._drawCluster(e,t,.5<i?1:i)})}},i.prototype._drawCluster=function(t,e,i){this._currentGrid=e;var n=this.context,r=this._getSprite(),o=n.globalAlpha;if(o*i!=0){if(n.globalAlpha=o*i,r){var a=t.add(r.offset)._sub(r.canvas.width/2,r.canvas.height/2);n.drawImage(r.canvas,a.x,a.y)}if(this.layer.options.drawClusterText&&e.textSize){ni.prepareCanvasFont(n,this._textSymbol);var s=this._textSymbol.textDx||0,l=this._textSymbol.textDy||0,h=this._getClusterText(e);ni.fillText(n,h,t.sub(e.textSize).add(s,l))}n.globalAlpha=o}},i.prototype._getClusterText=function(t){return(this.layer.options.textSumProperty?t.textSumProperty:t.count)+""},i.prototype._getSprite=function(){this._spriteCache||(this._spriteCache={});var t=Ot(this._symbol);return this._spriteCache[t]||(this._spriteCache[t]=new Wn([0,0],{symbol:this._symbol})._getSprite(this.resources,this.getMap().CanvasClass)),this._spriteCache[t]},i.prototype._initGridSystem=function(){var e=[],i=void 0,n=void 0;this.layer.forEach(function(t){n=t._getPrjCoordinates(),i=i?i._combine(t._getPrjExtent()):t._getPrjExtent(),e.push({x:n.x,y:n.y,id:t._getInternalId(),geometry:t})}),this._markerExtent=i,this._markerPoints=e},i.prototype._computeGrid=function(){var t=this.getMap(),e=t.getZoom();this._markerExtent||this._initGridSystem(),this._clusterCache||(this._clusterCache={});var i=t._getResolution(t.getMinZoom())>t._getResolution(t.getMaxZoom())?e-1:e+1;this._clusterCache[i]&&this._clusterCache[i].length===this.layer.getCount()&&(this._clusterCache[e]=this._clusterCache[i]),this._clusterCache[e]||(this._clusterCache[e]=this._computeZoomGrid(e))},i.prototype._computeZoomGrid=function(t){if(!this._markerExtent)return null;var e=this.getMap(),i=e._getResolution(t)*this.layer.options.maxClusterRadius,n=e._getResolution(t-1)?e._getResolution(t-1)*this.layer.options.maxClusterRadius:null,r=this._clusterCache[t-1];!r&&t-1>=e.getMinZoom()&&(this._clusterCache[t-1]=r=this._computeZoomGrid(t-1));for(var o=this._markerPoints,a=this.layer.options.textSumProperty,s={},l=this._markerExtent.getMin(),h=void 0,c=void 0,u=0,d=o.length;u<d;u++){var p=o[u].geometry,f=0;a&&p.getProperties()&&p.getProperties()[a]&&(f=p.getProperties()[a]),s[h=Math.floor((o[u].x-l.x)/i)+"_"+Math.floor((o[u].y-l.y)/i)]?(s[h].sum._add(new yi(o[u].x,o[u].y)),s[h].count++,s[h].center=s[h].sum.multi(1/s[h].count),s[h].children.push(p),s[h].textSumProperty+=f):(s[h]={sum:new yi(o[u].x,o[u].y),center:new yi(o[u].x,o[u].y),count:1,textSumProperty:f,children:[p],key:h+""},n&&r&&(c=Math.floor((o[u].x-l.x)/n)+"_"+Math.floor((o[u].y-l.y)/n),s[h].parent=r.clusterMap[c]))}return this._mergeClusters(s,i/2)},i.prototype._mergeClusters=function(t,e){var i={};for(var n in t)i[n]=t[n];var r={},o={},a=void 0,s=void 0;for(var l in t)if(!o[(a=t[l]).key])for(var h=a.key.split("_"),c=+h[0],u=+h[1],d=-1;d<=1;d++)for(var p=-1;p<=1;p++){if(0!==d||0!==p)(s=t[c+d+"_"+(u+p)])&&this._distanceTo(a.center,s.center)<=e&&(r[a.key]||(r[a.key]=[]),r[a.key].push(s),o[s.key]=1)}for(var f in r){var g=t[f];if(g){for(var m=r[f],v=0;v<m.length;v++)t[m[v].key]&&(g.sum._add(m[v].sum),g.count+=m[v].count,g.textSumProperty+=m[v].textSumProperty,g.children=g.children.concat(m[v].children),i[m[v].key]=g,delete t[m[v].key]);g.center=g.sum.multi(1/g.count)}}return{clusters:t,clusterMap:i}},i.prototype._distanceTo=function(t,e){var i=t.x-e.x,n=t.y-e.y;return Math.sqrt(i*i+n*n)},i.prototype._stopAnim=function(){this._player&&"finished"!==this._player.playState&&this._player.finish()},i.prototype.onZoomStart=function(t){this._stopAnim(),c.prototype.onZoomStart.call(this,t)},i.prototype.onZoomEnd=function(t){!this.layer.isEmpty()&&this.layer.isVisible()&&(this._inout=t.from>t.to?"in":"out",this._animated=!0,this._computeGrid()),c.prototype.onZoomEnd.apply(this,arguments)},i.prototype._clearDataCache=function(){this._stopAnim(),delete this._markerExtent,delete this._markerPoints,delete this._clusterCache,delete this._zoomInClusters},i}(na)),"undefined"!=typeof window?oa=window.__DEV__:void 0!==Wi&&(oa=Wi.__DEV__),void 0===oa&&(oa=!0);var la=2311;var ha=function(){return la++};var ca="undefined"==typeof navigator?{browser:{},os:{},node:!0,canvasSupported:!0,svgSupported:!0}:function(t){var e={},i=t.match(/Firefox\/([\d.]+)/),n=t.match(/MSIE\s([\d.]+)/)||t.match(/Trident\/.+?rv:(([\d.]+))/),r=t.match(/Edge\/([\d.]+)/),o=/micromessenger/i.test(t);i&&(e.firefox=!0,e.version=i[1]);n&&(e.ie=!0,e.version=n[1]);r&&(e.edge=!0,e.version=r[1]);o&&(e.weChat=!0);return{browser:e,os:{},node:!1,canvasSupported:!!document.createElement("canvas").getContext,svgSupported:"undefined"!=typeof SVGRect,touchEventsSupported:"ontouchstart"in window&&!e.ie&&!e.edge,pointerEventsSupported:"onpointerdown"in window&&(e.edge||e.ie&&11<=e.version)}}(navigator.userAgent),ua={"[object Function]":1,"[object RegExp]":1,"[object Date]":1,"[object Error]":1,"[object CanvasGradient]":1,"[object CanvasPattern]":1,"[object Image]":1,"[object Canvas]":1},da={"[object Int8Array]":1,"[object Uint8Array]":1,"[object Uint8ClampedArray]":1,"[object Int16Array]":1,"[object Uint16Array]":1,"[object Int32Array]":1,"[object Uint32Array]":1,"[object Float32Array]":1,"[object Float64Array]":1},pa=Object.prototype.toString,fa=Array.prototype,ga=fa.forEach,ma=fa.filter,va=fa.slice,ya=fa.map,_a=fa.reduce,xa={};function wa(t){if(null==t||"object"!=typeof t)return t;var e=t,i=pa.call(t);if("[object Array]"===i){e=[];for(var n=0,r=t.length;n<r;n++)e[n]=wa(t[n])}else if(da[i]){var o=t.constructor;if(t.constructor.from)e=o.from(t);else{e=new o(t.length);for(n=0,r=t.length;n<r;n++)e[n]=wa(t[n])}}else if(!ua[i]&&!Da(t)&&!Ia(t))for(var a in e={},t)t.hasOwnProperty(a)&&(e[a]=wa(t[a]));return e}function ba(t,e,i){if(!Pa(e)||!Pa(t))return i?wa(e):t;for(var n in e)if(e.hasOwnProperty(n)){var r=t[n],o=e[n];!Pa(o)||!Pa(r)||Ea(o)||Ea(r)||Ia(o)||Ia(r)||La(o)||La(r)||Da(o)||Da(r)?!i&&n in t||(t[n]=wa(e[n])):ba(r,o,i)}return t}function Ma(t,e,i){for(var n in e)e.hasOwnProperty(n)&&(i?null!=e[n]:null==t[n])&&(t[n]=e[n]);return t}var Sa,Ta=function(){return xa.createCanvas()};function Ca(t,e,i){if(t&&e)if(t.forEach&&t.forEach===ga)t.forEach(e,i);else if(t.length===+t.length)for(var n=0,r=t.length;n<r;n++)e.call(i,t[n],n,t);else for(var o in t)t.hasOwnProperty(o)&&e.call(i,t[o],o,t)}function Aa(t,e){var i=va.call(arguments,2);return function(){return t.apply(e,i.concat(va.call(arguments)))}}function Ea(t){return"[object Array]"===pa.call(t)}function Pa(t){var e=typeof t;return"function"===e||!!t&&"object"==e}function La(t){return!!ua[pa.call(t)]}function Ia(t){return"object"==typeof t&&"number"==typeof t.nodeType&&"object"==typeof t.ownerDocument}xa.createCanvas=function(){return document.createElement("canvas")};var Ra="__ec_primitive__";function Da(t){return t[Ra]}function Oa(t){t&&Ca(t,function(t,e){this.set(e,t)},this)}var ka="_ec_";Oa.prototype={constructor:Oa,get:function(t){return this[ka+t]},set:function(t,e){return this[ka+t]=e},each:function(t,e){for(var i in void 0!==e&&(t=Aa(t,e)),this)this.hasOwnProperty(i)&&t(this[i],i.slice(4))},removeKey:function(t){delete this[ka+t]}};var za={$override:function(t,e){xa[t]=e},clone:wa,merge:ba,mergeAll:function(t,e){for(var i=t[0],n=1,r=t.length;n<r;n++)i=ba(i,t[n],e);return i},extend:function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t},defaults:Ma,createCanvas:Ta,getContext:function(){return Sa||(Sa=Ta().getContext("2d")),Sa},indexOf:function(t,e){if(t){if(t.indexOf)return t.indexOf(e);for(var i=0,n=t.length;i<n;i++)if(t[i]===e)return i}return-1},inherits:function(t,e){var i=t.prototype;function n(){}for(var r in n.prototype=e.prototype,t.prototype=new n,i)t.prototype[r]=i[r];(t.prototype.constructor=t).superClass=e},mixin:function(t,e,i){Ma(t="prototype"in t?t.prototype:t,e="prototype"in e?e.prototype:e,i)},isArrayLike:function(t){if(t)return"string"!=typeof t&&"number"==typeof t.length},each:Ca,map:function(t,e,i){if(t&&e){if(t.map&&t.map===ya)return t.map(e,i);for(var n=[],r=0,o=t.length;r<o;r++)n.push(e.call(i,t[r],r,t));return n}},reduce:function(t,e,i,n){if(t&&e){if(t.reduce&&t.reduce===_a)return t.reduce(e,i,n);for(var r=0,o=t.length;r<o;r++)i=e.call(n,i,t[r],r,t);return i}},filter:function(t,e,i){if(t&&e){if(t.filter&&t.filter===ma)return t.filter(e,i);for(var n=[],r=0,o=t.length;r<o;r++)e.call(i,t[r],r,t)&&n.push(t[r]);return n}},find:function(t,e,i){if(t&&e)for(var n=0,r=t.length;n<r;n++)if(e.call(i,t[n],n,t))return t[n]},bind:Aa,curry:function(t){var e=va.call(arguments,1);return function(){return t.apply(this,e.concat(va.call(arguments)))}},isArray:Ea,isFunction:function(t){return"function"==typeof t},isString:function(t){return"[object String]"===pa.call(t)},isObject:Pa,isBuiltInObject:La,isDom:Ia,eqNaN:function(t){return t!=t},retrieve:function(t){for(var e=0,i=arguments.length;e<i;e++)if(null!=arguments[e])return arguments[e]},retrieve2:function(t,e){return null!=t?t:e},retrieve3:function(t,e,i){return null!=t?t:null!=e?e:i},slice:function(){return Function.call.apply(va,arguments)},normalizeCssArray:function(t){if("number"==typeof t)return[t,t,t,t];var e=t.length;return 2===e?[t[0],t[1],t[0],t[1]]:3===e?[t[0],t[1],t[2],t[1]]:t},assert:function(t,e){if(!t)throw new Error(e)},setAsPrimitive:function(t){t[Ra]=!0},isPrimitive:Da,createHashMap:function(t){return new Oa(t)},noop:function(){}},Na="undefined"==typeof Float32Array?Array:Float32Array;function Ba(t){return Math.sqrt(Fa(t))}function Fa(t){return t[0]*t[0]+t[1]*t[1]}function Ga(t,e){return Math.sqrt((t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1]))}function Va(t,e){return(t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1])}var Ha={create:function(t,e){var i=new Na(2);return null==t&&(t=0),null==e&&(e=0),i[0]=t,i[1]=e,i},copy:function(t,e){return t[0]=e[0],t[1]=e[1],t},clone:function(t){var e=new Na(2);return e[0]=t[0],e[1]=t[1],e},set:function(t,e,i){return t[0]=e,t[1]=i,t},add:function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t},scaleAndAdd:function(t,e,i,n){return t[0]=e[0]+i[0]*n,t[1]=e[1]+i[1]*n,t},sub:function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t},len:Ba,length:Ba,lenSquare:Fa,lengthSquare:Fa,mul:function(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t},div:function(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t},dot:function(t,e){return t[0]*e[0]+t[1]*e[1]},scale:function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t},normalize:function(t,e){var i=Ba(e);return 0===i?(t[0]=0,t[1]=0):(t[0]=e[0]/i,t[1]=e[1]/i),t},distance:Ga,dist:Ga,distanceSquare:Va,distSquare:Va,negate:function(t,e){return t[0]=-e[0],t[1]=-e[1],t},lerp:function(t,e,i,n){return t[0]=e[0]+n*(i[0]-e[0]),t[1]=e[1]+n*(i[1]-e[1]),t},applyTransform:function(t,e,i){var n=e[0],r=e[1];return t[0]=i[0]*n+i[2]*r+i[4],t[1]=i[1]*n+i[3]*r+i[5],t},min:function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t},max:function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t}};function Ua(){this.on("mousedown",this._dragStart,this),this.on("mousemove",this._drag,this),this.on("mouseup",this._dragEnd,this),this.on("globalout",this._dragEnd,this)}function Wa(t,e){return{target:t,topTarget:e&&e.topTarget}}Ua.prototype={constructor:Ua,_dragStart:function(t){var e=t.target;e&&e.draggable&&((this._draggingTarget=e).dragging=!0,this._x=t.offsetX,this._y=t.offsetY,this.dispatchToElement(Wa(e,t),"dragstart",t.event))},_drag:function(t){var e=this._draggingTarget;if(e){var i=t.offsetX,n=t.offsetY,r=i-this._x,o=n-this._y;this._x=i,this._y=n,e.drift(r,o,t),this.dispatchToElement(Wa(e,t),"drag",t.event);var a=this.findHover(i,n,e).target,s=this._dropTarget;e!==(this._dropTarget=a)&&(s&&a!==s&&this.dispatchToElement(Wa(s,t),"dragleave",t.event),a&&a!==s&&this.dispatchToElement(Wa(a,t),"dragenter",t.event))}},_dragEnd:function(t){var e=this._draggingTarget;e&&(e.dragging=!1),this.dispatchToElement(Wa(e,t),"dragend",t.event),this._dropTarget&&this.dispatchToElement(Wa(this._dropTarget,t),"drop",t.event),this._draggingTarget=null,this._dropTarget=null}};var ja=Ua,Za=Array.prototype.slice,Xa=function(){this._$handlers={}};Xa.prototype={constructor:Xa,one:function(t,e,i){var n=this._$handlers;if(!e||!t)return this;n[t]||(n[t]=[]);for(var r=0;r<n[t].length;r++)if(n[t][r].h===e)return this;return n[t].push({h:e,one:!0,ctx:i||this}),this},on:function(t,e,i){var n=this._$handlers;if(!e||!t)return this;n[t]||(n[t]=[]);for(var r=0;r<n[t].length;r++)if(n[t][r].h===e)return this;return n[t].push({h:e,one:!1,ctx:i||this}),this},isSilent:function(t){var e=this._$handlers;return e[t]&&e[t].length},off:function(t,e){var i=this._$handlers;if(!t)return this._$handlers={},this;if(e){if(i[t]){for(var n=[],r=0,o=i[t].length;r<o;r++)i[t][r].h!=e&&n.push(i[t][r]);i[t]=n}i[t]&&0===i[t].length&&delete i[t]}else delete i[t];return this},trigger:function(t){if(this._$handlers[t]){var e=arguments,i=e.length;3<i&&(e=Za.call(e,1));for(var n=this._$handlers[t],r=n.length,o=0;o<r;){switch(i){case 1:n[o].h.call(n[o].ctx);break;case 2:n[o].h.call(n[o].ctx,e[1]);break;case 3:n[o].h.call(n[o].ctx,e[1],e[2]);break;default:n[o].h.apply(n[o].ctx,e)}n[o].one?(n.splice(o,1),r--):o++}}return this},triggerWithContext:function(t){if(this._$handlers[t]){var e=arguments,i=e.length;4<i&&(e=Za.call(e,1,e.length-1));for(var n=e[e.length-1],r=this._$handlers[t],o=r.length,a=0;a<o;){switch(i){case 1:r[a].h.call(n);break;case 2:r[a].h.call(n,e[1]);break;case 3:r[a].h.call(n,e[1],e[2]);break;default:r[a].h.apply(n,e)}r[a].one?(r.splice(a,1),o--):a++}}return this}};var qa=Xa,Ya="silent";function Ja(){}Ja.prototype.dispose=function(){};var Ka=["click","dblclick","mousewheel","mouseout","mouseup","mousedown","mousemove","contextmenu"],Qa=function(t,e,i,n){qa.call(this),this.storage=t,this.painter=e,this.painterRoot=n,i=i||new Ja,((this.proxy=i).handler=this)._hovered={},this._lastTouchMoment,this._lastX,this._lastY,ja.call(this),za.each(Ka,function(t){i.on&&i.on(t,this[t],this)},this)};function $a(t,e,i){if(t[t.rectHover?"rectContain":"contain"](e,i)){for(var n,r=t;r;){if(r.clipPath&&!r.clipPath.contain(e,i))return!1;r.silent&&(n=!0),r=r.parent}return!n||Ya}return!1}Qa.prototype={constructor:Qa,mousemove:function(t){var e=t.zrX,i=t.zrY,n=this._hovered,r=n.target;r&&!r.__zr&&(r=(n=this.findHover(n.x,n.y)).target);var o=this._hovered=this.findHover(e,i),a=o.target,s=this.proxy;s.setCursor&&s.setCursor(a?a.cursor:"default"),r&&a!==r&&this.dispatchToElement(n,"mouseout",t),this.dispatchToElement(o,"mousemove",t),a&&a!==r&&this.dispatchToElement(o,"mouseover",t)},mouseout:function(t){this.dispatchToElement(this._hovered,"mouseout",t);for(var e,i=t.toElement||t.relatedTarget;(i=i&&i.parentNode)&&9!=i.nodeType&&!(e=i===this.painterRoot););!e&&this.trigger("globalout",{event:t})},resize:function(t){this._hovered={}},dispatch:function(t,e){var i=this[t];i&&i.call(this,e)},dispose:function(){this.proxy.dispose(),this.storage=this.proxy=this.painter=null},setCursorStyle:function(t){var e=this.proxy;e.setCursor&&e.setCursor(t)},dispatchToElement:function(t,e,i){var n=(t=t||{}).target;if(!n||!n.silent){for(var r,o,a="on"+e,s={type:e,event:o=i,target:(r=t).target,topTarget:r.topTarget,cancelBubble:!1,offsetX:o.zrX,offsetY:o.zrY,gestureEvent:o.gestureEvent,pinchX:o.pinchX,pinchY:o.pinchY,pinchScale:o.pinchScale,wheelDelta:o.zrDelta,zrByTouch:o.zrByTouch,which:o.which};n&&(n[a]&&(s.cancelBubble=n[a].call(n,s)),n.trigger(e,s),n=n.parent,!s.cancelBubble););s.cancelBubble||(this.trigger(e,s),this.painter&&this.painter.eachOtherLayer(function(t){"function"==typeof t[a]&&t[a].call(t,s),t.trigger&&t.trigger(e,s)}))}},findHover:function(t,e,i){for(var n=this.storage.getDisplayList(),r={x:t,y:e},o=n.length-1;0<=o;o--){var a;if(n[o]!==i&&!n[o].ignore&&(a=$a(n[o],t,e))&&(!r.topTarget&&(r.topTarget=n[o]),a!==Ya)){r.target=n[o];break}}return r}},za.each(["click","mousedown","mouseup","mousewheel","dblclick","contextmenu"],function(n){Qa.prototype[n]=function(t){var e=this.findHover(t.zrX,t.zrY),i=e.target;if("mousedown"===n)this._downEl=i,this._downPoint=[t.zrX,t.zrY],this._upEl=i;else if("mosueup"===n)this._upEl=i;else if("click"===n){if(this._downEl!==this._upEl||!this._downPoint||4<Ha.dist(this._downPoint,[t.zrX,t.zrY]))return;this._downPoint=null}this.dispatchToElement(e,n,t)}}),za.mixin(Qa,qa),za.mixin(Qa,ja);var ts=Qa,es="undefined"==typeof Float32Array?Array:Float32Array;function is(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t}var ns={create:function(){var t=new es(6);return is(t),t},identity:is,copy:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},mul:function(t,e,i){var n=e[0]*i[0]+e[2]*i[1],r=e[1]*i[0]+e[3]*i[1],o=e[0]*i[2]+e[2]*i[3],a=e[1]*i[2]+e[3]*i[3],s=e[0]*i[4]+e[2]*i[5]+e[4],l=e[1]*i[4]+e[3]*i[5]+e[5];return t[0]=n,t[1]=r,t[2]=o,t[3]=a,t[4]=s,t[5]=l,t},translate:function(t,e,i){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4]+i[0],t[5]=e[5]+i[1],t},rotate:function(t,e,i){var n=e[0],r=e[2],o=e[4],a=e[1],s=e[3],l=e[5],h=Math.sin(i),c=Math.cos(i);return t[0]=n*c+a*h,t[1]=-n*h+a*c,t[2]=r*c+s*h,t[3]=-r*h+c*s,t[4]=c*o+h*l,t[5]=c*l-h*o,t},scale:function(t,e,i){var n=i[0],r=i[1];return t[0]=e[0]*n,t[1]=e[1]*r,t[2]=e[2]*n,t[3]=e[3]*r,t[4]=e[4]*n,t[5]=e[5]*r,t},invert:function(t,e){var i=e[0],n=e[2],r=e[4],o=e[1],a=e[3],s=e[5],l=i*a-o*n;return l?(l=1/l,t[0]=a*l,t[1]=-o*l,t[2]=-n*l,t[3]=i*l,t[4]=(n*s-a*r)*l,t[5]=(o*r-i*s)*l,t):null}},rs=ns.identity;function os(t){return 5e-5<t||t<-5e-5}var as=function(t){(t=t||{}).position||(this.position=[0,0]),null==t.rotation&&(this.rotation=0),t.scale||(this.scale=[1,1]),this.origin=this.origin||null},ss=as.prototype;ss.transform=null,ss.needLocalTransform=function(){return os(this.rotation)||os(this.position[0])||os(this.position[1])||os(this.scale[0]-1)||os(this.scale[1]-1)},ss.updateTransform=function(){var t=this.parent,e=t&&t.transform,i=this.needLocalTransform(),n=this.transform;i||e?(n=n||ns.create(),i?this.getLocalTransform(n):rs(n),e&&(i?ns.mul(n,t.transform,n):ns.copy(n,t.transform)),this.transform=n,this.invTransform=this.invTransform||ns.create(),ns.invert(this.invTransform,n)):n&&rs(n)},ss.getLocalTransform=function(t){return as.getLocalTransform(this,t)},ss.setTransform=function(t){var e=this.transform,i=t.dpr||1;e?t.setTransform(i*e[0],i*e[1],i*e[2],i*e[3],i*e[4],i*e[5]):t.setTransform(i,0,0,i,0,0)},ss.restoreTransform=function(t){var e=t.dpr||1;t.setTransform(e,0,0,e,0,0)};var ls=[];ss.decomposeTransform=function(){if(this.transform){var t=this.parent,e=this.transform;t&&t.transform&&(ns.mul(ls,t.invTransform,e),e=ls);var i=e[0]*e[0]+e[1]*e[1],n=e[2]*e[2]+e[3]*e[3],r=this.position,o=this.scale;os(i-1)&&(i=Math.sqrt(i)),os(n-1)&&(n=Math.sqrt(n)),e[0]<0&&(i=-i),e[3]<0&&(n=-n),r[0]=e[4],r[1]=e[5],o[0]=i,o[1]=n,this.rotation=Math.atan2(-e[1]/n,e[0]/i)}},ss.getGlobalScale=function(){var t=this.transform;if(!t)return[1,1];var e=Math.sqrt(t[0]*t[0]+t[1]*t[1]),i=Math.sqrt(t[2]*t[2]+t[3]*t[3]);return t[0]<0&&(e=-e),t[3]<0&&(i=-i),[e,i]},ss.transformCoordToLocal=function(t,e){var i=[t,e],n=this.invTransform;return n&&Ha.applyTransform(i,i,n),i},ss.transformCoordToGlobal=function(t,e){var i=[t,e],n=this.transform;return n&&Ha.applyTransform(i,i,n),i},as.getLocalTransform=function(t,e){rs(e=e||[]);var i=t.origin,n=t.scale||[1,1],r=t.rotation||0,o=t.position||[0,0];return i&&(e[4]-=i[0],e[5]-=i[1]),ns.scale(e,e,n),r&&ns.rotate(e,e,r),i&&(e[4]+=i[0],e[5]+=i[1]),e[4]+=o[0],e[5]+=o[1],e};var hs=as,cs={linear:function(t){return t},quadraticIn:function(t){return t*t},quadraticOut:function(t){return t*(2-t)},quadraticInOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)},cubicIn:function(t){return t*t*t},cubicOut:function(t){return--t*t*t+1},cubicInOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)},quarticIn:function(t){return t*t*t*t},quarticOut:function(t){return 1- --t*t*t*t},quarticInOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)},quinticIn:function(t){return t*t*t*t*t},quinticOut:function(t){return--t*t*t*t*t+1},quinticInOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)},sinusoidalIn:function(t){return 1-Math.cos(t*Math.PI/2)},sinusoidalOut:function(t){return Math.sin(t*Math.PI/2)},sinusoidalInOut:function(t){return.5*(1-Math.cos(Math.PI*t))},exponentialIn:function(t){return 0===t?0:Math.pow(1024,t-1)},exponentialOut:function(t){return 1===t?1:1-Math.pow(2,-10*t)},exponentialInOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))},circularIn:function(t){return 1-Math.sqrt(1-t*t)},circularOut:function(t){return Math.sqrt(1- --t*t)},circularInOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},elasticIn:function(t){var e,i=.1;return 0===t?0:1===t?1:(!i||i<1?(i=1,e=.1):e=.4*Math.asin(1/i)/(2*Math.PI),-i*Math.pow(2,10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/.4))},elasticOut:function(t){var e,i=.1;return 0===t?0:1===t?1:(!i||i<1?(i=1,e=.1):e=.4*Math.asin(1/i)/(2*Math.PI),i*Math.pow(2,-10*t)*Math.sin((t-e)*(2*Math.PI)/.4)+1)},elasticInOut:function(t){var e,i=.1;return 0===t?0:1===t?1:(!i||i<1?(i=1,e=.1):e=.4*Math.asin(1/i)/(2*Math.PI),(t*=2)<1?i*Math.pow(2,10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/.4)*-.5:i*Math.pow(2,-10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/.4)*.5+1)},backIn:function(t){return t*t*(2.70158*t-1.70158)},backOut:function(t){return--t*t*(2.70158*t+1.70158)+1},backInOut:function(t){var e=2.5949095;return(t*=2)<1?t*t*((e+1)*t-e)*.5:.5*((t-=2)*t*((e+1)*t+e)+2)},bounceIn:function(t){return 1-cs.bounceOut(1-t)},bounceOut:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},bounceInOut:function(t){return t<.5?.5*cs.bounceIn(2*t):.5*cs.bounceOut(2*t-1)+.5}},us=cs;function ds(t){this._target=t.target,this._life=t.life||1e3,this._delay=t.delay||0,this._initialized=!1,this.loop=null!=t.loop&&t.loop,this.gap=t.gap||0,this.easing=t.easing||"Linear",this.onframe=t.onframe,this.ondestroy=t.ondestroy,this.onrestart=t.onrestart,this._pausedTime=0,this._paused=!1}ds.prototype={constructor:ds,step:function(t,e){if(this._initialized||(this._startTime=t+this._delay,this._initialized=!0),this._paused)this._pausedTime+=e;else{var i=(t-this._startTime-this._pausedTime)/this._life;if(!(i<0)){i=Math.min(i,1);var n=this.easing,r="string"==typeof n?us[n]:n,o="function"==typeof r?r(i):i;return this.fire("frame",o),1==i?this.loop?(this.restart(t),"restart"):(this._needsRemove=!0,"destroy"):null}}},restart:function(t){var e=(t-this._startTime-this._pausedTime)%this._life;this._startTime=t-e+this.gap,this._pausedTime=0,this._needsRemove=!1},fire:function(t,e){this[t="on"+t]&&this[t](this._target,e)},pause:function(){this._paused=!0},resume:function(){this._paused=!1}};var ps=ds,fs=function(){this.head=null,this.tail=null,this._len=0},gs=fs.prototype;gs.insert=function(t){var e=new ms(t);return this.insertEntry(e),e},gs.insertEntry=function(t){this.head?((this.tail.next=t).prev=this.tail,t.next=null,this.tail=t):this.head=this.tail=t,this._len++},gs.remove=function(t){var e=t.prev,i=t.next;e?e.next=i:this.head=i,i?i.prev=e:this.tail=e,t.next=t.prev=null,this._len--},gs.len=function(){return this._len},gs.clear=function(){this.head=this.tail=null,this._len=0};var ms=function(t){this.value=t,this.next,this.prev},vs=function(t){this._list=new fs,this._map={},this._maxSize=t||10,this._lastRemovedEntry=null},ys=vs.prototype;ys.put=function(t,e){var i=this._list,n=this._map,r=null;if(null==n[t]){var o=i.len(),a=this._lastRemovedEntry;if(o>=this._maxSize&&0<o){var s=i.head;i.remove(s),delete n[s.key],r=s.value,this._lastRemovedEntry=s}a?a.value=e:a=new ms(e),a.key=t,i.insertEntry(a),n[t]=a}return r},ys.get=function(t){var e=this._map[t],i=this._list;if(null!=e)return e!==i.tail&&(i.remove(e),i.insertEntry(e)),e.value},ys.clear=function(){this._list.clear(),this._map={}};var _s=vs,xs={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function ws(t){return(t=Math.round(t))<0?0:255<t?255:t}function bs(t){return t<0?0:1<t?1:t}function Ms(t){return t.length&&"%"===t.charAt(t.length-1)?ws(parseFloat(t)/100*255):ws(parseInt(t,10))}function Ss(t){return t.length&&"%"===t.charAt(t.length-1)?bs(parseFloat(t)/100):bs(parseFloat(t))}function Ts(t,e,i){return i<0?i+=1:1<i&&(i-=1),6*i<1?t+(e-t)*i*6:2*i<1?e:3*i<2?t+(e-t)*(2/3-i)*6:t}function Cs(t,e,i){return t+(e-t)*i}function As(t,e,i,n,r){return t[0]=e,t[1]=i,t[2]=n,t[3]=r,t}function Es(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}var Ps=new _s(20),Ls=null;function Is(t,e){Ls&&Es(Ls,e),Ls=Ps.put(t,Ls||e.slice())}function Rs(t,e){if(t){e=e||[];var i=Ps.get(t);if(i)return Es(e,i);var n,r=(t+="").replace(/ /g,"").toLowerCase();if(r in xs)return Es(e,xs[r]),Is(t,e),e;if("#"===r.charAt(0))return 4===r.length?0<=(n=parseInt(r.substr(1),16))&&n<=4095?(As(e,(3840&n)>>4|(3840&n)>>8,240&n|(240&n)>>4,15&n|(15&n)<<4,1),Is(t,e),e):void As(e,0,0,0,1):7===r.length?0<=(n=parseInt(r.substr(1),16))&&n<=16777215?(As(e,(16711680&n)>>16,(65280&n)>>8,255&n,1),Is(t,e),e):void As(e,0,0,0,1):void 0;var o=r.indexOf("("),a=r.indexOf(")");if(-1!==o&&a+1===r.length){var s=r.substr(0,o),l=r.substr(o+1,a-(o+1)).split(","),h=1;switch(s){case"rgba":if(4!==l.length)return void As(e,0,0,0,1);h=Ss(l.pop());case"rgb":return 3!==l.length?void As(e,0,0,0,1):(As(e,Ms(l[0]),Ms(l[1]),Ms(l[2]),h),Is(t,e),e);case"hsla":return 4!==l.length?void As(e,0,0,0,1):(l[3]=Ss(l[3]),Ds(l,e),Is(t,e),e);case"hsl":return 3!==l.length?void As(e,0,0,0,1):(Ds(l,e),Is(t,e),e);default:return}}As(e,0,0,0,1)}}function Ds(t,e){var i=(parseFloat(t[0])%360+360)%360/360,n=Ss(t[1]),r=Ss(t[2]),o=r<=.5?r*(n+1):r+n-r*n,a=2*r-o;return As(e=e||[],ws(255*Ts(a,o,i+1/3)),ws(255*Ts(a,o,i)),ws(255*Ts(a,o,i-1/3)),1),4===t.length&&(e[3]=t[3]),e}function Os(t,e,i){if(e&&e.length&&0<=t&&t<=1){i=i||[];var n=t*(e.length-1),r=Math.floor(n),o=Math.ceil(n),a=e[r],s=e[o],l=n-r;return i[0]=ws(Cs(a[0],s[0],l)),i[1]=ws(Cs(a[1],s[1],l)),i[2]=ws(Cs(a[2],s[2],l)),i[3]=bs(Cs(a[3],s[3],l)),i}}function ks(t,e,i){if(e&&e.length&&0<=t&&t<=1){var n=t*(e.length-1),r=Math.floor(n),o=Math.ceil(n),a=Rs(e[r]),s=Rs(e[o]),l=n-r,h=zs([ws(Cs(a[0],s[0],l)),ws(Cs(a[1],s[1],l)),ws(Cs(a[2],s[2],l)),bs(Cs(a[3],s[3],l))],"rgba");return i?{color:h,leftIndex:r,rightIndex:o,value:n}:h}}function zs(t,e){if(t&&t.length){var i=t[0]+","+t[1]+","+t[2];return"rgba"!==e&&"hsva"!==e&&"hsla"!==e||(i+=","+t[3]),e+"("+i+")"}}var Ns={parse:Rs,lift:function(t,e){var i=Rs(t);if(i){for(var n=0;n<3;n++)i[n]=e<0?i[n]*(1-e)|0:(255-i[n])*e+i[n]|0;return zs(i,4===i.length?"rgba":"rgb")}},toHex:function(t){var e=Rs(t);if(e)return((1<<24)+(e[0]<<16)+(e[1]<<8)+ +e[2]).toString(16).slice(1)},fastLerp:Os,fastMapToColor:Os,lerp:ks,mapToColor:ks,modifyHSL:function(t,e,i,n){if(t=Rs(t))return t=function(t){if(t){var e,i,n=t[0]/255,r=t[1]/255,o=t[2]/255,a=Math.min(n,r,o),s=Math.max(n,r,o),l=s-a,h=(s+a)/2;if(0===l)i=e=0;else{i=h<.5?l/(s+a):l/(2-s-a);var c=((s-n)/6+l/2)/l,u=((s-r)/6+l/2)/l,d=((s-o)/6+l/2)/l;n===s?e=d-u:r===s?e=1/3+c-d:o===s&&(e=2/3+u-c),e<0&&(e+=1),1<e&&(e-=1)}var p=[360*e,i,h];return null!=t[3]&&p.push(t[3]),p}}(t),null!=e&&(t[0]=(r=e,(r=Math.round(r))<0?0:360<r?360:r)),null!=i&&(t[1]=Ss(i)),null!=n&&(t[2]=Ss(n)),zs(Ds(t),"rgba");var r},modifyAlpha:function(t,e){if((t=Rs(t))&&null!=e)return t[3]=bs(e),zs(t,"rgba")},stringify:zs},Bs=za.isArrayLike,Fs=Array.prototype.slice;function Gs(t,e){return t[e]}function Vs(t,e,i){t[e]=i}function Hs(t,e,i){return(e-t)*i+t}function Us(t,e,i){return.5<i?e:t}function Ws(t,e,i,n,r){var o=t.length;if(1==r)for(var a=0;a<o;a++)n[a]=Hs(t[a],e[a],i);else{var s=o&&t[0].length;for(a=0;a<o;a++)for(var l=0;l<s;l++)n[a][l]=Hs(t[a][l],e[a][l],i)}}function js(t,e,i){var n=t.length,r=e.length;if(n!==r)if(r<n)t.length=r;else for(var o=n;o<r;o++)t.push(1===i?e[o]:Fs.call(e[o]));var a=t[0]&&t[0].length;for(o=0;o<t.length;o++)if(1===i)isNaN(t[o])&&(t[o]=e[o]);else for(var s=0;s<a;s++)isNaN(t[o][s])&&(t[o][s]=e[o][s])}function Zs(t,e,i){if(t===e)return!0;var n=t.length;if(n!==e.length)return!1;if(1===i){for(var r=0;r<n;r++)if(t[r]!==e[r])return!1}else{var o=t[0].length;for(r=0;r<n;r++)for(var a=0;a<o;a++)if(t[r][a]!==e[r][a])return!1}return!0}function Xs(t,e,i,n,r,o,a,s,l){var h=t.length;if(1==l)for(var c=0;c<h;c++)s[c]=qs(t[c],e[c],i[c],n[c],r,o,a);else{var u=t[0].length;for(c=0;c<h;c++)for(var d=0;d<u;d++)s[c][d]=qs(t[c][d],e[c][d],i[c][d],n[c][d],r,o,a)}}function qs(t,e,i,n,r,o,a){var s=.5*(i-t),l=.5*(n-e);return(2*(e-i)+s+l)*a+(-3*(e-i)-2*s-l)*o+s*r+e}function Ys(t){if(Bs(t)){var e=t.length;if(Bs(t[0])){for(var i=[],n=0;n<e;n++)i.push(Fs.call(t[n]));return i}return Fs.call(t)}return t}function Js(t){return t[0]=Math.floor(t[0]),t[1]=Math.floor(t[1]),t[2]=Math.floor(t[2]),"rgba("+t.join(",")+")"}function Ks(t,e,i,n,o,r){var a=t._getter,s=t._setter,l="spline"===e,h=n.length;if(h){var c,u,d,p=n[0].value,f=Bs(p),g=!1,m=!1,v=f?(u=(c=n)[c.length-1].value,Bs(u&&u[0])?2:1):0;n.sort(function(t,e){return t.time-e.time}),d=n[h-1].time;for(var y=[],_=[],x=n[0].value,w=!0,b=0;b<h;b++){y.push(n[b].time/d);var M=n[b].value;if(f&&Zs(M,x,v)||!f&&M===x||(w=!1),"string"==typeof(x=M)){var S=Ns.parse(M);S?(M=S,g=!0):m=!0}_.push(M)}if(r||!w){var T=_[h-1];for(b=0;b<h-1;b++)f?js(_[b],T,v):!isNaN(_[b])||isNaN(T)||m||g||(_[b]=T);f&&js(a(t._target,o),T,v);var C,A,E,P,L,I=0,R=0;if(g)var D=[0,0,0,0];var O=new ps({target:t._target,life:d,loop:t._loop,delay:t._delay,onframe:function(t,e){var i;if(e<0)i=0;else if(e<R){for(i=Math.min(I+1,h-1);0<=i&&!(y[i]<=e);i--);i=Math.min(i,h-2)}else{for(i=I;i<h&&!(y[i]>e);i++);i=Math.min(i-1,h-2)}R=e;var n=y[(I=i)+1]-y[i];if(0!==n)if(C=(e-y[i])/n,l)if(E=_[i],A=_[0===i?i:i-1],P=_[h-2<i?h-1:i+1],L=_[h-3<i?h-1:i+2],f)Xs(A,E,P,L,C,C*C,C*C*C,a(t,o),v);else{if(g)r=Xs(A,E,P,L,C,C*C,C*C*C,D,1),r=Js(D);else{if(m)return Us(E,P,C);r=qs(A,E,P,L,C,C*C,C*C*C)}s(t,o,r)}else if(f)Ws(_[i],_[i+1],C,a(t,o),v);else{var r;if(g)Ws(_[i],_[i+1],C,D,1),r=Js(D);else{if(m)return Us(_[i],_[i+1],C);r=Hs(_[i],_[i+1],C)}s(t,o,r)}},ondestroy:i});return e&&"spline"!==e&&(O.easing=e),O}}}var Qs=function(t,e,i,n){this._tracks={},this._target=t,this._loop=e||!1,this._getter=i||Gs,this._setter=n||Vs,this._clipCount=0,this._delay=0,this._doneList=[],this._onframeList=[],this._clipList=[]};Qs.prototype={when:function(t,e){var i=this._tracks;for(var n in e)if(e.hasOwnProperty(n)){if(!i[n]){i[n]=[];var r=this._getter(this._target,n);if(null==r)continue;0!==t&&i[n].push({time:0,value:Ys(r)})}i[n].push({time:t,value:e[n]})}return this},during:function(t){return this._onframeList.push(t),this},pause:function(){for(var t=0;t<this._clipList.length;t++)this._clipList[t].pause();this._paused=!0},resume:function(){for(var t=0;t<this._clipList.length;t++)this._clipList[t].resume();this._paused=!1},isPaused:function(){return!!this._paused},_doneCallback:function(){this._tracks={},this._clipList.length=0;for(var t=this._doneList,e=t.length,i=0;i<e;i++)t[i].call(this)},start:function(t,e){var i,n=this,r=0,o=function(){--r||n._doneCallback()};for(var a in this._tracks)if(this._tracks.hasOwnProperty(a)){var s=Ks(this,t,o,this._tracks[a],a,e);s&&(this._clipList.push(s),r++,this.animation&&this.animation.addClip(s),i=s)}if(i){var l=i.onframe;i.onframe=function(t,e){l(t,e);for(var i=0;i<n._onframeList.length;i++)n._onframeList[i](t,e)}}return r||this._doneCallback(),this},stop:function(t){for(var e=this._clipList,i=this.animation,n=0;n<e.length;n++){var r=e[n];t&&r.onframe(this._target,1),i&&i.removeClip(r)}e.length=0},delay:function(t){return this._delay=t,this},done:function(t){return t&&this._doneList.push(t),this},getClips:function(){return this._clipList}};var $s=Qs,tl=1;"undefined"!=typeof window&&(tl=Math.max(window.devicePixelRatio||1,1));var el={debugMode:0,devicePixelRatio:tl},il=el.debugMode,nl=function(){};1===il?nl=function(){for(var t in arguments)throw new Error(arguments[t])}:1<il&&(nl=function(){for(var t in arguments)console.log(arguments[t])});var rl=nl,ol=za.isString,al=za.isFunction,sl=za.isObject,ll=za.isArrayLike,hl=za.indexOf,cl=function(){this.animators=[]};cl.prototype={constructor:cl,animate:function(t,e){var i,n=!1,r=this,o=this.__zr;if(t){var a=t.split("."),s=r;n="shape"===a[0];for(var l=0,h=a.length;l<h;l++)s&&(s=s[a[l]]);s&&(i=s)}else i=r;if(i){var c=r.animators,u=new $s(i,e);return u.during(function(t){r.dirty(n)}).done(function(){c.splice(hl(c,u),1)}),c.push(u),o&&o.animation.addAnimator(u),u}rl('Property "'+t+'" is not existed in element '+r.id)},stopAnimation:function(t){for(var e=this.animators,i=e.length,n=0;n<i;n++)e[n].stop(t);return e.length=0,this},animateTo:function(t,e,i,n,r,o){ol(i)?(r=n,n=i,i=0):al(n)?(r=n,n="linear",i=0):al(i)?(r=i,i=0):al(e)?(r=e,e=500):e||(e=500),this.stopAnimation(),this._animateToShallow("",this,t,e,i);var a=this.animators.slice(),s=a.length;function l(){--s||r&&r()}s||r&&r();for(var h=0;h<a.length;h++)a[h].done(l).start(n,o)},_animateToShallow:function(t,e,i,n,r){var o={},a=0;for(var s in i)if(i.hasOwnProperty(s))if(null!=e[s])sl(i[s])&&!ll(i[s])?this._animateToShallow(t?t+"."+s:s,e[s],i[s],n,r):(o[s]=i[s],a++);else if(null!=i[s])if(t){var l={};l[t]={},l[t][s]=i[s],this.attr(l)}else this.attr(s,i[s]);return 0<a&&this.animate(t,!1).when(null==n?500:n,o).delay(r||0),this}};var ul=cl,dl=function(t){hs.call(this,t),qa.call(this,t),ul.call(this,t),this.id=t.id||ha()};dl.prototype={type:"element",name:"",__zr:null,ignore:!1,clipPath:null,drift:function(t,e){switch(this.draggable){case"horizontal":e=0;break;case"vertical":t=0}var i=this.transform;i||(i=this.transform=[1,0,0,1,0,0]),i[4]+=t,i[5]+=e,this.decomposeTransform(),this.dirty(!1)},beforeUpdate:function(){},afterUpdate:function(){},update:function(){this.updateTransform()},traverse:function(t,e){},attrKV:function(t,e){if("position"===t||"scale"===t||"origin"===t){if(e){var i=this[t];i||(i=this[t]=[]),i[0]=e[0],i[1]=e[1]}}else this[t]=e},hide:function(){this.ignore=!0,this.__zr&&this.__zr.refresh()},show:function(){this.ignore=!1,this.__zr&&this.__zr.refresh()},attr:function(t,e){if("string"==typeof t)this.attrKV(t,e);else if(za.isObject(t))for(var i in t)t.hasOwnProperty(i)&&this.attrKV(i,t[i]);return this.dirty(!1),this},setClipPath:function(t){var e=this.__zr;e&&t.addSelfToZr(e),this.clipPath&&this.clipPath!==t&&this.removeClipPath(),(this.clipPath=t).__zr=e,(t.__clipTarget=this).dirty(!1)},removeClipPath:function(){var t=this.clipPath;t&&(t.__zr&&t.removeSelfFromZr(t.__zr),t.__zr=null,t.__clipTarget=null,this.clipPath=null,this.dirty(!1))},addSelfToZr:function(t){this.__zr=t;var e=this.animators;if(e)for(var i=0;i<e.length;i++)t.animation.addAnimator(e[i]);this.clipPath&&this.clipPath.addSelfToZr(t)},removeSelfFromZr:function(t){this.__zr=null;var e=this.animators;if(e)for(var i=0;i<e.length;i++)t.animation.removeAnimator(e[i]);this.clipPath&&this.clipPath.removeSelfFromZr(t)}},za.mixin(dl,ul),za.mixin(dl,hs),za.mixin(dl,qa);var pl,fl,gl,ml,vl=dl,yl=Ha.applyTransform,_l=Math.min,xl=Math.max;function wl(t,e,i,n){i<0&&(t+=i,i=-i),n<0&&(e+=n,n=-n),this.x=t,this.y=e,this.width=i,this.height=n}wl.prototype={constructor:wl,union:function(t){var e=_l(t.x,this.x),i=_l(t.y,this.y);this.width=xl(t.x+t.width,this.x+this.width)-e,this.height=xl(t.y+t.height,this.y+this.height)-i,this.x=e,this.y=i},applyTransform:(pl=[],fl=[],gl=[],ml=[],function(t){if(t){pl[0]=gl[0]=this.x,pl[1]=ml[1]=this.y,fl[0]=ml[0]=this.x+this.width,fl[1]=gl[1]=this.y+this.height,yl(pl,pl,t),yl(fl,fl,t),yl(gl,gl,t),yl(ml,ml,t),this.x=_l(pl[0],fl[0],gl[0],ml[0]),this.y=_l(pl[1],fl[1],gl[1],ml[1]);var e=xl(pl[0],fl[0],gl[0],ml[0]),i=xl(pl[1],fl[1],gl[1],ml[1]);this.width=e-this.x,this.height=i-this.y}}),calculateTransform:function(t){var e=t.width/this.width,i=t.height/this.height,n=ns.create();return ns.translate(n,n,[-this.x,-this.y]),ns.scale(n,n,[e,i]),ns.translate(n,n,[t.x,t.y]),n},intersect:function(t){if(!t)return!1;t instanceof wl||(t=wl.create(t));var e=this.x,i=this.x+this.width,n=this.y,r=this.y+this.height,o=t.x,a=t.x+t.width,s=t.y,l=t.y+t.height;return!(i<o||a<e||r<s||l<n)},contain:function(t,e){return t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height},clone:function(){return new wl(this.x,this.y,this.width,this.height)},copy:function(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height},plain:function(){return{x:this.x,y:this.y,width:this.width,height:this.height}}},wl.create=function(t){return new wl(t.x,t.y,t.width,t.height)};var bl=wl,Ml=function(t){for(var e in t=t||{},vl.call(this,t),t)t.hasOwnProperty(e)&&(this[e]=t[e]);this._children=[],this.__storage=null,this.__dirty=!0};Ml.prototype={constructor:Ml,isGroup:!0,type:"group",silent:!1,children:function(){return this._children.slice()},childAt:function(t){return this._children[t]},childOfName:function(t){for(var e=this._children,i=0;i<e.length;i++)if(e[i].name===t)return e[i]},childCount:function(){return this._children.length},add:function(t){return t&&t!==this&&t.parent!==this&&(this._children.push(t),this._doAdd(t)),this},addBefore:function(t,e){if(t&&t!==this&&t.parent!==this&&e&&e.parent===this){var i=this._children,n=i.indexOf(e);0<=n&&(i.splice(n,0,t),this._doAdd(t))}return this},_doAdd:function(t){t.parent&&t.parent.remove(t);var e=(t.parent=this).__storage,i=this.__zr;e&&e!==t.__storage&&(e.addToStorage(t),t instanceof Ml&&t.addChildrenToStorage(e)),i&&i.refresh()},remove:function(t){var e=this.__zr,i=this.__storage,n=this._children,r=za.indexOf(n,t);return r<0||(n.splice(r,1),t.parent=null,i&&(i.delFromStorage(t),t instanceof Ml&&t.delChildrenFromStorage(i)),e&&e.refresh()),this},removeAll:function(){var t,e,i=this._children,n=this.__storage;for(e=0;e<i.length;e++)t=i[e],n&&(n.delFromStorage(t),t instanceof Ml&&t.delChildrenFromStorage(n)),t.parent=null;return i.length=0,this},eachChild:function(t,e){for(var i=this._children,n=0;n<i.length;n++){var r=i[n];t.call(e,r,n)}return this},traverse:function(t,e){for(var i=0;i<this._children.length;i++){var n=this._children[i];t.call(e,n),"group"===n.type&&n.traverse(t,e)}return this},addChildrenToStorage:function(t){for(var e=0;e<this._children.length;e++){var i=this._children[e];t.addToStorage(i),i instanceof Ml&&i.addChildrenToStorage(t)}},delChildrenFromStorage:function(t){for(var e=0;e<this._children.length;e++){var i=this._children[e];t.delFromStorage(i),i instanceof Ml&&i.delChildrenFromStorage(t)}},dirty:function(){return this.__dirty=!0,this.__zr&&this.__zr.refresh(),this},getBoundingRect:function(t){for(var e=null,i=new bl(0,0,0,0),n=t||this._children,r=[],o=0;o<n.length;o++){var a=n[o];if(!a.ignore&&!a.invisible){var s=a.getBoundingRect(),l=a.getLocalTransform(r);l?(i.copy(s),i.applyTransform(l),(e=e||i.clone()).union(i)):(e=e||s.clone()).union(s)}}return e||i}},za.inherits(Ml,vl);var Sl=Ml,Tl=32,Cl=7;function Al(t,e,i,n){var r=e+1;if(r===i)return 1;if(n(t[r++],t[e])<0){for(;r<i&&n(t[r],t[r-1])<0;)r++;!function(t,e,i){i--;for(;e<i;){var n=t[e];t[e++]=t[i],t[i--]=n}}(t,e,r)}else for(;r<i&&0<=n(t[r],t[r-1]);)r++;return r-e}function El(t,e,i,n,r){for(n===e&&n++;n<i;n++){for(var o,a=t[n],s=e,l=n;s<l;)r(a,t[o=s+l>>>1])<0?l=o:s=o+1;var h=n-s;switch(h){case 3:t[s+3]=t[s+2];case 2:t[s+2]=t[s+1];case 1:t[s+1]=t[s];break;default:for(;0<h;)t[s+h]=t[s+h-1],h--}t[s]=a}}function Pl(t,e,i,n,r,o){var a=0,s=0,l=1;if(0<o(t,e[i+r])){for(s=n-r;l<s&&0<o(t,e[i+r+l]);)(l=1+((a=l)<<1))<=0&&(l=s);s<l&&(l=s),a+=r,l+=r}else{for(s=r+1;l<s&&o(t,e[i+r-l])<=0;)(l=1+((a=l)<<1))<=0&&(l=s);s<l&&(l=s);var h=a;a=r-l,l=r-h}for(a++;a<l;){var c=a+(l-a>>>1);0<o(t,e[i+c])?a=c+1:l=c}return l}function Ll(t,e,i,n,r,o){var a=0,s=0,l=1;if(o(t,e[i+r])<0){for(s=r+1;l<s&&o(t,e[i+r-l])<0;)(l=1+((a=l)<<1))<=0&&(l=s);s<l&&(l=s);var h=a;a=r-l,l=r-h}else{for(s=n-r;l<s&&0<=o(t,e[i+r+l]);)(l=1+((a=l)<<1))<=0&&(l=s);s<l&&(l=s),a+=r,l+=r}for(a++;a<l;){var c=a+(l-a>>>1);o(t,e[i+c])<0?l=c:a=c+1}return l}function Il(f,g){var t,a,s,m=Cl,l=0;t=f.length;var v=[];function e(t){var e=a[t],i=s[t],n=a[t+1],r=s[t+1];s[t]=i+r,t===l-3&&(a[t+1]=a[t+2],s[t+1]=s[t+2]),l--;var o=Ll(f[n],f,e,i,0,g);e+=o,0!==(i-=o)&&0!==(r=Pl(f[e+i-1],f,n,r,r-1,g))&&(i<=r?function(t,e,i,n){var r=0;for(r=0;r<e;r++)v[r]=f[t+r];var o=0,a=i,s=t;if(f[s++]=f[a++],0==--n){for(r=0;r<e;r++)f[s+r]=v[o+r];return}if(1===e){for(r=0;r<n;r++)f[s+r]=f[a+r];return f[s+n]=v[o]}var l,h,c,u=m;for(;;){h=l=0,c=!1;do{if(g(f[a],v[o])<0){if(f[s++]=f[a++],h++,(l=0)==--n){c=!0;break}}else if(f[s++]=v[o++],l++,h=0,1==--e){c=!0;break}}while((l|h)<u);if(c)break;do{if(0!==(l=Ll(f[a],v,o,e,0,g))){for(r=0;r<l;r++)f[s+r]=v[o+r];if(s+=l,o+=l,(e-=l)<=1){c=!0;break}}if(f[s++]=f[a++],0==--n){c=!0;break}if(0!==(h=Pl(v[o],f,a,n,0,g))){for(r=0;r<h;r++)f[s+r]=f[a+r];if(s+=h,a+=h,0===(n-=h)){c=!0;break}}if(f[s++]=v[o++],1==--e){c=!0;break}u--}while(Cl<=l||Cl<=h);if(c)break;u<0&&(u=0),u+=2}if((m=u)<1&&(m=1),1===e){for(r=0;r<n;r++)f[s+r]=f[a+r];f[s+n]=v[o]}else{if(0===e)throw new Error;for(r=0;r<e;r++)f[s+r]=v[o+r]}}(e,i,n,r):function(t,e,i,n){var r=0;for(r=0;r<n;r++)v[r]=f[i+r];var o=t+e-1,a=n-1,s=i+n-1,l=0,h=0;if(f[s--]=f[o--],0==--e){for(l=s-(n-1),r=0;r<n;r++)f[l+r]=v[r];return}if(1===n){for(h=(s-=e)+1,l=(o-=e)+1,r=e-1;0<=r;r--)f[h+r]=f[l+r];return f[s]=v[a]}var c=m;for(;;){var u=0,d=0,p=!1;do{if(g(v[a],f[o])<0){if(f[s--]=f[o--],u++,(d=0)==--e){p=!0;break}}else if(f[s--]=v[a--],d++,u=0,1==--n){p=!0;break}}while((u|d)<c);if(p)break;do{if(0!==(u=e-Ll(v[a],f,t,e,e-1,g))){for(e-=u,h=(s-=u)+1,l=(o-=u)+1,r=u-1;0<=r;r--)f[h+r]=f[l+r];if(0===e){p=!0;break}}if(f[s--]=v[a--],1==--n){p=!0;break}if(0!==(d=n-Pl(f[o],v,0,n,n-1,g))){for(n-=d,h=(s-=d)+1,l=(a-=d)+1,r=0;r<d;r++)f[h+r]=v[l+r];if(n<=1){p=!0;break}}if(f[s--]=f[o--],0==--e){p=!0;break}c--}while(Cl<=u||Cl<=d);if(p)break;c<0&&(c=0),c+=2}(m=c)<1&&(m=1);if(1===n){for(h=(s-=e)+1,l=(o-=e)+1,r=e-1;0<=r;r--)f[h+r]=f[l+r];f[s]=v[a]}else{if(0===n)throw new Error;for(l=s-(n-1),r=0;r<n;r++)f[l+r]=v[r]}}(e,i,n,r))}a=[],s=[],this.mergeRuns=function(){for(;1<l;){var t=l-2;if(1<=t&&s[t-1]<=s[t]+s[t+1]||2<=t&&s[t-2]<=s[t]+s[t-1])s[t-1]<s[t+1]&&t--;else if(s[t]>s[t+1])break;e(t)}},this.forceMergeRuns=function(){for(;1<l;){var t=l-2;0<t&&s[t-1]<s[t+1]&&t--,e(t)}},this.pushRun=function(t,e){a[l]=t,s[l]=e,l+=1}}var Rl=function(t,e,i,n){i||(i=0),n||(n=t.length);var r=n-i;if(!(r<2)){var o=0;if(r<Tl)El(t,i,n,i+(o=Al(t,i,n,e)),e);else{var a=new Il(t,e),s=function(t){for(var e=0;Tl<=t;)e|=1&t,t>>=1;return t+e}(r);do{if((o=Al(t,i,n,e))<s){var l=r;s<l&&(l=s),El(t,i,i+l,i+o,e),o=l}a.pushRun(i,o),a.mergeRuns(),r-=o,i+=o}while(0!==r);a.forceMergeRuns()}}};function Dl(t,e){return t.zlevel===e.zlevel?t.z===e.z?t.z2-e.z2:t.z-e.z:t.zlevel-e.zlevel}var Ol=function(){this._roots=[],this._displayList=[],this._displayListLen=0};Ol.prototype={constructor:Ol,traverse:function(t,e){for(var i=0;i<this._roots.length;i++)this._roots[i].traverse(t,e)},getDisplayList:function(t,e){return e=e||!1,t&&this.updateDisplayList(e),this._displayList},updateDisplayList:function(t){this._displayListLen=0;for(var e=this._roots,i=this._displayList,n=0,r=e.length;n<r;n++)this._updateAndAddDisplayable(e[n],null,t);i.length=this._displayListLen,ca.canvasSupported&&Rl(i,Dl)},_updateAndAddDisplayable:function(t,e,i){if(!t.ignore||i){t.beforeUpdate(),t.__dirty&&t.update(),t.afterUpdate();var n=t.clipPath;if(n){e=e?e.slice():[];for(var r=n,o=t;r;)r.parent=o,r.updateTransform(),e.push(r),r=(o=r).clipPath}if(t.isGroup){for(var a=t._children,s=0;s<a.length;s++){var l=a[s];t.__dirty&&(l.__dirty=!0),this._updateAndAddDisplayable(l,e,i)}t.__dirty=!1}else t.__clipPaths=e,this._displayList[this._displayListLen++]=t}},addRoot:function(t){t.__storage!==this&&(t instanceof Sl&&t.addChildrenToStorage(this),this.addToStorage(t),this._roots.push(t))},delRoot:function(t){if(null==t){for(var e=0;e<this._roots.length;e++){var i=this._roots[e];i instanceof Sl&&i.delChildrenFromStorage(this)}return this._roots=[],this._displayList=[],void(this._displayListLen=0)}if(t instanceof Array){e=0;for(var n=t.length;e<n;e++)this.delRoot(t[e])}else{var r=za.indexOf(this._roots,t);0<=r&&(this.delFromStorage(t),this._roots.splice(r,1),t instanceof Sl&&t.delChildrenFromStorage(this))}},addToStorage:function(t){return t.__storage=this,t.dirty(!1),this},delFromStorage:function(t){return t&&(t.__storage=null),this},dispose:function(){this._renderList=this._roots=null},displayableSortFunc:Dl};var kl=Ol,zl=[["shadowBlur",0],["shadowOffsetX",0],["shadowOffsetY",0],["shadowColor","#000"],["lineCap","butt"],["lineJoin","miter"],["miterLimit",10]],Nl=function(t,e){this.extendFrom(t,!1),this.host=e};function Bl(t,e,i){var n=null==e.x?0:e.x,r=null==e.x2?1:e.x2,o=null==e.y?0:e.y,a=null==e.y2?0:e.y2;return e.global||(n=n*i.width+i.x,r=r*i.width+i.x,o=o*i.height+i.y,a=a*i.height+i.y),t.createLinearGradient(n,o,r,a)}function Fl(t,e,i){var n=i.width,r=i.height,o=Math.min(n,r),a=null==e.x?.5:e.x,s=null==e.y?.5:e.y,l=null==e.r?.5:e.r;return e.global||(a=a*n+i.x,s=s*r+i.y,l*=o),t.createRadialGradient(a,s,0,a,s,l)}for(var Gl=Nl.prototype={constructor:Nl,host:null,fill:"#000",stroke:null,opacity:1,lineDash:null,lineDashOffset:0,shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,lineWidth:1,strokeNoScale:!1,text:null,font:null,textFont:null,fontStyle:null,fontWeight:null,fontSize:null,fontFamily:null,textTag:null,textFill:"#000",textStroke:null,textWidth:null,textHeight:null,textStrokeWidth:0,textLineHeight:null,textPosition:"inside",textRect:null,textOffset:null,textAlign:null,textVerticalAlign:null,textDistance:5,textShadowColor:"transparent",textShadowBlur:0,textShadowOffsetX:0,textShadowOffsetY:0,textBoxShadowColor:"transparent",textBoxShadowBlur:0,textBoxShadowOffsetX:0,textBoxShadowOffsetY:0,transformText:!1,textRotation:0,textOrigin:null,textBackgroundColor:null,textBorderColor:null,textBorderWidth:0,textBorderRadius:0,textPadding:null,rich:null,truncate:null,blend:null,bind:function(t,e,i){for(var n=this,r=i&&i.style,o=!r,a=0;a<zl.length;a++){var s=zl[a],l=s[0];(o||n[l]!==r[l])&&(t[l]=n[l]||s[1])}if((o||n.fill!==r.fill)&&(t.fillStyle=n.fill),(o||n.stroke!==r.stroke)&&(t.strokeStyle=n.stroke),(o||n.opacity!==r.opacity)&&(t.globalAlpha=null==n.opacity?1:n.opacity),(o||n.blend!==r.blend)&&(t.globalCompositeOperation=n.blend||"source-over"),this.hasStroke()){var h=n.lineWidth;t.lineWidth=h/(this.strokeNoScale&&e&&e.getLineScale?e.getLineScale():1)}},hasFill:function(){var t=this.fill;return null!=t&&"none"!==t},hasStroke:function(){var t=this.stroke;return null!=t&&"none"!==t&&0<this.lineWidth},extendFrom:function(t,e){if(t)for(var i in t)!t.hasOwnProperty(i)||!0!==e&&(!1===e?this.hasOwnProperty(i):null==t[i])||(this[i]=t[i])},set:function(t,e){"string"==typeof t?this[t]=e:this.extendFrom(t,!0)},clone:function(){var t=new this.constructor;return t.extendFrom(this,!0),t},getGradient:function(t,e,i){for(var n=("radial"===e.type?Fl:Bl)(t,e,i),r=e.colorStops,o=0;o<r.length;o++)n.addColorStop(r[o].offset,r[o].color);return n}},Vl=0;Vl<zl.length;Vl++){var Hl=zl[Vl];Hl[0]in Gl||(Gl[Hl[0]]=Hl[1])}Nl.getGradient=Gl.getGradient;var Ul=Nl,Wl=function(t,e){this.image=t,this.repeat=e,this.type="pattern"};Wl.prototype.getCanvasPattern=function(t){return t.createPattern(this.image,this.repeat||"repeat")};var jl=Wl,Zl=el.devicePixelRatio;function Xl(){return!1}function ql(t,e,i){var n=za.createCanvas(),r=e.getWidth(),o=e.getHeight(),a=n.style;return a.position="absolute",a.left=0,a.top=0,a.width=r+"px",a.height=o+"px",n.width=r*i,n.height=o*i,n.setAttribute("data-zr-dom-id",t),n}var Yl=function(t,e,i){var n;i=i||Zl,"string"==typeof t?n=ql(t,e,i):za.isObject(t)&&(t=(n=t).id),this.id=t;var r=(this.dom=n).style;r&&(n.onselectstart=Xl,r["-webkit-user-select"]="none",r["user-select"]="none",r["-webkit-touch-callout"]="none",r["-webkit-tap-highlight-color"]="rgba(0,0,0,0)",r.padding=0,r.margin=0,r["border-width"]=0),this.domBack=null,this.ctxBack=null,this.painter=e,this.config=null,this.clearColor=0,this.motionBlur=!1,this.lastFrameAlpha=.7,this.dpr=i};Yl.prototype={constructor:Yl,elCount:0,__dirty:!0,initContext:function(){this.ctx=this.dom.getContext("2d"),this.ctx.__currentValues={},this.ctx.dpr=this.dpr},createBackBuffer:function(){var t=this.dpr;this.domBack=ql("back-"+this.id,this.painter,t),this.ctxBack=this.domBack.getContext("2d"),this.ctxBack.__currentValues={},1!=t&&this.ctxBack.scale(t,t)},resize:function(t,e){var i=this.dpr,n=this.dom,r=n.style,o=this.domBack;r.width=t+"px",r.height=e+"px",n.width=t*i,n.height=e*i,o&&(o.width=t*i,o.height=e*i,1!=i&&this.ctxBack.scale(i,i))},clear:function(t){var e,i=this.dom,n=this.ctx,r=i.width,o=i.height,a=this.clearColor,s=this.motionBlur&&!t,l=this.lastFrameAlpha,h=this.dpr;(s&&(this.domBack||this.createBackBuffer(),this.ctxBack.globalCompositeOperation="copy",this.ctxBack.drawImage(i,0,0,r/h,o/h)),n.clearRect(0,0,r,o),a)&&(a.colorStops?(e=a.__canvasGradient||Ul.getGradient(n,a,{x:0,y:0,width:r,height:o}),a.__canvasGradient=e):a.image&&(e=jl.prototype.getCanvasPattern.call(a,n)),n.save(),n.fillStyle=e||a,n.fillRect(0,0,r,o),n.restore());if(s){var c=this.domBack;n.save(),n.globalAlpha=l,n.drawImage(c,0,0,r,o),n.restore()}}};var Jl=Yl,Kl="undefined"!=typeof window&&(window.requestAnimationFrame&&window.requestAnimationFrame.bind(window)||window.msRequestAnimationFrame&&window.msRequestAnimationFrame.bind(window)||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame)||function(t){setTimeout(t,16)},Ql=new _s(50);function $l(){var t=this.__cachedImgObj;this.onload=this.__cachedImgObj=null;for(var e=0;e<t.pending.length;e++){var i=t.pending[e],n=i.cb;n&&n(this,i.cbPayload),i.hostEl.dirty()}t.pending.length=0}function th(t){return t&&t.width&&t.height}var eh={findExistImage:function(t){if("string"==typeof t){var e=Ql.get(t);return e&&e.image}return t},createOrUpdateImage:function(t,e,i,n,r){if(t){if("string"==typeof t){if(e&&e.__zrImageSrc===t||!i)return e;var o=Ql.get(t),a={hostEl:i,cb:n,cbPayload:r};return o?!th(e=o.image)&&o.pending.push(a):(!e&&(e=new Image),e.onload=$l,Ql.put(t,e.__cachedImgObj={image:e,pending:[a]}),e.src=e.__zrImageSrc=t),e}return t}return e},isImageReady:th},ih=za.getContext,nh=za.extend,rh=za.retrieve2,oh=za.retrieve3,ah={},sh=0,lh=5e3,hh=/\{([a-zA-Z0-9_]+)\|([^}]*)\}/g,ch="12px sans-serif",uh={};function dh(t,e){var i=t+":"+(e=e||ch);if(ah[i])return ah[i];for(var n=(t+"").split("\n"),r=0,o=0,a=n.length;o<a;o++)r=Math.max(xh(n[o],e).width,r);return lh<sh&&(sh=0,ah={}),sh++,ah[i]=r}function ph(t,e,i){return"right"===i?t-=e:"center"===i&&(t-=e/2),t}function fh(t,e,i){return"middle"===i?t-=e/2:"bottom"===i&&(t-=e),t}function gh(t,e,i,n,r){if(!e)return"";var o=(t+"").split("\n");r=mh(e,i,n,r);for(var a=0,s=o.length;a<s;a++)o[a]=vh(o[a],r);return o.join("\n")}function mh(t,e,i,n){(n=nh({},n)).font=e;i=rh(i,"...");n.maxIterations=rh(n.maxIterations,2);var r=n.minChar=rh(n.minChar,0);n.cnCharWidth=dh("\u56fd",e);var o=n.ascCharWidth=dh("a",e);n.placeholder=rh(n.placeholder,"");for(var a=t=Math.max(0,t-1),s=0;s<r&&o<=a;s++)a-=o;var l=dh(i);return a<l&&(i="",l=0),a=t-l,n.ellipsis=i,n.ellipsisWidth=l,n.contentWidth=a,n.containerWidth=t,n}function vh(t,e){var i=e.containerWidth,n=e.font,r=e.contentWidth;if(!i)return"";var o=dh(t,n);if(o<=i)return t;for(var a=0;;a++){if(o<=r||a>=e.maxIterations){t+=e.ellipsis;break}var s=0===a?yh(t,r,e.ascCharWidth,e.cnCharWidth):0<o?Math.floor(t.length*r/o):0;o=dh(t=t.substr(0,s),n)}return""===t&&(t=e.placeholder),t}function yh(t,e,i,n){for(var r=0,o=0,a=t.length;o<a&&r<e;o++){var s=t.charCodeAt(o);r+=0<=s&&s<=127?i:n}return o}function _h(t){return dh("\u56fd",t)}function xh(t,e){return uh.measureText(t,e)}function wh(t,e,i,n){null!=t&&(t+="");var r=_h(e),o=t?t.split("\n"):[],a=o.length*r,s=a;if(i&&(s+=i[0]+i[2]),t&&n){var l=n.outerHeight,h=n.outerWidth;if(null!=l&&l<s)t="",o=[];else if(null!=h)for(var c=mh(h-(i?i[1]+i[3]:0),e,n.ellipsis,{minChar:n.minChar,placeholder:n.placeholder}),u=0,d=o.length;u<d;u++)o[u]=vh(o[u],c)}return{lines:o,height:a,outerHeight:s,lineHeight:r}}function bh(t,e){var i={lines:[],width:0,height:0};if(null!=t&&(t+=""),!t)return i;for(var n,r=hh.lastIndex=0;null!=(n=hh.exec(t));){var o=n.index;r<o&&Mh(i,t.substring(r,o)),Mh(i,n[2],n[1]),r=hh.lastIndex}r<t.length&&Mh(i,t.substring(r,t.length));var a=i.lines,s=0,l=0,h=[],c=e.textPadding,u=e.truncate,d=u&&u.outerWidth,p=u&&u.outerHeight;c&&(null!=d&&(d-=c[1]+c[3]),null!=p&&(p-=c[0]+c[2]));for(var f=0;f<a.length;f++){for(var g=a[f],m=0,v=0,y=0;y<g.tokens.length;y++){var _=(P=g.tokens[y]).styleName&&e.rich[P.styleName]||{},x=P.textPadding=_.textPadding,w=P.font=_.font||e.font,b=P.textHeight=rh(_.textHeight,_h(w));if(x&&(b+=x[0]+x[2]),P.height=b,P.lineHeight=oh(_.textLineHeight,e.textLineHeight,b),P.textAlign=_&&_.textAlign||e.textAlign,P.textVerticalAlign=_&&_.textVerticalAlign||"middle",null!=p&&s+P.lineHeight>p)return{lines:[],width:0,height:0};P.textWidth=dh(P.text,w);var M=_.textWidth,S=null==M||"auto"===M;if("string"==typeof M&&"%"===M.charAt(M.length-1))P.percentWidth=M,h.push(P),M=0;else{if(S){M=P.textWidth;var T=_.textBackgroundColor,C=T&&T.image;C&&(C=eh.findExistImage(C),eh.isImageReady(C)&&(M=Math.max(M,C.width*b/C.height)))}var A=x?x[1]+x[3]:0;M+=A;var E=null!=d?d-v:null;null!=E&&E<M&&(!S||E<A?(P.text="",P.textWidth=M=0):(P.text=gh(P.text,E-A,w,u.ellipsis,{minChar:u.minChar}),P.textWidth=dh(P.text,w),M=P.textWidth+A))}v+=P.width=M,_&&(m=Math.max(m,P.lineHeight))}g.width=v,s+=g.lineHeight=m,l=Math.max(l,v)}i.outerWidth=i.width=rh(e.textWidth,l),i.outerHeight=i.height=rh(e.textHeight,s),c&&(i.outerWidth+=c[1]+c[3],i.outerHeight+=c[0]+c[2]);for(f=0;f<h.length;f++){var P,L=(P=h[f]).percentWidth;P.width=parseInt(L,10)/100*l}return i}function Mh(t,e,i){for(var n=""===e,r=e.split("\n"),o=t.lines,a=0;a<r.length;a++){var s=r[a],l={styleName:i,text:s,isLineHolder:!s&&!n};if(a)o.push({tokens:[l]});else{var h=(o[o.length-1]||(o[0]={tokens:[]})).tokens,c=h.length;1===c&&h[0].isLineHolder?h[0]=l:(s||!c||n)&&h.push(l)}}}uh.measureText=function(t,e){var i=ih();return i.font=e||ch,i.measureText(t)};var Sh={DEFAULT_FONT:ch,$override:function(t,e){uh[t]=e},getWidth:dh,getBoundingRect:function(t,e,i,n,r,o,a){return o?(l=n,h=bh(t,{rich:o,truncate:a,font:e,textAlign:s=i,textPadding:r}),c=h.outerWidth,u=h.outerHeight,d=ph(0,c,s),p=fh(0,u,l),new bl(d,p,c,u)):function(t,e,i,n,r,o){var a=wh(t,e,r,o),s=dh(t,e);r&&(s+=r[1]+r[3]);var l=a.outerHeight,h=ph(0,s,i),c=fh(0,l,n),u=new bl(h,c,s,l);return u.lineHeight=a.lineHeight,u}(t,e,i,n,r,a);var s,l,h,c,u,d,p},adjustTextX:ph,adjustTextY:fh,adjustTextPositionOnRect:function(t,e,i){var n=e.x,r=e.y,o=e.height,a=e.width,s=o/2,l="left",h="top";switch(t){case"left":n-=i,r+=s,l="right",h="middle";break;case"right":n+=i+a,r+=s,h="middle";break;case"top":n+=a/2,r-=i,l="center",h="bottom";break;case"bottom":n+=a/2,r+=o+i,l="center";break;case"inside":n+=a/2,r+=s,l="center",h="middle";break;case"insideLeft":n+=i,r+=s,h="middle";break;case"insideRight":n+=a-i,r+=s,l="right",h="middle";break;case"insideTop":n+=a/2,r+=i,l="center";break;case"insideBottom":n+=a/2,r+=o-i,l="center",h="bottom";break;case"insideTopLeft":n+=i,r+=i;break;case"insideTopRight":n+=a-i,r+=i,l="right";break;case"insideBottomLeft":n+=i,r+=o-i,h="bottom";break;case"insideBottomRight":n+=a-i,r+=o-i,l="right",h="bottom"}return{x:n,y:r,textAlign:l,textVerticalAlign:h}},truncateText:gh,getLineHeight:_h,measureText:xh,parsePlainText:wh,parseRichText:bh,makeFont:function(t){return(t.fontSize||t.fontFamily)&&[t.fontStyle,t.fontWeight,(t.fontSize||12)+"px",t.fontFamily||"sans-serif"].join(" ")||t.textFont||t.font}};var Th={buildPath:function(t,e){var i,n,r,o,a,s=e.x,l=e.y,h=e.width,c=e.height,u=e.r;h<0&&(s+=h,h=-h),c<0&&(l+=c,c=-c),"number"==typeof u?i=n=r=o=u:u instanceof Array?1===u.length?i=n=r=o=u[0]:2===u.length?(i=r=u[0],n=o=u[1]):3===u.length?(i=u[0],n=o=u[1],r=u[2]):(i=u[0],n=u[1],r=u[2],o=u[3]):i=n=r=o=0,h<i+n&&(i*=h/(a=i+n),n*=h/a),h<r+o&&(r*=h/(a=r+o),o*=h/a),c<n+r&&(n*=c/(a=n+r),r*=c/a),c<i+o&&(i*=c/(a=i+o),o*=c/a),t.moveTo(s+i,l),t.lineTo(s+h-n,l),0!==n&&t.quadraticCurveTo(s+h,l,s+h,l+n),t.lineTo(s+h,l+c-r),0!==r&&t.quadraticCurveTo(s+h,l+c,s+h-r,l+c),t.lineTo(s+o,l+c),0!==o&&t.quadraticCurveTo(s,l+c,s,l+c-o),t.lineTo(s,l+i),0!==i&&t.quadraticCurveTo(s,l,s+i,l)}},Ch=za.retrieve2,Ah=za.retrieve3,Eh=za.each,Ph=za.normalizeCssArray,Lh=za.isString,Ih=za.isObject,Rh={left:1,right:1,center:1},Dh={top:1,bottom:1,middle:1};function Oh(t){if(t){t.font=Sh.makeFont(t);var e=t.textAlign;"middle"===e&&(e="center"),t.textAlign=null==e||Rh[e]?e:"left";var i=t.textVerticalAlign||t.textBaseline;"center"===i&&(i="middle"),t.textVerticalAlign=null==i||Dh[i]?i:"top",t.textPadding&&(t.textPadding=Ph(t.textPadding))}}function kh(t,e,i,n,r){if(i&&e.textRotation){var o=e.textOrigin;"center"===o?(n=i.width/2+i.x,r=i.height/2+i.y):o&&(n=o[0]+i.x,r=o[1]+i.y),t.translate(n,r),t.rotate(-e.textRotation),t.translate(-n,-r)}}function zh(t,e,i,n,r,o,a,s){var l=n.rich[i.styleName]||{},h=i.textVerticalAlign,c=o+r/2;"top"===h?c=o+i.height/2:"bottom"===h&&(c=o+r-i.height/2),!i.isLineHolder&&Nh(l)&&Bh(t,e,l,"right"===s?a-i.width:"center"===s?a-i.width/2:a,c-i.height/2,i.width,i.height);var u=i.textPadding;u&&(a=jh(a,s,u),c-=i.height/2-u[2]-i.textHeight/2),Vh(e,"shadowBlur",Ah(l.textShadowBlur,n.textShadowBlur,0)),Vh(e,"shadowColor",l.textShadowColor||n.textShadowColor||"transparent"),Vh(e,"shadowOffsetX",Ah(l.textShadowOffsetX,n.textShadowOffsetX,0)),Vh(e,"shadowOffsetY",Ah(l.textShadowOffsetY,n.textShadowOffsetY,0)),Vh(e,"textAlign",s),Vh(e,"textBaseline","middle"),Vh(e,"font",i.font||Sh.DEFAULT_FONT);var d=Hh(l.textStroke||n.textStroke,f),p=Uh(l.textFill||n.textFill),f=Ch(l.textStrokeWidth,n.textStrokeWidth);d&&(Vh(e,"lineWidth",f),Vh(e,"strokeStyle",d),e.strokeText(i.text,a,c)),p&&(Vh(e,"fillStyle",p),e.fillText(i.text,a,c))}function Nh(t){return t.textBackgroundColor||t.textBorderWidth&&t.textBorderColor}function Bh(t,e,i,n,r,o,a){var s=i.textBackgroundColor,l=i.textBorderWidth,h=i.textBorderColor,c=Lh(s);if(Vh(e,"shadowBlur",i.textBoxShadowBlur||0),Vh(e,"shadowColor",i.textBoxShadowColor||"transparent"),Vh(e,"shadowOffsetX",i.textBoxShadowOffsetX||0),Vh(e,"shadowOffsetY",i.textBoxShadowOffsetY||0),c||l&&h){e.beginPath();var u=i.textBorderRadius;u?Th.buildPath(e,{x:n,y:r,width:o,height:a,r:u}):e.rect(n,r,o,a),e.closePath()}if(c)Vh(e,"fillStyle",s),e.fill();else if(Ih(s)){var d=s.image;(d=eh.createOrUpdateImage(d,null,t,Fh,s))&&eh.isImageReady(d)&&e.drawImage(d,n,r,o,a)}l&&h&&(Vh(e,"lineWidth",l),Vh(e,"strokeStyle",h),e.stroke())}function Fh(t,e){e.image=t}function Gh(t,e,i){var n=e.x||0,r=e.y||0,o=e.textAlign,a=e.textVerticalAlign;if(i){var s=e.textPosition;if(s instanceof Array)n=i.x+Wh(s[0],i.width),r=i.y+Wh(s[1],i.height);else{var l=Sh.adjustTextPositionOnRect(s,i,e.textDistance);n=l.x,r=l.y,o=o||l.textAlign,a=a||l.textVerticalAlign}var h=e.textOffset;h&&(n+=h[0],r+=h[1])}return{baseX:n,baseY:r,textAlign:o,textVerticalAlign:a}}function Vh(t,e,i){return t[e]=i,t[e]}function Hh(t,e){return null==t||e<=0||"transparent"===t||"none"===t?null:t.image||t.colorStops?"#000":t}function Uh(t){return null==t||"none"===t?null:t.image||t.colorStops?"#000":t}function Wh(t,e){return"string"==typeof t?0<=t.lastIndexOf("%")?parseFloat(t)/100*e:parseFloat(t):t}function jh(t,e,i){return"right"===e?t-i[1]:"center"===e?t+i[3]/2-i[1]/2:t+i[3]}var Zh={normalizeTextStyle:function(t){return Oh(t),Eh(t.rich,Oh),t},renderText:function(t,e,i,n,r){n.rich?(o=t,a=e,s=i,l=n,h=r,c=o.__textCotentBlock,c&&!o.__dirty||(c=o.__textCotentBlock=Sh.parseRichText(s,l)),function(t,e,i,n,r){var o=i.width,a=i.outerWidth,s=i.outerHeight,l=n.textPadding,h=Gh(0,n,r),c=h.baseX,u=h.baseY,d=h.textAlign,p=h.textVerticalAlign;kh(e,n,r,c,u);var f=Sh.adjustTextX(c,a,d),g=Sh.adjustTextY(u,s,p),m=f,v=g;l&&(m+=l[3],v+=l[0]);var y=m+o;Nh(n)&&Bh(t,e,n,f,g,a,s);for(var _=0;_<i.lines.length;_++){for(var x,w=i.lines[_],b=w.tokens,M=b.length,S=w.lineHeight,T=w.width,C=0,A=m,E=y,P=M-1;C<M&&(!(x=b[C]).textAlign||"left"===x.textAlign);)zh(t,e,x,n,S,v,A,"left"),T-=x.width,A+=x.width,C++;for(;0<=P&&"right"===(x=b[P]).textAlign;)zh(t,e,x,n,S,v,E,"right"),T-=x.width,E-=x.width,P--;for(A+=(o-(A-m)-(y-E)-T)/2;C<=P;)x=b[C],zh(t,e,x,n,S,v,A+x.width/2,"center"),A+=x.width,C++;v+=S}}(o,a,c,l,h)):function(t,e,i,n,r){var o=Vh(e,"font",n.font||Sh.DEFAULT_FONT),a=n.textPadding,s=t.__textCotentBlock;s&&!t.__dirty||(s=t.__textCotentBlock=Sh.parsePlainText(i,o,a,n.truncate));var l=s.outerHeight,h=s.lines,c=s.lineHeight,u=Gh(0,n,r),d=u.baseX,p=u.baseY,f=u.textAlign,g=u.textVerticalAlign;kh(e,n,r,d,p);var m=Sh.adjustTextY(p,l,g),v=d,y=m,_=Nh(n);if(_||a){var x=Sh.getWidth(i,o),w=x;a&&(w+=a[1]+a[3]);var b=Sh.adjustTextX(d,w,f);_&&Bh(t,e,n,b,m,w,l),a&&(v=jh(d,f,a),y+=a[0])}Vh(e,"textAlign",f||"left"),Vh(e,"textBaseline","middle"),Vh(e,"shadowBlur",n.textShadowBlur||0),Vh(e,"shadowColor",n.textShadowColor||"transparent"),Vh(e,"shadowOffsetX",n.textShadowOffsetX||0),Vh(e,"shadowOffsetY",n.textShadowOffsetY||0),y+=c/2;var M=n.textStrokeWidth,S=Hh(n.textStroke,M),T=Uh(n.textFill);S&&(Vh(e,"lineWidth",M),Vh(e,"strokeStyle",S)),T&&Vh(e,"fillStyle",T);for(var C=0;C<h.length;C++)S&&e.strokeText(h[C],v,y),T&&e.fillText(h[C],v,y),y+=c}(t,e,i,n,r);var o,a,s,l,h,c},getStroke:Hh,getFill:Uh,needDrawText:function(t,e){return null!=t&&(t||e.textBackgroundColor||e.textBorderWidth&&e.textBorderColor||e.textPadding)}},Xh=new bl,qh=function(){};qh.prototype={constructor:qh,drawRectText:function(t,e){var i=this.style;e=i.textRect||e,this.__dirty&&Zh.normalizeTextStyle(i,!0);var n=i.text;if(null!=n&&(n+=""),Zh.needDrawText(n,i)){t.save();var r=this.transform;i.transformText?this.setTransform(t):r&&(Xh.copy(e),Xh.applyTransform(r),e=Xh),Zh.renderText(this,t,n,i,e),t.restore()}}};var Yh=qh;function Jh(t){for(var e in t=t||{},vl.call(this,t),t)t.hasOwnProperty(e)&&"style"!==e&&(this[e]=t[e]);this.style=new Ul(t.style,this),this._rect=null,this.__clipPaths=[]}Jh.prototype={constructor:Jh,type:"displayable",__dirty:!0,invisible:!1,z:0,z2:0,zlevel:0,draggable:!1,dragging:!1,silent:!1,culling:!1,cursor:"pointer",rectHover:!1,progressive:-1,beforeBrush:function(t){},afterBrush:function(t){},brush:function(t,e){},getBoundingRect:function(){},contain:function(t,e){return this.rectContain(t,e)},traverse:function(t,e){t.call(e,this)},rectContain:function(t,e){var i=this.transformCoordToLocal(t,e);return this.getBoundingRect().contain(i[0],i[1])},dirty:function(){this.__dirty=!0,this._rect=null,this.__zr&&this.__zr.refresh()},animateStyle:function(t){return this.animate("style",t)},attrKV:function(t,e){"style"!==t?vl.prototype.attrKV.call(this,t,e):this.style.set(e)},setStyle:function(t,e){return this.style.set(t,e),this.dirty(!1),this},useStyle:function(t){return this.style=new Ul(t,this),this.dirty(!1),this}},za.inherits(Jh,vl),za.mixin(Jh,Yh);var Kh=Jh;function Qh(t){Kh.call(this,t)}Qh.prototype={constructor:Qh,type:"image",brush:function(t,e){var i=this.style,n=i.image;i.bind(t,this,e);var r=this._image=eh.createOrUpdateImage(n,this._image,this,this.onload);if(r&&eh.isImageReady(r)){var o=i.x||0,a=i.y||0,s=i.width,l=i.height,h=r.width/r.height;if(null==s&&null!=l?s=l*h:null==l&&null!=s?l=s/h:null==s&&null==l&&(s=r.width,l=r.height),this.setTransform(t),i.sWidth&&i.sHeight){var c=i.sx||0,u=i.sy||0;t.drawImage(r,c,u,i.sWidth,i.sHeight,o,a,s,l)}else if(i.sx&&i.sy){var d=s-(c=i.sx),p=l-(u=i.sy);t.drawImage(r,c,u,d,p,o,a,s,l)}else t.drawImage(r,o,a,s,l);this.restoreTransform(t),null!=i.text&&this.drawRectText(t,this.getBoundingRect())}},getBoundingRect:function(){var t=this.style;return this._rect||(this._rect=new bl(t.x||0,t.y||0,t.width||0,t.height||0)),this._rect}},za.inherits(Qh,Kh);var $h=Qh,tc=el.devicePixelRatio;function ec(t){return parseInt(t,10)}function ic(t){t.__unusedCount++}function nc(t){1==t.__unusedCount&&t.clear()}var rc=new bl(0,0,0,0),oc=new bl(0,0,0,0);var ac=function(t,e,i){this.type="canvas";var n=!t.nodeName||"CANVAS"===t.nodeName.toUpperCase();this._opts=i=za.extend({},i||{}),this.dpr=i.devicePixelRatio||tc,this._singleCanvas=n;var r=(this.root=t).style;r&&(r["-webkit-tap-highlight-color"]="transparent",r["-webkit-user-select"]=r["user-select"]=r["-webkit-touch-callout"]="none",t.innerHTML=""),this.storage=e;var o,a,s,l=this._zlevelList=[],h=this._layers={};if(this._layerConfig={},n){null!=i.width&&(t.width=i.width),null!=i.height&&(t.height=i.height);var c=t.width,u=t.height;this._width=c,this._height=u;var d=new Jl(t,this,1);d.initContext(),h[0]=d,l.push(0),this._domRoot=t}else{this._width=this._getSize(0),this._height=this._getSize(1);var p=this._domRoot=(o=this._width,a=this._height,(s=document.createElement("div")).style.cssText=["position:relative","overflow:hidden","width:"+o+"px","height:"+a+"px","padding:0","margin:0","border-width:0"].join(";")+";",s);t.appendChild(p)}this._progressiveLayers=[],this._hoverlayer,this._hoverElements=[]};ac.prototype={constructor:ac,getType:function(){return"canvas"},isSingleCanvas:function(){return this._singleCanvas},getViewportRoot:function(){return this._domRoot},getViewportRootOffset:function(){var t=this.getViewportRoot();if(t)return{offsetLeft:t.offsetLeft||0,offsetTop:t.offsetTop||0}},refresh:function(t){var e=this.storage.getDisplayList(!0),i=this._zlevelList;this._paintList(e,t);for(var n=0;n<i.length;n++){var r=i[n],o=this._layers[r];!o.__builtin__&&o.refresh&&o.refresh()}return this.refreshHover(),this._progressiveLayers.length&&this._startProgessive(),this},addHover:function(t,e){if(!t.__hoverMir){var i=new t.constructor({style:t.style,shape:t.shape});((i.__from=t).__hoverMir=i).setStyle(e),this._hoverElements.push(i)}},removeHover:function(t){var e=t.__hoverMir,i=this._hoverElements,n=za.indexOf(i,e);0<=n&&i.splice(n,1),t.__hoverMir=null},clearHover:function(t){for(var e=this._hoverElements,i=0;i<e.length;i++){var n=e[i].__from;n&&(n.__hoverMir=null)}e.length=0},refreshHover:function(){var t=this._hoverElements,e=t.length,i=this._hoverlayer;if(i&&i.clear(),e){Rl(t,this.storage.displayableSortFunc),i||(i=this._hoverlayer=this.getLayer(1e5));var n={};i.ctx.save();for(var r=0;r<e;){var o=t[r],a=o.__from;a&&a.__zr?(r++,a.invisible||(o.transform=a.transform,o.invTransform=a.invTransform,o.__clipPaths=a.__clipPaths,this._doPaintEl(o,i,!0,n))):(t.splice(r,1),a.__hoverMir=null,e--)}i.ctx.restore()}},_startProgessive:function(){var e=this;if(e._furtherProgressive){var i=e._progressiveToken=+new Date;e._progress++,Kl(function t(){i===e._progressiveToken&&e.storage&&(e._doPaintList(e.storage.getDisplayList()),e._furtherProgressive?(e._progress++,Kl(t)):e._progressiveToken=-1)})}},_clearProgressive:function(){this._progressiveToken=-1,this._progress=0,za.each(this._progressiveLayers,function(t){t.__dirty&&t.clear()})},_paintList:function(t,e){null==e&&(e=!1),this._updateLayerStatus(t),this._clearProgressive(),this.eachBuiltinLayer(ic),this._doPaintList(t,e),this.eachBuiltinLayer(nc)},_doPaintList:function(t,e){var i,n,r,o,a,s,l=0,h=this._width,c=this._height,u=this._progress;function d(t){var e=r.dpr||1;r.save(),r.globalAlpha=1,r.shadowBlur=0,i.__dirty=!0,r.setTransform(1,0,0,1,0,0),r.drawImage(t.dom,0,0,h*e,c*e),r.restore()}for(var p=0,f=t.length;p<f;p++){var g=t[p],m=this._singleCanvas?0:g.zlevel,v=g.__frame;if(v<0&&a&&(d(a),a=null),n!==m&&(r&&r.restore(),o={},n=m,(i=this.getLayer(n)).__builtin__||rl("ZLevel "+n+" has been used by unkown layer "+i.id),(r=i.ctx).save(),i.__unusedCount=0,(i.__dirty||e)&&i.clear()),i.__dirty||e){if(0<=v){if(!a){if((a=this._progressiveLayers[Math.min(l++,4)]).ctx.save(),a.renderScope={},a&&a.__progress>a.__maxProgress){p=a.__nextIdxNotProg-1;continue}s=a.__progress,a.__dirty||(u=s),a.__progress=u+1}v===u&&this._doPaintEl(g,a,!0,a.renderScope)}else this._doPaintEl(g,i,e,o);g.__dirty=!1}}a&&d(a),r&&r.restore(),this._furtherProgressive=!1,za.each(this._progressiveLayers,function(t){t.__maxProgress>=t.__progress&&(this._furtherProgressive=!0)},this)},_doPaintEl:function(t,e,i,n){var r,o,a,s=e.ctx,l=t.transform;if((e.__dirty||i)&&!t.invisible&&0!==t.style.opacity&&(!l||l[0]||l[3])&&(!t.culling||(r=t,o=this._width,a=this._height,rc.copy(r.getBoundingRect()),r.transform&&rc.applyTransform(r.transform),oc.width=o,oc.height=a,rc.intersect(oc)))){var h=t.__clipPaths;(n.prevClipLayer!==e||function(t,e){if(t==e)return!1;if(!t||!e||t.length!==e.length)return!0;for(var i=0;i<t.length;i++)if(t[i]!==e[i])return!0}(h,n.prevElClipPaths))&&(n.prevElClipPaths&&(n.prevClipLayer.ctx.restore(),n.prevClipLayer=n.prevElClipPaths=null,n.prevEl=null),h&&(s.save(),function(t,e){for(var i=0;i<t.length;i++){var n=t[i];n.setTransform(e),e.beginPath(),n.buildPath(e,n.shape),e.clip(),n.restoreTransform(e)}}(h,s),n.prevClipLayer=e,n.prevElClipPaths=h)),t.beforeBrush&&t.beforeBrush(s),t.brush(s,n.prevEl||null),(n.prevEl=t).afterBrush&&t.afterBrush(s)}},getLayer:function(t){if(this._singleCanvas)return this._layers[0];var e=this._layers[t];return e||((e=new Jl("zr_"+t,this,this.dpr)).__builtin__=!0,this._layerConfig[t]&&za.merge(e,this._layerConfig[t],!0),this.insertLayer(t,e),e.initContext()),e},insertLayer:function(t,e){var i=this._layers,n=this._zlevelList,r=n.length,o=null,a=-1,s=this._domRoot;if(i[t])rl("ZLevel "+t+" has been used already");else if((l=e)&&(l.__builtin__||"function"==typeof l.resize&&"function"==typeof l.refresh)){var l;if(0<r&&t>n[0]){for(a=0;a<r-1&&!(n[a]<t&&n[a+1]>t);a++);o=i[n[a]]}if(n.splice(a+1,0,t),!(i[t]=e).virtual)if(o){var h=o.dom;h.nextSibling?s.insertBefore(e.dom,h.nextSibling):s.appendChild(e.dom)}else s.firstChild?s.insertBefore(e.dom,s.firstChild):s.appendChild(e.dom)}else rl("Layer of zlevel "+t+" is not valid")},eachLayer:function(t,e){var i,n,r=this._zlevelList;for(n=0;n<r.length;n++)i=r[n],t.call(e,this._layers[i],i)},eachBuiltinLayer:function(t,e){var i,n,r,o=this._zlevelList;for(r=0;r<o.length;r++)n=o[r],(i=this._layers[n]).__builtin__&&t.call(e,i,n)},eachOtherLayer:function(t,e){var i,n,r,o=this._zlevelList;for(r=0;r<o.length;r++)n=o[r],(i=this._layers[n]).__builtin__||t.call(e,i,n)},getLayers:function(){return this._layers},_updateLayerStatus:function(t){var e=this._layers,i=this._progressiveLayers,n={},r={};this.eachBuiltinLayer(function(t,e){n[e]=t.elCount,t.elCount=0,t.__dirty=!1}),za.each(i,function(t,e){r[e]=t.elCount,t.elCount=0,t.__dirty=!1});for(var o,a,s=0,l=0,h=0,c=t.length;h<c;h++){var u=t[h],d=e[this._singleCanvas?0:u.zlevel],p=u.progressive;if(d&&(d.elCount++,d.__dirty=d.__dirty||u.__dirty),0<=p){a!==p&&(a=p,l++);var f=u.__frame=l-1;if(!o){var g=Math.min(s,4);(o=i[g])||(o=i[g]=new Jl("progressive",this,this.dpr)).initContext(),o.__maxProgress=0}o.__dirty=o.__dirty||u.__dirty,o.elCount++,o.__maxProgress=Math.max(o.__maxProgress,f),o.__maxProgress>=o.__progress&&(d.__dirty=!0)}else u.__frame=-1,o&&(o.__nextIdxNotProg=h,s++,o=null)}o&&(s++,o.__nextIdxNotProg=h),this.eachBuiltinLayer(function(t,e){n[e]!==t.elCount&&(t.__dirty=!0)}),i.length=Math.min(s,5),za.each(i,function(t,e){r[e]!==t.elCount&&(u.__dirty=!0),t.__dirty&&(t.__progress=0)})},clear:function(){return this.eachBuiltinLayer(this._clearLayer),this},_clearLayer:function(t){t.clear()},configLayer:function(t,e){if(e){var i=this._layerConfig;i[t]?za.merge(i[t],e,!0):i[t]=e;var n=this._layers[t];n&&za.merge(n,i[t],!0)}},delLayer:function(t){var e=this._layers,i=this._zlevelList,n=e[t];n&&(n.dom.parentNode.removeChild(n.dom),delete e[t],i.splice(za.indexOf(i,t),1))},resize:function(e,i){var t=this._domRoot;t.style.display="none";var n=this._opts;if(null!=e&&(n.width=e),null!=i&&(n.height=i),e=this._getSize(0),i=this._getSize(1),t.style.display="",this._width!=e||i!=this._height){for(var r in t.style.width=e+"px",t.style.height=i+"px",this._layers)this._layers.hasOwnProperty(r)&&this._layers[r].resize(e,i);za.each(this._progressiveLayers,function(t){t.resize(e,i)}),this.refresh(!0)}return this._width=e,this._height=i,this},clearLayer:function(t){var e=this._layers[t];e&&e.clear()},dispose:function(){this.root.innerHTML="",this.root=this.storage=this._domRoot=this._layers=null},getRenderedCanvas:function(t){if(t=t||{},this._singleCanvas)return this._layers[0].dom;var s=new Jl("image",this,t.pixelRatio||this.dpr);s.initContext(),s.clearColor=t.backgroundColor,s.clear();var e,i=this.storage.getDisplayList(!0),n={},l=this;function r(t,e){var i,n=l._zlevelList;null==t&&(t=-1/0);for(var r=0;r<n.length;r++){var o=n[r],a=l._layers[o];if(!a.__builtin__&&t<o&&o<e){i=a;break}}i&&i.renderToCanvas&&(s.ctx.save(),i.renderToCanvas(s.ctx),s.ctx.restore())}for(var o=0;o<i.length;o++){var a=i[o];a.zlevel!==e&&(r(e,a.zlevel),e=a.zlevel),this._doPaintEl(a,s,!0,n)}return r(e,1/0),s.dom},getWidth:function(){return this._width},getHeight:function(){return this._height},_getSize:function(t){var e=this._opts,i=["width","height"][t],n=["clientWidth","clientHeight"][t],r=["paddingLeft","paddingTop"][t],o=["paddingRight","paddingBottom"][t];if(null!=e[i]&&"auto"!==e[i])return parseFloat(e[i]);var a=this.root,s=document.defaultView.getComputedStyle(a);return(a[n]||ec(s[i])||ec(a.style[i]))-(ec(s[r])||0)-(ec(s[o])||0)|0},pathToImage:function(t,e){e=e||this.dpr;var i=document.createElement("canvas"),n=i.getContext("2d"),r=t.getBoundingRect(),o=t.style,a=o.shadowBlur,s=o.shadowOffsetX,l=o.shadowOffsetY,h=o.hasStroke()?o.lineWidth:0,c=Math.max(h/2,-s+a),u=Math.max(h/2,s+a),d=Math.max(h/2,-l+a),p=Math.max(h/2,l+a),f=r.width+c+u,g=r.height+d+p;i.width=f*e,i.height=g*e,n.scale(e,e),n.clearRect(0,0,f,g),n.dpr=e;var m={position:t.position,rotation:t.rotation,scale:t.scale};t.position=[c-r.x,d-r.y],t.rotation=0,t.scale=[1,1],t.updateTransform(),t&&t.brush(n);var v=new $h({style:{x:0,y:0,image:i}});return null!=m.position&&(v.position=t.position=m.position),null!=m.rotation&&(v.rotation=t.rotation=m.rotation),null!=m.scale&&(v.scale=t.scale=m.scale),v}};var sc=ac,lc=qa,hc="undefined"!=typeof window&&!!window.addEventListener,cc=/^(?:mouse|pointer|contextmenu|drag|drop)|click/;function uc(t,e,i,n){return i=i||{},n||!ca.canvasSupported?dc(t,e,i):ca.browser.firefox&&null!=e.layerX&&e.layerX!==e.offsetX?(i.zrX=e.layerX,i.zrY=e.layerY):null!=e.offsetX?(i.zrX=e.offsetX,i.zrY=e.offsetY):dc(t,e,i),i}function dc(t,e,i){var n,r=(n=t).getBoundingClientRect?n.getBoundingClientRect():{left:0,top:0};i.zrX=e.clientX-r.left,i.zrY=e.clientY-r.top}var pc={Dispatcher:lc,clientToLocal:uc,normalizeEvent:function(t,e,i){if(null!=(e=e||window.event).zrX)return e;var n=e.type;if(n&&0<=n.indexOf("touch")){var r="touchend"!=n?e.targetTouches[0]:e.changedTouches[0];r&&uc(t,r,e,i)}else uc(t,e,e,i),e.zrDelta=e.wheelDelta?e.wheelDelta/120:-(e.detail||0)/3;var o=e.button;return null==e.which&&void 0!==o&&cc.test(e.type)&&(e.which=1&o?1:2&o?3:4&o?2:0),e},addEventListener:function(t,e,i){hc?t.addEventListener(e,i):t.attachEvent("on"+e,i)},removeEventListener:function(t,e,i){hc?t.removeEventListener(e,i):t.detachEvent("on"+e,i)},stop:hc?function(t){t.preventDefault(),t.stopPropagation(),t.cancelBubble=!0}:function(t){t.returnValue=!1,t.cancelBubble=!0},notLeftMouse:function(t){return 1<t.which}},fc=pc.Dispatcher,gc=function(t){t=t||{},this.stage=t.stage||{},this.onframe=t.onframe||function(){},this._clips=[],this._running=!1,this._time,this._pausedTime,this._pauseStart,this._paused=!1,fc.call(this)};gc.prototype={constructor:gc,addClip:function(t){this._clips.push(t)},addAnimator:function(t){t.animation=this;for(var e=t.getClips(),i=0;i<e.length;i++)this.addClip(e[i])},removeClip:function(t){var e=za.indexOf(this._clips,t);0<=e&&this._clips.splice(e,1)},removeAnimator:function(t){for(var e=t.getClips(),i=0;i<e.length;i++)this.removeClip(e[i]);t.animation=null},_update:function(){for(var t=(new Date).getTime()-this._pausedTime,e=t-this._time,i=this._clips,n=i.length,r=[],o=[],a=0;a<n;a++){var s=i[a],l=s.step(t,e);l&&(r.push(l),o.push(s))}for(a=0;a<n;)i[a]._needsRemove?(i[a]=i[n-1],i.pop(),n--):a++;n=r.length;for(a=0;a<n;a++)o[a].fire(r[a]);this._time=t,this.onframe(e),this.trigger("frame",e),this.stage.update&&this.stage.update()},_startLoop:function(){var e=this;this._running=!0,Kl(function t(){e._running&&(Kl(t),!e._paused&&e._update())})},start:function(){this._time=(new Date).getTime(),this._pausedTime=0,this._startLoop()},stop:function(){this._running=!1},pause:function(){this._paused||(this._pauseStart=(new Date).getTime(),this._paused=!0)},resume:function(){this._paused&&(this._pausedTime+=(new Date).getTime()-this._pauseStart,this._paused=!1)},clear:function(){this._clips=[]},animate:function(t,e){var i=new $s(t,(e=e||{}).loop,e.getter,e.setter);return this.addAnimator(i),i}},za.mixin(gc,fc);var mc=gc,vc=function(){this._track=[]};function yc(t){var e=t[1][0]-t[0][0],i=t[1][1]-t[0][1];return Math.sqrt(e*e+i*i)}vc.prototype={constructor:vc,recognize:function(t,e,i){return this._doTrack(t,e,i),this._recognize(t)},clear:function(){return this._track.length=0,this},_doTrack:function(t,e,i){var n=t.touches;if(n){for(var r={points:[],touches:[],target:e,event:t},o=0,a=n.length;o<a;o++){var s=n[o],l=pc.clientToLocal(i,s,{});r.points.push([l.zrX,l.zrY]),r.touches.push(s)}this._track.push(r)}},_recognize:function(t){for(var e in _c)if(_c.hasOwnProperty(e)){var i=_c[e](this._track,t);if(i)return i}}};var _c={pinch:function(t,e){var i=t.length;if(i){var n,r=(t[i-1]||{}).points,o=(t[i-2]||{}).points||r;if(o&&1<o.length&&r&&1<r.length){var a=yc(r)/yc(o);!isFinite(a)&&(a=1),e.pinchScale=a;var s=[((n=r)[0][0]+n[1][0])/2,(n[0][1]+n[1][1])/2];return e.pinchX=s[0],e.pinchY=s[1],{type:"pinch",target:t[0].target,event:e}}}}},xc=vc,wc=pc.addEventListener,bc=pc.removeEventListener,Mc=pc.normalizeEvent,Sc=["click","dblclick","mousewheel","mouseout","mouseup","mousedown","mousemove","contextmenu"],Tc=["touchstart","touchend","touchmove"],Cc={pointerdown:1,pointerup:1,pointermove:1,pointerout:1},Ac=za.map(Sc,function(t){var e=t.replace("mouse","pointer");return Cc[e]?e:t});function Ec(t){return"mousewheel"===t&&ca.browser.firefox?"DOMMouseScroll":t}function Pc(t,e,i){var n=t._gestureMgr;"start"===i&&n.clear();var r=n.recognize(e,t.handler.findHover(e.zrX,e.zrY,null).target,t.dom);if("end"===i&&n.clear(),r){var o=r.type;e.gestureEvent=o,t.handler.dispatchToElement({target:r.target},o,r.event)}}function Lc(t){t._touching=!0,clearTimeout(t._touchTimer),t._touchTimer=setTimeout(function(){t._touching=!1},700)}var Ic={mousemove:function(t){t=Mc(this.dom,t),this.trigger("mousemove",t)},mouseout:function(t){var e=(t=Mc(this.dom,t)).toElement||t.relatedTarget;if(e!=this.dom)for(;e&&9!=e.nodeType;){if(e===this.dom)return;e=e.parentNode}this.trigger("mouseout",t)},touchstart:function(t){(t=Mc(this.dom,t)).zrByTouch=!0,this._lastTouchMoment=new Date,Pc(this,t,"start"),Ic.mousemove.call(this,t),Ic.mousedown.call(this,t),Lc(this)},touchmove:function(t){(t=Mc(this.dom,t)).zrByTouch=!0,Pc(this,t,"change"),Ic.mousemove.call(this,t),Lc(this)},touchend:function(t){(t=Mc(this.dom,t)).zrByTouch=!0,Pc(this,t,"end"),Ic.mouseup.call(this,t),+new Date-this._lastTouchMoment<300&&Ic.click.call(this,t),Lc(this)},pointerdown:function(t){Ic.mousedown.call(this,t)},pointermove:function(t){Rc(t)||Ic.mousemove.call(this,t)},pointerup:function(t){Ic.mouseup.call(this,t)},pointerout:function(t){Rc(t)||Ic.mouseout.call(this,t)}};function Rc(t){var e=t.pointerType;return"pen"===e||"touch"===e}function Dc(i){var n;function t(t,e){za.each(t,function(t){wc(i,Ec(t),e._handlers[t])},e)}qa.call(this),this.dom=i,this._touching=!1,this._touchTimer,this._gestureMgr=new xc,this._handlers={},n=this,za.each(Tc,function(t){n._handlers[t]=za.bind(Ic[t],n)}),za.each(Ac,function(t){n._handlers[t]=za.bind(Ic[t],n)}),za.each(Sc,function(t){var e,i;n._handlers[t]=(e=Ic[t],i=n,function(){if(!i._touching)return e.apply(i,arguments)})}),ca.pointerEventsSupported?t(Ac,this):(ca.touchEventsSupported&&t(Tc,this),t(Sc,this))}za.each(["click","mousedown","mouseup","mousewheel","dblclick","contextmenu"],function(e){Ic[e]=function(t){t=Mc(this.dom,t),this.trigger(e,t)}});var Oc=Dc.prototype;Oc.dispose=function(){for(var t=Sc.concat(Tc),e=0;e<t.length;e++){var i=t[e];bc(this.dom,Ec(i),this._handlers[i])}},Oc.setCursor=function(t){this.dom.style.cursor=t||"default"},za.mixin(Dc,qa);var kc=Dc,zc=!ca.canvasSupported,Nc={canvas:sc},Bc={};var Fc=function(t,e,i){i=i||{},this.dom=e,this.id=t;var n=this,r=new kl,o=i.renderer;if(zc){if(!Nc.vml)throw new Error("You need to require 'zrender/vml/vml' to support IE8");o="vml"}else o&&Nc[o]||(o="canvas");var a=new Nc[o](e,r,i);this.storage=r,this.painter=a;var s=ca.node?null:new kc(a.getViewportRoot());this.handler=new ts(r,a,s,a.root),this.animation=new mc({stage:{update:za.bind(this.flush,this)}}),this.animation.start(),this._needsRefresh;var l=r.delFromStorage,h=r.addToStorage;r.delFromStorage=function(t){l.call(r,t),t&&t.removeSelfFromZr(n)},r.addToStorage=function(t){h.call(r,t),t.addSelfToZr(n)}};Fc.prototype={constructor:Fc,getId:function(){return this.id},add:function(t){this.storage.addRoot(t),this._needsRefresh=!0},remove:function(t){this.storage.delRoot(t),this._needsRefresh=!0},configLayer:function(t,e){this.painter.configLayer(t,e),this._needsRefresh=!0},refreshImmediately:function(){this._needsRefresh=!1,this.painter.refresh(),this._needsRefresh=!1},refresh:function(){this._needsRefresh=!0},flush:function(){this._needsRefresh&&this.refreshImmediately(),this._needsRefreshHover&&this.refreshHoverImmediately()},addHover:function(t,e){this.painter.addHover&&(this.painter.addHover(t,e),this.refreshHover())},removeHover:function(t){this.painter.removeHover&&(this.painter.removeHover(t),this.refreshHover())},clearHover:function(){this.painter.clearHover&&(this.painter.clearHover(),this.refreshHover())},refreshHover:function(){this._needsRefreshHover=!0},refreshHoverImmediately:function(){this._needsRefreshHover=!1,this.painter.refreshHover&&this.painter.refreshHover()},resize:function(t){t=t||{},this.painter.resize(t.width,t.height),this.handler.resize()},clearAnimation:function(){this.animation.clear()},getWidth:function(){return this.painter.getWidth()},getHeight:function(){return this.painter.getHeight()},pathToImage:function(t,e){return this.painter.pathToImage(t,e)},setCursorStyle:function(t){this.handler.setCursorStyle(t)},findHover:function(t,e){return this.handler.findHover(t,e)},on:function(t,e,i){this.handler.on(t,e,i)},off:function(t,e){this.handler.off(t,e)},trigger:function(t,e){this.handler.trigger(t,e)},clear:function(){this.storage.delRoot(),this.painter.clear()},dispose:function(){var t;this.animation.stop(),this.clear(),this.storage.dispose(),this.painter.dispose(),this.handler.dispose(),this.animation=this.storage=this.painter=this.handler=null,t=this.id,delete Bc[t]}};var Gc={version:"3.7.4",init:function(t,e){var i=new Fc(ha(),t,e);return Bc[i.id]=i},dispose:function(t){if(t)t.dispose();else{for(var e in Bc)Bc.hasOwnProperty(e)&&Bc[e].dispose();Bc={}}return this},getInstance:function(t){return Bc[t]},registerPainter:function(t,e){Nc[t]=e}};var Vc=/^(?:(\d{4})(?:[-\/](\d{1,2})(?:[-\/](\d{1,2})(?:[T ](\d{1,2})(?::(\d\d)(?::(\d\d)(?:[.,](\d+))?)?)?(Z|[\+\-]\d\d:?\d\d)?)?)?)?)?$/;function Hc(t){return Math.floor(Math.log(t)/Math.LN10)}var Uc={linearMap:function(t,e,i,n){var r=e[1]-e[0],o=i[1]-i[0];if(0===r)return 0===o?i[0]:(i[0]+i[1])/2;if(n)if(0<r){if(t<=e[0])return i[0];if(t>=e[1])return i[1]}else{if(t>=e[0])return i[0];if(t<=e[1])return i[1]}else{if(t===e[0])return i[0];if(t===e[1])return i[1]}return(t-e[0])/r*o+i[0]},parsePercent:function(t,e){switch(t){case"center":case"middle":t="50%";break;case"left":case"top":t="0%";break;case"right":case"bottom":t="100%"}return"string"==typeof t?(i=t,i.replace(/^\s+/,"").replace(/\s+$/,"")).match(/%$/)?parseFloat(t)/100*e:parseFloat(t):null==t?NaN:+t;var i},round:function(t,e,i){return null==e&&(e=10),e=Math.min(Math.max(0,e),20),t=(+t).toFixed(e),i?t:+t},asc:function(t){return t.sort(function(t,e){return t-e}),t},getPrecision:function(t){if(t=+t,isNaN(t))return 0;for(var e=1,i=0;Math.round(t*e)/e!==t;)e*=10,i++;return i},getPrecisionSafe:function(t){var e=t.toString(),i=e.indexOf("e");if(0<i){var n=+e.slice(i+1);return n<0?-n:0}var r=e.indexOf(".");return r<0?0:e.length-1-r},getPixelPrecision:function(t,e){var i=Math.log,n=Math.LN10,r=Math.floor(i(t[1]-t[0])/n),o=Math.round(i(Math.abs(e[1]-e[0]))/n),a=Math.min(Math.max(-r+o,0),20);return isFinite(a)?a:20},getPercentWithPrecision:function(t,e,i){if(!t[e])return 0;var n=za.reduce(t,function(t,e){return t+(isNaN(e)?0:e)},0);if(0===n)return 0;for(var r=Math.pow(10,i),o=za.map(t,function(t){return(isNaN(t)?0:t)/n*r*100}),a=100*r,s=za.map(o,function(t){return Math.floor(t)}),l=za.reduce(s,function(t,e){return t+e},0),h=za.map(o,function(t,e){return t-s[e]});l<a;){for(var c=Number.NEGATIVE_INFINITY,u=null,d=0,p=h.length;d<p;++d)h[d]>c&&(c=h[d],u=d);++s[u],h[u]=0,++l}return s[e]/r},MAX_SAFE_INTEGER:9007199254740991,remRadian:function(t){var e=2*Math.PI;return(t%e+e)%e},isRadianAroundZero:function(t){return-1e-4<t&&t<1e-4},parseDate:function(t){if(t instanceof Date)return t;if("string"==typeof t){var e=Vc.exec(t);if(!e)return new Date(NaN);if(e[8]){var i=+e[4]||0;return"Z"!==e[8].toUpperCase()&&(i-=e[8].slice(0,3)),new Date(Date.UTC(+e[1],+(e[2]||1)-1,+e[3]||1,i,+(e[5]||0),+e[6]||0,+e[7]||0))}return new Date(+e[1],+(e[2]||1)-1,+e[3]||1,+e[4]||0,+(e[5]||0),+e[6]||0,+e[7]||0)}return null==t?new Date(NaN):new Date(Math.round(t))},quantity:function(t){return Math.pow(10,Hc(t))},nice:function(t,e){var i=Hc(t),n=Math.pow(10,i),r=t/n;return t=(e?r<1.5?1:r<2.5?2:r<4?3:r<7?5:10:r<1?1:r<2?2:r<3?3:r<5?5:10)*n,-20<=i?+t.toFixed(i<0?-i:0):t},reformIntervals:function(t){t.sort(function(t,e){return function t(e,i,n){return e.interval[n]<i.interval[n]||e.interval[n]===i.interval[n]&&(e.close[n]-i.close[n]==(n?-1:1)||!n&&t(e,i,1))}(t,e,0)?-1:1});for(var e=-1/0,i=1,n=0;n<t.length;){for(var r=t[n].interval,o=t[n].close,a=0;a<2;a++)r[a]<=e&&(r[a]=e,o[a]=a?1:1-i),e=r[a],i=o[a];r[0]===r[1]&&o[0]*o[1]!=1?t.splice(n,1):n++}return t},isNumeric:function(t){return 0<=t-parseFloat(t)}};var Wc=za.normalizeCssArray;function jc(t){return String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}var Zc=["a","b","c","d","e","f","g"],Xc=function(t,e){return"{"+t+(null==e?"":e)+"}"};var qc=function(t){return t<10?"0"+t:t};var Yc={addCommas:function(t){return isNaN(t)?"-":(t=(t+"").split("."))[0].replace(/(\d{1,3})(?=(?:\d{3})+(?!\d))/g,"$1,")+(1<t.length?"."+t[1]:"")},toCamelCase:function(t,e){return t=(t||"").toLowerCase().replace(/-(.)/g,function(t,e){return e.toUpperCase()}),e&&t&&(t=t.charAt(0).toUpperCase()+t.slice(1)),t},normalizeCssArray:Wc,encodeHTML:jc,formatTpl:function(t,e,i){za.isArray(e)||(e=[e]);var n=e.length;if(!n)return"";for(var r=e[0].$vars||[],o=0;o<r.length;o++){var a=Zc[o],s=Xc(a,0);t=t.replace(Xc(a),i?jc(s):s)}for(var l=0;l<n;l++)for(var h=0;h<r.length;h++)s=e[l][r[h]],t=t.replace(Xc(Zc[h],l),i?jc(s):s);return t},formatTplSimple:function(i,t,n){return za.each(t,function(t,e){i=i.replace("{"+e+"}",n?jc(t):t)}),i},getTooltipMarker:function(t,e){return t?'<span style="display:inline-block;margin-right:5px;border-radius:10px;width:9px;height:9px;background-color:'+jc(t)+";"+(e||"")+'"></span>':""},formatTime:function(t,e,i){"week"!==t&&"month"!==t&&"quarter"!==t&&"half-year"!==t&&"year"!==t||(t="MM-dd\nyyyy");var n=Uc.parseDate(e),r=i?"UTC":"",o=n["get"+r+"FullYear"](),a=n["get"+r+"Month"]()+1,s=n["get"+r+"Date"](),l=n["get"+r+"Hours"](),h=n["get"+r+"Minutes"](),c=n["get"+r+"Seconds"]();return t=t.replace("MM",qc(a)).replace("M",a).replace("yyyy",o).replace("yy",o%100).replace("dd",qc(s)).replace("d",s).replace("hh",qc(l)).replace("h",l).replace("mm",qc(h)).replace("m",h).replace("ss",qc(c)).replace("s",c)},capitalFirst:function(t){return t?t.charAt(0).toUpperCase()+t.substr(1):t},truncateText:Sh.truncateText,getTextRect:Sh.getBoundingRect},Jc=".",Kc="___EC__COMPONENT__CONTAINER___",Qc="\0ec_\0";function $c(t){var e={main:"",sub:""};return t&&(t=t.split(Jc),e.main=t[0]||"",e.sub=t[1]||""),e}function tu(t,e){var i=za.slice(arguments,2);return this.superClass.prototype[e].apply(t,i)}function eu(t,e,i){return this.superClass.prototype[e].apply(t,i)}var iu={set:function(t,e,i){return t[Qc+e]=i},get:function(t,e){return t[Qc+e]},hasOwn:function(t,e){return t.hasOwnProperty(Qc+e)},parseClassType:$c,enableClassExtend:function(t,e){(t.$constructor=t).extend=function(t){var e=this,i=function(){t.$constructor?t.$constructor.apply(this,arguments):e.apply(this,arguments)};return za.extend(i.prototype,t),i.extend=this.extend,i.superCall=tu,i.superApply=eu,za.inherits(i,this),i.superClass=e,i}},enableClassManagement:function(i,t){t=t||{};var o={};if(i.registerClass=function(t,e){var i,n,r;return e&&(r=e,za.assert(/^[a-zA-Z0-9_]+([.][a-zA-Z0-9_]+)?$/.test(r),'componentType "'+r+'" illegal'),(e=$c(e)).sub?e.sub!==Kc&&((i=e,n=o[i.main],n&&n[Kc]||((n=o[i.main]={})[Kc]=!0),n)[e.sub]=t):o[e.main]=t),t},i.getClass=function(t,e,i){var n=o[t];if(n&&n[Kc]&&(n=e?n[e]:null),i&&!n)throw new Error(e?"Component "+t+"."+(e||"")+" not exists. Load it first.":t+".type should be specified.");return n},i.getClassesByMainType=function(t){t=$c(t);var i=[],e=o[t.main];return e&&e[Kc]?za.each(e,function(t,e){e!==Kc&&i.push(t)}):i.push(e),i},i.hasClass=function(t){return t=$c(t),!!o[t.main]},i.getAllClassMainTypes=function(){var i=[];return za.each(o,function(t,e){i.push(e)}),i},i.hasSubTypes=function(t){t=$c(t);var e=o[t.main];return e&&e[Kc]},i.parseClassType=$c,t.registerWhenExtend){var n=i.extend;n&&(i.extend=function(t){var e=n.call(this,t);return i.registerClass(e,t.type)})}return i},setReadOnly:function(t,e){}};var nu=function(s){for(var t=0;t<s.length;t++)s[t][1]||(s[t][1]=s[t][0]);return function(t,e,i){for(var n={},r=0;r<s.length;r++){var o=s[r][1];if(!(e&&0<=za.indexOf(e,o)||i&&za.indexOf(i,o)<0)){var a=t.getShallow(o);null!=a&&(n[s[r][0]]=a)}}return n}},ru=nu([["lineWidth","width"],["stroke","color"],["opacity"],["shadowBlur"],["shadowOffsetX"],["shadowOffsetY"],["shadowColor"]]),ou={getLineStyle:function(t){var e=ru(this,t),i=this.getLineDash(e.lineWidth);return i&&(e.lineDash=i),e},getLineDash:function(t){null==t&&(t=1);var e=this.get("type"),i=Math.max(t,2),n=4*t;return"solid"===e||null==e?null:"dashed"===e?[n,n]:[i,i]}},au=nu([["fill","color"],["shadowBlur"],["shadowOffsetX"],["shadowOffsetY"],["opacity"],["shadowColor"]]),su={getAreaStyle:function(t,e){return au(this,t,e)}},lu=Ha.create,hu=Ha.distSquare,cu=Math.pow,uu=Math.sqrt,du=1e-8,pu=uu(3),fu=lu(),gu=lu(),mu=lu();function vu(t){return-du<t&&t<du}function yu(t){return du<t||t<-du}function _u(t,e,i,n,r){var o=1-r;return o*o*(o*t+3*r*e)+r*r*(r*n+3*o*i)}function xu(t,e,i,n){var r=1-n;return r*(r*t+2*n*e)+n*n*i}var wu={cubicAt:_u,cubicDerivativeAt:function(t,e,i,n,r){var o=1-r;return 3*(((e-t)*o+2*(i-e)*r)*o+(n-i)*r*r)},cubicRootAt:function(t,e,i,n,r,o){var a=n+3*(e-i)-t,s=3*(i-2*e+t),l=3*(e-t),h=t-r,c=s*s-3*a*l,u=s*l-9*a*h,d=l*l-3*s*h,p=0;if(vu(c)&&vu(u))vu(s)?o[0]=0:0<=(S=-l/s)&&S<=1&&(o[p++]=S);else{var f=u*u-4*c*d;if(vu(f)){var g=u/c,m=-g/2;0<=(S=-s/a+g)&&S<=1&&(o[p++]=S),0<=m&&m<=1&&(o[p++]=m)}else if(0<f){var v=uu(f),y=c*s+1.5*a*(-u+v),_=c*s+1.5*a*(-u-v);0<=(S=(-s-((y=y<0?-cu(-y,1/3):cu(y,1/3))+(_=_<0?-cu(-_,1/3):cu(_,1/3))))/(3*a))&&S<=1&&(o[p++]=S)}else{var x=(2*c*s-3*a*u)/(2*uu(c*c*c)),w=Math.acos(x)/3,b=uu(c),M=Math.cos(w),S=(-s-2*b*M)/(3*a),T=(m=(-s+b*(M+pu*Math.sin(w)))/(3*a),(-s+b*(M-pu*Math.sin(w)))/(3*a));0<=S&&S<=1&&(o[p++]=S),0<=m&&m<=1&&(o[p++]=m),0<=T&&T<=1&&(o[p++]=T)}}return p},cubicExtrema:function(t,e,i,n,r){var o=6*i-12*e+6*t,a=9*e+3*n-3*t-9*i,s=3*e-3*t,l=0;if(vu(a))yu(o)&&0<=(c=-s/o)&&c<=1&&(r[l++]=c);else{var h=o*o-4*a*s;if(vu(h))r[0]=-o/(2*a);else if(0<h){var c,u=uu(h),d=(-o-u)/(2*a);0<=(c=(-o+u)/(2*a))&&c<=1&&(r[l++]=c),0<=d&&d<=1&&(r[l++]=d)}}return l},cubicSubdivide:function(t,e,i,n,r,o){var a=(e-t)*r+t,s=(i-e)*r+e,l=(n-i)*r+i,h=(s-a)*r+a,c=(l-s)*r+s,u=(c-h)*r+h;o[0]=t,o[1]=a,o[2]=h,o[3]=u,o[4]=u,o[5]=c,o[6]=l,o[7]=n},cubicProjectPoint:function(t,e,i,n,r,o,a,s,l,h,c){var u,d,p,f,g,m=.005,v=1/0;fu[0]=l,fu[1]=h;for(var y=0;y<1;y+=.05)gu[0]=_u(t,i,r,a,y),gu[1]=_u(e,n,o,s,y),(f=hu(fu,gu))<v&&(u=y,v=f);v=1/0;for(var _=0;_<32&&!(m<1e-4);_++)d=u-m,p=u+m,gu[0]=_u(t,i,r,a,d),gu[1]=_u(e,n,o,s,d),f=hu(gu,fu),0<=d&&f<v?(u=d,v=f):(mu[0]=_u(t,i,r,a,p),mu[1]=_u(e,n,o,s,p),g=hu(mu,fu),p<=1&&g<v?(u=p,v=g):m*=.5);return c&&(c[0]=_u(t,i,r,a,u),c[1]=_u(e,n,o,s,u)),uu(v)},quadraticAt:xu,quadraticDerivativeAt:function(t,e,i,n){return 2*((1-n)*(e-t)+n*(i-e))},quadraticRootAt:function(t,e,i,n,r){var o=t-2*e+i,a=2*(e-t),s=t-n,l=0;if(vu(o))yu(a)&&0<=(c=-s/a)&&c<=1&&(r[l++]=c);else{var h=a*a-4*o*s;if(vu(h))0<=(c=-a/(2*o))&&c<=1&&(r[l++]=c);else if(0<h){var c,u=uu(h),d=(-a-u)/(2*o);0<=(c=(-a+u)/(2*o))&&c<=1&&(r[l++]=c),0<=d&&d<=1&&(r[l++]=d)}}return l},quadraticExtremum:function(t,e,i){var n=t+i-2*e;return 0===n?.5:(t-e)/n},quadraticSubdivide:function(t,e,i,n,r){var o=(e-t)*n+t,a=(i-e)*n+e,s=(a-o)*n+o;r[0]=t,r[1]=o,r[2]=s,r[3]=s,r[4]=a,r[5]=i},quadraticProjectPoint:function(t,e,i,n,r,o,a,s,l){var h,c=.005,u=1/0;fu[0]=a,fu[1]=s;for(var d=0;d<1;d+=.05)gu[0]=xu(t,i,r,d),gu[1]=xu(e,n,o,d),(m=hu(fu,gu))<u&&(h=d,u=m);u=1/0;for(var p=0;p<32&&!(c<1e-4);p++){var f=h-c,g=h+c;gu[0]=xu(t,i,r,f),gu[1]=xu(e,n,o,f);var m=hu(gu,fu);if(0<=f&&m<u)h=f,u=m;else{mu[0]=xu(t,i,r,g),mu[1]=xu(e,n,o,g);var v=hu(mu,fu);g<=1&&v<u?(h=g,u=v):c*=.5}}return l&&(l[0]=xu(t,i,r,h),l[1]=xu(e,n,o,h)),uu(u)}},bu=Math.min,Mu=Math.max,Su=Math.sin,Tu=Math.cos,Cu=2*Math.PI,Au=Ha.create(),Eu=Ha.create(),Pu=Ha.create();var Lu=[],Iu=[];var Ru={fromPoints:function(t,e,i){if(0!==t.length){var n,r=t[0],o=r[0],a=r[0],s=r[1],l=r[1];for(n=1;n<t.length;n++)r=t[n],o=bu(o,r[0]),a=Mu(a,r[0]),s=bu(s,r[1]),l=Mu(l,r[1]);e[0]=o,e[1]=s,i[0]=a,i[1]=l}},fromLine:function(t,e,i,n,r,o){r[0]=bu(t,i),r[1]=bu(e,n),o[0]=Mu(t,i),o[1]=Mu(e,n)},fromCubic:function(t,e,i,n,r,o,a,s,l,h){var c,u=wu.cubicExtrema,d=wu.cubicAt,p=u(t,i,r,a,Lu);for(l[0]=1/0,l[1]=1/0,h[0]=-1/0,h[1]=-1/0,c=0;c<p;c++){var f=d(t,i,r,a,Lu[c]);l[0]=bu(f,l[0]),h[0]=Mu(f,h[0])}for(p=u(e,n,o,s,Iu),c=0;c<p;c++){var g=d(e,n,o,s,Iu[c]);l[1]=bu(g,l[1]),h[1]=Mu(g,h[1])}l[0]=bu(t,l[0]),h[0]=Mu(t,h[0]),l[0]=bu(a,l[0]),h[0]=Mu(a,h[0]),l[1]=bu(e,l[1]),h[1]=Mu(e,h[1]),l[1]=bu(s,l[1]),h[1]=Mu(s,h[1])},fromQuadratic:function(t,e,i,n,r,o,a,s){var l=wu.quadraticExtremum,h=wu.quadraticAt,c=Mu(bu(l(t,i,r),1),0),u=Mu(bu(l(e,n,o),1),0),d=h(t,i,r,c),p=h(e,n,o,u);a[0]=bu(t,r,d),a[1]=bu(e,o,p),s[0]=Mu(t,r,d),s[1]=Mu(e,o,p)},fromArc:function(t,e,i,n,r,o,a,s,l){var h=Ha.min,c=Ha.max,u=Math.abs(r-o);if(u%Cu<1e-4&&1e-4<u)return s[0]=t-i,s[1]=e-n,l[0]=t+i,void(l[1]=e+n);if(Au[0]=Tu(r)*i+t,Au[1]=Su(r)*n+e,Eu[0]=Tu(o)*i+t,Eu[1]=Su(o)*n+e,h(s,Au,Eu),c(l,Au,Eu),(r%=Cu)<0&&(r+=Cu),(o%=Cu)<0&&(o+=Cu),o<r&&!a?o+=Cu:r<o&&a&&(r+=Cu),a){var d=o;o=r,r=d}for(var p=0;p<o;p+=Math.PI/2)r<p&&(Pu[0]=Tu(p)*i+t,Pu[1]=Su(p)*n+e,h(s,Pu,s),c(l,Pu,l))}},Du=el.devicePixelRatio,Ou={M:1,L:2,C:3,Q:4,A:5,Z:6,R:7},ku=[],zu=[],Nu=[],Bu=[],Fu=Math.min,Gu=Math.max,Vu=Math.cos,Hu=Math.sin,Uu=Math.sqrt,Wu=Math.abs,ju="undefined"!=typeof Float32Array,Zu=function(t){this._saveData=!t,this._saveData&&(this.data=[]),this._ctx=null};Zu.prototype={constructor:Zu,_xi:0,_yi:0,_x0:0,_y0:0,_ux:0,_uy:0,_len:0,_lineDash:null,_dashOffset:0,_dashIdx:0,_dashSum:0,setScale:function(t,e){this._ux=Wu(1/Du/t)||0,this._uy=Wu(1/Du/e)||0},getContext:function(){return this._ctx},beginPath:function(t){return(this._ctx=t)&&t.beginPath(),t&&(this.dpr=t.dpr),this._saveData&&(this._len=0),this._lineDash&&(this._lineDash=null,this._dashOffset=0),this},moveTo:function(t,e){return this.addData(Ou.M,t,e),this._ctx&&this._ctx.moveTo(t,e),this._x0=t,this._y0=e,this._xi=t,this._yi=e,this},lineTo:function(t,e){var i=Wu(t-this._xi)>this._ux||Wu(e-this._yi)>this._uy||this._len<5;return this.addData(Ou.L,t,e),this._ctx&&i&&(this._needsDash()?this._dashedLineTo(t,e):this._ctx.lineTo(t,e)),i&&(this._xi=t,this._yi=e),this},bezierCurveTo:function(t,e,i,n,r,o){return this.addData(Ou.C,t,e,i,n,r,o),this._ctx&&(this._needsDash()?this._dashedBezierTo(t,e,i,n,r,o):this._ctx.bezierCurveTo(t,e,i,n,r,o)),this._xi=r,this._yi=o,this},quadraticCurveTo:function(t,e,i,n){return this.addData(Ou.Q,t,e,i,n),this._ctx&&(this._needsDash()?this._dashedQuadraticTo(t,e,i,n):this._ctx.quadraticCurveTo(t,e,i,n)),this._xi=i,this._yi=n,this},arc:function(t,e,i,n,r,o){return this.addData(Ou.A,t,e,i,i,n,r-n,0,o?0:1),this._ctx&&this._ctx.arc(t,e,i,n,r,o),this._xi=Vu(r)*i+t,this._yi=Hu(r)*i+t,this},arcTo:function(t,e,i,n,r){return this._ctx&&this._ctx.arcTo(t,e,i,n,r),this},rect:function(t,e,i,n){return this._ctx&&this._ctx.rect(t,e,i,n),this.addData(Ou.R,t,e,i,n),this},closePath:function(){this.addData(Ou.Z);var t=this._ctx,e=this._x0,i=this._y0;return t&&(this._needsDash()&&this._dashedLineTo(e,i),t.closePath()),this._xi=e,this._yi=i,this},fill:function(t){t&&t.fill(),this.toStatic()},stroke:function(t){t&&t.stroke(),this.toStatic()},setLineDash:function(t){if(t instanceof Array){this._lineDash=t;for(var e=this._dashIdx=0,i=0;i<t.length;i++)e+=t[i];this._dashSum=e}return this},setLineDashOffset:function(t){return this._dashOffset=t,this},len:function(){return this._len},setData:function(t){var e=t.length;this.data&&this.data.length==e||!ju||(this.data=new Float32Array(e));for(var i=0;i<e;i++)this.data[i]=t[i];this._len=e},appendPath:function(t){t instanceof Array||(t=[t]);for(var e=t.length,i=0,n=this._len,r=0;r<e;r++)i+=t[r].len();ju&&this.data instanceof Float32Array&&(this.data=new Float32Array(n+i));for(r=0;r<e;r++)for(var o=t[r].data,a=0;a<o.length;a++)this.data[n++]=o[a];this._len=n},addData:function(t){if(this._saveData){var e=this.data;this._len+arguments.length>e.length&&(this._expandData(),e=this.data);for(var i=0;i<arguments.length;i++)e[this._len++]=arguments[i];this._prevCmd=t}},_expandData:function(){if(!(this.data instanceof Array)){for(var t=[],e=0;e<this._len;e++)t[e]=this.data[e];this.data=t}},_needsDash:function(){return this._lineDash},_dashedLineTo:function(t,e){var i,n,r=this._dashSum,o=this._dashOffset,a=this._lineDash,s=this._ctx,l=this._xi,h=this._yi,c=t-l,u=e-h,d=Uu(c*c+u*u),p=l,f=h,g=a.length;for(o<0&&(o=r+o),p-=(o%=r)*(c/=d),f-=o*(u/=d);0<c&&p<=t||c<0&&t<=p||0==c&&(0<u&&f<=e||u<0&&e<=f);)p+=c*(i=a[n=this._dashIdx]),f+=u*i,this._dashIdx=(n+1)%g,0<c&&p<l||c<0&&l<p||0<u&&f<h||u<0&&h<f||s[n%2?"moveTo":"lineTo"](0<=c?Fu(p,t):Gu(p,t),0<=u?Fu(f,e):Gu(f,e));c=p-t,u=f-e,this._dashOffset=-Uu(c*c+u*u)},_dashedBezierTo:function(t,e,i,n,r,o){var a,s,l,h,c,u=this._dashSum,d=this._dashOffset,p=this._lineDash,f=this._ctx,g=this._xi,m=this._yi,v=wu.cubicAt,y=0,_=this._dashIdx,x=p.length,w=0;for(d<0&&(d=u+d),d%=u,a=0;a<1;a+=.1)s=v(g,t,i,r,a+.1)-v(g,t,i,r,a),l=v(m,e,n,o,a+.1)-v(m,e,n,o,a),y+=Uu(s*s+l*l);for(;_<x&&!(d<(w+=p[_]));_++);for(a=(w-d)/y;a<=1;)h=v(g,t,i,r,a),c=v(m,e,n,o,a),_%2?f.moveTo(h,c):f.lineTo(h,c),a+=p[_]/y,_=(_+1)%x;_%2!=0&&f.lineTo(r,o),s=r-h,l=o-c,this._dashOffset=-Uu(s*s+l*l)},_dashedQuadraticTo:function(t,e,i,n){var r=i,o=n;i=(i+2*t)/3,n=(n+2*e)/3,t=(this._xi+2*t)/3,e=(this._yi+2*e)/3,this._dashedBezierTo(t,e,i,n,r,o)},toStatic:function(){var t=this.data;t instanceof Array&&(t.length=this._len,ju&&(this.data=new Float32Array(t)))},getBoundingRect:function(){ku[0]=ku[1]=Nu[0]=Nu[1]=Number.MAX_VALUE,zu[0]=zu[1]=Bu[0]=Bu[1]=-Number.MAX_VALUE;for(var t=this.data,e=0,i=0,n=0,r=0,o=0;o<t.length;){var a=t[o++];switch(1==o&&(n=e=t[o],r=i=t[o+1]),a){case Ou.M:e=n=t[o++],i=r=t[o++],Nu[0]=n,Nu[1]=r,Bu[0]=n,Bu[1]=r;break;case Ou.L:Ru.fromLine(e,i,t[o],t[o+1],Nu,Bu),e=t[o++],i=t[o++];break;case Ou.C:Ru.fromCubic(e,i,t[o++],t[o++],t[o++],t[o++],t[o],t[o+1],Nu,Bu),e=t[o++],i=t[o++];break;case Ou.Q:Ru.fromQuadratic(e,i,t[o++],t[o++],t[o],t[o+1],Nu,Bu),e=t[o++],i=t[o++];break;case Ou.A:var s=t[o++],l=t[o++],h=t[o++],c=t[o++],u=t[o++],d=t[o++]+u,p=(t[o++],1-t[o++]);1==o&&(n=Vu(u)*h+s,r=Hu(u)*c+l),Ru.fromArc(s,l,h,c,u,d,p,Nu,Bu),e=Vu(d)*h+s,i=Hu(d)*c+l;break;case Ou.R:n=e=t[o++],r=i=t[o++];var f=t[o++],g=t[o++];Ru.fromLine(n,r,n+f,r+g,Nu,Bu);break;case Ou.Z:e=n,i=r}Ha.min(ku,ku,Nu),Ha.max(zu,zu,Bu)}return 0===o&&(ku[0]=ku[1]=zu[0]=zu[1]=0),new bl(ku[0],ku[1],zu[0]-ku[0],zu[1]-ku[1])},rebuildPath:function(t){for(var e,i,n,r,o,a,s=this.data,l=this._ux,h=this._uy,c=this._len,u=0;u<c;){var d=s[u++];switch(1==u&&(e=n=s[u],i=r=s[u+1]),d){case Ou.M:e=n=s[u++],i=r=s[u++],t.moveTo(n,r);break;case Ou.L:o=s[u++],a=s[u++],(Wu(o-n)>l||Wu(a-r)>h||u===c-1)&&(t.lineTo(o,a),n=o,r=a);break;case Ou.C:t.bezierCurveTo(s[u++],s[u++],s[u++],s[u++],s[u++],s[u++]),n=s[u-2],r=s[u-1];break;case Ou.Q:t.quadraticCurveTo(s[u++],s[u++],s[u++],s[u++]),n=s[u-2],r=s[u-1];break;case Ou.A:var p=s[u++],f=s[u++],g=s[u++],m=s[u++],v=s[u++],y=s[u++],_=s[u++],x=s[u++],w=m<g?g:m,b=m<g?1:g/m,M=m<g?m/g:1,S=v+y;.001<Math.abs(g-m)?(t.translate(p,f),t.rotate(_),t.scale(b,M),t.arc(0,0,w,v,S,1-x),t.scale(1/b,1/M),t.rotate(-_),t.translate(-p,-f)):t.arc(p,f,w,v,S,1-x),1==u&&(e=Vu(v)*g+p,i=Hu(v)*m+f),n=Vu(S)*g+p,r=Hu(S)*m+f;break;case Ou.R:e=n=s[u],i=r=s[u+1],t.rect(s[u++],s[u++],s[u++],s[u++]);break;case Ou.Z:t.closePath(),n=e,r=i}}}},Zu.CMD=Ou;var Xu=Zu;var qu={containStroke:function(t,e,i,n,r,o,a){if(0===r)return!1;var s=r,l=0;if(e+s<a&&n+s<a||a<e-s&&a<n-s||t+s<o&&i+s<o||o<t-s&&o<i-s)return!1;if(t===i)return Math.abs(o-t)<=s/2;var h=(l=(e-n)/(t-i))*o-a+(t*n-i*e)/(t-i);return h*h/(l*l+1)<=s/2*s/2}};var Yu={containStroke:function(t,e,i,n,r,o,a,s,l,h,c){if(0===l)return!1;var u=l;return!(e+u<c&&n+u<c&&o+u<c&&s+u<c||c<e-u&&c<n-u&&c<o-u&&c<s-u||t+u<h&&i+u<h&&r+u<h&&a+u<h||h<t-u&&h<i-u&&h<r-u&&h<a-u)&&wu.cubicProjectPoint(t,e,i,n,r,o,a,s,h,c,null)<=u/2}},Ju=wu.quadraticProjectPoint;var Ku={containStroke:function(t,e,i,n,r,o,a,s,l){if(0===a)return!1;var h=a;return!(e+h<l&&n+h<l&&o+h<l||l<e-h&&l<n-h&&l<o-h||t+h<s&&i+h<s&&r+h<s||s<t-h&&s<i-h&&s<r-h)&&Ju(t,e,i,n,r,o,s,l,null)<=h/2}},Qu=2*Math.PI;var $u={normalizeRadian:function(t){return(t%=Qu)<0&&(t+=Qu),t}},td=$u.normalizeRadian,ed=2*Math.PI;var id={containStroke:function(t,e,i,n,r,o,a,s,l){if(0===a)return!1;var h=a;s-=t,l-=e;var c=Math.sqrt(s*s+l*l);if(i<c-h||c+h<i)return!1;if(Math.abs(n-r)%ed<1e-4)return!0;if(o){var u=n;n=td(r),r=td(u)}else n=td(n),r=td(r);r<n&&(r+=ed);var d=Math.atan2(l,s);return d<0&&(d+=ed),n<=d&&d<=r||n<=d+ed&&d+ed<=r}};var nd=function(t,e,i,n,r,o){if(e<o&&n<o||o<e&&o<n)return 0;if(n===e)return 0;var a=n<e?1:-1,s=(o-e)/(n-e);return 1!==s&&0!==s||(a=n<e?.5:-.5),r<s*(i-t)+t?a:0},rd=$u.normalizeRadian,od=Xu.CMD,ad=2*Math.PI,sd=1e-4;var ld=[-1,-1,-1],hd=[-1,-1];function cd(t,e,i,n,r,o,a,s,l,h){if(e<h&&n<h&&o<h&&s<h||h<e&&h<n&&h<o&&h<s)return 0;var c,u=wu.cubicRootAt(e,n,o,s,h,ld);if(0===u)return 0;for(var d,p,f=0,g=-1,m=0;m<u;m++){var v=ld[m],y=0===v||1===v?.5:1;wu.cubicAt(t,i,r,a,v)<l||(g<0&&(g=wu.cubicExtrema(e,n,o,s,hd),hd[1]<hd[0]&&1<g&&(void 0,c=hd[0],hd[0]=hd[1],hd[1]=c),d=wu.cubicAt(e,n,o,s,hd[0]),1<g&&(p=wu.cubicAt(e,n,o,s,hd[1]))),2==g?v<hd[0]?f+=d<e?y:-y:v<hd[1]?f+=p<d?y:-y:f+=s<p?y:-y:v<hd[0]?f+=d<e?y:-y:f+=s<d?y:-y)}return f}function ud(t,e,i,n,r,o,a,s){if(e<s&&n<s&&o<s||s<e&&s<n&&s<o)return 0;var l=wu.quadraticRootAt(e,n,o,s,ld);if(0===l)return 0;var h=wu.quadraticExtremum(e,n,o);if(0<=h&&h<=1){for(var c=0,u=wu.quadraticAt(e,n,o,h),d=0;d<l;d++){var p=0===ld[d]||1===ld[d]?.5:1;wu.quadraticAt(t,i,r,ld[d])<a||(ld[d]<h?c+=u<e?p:-p:c+=o<u?p:-p)}return c}p=0===ld[0]||1===ld[0]?.5:1;return wu.quadraticAt(t,i,r,ld[0])<a?0:o<e?p:-p}function dd(t,e,i,n,r,o,a,s){if(i<(s-=e)||s<-i)return 0;var l=Math.sqrt(i*i-s*s);ld[0]=-l,ld[1]=l;var h=Math.abs(n-r);if(h<1e-4)return 0;if(h%ad<1e-4){r=ad;var c=o?1:-1;return a>=ld[n=0]+t&&a<=ld[1]+t?c:0}if(o){l=n;n=rd(r),r=rd(l)}else n=rd(n),r=rd(r);r<n&&(r+=ad);for(var u=0,d=0;d<2;d++){var p=ld[d];if(a<p+t){var f=Math.atan2(s,p);c=o?1:-1;f<0&&(f=ad+f),(n<=f&&f<=r||n<=f+ad&&f+ad<=r)&&(f>Math.PI/2&&f<1.5*Math.PI&&(c=-c),u+=c)}}return u}function pd(t,e,i,n,r){for(var o,a,s=0,l=0,h=0,c=0,u=0,d=0;d<t.length;){var p=t[d++];switch(p===od.M&&1<d&&(i||(s+=nd(l,h,c,u,n,r))),1==d&&(c=l=t[d],u=h=t[d+1]),p){case od.M:l=c=t[d++],h=u=t[d++];break;case od.L:if(i){if(qu.containStroke(l,h,t[d],t[d+1],e,n,r))return!0}else s+=nd(l,h,t[d],t[d+1],n,r)||0;l=t[d++],h=t[d++];break;case od.C:if(i){if(Yu.containStroke(l,h,t[d++],t[d++],t[d++],t[d++],t[d],t[d+1],e,n,r))return!0}else s+=cd(l,h,t[d++],t[d++],t[d++],t[d++],t[d],t[d+1],n,r)||0;l=t[d++],h=t[d++];break;case od.Q:if(i){if(Ku.containStroke(l,h,t[d++],t[d++],t[d],t[d+1],e,n,r))return!0}else s+=ud(l,h,t[d++],t[d++],t[d],t[d+1],n,r)||0;l=t[d++],h=t[d++];break;case od.A:var f=t[d++],g=t[d++],m=t[d++],v=t[d++],y=t[d++],_=t[d++],x=(t[d++],1-t[d++]),w=Math.cos(y)*m+f,b=Math.sin(y)*v+g;1<d?s+=nd(l,h,w,b,n,r):(c=w,u=b);var M=(n-f)*v/m+f;if(i){if(id.containStroke(f,g,v,y,y+_,x,e,M,r))return!0}else s+=dd(f,g,v,y,y+_,x,M,r);l=Math.cos(y+_)*m+f,h=Math.sin(y+_)*v+g;break;case od.R:c=l=t[d++],u=h=t[d++];w=c+t[d++],b=u+t[d++];if(i){if(qu.containStroke(c,u,w,u,e,n,r)||qu.containStroke(w,u,w,b,e,n,r)||qu.containStroke(w,b,c,b,e,n,r)||qu.containStroke(c,b,c,u,e,n,r))return!0}else s+=nd(w,u,w,b,n,r),s+=nd(c,b,c,u,n,r);break;case od.Z:if(i){if(qu.containStroke(l,h,c,u,e,n,r))return!0}else s+=nd(l,h,c,u,n,r);l=c,h=u}}return i||(o=h,a=u,Math.abs(o-a)<sd)||(s+=nd(l,h,c,u,n,r)||0),0!==s}var fd={contain:function(t,e,i){return pd(t,0,!1,e,i)},containStroke:function(t,e,i,n){return pd(t,e,!0,i,n)}},gd=jl.prototype.getCanvasPattern,md=Math.abs,vd=new Xu(!0);function yd(t){Kh.call(this,t),this.path=null}yd.prototype={constructor:yd,type:"path",__dirtyPath:!0,strokeContainThreshold:5,brush:function(t,e){var i,n=this.style,r=this.path||vd,o=n.hasStroke(),a=n.hasFill(),s=n.fill,l=n.stroke,h=a&&!!s.colorStops,c=o&&!!l.colorStops,u=a&&!!s.image,d=o&&!!l.image;(n.bind(t,this,e),this.setTransform(t),this.__dirty)&&(h&&(i=i||this.getBoundingRect(),this._fillGradient=n.getGradient(t,s,i)),c&&(i=i||this.getBoundingRect(),this._strokeGradient=n.getGradient(t,l,i)));h?t.fillStyle=this._fillGradient:u&&(t.fillStyle=gd.call(s,t)),c?t.strokeStyle=this._strokeGradient:d&&(t.strokeStyle=gd.call(l,t));var p=n.lineDash,f=n.lineDashOffset,g=!!t.setLineDash,m=this.getGlobalScale();r.setScale(m[0],m[1]),this.__dirtyPath||p&&!g&&o?(r.beginPath(t),p&&!g&&(r.setLineDash(p),r.setLineDashOffset(f)),this.buildPath(r,this.shape,!1),this.path&&(this.__dirtyPath=!1)):(t.beginPath(),this.path.rebuildPath(t)),a&&r.fill(t),p&&g&&(t.setLineDash(p),t.lineDashOffset=f),o&&r.stroke(t),p&&g&&t.setLineDash([]),this.restoreTransform(t),null!=n.text&&this.drawRectText(t,this.getBoundingRect())},buildPath:function(t,e,i){},createPathProxy:function(){this.path=new Xu},getBoundingRect:function(){var t=this._rect,e=this.style,i=!t;if(i){var n=this.path;n||(n=this.path=new Xu),this.__dirtyPath&&(n.beginPath(),this.buildPath(n,this.shape,!1)),t=n.getBoundingRect()}if(this._rect=t,e.hasStroke()){var r=this._rectWithStroke||(this._rectWithStroke=t.clone());if(this.__dirty||i){r.copy(t);var o=e.lineWidth,a=e.strokeNoScale?this.getLineScale():1;e.hasFill()||(o=Math.max(o,this.strokeContainThreshold||4)),1e-10<a&&(r.width+=o/a,r.height+=o/a,r.x-=o/a/2,r.y-=o/a/2)}return r}return t},contain:function(t,e){var i=this.transformCoordToLocal(t,e),n=this.getBoundingRect(),r=this.style;if(t=i[0],e=i[1],n.contain(t,e)){var o=this.path.data;if(r.hasStroke()){var a=r.lineWidth,s=r.strokeNoScale?this.getLineScale():1;if(1e-10<s&&(r.hasFill()||(a=Math.max(a,this.strokeContainThreshold)),fd.containStroke(o,a/s,t,e)))return!0}if(r.hasFill())return fd.contain(o,t,e)}return!1},dirty:function(t){null==t&&(t=!0),t&&(this.__dirtyPath=t,this._rect=null),this.__dirty=!0,this.__zr&&this.__zr.refresh(),this.__clipTarget&&this.__clipTarget.dirty()},animateShape:function(t){return this.animate("shape",t)},attrKV:function(t,e){"shape"===t?(this.setShape(e),this.__dirtyPath=!0,this._rect=null):Kh.prototype.attrKV.call(this,t,e)},setShape:function(t,e){var i=this.shape;if(i){if(za.isObject(t))for(var n in t)t.hasOwnProperty(n)&&(i[n]=t[n]);else i[t]=e;this.dirty(!0)}return this},getLineScale:function(){var t=this.transform;return t&&1e-10<md(t[0]-1)&&1e-10<md(t[3]-1)?Math.sqrt(md(t[0]*t[3]-t[2]*t[1])):1}},yd.extend=function(r){var t=function(t){yd.call(this,t),r.style&&this.style.extendFrom(r.style,!1);var e=r.shape;if(e){this.shape=this.shape||{};var i=this.shape;for(var n in e)!i.hasOwnProperty(n)&&e.hasOwnProperty(n)&&(i[n]=e[n])}r.init&&r.init.call(this,t)};for(var e in za.inherits(t,yd),r)"style"!==e&&"shape"!==e&&(t.prototype[e]=r[e]);return t},za.inherits(yd,Kh);var _d=yd,xd=Ha.applyTransform,wd=Xu.CMD,bd=[[],[],[]],Md=Math.sqrt,Sd=Math.atan2;var Td=function(t,e){var i,n,r,o,a,s=t.data,l=wd.M,h=wd.C,c=wd.L,u=wd.R,d=wd.A,p=wd.Q;for(o=r=0;r<s.length;){switch(i=s[r++],o=r,n=0,i){case l:case c:n=1;break;case h:n=3;break;case p:n=2;break;case d:var f=e[4],g=e[5],m=Md(e[0]*e[0]+e[1]*e[1]),v=Md(e[2]*e[2]+e[3]*e[3]),y=Sd(-e[1]/v,e[0]/m);s[r]*=m,s[r++]+=f,s[r]*=v,s[r++]+=g,s[r++]*=m,s[r++]*=v,s[r++]+=y,s[r++]+=y,o=r+=2;break;case u:_[0]=s[r++],_[1]=s[r++],xd(_,_,e),s[o++]=_[0],s[o++]=_[1],_[0]+=s[r++],_[1]+=s[r++],xd(_,_,e),s[o++]=_[0],s[o++]=_[1]}for(a=0;a<n;a++){var _;(_=bd[a])[0]=s[r++],_[1]=s[r++],xd(_,_,e),s[o++]=_[0],s[o++]=_[1]}}},Cd=["m","M","l","L","v","V","h","H","z","Z","c","C","q","Q","t","T","s","S","a","A"],Ad=Math.sqrt,Ed=Math.sin,Pd=Math.cos,Ld=Math.PI,Id=function(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])},Rd=function(t,e){return(t[0]*e[0]+t[1]*e[1])/(Id(t)*Id(e))},Dd=function(t,e){return(t[0]*e[1]<t[1]*e[0]?-1:1)*Math.acos(Rd(t,e))};function Od(t,e,i,n,r,o,a,s,l,h,c){var u=l*(Ld/180),d=Pd(u)*(t-i)/2+Ed(u)*(e-n)/2,p=-1*Ed(u)*(t-i)/2+Pd(u)*(e-n)/2,f=d*d/(a*a)+p*p/(s*s);1<f&&(a*=Ad(f),s*=Ad(f));var g=(r===o?-1:1)*Ad((a*a*(s*s)-a*a*(p*p)-s*s*(d*d))/(a*a*(p*p)+s*s*(d*d)))||0,m=g*a*p/s,v=g*-s*d/a,y=(t+i)/2+Pd(u)*m-Ed(u)*v,_=(e+n)/2+Ed(u)*m+Pd(u)*v,x=Dd([1,0],[(d-m)/a,(p-v)/s]),w=[(d-m)/a,(p-v)/s],b=[(-1*d-m)/a,(-1*p-v)/s],M=Dd(w,b);Rd(w,b)<=-1&&(M=Ld),1<=Rd(w,b)&&(M=0),0===o&&0<M&&(M-=2*Ld),1===o&&M<0&&(M+=2*Ld),c.addData(h,y,_,a,s,x,M,u,o)}function kd(t,e){var i=function(t){if(!t)return[];var e,i=t.replace(/-/g," -").replace(/  /g," ").replace(/ /g,",").replace(/,,/g,",");for(e=0;e<Cd.length;e++)i=i.replace(new RegExp(Cd[e],"g"),"|"+Cd[e]);var n,r=i.split("|"),o=0,a=0,s=new Xu,l=Xu.CMD;for(e=1;e<r.length;e++){var h,c=r[e],u=c.charAt(0),d=0,p=c.slice(1).replace(/e,-/g,"e-").split(",");0<p.length&&""===p[0]&&p.shift();for(var f=0;f<p.length;f++)p[f]=parseFloat(p[f]);for(;d<p.length&&!isNaN(p[d])&&!isNaN(p[0]);){var g,m,v,y,_,x,w,b=o,M=a;switch(u){case"l":o+=p[d++],a+=p[d++],h=l.L,s.addData(h,o,a);break;case"L":o=p[d++],a=p[d++],h=l.L,s.addData(h,o,a);break;case"m":o+=p[d++],a+=p[d++],h=l.M,s.addData(h,o,a),u="l";break;case"M":o=p[d++],a=p[d++],h=l.M,s.addData(h,o,a),u="L";break;case"h":o+=p[d++],h=l.L,s.addData(h,o,a);break;case"H":o=p[d++],h=l.L,s.addData(h,o,a);break;case"v":a+=p[d++],h=l.L,s.addData(h,o,a);break;case"V":a=p[d++],h=l.L,s.addData(h,o,a);break;case"C":h=l.C,s.addData(h,p[d++],p[d++],p[d++],p[d++],p[d++],p[d++]),o=p[d-2],a=p[d-1];break;case"c":h=l.C,s.addData(h,p[d++]+o,p[d++]+a,p[d++]+o,p[d++]+a,p[d++]+o,p[d++]+a),o+=p[d-2],a+=p[d-1];break;case"S":g=o,m=a;var S=s.len(),T=s.data;n===l.C&&(g+=o-T[S-4],m+=a-T[S-3]),h=l.C,b=p[d++],M=p[d++],o=p[d++],a=p[d++],s.addData(h,g,m,b,M,o,a);break;case"s":g=o,m=a,S=s.len(),T=s.data,n===l.C&&(g+=o-T[S-4],m+=a-T[S-3]),h=l.C,b=o+p[d++],M=a+p[d++],o+=p[d++],a+=p[d++],s.addData(h,g,m,b,M,o,a);break;case"Q":b=p[d++],M=p[d++],o=p[d++],a=p[d++],h=l.Q,s.addData(h,b,M,o,a);break;case"q":b=p[d++]+o,M=p[d++]+a,o+=p[d++],a+=p[d++],h=l.Q,s.addData(h,b,M,o,a);break;case"T":g=o,m=a,S=s.len(),T=s.data,n===l.Q&&(g+=o-T[S-4],m+=a-T[S-3]),o=p[d++],a=p[d++],h=l.Q,s.addData(h,g,m,o,a);break;case"t":g=o,m=a,S=s.len(),T=s.data,n===l.Q&&(g+=o-T[S-4],m+=a-T[S-3]),o+=p[d++],a+=p[d++],h=l.Q,s.addData(h,g,m,o,a);break;case"A":v=p[d++],y=p[d++],_=p[d++],x=p[d++],w=p[d++],Od(b=o,M=a,o=p[d++],a=p[d++],x,w,v,y,_,h=l.A,s);break;case"a":v=p[d++],y=p[d++],_=p[d++],x=p[d++],w=p[d++],Od(b=o,M=a,o+=p[d++],a+=p[d++],x,w,v,y,_,h=l.A,s)}}"z"!==u&&"Z"!==u||(h=l.Z,s.addData(h)),n=h}return s.toStatic(),s}(t);return(e=e||{}).buildPath=function(t){if(t.setData){t.setData(i.data),(e=t.getContext())&&t.rebuildPath(e)}else{var e=t;i.rebuildPath(e)}},e.applyTransform=function(t){Td(i,t),this.dirty(!0)},e}var zd={createFromString:function(t,e){return new _d(kd(t,e))},extendFromString:function(t,e){return _d.extend(kd(t,e))},mergePath:function(t,e){for(var i=[],n=t.length,r=0;r<n;r++){var o=t[r];o.path||o.createPathProxy(),o.__dirtyPath&&o.buildPath(o.path,o.shape,!0),i.push(o.path)}var a=new _d(e);return a.createPathProxy(),a.buildPath=function(t){t.appendPath(i);var e=t.getContext();e&&t.rebuildPath(e)},a}},Nd=function(t){Kh.call(this,t)};Nd.prototype={constructor:Nd,type:"text",brush:function(t,e){var i=this.style;this.__dirty&&Zh.normalizeTextStyle(i,!0),i.fill=i.stroke=i.shadowBlur=i.shadowColor=i.shadowOffsetX=i.shadowOffsetY=null;var n=i.text;null!=n&&(n+=""),i.bind(t,this,e),Zh.needDrawText(n,i)&&(this.setTransform(t),Zh.renderText(this,t,n,i),this.restoreTransform(t))},getBoundingRect:function(){var t=this.style;if(this.__dirty&&Zh.normalizeTextStyle(t,!0),!this._rect){var e=t.text;null!=e?e+="":e="";var i=Sh.getBoundingRect(t.text+"",t.font,t.textAlign,t.textVerticalAlign,t.textPadding,t.rich);if(i.x+=t.x||0,i.y+=t.y||0,Zh.getStroke(t.textStroke,t.textStrokeWidth)){var n=t.textStrokeWidth;i.x-=n/2,i.y-=n/2,i.width+=n,i.height+=n}this._rect=i}return this._rect}},za.inherits(Nd,Kh);var Bd=Nd,Fd=_d.extend({type:"circle",shape:{cx:0,cy:0,r:0},buildPath:function(t,e,i){i&&t.moveTo(e.cx+e.r,e.cy),t.arc(e.cx,e.cy,e.r,0,2*Math.PI,!0)}}),Gd=[["shadowBlur",0],["shadowColor","#000"],["shadowOffsetX",0],["shadowOffsetY",0]];var Vd=function(l){return ca.browser.ie&&11<=ca.browser.version?function(){var t,e=this.__clipPaths,i=this.style;if(e)for(var n=0;n<e.length;n++){var r=e[n],o=r&&r.shape,a=r&&r.type;if(o&&("sector"===a&&o.startAngle===o.endAngle||"rect"===a&&(!o.width||!o.height))){for(var s=0;s<Gd.length;s++)Gd[s][2]=i[Gd[s][0]],i[Gd[s][0]]=Gd[s][1];t=!0;break}}if(l.apply(this,arguments),t)for(s=0;s<Gd.length;s++)i[Gd[s][0]]=Gd[s][2]}:l},Hd=_d.extend({type:"sector",shape:{cx:0,cy:0,r0:0,r:0,startAngle:0,endAngle:2*Math.PI,clockwise:!0},brush:Vd(_d.prototype.brush),buildPath:function(t,e){var i=e.cx,n=e.cy,r=Math.max(e.r0||0,0),o=Math.max(e.r,0),a=e.startAngle,s=e.endAngle,l=e.clockwise,h=Math.cos(a),c=Math.sin(a);t.moveTo(h*r+i,c*r+n),t.lineTo(h*o+i,c*o+n),t.arc(i,n,o,a,s,!l),t.lineTo(Math.cos(s)*r+i,Math.sin(s)*r+n),0!==r&&t.arc(i,n,r,s,a,l),t.closePath()}}),Ud=_d.extend({type:"ring",shape:{cx:0,cy:0,r:0,r0:0},buildPath:function(t,e){var i=e.cx,n=e.cy,r=2*Math.PI;t.moveTo(i+e.r,n),t.arc(i,n,e.r,0,r,!1),t.moveTo(i+e.r0,n),t.arc(i,n,e.r0,0,r,!0)}}),Wd=Ha.distance;function jd(t,e,i,n,r,o,a){var s=.5*(i-t),l=.5*(n-e);return(2*(e-i)+s+l)*a+(-3*(e-i)-2*s-l)*o+s*r+e}var Zd=function(t,e){for(var i=t.length,n=[],r=0,o=1;o<i;o++)r+=Wd(t[o-1],t[o]);var a=r/2;for(a=a<i?i:a,o=0;o<a;o++){var s,l,h,c=o/(a-1)*(e?i:i-1),u=Math.floor(c),d=c-u,p=t[u%i];e?(s=t[(u-1+i)%i],l=t[(u+1)%i],h=t[(u+2)%i]):(s=t[0===u?u:u-1],l=t[i-2<u?i-1:u+1],h=t[i-3<u?i-1:u+2]);var f=d*d,g=d*f;n.push([jd(s[0],p[0],l[0],h[0],d,f,g),jd(s[1],p[1],l[1],h[1],d,f,g)])}return n},Xd=Ha.min,qd=Ha.max,Yd=Ha.scale,Jd=Ha.distance,Kd=Ha.add,Qd=Ha.clone,$d=Ha.sub;var tp=function(t,e,i,n){var r,o,a,s,l=[],h=[],c=[],u=[];if(n){a=[1/0,1/0],s=[-1/0,-1/0];for(var d=0,p=t.length;d<p;d++)Xd(a,a,t[d]),qd(s,s,t[d]);Xd(a,a,n[0]),qd(s,s,n[1])}for(d=0,p=t.length;d<p;d++){var f=t[d];if(i)r=t[d?d-1:p-1],o=t[(d+1)%p];else{if(0===d||d===p-1){l.push(Qd(t[d]));continue}r=t[d-1],o=t[d+1]}$d(h,o,r),Yd(h,h,e);var g=Jd(f,r),m=Jd(f,o),v=g+m;0!==v&&(g/=v,m/=v),Yd(c,h,-g),Yd(u,h,m);var y=Kd([],f,c),_=Kd([],f,u);n&&(qd(y,y,a),Xd(y,y,s),qd(_,_,a),Xd(_,_,s)),l.push(y),l.push(_)}return i&&l.push(l.shift()),l};var ep={buildPath:function(t,e,i){var n=e.points,r=e.smooth;if(n&&2<=n.length){if(r&&"spline"!==r){var o=tp(n,r,i,e.smoothConstraint);t.moveTo(n[0][0],n[0][1]);for(var a=n.length,s=0;s<(i?a:a-1);s++){var l=o[2*s],h=o[2*s+1],c=n[(s+1)%a];t.bezierCurveTo(l[0],l[1],h[0],h[1],c[0],c[1])}}else{"spline"===r&&(n=Zd(n,i)),t.moveTo(n[0][0],n[0][1]),s=1;for(var u=n.length;s<u;s++)t.lineTo(n[s][0],n[s][1])}i&&t.closePath()}}},ip=_d.extend({type:"polygon",shape:{points:null,smooth:!1,smoothConstraint:null},buildPath:function(t,e){ep.buildPath(t,e,!0)}}),np=_d.extend({type:"polyline",shape:{points:null,smooth:!1,smoothConstraint:null},style:{stroke:"#000",fill:null},buildPath:function(t,e){ep.buildPath(t,e,!1)}}),rp=_d.extend({type:"rect",shape:{r:0,x:0,y:0,width:0,height:0},buildPath:function(t,e){var i=e.x,n=e.y,r=e.width,o=e.height;e.r?Th.buildPath(t,e):t.rect(i,n,r,o),t.closePath()}}),op=_d.extend({type:"line",shape:{x1:0,y1:0,x2:0,y2:0,percent:1},style:{stroke:"#000",fill:null},buildPath:function(t,e){var i=e.x1,n=e.y1,r=e.x2,o=e.y2,a=e.percent;0!==a&&(t.moveTo(i,n),a<1&&(r=i*(1-a)+r*a,o=n*(1-a)+o*a),t.lineTo(r,o))},pointAt:function(t){var e=this.shape;return[e.x1*(1-t)+e.x2*t,e.y1*(1-t)+e.y2*t]}}),ap=wu.quadraticSubdivide,sp=wu.cubicSubdivide,lp=wu.quadraticAt,hp=wu.cubicAt,cp=wu.quadraticDerivativeAt,up=wu.cubicDerivativeAt,dp=[];function pp(t,e,i){var n=t.cpx2,r=t.cpy2;return null===n||null===r?[(i?up:hp)(t.x1,t.cpx1,t.cpx2,t.x2,e),(i?up:hp)(t.y1,t.cpy1,t.cpy2,t.y2,e)]:[(i?cp:lp)(t.x1,t.cpx1,t.x2,e),(i?cp:lp)(t.y1,t.cpy1,t.y2,e)]}var fp=_d.extend({type:"bezier-curve",shape:{x1:0,y1:0,x2:0,y2:0,cpx1:0,cpy1:0,percent:1},style:{stroke:"#000",fill:null},buildPath:function(t,e){var i=e.x1,n=e.y1,r=e.x2,o=e.y2,a=e.cpx1,s=e.cpy1,l=e.cpx2,h=e.cpy2,c=e.percent;0!==c&&(t.moveTo(i,n),null==l||null==h?(c<1&&(ap(i,a,r,c,dp),a=dp[1],r=dp[2],ap(n,s,o,c,dp),s=dp[1],o=dp[2]),t.quadraticCurveTo(a,s,r,o)):(c<1&&(sp(i,a,l,r,c,dp),a=dp[1],l=dp[2],r=dp[3],sp(n,s,h,o,c,dp),s=dp[1],h=dp[2],o=dp[3]),t.bezierCurveTo(a,s,l,h,r,o)))},pointAt:function(t){return pp(this.shape,t,!1)},tangentAt:function(t){var e=pp(this.shape,t,!0);return Ha.normalize(e,e)}}),gp=_d.extend({type:"arc",shape:{cx:0,cy:0,r:0,startAngle:0,endAngle:2*Math.PI,clockwise:!0},style:{stroke:"#000",fill:null},buildPath:function(t,e){var i=e.cx,n=e.cy,r=Math.max(e.r,0),o=e.startAngle,a=e.endAngle,s=e.clockwise,l=Math.cos(o),h=Math.sin(o);t.moveTo(l*r+i,h*r+n),t.arc(i,n,r,o,a,!s)}}),mp=_d.extend({type:"compound",shape:{paths:null},_updatePathDirty:function(){for(var t=this.__dirtyPath,e=this.shape.paths,i=0;i<e.length;i++)t=t||e[i].__dirtyPath;this.__dirtyPath=t,this.__dirty=this.__dirty||t},beforeBrush:function(){this._updatePathDirty();for(var t=this.shape.paths||[],e=this.getGlobalScale(),i=0;i<t.length;i++)t[i].path||t[i].createPathProxy(),t[i].path.setScale(e[0],e[1])},buildPath:function(t,e){for(var i=e.paths||[],n=0;n<i.length;n++)i[n].buildPath(t,i[n].shape,!0)},afterBrush:function(){for(var t=this.shape.paths||[],e=0;e<t.length;e++)t[e].__dirtyPath=!1},getBoundingRect:function(){return this._updatePathDirty(),_d.prototype.getBoundingRect.call(this)}}),vp=function(t){this.colorStops=t||[]};vp.prototype={constructor:vp,addColorStop:function(t,e){this.colorStops.push({offset:t,color:e})}};var yp=vp,_p=function(t,e,i,n,r,o){this.x=null==t?0:t,this.y=null==e?0:e,this.x2=null==i?1:i,this.y2=null==n?0:n,this.type="linear",this.global=o||!1,yp.call(this,r)};_p.prototype={constructor:_p},za.inherits(_p,yp);var xp=_p,wp=function(t,e,i,n,r){this.x=null==t?.5:t,this.y=null==e?.5:e,this.r=null==i?.5:i,this.type="radial",this.global=r||!1,yp.call(this,n)};wp.prototype={constructor:wp},za.inherits(wp,yp);var bp=$h,Mp=Sl,Sp=Bd,Tp=Fd,Cp=Hd,Ap=Ud,Ep=ip,Pp=np,Lp=rp,Ip=op,Rp=fp,Dp=gp,Op=mp,kp=xp,zp=wp,Np=bl,Bp=Math.round,Fp=Math.max,Gp=Math.min,Vp={};function Hp(t,e,i,n){var r=zd.createFromString(t,e),o=r.getBoundingRect();return i&&("center"===n&&(i=Up(i,o)),Wp(r,i)),r}function Up(t,e){var i,n=e.width/e.height,r=t.height*n;return i=r<=t.width?t.height:(r=t.width)/n,{x:t.x+t.width/2-r/2,y:t.y+t.height/2-i/2,width:r,height:i}}function Wp(t,e){if(t.applyTransform){var i=t.getBoundingRect().calculateTransform(e);t.applyTransform(i)}}function jp(t,e,i){var n=Bp(2*t);return(n+Bp(e))%2==0?n/2:(n+(i?1:-1))/2}function Zp(t){return null!=t&&"none"!=t}function Xp(t){return"string"==typeof t?Ns.lift(t,-.1):t}function qp(t){if(t.__hoverStlDirty){var e=t.style.stroke,i=t.style.fill,n=t.__hoverStl;n.fill=n.fill||(Zp(i)?Xp(i):null),n.stroke=n.stroke||(Zp(e)?Xp(e):null);var r={};for(var o in n)null!=n[o]&&(r[o]=t.style[o]);t.__normalStl=r,t.__hoverStlDirty=!1}}function Yp(t){if(!t.__isHover){if(qp(t),t.useHoverLayer)t.__zr&&t.__zr.addHover(t,t.__hoverStl);else{var e=t.style,i=e.insideRollbackOpt;i&&((r=(n=e).insideRollback)&&(n.textFill=r.textFill,n.textStroke=r.textStroke,n.textStrokeWidth=r.textStrokeWidth)),e.extendFrom(t.__hoverStl),i&&(hf(e,e.insideOriginalTextPosition,i),null==e.textFill&&(e.textFill=i.autoColor)),t.dirty(!1),t.z2+=1}var n,r;t.__isHover=!0}}function Jp(t){if(t.__isHover){var e=t.__normalStl;t.useHoverLayer?t.__zr&&t.__zr.removeHover(t):(e&&t.setStyle(e),t.z2-=1),t.__isHover=!1}}function Kp(t){"group"===t.type?t.traverse(function(t){"group"!==t.type&&Yp(t)}):Yp(t)}function Qp(t){"group"===t.type?t.traverse(function(t){"group"!==t.type&&Jp(t)}):Jp(t)}function $p(t,e){t.__hoverStl=t.hoverStyle||e||{},t.__hoverStlDirty=!0,t.__isHover&&qp(t)}function tf(t){this.__hoverSilentOnTouch&&t.zrByTouch||!this.__isEmphasis&&Kp(this)}function ef(t){this.__hoverSilentOnTouch&&t.zrByTouch||!this.__isEmphasis&&Qp(this)}function nf(){this.__isEmphasis=!0,Kp(this)}function rf(){this.__isEmphasis=!1,Qp(this)}function of(t,e,i,n,r){return af(t,e,n,r),i&&za.extend(t,i),t.host&&t.host.dirty&&t.host.dirty(!1),t}function af(t,e,i,n){if((i=i||Vp).isRectText){var r=e.getShallow("position")||(n?null:"inside");"outside"===r&&(r="top"),t.textPosition=r,t.textOffset=e.getShallow("offset");var o=e.getShallow("rotate");null!=o&&(o*=Math.PI/180),t.textRotation=o,t.textDistance=za.retrieve2(e.getShallow("distance"),n?null:5)}var a,s=e.ecModel,l=s&&s.option.textStyle,h=function(t){var e;for(;t&&t!==t.ecModel;){var i=(t.option||Vp).rich;if(i)for(var n in e=e||{},i)i.hasOwnProperty(n)&&(e[n]=1);t=t.parentModel}return e}(e);if(h)for(var c in a={},h)if(h.hasOwnProperty(c)){var u=e.getModel(["rich",c]);sf(a[c]={},u,l,i,n)}return t.rich=a,sf(t,e,l,i,n,!0),i.forceRich&&!i.textStyle&&(i.textStyle={}),t}function sf(t,e,i,n,r,o){if(i=!r&&i||Vp,t.textFill=lf(e.getShallow("color"),n)||i.color,t.textStroke=lf(e.getShallow("textBorderColor"),n)||i.textBorderColor,t.textStrokeWidth=za.retrieve2(e.getShallow("textBorderWidth"),i.textBorderWidth),!r){if(o){var a=t.textPosition;t.insideRollback=hf(t,a,n),t.insideOriginalTextPosition=a,t.insideRollbackOpt=n}null==t.textFill&&(t.textFill=n.autoColor)}t.fontStyle=e.getShallow("fontStyle")||i.fontStyle,t.fontWeight=e.getShallow("fontWeight")||i.fontWeight,t.fontSize=e.getShallow("fontSize")||i.fontSize,t.fontFamily=e.getShallow("fontFamily")||i.fontFamily,t.textAlign=e.getShallow("align"),t.textVerticalAlign=e.getShallow("verticalAlign")||e.getShallow("baseline"),t.textLineHeight=e.getShallow("lineHeight"),t.textWidth=e.getShallow("width"),t.textHeight=e.getShallow("height"),t.textTag=e.getShallow("tag"),o&&n.disableBox||(t.textBackgroundColor=lf(e.getShallow("backgroundColor"),n),t.textPadding=e.getShallow("padding"),t.textBorderColor=lf(e.getShallow("borderColor"),n),t.textBorderWidth=e.getShallow("borderWidth"),t.textBorderRadius=e.getShallow("borderRadius"),t.textBoxShadowColor=e.getShallow("shadowColor"),t.textBoxShadowBlur=e.getShallow("shadowBlur"),t.textBoxShadowOffsetX=e.getShallow("shadowOffsetX"),t.textBoxShadowOffsetY=e.getShallow("shadowOffsetY")),t.textShadowColor=e.getShallow("textShadowColor")||i.textShadowColor,t.textShadowBlur=e.getShallow("textShadowBlur")||i.textShadowBlur,t.textShadowOffsetX=e.getShallow("textShadowOffsetX")||i.textShadowOffsetX,t.textShadowOffsetY=e.getShallow("textShadowOffsetY")||i.textShadowOffsetY}function lf(t,e){return"auto"!==t?t:e&&e.autoColor?e.autoColor:null}function hf(t,e,i){var n,r=i.useInsideStyle;return null==t.textFill&&!1!==r&&(!0===r||i.isRectText&&e&&"string"==typeof e&&0<=e.indexOf("inside"))&&(n={textFill:null,textStroke:t.textStroke,textStrokeWidth:t.textStrokeWidth},t.textFill="#fff",null==t.textStroke&&(t.textStroke=i.autoColor,null==t.textStrokeWidth&&(t.textStrokeWidth=2))),n}function cf(t,e,i,n,r,o){if("function"==typeof r&&(o=r,r=null),n&&n.isAnimationEnabled()){var a=t?"Update":"",s=n.getShallow("animationDuration"+a),l=n.getShallow("animationEasing"+a),h=n.getShallow("animationDelay"+a);"function"==typeof h&&(h=h(r,n.getAnimationDelayParams?n.getAnimationDelayParams(e,r):null)),"function"==typeof s&&(s=s(r)),0<s?e.animateTo(i,s,h||0,l,o,!!o):(e.stopAnimation(),e.attr(i),o&&o())}else e.stopAnimation(),e.attr(i),o&&o()}function uf(t,e,i,n,r){cf(!0,t,e,i,n,r)}function df(t,e,i){return e&&!za.isArrayLike(e)&&(e=hs.getLocalTransform(e)),i&&(e=ns.invert([],e)),Ha.applyTransform([],t,e)}var pf={Image:bp,Group:Mp,Text:Sp,Circle:Tp,Sector:Cp,Ring:Ap,Polygon:Ep,Polyline:Pp,Rect:Lp,Line:Ip,BezierCurve:Rp,Arc:Dp,CompoundPath:Op,LinearGradient:kp,RadialGradient:zp,BoundingRect:Np,extendShape:function(t){return _d.extend(t)},extendPath:function(t,e){return zd.extendFromString(t,e)},makePath:Hp,makeImage:function(t,i,n){var r=new $h({style:{image:t,x:i.x,y:i.y,width:i.width,height:i.height},onload:function(t){if("center"===n){var e={width:t.width,height:t.height};r.setStyle(Up(i,e))}}});return r},mergePath:zd.mergePath,resizePath:Wp,subPixelOptimizeLine:function(t){var e=t.shape,i=t.style.lineWidth;return Bp(2*e.x1)===Bp(2*e.x2)&&(e.x1=e.x2=jp(e.x1,i,!0)),Bp(2*e.y1)===Bp(2*e.y2)&&(e.y1=e.y2=jp(e.y1,i,!0)),t},subPixelOptimizeRect:function(t){var e=t.shape,i=t.style.lineWidth,n=e.x,r=e.y,o=e.width,a=e.height;return e.x=jp(e.x,i,!0),e.y=jp(e.y,i,!0),e.width=Math.max(jp(n+o,i,!1)-e.x,0===o?0:1),e.height=Math.max(jp(r+a,i,!1)-e.y,0===a?0:1),t},subPixelOptimize:jp,setHoverStyle:function(t,e,i){t.__hoverSilentOnTouch=i&&i.hoverSilentOnTouch,"group"===t.type?t.traverse(function(t){"group"!==t.type&&$p(t,e)}):$p(t,e),t.on("mouseover",tf).on("mouseout",ef),t.on("emphasis",nf).on("normal",rf)},setLabelStyle:function(t,e,i,n,r,o,a){var s=(r=r||Vp).labelFetcher,l=r.labelDataIndex,h=r.labelDimIndex,c=i.getShallow("show"),u=n.getShallow("show"),d=c||u?za.retrieve2(s?s.getFormattedLabel(l,"normal",null,h):null,r.defaultText):null,p=c?d:null,f=u?za.retrieve2(s?s.getFormattedLabel(l,"emphasis",null,h):null,d):null;null==p&&null==f||(of(t,i,o,r),of(e,n,a,r,!0)),t.text=p,e.text=f},setTextStyle:of,setText:function(t,e,i){var n,r={isRectText:!0};!1===i?n=!0:r.autoColor=i,af(t,e,r,n),t.host&&t.host.dirty&&t.host.dirty(!1)},getFont:function(t,e){var i=e||e.getModel("textStyle");return[t.fontStyle||i&&i.getShallow("fontStyle")||"",t.fontWeight||i&&i.getShallow("fontWeight")||"",(t.fontSize||i&&i.getShallow("fontSize")||12)+"px",t.fontFamily||i&&i.getShallow("fontFamily")||"sans-serif"].join(" ")},updateProps:uf,initProps:function(t,e,i,n,r){cf(!1,t,e,i,n,r)},getTransform:function(t,e){for(var i=ns.identity([]);t&&t!==e;)ns.mul(i,t.getLocalTransform(),i),t=t.parent;return i},applyTransform:df,transformDirection:function(t,e,i){var n=0===e[4]||0===e[5]||0===e[0]?1:Math.abs(2*e[4]/e[0]),r=0===e[4]||0===e[5]||0===e[2]?1:Math.abs(2*e[4]/e[2]),o=["left"===t?-n:"right"===t?n:0,"top"===t?-r:"bottom"===t?r:0];return o=df(o,e,i),Math.abs(o[0])>Math.abs(o[1])?0<o[0]?"right":"left":0<o[1]?"bottom":"top"},groupTransition:function(t,e,n,i){if(t&&e){var r,o=(r={},t.traverse(function(t){!t.isGroup&&t.anid&&(r[t.anid]=t)}),r);e.traverse(function(t){if(!t.isGroup&&t.anid){var e=o[t.anid];if(e){var i=a(t);t.attr(a(e)),uf(t,i,n,t.dataIndex)}}})}function a(t){var e={position:Ha.clone(t.position),rotation:t.rotation};return t.shape&&(e.shape=za.extend({},t.shape)),e}},clipPointsByRect:function(t,n){return za.map(t,function(t){var e=t[0];e=Fp(e,n.x),e=Gp(e,n.x+n.width);var i=t[1];return i=Fp(i,n.y),[e,i=Gp(i,n.y+n.height)]})},clipRectByRect:function(t,e){var i=Fp(t.x,e.x),n=Gp(t.x+t.width,e.x+e.width),r=Fp(t.y,e.y),o=Gp(t.y+t.height,e.y+e.height);if(i<=n&&r<=o)return{x:i,y:r,width:n-i,height:o-r}},createIcon:function(t,e,i){var n=(e=za.extend({rectHover:!0},e)).style={strokeNoScale:!0};if(i=i||{x:-1,y:-1,width:2,height:2},t)return 0===t.indexOf("image://")?(n.image=t.slice(8),za.defaults(n,i),new $h(e)):Hp(t.replace("path://",""),e,i,"center")}},ff=["textStyle","color"],gf={getTextColor:function(t){var e=this.ecModel;return this.getShallow("color")||(!t&&e?e.get(ff):null)},getFont:function(){return pf.getFont({fontStyle:this.getShallow("fontStyle"),fontWeight:this.getShallow("fontWeight"),fontSize:this.getShallow("fontSize"),fontFamily:this.getShallow("fontFamily")},this.ecModel)},getTextRect:function(t){return Sh.getBoundingRect(t,this.getFont(),this.getShallow("align"),this.getShallow("verticalAlign")||this.getShallow("baseline"),this.getShallow("padding"),this.getShallow("rich"),this.getShallow("truncateText"))}},mf=nu([["fill","color"],["stroke","borderColor"],["lineWidth","borderWidth"],["opacity"],["shadowBlur"],["shadowOffsetX"],["shadowOffsetY"],["shadowColor"],["textPosition"],["textAlign"]]),vf={getItemStyle:function(t,e){var i=mf(this,t,e),n=this.getBorderLineDash();return n&&(i.lineDash=n),i},getBorderLineDash:function(){var t=this.get("borderType");return"solid"===t||null==t?null:"dashed"===t?[5,5]:[1,1]}},yf=za.mixin;function _f(t,e,i){this.parentModel=e,this.ecModel=i,this.option=t}function xf(t,e,i){for(var n=0;n<e.length&&(!e[n]||null!=(t=t&&"object"==typeof t?t[e[n]]:null));n++);return null==t&&i&&(t=i.get(e)),t}function wf(t,e){var i=iu.get(t,"getParent");return i?i.call(t,e):t.parentModel}_f.prototype={constructor:_f,init:null,mergeOption:function(t){za.merge(this.option,t,!0)},get:function(t,e){return null==t?this.option:xf(this.option,this.parsePath(t),!e&&wf(this,t))},getShallow:function(t,e){var i=this.option,n=null==i?i:i[t],r=!e&&wf(this,t);return null==n&&r&&(n=r.getShallow(t)),n},getModel:function(t,e){var i;return new _f(null==t?this.option:xf(this.option,t=this.parsePath(t)),e=e||(i=wf(this,t))&&i.getModel(t),this.ecModel)},isEmpty:function(){return null==this.option},restoreData:function(){},clone:function(){return new this.constructor(za.clone(this.option))},setReadOnly:function(t){iu.setReadOnly(this,t)},parsePath:function(t){return"string"==typeof t&&(t=t.split(".")),t},customizeGetParent:function(t){iu.set(this,"getParent",t)},isAnimationEnabled:function(){if(!ca.node){if(null!=this.option.animation)return!!this.option.animation;if(this.parentModel)return this.parentModel.isAnimationEnabled()}}},iu.enableClassExtend(_f),yf(_f,ou),yf(_f,su),yf(_f,gf),yf(_f,vf);var bf=_f,Mf=za.each,Sf=za.isObject;function Tf(t){return t instanceof Array?t:null==t?[]:[t]}var Cf={getDataParams:function(t,e){var i=this.getData(e),n=this.getRawValue(t,e),r=i.getRawIndex(t),o=i.getName(t,!0),a=i.getRawDataItem(t),s=i.getItemVisual(t,"color");return{componentType:this.mainType,componentSubType:this.subType,seriesType:"series"===this.mainType?this.subType:null,seriesIndex:this.seriesIndex,seriesId:this.id,seriesName:this.name,name:o,dataIndex:r,data:a,dataType:e,value:n,color:s,marker:Yc.getTooltipMarker(s),$vars:["seriesName","name","value"]}},getFormattedLabel:function(t,e,i,n,r){e=e||"normal";var o=this.getData(i).getItemModel(t),a=this.getDataParams(t,i);null!=n&&a.value instanceof Array&&(a.value=a.value[n]);var s=o.get([r||"label",e,"formatter"]);return"function"==typeof s?(a.status=e,s(a)):"string"==typeof s?Yc.formatTpl(s,a):void 0},getRawValue:function(t,e){var i=this.getData(e).getRawDataItem(t);if(null!=i)return!Sf(i)||i instanceof Array?i:i.value},formatTooltip:za.noop};function Af(t){return Sf(t)&&t.id&&0===(t.id+"").indexOf("\0_ec_\0")}var Ef,Pf=(Ef=0,function(){var e="\0__ec_prop_getter_"+Ef++;return function(t){return t[e]||(t[e]={})}});function Lf(t,e){return t&&t.hasOwnProperty(e)}var If={normalizeToArray:Tf,defaultEmphasis:function(t,e){if(t)for(var i=t.emphasis=t.emphasis||{},n=t.normal=t.normal||{},r=0,o=e.length;r<o;r++){var a=e[r];!i.hasOwnProperty(a)&&n.hasOwnProperty(a)&&(i[a]=n[a])}},TEXT_STYLE_OPTIONS:["fontStyle","fontWeight","fontSize","fontFamily","rich","tag","color","textBorderColor","textBorderWidth","width","height","lineHeight","align","verticalAlign","baseline","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","textShadowColor","textShadowBlur","textShadowOffsetX","textShadowOffsetY","backgroundColor","borderColor","borderWidth","borderRadius","padding"],getDataItemValue:function(t){return t&&(null==t.value?t:t.value)},isDataItemOption:function(t){return Sf(t)&&!(t instanceof Array)},converDataValue:function(t,e){var i=e&&e.type;return"ordinal"===i?t:("time"===i&&"number"!=typeof t&&null!=t&&"-"!==t&&(t=+Uc.parseDate(t)),null==t||""===t?NaN:+t)},createDataFormatModel:function(t,e){var i=new bf;return za.mixin(i,Cf),i.seriesIndex=e.seriesIndex,i.name=e.name||"",i.mainType=e.mainType,i.subType=e.subType,i.getData=function(){return t},i},dataFormatMixin:Cf,mappingToExists:function(t,r){r=(r||[]).slice();var o=za.map(t||[],function(t,e){return{exist:t}});return Mf(r,function(t,e){if(Sf(t)){for(var i=0;i<o.length;i++)if(!o[i].option&&null!=t.id&&o[i].exist.id===t.id+"")return o[i].option=t,void(r[e]=null);for(i=0;i<o.length;i++){var n=o[i].exist;if(!(o[i].option||null!=n.id&&null!=t.id||null==t.name||Af(t)||Af(n)||n.name!==t.name+""))return o[i].option=t,void(r[e]=null)}}}),Mf(r,function(t,e){if(Sf(t)){for(var i=0;i<o.length;i++){var n=o[i].exist;if(!o[i].option&&!Af(n)&&null==t.id){o[i].option=t;break}}i>=o.length&&o.push({option:t})}}),o},makeIdAndName:function(t){var a=za.createHashMap();Mf(t,function(t,e){var i=t.exist;i&&a.set(i.id,t)}),Mf(t,function(t,e){var i=t.option;za.assert(!i||null==i.id||!a.get(i.id)||a.get(i.id)===t,"id duplicates: "+(i&&i.id)),i&&null!=i.id&&a.set(i.id,t),!t.keyInfo&&(t.keyInfo={})}),Mf(t,function(t,e){var i=t.exist,n=t.option,r=t.keyInfo;if(Sf(n)){if(r.name=null!=n.name?n.name+"":i?i.name:"\0-",i)r.id=i.id;else if(null!=n.id)r.id=n.id+"";else for(var o=0;r.id="\0"+r.name+"\0"+o++,a.get(r.id););a.set(r.id,t)}})},isIdInner:Af,compressBatches:function(t,e){var i={},n={};return r(t||[],i),r(e||[],n,i),[o(i),o(n)];function r(t,e,i){for(var n=0,r=t.length;n<r;n++)for(var o=t[n].seriesId,a=Tf(t[n].dataIndex),s=i&&i[o],l=0,h=a.length;l<h;l++){var c=a[l];s&&s[c]?s[c]=null:(e[o]||(e[o]={}))[c]=1}}function o(t,e){var i=[];for(var n in t)if(t.hasOwnProperty(n)&&null!=t[n])if(e)i.push(+n);else{var r=o(t[n],!0);r.length&&i.push({seriesId:n,dataIndex:r})}return i}},queryDataIndex:function(e,t){return null!=t.dataIndexInside?t.dataIndexInside:null!=t.dataIndex?za.isArray(t.dataIndex)?za.map(t.dataIndex,function(t){return e.indexOfRawIndex(t)}):e.indexOfRawIndex(t.dataIndex):null!=t.name?za.isArray(t.name)?za.map(t.name,function(t){return e.indexOfName(t)}):e.indexOfName(t.name):void 0},makeGetter:Pf,parseFinder:function(s,l,h){if(za.isString(l)){var t={};t[l+"Index"]=0,l=t}var e=h&&h.defaultMainType;!e||Lf(l,e+"Index")||Lf(l,e+"Id")||Lf(l,e+"Name")||(l[e+"Index"]=0);var c={};return Mf(l,function(t,e){if(t=l[e],"dataIndex"!==e&&"dataIndexInside"!==e){var i=e.match(/^(\w+)(Index|Id|Name)$/)||[],n=i[1],r=(i[2]||"").toLowerCase();if(!(!n||!r||null==t||"index"===r&&"none"===t||h&&h.includeMainTypes&&za.indexOf(h.includeMainTypes,n)<0)){var o={mainType:n};"index"===r&&"all"===t||(o[r]=t);var a=s.queryComponents(o);c[n+"Models"]=a,c[n+"Model"]=a[0]}}else c[e]=t}),c},dataDimToCoordDim:function(t,e){var i=t.dimensions;e=t.getDimension(e);for(var n=0;n<i.length;n++){var r=t.getDimensionInfo(i[n]);if(r.name===e)return r.coordDim}},coordDimToDataDim:function(i,n){var r=[];return Mf(i.dimensions,function(t){var e=i.getDimensionInfo(t);e.coordDim===n&&(r[e.coordDimIndex]=e.name)}),r},otherDimToDataDim:function(n,r){var o=[];return Mf(n.dimensions,function(t){var e=n.getDimensionInfo(t),i=e.otherDims[r];null!=i&&!1!==i&&(o[i]=e.name)}),o}},Rf=iu.parseClassType,Df=0;var Of={getUID:function(t){return[t||"",Df++,Math.random()].join("_")},enableSubTypeDefaulter:function(r){var o={};return r.registerSubTypeDefaulter=function(t,e){t=Rf(t),o[t.main]=e},r.determineSubType=function(t,e){var i=e.type;if(!i){var n=Rf(t).main;r.hasSubTypes(t)&&o[n]&&(i=o[n](e))}return i},r},enableTopologicalTravel:function(t,m){function v(t,e){return t[e]||(t[e]={predecessor:[],successor:[]}),t[e]}t.topologicalTravel=function(t,e,i,n){if(t.length){var s,l,h,r=(s=e,l={},h=[],za.each(s,function(i){var t,e,n,r=v(l,i),o=r.originalDeps=m(i),a=(t=o,e=s,n=[],za.each(t,function(t){0<=za.indexOf(e,t)&&n.push(t)}),n);r.entryCount=a.length,0===r.entryCount&&h.push(i),za.each(a,function(t){za.indexOf(r.predecessor,t)<0&&r.predecessor.push(t);var e=v(l,t);za.indexOf(e.successor,t)<0&&e.successor.push(i)})}),{graph:l,noEntryList:h}),o=r.graph,a=r.noEntryList,c={};for(za.each(t,function(t){c[t]=!0});a.length;){var u=a.pop(),d=o[u],p=!!c[u];p&&(i.call(n,u,d.originalDeps.slice()),delete c[u]),za.each(d.successor,p?g:f)}za.each(c,function(){throw new Error("Circle dependency may exists")})}function f(t){o[t].entryCount--,0===o[t].entryCount&&a.push(t)}function g(t){c[t]=!0,f(t)}}}},kf=Uc.parsePercent,zf=za.each,Nf=["left","right","top","bottom","width","height"],Bf=[["width","left","right"],["height","top","bottom"]];function Ff(c,u,d,p,f){var g=0,m=0;null==p&&(p=1/0),null==f&&(f=1/0);var v=0;u.eachChild(function(t,e){var i,n,r=t.position,o=t.getBoundingRect(),a=u.childAt(e+1),s=a&&a.getBoundingRect();if("horizontal"===c){var l=o.width+(s?-s.x+o.x:0);p<(i=g+l)||t.newline?(g=0,i=l,m+=v+d,v=o.height):v=Math.max(v,o.height)}else{var h=o.height+(s?-s.y+o.y:0);f<(n=m+h)||t.newline?(g+=v+d,m=0,n=h,v=o.width):v=Math.max(v,o.width)}t.newline||(r[0]=g,r[1]=m,"horizontal"===c?g=i+d:m=n+d)})}var Gf=Ff,Vf=za.curry(Ff,"vertical"),Hf=za.curry(Ff,"horizontal");function Uf(t,e,i){i=Yc.normalizeCssArray(i||0);var n=e.width,r=e.height,o=kf(t.left,n),a=kf(t.top,r),s=kf(t.right,n),l=kf(t.bottom,r),h=kf(t.width,n),c=kf(t.height,r),u=i[2]+i[0],d=i[1]+i[3],p=t.aspect;switch(isNaN(h)&&(h=n-s-d-o),isNaN(c)&&(c=r-l-u-a),null!=p&&(isNaN(h)&&isNaN(c)&&(n/r<p?h=.8*n:c=.8*r),isNaN(h)&&(h=p*c),isNaN(c)&&(c=h/p)),isNaN(o)&&(o=n-s-h-d),isNaN(a)&&(a=r-l-c-u),t.left||t.right){case"center":o=n/2-h/2-i[3];break;case"right":o=n-h-d}switch(t.top||t.bottom){case"middle":case"center":a=r/2-c/2-i[0];break;case"bottom":a=r-c-u}o=o||0,a=a||0,isNaN(h)&&(h=n-d-o-(s||0)),isNaN(c)&&(c=r-u-a-(l||0));var f=new bl(o+i[3],a+i[0],h,c);return f.margin=i,f}function Wf(e,i){return i&&e&&zf(Nf,function(t){i.hasOwnProperty(t)&&(e[t]=i[t])}),e}var jf={LOCATION_PARAMS:Nf,HV_NAMES:Bf,box:Gf,vbox:Vf,hbox:Hf,getAvailableSize:function(t,e,i){var n=e.width,r=e.height,o=kf(t.x,n),a=kf(t.y,r),s=kf(t.x2,n),l=kf(t.y2,r);return(isNaN(o)||isNaN(parseFloat(t.x)))&&(o=0),(isNaN(s)||isNaN(parseFloat(t.x2)))&&(s=n),(isNaN(a)||isNaN(parseFloat(t.y)))&&(a=0),(isNaN(l)||isNaN(parseFloat(t.y2)))&&(l=r),i=Yc.normalizeCssArray(i||0),{width:Math.max(s-o-i[1]-i[3],0),height:Math.max(l-a-i[0]-i[2],0)}},getLayoutRect:Uf,positionElement:function(t,e,i,n,r){var o=!r||!r.hv||r.hv[0],a=!r||!r.hv||r.hv[1],s=r&&r.boundingMode||"all";if(o||a){var l;if("raw"===s)l="group"===t.type?new bl(0,0,+e.width||0,+e.height||0):t.getBoundingRect();else if(l=t.getBoundingRect(),t.needLocalTransform()){var h=t.getLocalTransform();(l=l.clone()).applyTransform(h)}e=Uf(za.defaults({width:l.width,height:l.height},e),i,n);var c=t.position,u=o?e.x-l.x:0,d=a?e.y-l.y:0;t.attr("position","raw"===s?[u,d]:[c[0]+u,c[1]+d])}},sizeCalculable:function(t,e){return null!=t[Bf[e][0]]||null!=t[Bf[e][1]]&&null!=t[Bf[e][2]]},mergeLayoutParam:function(l,h,t){!za.isObject(t)&&(t={});var c=t.ignoreSize;!za.isArray(c)&&(c=[c,c]);var e=n(Bf[0],0),i=n(Bf[1],1);function n(t,e){var i={},n=0,r={},o=0;if(zf(t,function(t){r[t]=l[t]}),zf(t,function(t){u(h,t)&&(i[t]=r[t]=h[t]),d(i,t)&&n++,d(r,t)&&o++}),c[e])return d(h,t[1])?r[t[2]]=null:d(h,t[2])&&(r[t[1]]=null),r;if(2!==o&&n){if(2<=n)return i;for(var a=0;a<t.length;a++){var s=t[a];if(!u(i,s)&&u(l,s)){i[s]=l[s];break}}return i}return r}function u(t,e){return t.hasOwnProperty(e)}function d(t,e){return null!=t[e]&&"auto"!==t[e]}function r(t,e,i){zf(t,function(t){e[t]=i[t]})}r(Bf[0],l,e),r(Bf[1],l,i)},getLayoutParams:function(t){return Wf({},t)},copyLayoutParams:Wf},Zf={getBoxLayoutParams:function(){return{left:this.get("left"),top:this.get("top"),right:this.get("right"),bottom:this.get("bottom"),width:this.get("width"),height:this.get("height")}}},Xf=Array.prototype.push,qf=bf.extend({type:"component",id:"",name:"",mainType:"",subType:"",componentIndex:0,defaultOption:null,ecModel:null,dependentModels:[],uid:null,layoutMode:null,$constructor:function(t,e,i,n){bf.call(this,t,e,i,n),this.uid=Of.getUID("componentModel")},init:function(t,e,i,n){this.mergeDefaultAndTheme(t,i)},mergeDefaultAndTheme:function(t,e){var i=this.layoutMode,n=i?jf.getLayoutParams(t):{},r=e.getTheme();za.merge(t,r.get(this.mainType)),za.merge(t,this.getDefaultOption()),i&&jf.mergeLayoutParam(t,n,i)},mergeOption:function(t,e){za.merge(this.option,t,!0);var i=this.layoutMode;i&&jf.mergeLayoutParam(this.option,t,i)},optionUpdated:function(t,e){},getDefaultOption:function(){if(!iu.hasOwn(this,"__defaultOption")){for(var t=[],e=this.constructor;e;){var i=e.prototype.defaultOption;i&&t.push(i),e=e.superClass}for(var n={},r=t.length-1;0<=r;r--)n=za.merge(n,t[r],!0);iu.set(this,"__defaultOption",n)}return iu.get(this,"__defaultOption")},getReferringComponents:function(t){return this.ecModel.queryComponents({mainType:t,index:this.get(t+"Index",!0),id:this.get(t+"Id",!0)})}});iu.enableClassManagement(qf,{registerWhenExtend:!0}),Of.enableSubTypeDefaulter(qf),Of.enableTopologicalTravel(qf,function(t){var e=[];return za.each(qf.getClassesByMainType(t),function(t){Xf.apply(e,t.prototype.dependencies||[])}),za.map(e,function(t){return iu.parseClassType(t).main})}),za.mixin(qf,Zf);var Yf=qf,Jf="";"undefined"!=typeof navigator&&(Jf=navigator.platform||"");var Kf={color:["#c23531","#2f4554","#61a0a8","#d48265","#91c7ae","#749f83","#ca8622","#bda29a","#6e7074","#546570","#c4ccd3"],textStyle:{fontFamily:Jf.match(/^Win/)?"Microsoft YaHei":"sans-serif",fontSize:12,fontStyle:"normal",fontWeight:"normal"},blendMode:null,animation:"auto",animationDuration:1e3,animationDurationUpdate:300,animationEasing:"exponentialOut",animationEasingUpdate:"cubicOut",animationThreshold:2e3,progressiveThreshold:3e3,progressive:400,hoverLayerThreshold:3e3,useUTC:!1},Qf=iu.set,$f=iu.get,tg={clearColorPalette:function(){Qf(this,"colorIdx",0),Qf(this,"colorNameMap",{})},getColorFromPalette:function(t,e){var i=$f(e=e||this,"colorIdx")||0,n=$f(e,"colorNameMap")||Qf(e,"colorNameMap",{});if(n.hasOwnProperty(t))return n[t];var r=this.get("color",!0)||[];if(r.length){var o=r[i];return t&&(n[t]=o),Qf(e,"colorIdx",(i+1)%r.length),o}}},eg=za.each,ig=za.filter,ng=za.map,rg=za.isArray,og=za.indexOf,ag=za.isObject,sg="\0_ec_inner",lg=bf.extend({constructor:lg,init:function(t,e,i,n){i=i||{},this.option=null,this._theme=new bf(i),this._optionManager=n},setOption:function(t,e){za.assert(!(sg in t),"please use chart.getOption()"),this._optionManager.setOption(t,e),this.resetOption(null)},resetOption:function(t){var e=!1,i=this._optionManager;if(!t||"recreate"===t){var n=i.mountOption("recreate"===t);this.option&&"recreate"!==t?(this.restoreData(),this.mergeOption(n)):function(t){t=t,this.option={},this.option[sg]=1,this._componentsMap=za.createHashMap({series:[]}),this._seriesIndices=null,i=t,e=this._theme.option,za.each(e,function(t,e){Yf.hasClass(e)||("object"==typeof t?i[e]=i[e]?za.merge(i[e],t,!1):za.clone(t):null==i[e]&&(i[e]=t))}),za.merge(t,Kf,!1),this.mergeOption(t);var i,e}.call(this,n),e=!0}if("timeline"!==t&&"media"!==t||this.restoreData(),!t||"recreate"===t||"timeline"===t){var r=i.getTimelineOption(this);r&&(this.mergeOption(r),e=!0)}if(!t||"recreate"===t||"media"===t){var o=i.getMediaOption(this,this._api);o.length&&eg(o,function(t){this.mergeOption(t,e=!0)},this)}return e},mergeOption:function(n){var l=this.option,h=this._componentsMap,i=[];eg(n,function(t,e){null!=t&&(Yf.hasClass(e)?i.push(e):l[e]=null==l[e]?za.clone(t):za.merge(l[e],t,!0))}),Yf.topologicalTravel(i,Yf.getAllClassMainTypes(),function(a,t){var e=If.normalizeToArray(n[a]),i=If.mappingToExists(h.get(a),e);If.makeIdAndName(i),eg(i,function(t,e){var i,n,r,o=t.option;ag(o)&&(t.keyInfo.mainType=a,t.keyInfo.subType=(i=a,n=o,r=t.exist,n.type?n.type:r?r.subType:Yf.determineSubType(i,n)))});var s=function(e,t){za.isArray(t)||(t=t?[t]:[]);var i={};return eg(t,function(t){i[t]=(e.get(t)||[]).slice()}),i}(h,t);l[a]=[],h.set(a,[]),eg(i,function(t,e){var i=t.exist,n=t.option;if(za.assert(ag(n)||i,"Empty component definition"),n){var r=Yf.getClass(a,t.keyInfo.subType,!0);if(i&&i instanceof r)i.name=t.keyInfo.name,i.mergeOption(n,this),i.optionUpdated(n,!1);else{var o=za.extend({dependentModels:s,componentIndex:e},t.keyInfo);i=new r(n,this,this,o),za.extend(i,o),i.init(n,this,this,o),i.optionUpdated(null,!0)}}else i.mergeOption({},this),i.optionUpdated({},!1);h.get(a)[e]=i,l[a][e]=i.option},this),"series"===a&&(this._seriesIndices=hg(h.get("series")))},this),this._seriesIndices=this._seriesIndices||[]},getOption:function(){var n=za.clone(this.option);return eg(n,function(t,e){if(Yf.hasClass(e)){for(var i=(t=If.normalizeToArray(t)).length-1;0<=i;i--)If.isIdInner(t[i])&&t.splice(i,1);n[e]=t}}),delete n[sg],n},getTheme:function(){return this._theme},getComponent:function(t,e){var i=this._componentsMap.get(t);if(i)return i[e||0]},queryComponents:function(t){var e=t.mainType;if(!e)return[];var i,n=t.index,r=t.id,o=t.name,a=this._componentsMap.get(e);if(!a||!a.length)return[];if(null!=n)rg(n)||(n=[n]),i=ig(ng(n,function(t){return a[t]}),function(t){return!!t});else if(null!=r){var s=rg(r);i=ig(a,function(t){return s&&0<=og(r,t.id)||!s&&t.id===r})}else if(null!=o){var l=rg(o);i=ig(a,function(t){return l&&0<=og(o,t.name)||!l&&t.name===o})}else i=a.slice();return cg(i,t)},findComponents:function(t){var e,i,n,r,o,a=t.query,s=t.mainType,l=(i=s+"Index",n=s+"Id",r=s+"Name",!(e=a)||null==e[i]&&null==e[n]&&null==e[r]?null:{mainType:s,index:e[i],id:e[n],name:e[r]}),h=l?this.queryComponents(l):this._componentsMap.get(s);return o=cg(h,t),t.filter?ig(o,t.filter):o},eachComponent:function(t,n,r){var e=this._componentsMap;if("function"==typeof t)r=n,n=t,e.each(function(t,i){eg(t,function(t,e){n.call(r,i,t,e)})});else if(za.isString(t))eg(e.get(t),n,r);else if(ag(t)){var i=this.findComponents(t);eg(i,n,r)}},getSeriesByName:function(e){var t=this._componentsMap.get("series");return ig(t,function(t){return t.name===e})},getSeriesByIndex:function(t){return this._componentsMap.get("series")[t]},getSeriesByType:function(e){var t=this._componentsMap.get("series");return ig(t,function(t){return t.subType===e})},getSeries:function(){return this._componentsMap.get("series").slice()},eachSeries:function(i,n){eg(this._seriesIndices,function(t){var e=this._componentsMap.get("series")[t];i.call(n,e,t)},this)},eachRawSeries:function(t,e){eg(this._componentsMap.get("series"),t,e)},eachSeriesByType:function(i,n,r){eg(this._seriesIndices,function(t){var e=this._componentsMap.get("series")[t];e.subType===i&&n.call(r,e,t)},this)},eachRawSeriesByType:function(t,e,i){return eg(this.getSeriesByType(t),e,i)},isSeriesFiltered:function(t){return za.indexOf(this._seriesIndices,t.componentIndex)<0},getCurrentSeriesIndices:function(){return(this._seriesIndices||[]).slice()},filterSeries:function(t,e){var i=ig(this._componentsMap.get("series"),t,e);this._seriesIndices=hg(i)},restoreData:function(){var i=this._componentsMap;this._seriesIndices=hg(i.get("series"));var n=[];i.each(function(t,e){n.push(e)}),Yf.topologicalTravel(n,Yf.getAllClassMainTypes(),function(t,e){eg(i.get(t),function(t){t.restoreData()})})}});function hg(t){return ng(t,function(t){return t.componentIndex})||[]}function cg(t,e){return e.hasOwnProperty("subType")?ig(t,function(t){return t.subType===e.subType}):t}za.mixin(lg,tg);var ug=lg,dg=["getDom","getZr","getWidth","getHeight","getDevicePixelRatio","dispatchAction","isDisposed","on","off","getDataURL","getConnectedDataURL","getModel","getOption","getViewOfComponentModel","getViewOfSeriesModel"];var pg=function(e){za.each(dg,function(t){this[t]=za.bind(e[t],e)},this)},fg={};function gg(){this._coordinateSystems=[]}gg.prototype={constructor:gg,create:function(n,r){var o=[];za.each(fg,function(t,e){var i=t.create(n,r);o=o.concat(i||[])}),this._coordinateSystems=o},update:function(e,i){za.each(this._coordinateSystems,function(t){t.update&&t.update(e,i)})},getCoordinateSystems:function(){return this._coordinateSystems.slice()}},gg.register=function(t,e){fg[t]=e},gg.get=function(t){return fg[t]};var mg=gg,vg=za.each,yg=za.clone,_g=za.map,xg=za.merge,wg=/^(min|max)?(.+)$/;function bg(t){this._api=t,this._timelineOptions=[],this._mediaList=[],this._mediaDefault,this._currentMediaIndices=[],this._optionBackup,this._newBaseOption}function Mg(t,e,i){var l={width:e,height:i,aspectratio:e/i},h=!0;return za.each(t,function(t,e){var i=e.match(wg);if(i&&i[1]&&i[2]){var n,r,o,a=i[1],s=i[2].toLowerCase();n=l[s],r=t,("min"===(o=a)?r<=n:"max"===o?n<=r:n===r)||(h=!1)}}),h}bg.prototype={constructor:bg,setOption:function(t,e){t=yg(t,!0);var r,i,n=this._optionBackup,o=function(t,i,n){var e,r,o=[],a=[],s=t.timeline;t.baseOption&&(r=t.baseOption);(s||t.options)&&(r=r||{},o=(t.options||[]).slice());if(t.media){r=r||{};var l=t.media;vg(l,function(t){t&&t.option&&(t.query?a.push(t):e||(e=t))})}r||(r=t);r.timeline||(r.timeline=s);return vg([r].concat(o).concat(za.map(a,function(t){return t.option})),function(e){vg(i,function(t){t(e,n)})}),{baseOption:r,timelineOptions:o,mediaDefault:e,mediaList:a}}.call(this,t,e,!n);this._newBaseOption=o.baseOption,n?(r=n.baseOption,i=o.baseOption,vg(i=i||{},function(t,e){if(null!=t){var i=r[e];if(Yf.hasClass(e)){t=If.normalizeToArray(t),i=If.normalizeToArray(i);var n=If.mappingToExists(i,t);r[e]=_g(n,function(t){return t.option&&t.exist?xg(t.exist,t.option,!0):t.exist||t.option})}else r[e]=xg(i,t,!0)}}),o.timelineOptions.length&&(n.timelineOptions=o.timelineOptions),o.mediaList.length&&(n.mediaList=o.mediaList),o.mediaDefault&&(n.mediaDefault=o.mediaDefault)):this._optionBackup=o},mountOption:function(t){var e=this._optionBackup;return this._timelineOptions=_g(e.timelineOptions,yg),this._mediaList=_g(e.mediaList,yg),this._mediaDefault=yg(e.mediaDefault),this._currentMediaIndices=[],yg(t?e.baseOption:this._newBaseOption)},getTimelineOption:function(t){var e,i=this._timelineOptions;if(i.length){var n=t.getComponent("timeline");n&&(e=yg(i[n.getCurrentIndex()],!0))}return e},getMediaOption:function(t){var e,i,n=this._api.getWidth(),r=this._api.getHeight(),o=this._mediaList,a=this._mediaDefault,s=[],l=[];if(!o.length&&!a)return l;for(var h=0,c=o.length;h<c;h++)Mg(o[h].query,n,r)&&s.push(h);return!s.length&&a&&(s=[-1]),s.length&&(e=s,i=this._currentMediaIndices,e.join(",")!==i.join(","))&&(l=_g(s,function(t){return yg(-1===t?a.option:o[t].option)})),this._currentMediaIndices=s,l}};var Sg=bg,Tg=za.each,Cg=za.isObject,Ag=["areaStyle","lineStyle","nodeStyle","linkStyle","chordStyle","label","labelLine"];function Eg(t){var e=t&&t.itemStyle;if(e)for(var i=0,n=Ag.length;i<n;i++){var r=Ag[i],o=e.normal,a=e.emphasis;o&&o[r]&&(t[r]=t[r]||{},t[r].normal?za.merge(t[r].normal,o[r]):t[r].normal=o[r],o[r]=null),a&&a[r]&&(t[r]=t[r]||{},t[r].emphasis?za.merge(t[r].emphasis,a[r]):t[r].emphasis=a[r],a[r]=null)}}function Pg(t,e){var i=Cg(t)&&t[e],n=Cg(i)&&i.textStyle;if(n)for(var r=0,o=If.TEXT_STYLE_OPTIONS.length;r<o;r++){e=If.TEXT_STYLE_OPTIONS[r];n.hasOwnProperty(e)&&(i[e]=n[e])}}function Lg(t){Cg(t)&&(Pg(t,"normal"),Pg(t,"emphasis"))}function Ig(t){return za.isArray(t)?t:t?[t]:[]}function Rg(t){return(za.isArray(t)?t[0]:t)||{}}var Dg=function(e,t){Tg(Ig(e.series),function(t){Cg(t)&&function(t){if(Cg(t)){Eg(t),Lg(t.label),Lg(t.upperLabel),Lg(t.edgeLabel),Eg(n=t.markPoint),Lg(n&&n.label);var e=t.markLine;Eg(t.markLine),Lg(e&&e.label);var i=t.markArea;Lg(i&&i.label),Pg(t,"axisLabel"),Pg(t,"title"),Pg(t,"detail");var n,r=t.data;if(r)for(var o=0;o<r.length;o++)Eg(r[o]),Lg(r[o]&&r[o].label);if((n=t.markPoint)&&n.data){var a=n.data;for(o=0;o<a.length;o++)Eg(a[o]),Lg(a[o]&&a[o].label)}if((e=t.markLine)&&e.data){var s=e.data;for(o=0;o<s.length;o++)za.isArray(s[o])?(Eg(s[o][0]),Lg(s[o][0]&&s[o][0].label),Eg(s[o][1]),Lg(s[o][1]&&s[o][1].label)):(Eg(s[o]),Lg(s[o]&&s[o].label))}}}(t)});var i=["xAxis","yAxis","radiusAxis","angleAxis","singleAxis","parallelAxis","radar"];t&&i.push("valueAxis","categoryAxis","logAxis","timeAxis"),Tg(i,function(t){Tg(Ig(e[t]),function(t){t&&(Pg(t,"axisLabel"),Pg(t.axisPointer,"label"))})}),Tg(Ig(e.parallel),function(t){var e=t&&t.parallelAxisDefault;Pg(e,"axisLabel"),Pg(e&&e.axisPointer,"label")}),Tg(Ig(e.calendar),function(t){Pg(t,"dayLabel"),Pg(t,"monthLabel"),Pg(t,"yearLabel")}),Tg(Ig(e.radar),function(t){Pg(t,"name")}),Tg(Ig(e.geo),function(t){Cg(t)&&(Lg(t.label),Tg(Ig(t.regions),function(t){Lg(t.label)}))}),Lg(Rg(e.timeline).label),Pg(Rg(e.axisPointer),"label"),Pg(Rg(e.tooltip).axisPointer,"label")},Og=za.each,kg=za.isArray,zg=za.isObject,Ng=If.normalizeToArray;function Bg(e){Og(Fg,function(t){t[0]in e&&!(t[1]in e)&&(e[t[1]]=e[t[0]])})}var Fg=[["x","left"],["y","top"],["x2","right"],["y2","bottom"]],Gg=["grid","geo","parallel","legend","toolbox","title","visualMap","dataZoom","timeline"],Vg=["bar","boxplot","candlestick","chord","effectScatter","funnel","gauge","lines","graph","heatmap","line","map","parallel","pie","radar","sankey","scatter","treemap"];var Hg=function(i,t){Dg(i,t),i.series=Ng(i.series),Og(i.series,function(t){if(zg(t)){var e=t.type;if("pie"!==e&&"gauge"!==e||null!=t.clockWise&&(t.clockwise=t.clockWise),"gauge"===e){var i=function(t,e){e=e.split(",");for(var i=t,n=0;n<e.length&&null!=(i=i&&i[e[n]]);n++);return i}(t,"pointer.color");null!=i&&function(t,e,i,n){e=e.split(",");for(var r,o=t,a=0;a<e.length-1;a++)null==o[r=e[a]]&&(o[r]={}),o=o[r];(n||null==o[e[a]])&&(o[e[a]]=i)}(t,"itemStyle.normal.color",i)}for(var n=0;n<Vg.length;n++)if(Vg[n]===t.type){Bg(t);break}}}),i.dataRange&&(i.visualMap=i.dataRange),Og(Gg,function(t){var e=i[t];e&&(kg(e)||(e=[e]),Og(e,function(t){Bg(t)}))})},Ug=Yc.formatTime,Wg=Yc.encodeHTML,jg=Yc.addCommas,Zg=Yc.getTooltipMarker,Xg=iu.set,qg=iu.get,Yg=jf.getLayoutParams,Jg=jf.mergeLayoutParam,Kg=Yf.extend({type:"series.__base__",seriesIndex:0,coordinateSystem:null,defaultOption:null,legendDataProvider:null,visualColorAccessPath:"itemStyle.normal.color",layoutMode:null,init:function(t,e,i,n){this.seriesIndex=this.componentIndex,this.mergeDefaultAndTheme(t,i);var r=this.getInitialData(t,i);Xg(this,"dataBeforeProcessed",r),this.restoreData()},mergeDefaultAndTheme:function(t,e){var i=this.layoutMode,n=i?Yg(t):{},r=this.subType;Yf.hasClass(r)&&(r+="Series"),za.merge(t,e.getTheme().get(this.subType)),za.merge(t,this.getDefaultOption()),If.defaultEmphasis(t.label,["show"]),this.fillDataTextStyle(t.data),i&&Jg(t,n,i)},mergeOption:function(t,e){t=za.merge(this.option,t,!0),this.fillDataTextStyle(t.data);var i=this.layoutMode;i&&Jg(this.option,t,i);var n=this.getInitialData(t,e);n&&(Xg(this,"data",n),Xg(this,"dataBeforeProcessed",n.cloneShallow()))},fillDataTextStyle:function(t){if(t)for(var e=["show"],i=0;i<t.length;i++)t[i]&&t[i].label&&If.defaultEmphasis(t[i].label,e)},getInitialData:function(){},getData:function(t){var e=qg(this,"data");return null==t?e:e.getLinkedData(t)},setData:function(t){Xg(this,"data",t)},getRawData:function(){return qg(this,"dataBeforeProcessed")},coordDimToDataDim:function(t){return If.coordDimToDataDim(this.getData(),t)},dataDimToCoordDim:function(t){return If.dataDimToCoordDim(this.getData(),t)},getBaseAxis:function(){var t=this.coordinateSystem;return t&&t.getBaseAxis&&t.getBaseAxis()},formatTooltip:function(n,s,t){var l=qg(this,"data"),e=this.getRawValue(n),i=za.isArray(e)?function(t){var o=za.reduce(t,function(t,e,i){var n=l.getDimensionInfo(i);return t|(n&&!1!==n.tooltip&&null!=n.tooltipName)},0),a=[],e=If.otherDimToDataDim(l,"tooltip");function i(t,e){var i=l.getDimensionInfo(e);if(i&&!1!==i.otherDims.tooltip){var n=i.type,r=(o?"- "+(i.tooltipName||i.name)+": ":"")+("ordinal"===n?t+"":"time"===n?s?"":Ug("yyyy/MM/dd hh:mm:ss",t):jg(t));r&&a.push(Wg(r))}}return e.length?za.each(e,function(t){i(l.get(t,n),t)}):za.each(t,i),(o?"<br/>":"")+a.join(o?"<br/>":", ")}(e):Wg(jg(e)),r=l.getName(n),o=l.getItemVisual(n,"color");za.isObject(o)&&o.colorStops&&(o=(o.colorStops[0]||{}).color);var a=Zg(o=o||"transparent"),h=this.name;return"\0-"===h&&(h=""),h=h?Wg(h)+(s?": ":"<br/>"):"",s?a+h+i:h+a+(r?Wg(r)+": "+i:i)},isAnimationEnabled:function(){if(ca.node)return!1;var t=this.getShallow("animation");return t&&this.getData().count()>this.getShallow("animationThreshold")&&(t=!1),t},restoreData:function(){Xg(this,"data",qg(this,"dataBeforeProcessed").cloneShallow())},getColorFromPalette:function(t,e){var i=this.ecModel,n=tg.getColorFromPalette.call(this,t,e);return n||(n=i.getColorFromPalette(t,e)),n},getAxisTooltipData:null,getTooltipPosition:null});za.mixin(Kg,If.dataFormatMixin),za.mixin(Kg,tg);var Qg=Kg,$g=function(){this.group=new Sl,this.uid=Of.getUID("viewComponent")},tm=$g.prototype={constructor:$g,init:function(t,e){},render:function(t,e,i,n){},dispose:function(){}};tm.updateView=tm.updateLayout=tm.updateVisual=function(t,e,i,n){},iu.enableClassExtend($g),iu.enableClassManagement($g,{registerWhenExtend:!0});var em=$g;function im(){this.group=new Sl,this.uid=Of.getUID("viewChart")}var nm=im.prototype={type:"chart",init:function(t,e){},render:function(t,e,i,n){},highlight:function(t,e,i,n){om(t.getData(),n,"emphasis")},downplay:function(t,e,i,n){om(t.getData(),n,"normal")},remove:function(t,e){this.group.removeAll()},dispose:function(){}};function rm(t,e){if(t&&(t.trigger(e),"group"===t.type))for(var i=0;i<t.childCount();i++)rm(t.childAt(i),e)}function om(e,t,i){var n=If.queryDataIndex(e,t);null!=n?za.each(If.normalizeToArray(n),function(t){rm(e.getItemGraphicEl(t),i)}):e.eachItemGraphicEl(function(t){rm(t,i)})}nm.updateView=nm.updateLayout=nm.updateVisual=function(t,e,i,n){this.render(t,e,i,n)},iu.enableClassExtend(im,["dispose"]),iu.enableClassManagement(im,{registerWhenExtend:!0});var am=im,sm="\0__throttleOriginMethod",lm="\0__throttleRate",hm="\0__throttleType";function cm(t,i,n){var r,o,a,s,l,h=0,c=0,u=null;function d(){c=(new Date).getTime(),u=null,t.apply(a,s||[])}i=i||0;var e=function(){r=(new Date).getTime(),a=this,s=arguments;var t=l||i,e=l||n;l=null,o=r-(e?h:c)-t,clearTimeout(u),e?u=setTimeout(d,t):0<=o?d():u=setTimeout(d,-o),h=r};return e.clear=function(){u&&(clearTimeout(u),u=null)},e.debounceNextCall=function(t){l=t},e}var um={throttle:cm,createOrUpdate:function(t,e,i,n){var r=t[e];if(r){var o=r[sm]||r,a=r[hm];if(r[lm]!==i||a!==n){if(null==i||!n)return t[e]=o;(r=t[e]=cm(o,i,"debounce"===n))[sm]=o,r[hm]=n,r[lm]=i}return r}},clear:function(t,e){var i=t[e];i&&i[sm]&&(t[e]=i[sm])}};var dm=function(t){t.eachRawSeries(function(e){var i=(e.visualColorAccessPath||"itemStyle.normal.color").split("."),n=e.getData(),r=e.get(i)||e.getColorFromPalette(e.get("name"));n.setVisual("color",r),t.isSeriesFiltered(e)||("function"!=typeof r||r instanceof yp||n.each(function(t){n.setItemVisual(t,"color",r(e.getDataParams(t)))}),n.each(function(t){var e=n.getItemModel(t).get(i,!0);null!=e&&n.setItemVisual(t,"color",e)}))})},pm=Math.PI;var fm=function(n,t){t=t||{},za.defaults(t,{text:"loading",color:"#c23531",textColor:"#000",maskColor:"rgba(255, 255, 255, 0.8)",zlevel:0});var r=new pf.Rect({style:{fill:t.maskColor},zlevel:t.zlevel,z:1e4}),o=new pf.Arc({shape:{startAngle:-pm/2,endAngle:-pm/2+.1,r:10},style:{stroke:t.color,lineCap:"round",lineWidth:5},zlevel:t.zlevel,z:10001}),a=new pf.Rect({style:{fill:"none",text:t.text,textPosition:"right",textDistance:10,textFill:t.textColor},zlevel:t.zlevel,z:10001});o.animateShape(!0).when(1e3,{endAngle:3*pm/2}).start("circularInOut"),o.animateShape(!0).when(1e3,{startAngle:3*pm/2}).delay(300).start("circularInOut");var e=new pf.Group;return e.add(o),e.add(a),e.add(r),e.resize=function(){var t=n.getWidth()/2,e=n.getHeight()/2;o.setShape({cx:t,cy:e});var i=o.shape.r;a.setShape({x:t-i,y:e-i,width:2*i,height:2*i}),r.setShape({x:0,y:0,width:n.getWidth(),height:n.getHeight()})},e.resize(),e};function gm(t){return t}function mm(t,e,i,n,r){this._old=t,this._new=e,this._oldKeyGetter=i||gm,this._newKeyGetter=n||gm,this.context=r}function vm(t,e,i,n,r){for(var o=0;o<t.length;o++){var a="_ec_"+r[n](t[o],o),s=e[a];null==s?(i.push(a),e[a]=o):(s.length||(e[a]=s=[s]),s.push(o))}}mm.prototype={constructor:mm,add:function(t){return this._add=t,this},update:function(t){return this._update=t,this},remove:function(t){return this._remove=t,this},execute:function(){var t=this._old,e=this._new,i={},n=[],r=[];for(vm(t,{},n,"_oldKeyGetter",this),vm(e,i,r,"_newKeyGetter",this),o=0;o<t.length;o++){if(null!=(s=i[a=n[o]]))(h=s.length)?(1===h&&(i[a]=null),s=s.unshift()):i[a]=null,this._update&&this._update(s,o);else this._remove&&this._remove(o)}for(var o=0;o<r.length;o++){var a=r[o];if(i.hasOwnProperty(a)){var s;if(null==(s=i[a]))continue;if(s.length)for(var l=0,h=s.length;l<h;l++)this._add&&this._add(s[l]);else this._add&&this._add(s)}}}};var ym=mm,_m=za.isObject,xm="undefined",wm=typeof window===xm?Wi:window,bm={float:typeof wm.Float64Array===xm?Array:wm.Float64Array,int:typeof wm.Int32Array===xm?Array:wm.Int32Array,ordinal:Array,number:Array,time:Array},Mm=["stackedOn","hasItemOption","_nameList","_idList","_rawData"];function Sm(e,i){za.each(Mm.concat(i.__wrappedMethods||[]),function(t){i.hasOwnProperty(t)&&(e[t]=i[t])}),e.__wrappedMethods=i.__wrappedMethods}function Tm(t){this._array=t||[]}Tm.prototype.pure=!1,Tm.prototype.count=function(){return this._array.length},Tm.prototype.getItem=function(t){return this._array[t]};var Cm=function(t,e){t=t||["x","y"];for(var i={},n=[],r=0;r<t.length;r++){var o,a={};"string"==typeof t[r]?a={name:o=t[r],coordDim:o,coordDimIndex:0,stackable:!1,type:"number"}:(o=(a=t[r]).name,a.type=a.type||"number",a.coordDim||(a.coordDim=o,a.coordDimIndex=0)),a.otherDims=a.otherDims||{},n.push(o),i[o]=a}this.dimensions=n,this._dimensionInfos=i,this.hostModel=e,this.dataType,this.indices=[],this._storage={},this._nameList=[],this._idList=[],this._optionModels=[],this.stackedOn=null,this._visual={},this._layout={},this._itemVisuals=[],this._itemLayouts=[],this._graphicEls=[],this._rawData,this._extent},Am=Cm.prototype;function Em(t){return za.isArray(t)||(t=[t]),t}function Pm(t,e){var i=t.dimensions,n=new Cm(za.map(i,t.getDimensionInfo,t),t.hostModel);Sm(n,t);for(var r=n._storage={},o=t._storage,a=0;a<i.length;a++){var s=i[a],l=o[s];0<=za.indexOf(e,s)?r[s]=new l.constructor(o[s].length):r[s]=o[s]}return n}Am.type="list",Am.hasItemOption=!0,Am.getDimension=function(t){return isNaN(t)||(t=this.dimensions[t]||t),t},Am.getDimensionInfo=function(t){return za.clone(this._dimensionInfos[this.getDimension(t)])},Am.initData=function(t,e,i){t=t||[],za.isArray(t)&&(t=new Tm(t)),this._rawData=t;var n,r=this._storage={},o=this.indices=[],a=this.dimensions,s=this._dimensionInfos,l=t.count(),h=[],c={};e=e||[];for(var u=0;u<a.length;u++){var d=s[a[u]];0===d.otherDims.itemName&&(n=u);var p=bm[d.type];r[a[u]]=new p(l)}var f=this;i||(f.hasItemOption=!1),i=i||function(t,e,i,n){var r=If.getDataItemValue(t);return If.isDataItemOption(t)&&(f.hasItemOption=!0),If.converDataValue(r instanceof Array?r[n]:r,s[e])};for(u=0;u<l;u++){for(var g=t.getItem(u),m=0;m<a.length;m++){var v=a[m];r[v][u]=i(g,v,u,m)}o.push(u)}for(u=0;u<l;u++){g=t.getItem(u);!e[u]&&g&&(null!=g.name?e[u]=g.name:null!=n&&(e[u]=r[a[n]][u]));var y=e[u]||"",_=g&&g.id;!_&&y&&(c[y]=c[y]||0,0<c[_=y]&&(_+="__ec__"+c[y]),c[y]++),_&&(h[u]=_)}this._nameList=e,this._idList=h},Am.count=function(){return this.indices.length},Am.get=function(t,e,i){var n=this._storage,r=this.indices[e];if(null==r||!n[t])return NaN;var o=n[t][r];if(i){var a=this._dimensionInfos[t];if(a&&a.stackable)for(var s=this.stackedOn;s;){var l=s.get(t,e);(0<=o&&0<l||o<=0&&l<0)&&(o+=l),s=s.stackedOn}}return o},Am.getValues=function(t,e,i){var n=[];za.isArray(t)||(i=e,e=t,t=this.dimensions);for(var r=0,o=t.length;r<o;r++)n.push(this.get(t[r],e,i));return n},Am.hasValue=function(t){for(var e=this.dimensions,i=this._dimensionInfos,n=0,r=e.length;n<r;n++)if("ordinal"!==i[e[n]].type&&isNaN(this.get(e[n],t)))return!1;return!0},Am.getDataExtent=function(t,e,i){t=this.getDimension(t);var n=this._storage[t],r=this.getDimensionInfo(t);e=r&&r.stackable&&e;var o,a=(this._extent||(this._extent={}))[t+!!e];if(a)return a;if(n){for(var s=1/0,l=-1/0,h=0,c=this.count();h<c;h++)o=this.get(t,h,e),i&&!i(o,t,h)||(o<s&&(s=o),l<o&&(l=o));return this._extent[t+!!e]=[s,l]}return[1/0,-1/0]},Am.getSum=function(t,e){var i=0;if(this._storage[t])for(var n=0,r=this.count();n<r;n++){var o=this.get(t,n,e);isNaN(o)||(i+=o)}return i},Am.indexOf=function(t,e){var i=this._storage[t],n=this.indices;if(i)for(var r=0,o=n.length;r<o;r++){if(i[n[r]]===e)return r}return-1},Am.indexOfName=function(t){for(var e=this.indices,i=this._nameList,n=0,r=e.length;n<r;n++){if(i[e[n]]===t)return n}return-1},Am.indexOfRawIndex=function(t){var e=this.indices,i=e[t];if(null!=i&&i===t)return t;for(var n=0,r=e.length-1;n<=r;){var o=(n+r)/2|0;if(e[o]<t)n=o+1;else{if(!(e[o]>t))return o;r=o-1}}return-1},Am.indicesOfNearest=function(t,e,i,n){var r=[];if(!this._storage[t])return r;null==n&&(n=1/0);for(var o=Number.MAX_VALUE,a=-1,s=0,l=this.count();s<l;s++){var h=e-this.get(t,s,i),c=Math.abs(h);h<=n&&c<=o&&((c<o||0<=h&&a<0)&&(o=c,a=h,r.length=0),r.push(s))}return r},Am.getRawIndex=function(t){var e=this.indices[t];return null==e?-1:e},Am.getRawDataItem=function(t){return this._rawData.getItem(this.getRawIndex(t))},Am.getName=function(t){return this._nameList[this.indices[t]]||""},Am.getId=function(t){return this._idList[this.indices[t]]||this.getRawIndex(t)+""},Am.each=function(t,e,i,n){"function"==typeof t&&(n=i,i=e,e=t,t=[]);var r=[],o=(t=za.map(Em(t),this.getDimension,this)).length,a=this.indices;n=n||this;for(var s=0;s<a.length;s++)switch(o){case 0:e.call(n,s);break;case 1:e.call(n,this.get(t[0],s,i),s);break;case 2:e.call(n,this.get(t[0],s,i),this.get(t[1],s,i),s);break;default:for(var l=0;l<o;l++)r[l]=this.get(t[l],s,i);r[l]=s,e.apply(n,r)}},Am.filterSelf=function(t,e,i,n){"function"==typeof t&&(n=i,i=e,e=t,t=[]);var r=[],o=[],a=(t=za.map(Em(t),this.getDimension,this)).length,s=this.indices;n=n||this;for(var l=0;l<s.length;l++){var h;if(a)if(1===a)h=e.call(n,this.get(t[0],l,i),l);else{for(var c=0;c<a;c++)o[c]=this.get(t[c],l,i);o[c]=l,h=e.apply(n,o)}else h=e.call(n,l);h&&r.push(s[l])}return this.indices=r,this._extent={},this},Am.mapArray=function(t,e,i,n){"function"==typeof t&&(n=i,i=e,e=t,t=[]);var r=[];return this.each(t,function(){r.push(e&&e.apply(this,arguments))},i,n),r},Am.map=function(a,s,t,e){var i=Pm(this,a=za.map(Em(a),this.getDimension,this)),l=i.indices=this.indices,h=i._storage,c=[];return this.each(a,function(){var t=arguments[arguments.length-1],e=s&&s.apply(this,arguments);if(null!=e){"number"==typeof e&&(c[0]=e,e=c);for(var i=0;i<e.length;i++){var n=a[i],r=h[n],o=l[t];r&&(r[o]=e[i])}}},t,e),i},Am.downSample=function(t,e,i,n){for(var r=Pm(this,[t]),o=this._storage,a=r._storage,s=this.indices,l=r.indices=[],h=[],c=[],u=Math.floor(1/e),d=a[t],p=this.count(),f=0;f<o[t].length;f++)a[t][f]=o[t][f];for(f=0;f<p;f+=u){p-f<u&&(u=p-f,h.length=u);for(var g=0;g<u;g++){var m=s[f+g];h[g]=d[m],c[g]=m}var v=i(h);d[m=c[n(h,v)||0]]=v,l.push(m)}return r},Am.getItemModel=function(t){var e=this.hostModel;return t=this.indices[t],new bf(this._rawData.getItem(t),e,e&&e.ecModel)},Am.diff=function(t){var e,i=this._idList,n=t&&t._idList;return new ym(t?t.indices:[],this.indices,function(t){return null!=(e=n[t])?e:"e\0\0"+t},function(t){return null!=(e=i[t])?e:"e\0\0"+t})},Am.getVisual=function(t){var e=this._visual;return e&&e[t]},Am.setVisual=function(t,e){if(_m(t))for(var i in t)t.hasOwnProperty(i)&&this.setVisual(i,t[i]);else this._visual=this._visual||{},this._visual[t]=e},Am.setLayout=function(t,e){if(_m(t))for(var i in t)t.hasOwnProperty(i)&&this.setLayout(i,t[i]);else this._layout[t]=e},Am.getLayout=function(t){return this._layout[t]},Am.getItemLayout=function(t){return this._itemLayouts[t]},Am.setItemLayout=function(t,e,i){this._itemLayouts[t]=i?za.extend(this._itemLayouts[t]||{},e):e},Am.clearItemLayouts=function(){this._itemLayouts.length=0},Am.getItemVisual=function(t,e,i){var n=this._itemVisuals[t],r=n&&n[e];return null!=r||i?r:this.getVisual(e)},Am.setItemVisual=function(t,e,i){var n=this._itemVisuals[t]||{};if(this._itemVisuals[t]=n,_m(e))for(var r in e)e.hasOwnProperty(r)&&(n[r]=e[r]);else n[e]=i},Am.clearAllVisual=function(){this._visual={},this._itemVisuals=[]};var Lm=function(t){t.seriesIndex=this.seriesIndex,t.dataIndex=this.dataIndex,t.dataType=this.dataType};Am.setItemGraphicEl=function(t,e){var i=this.hostModel;e&&(e.dataIndex=t,e.dataType=this.dataType,e.seriesIndex=i&&i.seriesIndex,"group"===e.type&&e.traverse(Lm,e)),this._graphicEls[t]=e},Am.getItemGraphicEl=function(t){return this._graphicEls[t]},Am.eachItemGraphicEl=function(i,n){za.each(this._graphicEls,function(t,e){t&&i&&i.call(n,t,e)})},Am.cloneShallow=function(){var t=za.map(this.dimensions,this.getDimensionInfo,this),e=new Cm(t,this.hostModel);return e._storage=this._storage,Sm(e,this),e.indices=this.indices.slice(),this._extent&&(e._extent=za.extend({},this._extent)),e},Am.wrapMethod=function(t,e){var i=this[t];"function"==typeof i&&(this.__wrappedMethods=this.__wrappedMethods||[],this.__wrappedMethods.push(t),this[t]=function(){var t=i.apply(this,arguments);return e.apply(this,[t].concat(za.slice(arguments)))})},Am.TRANSFERABLE_METHODS=["cloneShallow","downSample","map"],Am.CHANGABLE_METHODS=["filterSelf"];var Im=Cm,Rm=If.normalizeToArray,Dm=za.each,Om=za.isString,km=za.defaults,zm={tooltip:1,label:1,itemName:1};function Nm(t,e,i){e=e||[],i=i||{},t=(t||[]).slice();var n=(i.dimsDef||[]).slice(),s=za.createHashMap(i.encodeDef),r=za.createHashMap(),o=za.createHashMap(),l=[],a=i.dimCount;if(null==a){var h=Fm(e[0]);a=Math.max(za.isArray(h)&&h.length||1,t.length,n.length),Dm(t,function(t){var e=t.dimsDef;e&&(a=Math.max(a,e.length))})}for(var c=0;c<a;c++){var u=Om(n[c])?{name:n[c]}:n[c]||{},d=u.name,p=l[c]={otherDims:{}};null!=d&&null==r.get(d)&&(p.name=p.tooltipName=d,r.set(d,c)),null!=u.type&&(p.type=u.type)}s.each(function(i,n){i=s.set(n,Rm(i).slice()),Dm(i,function(t,e){Om(t)&&(t=r.get(t)),null!=t&&t<a&&(i[e]=t,v(l[t],n,e))})});var f=0;Dm(t,function(n,t){var r,o,a;Om(n)?(r=n,n={}):(r=n.name,n=za.clone(n),o=n.dimsDef,a=n.otherDims,n.name=n.coordDim=n.coordDimIndex=n.dimsDef=n.otherDims=null);var e=Rm(s.get(r));if(!e.length)for(var i=0;i<(o&&o.length||1);i++){for(;f<l.length&&null!=l[f].coordDim;)f++;f<l.length&&e.push(f++)}Dm(e,function(t,e){var i=l[t];v(km(i,n),r,e),null==i.name&&o&&(i.name=i.tooltipName=o[e]),a&&km(i.otherDims,a)})});for(var g=i.extraPrefix||"value",m=0;m<a;m++){null==(p=l[m]=l[m]||{}).coordDim&&(p.coordDim=y(g,o,i.extraFromZero),p.coordDimIndex=0,p.isExtraCoord=!0),null==p.name&&(p.name=y(p.coordDim,r)),null==p.type&&Bm(e,m)&&(p.type="ordinal")}return l;function v(t,e,i){zm[e]?t.otherDims[e]=i:(t.coordDim=e,t.coordDimIndex=i,o.set(e,!0))}function y(t,e,i){if(i||null!=e.get(t)){for(var n=0;null!=e.get(t+n);)n++;t+=n}return e.set(t,!0),t}}var Bm=Nm.guessOrdinal=function(t,e){for(var i=0,n=t.length;i<n;i++){var r=Fm(t[i]);if(!za.isArray(r))return!1;if(null!=(r=r[e])&&isFinite(r)&&""!==r)return!1;if(Om(r)&&"-"!==r)return!0}return!1};function Fm(t){return za.isArray(t)?t:za.isObject(t)?t.value:t}var Gm=Nm,Vm=If.getDataItemValue,Hm=If.converDataValue,Um=If.isDataItemOption;function Wm(t){return"category"!==t&&"time"!==t}function jm(t){return"category"===t?"ordinal":"time"===t?"time":"float"}var Zm={cartesian2d:function(t,e,i,n){var r=za.map(["xAxis","yAxis"],function(t){return i.queryComponents({mainType:t,index:e.get(t+"Index"),id:e.get(t+"Id")})[0]}),o=r[0],a=r[1],s=o.get("type"),l=a.get("type"),h=[{name:"x",type:jm(s),stackable:Wm(s)},{name:"y",type:jm(l),stackable:Wm(l)}],c="category"===s,u="category"===l;h=Gm(h,t,n);var d={};return c&&(d.x=o),u&&(d.y=a),{dimensions:h,categoryIndex:c?0:u?1:-1,categoryAxesModels:d}},singleAxis:function(t,e,i,n){var r=i.queryComponents({mainType:"singleAxis",index:e.get("singleAxisIndex"),id:e.get("singleAxisId")})[0],o=r.get("type"),a="category"===o,s=[{name:"single",type:jm(o),stackable:Wm(o)}];s=Gm(s,t,n);var l={};return a&&(l.single=r),{dimensions:s,categoryIndex:a?0:-1,categoryAxesModels:l}},polar:function(t,e,i,n){var r=i.queryComponents({mainType:"polar",index:e.get("polarIndex"),id:e.get("polarId")})[0],o=r.findAxisModel("angleAxis"),a=r.findAxisModel("radiusAxis"),s=a.get("type"),l=o.get("type"),h=[{name:"radius",type:jm(s),stackable:Wm(s)},{name:"angle",type:jm(l),stackable:Wm(l)}],c="category"===l,u="category"===s;h=Gm(h,t,n);var d={};return u&&(d.radius=a),c&&(d.angle=o),{dimensions:h,categoryIndex:c?1:u?0:-1,categoryAxesModels:d}},geo:function(t,e,i,n){return{dimensions:Gm([{name:"lng"},{name:"lat"}],t,n)}}};var Xm=function(t,e,i){t=t||[];var n=e.get("coordinateSystem"),r=Zm[n],o=mg.get(n),a={encodeDef:e.get("encode"),dimsDef:e.get("dimensions")},s=r&&r(t,e,i,a),l=s&&s.dimensions;l||(l=o&&(o.getDimensionsInfo?o.getDimensionsInfo():o.dimensions.slice())||["x","y"],l=Gm(l,t,a));var h,c=s?s.categoryIndex:-1,u=new Im(l,e),d=function(t,e){var i,n=[],r=t&&t.dimensions[t.categoryIndex];if(r&&(i=t.categoryAxesModels[r.name]),i){var o=i.getCategories();if(o){var a=e.length;if(za.isArray(e[0])&&1<e[0].length){n=[];for(var s=0;s<a;s++)n[s]=o[e[s][t.categoryIndex||0]]}else n=o.slice(0)}}return n}(s,t),p={},f=0<=c&&null!=(h=function(t){for(var e=0;e<t.length&&null==t[e];)e++;return t[e]}(t))&&!za.isArray(Vm(h))?function(t,e,i,n){return Um(t)&&(u.hasItemOption=!0),n===c?i:Hm(Vm(t),l[n])}:function(t,e,i,n){var r=Vm(t),o=Hm(r&&r[n],l[n]);Um(t)&&(u.hasItemOption=!0);var a=s&&s.categoryAxesModels;return a&&a[e]&&"string"==typeof o&&(p[e]=p[e]||a[e].getCategories(),(o=za.indexOf(p[e],o))<0&&!isNaN(o)&&(o=+o)),o};return u.hasItemOption=!1,u.initData(t,d,f),u};function qm(t){this._setting=t||{},this._extent=[1/0,-1/0],this._interval=0,this.init&&this.init.apply(this,arguments)}qm.prototype.parse=function(t){return t},qm.prototype.getSetting=function(t){return this._setting[t]},qm.prototype.contain=function(t){var e=this._extent;return t>=e[0]&&t<=e[1]},qm.prototype.normalize=function(t){var e=this._extent;return e[1]===e[0]?.5:(t-e[0])/(e[1]-e[0])},qm.prototype.scale=function(t){var e=this._extent;return t*(e[1]-e[0])+e[0]},qm.prototype.unionExtent=function(t){var e=this._extent;t[0]<e[0]&&(e[0]=t[0]),t[1]>e[1]&&(e[1]=t[1])},qm.prototype.unionExtentFromData=function(t,e){this.unionExtent(t.getDataExtent(e,!0))},qm.prototype.getExtent=function(){return this._extent.slice()},qm.prototype.setExtent=function(t,e){var i=this._extent;isNaN(t)||(i[0]=t),isNaN(e)||(i[1]=e)},qm.prototype.getTicksLabels=function(){for(var t=[],e=this.getTicks(),i=0;i<e.length;i++)t.push(this.getLabel(e[i]));return t},qm.prototype.isBlank=function(){return this._isBlank},qm.prototype.setBlank=function(t){this._isBlank=t},iu.enableClassExtend(qm),iu.enableClassManagement(qm,{registerWhenExtend:!0});var Ym=qm,Jm=Ym.prototype,Km=Ym.extend({type:"ordinal",init:function(t,e){this._data=t,this._extent=e||[0,t.length-1]},parse:function(t){return"string"==typeof t?za.indexOf(this._data,t):Math.round(t)},contain:function(t){return t=this.parse(t),Jm.contain.call(this,t)&&null!=this._data[t]},normalize:function(t){return Jm.normalize.call(this,this.parse(t))},scale:function(t){return Math.round(Jm.scale.call(this,t))},getTicks:function(){for(var t=[],e=this._extent,i=e[0];i<=e[1];)t.push(i),i++;return t},getLabel:function(t){return this._data[t]},count:function(){return this._extent[1]-this._extent[0]+1},unionExtentFromData:function(t,e){this.unionExtent(t.getDataExtent(e,!1))},niceTicks:za.noop,niceExtent:za.noop});Km.create=function(){return new Km};var Qm=Km,$m=Uc.round;function tv(t){return Uc.getPrecisionSafe(t)+2}function ev(t,e,i){t[e]=Math.max(Math.min(t[e],i[1]),i[0])}function iv(t,e){!isFinite(t[0])&&(t[0]=e[0]),!isFinite(t[1])&&(t[1]=e[1]),ev(t,0,e),ev(t,1,e),t[0]>t[1]&&(t[0]=t[1])}var nv={intervalScaleNiceTicks:function(t,e,i,n){var r={},o=t[1]-t[0],a=r.interval=Uc.nice(o/e,!0);null!=i&&a<i&&(a=r.interval=i),null!=n&&n<a&&(a=r.interval=n);var s=r.intervalPrecision=tv(a);return iv(r.niceTickExtent=[$m(Math.ceil(t[0]/a)*a,s),$m(Math.floor(t[1]/a)*a,s)],t),r},getIntervalPrecision:tv,fixExtent:iv,intervalScaleGetTicks:function(t,e,i,n){var r=[];if(!t)return r;e[0]<i[0]&&r.push(e[0]);for(var o=i[0];o<=i[1]&&(r.push(o),(o=$m(o+t,n))!==r[r.length-1]);)if(1e4<r.length)return[];return e[1]>(r.length?r[r.length-1]:i[1])&&r.push(e[1]),r}},rv=Uc.round,ov=Ym.extend({type:"interval",_interval:0,_intervalPrecision:2,setExtent:function(t,e){var i=this._extent;isNaN(t)||(i[0]=parseFloat(t)),isNaN(e)||(i[1]=parseFloat(e))},unionExtent:function(t){var e=this._extent;t[0]<e[0]&&(e[0]=t[0]),t[1]>e[1]&&(e[1]=t[1]),ov.prototype.setExtent.call(this,e[0],e[1])},getInterval:function(){return this._interval},setInterval:function(t){this._interval=t,this._niceExtent=this._extent.slice(),this._intervalPrecision=nv.getIntervalPrecision(t)},getTicks:function(){return nv.intervalScaleGetTicks(this._interval,this._extent,this._niceExtent,this._intervalPrecision)},getTicksLabels:function(){for(var t=[],e=this.getTicks(),i=0;i<e.length;i++)t.push(this.getLabel(e[i]));return t},getLabel:function(t,e){if(null==t)return"";var i=e&&e.precision;return null==i?i=Uc.getPrecisionSafe(t)||0:"auto"===i&&(i=this._intervalPrecision),t=rv(t,i,!0),Yc.addCommas(t)},niceTicks:function(t,e,i){t=t||5;var n=this._extent,r=n[1]-n[0];if(isFinite(r)){r<0&&(r=-r,n.reverse());var o=nv.intervalScaleNiceTicks(n,t,e,i);this._intervalPrecision=o.intervalPrecision,this._interval=o.interval,this._niceExtent=o.niceTickExtent}},niceExtent:function(t){var e=this._extent;if(e[0]===e[1])if(0!==e[0]){var i=e[0];t.fixMax||(e[1]+=i/2),e[0]-=i/2}else e[1]=1;var n=e[1]-e[0];isFinite(n)||(e[0]=0,e[1]=1),this.niceTicks(t.splitNumber,t.minInterval,t.maxInterval);var r=this._interval;t.fixMin||(e[0]=rv(Math.floor(e[0]/r)*r)),t.fixMax||(e[1]=rv(Math.ceil(e[1]/r)*r))}});ov.create=function(){return new ov};var av=ov,sv=av.prototype,lv=Math.ceil,hv=Math.floor,cv=36e5,uv=864e5,dv=av.extend({type:"time",getLabel:function(t){var e=this._stepLvl,i=new Date(t);return Yc.formatTime(e[0],i,this.getSetting("useUTC"))},niceExtent:function(t){var e=this._extent;if(e[0]===e[1]&&(e[0]-=uv,e[1]+=uv),e[1]===-1/0&&e[0]===1/0){var i=new Date;e[1]=+new Date(i.getFullYear(),i.getMonth(),i.getDate()),e[0]=e[1]-uv}this.niceTicks(t.splitNumber,t.minInterval,t.maxInterval);var n=this._interval;t.fixMin||(e[0]=Uc.round(hv(e[0]/n)*n)),t.fixMax||(e[1]=Uc.round(lv(e[1]/n)*n))},niceTicks:function(t,e,i){t=t||10;var n=this._extent,r=n[1]-n[0],o=r/t;null!=e&&o<e&&(o=e),null!=i&&i<o&&(o=i);var a=pv.length,s=function(t,e,i,n){for(;i<n;){var r=i+n>>>1;t[r][1]<e?i=r+1:n=r}return i}(pv,o,0,a),l=pv[Math.min(s,a-1)],h=l[1];if("year"===l[0]){var c=r/h;h*=Uc.nice(c/t,!0)}var u=this.getSetting("useUTC")?0:60*new Date(+n[0]||+n[1]).getTimezoneOffset()*1e3,d=[Math.round(lv((n[0]-u)/h)*h+u),Math.round(hv((n[1]-u)/h)*h+u)];nv.fixExtent(d,n),this._stepLvl=l,this._interval=h,this._niceExtent=d},parse:function(t){return+Uc.parseDate(t)}});za.each(["contain","normalize"],function(e){dv.prototype[e]=function(t){return sv[e].call(this,this.parse(t))}});var pv=[["hh:mm:ss",1e3],["hh:mm:ss",5e3],["hh:mm:ss",1e4],["hh:mm:ss",15e3],["hh:mm:ss",3e4],["hh:mm\nMM-dd",6e4],["hh:mm\nMM-dd",3e5],["hh:mm\nMM-dd",6e5],["hh:mm\nMM-dd",9e5],["hh:mm\nMM-dd",18e5],["hh:mm\nMM-dd",cv],["hh:mm\nMM-dd",72e5],["hh:mm\nMM-dd",6*cv],["hh:mm\nMM-dd",432e5],["MM-dd\nyyyy",uv],["MM-dd\nyyyy",2*uv],["MM-dd\nyyyy",3*uv],["MM-dd\nyyyy",4*uv],["MM-dd\nyyyy",5*uv],["MM-dd\nyyyy",6*uv],["week",7*uv],["MM-dd\nyyyy",864e6],["week",14*uv],["week",21*uv],["month",31*uv],["week",42*uv],["month",62*uv],["week",42*uv],["quarter",8208e6],["month",31*uv*4],["month",13392e6],["half-year",16416e6],["month",31*uv*8],["month",26784e6],["year",380*uv]];dv.create=function(t){return new dv({useUTC:t.ecModel.get("useUTC")})};var fv=Ym.prototype,gv=av.prototype,mv=Uc.getPrecisionSafe,vv=Uc.round,yv=Math.floor,_v=Math.ceil,xv=Math.pow,wv=Math.log,bv=Ym.extend({type:"log",base:10,$constructor:function(){Ym.apply(this,arguments),this._originalScale=new av},getTicks:function(){var i=this._originalScale,n=this._extent,r=i.getExtent();return za.map(gv.getTicks.call(this),function(t){var e=Uc.round(xv(this.base,t));return e=t===n[0]&&i.__fixMin?Mv(e,r[0]):e,e=t===n[1]&&i.__fixMax?Mv(e,r[1]):e},this)},getLabel:gv.getLabel,scale:function(t){return t=fv.scale.call(this,t),xv(this.base,t)},setExtent:function(t,e){var i=this.base;t=wv(t)/wv(i),e=wv(e)/wv(i),gv.setExtent.call(this,t,e)},getExtent:function(){var t=this.base,e=fv.getExtent.call(this);e[0]=xv(t,e[0]),e[1]=xv(t,e[1]);var i=this._originalScale,n=i.getExtent();return i.__fixMin&&(e[0]=Mv(e[0],n[0])),i.__fixMax&&(e[1]=Mv(e[1],n[1])),e},unionExtent:function(t){this._originalScale.unionExtent(t);var e=this.base;t[0]=wv(t[0])/wv(e),t[1]=wv(t[1])/wv(e),fv.unionExtent.call(this,t)},unionExtentFromData:function(t,e){this.unionExtent(t.getDataExtent(e,!0,function(t){return 0<t}))},niceTicks:function(t){t=t||10;var e=this._extent,i=e[1]-e[0];if(!(i===1/0||i<=0)){var n=Uc.quantity(i);for(t/i*n<=.5&&(n*=10);!isNaN(n)&&Math.abs(n)<1&&0<Math.abs(n);)n*=10;var r=[Uc.round(_v(e[0]/n)*n),Uc.round(yv(e[1]/n)*n)];this._interval=n,this._niceExtent=r}},niceExtent:function(t){gv.niceExtent.call(this,t);var e=this._originalScale;e.__fixMin=t.fixMin,e.__fixMax=t.fixMax}});function Mv(t,e){return vv(t,mv(e))}function Sv(t,e){var i,n,r,o=t.type,a=e.getMin(),s=e.getMax(),l=null!=a,h=null!=s,c=t.getExtent();return"ordinal"===o?i=(e.get("data")||[]).length:(n=e.get("boundaryGap"),za.isArray(n)||(n=[n||0,n||0]),"boolean"==typeof n[0]&&(n=[0,0]),n[0]=Uc.parsePercent(n[0],1),n[1]=Uc.parsePercent(n[1],1),r=c[1]-c[0]||Math.abs(c[0])),null==a&&(a="ordinal"===o?i?0:NaN:c[0]-n[0]*r),null==s&&(s="ordinal"===o?i?i-1:NaN:c[1]+n[1]*r),"dataMin"===a?a=c[0]:"function"==typeof a&&(a=a({min:c[0],max:c[1]})),"dataMax"===s?s=c[1]:"function"==typeof s&&(s=s({min:c[0],max:c[1]})),(null==a||!isFinite(a))&&(a=NaN),(null==s||!isFinite(s))&&(s=NaN),t.setBlank(za.eqNaN(a)||za.eqNaN(s)),e.getNeedCrossZero()&&(0<a&&0<s&&!l&&(a=0),a<0&&s<0&&!h&&(s=0)),[a,s]}function Tv(t,e){return"category"===t.type?t.scale.getLabel(e):e}za.each(["contain","normalize"],function(e){bv.prototype[e]=function(t){return t=wv(t)/wv(this.base),fv[e].call(this,t)}}),bv.create=function(){return new bv};var Cv={getScaleExtent:Sv,niceScaleExtent:function(t,e){var i=Sv(t,e),n=null!=e.getMin(),r=null!=e.getMax(),o=e.get("splitNumber");"log"===t.type&&(t.base=e.get("logBase"));var a=t.type;t.setExtent(i[0],i[1]),t.niceExtent({splitNumber:o,fixMin:n,fixMax:r,minInterval:"interval"===a||"time"===a?e.get("minInterval"):null,maxInterval:"interval"===a||"time"===a?e.get("maxInterval"):null});var s=e.get("interval");null!=s&&t.setInterval&&t.setInterval(s)},createScaleByModel:function(t,e){if(e=e||t.get("type"))switch(e){case"category":return new Qm(t.getCategories(),[1/0,-1/0]);case"value":return new av;default:return(Ym.getClass(e)||av).create(t)}},ifAxisCrossZero:function(t){var e=t.scale.getExtent(),i=e[0],n=e[1];return!(0<i&&0<n||i<0&&n<0)},getAxisLabelInterval:function(t,e,i,n,r){var o,a=0,s=0,l=(n-r)/180*Math.PI,h=1;40<e.length&&(h=Math.floor(e.length/40));for(var c=0;c<t.length;c+=h){var u=t[c],d=Sh.getBoundingRect(e[c],i,"center","top");d.x+=u*Math.cos(l),d.y+=u*Math.sin(l),d.width*=1.3,d.height*=1.3,o?o.intersect(d)?(s++,a=Math.max(a,s)):(o.union(d),s=0):o=d.clone()}return 0===a&&1<h?h:(a+1)*h-1},getFormattedLabels:function(i,n){var e,t=i.scale,r=t.getTicksLabels(),o=t.getTicks();return"string"==typeof n?(e=n,n=function(t){return e.replace("{value}",null!=t?t:"")},za.map(r,n)):"function"==typeof n?za.map(o,function(t,e){return n(Tv(i,t),e)},this):r},getAxisRawValue:Tv};function Av(t){return za.isObject(t)&&null!=t.value?t.value:t+""}var Ev={getFormattedLabels:function(){return Cv.getFormattedLabels(this.axis,this.get("axisLabel.formatter"))},getCategories:function(){return"category"===this.get("type")&&za.map(this.get("data"),Av)},getMin:function(t){var e=this.option,i=t||null==e.rangeStart?e.min:e.rangeStart;return this.axis&&null!=i&&"dataMin"!==i&&"function"!=typeof i&&!za.eqNaN(i)&&(i=this.axis.scale.parse(i)),i},getMax:function(t){var e=this.option,i=t||null==e.rangeEnd?e.max:e.rangeEnd;return this.axis&&null!=i&&"dataMax"!==i&&"function"!=typeof i&&!za.eqNaN(i)&&(i=this.axis.scale.parse(i)),i},getNeedCrossZero:function(){var t=this.option;return null==t.rangeStart&&null==t.rangeEnd&&!t.scale},getCoordSysModel:za.noop,setRange:function(t,e){this.option.rangeStart=t,this.option.rangeEnd=e},resetRange:function(){this.option.rangeStart=this.option.rangeEnd=null}},Pv=pf.extendShape({type:"triangle",shape:{cx:0,cy:0,width:0,height:0},buildPath:function(t,e){var i=e.cx,n=e.cy,r=e.width/2,o=e.height/2;t.moveTo(i,n-o),t.lineTo(i+r,n+o),t.lineTo(i-r,n+o),t.closePath()}}),Lv=pf.extendShape({type:"diamond",shape:{cx:0,cy:0,width:0,height:0},buildPath:function(t,e){var i=e.cx,n=e.cy,r=e.width/2,o=e.height/2;t.moveTo(i,n-o),t.lineTo(i+r,n),t.lineTo(i,n+o),t.lineTo(i-r,n),t.closePath()}}),Iv=pf.extendShape({type:"pin",shape:{x:0,y:0,width:0,height:0},buildPath:function(t,e){var i=e.x,n=e.y,r=e.width/5*3,o=Math.max(r,e.height),a=r/2,s=a*a/(o-a),l=n-o+a+s,h=Math.asin(s/a),c=Math.cos(h)*a,u=Math.sin(h),d=Math.cos(h),p=.6*a,f=.7*a;t.moveTo(i-c,l+s),t.arc(i,l,a,Math.PI-h,2*Math.PI+h),t.bezierCurveTo(i+c-u*p,l+s+d*p,i,n-f,i,n),t.bezierCurveTo(i,n-f,i-c+u*p,l+s+d*p,i-c,l+s),t.closePath()}}),Rv=pf.extendShape({type:"arrow",shape:{x:0,y:0,width:0,height:0},buildPath:function(t,e){var i=e.height,n=e.width,r=e.x,o=e.y,a=n/3*2;t.moveTo(r,o),t.lineTo(r+a,o+i),t.lineTo(r,o+i/4*3),t.lineTo(r-a,o+i),t.lineTo(r,o),t.closePath()}}),Dv={line:pf.Line,rect:pf.Rect,roundRect:pf.Rect,square:pf.Rect,circle:pf.Circle,diamond:Lv,pin:Iv,arrow:Rv,triangle:Pv},Ov={line:function(t,e,i,n,r){r.x1=t,r.y1=e+n/2,r.x2=t+i,r.y2=e+n/2},rect:function(t,e,i,n,r){r.x=t,r.y=e,r.width=i,r.height=n},roundRect:function(t,e,i,n,r){r.x=t,r.y=e,r.width=i,r.height=n,r.r=Math.min(i,n)/4},square:function(t,e,i,n,r){var o=Math.min(i,n);r.x=t,r.y=e,r.width=o,r.height=o},circle:function(t,e,i,n,r){r.cx=t+i/2,r.cy=e+n/2,r.r=Math.min(i,n)/2},diamond:function(t,e,i,n,r){r.cx=t+i/2,r.cy=e+n/2,r.width=i,r.height=n},pin:function(t,e,i,n,r){r.x=t+i/2,r.y=e+n/2,r.width=i,r.height=n},arrow:function(t,e,i,n,r){r.x=t+i/2,r.y=e+n/2,r.width=i,r.height=n},triangle:function(t,e,i,n,r){r.cx=t+i/2,r.cy=e+n/2,r.width=i,r.height=n}},kv={};za.each(Dv,function(t,e){kv[e]=new t});var zv=pf.extendShape({type:"symbol",shape:{symbolType:"",x:0,y:0,width:0,height:0},beforeBrush:function(){var t=this.style;"pin"===this.shape.symbolType&&"inside"===t.textPosition&&(t.textPosition=["50%","40%"],t.textAlign="center",t.textVerticalAlign="middle")},buildPath:function(t,e,i){var n=e.symbolType,r=kv[n];"none"!==e.symbolType&&(r||(r=kv[n="rect"]),Ov[n](e.x,e.y,e.width,e.height,r.shape),r.buildPath(t,r.shape,i))}});function Nv(t,e){if("image"!==this.type){var i=this.style,n=this.shape;n&&"line"===n.symbolType?i.stroke=t:this.__isEmptyBrush?(i.stroke=t,i.fill=e||"#fff"):(i.fill&&(i.fill=t),i.stroke&&(i.stroke=t)),this.dirty(!1)}}var Bv={createSymbol:function(t,e,i,n,r,o,a){var s,l=0===t.indexOf("empty");return l&&(t=t.substr(5,1).toLowerCase()+t.substr(6)),(s=0===t.indexOf("image://")?pf.makeImage(t.slice(8),new bl(e,i,n,r),a?"center":"cover"):0===t.indexOf("path://")?pf.makePath(t.slice(7),{},new bl(e,i,n,r),a?"center":"cover"):new zv({shape:{symbolType:t,x:e,y:i,width:n,height:r}})).__isEmptyBrush=l,s.setColor=Nv,s.setColor(o),s}};var Fv={completeDimensions:Gm,createSymbol:Bv.createSymbol,createList:function(t){var e=t.get("data");return Xm(e,t,t.ecModel)},createScale:function(t,e){var i=e;e instanceof bf||(i=new bf(e),za.mixin(i,Ev));var n=Cv.createScaleByModel(i);return n.setExtent(t[0],t[1]),Cv.niceScaleExtent(n,i),n},mixinAxisModelCommonMethods:function(t){za.mixin(t,Ev)}},Gv=Uc.linearMap;function Vv(t,e){var i=(t[1]-t[0])/e/2;t[0]+=i,t[1]-=i}var Hv=[0,1],Uv=function(t,e,i){this.dim=t,this.scale=e,this._extent=i||[0,0],this.inverse=!1,this.onBand=!1,this._labelInterval};Uv.prototype={constructor:Uv,contain:function(t){var e=this._extent,i=Math.min(e[0],e[1]),n=Math.max(e[0],e[1]);return i<=t&&t<=n},containData:function(t){return this.contain(this.dataToCoord(t))},getExtent:function(){return this._extent.slice()},getPixelPrecision:function(t){return Uc.getPixelPrecision(t||this.scale.getExtent(),this._extent)},setExtent:function(t,e){var i=this._extent;i[0]=t,i[1]=e},dataToCoord:function(t,e){var i=this._extent,n=this.scale;return t=n.normalize(t),this.onBand&&"ordinal"===n.type&&Vv(i=i.slice(),n.count()),Gv(t,Hv,i,e)},coordToData:function(t,e){var i=this._extent,n=this.scale;this.onBand&&"ordinal"===n.type&&Vv(i=i.slice(),n.count());var r=Gv(t,i,Hv,e);return this.scale.scale(r)},pointToData:function(t,e){},getTicksCoords:function(t){if(this.onBand&&!t){for(var e=this.getBands(),i=[],n=0;n<e.length;n++)i.push(e[n][0]);return e[n-1]&&i.push(e[n-1][1]),i}return za.map(this.scale.getTicks(),this.dataToCoord,this)},getLabelsCoords:function(){return za.map(this.scale.getTicks(),this.dataToCoord,this)},getBands:function(){for(var t=this.getExtent(),e=[],i=this.scale.count(),n=t[0],r=t[1]-n,o=0;o<i;o++)e.push([r*o/i+n,r*(o+1)/i+n]);return e},getBandWidth:function(){var t=this._extent,e=this.scale.getExtent(),i=e[1]-e[0]+(this.onBand?1:0);0===i&&(i=1);var n=Math.abs(t[1]-t[0]);return Math.abs(n)/i},isHorizontal:null,getRotate:null,getLabelInterval:function(){var t=this._labelInterval;if(!t){var e=this.model,i=e.getModel("axisLabel");t=i.get("interval"),"category"!==this.type||null!=t&&"auto"!==t||(t=Cv.getAxisLabelInterval(za.map(this.scale.getTicks(),this.dataToCoord,this),e.getFormattedLabels(),i.getFont(),this.getRotate?this.getRotate():this.isHorizontal&&!this.isHorizontal()?90:0,i.get("rotate"))),this._labelInterval=t}return t}};var Wv=Uv,jv=1e-8;function Zv(t,e){return Math.abs(t-e)<jv}var Xv={contain:function(t,e,i){var n=0,r=t[0];if(!r)return!1;for(var o=1;o<t.length;o++){var a=t[o];n+=nd(r[0],r[1],a[0],a[1],e,i),r=a}var s=t[0];return Zv(r[0],s[0])&&Zv(r[1],s[1])||(n+=nd(r[0],r[1],s[0],s[1],e,i)),0!==n}};function qv(t,e,i){if(this.name=t,this.geometries=e,i)i=[i[0],i[1]];else{var n=this.getBoundingRect();i=[n.x+n.width/2,n.y+n.height/2]}this.center=i}qv.prototype={constructor:qv,properties:null,getBoundingRect:function(){var t=this._rect;if(t)return t;for(var e=Number.MAX_VALUE,i=[e,e],n=[-e,-e],r=[],o=[],a=this.geometries,s=0;s<a.length;s++)if("polygon"===a[s].type){var l=a[s].exterior;Ru.fromPoints(l,r,o),Ha.min(i,i,r),Ha.max(n,n,o)}return 0===s&&(i[0]=i[1]=n[0]=n[1]=0),this._rect=new bl(i[0],i[1],n[0]-i[0],n[1]-i[1])},contain:function(t){var e=this.getBoundingRect(),i=this.geometries;if(!e.contain(t[0],t[1]))return!1;t:for(var n=0,r=i.length;n<r;n++)if("polygon"===i[n].type){var o=i[n].exterior,a=i[n].interiors;if(Xv.contain(o,t[0],t[1])){for(var s=0;s<(a?a.length:0);s++)if(Xv.contain(a[s]))continue t;return!0}}return!1},transformTo:function(t,e,i,n){var r=this.getBoundingRect(),o=r.width/r.height;i?n||(n=i/o):i=o*n;for(var a=new bl(t,e,i,n),s=r.calculateTransform(a),l=this.geometries,h=0;h<l.length;h++)if("polygon"===l[h].type){for(var c=l[h].exterior,u=l[h].interiors,d=0;d<c.length;d++)Ha.applyTransform(c[d],c[d],s);for(var p=0;p<(u?u.length:0);p++)for(d=0;d<u[p].length;d++)Ha.applyTransform(u[p][d],u[p][d],s)}(r=this._rect).copy(a),this.center=[r.x+r.width/2,r.y+r.height/2]}};var Yv=qv;function Jv(t,e,i){for(var n=[],r=e[0],o=e[1],a=0;a<t.length;a+=2){var s=t.charCodeAt(a)-64,l=t.charCodeAt(a+1)-64;s=s>>1^-(1&s),l=l>>1^-(1&l),r=s+=r,o=l+=o,n.push([s/i,l/i])}return n}var Kv=function(t){return function(t){if(t.UTF8Encoding){var e=t.UTF8Scale;null==e&&(e=1024);for(var i=t.features,n=0;n<i.length;n++)for(var r=i[n].geometry,o=r.coordinates,a=r.encodeOffsets,s=0;s<o.length;s++){var l=o[s];if("Polygon"===r.type)o[s]=Jv(l,a[s],e);else if("MultiPolygon"===r.type)for(var h=0;h<l.length;h++){var c=l[h];l[h]=Jv(c,a[s][h],e)}}t.UTF8Encoding=!1}}(t),za.map(za.filter(t.features,function(t){return t.geometry&&t.properties&&0<t.geometry.coordinates.length}),function(t){var e=t.properties,i=t.geometry,n=i.coordinates,r=[];"Polygon"===i.type&&r.push({type:"polygon",exterior:n[0],interiors:n.slice(1)}),"MultiPolygon"===i.type&&za.each(n,function(t){t[0]&&r.push({type:"polygon",exterior:t[0],interiors:t.slice(1)})});var o=new Yv(e.name,r,e.cp);return o.properties=e,o})},Qv=Gc,$v=ns,ty=Ha,ey=Ns,iy=pf,ny=Uc,ry=Yc,oy=um.throttle,ay=Fv,sy=Im,ly=bf,hy=Wv,cy=ca,uy=Kv,dy={};za.each(["map","each","filter","indexOf","inherits","reduce","filter","bind","curry","isArray","isString","isObject","isFunction","extend","defaults","clone","merge"],function(t){dy[t]=za[t]});var py={zrender:Qv,matrix:$v,vector:ty,color:ey,graphic:iy,number:ny,format:ry,throttle:oy,helper:ay,List:sy,Model:ly,Axis:hy,env:cy,parseGeoJson:uy,util:dy},fy=ji(function(t,e){var s=um.throttle,f=za.each,p=Yf.parseClassType,i={PROCESSOR:{FILTER:1e3,STATISTIC:5e3},VISUAL:{LAYOUT:1e3,GLOBAL:2e3,CHART:3e3,COMPONENT:4e3,BRUSH:5e3}},g="__flagInMainProcess",l="__hasGradientOrPatternBg",m="__optionUpdated",r=/^[a-zA-Z0-9_]+$/;function n(n){return function(t,e,i){t=t&&t.toLowerCase(),qa.prototype[n].call(this,t,e,i)}}function h(){qa.call(this)}function o(t,e,i){i=i||{},"string"==typeof e&&(e=D[e]),this.id,this.group,this._dom=t;var n,r,o=this._zr=Gc.init(t,{renderer:i.renderer||"canvas",devicePixelRatio:i.devicePixelRatio,width:i.width,height:i.height});function a(t,e){return t.prio-e.prio}this._throttledZrFlush=s(za.bind(o.flush,o),17),(e=za.clone(e))&&Hg(e,!0),this._theme=e,this._chartsViews=[],this._chartsMap={},this._componentsViews=[],this._componentsMap={},this._coordSysMgr=new mg,this._api=(r=(n=this)._coordSysMgr,za.extend(new pg(n),{getCoordinateSystems:za.bind(r.getCoordinateSystems,r),getComponentByElement:function(t){for(;t;){var e=t.__ecComponentInfo;if(null!=e)return n._model.getComponent(e.mainType,e.index);t=t.parent}}})),qa.call(this),this._messageCenter=new h,this._initEvents(),this.resize=za.bind(this.resize,this),this._pendingActions=[],Rl(R,a),Rl(P,a),o.animation.on("frame",this._onframe,this),za.setAsPrimitive(this)}h.prototype.on=n("on"),h.prototype.off=n("off"),h.prototype.one=n("one"),za.mixin(h,qa);var a=o.prototype;function c(t,e,i){var n,r=this._model,o=this._coordSysMgr.getCoordinateSystems();e=If.parseFinder(r,e);for(var a=0;a<o.length;a++){var s=o[a];if(s[t]&&null!=(n=s[t](r,e,i)))return n}}a._onframe=function(){if(this[m]){var t=this[m].silent;this[g]=!0,v.prepareAndUpdate.call(this),this[g]=!1,this[m]=!1,d.call(this,t),_.call(this,t)}},a.getDom=function(){return this._dom},a.getZr=function(){return this._zr},a.setOption=function(t,e,i){var n;if(za.isObject(e)&&(i=e.lazyUpdate,n=e.silent,e=e.notMerge),this[g]=!0,!this._model||e){var r=new Sg(this._api),o=this._theme;(this._model=new ug(null,null,o,r)).init(null,null,o,r)}this._model.setOption(t,L),i?(this[m]={silent:n},this[g]=!1):(v.prepareAndUpdate.call(this),this._zr.flush(),this[m]=!1,this[g]=!1,d.call(this,n),_.call(this,n))},a.setTheme=function(){console.log("ECharts#setTheme() is DEPRECATED in ECharts 3.0")},a.getModel=function(){return this._model},a.getOption=function(){return this._model&&this._model.getOption()},a.getWidth=function(){return this._zr.getWidth()},a.getHeight=function(){return this._zr.getHeight()},a.getDevicePixelRatio=function(){return this._zr.painter.dpr||window.devicePixelRatio||1},a.getRenderedCanvas=function(t){if(ca.canvasSupported){(t=t||{}).pixelRatio=t.pixelRatio||1,t.backgroundColor=t.backgroundColor||this._model.get("backgroundColor");var e=this._zr,i=e.storage.getDisplayList();return za.each(i,function(t){t.stopAnimation(!0)}),e.painter.getRenderedCanvas(t)}},a.getSvgDataUrl=function(){if(ca.svgSupported){var t=this._zr,e=t.storage.getDisplayList();return za.each(e,function(t){t.stopAnimation(!0)}),t.painter.pathToSvg()}},a.getDataURL=function(t){var e=(t=t||{}).excludeComponents,i=this._model,n=[],r=this;f(e,function(t){i.eachComponent({mainType:t},function(t){var e=r._componentsMap[t.__viewId];e.group.ignore||(n.push(e),e.group.ignore=!0)})});var o="svg"===this._zr.painter.getType()?this.getSvgDataUrl():this.getRenderedCanvas(t).toDataURL("image/"+(t&&t.type||"png"));return f(n,function(t){t.group.ignore=!1}),o},a.getConnectedDataURL=function(r){if(ca.canvasSupported){var o=this.group,a=Math.min,s=Math.max;if(z[o]){var l=1/0,h=1/0,c=-1/0,u=-1/0,d=[],i=r&&r.pixelRatio||1;za.each(k,function(t,e){if(t.group===o){var i=t.getRenderedCanvas(za.clone(r)),n=t.getDom().getBoundingClientRect();l=a(n.left,l),h=a(n.top,h),c=s(n.right,c),u=s(n.bottom,u),d.push({dom:i,left:n.left,top:n.top})}});var t=(c*=i)-(l*=i),e=(u*=i)-(h*=i),n=za.createCanvas();n.width=t,n.height=e;var p=Gc.init(n);return f(d,function(t){var e=new pf.Image({style:{x:t.left*i-l,y:t.top*i-h,image:t.dom}});p.add(e)}),p.refreshImmediately(),n.toDataURL("image/"+(r&&r.type||"png"))}return this.getDataURL(r)}},a.convertToPixel=za.curry(c,"convertToPixel"),a.convertFromPixel=za.curry(c,"convertFromPixel"),a.containPixel=function(t,r){var o,e=this._model;return t=If.parseFinder(e,t),za.each(t,function(t,n){0<=n.indexOf("Models")&&za.each(t,function(t){var e=t.coordinateSystem;if(e&&e.containPoint)o|=!!e.containPoint(r);else if("seriesModels"===n){var i=this._chartsMap[t.__viewId];i&&i.containPoint&&(o|=i.containPoint(r,t))}},this)},this),!!o},a.getVisual=function(t,e){var i=this._model,n=(t=If.parseFinder(i,t,{defaultMainType:"series"})).seriesModel.getData(),r=t.hasOwnProperty("dataIndexInside")?t.dataIndexInside:t.hasOwnProperty("dataIndex")?n.indexOfRawIndex(t.dataIndex):null;return null!=r?n.getItemVisual(r,e):n.getVisual(e)},a.getViewOfComponentModel=function(t){return this._componentsMap[t.__viewId]},a.getViewOfSeriesModel=function(t){return this._chartsMap[t.__viewId]};var v={update:function(t){var e=this._model,i=this._api,n=this._coordSysMgr,r=this._zr;if(e){e.restoreData(),n.create(this._model,this._api),function(e,i){f(P,function(t){t.func(e,i)})}.call(this,e,i),function(t){var r={};t.eachSeries(function(t){var e=t.get("stack"),i=t.getData();if(e&&"list"===i.type){var n=r[e];r.hasOwnProperty(e)&&n&&(i.stackedOn=n),r[e]=i}})}.call(this,e),n.update(e,i),b.call(this,e,t),function(n,r){var o=this._api;f(this._componentsViews,function(t){var e=t.__model;t.render(e,n,o,r),C(e,t)},this),f(this._chartsViews,function(t){t.__alive=!1},this),n.eachSeries(function(t,e){var i=this._chartsMap[t.__viewId];i.__alive=!0,i.render(t,n,o,r),i.group.silent=!!t.get("silent"),C(t,i),T(t,i)},this),S(this._zr,n),f(this._chartsViews,function(t){t.__alive||t.remove(n,o)},this)}.call(this,e,t);var o=e.get("backgroundColor")||"transparent",a=r.painter;if(a.isSingleCanvas&&a.isSingleCanvas())r.configLayer(0,{clearColor:o});else{if(!ca.canvasSupported){var s=Ns.parse(o);o=Ns.stringify(s,"rgb"),0===s[3]&&(o="transparent")}o.colorStops||o.image?(r.configLayer(0,{clearColor:o}),this[l]=!0,this._dom.style.background="transparent"):(this[l]&&r.configLayer(0,{clearColor:null}),this[l]=!1,this._dom.style.background=o)}f(I,function(t){t(e,i)})}},updateView:function(t){var e=this._model;e&&(e.eachSeries(function(t){t.getData().clearAllVisual()}),b.call(this,e,t),x.call(this,"updateView",e,t))},updateVisual:function(t){var e=this._model;e&&(e.eachSeries(function(t){t.getData().clearAllVisual()}),b.call(this,e,t,!0),x.call(this,"updateVisual",e,t))},updateLayout:function(t){var e=this._model;e&&(function(e,i){var n=this._api;f(R,function(t){t.isLayout&&t.func(e,n,i)})}.call(this,e,t),x.call(this,"updateLayout",e,t))},prepareAndUpdate:function(t){var e=this._model;w.call(this,"component",e),w.call(this,"chart",e),v.update.call(this,t)}};function y(i,e,n,r,t){var o=i._model;if(r){var a={};a[r+"Id"]=n[r+"Id"],a[r+"Index"]=n[r+"Index"],a[r+"Name"]=n[r+"Name"];var s={mainType:r,query:a};t&&(s.subType=t),o&&o.eachComponent(s,function(t,e){l(i["series"===r?"_chartsMap":"_componentsMap"][t.__viewId])},i)}else f(i._componentsViews.concat(i._chartsViews),l);function l(t){t&&t.__alive&&t[e]&&t[e](t.__model,o,i._api,n)}}function u(e,t){var i=e.type,n=e.escapeConnect,r=A[i],o=r.actionInfo,a=(o.update||"update").split(":"),s=a.pop();a=null!=a[0]&&p(a[0]),this[g]=!0;var l=[e],h=!1;e.batch&&(h=!0,l=za.map(e.batch,function(t){return(t=za.defaults(za.extend({},t),e)).batch=null,t}));var c,u=[],d="highlight"===i||"downplay"===i;f(l,function(t){(c=(c=r.action(t,this._model,this._api))||za.extend({},t)).type=o.event||c.type,u.push(c),d?y(this,s,t,"series"):a&&y(this,s,t,a.main,a.sub)},this),"none"===s||d||a||(this[m]?(v.prepareAndUpdate.call(this,e),this[m]=!1):v[s].call(this,e)),c=h?{type:o.event||i,escapeConnect:n,batch:u}:u[0],this[g]=!1,!t&&this._messageCenter.trigger(c.type,c)}function d(t){for(var e=this._pendingActions;e.length;){var i=e.shift();u.call(this,i,t)}}function _(t){!t&&this.trigger("updated")}function x(n,r,o){var a=this._api;f(this._componentsViews,function(t){var e=t.__model;t[n](e,r,a,o),C(e,t)},this),r.eachSeries(function(t,e){var i=this._chartsMap[t.__viewId];i[n](t,r,a,o),C(t,i),T(t,i)},this),S(this._zr,r),f(I,function(t){t(r,a)})}function w(t,a){for(var s="component"===t,l=s?this._componentsViews:this._chartsViews,h=s?this._componentsMap:this._chartsMap,c=this._zr,e=0;e<l.length;e++)l[e].__alive=!1;a[s?"eachComponent":"eachSeries"](function(t,e){if(s){if("series"===t)return}else e=t;var i="_ec_"+e.id+"_"+e.type,n=h[i];if(!n){var r=p(e.type),o=s?em.getClass(r.main,r.sub):am.getClass(r.sub);if(!o)return;(n=new o).init(a,this._api),h[i]=n,l.push(n),c.add(n.group)}e.__viewId=n.__id=i,n.__alive=!0,n.__model=e,n.group.__ecComponentInfo={mainType:e.mainType,index:e.componentIndex}},this);for(e=0;e<l.length;){var i=l[e];i.__alive?e++:(c.remove(i.group),i.dispose(a,this._api),l.splice(e,1),delete h[i.__id],i.__id=i.group.__ecComponentInfo=null)}}function b(e,i,n){var r=this._api;e.clearColorPalette(),e.eachSeries(function(t){t.clearColorPalette()}),f(R,function(t){(!n||!t.isLayout)&&t.func(e,r,i)})}a.resize=function(t){this[g]=!0,this._zr.resize(t);var e=this._model&&this._model.resetOption("media");v[e?"prepareAndUpdate":"update"].call(this),this._loadingFX&&this._loadingFX.resize(),this[g]=!1;var i=t&&t.silent;d.call(this,i),_.call(this,i)},a.showLoading=function(t,e){if(za.isObject(t)&&(e=t,t=""),t=t||"default",this.hideLoading(),O[t]){var i=O[t](this._api,e),n=this._zr;this._loadingFX=i,n.add(i)}},a.hideLoading=function(){this._loadingFX&&this._zr.remove(this._loadingFX),this._loadingFX=null},a.makeActionFromEvent=function(t){var e=za.extend({},t);return e.type=E[t.type],e},a.dispatchAction=function(t,e){za.isObject(e)||(e={silent:!!e}),A[t.type]&&this._model&&(this[g]?this._pendingActions.push(t):(u.call(this,t,e.silent),e.flush?this._zr.flush(!0):!1!==e.flush&&ca.browser.weChat&&this._throttledZrFlush(),d.call(this,e.silent),_.call(this,e.silent)))},a.on=n("on"),a.off=n("off"),a.one=n("one");var M=["click","dblclick","mouseover","mouseout","mousemove","mousedown","mouseup","globalout","contextmenu"];function S(t,e){var i=t.storage,n=0;i.traverse(function(t){t.isGroup||n++}),n>e.get("hoverLayerThreshold")&&!ca.node&&i.traverse(function(t){t.isGroup||(t.useHoverLayer=!0)})}function T(t,e){var i=0;e.group.traverse(function(t){"group"===t.type||t.ignore||i++});var n=+t.get("progressive"),r=i>t.get("progressiveThreshold")&&n&&!ca.node;r&&e.group.traverse(function(t){t.isGroup||(t.progressive=r?Math.floor(i++/n):-1,r&&t.stopAnimation(!0))});var o=t.get("blendMode")||null;e.group.traverse(function(t){t.isGroup||t.setStyle("blend",o)})}function C(t,e){var i=t.get("z"),n=t.get("zlevel");e.group.traverse(function(t){"group"!==t.type&&(null!=i&&(t.z=i),null!=n&&(t.zlevel=n))})}a._initEvents=function(){f(M,function(o){this._zr.on(o,function(t){var e,i=this.getModel(),n=t.target;if("globalout"===o)e={};else if(n&&null!=n.dataIndex){var r=n.dataModel||i.getSeriesByIndex(n.seriesIndex);e=r&&r.getDataParams(n.dataIndex,n.dataType)||{}}else n&&n.eventData&&(e=za.extend({},n.eventData));e&&(e.event=t,e.type=o,this.trigger(o,e))},this)},this),f(E,function(t,e){this._messageCenter.on(e,function(t){this.trigger(e,t)},this)},this)},a.isDisposed=function(){return this._disposed},a.clear=function(){this.setOption({series:[]},!0)},a.dispose=function(){if(!this._disposed){this._disposed=!0;var e=this._api,i=this._model;f(this._componentsViews,function(t){t.dispose(i,e)}),f(this._chartsViews,function(t){t.dispose(i,e)}),this._zr.dispose(),delete k[this.id]}},za.mixin(o,qa);var A={},E={},P=[],L=[],I=[],R=[],D={},O={},k={},z={},N=new Date-0,B=new Date-0,F="_echarts_instance_",G={};function V(t){z[t]=!1}var H=V;function U(t){var e;return e=t.getAttribute?t.getAttribute(F):t[F],k[e]}function W(t){L.push(t)}function j(t,e,i){"function"==typeof e&&(i=e,e="");var n=za.isObject(t)?t.type:[t,t={event:e}][0];t.event=(t.event||n).toLowerCase(),e=t.event,za.assert(r.test(n)&&r.test(e)),A[n]||(A[n]={action:i,actionInfo:t}),E[e]=n}function Z(t,e){"function"==typeof t&&(e=t,t=3e3),R.push({prio:t,func:e})}function X(t,e){O[t]=e}Z(2e3,dm),W(Hg),X("default",fm),j({type:"highlight",event:"highlight",update:"highlight"},za.noop),j({type:"downplay",event:"downplay",update:"downplay"},za.noop);e.version="3.8.5",e.dependencies={zrender:"3.7.4"},e.PRIORITY=i,e.init=function(t,e,i){var n=U(t);if(n)return n;var r=new o(t,e,i);return r.id="ec_"+N++,k[r.id]=r,t.setAttribute?t.setAttribute(F,r.id):t[F]=r.id,function(n){var r="__connectUpdateStatus";function o(t,e){for(var i=0;i<t.length;i++)t[i][r]=e}za.each(E,function(t,e){n._messageCenter.on(e,function(t){if(z[n.group]&&0!==n[r]){if(t&&t.escapeConnect)return;var e=n.makeActionFromEvent(t),i=[];za.each(k,function(t){t!==n&&t.group===n.group&&i.push(t)}),o(i,0),f(i,function(t){1!==t[r]&&t.dispatchAction(e)}),o(i,2)}})})}(r),r},e.connect=function(e){if(za.isArray(e)){var t=e;e=null,za.each(t,function(t){null!=t.group&&(e=t.group)}),e=e||"g_"+B++,za.each(t,function(t){t.group=e})}return z[e]=!0,e},e.disConnect=V,e.disconnect=H,e.dispose=function(t){"string"==typeof t?t=k[t]:t instanceof o||(t=U(t)),t instanceof o&&!t.isDisposed()&&t.dispose()},e.getInstanceByDom=U,e.getInstanceById=function(t){return k[t]},e.registerTheme=function(t,e){D[t]=e},e.registerPreprocessor=W,e.registerProcessor=function(t,e){"function"==typeof t&&(e=t,t=1e3),P.push({prio:t,func:e})},e.registerPostUpdate=function(t){I.push(t)},e.registerAction=j,e.registerCoordinateSystem=function(t,e){mg.register(t,e)},e.getCoordinateSystemDimensions=function(t){var e=mg.get(t);if(e)return e.getDimensionsInfo?e.getDimensionsInfo():e.dimensions.slice()},e.registerLayout=function(t,e){"function"==typeof t&&(e=t,t=1e3),R.push({prio:t,func:e,isLayout:!0})},e.registerVisual=Z,e.registerLoading=X,e.extendComponentModel=function(t){return Yf.extend(t)},e.extendComponentView=function(t){return em.extend(t)},e.extendSeriesModel=function(t){return Qg.extend(t)},e.extendChartView=function(t){return am.extend(t)},e.setCanvasCreator=function(t){za.$override("createCanvas",t)},e.registerMap=function(t,e,i){e.geoJson&&!e.features&&(i=e.specialAreas,e=e.geoJson),"string"==typeof e&&(e="undefined"!=typeof JSON&&JSON.parse?JSON.parse(e):new Function("return ("+e+");")()),G[t]={geoJson:e,specialAreas:i}},e.getMap=function(t){return G[t]},e.dataTool={},function(){for(var t in py)py.hasOwnProperty(t)&&(e[t]=py[t])}()}),gy=(Qg.extend({type:"series.line",dependencies:["grid","polar"],getInitialData:function(t,e){return Xm(t.data,this,e)},defaultOption:{zlevel:0,z:2,coordinateSystem:"cartesian2d",legendHoverLink:!0,hoverAnimation:!0,clipOverflow:!0,label:{normal:{position:"top"}},lineStyle:{normal:{width:2,type:"solid"}},step:!1,smooth:!1,smoothMonotone:null,symbol:"emptyCircle",symbolSize:4,symbolRotate:null,showSymbol:!0,showAllSymbol:!1,connectNulls:!1,sampling:"none",animationEasing:"linear",progressive:0,hoverLayerThreshold:1/0}}),If.otherDimToDataDim);var my={findLabelValueDim:function(t){var e,i=gy(t,"label");if(i.length)e=i[0];else for(var n,r=t.dimensions.slice();r.length&&(e=r.pop(),"ordinal"===(n=t.getDimensionInfo(e).type)||"time"===n););return e}},vy=Bv.createSymbol,yy=Uc.parsePercent,_y=my.findLabelValueDim;function xy(t){return[t[0]/2,t[1]/2]}function wy(t,e,i){pf.Group.call(this),this.updateData(t,e,i)}var by=wy.prototype;function My(t,e){this.parent.drift(t,e)}by._createSymbol=function(t,e,i,n){this.removeAll();var r=e.getItemVisual(i,"color"),o=vy(t,-1,-1,2,2,r);o.attr({z2:100,culling:!0,scale:xy(n)}),o.drift=My,this._symbolType=t,this.add(o)},by.stopSymbolAnimation=function(t){this.childAt(0).stopAnimation(t)},by.getSymbolPath=function(){return this.childAt(0)},by.getScale=function(){return this.childAt(0).scale},by.highlight=function(){this.childAt(0).trigger("emphasis")},by.downplay=function(){this.childAt(0).trigger("normal")},by.setZ=function(t,e){var i=this.childAt(0);i.zlevel=t,i.z=e},by.setDraggable=function(t){var e=this.childAt(0);e.draggable=t,e.cursor=t?"move":"pointer"},by.updateData=function(t,e,i){this.silent=!1;var n,r,o=t.getItemVisual(e,"symbol")||"circle",a=t.hostModel,s=(n=e,(r=t.getItemVisual(n,"symbolSize"))instanceof Array?r.slice():[+r,+r]),l=o!==this._symbolType;l?this._createSymbol(o,t,e,s):((h=this.childAt(0)).silent=!1,pf.updateProps(h,{scale:xy(s)},a,e));if(this._updateCommon(t,e,s,i),l){var h=this.childAt(0),c=i&&i.fadeIn,u={scale:h.scale.slice()};c&&(u.style={opacity:h.style.opacity}),h.scale=[0,0],c&&(h.style.opacity=0),pf.initProps(h,u,a,e)}this._seriesModel=a};var Sy=["itemStyle","normal"],Ty=["itemStyle","emphasis"],Cy=["label","normal"],Ay=["label","emphasis"];by._updateCommon=function(t,e,i,n){var r=this.childAt(0),o=t.hostModel,a=t.getItemVisual(e,"color");"image"!==r.type&&r.useStyle({strokeNoScale:!0});var s=n&&n.itemStyle,l=n&&n.hoverItemStyle,h=n&&n.symbolRotate,c=n&&n.symbolOffset,u=n&&n.labelModel,d=n&&n.hoverLabelModel,p=n&&n.hoverAnimation,f=n&&n.cursorStyle;if(!n||t.hasItemOption){var g=n&&n.itemModel?n.itemModel:t.getItemModel(e);s=g.getModel(Sy).getItemStyle(["color"]),l=g.getModel(Ty).getItemStyle(),h=g.getShallow("symbolRotate"),c=g.getShallow("symbolOffset"),u=g.getModel(Cy),d=g.getModel(Ay),p=g.getShallow("hoverAnimation"),f=g.getShallow("cursor")}else l=za.extend({},l);var m=r.style;r.attr("rotation",(h||0)*Math.PI/180||0),c&&r.attr("position",[yy(c[0],i[0]),yy(c[1],i[1])]),f&&r.attr("cursor",f),r.setColor(a,n&&n.symbolInnerColor),r.setStyle(s);var v=t.getItemVisual(e,"opacity");null!=v&&(m.opacity=v);var y=n&&n.useNameLabel,_=!y&&_y(t);(y||null!=_)&&pf.setLabelStyle(m,l,u,d,{labelFetcher:o,labelDataIndex:e,defaultText:y?t.getName(e):t.get(_,e),isRectText:!0,autoColor:a}),r.off("mouseover").off("mouseout").off("emphasis").off("normal"),r.hoverStyle=l,pf.setHoverStyle(r);var x=xy(i);if(p&&o.isAnimationEnabled()){var w=function(){var t=x[1]/x[0];this.animateTo({scale:[Math.max(1.1*x[0],x[0]+3),Math.max(1.1*x[1],x[1]+3*t)]},400,"elasticOut")},b=function(){this.animateTo({scale:x},400,"elasticOut")};r.on("mouseover",w).on("mouseout",b).on("emphasis",w).on("normal",b)}},by.fadeOut=function(t,e){var i=this.childAt(0);this.silent=i.silent=!0,(!e||!e.keepLabel)&&(i.style.text=null),pf.updateProps(i,{style:{opacity:0},scale:[0,0]},this._seriesModel,this.dataIndex,t)},za.inherits(wy,pf.Group);var Ey=wy;function Py(t){this.group=new pf.Group,this._symbolCtor=t||Ey}var Ly=Py.prototype;function Iy(t,e,i){var n=t.getItemLayout(e);return n&&!isNaN(n[0])&&!isNaN(n[1])&&!(i&&i(e))&&"none"!==t.getItemVisual(e,"symbol")}Ly.updateData=function(r,o){var a=this.group,s=r.hostModel,l=this._data,h=this._symbolCtor,c={itemStyle:s.getModel("itemStyle.normal").getItemStyle(["color"]),hoverItemStyle:s.getModel("itemStyle.emphasis").getItemStyle(),symbolRotate:s.get("symbolRotate"),symbolOffset:s.get("symbolOffset"),hoverAnimation:s.get("hoverAnimation"),labelModel:s.getModel("label.normal"),hoverLabelModel:s.getModel("label.emphasis"),cursorStyle:s.get("cursor")};r.diff(l).add(function(t){var e=r.getItemLayout(t);if(Iy(r,t,o)){var i=new h(r,t,c);i.attr("position",e),r.setItemGraphicEl(t,i),a.add(i)}}).update(function(t,e){var i=l.getItemGraphicEl(e),n=r.getItemLayout(t);Iy(r,t,o)?(i?(i.updateData(r,t,c),pf.updateProps(i,{position:n},s)):(i=new h(r,t)).attr("position",n),a.add(i),r.setItemGraphicEl(t,i)):a.remove(i)}).remove(function(t){var e=l.getItemGraphicEl(t);e&&e.fadeOut(function(){a.remove(e)})}).execute(),this._data=r},Ly.updateLayout=function(){var n=this._data;n&&n.eachItemGraphicEl(function(t,e){var i=n.getItemLayout(e);t.attr("position",i)})},Ly.remove=function(t){var e=this.group,i=this._data;i&&(t?i.eachItemGraphicEl(function(t){t.fadeOut(function(){e.remove(t)})}):e.removeAll())};var Ry=Py;function Dy(t){return 0<=t?1:-1}function Oy(t,e,i){for(var n,r=t.getBaseAxis(),o=t.getOtherAxis(r),a=r.onZero?0:o.scale.getExtent()[0],s=o.dim,l="x"===s||"radius"===s?1:0,h=e.stackedOn,c=e.get(s,i);h&&Dy(h.get(s,i))===Dy(c);){n=h;break}var u=[];return u[l]=e.get(r.dim,i),u[1-l]=n?n.get(s,i,!0):a,t.dataToPoint(u)}var ky=function(t,e,i,n,r,o){for(var a,s,l=(a=t,s=[],e.diff(a).add(function(t){s.push({cmd:"+",idx:t})}).update(function(t,e){s.push({cmd:"=",idx:e,idx1:t})}).remove(function(t){s.push({cmd:"-",idx:t})}).execute(),s),h=[],c=[],u=[],d=[],p=[],f=[],g=[],m=o.dimensions,v=0;v<l.length;v++){var y=l[v],_=!0;switch(y.cmd){case"=":var x=t.getItemLayout(y.idx),w=e.getItemLayout(y.idx1);(isNaN(x[0])||isNaN(x[1]))&&(x=w.slice()),h.push(x),c.push(w),u.push(i[y.idx]),d.push(n[y.idx1]),g.push(e.getRawIndex(y.idx1));break;case"+":var b=y.idx;h.push(r.dataToPoint([e.get(m[0],b,!0),e.get(m[1],b,!0)])),c.push(e.getItemLayout(b).slice()),u.push(Oy(r,e,b)),d.push(n[b]),g.push(e.getRawIndex(b));break;case"-":b=y.idx;var M=t.getRawIndex(b);M!==b?(h.push(t.getItemLayout(b)),c.push(o.dataToPoint([t.get(m[0],b,!0),t.get(m[1],b,!0)])),u.push(i[b]),d.push(Oy(o,t,b)),g.push(M)):_=!1}_&&(p.push(y),f.push(f.length))}f.sort(function(t,e){return g[t]-g[e]});var S=[],T=[],C=[],A=[],E=[];for(v=0;v<f.length;v++)b=f[v],S[v]=h[b],T[v]=c[b],C[v]=u[b],A[v]=d[b],E[v]=p[b];return{current:S,next:T,stackedOnCurrent:C,stackedOnNext:A,status:E}},zy=Ha.min,Ny=Ha.max,By=Ha.scaleAndAdd,Fy=Ha.copy,Gy=[],Vy=[],Hy=[];function Uy(t){return isNaN(t[0])||isNaN(t[1])}function Wy(t,e,i,n,r,o,a,s,l,h,c){for(var u=0,d=i,p=0;p<n;p++){var f=e[d];if(r<=d||d<0)break;if(Uy(f)){if(c){d+=o;continue}break}if(d===i)t[0<o?"moveTo":"lineTo"](f[0],f[1]),Fy(Vy,f);else if(0<l){var g=d+o,m=e[g];if(c)for(;m&&Uy(e[g]);)m=e[g+=o];var v=.5,y=e[u];if(!(m=e[g])||Uy(m))Fy(Hy,f);else{var _,x;if(Uy(m)&&!c&&(m=f),Ha.sub(Gy,m,y),"x"===h||"y"===h){var w="x"===h?0:1;_=Math.abs(f[w]-y[w]),x=Math.abs(f[w]-m[w])}else _=Ha.dist(f,y),x=Ha.dist(f,m);By(Hy,f,Gy,-l*(1-(v=x/(x+_))))}zy(Vy,Vy,s),Ny(Vy,Vy,a),zy(Hy,Hy,s),Ny(Hy,Hy,a),t.bezierCurveTo(Vy[0],Vy[1],Hy[0],Hy[1],f[0],f[1]),By(Vy,f,Gy,l*v)}else t.lineTo(f[0],f[1]);u=d,d+=o}return p}function jy(t,e){var i=[1/0,1/0],n=[-1/0,-1/0];if(e)for(var r=0;r<t.length;r++){var o=t[r];o[0]<i[0]&&(i[0]=o[0]),o[1]<i[1]&&(i[1]=o[1]),o[0]>n[0]&&(n[0]=o[0]),o[1]>n[1]&&(n[1]=o[1])}return{min:e?i:n,max:e?n:i}}var Zy={Polyline:_d.extend({type:"ec-polyline",shape:{points:[],smooth:0,smoothConstraint:!0,smoothMonotone:null,connectNulls:!1},style:{fill:null,stroke:"#000"},brush:Vd(_d.prototype.brush),buildPath:function(t,e){var i=e.points,n=0,r=i.length,o=jy(i,e.smoothConstraint);if(e.connectNulls){for(;0<r&&Uy(i[r-1]);r--);for(;n<r&&Uy(i[n]);n++);}for(;n<r;)n+=Wy(t,i,n,r,r,1,o.min,o.max,e.smooth,e.smoothMonotone,e.connectNulls)+1}}),Polygon:_d.extend({type:"ec-polygon",shape:{points:[],stackedOnPoints:[],smooth:0,stackedOnSmooth:0,smoothConstraint:!0,smoothMonotone:null,connectNulls:!1},brush:Vd(_d.prototype.brush),buildPath:function(t,e){var i=e.points,n=e.stackedOnPoints,r=0,o=i.length,a=e.smoothMonotone,s=jy(i,e.smoothConstraint),l=jy(n,e.smoothConstraint);if(e.connectNulls){for(;0<o&&Uy(i[o-1]);o--);for(;r<o&&Uy(i[r]);r++);}for(;r<o;){var h=Wy(t,i,r,o,o,1,s.min,s.max,e.smooth,a,e.connectNulls);Wy(t,n,r+h-1,h,o,-1,l.min,l.max,e.stackedOnSmooth,a,e.connectNulls),r+=h+1,t.closePath()}}})},Xy=Zy.Polyline,qy=Zy.Polygon;function Yy(t,e){if(t.length===e.length){for(var i=0;i<t.length;i++){var n=t[i],r=e[i];if(n[0]!==r[0]||n[1]!==r[1])return}return!0}}function Jy(t){return"number"==typeof t?t:t?.3:0}function Ky(t){var e=t.getGlobalExtent();if(t.onBand){var i=t.getBandWidth()/2-1,n=e[1]>e[0]?1:-1;e[0]+=n*i,e[1]-=n*i}return e}function Qy(t){return 0<=t?1:-1}function $y(t,e,i){return"polar"===t.type?(r=e,o=i,a=(n=t).getAngleAxis(),s=n.getRadiusAxis().getExtent(),l=a.getExtent(),h=Math.PI/180,c=new pf.Sector({shape:{cx:n.cx,cy:n.cy,r0:s[0],r:s[1],startAngle:-l[0]*h,endAngle:-l[1]*h,clockwise:a.inverse}}),r&&(c.shape.endAngle=-l[0]*h,pf.initProps(c,{shape:{endAngle:-l[1]*h}},o)),c):function(t,e,i){var n=Ky(t.getAxis("x")),r=Ky(t.getAxis("y")),o=t.getBaseAxis().isHorizontal(),a=Math.min(n[0],n[1]),s=Math.min(r[0],r[1]),l=Math.max(n[0],n[1])-a,h=Math.max(r[0],r[1])-s,c=i.get("lineStyle.normal.width")||2,u=i.get("clipOverflow")?c/2:Math.max(l,h);o?(s-=u,h+=2*u):(a-=u,l+=2*u);var d=new pf.Rect({shape:{x:a,y:s,width:l,height:h}});return e&&(d.shape[o?"width":"height"]=0,pf.initProps(d,{shape:{width:l,height:h}},i)),d}(t,e,i);var n,r,o,a,s,l,h,c}function t_(t,e,i){for(var n=e.getBaseAxis(),r="x"===n.dim||"radius"===n.dim?0:1,o=[],a=0;a<t.length-1;a++){var s=t[a+1],l=t[a];o.push(l);var h=[];switch(i){case"end":h[r]=s[r],h[1-r]=l[1-r],o.push(h);break;case"middle":var c=(l[r]+s[r])/2,u=[];h[r]=u[r]=c,h[1-r]=l[1-r],u[1-r]=s[1-r],o.push(h),o.push(u);break;default:h[r]=l[r],h[1-r]=s[1-r],o.push(h)}}return t[a]&&o.push(t[a]),o}am.extend({type:"line",init:function(){var t=new pf.Group,e=new Ry;this.group.add(e.group),this._symbolDraw=e,this._lineGroup=t},render:function(t,e,i){var n=t.coordinateSystem,r=this.group,o=t.getData(),a=t.getModel("lineStyle.normal"),s=t.getModel("areaStyle.normal"),l=o.mapArray(o.getItemLayout,!0),h="polar"===n.type,c=this._coordSys,u=this._symbolDraw,d=this._polyline,p=this._polygon,f=this._lineGroup,g=t.get("animation"),m=!s.isEmpty(),v=function(o,a){var s=o.getBaseAxis(),t=o.getOtherAxis(s),l=0;if(!s.onZero){var e=t.scale.getExtent();0<e[0]?l=e[0]:e[1]<0&&(l=e[1])}var h=t.dim,c="x"===h||"radius"===h?1:0;return a.mapArray([h],function(t,e){for(var i,n=a.stackedOn;n&&Qy(n.get(h,e))===Qy(t);){i=n;break}var r=[];return r[c]=a.get(s.dim,e),r[1-c]=i?i.get(h,e,!0):l,o.dataToPoint(r)},!0)}(n,o),y=t.get("showSymbol"),_=y&&!h&&!t.get("showAllSymbol")&&this._getSymbolIgnoreFunc(o,n),x=this._data;x&&x.eachItemGraphicEl(function(t,e){t.__temp&&(r.remove(t),x.setItemGraphicEl(e,null))}),y||u.remove(),r.add(f);var w=!h&&t.get("step");d&&c.type===n.type&&w===this._step?(m&&!p?p=this._newPolygon(l,v,n,g):p&&!m&&(f.remove(p),p=this._polygon=null),f.setClipPath($y(n,!1,t)),y&&u.updateData(o,_),o.eachItemGraphicEl(function(t){t.stopAnimation(!0)}),Yy(this._stackedOnPoints,v)&&Yy(this._points,l)||(g?this._updateAnimation(o,v,n,i,w):(w&&(l=t_(l,n,w),v=t_(v,n,w)),d.setShape({points:l}),p&&p.setShape({points:l,stackedOnPoints:v})))):(y&&u.updateData(o,_),w&&(l=t_(l,n,w),v=t_(v,n,w)),d=this._newPolyline(l,n,g),m&&(p=this._newPolygon(l,v,n,g)),f.setClipPath($y(n,!0,t)));var b=function(t,e){var i=t.getVisual("visualMeta");if(i&&i.length&&t.count()){for(var n,r=i.length-1;0<=r;r--)if(i[r].dimension<2){n=i[r];break}if(n&&"cartesian2d"===e.type){var o=n.dimension,a=t.dimensions[o],s=e.getAxis(a),l=za.map(n.stops,function(t){return{coord:s.toGlobalCoord(s.dataToCoord(t.value)),color:t.color}}),h=l.length,c=n.outerColors.slice();h&&l[0].coord>l[h-1].coord&&(l.reverse(),c.reverse());var u=l[0].coord-10,d=l[h-1].coord+10,p=d-u;if(p<.001)return"transparent";za.each(l,function(t){t.offset=(t.coord-u)/p}),l.push({offset:h?l[h-1].offset:.5,color:c[1]||"transparent"}),l.unshift({offset:h?l[0].offset:.5,color:c[0]||"transparent"});var f=new pf.LinearGradient(0,0,0,0,l,!0);return f[a]=u,f[a+"2"]=d,f}}}(o,n)||o.getVisual("color");d.useStyle(za.defaults(a.getLineStyle(),{fill:"none",stroke:b,lineJoin:"bevel"}));var M=t.get("smooth");if(M=Jy(t.get("smooth")),d.setShape({smooth:M,smoothMonotone:t.get("smoothMonotone"),connectNulls:t.get("connectNulls")}),p){var S=o.stackedOn,T=0;if(p.useStyle(za.defaults(s.getAreaStyle(),{fill:b,opacity:.7,lineJoin:"bevel"})),S)T=Jy(S.hostModel.get("smooth"));p.setShape({smooth:M,stackedOnSmooth:T,smoothMonotone:t.get("smoothMonotone"),connectNulls:t.get("connectNulls")})}this._data=o,this._coordSys=n,this._stackedOnPoints=v,this._points=l,this._step=w},dispose:function(){},highlight:function(t,e,i,n){var r=t.getData(),o=If.queryDataIndex(r,n);if(!(o instanceof Array)&&null!=o&&0<=o){var a=r.getItemGraphicEl(o);if(!a){var s=r.getItemLayout(o);if(!s)return;(a=new Ey(r,o)).position=s,a.setZ(t.get("zlevel"),t.get("z")),a.ignore=isNaN(s[0])||isNaN(s[1]),a.__temp=!0,r.setItemGraphicEl(o,a),a.stopSymbolAnimation(!0),this.group.add(a)}a.highlight()}else am.prototype.highlight.call(this,t,e,i,n)},downplay:function(t,e,i,n){var r=t.getData(),o=If.queryDataIndex(r,n);if(null!=o&&0<=o){var a=r.getItemGraphicEl(o);a&&(a.__temp?(r.setItemGraphicEl(o,null),this.group.remove(a)):a.downplay())}else am.prototype.downplay.call(this,t,e,i,n)},_newPolyline:function(t){var e=this._polyline;return e&&this._lineGroup.remove(e),e=new Xy({shape:{points:t},silent:!0,z2:10}),this._lineGroup.add(e),this._polyline=e},_newPolygon:function(t,e){var i=this._polygon;return i&&this._lineGroup.remove(i),i=new qy({shape:{points:t,stackedOnPoints:e},silent:!0}),this._lineGroup.add(i),this._polygon=i},_getSymbolIgnoreFunc:function(t,e){var i=e.getAxesByScale("ordinal")[0];if(i&&i.isLabelIgnored)return za.bind(i.isLabelIgnored,i)},_updateAnimation:function(t,e,i,n,r){var o=this._polyline,a=this._polygon,s=t.hostModel,l=ky(this._data,t,this._stackedOnPoints,e,this._coordSys,i),h=l.current,c=l.stackedOnCurrent,u=l.next,d=l.stackedOnNext;r&&(h=t_(l.current,i,r),c=t_(l.stackedOnCurrent,i,r),u=t_(l.next,i,r),d=t_(l.stackedOnNext,i,r)),o.shape.__points=l.current,o.shape.points=h,pf.updateProps(o,{shape:{points:u}},s),a&&(a.setShape({points:h,stackedOnPoints:c}),pf.updateProps(a,{shape:{points:u,stackedOnPoints:d}},s));for(var p=[],f=l.status,g=0;g<f.length;g++){if("="===f[g].cmd){var m=t.getItemGraphicEl(f[g].idx1);m&&p.push({el:m,ptIdx:g})}}o.animators&&o.animators.length&&o.animators[0].during(function(){for(var t=0;t<p.length;t++){p[t].el.attr("position",o.shape.__points[p[t].ptIdx])}})},remove:function(t){var i=this.group,n=this._data;this._lineGroup.removeAll(),this._symbolDraw.remove(!0),n&&n.eachItemGraphicEl(function(t,e){t.__temp&&(i.remove(t),n.setItemGraphicEl(e,null))}),this._polyline=this._polygon=this._coordSys=this._points=this._stackedOnPoints=this._data=null}});var e_=function(t,e,i,a,n){a.eachRawSeriesByType(t,function(n){var r=n.getData(),t=n.get("symbol")||e,o=n.get("symbolSize");r.setVisual({legendSymbol:i||t,symbol:t,symbolSize:o}),a.isSeriesFiltered(n)||("function"==typeof o&&r.each(function(t){var e=n.getRawValue(t),i=n.getDataParams(t);r.setItemVisual(t,"symbolSize",o(e,i))}),r.each(function(t){var e=r.getItemModel(t),i=e.getShallow("symbol",!0),n=e.getShallow("symbolSize",!0);null!=i&&r.setItemVisual(t,"symbol",i),null!=n&&r.setItemVisual(t,"symbolSize",n)}))})};var i_=function(t,e){e.eachSeriesByType(t,function(t){var n=t.getData(),r=t.coordinateSystem;if(r){for(var e=[],i=r.dimensions,o=0;o<i.length;o++)e.push(t.coordDimToDataDim(r.dimensions[o])[0]);1===e.length?n.each(e[0],function(t,e){n.setItemLayout(e,isNaN(t)?[NaN,NaN]:r.dataToPoint(t))}):2===e.length&&n.each(e,function(t,e,i){n.setItemLayout(i,isNaN(t)||isNaN(e)?[NaN,NaN]:r.dataToPoint([t,e]))},!0)}})},n_={average:function(t){for(var e=0,i=0,n=0;n<t.length;n++)isNaN(t[n])||(e+=t[n],i++);return 0===i?NaN:e/i},sum:function(t){for(var e=0,i=0;i<t.length;i++)e+=t[i]||0;return e},max:function(t){for(var e=-1/0,i=0;i<t.length;i++)t[i]>e&&(e=t[i]);return e},min:function(t){for(var e=1/0,i=0;i<t.length;i++)t[i]<e&&(e=t[i]);return e},nearest:function(t){return t[0]}},r_=function(t,e){return Math.round(t.length/2)};var o_=function(t,e,i){e.eachSeriesByType(t,function(t){var e=t.getData(),i=t.get("sampling"),n=t.coordinateSystem;if("cartesian2d"===n.type&&i){var r,o=n.getBaseAxis(),a=n.getOtherAxis(o),s=o.getExtent(),l=s[1]-s[0],h=Math.round(e.count()/l);1<h&&("string"==typeof i?r=n_[i]:"function"==typeof i&&(r=i),r&&(e=e.downSample(a.dim,1/h,r,r_),t.setData(e)))}},this)};function a_(t){return this._axes[t]}var s_=function(t){this._axes={},this._dimList=[],this.name=t||""};s_.prototype={constructor:s_,type:"cartesian",getAxis:function(t){return this._axes[t]},getAxes:function(){return za.map(this._dimList,a_,this)},getAxesByScale:function(e){return e=e.toLowerCase(),za.filter(this.getAxes(),function(t){return t.scale.type===e})},addAxis:function(t){var e=t.dim;this._axes[e]=t,this._dimList.push(e)},dataToCoord:function(t){return this._dataCoordConvert(t,"dataToCoord")},coordToData:function(t){return this._dataCoordConvert(t,"coordToData")},_dataCoordConvert:function(t,e){for(var i=this._dimList,n=t instanceof Array?[]:{},r=0;r<i.length;r++){var o=i[r],a=this._axes[o];n[o]=a[e](t[o])}return n}};var l_=s_;function h_(t){l_.call(this,t)}h_.prototype={constructor:h_,type:"cartesian2d",dimensions:["x","y"],getBaseAxis:function(){return this.getAxesByScale("ordinal")[0]||this.getAxesByScale("time")[0]||this.getAxis("x")},containPoint:function(t){var e=this.getAxis("x"),i=this.getAxis("y");return e.contain(e.toLocalCoord(t[0]))&&i.contain(i.toLocalCoord(t[1]))},containData:function(t){return this.getAxis("x").containData(t[0])&&this.getAxis("y").containData(t[1])},dataToPoint:function(t,e){var i=this.getAxis("x"),n=this.getAxis("y");return[i.toGlobalCoord(i.dataToCoord(t[0],e)),n.toGlobalCoord(n.dataToCoord(t[1],e))]},pointToData:function(t,e){var i=this.getAxis("x"),n=this.getAxis("y");return[i.coordToData(i.toLocalCoord(t[0]),e),n.coordToData(n.toLocalCoord(t[1]),e)]},getOtherAxis:function(t){return this.getAxis("x"===t.dim?"y":"x")}},za.inherits(h_,l_);var c_=h_,u_=function(t,e,i,n,r){Wv.call(this,t,e,i),this.type=n||"value",this.position=r||"bottom"};u_.prototype={constructor:u_,index:0,onZero:!1,model:null,isHorizontal:function(){var t=this.position;return"top"===t||"bottom"===t},getGlobalExtent:function(t){var e=this.getExtent();return e[0]=this.toGlobalCoord(e[0]),e[1]=this.toGlobalCoord(e[1]),t&&e[0]>e[1]&&e.reverse(),e},getOtherAxis:function(){this.grid.getOtherAxis()},isLabelIgnored:function(t){if("category"===this.type){var e=this.getLabelInterval();return"function"==typeof e&&!e(t,this.scale.getLabel(t))||t%(e+1)}},pointToData:function(t,e){return this.coordToData(this.toLocalCoord(t["x"===this.dim?0:1]),e)},toLocalCoord:null,toGlobalCoord:null},za.inherits(u_,Wv);var d_=u_,p_={show:!0,zlevel:0,z:0,inverse:!1,name:"",nameLocation:"end",nameRotate:null,nameTruncate:{maxWidth:null,ellipsis:"...",placeholder:"."},nameTextStyle:{},nameGap:15,silent:!1,triggerEvent:!1,tooltip:{show:!1},axisPointer:{},axisLine:{show:!0,onZero:!0,onZeroAxisIndex:null,lineStyle:{color:"#333",width:1,type:"solid"},symbol:["none","none"],symbolSize:[10,15]},axisTick:{show:!0,inside:!1,length:5,lineStyle:{width:1}},axisLabel:{show:!0,inside:!1,rotate:0,showMinLabel:null,showMaxLabel:null,margin:8,fontSize:12},splitLine:{show:!0,lineStyle:{color:["#ccc"],width:1,type:"solid"}},splitArea:{show:!1,areaStyle:{color:["rgba(250,250,250,0.3)","rgba(200,200,200,0.3)"]}}},f_={};f_.categoryAxis=za.merge({boundaryGap:!0,splitLine:{show:!1},axisTick:{alignWithLabel:!1,interval:"auto"},axisLabel:{interval:"auto"}},p_),f_.valueAxis=za.merge({boundaryGap:[0,0],splitNumber:5},p_),f_.timeAxis=za.defaults({scale:!0,min:"dataMin",max:"dataMax"},f_.valueAxis),f_.logAxis=za.defaults({scale:!0,logBase:10},f_.valueAxis);var g_=f_,m_=jf.getLayoutParams,v_=jf.mergeLayoutParam,y_=["value","category","time","log"];var __=function(a,t,s,e){za.each(y_,function(o){t.extend({type:a+"Axis."+o,mergeDefaultAndTheme:function(t,e){var i=this.layoutMode,n=i?m_(t):{},r=e.getTheme();za.merge(t,r.get(o+"Axis")),za.merge(t,this.getDefaultOption()),t.type=s(a,t),i&&v_(t,n,i)},defaultOption:za.mergeAll([{},g_[o+"Axis"],e],!0)})}),Yf.registerSubTypeDefaulter(a+"Axis",za.curry(s,a))},x_=Yf.extend({type:"cartesian2dAxis",axis:null,init:function(){x_.superApply(this,"init",arguments),this.resetRange()},mergeOption:function(){x_.superApply(this,"mergeOption",arguments),this.resetRange()},restoreData:function(){x_.superApply(this,"restoreData",arguments),this.resetRange()},getCoordSysModel:function(){return this.ecModel.queryComponents({mainType:"grid",index:this.option.gridIndex,id:this.option.gridId})[0]}});function w_(t,e){return e.type||(e.data?"category":"value")}za.merge(x_.prototype,Ev);var b_={offset:0};__("x",x_,w_,b_),__("y",x_,w_,b_);Yf.extend({type:"grid",dependencies:["xAxis","yAxis"],layoutMode:"box",coordinateSystem:null,defaultOption:{show:!1,zlevel:0,z:0,left:"10%",top:60,right:"10%",bottom:60,containLabel:!1,backgroundColor:"rgba(0,0,0,0)",borderWidth:1,borderColor:"#ccc"}});var M_=jf.getLayoutRect,S_=za.each,T_=Cv.ifAxisCrossZero,C_=Cv.niceScaleExtent;function A_(t,e,i){return t.getCoordSysModel()===e}function E_(t,e,i){this._coordsMap={},this._coordsList=[],this._axesMap={},this._axesList=[],this._initCartesian(t,e,i),this.model=t}var P_=E_.prototype;function L_(t,e,i){var n=t[e];if(i.onZero){var r=i.onZeroAxisIndex;if(null==r){for(var o in n){if(n.hasOwnProperty(o))if((a=n[o])&&!I_(a)){r=+o;break}}null==r&&(i.onZero=!1),i.onZeroAxisIndex=r}else{var a;(a=n[r])&&I_(a)&&(i.onZero=!1)}}}function I_(t){return"category"===t.type||"time"===t.type||!T_(t)}P_.type="grid",P_.axisPointerEnabled=!0,P_.getRect=function(){return this._rect},P_.update=function(t,e){var i=this._axesMap;this._updateScale(t,this.model),S_(i.x,function(t){C_(t.scale,t.model)}),S_(i.y,function(t){C_(t.scale,t.model)}),S_(i.x,function(t){L_(i,"y",t)}),S_(i.y,function(t){L_(i,"x",t)}),this.resize(this.model,e)},P_.resize=function(t,e,i){var l=M_(t.getBoxLayoutParams(),{width:e.getWidth(),height:e.getHeight()});this._rect=l;var n=this._axesList;function r(){S_(n,function(t){var e,i,n,r,o=t.isHorizontal(),a=o?[0,l.width]:[0,l.height],s=t.inverse?1:0;t.setExtent(a[s],a[1-s]),e=t,i=o?l.x:l.y,n=e.getExtent(),r=n[0]+n[1],e.toGlobalCoord="x"===e.dim?function(t){return t+i}:function(t){return r-t+i},e.toLocalCoord="x"===e.dim?function(t){return t-i}:function(t){return r-t+i}})}r(),!i&&t.get("containLabel")&&(S_(n,function(t){if(!t.model.get("axisLabel.inside")){var e=function(t){var e,i,n,r,o,a,s,l,h,c=t.model,u=c.getFormattedLabels(),d=c.getModel("axisLabel"),p=1,f=u.length;40<f&&(p=Math.ceil(f/40));for(var g=0;g<f;g+=p)if(!t.isLabelIgnored(g)){var m=d.getTextRect(u[g]),v=(i=m,n=d.get("rotate")||0,r=n*Math.PI/180,o=i.plain(),a=o.width,s=o.height,l=a*Math.cos(r)+s*Math.sin(r),h=a*Math.sin(r)+s*Math.cos(r),new bl(o.x,o.y,l,h));e?e.union(v):e=v}return e}(t);if(e){var i=t.isHorizontal()?"height":"width",n=t.model.get("axisLabel.margin");l[i]-=e[i]+n,"top"===t.position?l.y+=e.height+n:"left"===t.position&&(l.x+=e.width+n)}}}),r())},P_.getAxis=function(t,e){var i=this._axesMap[t];if(null!=i){if(null==e)for(var n in i)if(i.hasOwnProperty(n))return i[n];return i[e]}},P_.getAxes=function(){return this._axesList.slice()},P_.getCartesian=function(t,e){if(null!=t&&null!=e){var i="x"+t+"y"+e;return this._coordsMap[i]}za.isObject(t)&&(e=t.yAxisIndex,t=t.xAxisIndex);for(var n=0,r=this._coordsList;n<r.length;n++)if(r[n].getAxis("x").index===t||r[n].getAxis("y").index===e)return r[n]},P_.getCartesians=function(){return this._coordsList.slice()},P_.convertToPixel=function(t,e,i){var n=this._findConvertTarget(t,e);return n.cartesian?n.cartesian.dataToPoint(i):n.axis?n.axis.toGlobalCoord(n.axis.dataToCoord(i)):null},P_.convertFromPixel=function(t,e,i){var n=this._findConvertTarget(t,e);return n.cartesian?n.cartesian.pointToData(i):n.axis?n.axis.coordToData(n.axis.toLocalCoord(i)):null},P_._findConvertTarget=function(t,e){var i,n,r=e.seriesModel,o=e.xAxisModel||r&&r.getReferringComponents("xAxis")[0],a=e.yAxisModel||r&&r.getReferringComponents("yAxis")[0],s=e.gridModel,l=this._coordsList;if(r)i=r.coordinateSystem,za.indexOf(l,i)<0&&(i=null);else if(o&&a)i=this.getCartesian(o.componentIndex,a.componentIndex);else if(o)n=this.getAxis("x",o.componentIndex);else if(a)n=this.getAxis("y",a.componentIndex);else if(s){s.coordinateSystem===this&&(i=this._coordsList[0])}return{cartesian:i,axis:n}},P_.containPoint=function(t){var e=this._coordsList[0];if(e)return e.containPoint(t)},P_._initCartesian=function(a,t,e){var s={left:!1,right:!1,top:!1,bottom:!1},l={x:{},y:{}},h={x:0,y:0};if(t.eachComponent("xAxis",i("x"),this),t.eachComponent("yAxis",i("y"),this),!h.x||!h.y)return this._axesMap={},void(this._axesList=[]);function i(o){return function(t,e){if(A_(t,a)){var i=t.get("position");"x"===o?"top"!==i&&"bottom"!==i&&s[i="bottom"]&&(i="top"===i?"bottom":"top"):"left"!==i&&"right"!==i&&s[i="left"]&&(i="left"===i?"right":"left"),s[i]=!0;var n=new d_(o,Cv.createScaleByModel(t),[0,0],t.get("type"),i),r="category"===n.type;n.onBand=r&&t.get("boundaryGap"),n.inverse=t.get("inverse"),n.onZero=t.get("axisLine.onZero"),n.onZeroAxisIndex=t.get("axisLine.onZeroAxisIndex"),(t.axis=n).model=t,n.grid=this,n.index=e,this._axesList.push(n),l[o][e]=n,h[o]++}}}this._axesMap=l,S_(l.x,function(r,o){S_(l.y,function(t,e){var i="x"+o+"y"+e,n=new c_(i);n.grid=this,n.model=a,this._coordsMap[i]=n,this._coordsList.push(n),n.addAxis(r),n.addAxis(t)},this)},this)},P_._updateScale=function(l,h){function c(e,i,t){S_(t.coordDimToDataDim(i.dim),function(t){i.scale.unionExtentFromData(e,t)})}za.each(this._axesList,function(t){t.scale.setExtent(1/0,-1/0)}),l.eachSeries(function(t){if(O_(t)){var e=D_(t,l),i=e[0],n=e[1];if(!A_(i,h)||!A_(n,h))return;var r=this.getCartesian(i.componentIndex,n.componentIndex),o=t.getData(),a=r.getAxis("x"),s=r.getAxis("y");"list"===o.type&&(c(o,a,t),c(o,s,t))}},this)},P_.getTooltipAxes=function(n){var r=[],o=[];return S_(this.getCartesians(),function(t){var e=null!=n&&"auto"!==n?t.getAxis(n):t.getBaseAxis(),i=t.getOtherAxis(e);za.indexOf(r,e)<0&&r.push(e),za.indexOf(o,i)<0&&o.push(i)}),{baseAxes:r,otherAxes:o}};var R_=["xAxis","yAxis"];function D_(e,t){return za.map(R_,function(t){return e.getReferringComponents(t)[0]})}function O_(t){return"cartesian2d"===t.get("coordinateSystem")}E_.create=function(n,r){var o=[];return n.eachComponent("grid",function(t,e){var i=new E_(t,n,r);i.name="grid_"+e,i.resize(t,r,!0),t.coordinateSystem=i,o.push(i)}),n.eachSeries(function(t){if(O_(t)){var e=D_(t),i=e[0],n=e[1],r=i.getCoordSysModel().coordinateSystem;t.coordinateSystem=r.getCartesian(i.componentIndex,n.componentIndex)}}),o},E_.dimensions=E_.prototype.dimensions=c_.prototype.dimensions,mg.register("cartesian2d",E_);var k_=za.retrieve,z_=za.defaults,N_=za.extend,B_=za.each,F_=Uc.isRadianAroundZero,G_=Uc.remRadian,V_=Bv.createSymbol,H_=Ha.applyTransform,U_=Math.PI;function W_(t){var e={componentType:t.mainType};return e[t.mainType+"Index"]=t.componentIndex,e}var j_=function(t,e){this.opt=e,this.axisModel=t,z_(e,{labelOffset:0,nameDirection:1,tickDirection:1,labelDirection:1,silent:!0}),this.group=new pf.Group;var i=new pf.Group({position:e.position.slice(),rotation:e.rotation});i.updateTransform(),this._transform=i.transform,this._dumbGroup=i};j_.prototype={constructor:j_,hasBuilder:function(t){return!!Z_[t]},add:function(t){Z_[t].call(this)},getGroup:function(){return this.group}};var Z_={axisLine:function(){var t=this.opt,e=this.axisModel;if(e.get("axisLine.show")){var i=this.axisModel.axis.getExtent(),n=this._transform,r=[i[0],0],o=[i[1],0];n&&(H_(r,r,n),H_(o,o,n));var a=N_({lineCap:"round"},e.getModel("axisLine.lineStyle").getLineStyle());this.group.add(new pf.Line(pf.subPixelOptimizeLine({anid:"line",shape:{x1:r[0],y1:r[1],x2:o[0],y2:o[1]},style:a,strokeContainThreshold:t.strokeContainThreshold||5,silent:!0,z2:1})));var s=e.get("axisLine.symbol"),l=e.get("axisLine.symbolSize");if(null!=s){"string"==typeof s&&(s=[s,s]),"string"!=typeof l&&"number"!=typeof l||(l=[l,l]);var h=l[0],c=l[1];B_([[t.rotation+Math.PI/2,r],[t.rotation-Math.PI/2,o]],function(t,e){if("none"!==s[e]&&null!=s[e]){var i=V_(s[e],-h/2,-c/2,h,c,a.stroke,!0);i.attr({rotation:t[0],position:t[1],silent:!0}),this.group.add(i)}},this)}}},axisTickLabel:function(){var t=this.axisModel,e=this.opt,i=function(t,e,i){var n=e.axis;if(!e.get("axisTick.show")||n.scale.isBlank())return;for(var r=e.getModel("axisTick"),o=r.getModel("lineStyle"),a=r.get("length"),s=$_(r,i.labelInterval),l=n.getTicksCoords(r.get("alignWithLabel")),h=n.scale.getTicks(),c=e.get("axisLabel.showMinLabel"),u=e.get("axisLabel.showMaxLabel"),d=[],p=[],f=t._transform,g=[],m=l.length,v=0;v<m;v++)if(!Q_(n,v,s,m,c,u)){var y=l[v];d[0]=y,d[1]=0,p[0]=y,p[1]=i.tickDirection*a,f&&(H_(d,d,f),H_(p,p,f));var _=new pf.Line(pf.subPixelOptimizeLine({anid:"tick_"+h[v],shape:{x1:d[0],y1:d[1],x2:p[0],y2:p[1]},style:z_(o.getLineStyle(),{stroke:e.get("axisLine.lineStyle.color")}),z2:2,silent:!0}));t.group.add(_),g.push(_)}return g}(this,t,e);!function(t,e,i){var n=t.get("axisLabel.showMinLabel"),r=t.get("axisLabel.showMaxLabel");i=i||[];var o=(e=e||[])[0],a=e[1],s=e[e.length-1],l=e[e.length-2],h=i[0],c=i[1],u=i[i.length-1],d=i[i.length-2];!1===n?(Y_(o),Y_(h)):J_(o,a)&&(n?(Y_(a),Y_(c)):(Y_(o),Y_(h)));!1===r?(Y_(s),Y_(u)):J_(l,s)&&(r?(Y_(l),Y_(d)):(Y_(s),Y_(u)))}(t,function(s,l,h){var c=l.axis;if(!k_(h.axisLabelShow,l.get("axisLabel.show"))||c.scale.isBlank())return;var u=l.getModel("axisLabel"),d=u.get("margin"),p=c.scale.getTicks(),f=l.getFormattedLabels(),t=(k_(h.labelRotate,u.get("rotate"))||0)*U_/180,g=X_(h.rotation,t,h.labelDirection),m=l.get("data"),v=[],y=q_(l),_=l.get("triggerEvent"),x=l.get("axisLabel.showMinLabel"),w=l.get("axisLabel.showMaxLabel");return B_(p,function(t,e){if(!Q_(c,e,h.labelInterval,p.length,x,w)){var i=u;m&&m[t]&&m[t].textStyle&&(i=new bf(m[t].textStyle,u,l.ecModel));var n=i.getTextColor()||l.get("axisLine.lineStyle.color"),r=[c.dataToCoord(t),h.labelOffset+h.labelDirection*d],o=c.scale.getLabel(t),a=new pf.Text({anid:"label_"+t,position:r,rotation:g.rotation,silent:y,z2:10});pf.setTextStyle(a.style,i,{text:f[e],textAlign:i.getShallow("align",!0)||g.textAlign,textVerticalAlign:i.getShallow("verticalAlign",!0)||i.getShallow("baseline",!0)||g.textVerticalAlign,textFill:"function"==typeof n?n("category"===c.type?o:"value"===c.type?t+"":t,e):n}),_&&(a.eventData=W_(l),a.eventData.targetType="axisLabel",a.eventData.value=o),s._dumbGroup.add(a),a.updateTransform(),v.push(a),s.group.add(a),a.decomposeTransform()}}),v}(this,t,e),i)},axisName:function(){var t=this.opt,e=this.axisModel,i=k_(t.axisName,e.get("name"));if(i){var n,r,o=e.get("nameLocation"),a=t.nameDirection,s=e.getModel("nameTextStyle"),l=e.get("nameGap")||0,h=this.axisModel.axis.getExtent(),c=h[0]>h[1]?-1:1,u=["start"===o?h[0]-c*l:"end"===o?h[1]+c*l:(h[0]+h[1])/2,K_(o)?t.labelOffset+a*l:0],d=e.get("nameRotate");null!=d&&(d=d*U_/180),K_(o)?n=X_(t.rotation,null!=d?d:t.rotation,a):(n=function(t,e,i,n){var r,o,a=G_(i-t.rotation),s=n[0]>n[1],l="start"===e&&!s||"start"!==e&&s;F_(a-U_/2)?(o=l?"bottom":"top",r="center"):F_(a-1.5*U_)?(o=l?"top":"bottom",r="center"):(o="middle",r=a<1.5*U_&&U_/2<a?l?"left":"right":l?"right":"left");return{rotation:a,textAlign:r,textVerticalAlign:o}}(t,o,d||0,h),null!=(r=t.axisNameAvailableWidth)&&(r=Math.abs(r/Math.sin(n.rotation)),!isFinite(r)&&(r=null)));var p=s.getFont(),f=e.get("nameTruncate",!0)||{},g=f.ellipsis,m=k_(t.nameTruncateMaxWidth,f.maxWidth,r),v=null!=g&&null!=m?Yc.truncateText(i,m,p,g,{minChar:2,placeholder:f.placeholder}):i,y=e.get("tooltip",!0),_=e.mainType,x={componentType:_,name:i,$vars:["name"]};x[_+"Index"]=e.componentIndex;var w=new pf.Text({anid:"name",__fullText:i,__truncatedText:v,position:u,rotation:n.rotation,silent:q_(e),z2:1,tooltip:y&&y.show?N_({content:i,formatter:function(){return i},formatterParams:x},y):null});pf.setTextStyle(w.style,s,{text:v,textFont:p,textFill:s.getTextColor()||e.get("axisLine.lineStyle.color"),textAlign:n.textAlign,textVerticalAlign:n.textVerticalAlign}),e.get("triggerEvent")&&(w.eventData=W_(e),w.eventData.targetType="axisName",w.eventData.name=i),this._dumbGroup.add(w),w.updateTransform(),this.group.add(w),w.decomposeTransform()}}},X_=j_.innerTextLayout=function(t,e,i){var n,r,o=G_(e-t);return F_(o)?(r=0<i?"top":"bottom",n="center"):F_(o-U_)?(r=0<i?"bottom":"top",n="center"):(r="middle",n=0<o&&o<U_?0<i?"right":"left":0<i?"left":"right"),{rotation:o,textAlign:n,textVerticalAlign:r}};function q_(t){var e=t.get("tooltip");return t.get("silent")||!(t.get("triggerEvent")||e&&e.show)}function Y_(t){t&&(t.ignore=!0)}function J_(t,e,i){var n=t&&t.getBoundingRect().clone(),r=e&&e.getBoundingRect().clone();if(n&&r){var o=ns.identity([]);return ns.rotate(o,o,-t.rotation),n.applyTransform(ns.mul([],o,t.getLocalTransform())),r.applyTransform(ns.mul([],o,e.getLocalTransform())),n.intersect(r)}}function K_(t){return"middle"===t||"center"===t}var Q_=j_.ifIgnoreOnTick=function(t,e,i,n,r,o){if(0===e&&r||e===n-1&&o)return!1;var a,s=t.scale;return"ordinal"===s.type&&("function"==typeof i?!i(a=s.getTicks()[e],s.getLabel(a)):e%(i+1))},$_=j_.getInterval=function(t,e){var i=t.get("interval");return null!=i&&"auto"!=i||(i=e),i};var tx=j_,ex=za.each,ix=za.curry;function nx(t,e){return"all"===t||za.isArray(t)&&0<=za.indexOf(t,e)||t===e}function rx(t){var e=(t.ecModel.getComponent("axisPointer")||{}).coordSysAxesInfo;return e&&e.axesInfo[ax(t)]}function ox(t){return!!t.get("handle.show")}function ax(t){return t.type+"||"+t.id}var sx={collect:function(t,e){var f,g,i,a,m,v,y,n={axesInfo:{},seriesInvolved:!1,coordSysAxesInfo:{},coordSysMap:{}};return f=n,i=e,a=(g=t).getComponent("tooltip"),m=g.getComponent("axisPointer"),v=m.get("link",!0)||[],y=[],ex(i.getCoordinateSystems(),function(u){if(u.axisPointerEnabled){var t=ax(u.model),d=f.coordSysAxesInfo[t]={},e=(f.coordSysMap[t]=u).model,p=e.getModel("tooltip",a);if(ex(u.getAxes(),ix(o,!1,null)),u.getTooltipAxes&&a&&p.get("show")){var i="axis"===p.get("trigger"),n="cross"===p.get("axisPointer.type"),r=u.getTooltipAxes(p.get("axisPointer.axis"));(i||n)&&ex(r.baseAxes,ix(o,!n||"cross",i)),n&&ex(r.otherAxes,ix(o,"cross",!1))}}function o(t,e,i){var n=i.model.getModel("axisPointer",m),r=n.get("show");if(r&&("auto"!==r||t||ox(n))){null==e&&(e=n.get("triggerTooltip"));var o=(n=t?function(t,e,i,n,r,o){var a=e.getModel("axisPointer"),s={};ex(["type","snap","lineStyle","shadowStyle","label","animation","animationDurationUpdate","animationEasingUpdate","z"],function(t){s[t]=za.clone(a.get(t))}),s.snap="category"!==t.type&&!!o,"cross"===a.get("type")&&(s.type="line");var l=s.label||(s.label={});if(null==l.show&&(l.show=!1),"cross"===r&&(l.show=!0,!o)){var h=s.lineStyle=a.get("crossStyle");h&&za.defaults(l,h.textStyle)}return t.model.getModel("axisPointer",new bf(s,i,n))}(i,p,m,g,t,e):n).get("snap"),a=ax(i.model),s=e||o||"category"===i.type,l=f.axesInfo[a]={key:a,axis:i,coordSys:u,axisPointerModel:n,triggerTooltip:e,involveSeries:s,snap:o,useHandle:ox(n),seriesModels:[]};d[a]=l,f.seriesInvolved|=s;var h=function(t,e){for(var i=e.model,n=e.dim,r=0;r<t.length;r++){var o=t[r]||{};if(nx(o[n+"AxisId"],i.id)||nx(o[n+"AxisIndex"],i.componentIndex)||nx(o[n+"AxisName"],i.name))return r}}(v,i);if(null!=h){var c=y[h]||(y[h]={axesInfo:{}});c.axesInfo[a]=l,c.mapper=v[h].mapper,l.linkGroup=c}}}}),n.seriesInvolved&&function(r,t){t.eachSeries(function(i){var n=i.coordinateSystem,t=i.get("tooltip.trigger",!0),e=i.get("tooltip.show",!0);n&&"none"!==t&&!1!==t&&"item"!==t&&!1!==e&&!1!==i.get("axisPointer.show",!0)&&ex(r.coordSysAxesInfo[ax(n.model)],function(t){var e=t.axis;n.getAxis(e.dim)===e&&(t.seriesModels.push(i),null==t.seriesDataCount&&(t.seriesDataCount=0),t.seriesDataCount+=i.getData().count())})},this)}(n,t),n},fixValue:function(t){var e=rx(t);if(e){var i=e.axisPointerModel,n=e.axis.scale,r=i.option,o=i.get("status"),a=i.get("value");null!=a&&(a=n.parse(a));var s=ox(i);null==o&&(r.status=s?"show":"hide");var l=n.getExtent().slice();l[0]>l[1]&&l.reverse(),(null==a||a>l[1])&&(a=l[1]),a<l[0]&&(a=l[0]),r.value=a,s&&(r.status=e.axis.scale.isBlank()?"hide":"show")}},getAxisInfo:rx,getAxisPointerModel:function(t){var e=rx(t);return e&&e.axisPointerModel},makeKey:ax},lx=fy.extendComponentView({type:"axis",_axisPointer:null,axisPointerClass:null,render:function(t,e,i,n){this.axisPointerClass&&sx.fixValue(t),lx.superApply(this,"render",arguments),hx(this,t,e,i,n,!0)},updateAxisPointer:function(t,e,i,n,r){hx(this,t,e,i,n,!1)},remove:function(t,e){var i=this._axisPointer;i&&i.remove(e),lx.superApply(this,"remove",arguments)},dispose:function(t,e){cx(this,e),lx.superApply(this,"dispose",arguments)}});function hx(t,e,i,n,r,o){var a=lx.getAxisPointerClass(t.axisPointerClass);if(a){var s=sx.getAxisPointerModel(e);s?(t._axisPointer||(t._axisPointer=new a)).render(e,s,n,o):cx(t,n)}}function cx(t,e,i){var n=t._axisPointer;n&&n.dispose(e,i),t._axisPointer=null}var ux=[];lx.registerAxisPointerClass=function(t,e){ux[t]=e},lx.getAxisPointerClass=function(t){return t&&ux[t]};var dx=lx;var px={layout:function(t,e,i){i=i||{};var n=t.coordinateSystem,r=e.axis,o={},a=r.position,s=r.onZero?"onZero":a,l=r.dim,h=n.getRect(),c=[h.x,h.x+h.width,h.y,h.y+h.height],u={left:0,right:1,top:0,bottom:1,onZero:2},d=e.get("offset")||0,p="x"===l?[c[2]-d,c[3]+d]:[c[0]-d,c[1]+d];if(r.onZero){var f=n.getAxis("x"===l?"y":"x",r.onZeroAxisIndex),g=f.toGlobalCoord(f.dataToCoord(0));p[u.onZero]=Math.max(Math.min(g,p[1]),p[0])}o.position=["y"===l?p[u[s]]:c[0],"x"===l?p[u[s]]:c[3]],o.rotation=Math.PI/2*("x"===l?0:1),o.labelDirection=o.tickDirection=o.nameDirection={top:-1,bottom:1,left:-1,right:1}[a],o.labelOffset=r.onZero?p[u[a]]-p[u.onZero]:0,e.get("axisTick.inside")&&(o.tickDirection=-o.tickDirection),za.retrieve(i.labelInside,e.get("axisLabel.inside"))&&(o.labelDirection=-o.labelDirection);var m=e.get("axisLabel.rotate");return o.labelRotate="top"===s?-m:m,o.labelInterval=r.getLabelInterval(),o.z2=1,o}},fx=tx.ifIgnoreOnTick,gx=tx.getInterval,mx=["axisLine","axisTickLabel","axisName"],vx=["splitArea","splitLine"],yx=dx.extend({type:"cartesianAxis",axisPointerClass:"CartesianAxisPointer",render:function(e,t,i,n){this.group.removeAll();var r=this._axisGroup;if(this._axisGroup=new pf.Group,this.group.add(this._axisGroup),e.get("show")){var o=e.getCoordSysModel(),a=px.layout(o,e),s=new tx(e,a);za.each(mx,s.add,s),this._axisGroup.add(s.getGroup()),za.each(vx,function(t){e.get(t+".show")&&this["_"+t](e,o,a.labelInterval)},this),pf.groupTransition(r,this._axisGroup,e),yx.superCall(this,"render",e,t,i,n)}},_splitLine:function(t,e,i){var n=t.axis;if(!n.scale.isBlank()){var r=t.getModel("splitLine"),o=r.getModel("lineStyle"),a=o.get("color"),s=gx(r,i);a=za.isArray(a)?a:[a];for(var l=e.coordinateSystem.getRect(),h=n.isHorizontal(),c=0,u=n.getTicksCoords(),d=n.scale.getTicks(),p=t.get("axisLabel.showMinLabel"),f=t.get("axisLabel.showMaxLabel"),g=[],m=[],v=o.getLineStyle(),y=0;y<u.length;y++)if(!fx(n,y,s,u.length,p,f)){var _=n.toGlobalCoord(u[y]);h?(g[0]=_,g[1]=l.y,m[0]=_,m[1]=l.y+l.height):(g[0]=l.x,g[1]=_,m[0]=l.x+l.width,m[1]=_);var x=c++%a.length;this._axisGroup.add(new pf.Line(pf.subPixelOptimizeLine({anid:"line_"+d[y],shape:{x1:g[0],y1:g[1],x2:m[0],y2:m[1]},style:za.defaults({stroke:a[x]},v),silent:!0})))}}},_splitArea:function(t,e,i){var n=t.axis;if(!n.scale.isBlank()){var r=t.getModel("splitArea"),o=r.getModel("areaStyle"),a=o.get("color"),s=e.coordinateSystem.getRect(),l=n.getTicksCoords(),h=n.scale.getTicks(),c=n.toGlobalCoord(l[0]),u=n.toGlobalCoord(l[0]),d=0,p=gx(r,i),f=o.getAreaStyle();a=za.isArray(a)?a:[a];for(var g=t.get("axisLabel.showMinLabel"),m=t.get("axisLabel.showMaxLabel"),v=1;v<l.length;v++)if(!fx(n,v,p,l.length,g,m)){var y,_,x,w,b=n.toGlobalCoord(l[v]);n.isHorizontal()?(y=c,_=s.y,x=b-y,w=s.height):(y=s.x,_=u,x=s.width,w=b-_);var M=d++%a.length;this._axisGroup.add(new pf.Rect({anid:"area_"+h[v],shape:{x:y,y:_,width:x,height:w},style:za.defaults({fill:a[M]},f),silent:!0})),c=y+x,u=_+w}}}});yx.extend({type:"xAxis"}),yx.extend({type:"yAxis"}),fy.extendComponentView({type:"grid",render:function(t,e){this.group.removeAll(),t.get("show")&&this.group.add(new pf.Rect({shape:t.coordinateSystem.getRect(),style:za.defaults({fill:t.get("backgroundColor")},t.getItemStyle()),silent:!0,z2:-1}))}}),fy.registerPreprocessor(function(t){t.xAxis&&t.yAxis&&!t.grid&&(t.grid={})}),fy.registerVisual(za.curry(e_,"line","circle","line")),fy.registerLayout(za.curry(i_,"line")),fy.registerProcessor(fy.PRIORITY.PROCESSOR.STATISTIC,za.curry(o_,"line"));var _x=Uc.parsePercent,xx="__ec_stack_";function wx(t){return t.get("stack")||xx+t.seriesIndex}function bx(t){return t.dim+t.index}function Mx(t,e){var u={};za.each(t,function(t,e){var i=t.axisKey,n=t.bandWidth,r=u[i]||{bandWidth:n,remainedWidth:n,autoWidthCount:0,categoryGap:"20%",gap:"30%",stacks:{}},o=r.stacks;u[i]=r;var a=t.stackId;o[a]||r.autoWidthCount++,o[a]=o[a]||{width:0,maxWidth:0};var s=t.barWidth;s&&!o[a].width&&(o[a].width=s,s=Math.min(r.remainedWidth,s),r.remainedWidth-=s);var l=t.barMaxWidth;l&&(o[a].maxWidth=l);var h=t.barGap;null!=h&&(r.gap=h);var c=t.barCategoryGap;null!=c&&(r.categoryGap=c)});var d={};return za.each(u,function(t,i){d[i]={};var e=t.stacks,n=t.bandWidth,r=_x(t.categoryGap,n),o=_x(t.gap,1),a=t.remainedWidth,s=t.autoWidthCount,l=(a-r)/(s+(s-1)*o);l=Math.max(l,0),za.each(e,function(t,e){var i=t.maxWidth;i&&i<l&&(i=Math.min(i,a),t.width&&(i=Math.min(i,t.width)),a-=i,t.width=i,s--)}),l=(a-r)/(s+(s-1)*o),l=Math.max(l,0);var h,c=0;za.each(e,function(t,e){t.width||(t.width=l),c+=(h=t).width*(1+o)}),h&&(c-=h.width*o);var u=-c/2;za.each(e,function(t,e){d[i][e]=d[i][e]||{offset:u,width:t.width},u+=t.width*(1+o)})}),d}function Sx(t,e,i){var n,o=(n=za.filter(e.getSeriesByType(t),function(t){return!e.isSeriesFiltered(t)&&t.coordinateSystem&&"cartesian2d"===t.coordinateSystem.type}),Mx(za.map(n,function(t){var e=t.getData(),i=t.coordinateSystem.getBaseAxis(),n=i.getExtent(),r="category"===i.type?i.getBandWidth():Math.abs(n[1]-n[0])/e.count();return{bandWidth:r,barWidth:_x(t.get("barWidth"),r),barMaxWidth:_x(t.get("barMaxWidth"),r),barGap:t.get("barGap"),barCategoryGap:t.get("barCategoryGap"),axisKey:bx(i),stackId:wx(t)}}))),y={},_={};e.eachSeriesByType(t,function(t){if("cartesian2d"===t.coordinateSystem.type){var c=t.getData(),i=t.coordinateSystem,e=i.getBaseAxis(),u=wx(t),n=o[bx(e)][u],d=n.offset,p=n.width,f=i.getOtherAxis(e),g=t.get("barMinHeight")||0,m=e.onZero?f.toGlobalCoord(f.dataToCoord(0)):f.getGlobalExtent()[0],r=[t.coordDimToDataDim("x")[0],t.coordDimToDataDim("y")[0]],v=c.mapArray(r,function(t,e){return i.dataToPoint([t,e])},!0);y[u]=y[u]||[],_[u]=_[u]||[],c.setLayout({offset:d,size:p}),c.each(t.coordDimToDataDim(f.dim)[0],function(t,e){if(!isNaN(t)){y[u][e]||(y[u][e]={p:m,n:m},_[u][e]={p:m,n:m});var i,n,r,o,a=0<=t?"p":"n",s=v[e],l=y[u][e][a],h=_[u][e][a];f.isHorizontal()?(i=l,n=s[1]+d,r=s[0]-h,o=p,_[u][e][a]+=r,Math.abs(r)<g&&(r=(r<0?-1:1)*g),y[u][e][a]+=r):(i=s[0]+d,n=l,r=p,o=s[1]-h,_[u][e][a]+=o,Math.abs(o)<g&&(o=(o<=0?-1:1)*g),y[u][e][a]+=o),c.setItemLayout(e,{x:i,y:n,width:r,height:o})}},!0)}},this)}Sx.getLayoutOnAxis=function(t,e){var i=[],n=t.axis;if("category"===n.type){for(var r=n.getBandWidth(),o=0;o<t.count;o++)i.push(za.defaults({bandWidth:r,axisKey:"axis0",stackId:xx+o},t));var a=Mx(i),s=[];for(o=0;o<t.count;o++){var l=a.axis0[xx+o];l.offsetCenter=l.offset+l.width/2,s.push(l)}return s}};var Tx=Sx,Cx=Qg.extend({type:"series.__base_bar__",getInitialData:function(t,e){return Xm(t.data,this,e)},getMarkerPosition:function(t){var e=this.coordinateSystem;if(e){var i=e.dataToPoint(t,!0),n=this.getData(),r=n.getLayout("offset"),o=n.getLayout("size");return i[e.getBaseAxis().isHorizontal()?0:1]+=r+o/2,i}return[NaN,NaN]},defaultOption:{zlevel:0,z:2,coordinateSystem:"cartesian2d",legendHoverLink:!0,barMinHeight:0,barMinAngle:0,itemStyle:{}}});Cx.extend({type:"series.bar",dependencies:["grid","polar"],brushSelector:"rect"});function Ax(t,e){"outside"===t.textPosition&&(t.textPosition=e)}var Ex={setLabel:function(t,e,i,n,r,o,a){var s=i.getModel("label.normal"),l=i.getModel("label.emphasis");pf.setLabelStyle(t,e,s,l,{labelFetcher:r,labelDataIndex:o,defaultText:r.getRawValue(o),isRectText:!0,autoColor:n}),Ax(t),Ax(e)}},Px=nu([["fill","color"],["stroke","borderColor"],["lineWidth","borderWidth"],["stroke","barBorderColor"],["lineWidth","barBorderWidth"],["opacity"],["shadowBlur"],["shadowOffsetX"],["shadowOffsetY"],["shadowColor"]]),Lx={getBarItemStyle:function(t){var e=Px(this,t);if(this.getBorderLineDash){var i=this.getBorderLineDash();i&&(e.lineDash=i)}return e}},Ix=Ex.setLabel,Rx=["itemStyle","normal","barBorderWidth"];za.extend(bf.prototype,Lx);fy.extendChartView({type:"bar",render:function(t,e,i){var n=t.get("coordinateSystem");return"cartesian2d"!==n&&"polar"!==n||this._render(t,e,i),this.group},dispose:za.noop,_render:function(o,t,e){var a,s=this.group,l=o.getData(),h=this._data,c=o.coordinateSystem,i=c.getBaseAxis();"cartesian2d"===c.type?a=i.isHorizontal():"polar"===c.type&&(a="angle"===i.dim);var u=o.isAnimationEnabled()?o:null;l.diff(h).add(function(t){if(l.hasValue(t)){var e=l.getItemModel(t),i=zx[c.type](l,t,e),n=Dx[c.type](l,t,e,i,a,u);l.setItemGraphicEl(t,n),s.add(n),Nx(n,l,t,e,i,o,a,"polar"===c.type)}}).update(function(t,e){var i=h.getItemGraphicEl(e);if(l.hasValue(t)){var n=l.getItemModel(t),r=zx[c.type](l,t,n);i?pf.updateProps(i,{shape:r},u,t):i=Dx[c.type](l,t,n,r,a,u,!0),l.setItemGraphicEl(t,i),s.add(i),Nx(i,l,t,n,r,o,a,"polar"===c.type)}else s.remove(i)}).remove(function(t){var e=h.getItemGraphicEl(t);"cartesian2d"===c.type?e&&Ox(t,u,e):e&&kx(t,u,e)}).execute(),this._data=l},remove:function(e,t){var i=this.group,n=this._data;e.get("animation")?n&&n.eachItemGraphicEl(function(t){"sector"===t.type?kx(t.dataIndex,e,t):Ox(t.dataIndex,e,t)}):i.removeAll()}});var Dx={cartesian2d:function(t,e,i,n,r,o,a){var s=new pf.Rect({shape:za.extend({},n)});if(o){var l=r?"height":"width",h={};s.shape[l]=0,h[l]=n[l],pf[a?"updateProps":"initProps"](s,{shape:h},o,e)}return s},polar:function(t,e,i,n,r,o,a){var s=new pf.Sector({shape:za.extend({},n)});if(o){var l=r?"r":"endAngle",h={};s.shape[l]=r?0:n.startAngle,h[l]=n[l],pf[a?"updateProps":"initProps"](s,{shape:h},o,e)}return s}};function Ox(t,e,i){i.style.text=null,pf.updateProps(i,{shape:{width:0}},e,t,function(){i.parent&&i.parent.remove(i)})}function kx(t,e,i){i.style.text=null,pf.updateProps(i,{shape:{r:i.shape.r0}},e,t,function(){i.parent&&i.parent.remove(i)})}var zx={cartesian2d:function(t,e,i){var n,r,o=t.getItemLayout(e),a=(n=o,r=i.get(Rx)||0,Math.min(r,Math.abs(n.width),Math.abs(n.height))),s=0<o.width?1:-1,l=0<o.height?1:-1;return{x:o.x+s*a/2,y:o.y+l*a/2,width:o.width-s*a,height:o.height-l*a}},polar:function(t,e,i){var n=t.getItemLayout(e);return{cx:n.cx,cy:n.cy,r0:n.r0,r:n.r,startAngle:n.startAngle,endAngle:n.endAngle}}};function Nx(t,e,i,n,r,o,a,s){var l=e.getItemVisual(i,"color"),h=e.getItemVisual(i,"opacity"),c=n.getModel("itemStyle.normal"),u=n.getModel("itemStyle.emphasis").getBarItemStyle();s||t.setShape("r",c.get("barBorderRadius")||0),t.useStyle(za.defaults({fill:l,opacity:h},c.getBarItemStyle()));var d=n.getShallow("cursor");d&&t.attr("cursor",d);var p=a?0<r.height?"bottom":"top":0<r.width?"left":"right";s||Ix(t.style,u,n,l,o,i,p),pf.setHoverStyle(t,u)}fy.registerLayout(za.curry(Tx,"bar")),fy.registerVisual(function(t){t.eachSeriesByType("bar",function(t){t.getData().setVisual("legendSymbol","roundRect")})});var Bx={updateSelectedMap:function(t){this._targetList=t.slice(),this._selectTargetMap=za.reduce(t||[],function(t,e){return t.set(e.name,e),t},za.createHashMap())},select:function(t,e){var i=null!=e?this._targetList[e]:this._selectTargetMap.get(t);"single"===this.get("selectedMode")&&this._selectTargetMap.each(function(t){t.selected=!1}),i&&(i.selected=!0)},unSelect:function(t,e){var i=null!=e?this._targetList[e]:this._selectTargetMap.get(t);i&&(i.selected=!1)},toggleSelected:function(t,e){var i=null!=e?this._targetList[e]:this._selectTargetMap.get(t);if(null!=i)return this[i.selected?"unSelect":"select"](t,e),i.selected},isSelected:function(t,e){var i=null!=e?this._targetList[e]:this._selectTargetMap.get(t);return i&&i.selected}},Fx=Uc.getPercentWithPrecision,Gx=fy.extendSeriesModel({type:"series.pie",init:function(t){Gx.superApply(this,"init",arguments),this.legendDataProvider=function(){return this.getRawData()},this.updateSelectedMap(t.data),this._defaultLabelLine(t)},mergeOption:function(t){Gx.superCall(this,"mergeOption",t),this.updateSelectedMap(this.option.data)},getInitialData:function(t,e){var i=Gm(["value"],t.data),n=new Im(i,this);return n.initData(t.data),n},getDataParams:function(t){var e=this.getData(),i=Gx.superCall(this,"getDataParams",t),n=[];return e.each("value",function(t){n.push(t)}),i.percent=Fx(n,t,e.hostModel.get("percentPrecision")),i.$vars.push("percent"),i},_defaultLabelLine:function(t){If.defaultEmphasis(t.labelLine,["show"]);var e=t.labelLine.normal,i=t.labelLine.emphasis;e.show=e.show&&t.label.normal.show,i.show=i.show&&t.label.emphasis.show},defaultOption:{zlevel:0,z:2,legendHoverLink:!0,hoverAnimation:!0,center:["50%","50%"],radius:[0,"75%"],clockwise:!0,startAngle:90,minAngle:0,selectedOffset:10,hoverOffset:10,avoidLabelOverlap:!0,percentPrecision:2,stillShowZeroSum:!0,label:{normal:{rotate:!1,show:!0,position:"outer"},emphasis:{}},labelLine:{normal:{show:!0,length:15,length2:15,smooth:!1,lineStyle:{width:1,type:"solid"}}},itemStyle:{normal:{borderWidth:1},emphasis:{}},animationType:"expansion",animationEasing:"cubicOut",data:[]}});function Vx(t,e,i,n){var r=e.getData(),o=this.dataIndex,a=r.getName(o),s=e.get("selectedOffset");n.dispatchAction({type:"pieToggleSelect",from:t,name:a,seriesId:e.id}),r.each(function(t){Hx(r.getItemGraphicEl(t),r.getItemLayout(t),e.isSelected(r.getName(t)),s,i)})}function Hx(t,e,i,n,r){var o=(e.startAngle+e.endAngle)/2,a=i?n:0,s=[Math.cos(o)*a,Math.sin(o)*a];r?t.animate().when(200,{position:s}).start("bounceOut"):t.attr("position",s)}function Ux(t,e){pf.Group.call(this);var i=new pf.Sector({z2:2}),n=new pf.Polyline,r=new pf.Text;function o(){n.ignore=n.hoverIgnore,r.ignore=r.hoverIgnore}function a(){n.ignore=n.normalIgnore,r.ignore=r.normalIgnore}this.add(i),this.add(n),this.add(r),this.updateData(t,e,!0),this.on("emphasis",o).on("normal",a).on("mouseover",o).on("mouseout",a)}za.mixin(Gx,Bx);var Wx=Ux.prototype;Wx.updateData=function(t,e,i){var n=this.childAt(0),r=t.hostModel,o=t.getItemModel(e),a=t.getItemLayout(e),s=za.extend({},a);(s.label=null,i)?(n.setShape(s),"scale"===r.getShallow("animationType")?(n.shape.r=a.r0,pf.initProps(n,{shape:{r:a.r}},r,e)):(n.shape.endAngle=a.startAngle,pf.updateProps(n,{shape:{endAngle:a.endAngle}},r,e))):pf.updateProps(n,{shape:s},r,e);var l=o.getModel("itemStyle"),h=t.getItemVisual(e,"color");n.useStyle(za.defaults({lineJoin:"bevel",fill:h},l.getModel("normal").getItemStyle())),n.hoverStyle=l.getModel("emphasis").getItemStyle();var c=o.getShallow("cursor");function u(){n.stopAnimation(!0),n.animateTo({shape:{r:a.r+r.get("hoverOffset")}},300,"elasticOut")}function d(){n.stopAnimation(!0),n.animateTo({shape:{r:a.r}},300,"elasticOut")}c&&n.attr("cursor",c),Hx(this,t.getItemLayout(e),o.get("selected"),r.get("selectedOffset"),r.get("animation")),n.off("mouseover").off("mouseout").off("emphasis").off("normal"),o.get("hoverAnimation")&&r.isAnimationEnabled()&&n.on("mouseover",u).on("mouseout",d).on("emphasis",u).on("normal",d),this._updateLabel(t,e),pf.setHoverStyle(this)},Wx._updateLabel=function(t,e){var i=this.childAt(1),n=this.childAt(2),r=t.hostModel,o=t.getItemModel(e),a=t.getItemLayout(e).label,s=t.getItemVisual(e,"color");pf.updateProps(i,{shape:{points:a.linePoints||[[a.x,a.y],[a.x,a.y],[a.x,a.y]]}},r,e),pf.updateProps(n,{style:{x:a.x,y:a.y}},r,e),n.attr({rotation:a.rotation,origin:[a.x,a.y],z2:10});var l=o.getModel("label.normal"),h=o.getModel("label.emphasis"),c=o.getModel("labelLine.normal"),u=o.getModel("labelLine.emphasis");s=t.getItemVisual(e,"color");pf.setLabelStyle(n.style,n.hoverStyle={},l,h,{labelFetcher:t.hostModel,labelDataIndex:e,defaultText:t.getName(e),autoColor:s,useInsideStyle:!!a.inside},{textAlign:a.textAlign,textVerticalAlign:a.verticalAlign,opacity:t.getItemVisual(e,"opacity")}),n.ignore=n.normalIgnore=!l.get("show"),n.hoverIgnore=!h.get("show"),i.ignore=i.normalIgnore=!c.get("show"),i.hoverIgnore=!u.get("show"),i.setStyle({stroke:s,opacity:t.getItemVisual(e,"opacity")}),i.setStyle(c.getModel("lineStyle").getLineStyle()),i.hoverStyle=u.getModel("lineStyle").getLineStyle();var d=c.get("smooth");d&&!0===d&&(d=.4),i.setShape({smooth:d})},za.inherits(Ux,pf.Group);am.extend({type:"pie",init:function(){var t=new pf.Group;this._sectorGroup=t},render:function(t,e,i,n){if(!n||n.from!==this.uid){var r=t.getData(),o=this._data,a=this.group,s=e.get("animation"),l=!o,h=t.get("animationType"),c=za.curry(Vx,this.uid,t,s,i),u=t.get("selectedMode");if(r.diff(o).add(function(t){var e=new Ux(r,t);l&&"scale"!==h&&e.eachChild(function(t){t.stopAnimation(!0)}),u&&e.on("click",c),r.setItemGraphicEl(t,e),a.add(e)}).update(function(t,e){var i=o.getItemGraphicEl(e);i.updateData(r,t),i.off("click"),u&&i.on("click",c),a.add(i),r.setItemGraphicEl(t,i)}).remove(function(t){var e=o.getItemGraphicEl(t);a.remove(e)}).execute(),s&&l&&0<r.count()&&"scale"!==h){var d=r.getItemLayout(0),p=Math.max(i.getWidth(),i.getHeight())/2,f=za.bind(a.removeClipPath,a);a.setClipPath(this._createClipPath(d.cx,d.cy,p,d.startAngle,d.clockwise,f,t))}this._data=r}},dispose:function(){},_createClipPath:function(t,e,i,n,r,o,a){var s=new pf.Sector({shape:{cx:t,cy:e,r0:0,r:i,startAngle:n,endAngle:n,clockwise:r}});return pf.initProps(s,{shape:{endAngle:n+(r?1:-1)*Math.PI*2}},a,o),s},containPoint:function(t,e){var i=e.getData().getItemLayout(0);if(i){var n=t[0]-i.cx,r=t[1]-i.cy,o=Math.sqrt(n*n+r*r);return o<=i.r&&o>=i.r0}}});var jx=function(i,t){za.each(t,function(o){o.update="updateView",fy.registerAction(o,function(t,e){var r={};return e.eachComponent({mainType:"series",subType:i,query:t},function(i){i[o.method]&&i[o.method](t.name,t.dataIndex);var n=i.getData();n.each(function(t){var e=n.getName(t);r[e]=i.isSelected(e)||!1})}),{name:t.name,selected:r}})})};var Zx=function(t,e){var l={};e.eachRawSeriesByType(t,function(r){var o=r.getRawData(),a={};if(!e.isSeriesFiltered(r)){var s=r.getData();s.each(function(t){var e=s.getRawIndex(t);a[e]=t}),o.each(function(t){var e=a[t],i=null!=e&&s.getItemVisual(e,"color",!0);if(i)o.setItemVisual(t,"color",i);else{var n=o.getItemModel(t).get("itemStyle.normal.color")||r.getColorFromPalette(o.getName(t),l);o.setItemVisual(t,"color",n),null!=e&&s.setItemVisual(e,"color",n)}})}})};function Xx(o,t,e,i,n,r,a){function s(t,e,i,n){for(var r=t;r<e;r++)if(o[r].y+=i,t<r&&r+1<e&&o[r+1].y>o[r].y+o[r].height)return void l(r,i/2);l(e-1,i/2)}function l(t,e){for(var i=t;0<=i&&(o[i].y-=e,!(0<i&&o[i].y>o[i-1].y+o[i-1].height));i--);}function h(t,e,i,n,r,o){for(var a=e?Number.MAX_VALUE:0,s=0,l=t.length;s<l;s++)if("center"!==t[s].position){var h=Math.abs(t[s].y-n),c=t[s].len,u=t[s].len2,d=h<r+c?Math.sqrt((r+c+u)*(r+c+u)-h*h):Math.abs(t[s].x-i);e&&a<=d&&(d=a-10),!e&&d<=a&&(d=a+10),t[s].x=i+d*o,a=d}}o.sort(function(t,e){return t.y-e.y});for(var c,u=0,d=o.length,p=[],f=[],g=0;g<d;g++)(c=o[g].y-u)<0&&s(g,d,-c),u=o[g].y+o[g].height;a-u<0&&l(d-1,u-a);for(g=0;g<d;g++)o[g].y>=e?f.push(o[g]):p.push(o[g]);h(p,!1,t,e,i,n),h(f,!0,t,e,i,n)}var qx=function(T,C,t,e){var A,E,P=T.getData(),L=[],I=!1;P.each(function(t){var e,i,n,r,o=P.getItemLayout(t),a=P.getItemModel(t),s=a.getModel("label.normal"),l=s.get("position")||a.get("label.emphasis.position"),h=a.getModel("labelLine.normal"),c=h.get("length"),u=h.get("length2"),d=(o.startAngle+o.endAngle)/2,p=Math.cos(d),f=Math.sin(d);A=o.cx,E=o.cy;var g="inside"===l||"inner"===l;if("center"===l)e=o.cx,i=o.cy,r="center";else{var m=(g?(o.r+o.r0)/2*p:o.r*p)+A,v=(g?(o.r+o.r0)/2*f:o.r*f)+E;if(e=m+3*p,i=v+3*f,!g){var y=m+p*(c+C-o.r),_=v+f*(c+C-o.r),x=y+(p<0?-1:1)*u;e=x+(p<0?-5:5),n=[[m,v],[y,_],[x,i=_]]}r=g?"center":0<p?"left":"right"}var w=s.getFont(),b=s.get("rotate")?p<0?-d+Math.PI:-d:0,M=T.getFormattedLabel(t,"normal")||P.getName(t),S=Sh.getBoundingRect(M,w,r,"top");I=!!b,o.label={x:e,y:i,position:l,height:S.height,len:c,len2:u,linePoints:n,textAlign:r,verticalAlign:"middle",rotation:b,inside:g},g||L.push(o.label)}),!I&&T.get("avoidLabelOverlap")&&function(t,e,i,n,r,o){for(var a=[],s=[],l=0;l<t.length;l++)t[l].x<e?a.push(t[l]):s.push(t[l]);for(Xx(s,e,i,n,1,0,o),Xx(a,e,i,n,-1,0,o),l=0;l<t.length;l++){var h=t[l].linePoints;if(h){var c=h[1][0]-h[2][0];t[l].x<e?h[2][0]=t[l].x+3:h[2][0]=t[l].x-3,h[1][1]=h[2][1]=t[l].y,h[1][0]=h[2][0]+c}}}(L,A,E,C,0,e)},Yx=Uc.parsePercent,Jx=Uc.linearMap,Kx=2*Math.PI,Qx=Math.PI/180;var $x=function(t,e,T,i){e.eachSeriesByType(t,function(t){var e=t.get("center"),i=t.get("radius");za.isArray(i)||(i=[0,i]),za.isArray(e)||(e=[e,e]);var n=T.getWidth(),r=T.getHeight(),o=Math.min(n,r),a=Yx(e[0],n),s=Yx(e[1],r),l=Yx(i[0],o/2),h=Yx(i[1],o/2),c=t.getData(),u=-t.get("startAngle")*Qx,d=t.get("minAngle")*Qx,p=0;c.each("value",function(t){!isNaN(t)&&p++});var f=c.getSum("value"),g=Math.PI/(f||p)*2,m=t.get("clockwise"),v=t.get("roseType"),y=t.get("stillShowZeroSum"),_=c.getDataExtent("value");_[0]=0;var x=Kx,w=0,b=u,M=m?1:-1;if(c.each("value",function(t,e){var i;if(isNaN(t))c.setItemLayout(e,{angle:NaN,startAngle:NaN,endAngle:NaN,clockwise:m,cx:a,cy:s,r0:l,r:v?NaN:h});else{(i="area"!==v?0===f&&y?g:t*g:Kx/p)<d?x-=i=d:w+=t;var n=b+M*i;c.setItemLayout(e,{angle:i,startAngle:b,endAngle:n,clockwise:m,cx:a,cy:s,r0:l,r:v?Jx(t,_,[l,h]):h}),b=n}},!0),x<Kx&&p)if(x<=.001){var S=Kx/p;c.each("value",function(t,e){if(!isNaN(t)){var i=c.getItemLayout(e);i.angle=S,i.startAngle=u+M*e*S,i.endAngle=u+M*(e+1)*S}})}else g=x/w,b=u,c.each("value",function(t,e){if(!isNaN(t)){var i=c.getItemLayout(e),n=i.angle===d?d:t*g;i.startAngle=b,i.endAngle=b+M*n,b+=M*n}});qx(t,h,n,r)})};var tw=function(t,e){var r=e.findComponents({mainType:"legend"});r&&r.length&&e.eachSeriesByType(t,function(t){var n=t.getData();n.filterSelf(function(t){for(var e=n.getName(t),i=0;i<r.length;i++)if(!r[i].isSelected(e))return!1;return!0},this)},this)};jx("pie",[{type:"pieToggleSelect",event:"pieselectchanged",method:"toggleSelected"},{type:"pieSelect",event:"pieselected",method:"select"},{type:"pieUnSelect",event:"pieunselected",method:"unSelect"}]),fy.registerVisual(za.curry(Zx,"pie")),fy.registerLayout(za.curry($x,"pie")),fy.registerProcessor(za.curry(tw,"pie"));Qg.extend({type:"series.scatter",dependencies:["grid","polar","geo","singleAxis","calendar"],getInitialData:function(t,e){return Xm(t.data,this,e)},brushSelector:"point",defaultOption:{coordinateSystem:"cartesian2d",zlevel:0,z:2,legendHoverLink:!0,hoverAnimation:!0,symbolSize:10,large:!1,largeThreshold:2e3,itemStyle:{normal:{opacity:.8}}}});var ew=Bv.createSymbol,iw=pf.extendShape({shape:{points:null,sizes:null},symbolProxy:null,buildPath:function(t,e){for(var i=e.points,n=e.sizes,r=this.symbolProxy,o=r.shape,a=0;a<i.length;a++){var s=i[a];if(!isNaN(s[0])&&!isNaN(s[1])){var l=n[a];l[0]<4?t.rect(s[0]-l[0]/2,s[1]-l[1]/2,l[0],l[1]):(o.x=s[0]-l[0]/2,o.y=s[1]-l[1]/2,o.width=l[0],o.height=l[1],r.buildPath(t,o,!0))}}},findDataIndex:function(t,e){for(var i=this.shape,n=i.points,r=i.sizes,o=n.length-1;0<=o;o--){var a=n[o],s=r[o],l=a[0]-s[0]/2,h=a[1]-s[1]/2;if(l<=t&&h<=e&&t<=l+s[0]&&e<=h+s[1])return o}return-1}});function nw(){this.group=new pf.Group,this._symbolEl=new iw({})}var rw=nw.prototype;rw.updateData=function(i){this.group.removeAll();var n=this._symbolEl,t=i.hostModel;n.setShape({points:i.mapArray(i.getItemLayout),sizes:i.mapArray(function(t){var e=i.getItemVisual(t,"symbolSize");return e instanceof Array||(e=[e,e]),e})}),n.symbolProxy=ew(i.getVisual("symbol"),0,0,0,0),n.setColor=n.symbolProxy.setColor,n.useStyle(t.getModel("itemStyle.normal").getItemStyle(["color"]));var e=i.getVisual("color");e&&n.setColor(e),n.seriesIndex=t.seriesIndex,n.on("mousemove",function(t){n.dataIndex=null;var e=n.findDataIndex(t.offsetX,t.offsetY);0<=e&&(n.dataIndex=e)}),this.group.add(n)},rw.updateLayout=function(t){var e=t.getData();this._symbolEl.setShape({points:e.mapArray(e.getItemLayout)})},rw.remove=function(){this.group.removeAll()};var ow=nw;function aw(t,e,i){Wv.call(this,t,e,i),this.type="value",this.angle=0,this.name="",this.model}fy.extendChartView({type:"scatter",init:function(){this._normalSymbolDraw=new Ry,this._largeSymbolDraw=new ow},render:function(t,e,i){var n=t.getData(),r=this._largeSymbolDraw,o=this._normalSymbolDraw,a=this.group,s=t.get("large")&&n.count()>t.get("largeThreshold")?r:o;(this._symbolDraw=s).updateData(n),a.add(s.group),a.remove(s===r?o.group:r.group)},updateLayout:function(t){this._symbolDraw.updateLayout(t)},remove:function(t,e){this._symbolDraw&&this._symbolDraw.remove(e,!0)},dispose:function(){}}),fy.registerVisual(za.curry(e_,"scatter","circle",null)),fy.registerLayout(za.curry(i_,"scatter")),za.inherits(aw,Wv);var sw=aw,lw=Cv.getScaleExtent,hw=Cv.niceScaleExtent;function cw(t,e,i){this._model=t,this.dimensions=[],this._indicatorAxes=za.map(t.getIndicatorModels(),function(t,e){var i="indicator_"+e,n=new sw(i,new av);return n.name=t.get("name"),(n.model=t).axis=n,this.dimensions.push(i),n},this),this.resize(t,i),this.cx,this.cy,this.r,this.startAngle}cw.prototype.getIndicatorAxes=function(){return this._indicatorAxes},cw.prototype.dataToPoint=function(t,e){var i=this._indicatorAxes[e];return this.coordToPoint(i.dataToCoord(t),e)},cw.prototype.coordToPoint=function(t,e){var i=this._indicatorAxes[e].angle;return[this.cx+t*Math.cos(i),this.cy-t*Math.sin(i)]},cw.prototype.pointToData=function(t){var e=t[0]-this.cx,i=t[1]-this.cy,n=Math.sqrt(e*e+i*i);e/=n,i/=n;for(var r,o=Math.atan2(-i,e),a=1/0,s=-1,l=0;l<this._indicatorAxes.length;l++){var h=this._indicatorAxes[l],c=Math.abs(o-h.angle);c<a&&(r=h,s=l,a=c)}return[s,+(r&&r.coodToData(n))]},cw.prototype.resize=function(t,e){var i=t.get("center"),n=e.getWidth(),r=e.getHeight(),o=Math.min(n,r)/2;this.cx=Uc.parsePercent(i[0],n),this.cy=Uc.parsePercent(i[1],r),this.startAngle=t.get("startAngle")*Math.PI/180,this.r=Uc.parsePercent(t.get("radius"),o),za.each(this._indicatorAxes,function(t,e){t.setExtent(0,this.r);var i=this.startAngle+e*Math.PI*2/this._indicatorAxes.length;i=Math.atan2(Math.sin(i),Math.cos(i)),t.angle=i},this)},cw.prototype.update=function(n,t){var r=this._indicatorAxes,o=this._model;za.each(r,function(t){t.scale.setExtent(1/0,-1/0)}),n.eachSeriesByType("radar",function(t,e){if("radar"===t.get("coordinateSystem")&&n.getComponent("radar",t.get("radarIndex"))===o){var i=t.getData();za.each(r,function(t){t.scale.unionExtentFromData(i,t.dim)})}},this);var p=o.get("splitNumber");function f(t){var e=Math.pow(10,Math.floor(Math.log(t)/Math.LN10)),i=t/e;return 2===i?i=5:i*=2,i*e}za.each(r,function(t,e){var i=lw(t.scale,t.model);hw(t.scale,t.model);var n=t.model,r=t.scale,o=n.getMin(),a=n.getMax(),s=r.getInterval();if(null!=o&&null!=a)r.setExtent(+o,+a),r.setInterval((a-o)/p);else if(null!=o)for(var l;l=o+s*p,r.setExtent(+o,l),r.setInterval(s),s=f(s),l<i[1]&&isFinite(l)&&isFinite(i[1]););else if(null!=a)for(var h;h=a-s*p,r.setExtent(h,+a),r.setInterval(s),s=f(s),h>i[0]&&isFinite(h)&&isFinite(i[0]););else{var c=r.getTicks().length-1;p<c&&(s=f(s));var u=Math.round((i[0]+i[1])/2/s)*s,d=Math.round(p/2);r.setExtent(Uc.round(u-d*s),Uc.round(u+(p-d)*s)),r.setInterval(s)}})},cw.dimensions=[],cw.create=function(i,n){var r=[];return i.eachComponent("radar",function(t){var e=new cw(t,i,n);r.push(e),t.coordinateSystem=e}),i.eachSeriesByType("radar",function(t){"radar"===t.get("coordinateSystem")&&(t.coordinateSystem=r[t.get("radarIndex")||0])}),r},mg.register("radar",cw);var uw=g_.valueAxis;function dw(t,e){return za.defaults({show:e},t)}fy.extendComponentModel({type:"radar",optionUpdated:function(){var r=this.get("boundaryGap"),o=this.get("splitNumber"),a=this.get("scale"),s=this.get("axisLine"),l=this.get("axisTick"),h=this.get("axisLabel"),c=this.get("name"),u=this.get("name.show"),d=this.get("name.formatter"),p=this.get("nameGap"),f=this.get("triggerEvent"),t=za.map(this.get("indicator")||[],function(t){null!=t.max&&0<t.max&&!t.min?t.min=0:null!=t.min&&t.min<0&&!t.max&&(t.max=0);var e=c;if(null!=t.color&&(e=za.defaults({color:t.color},c)),t=za.merge(za.clone(t),{boundaryGap:r,splitNumber:o,scale:a,axisLine:s,axisTick:l,axisLabel:h,name:t.text,nameLocation:"end",nameGap:p,nameTextStyle:e,triggerEvent:f},!1),u||(t.name=""),"string"==typeof d){var i=t.name;t.name=d.replace("{value}",null!=i?i:"")}else"function"==typeof d&&(t.name=d(t.name,t));var n=za.extend(new bf(t,null,this.ecModel),Ev);return n.mainType="radar",n.componentIndex=this.componentIndex,n},this);this.getIndicatorModels=function(){return t}},defaultOption:{zlevel:0,z:0,center:["50%","50%"],radius:"75%",startAngle:90,name:{show:!0},boundaryGap:[0,0],splitNumber:5,nameGap:15,scale:!1,shape:"polygon",axisLine:za.merge({lineStyle:{color:"#bbb"}},uw.axisLine),axisLabel:dw(uw.axisLabel,!1),axisTick:dw(uw.axisTick,!1),splitLine:dw(uw.splitLine,!0),splitArea:dw(uw.splitArea,!0),indicator:[]}});var pw=["axisLine","axisTickLabel","axisName"],fw=(fy.extendComponentView({type:"radar",render:function(t,e,i){this.group.removeAll(),this._buildAxes(t),this._buildSplitLineAndArea(t)},_buildAxes:function(t){var e=t.coordinateSystem,i=e.getIndicatorAxes(),n=za.map(i,function(t){return new tx(t.model,{position:[e.cx,e.cy],rotation:t.angle,labelDirection:-1,tickDirection:-1,nameDirection:1})});za.each(n,function(t){za.each(pw,t.add,t),this.group.add(t.getGroup())},this)},_buildSplitLineAndArea:function(t){var n=t.coordinateSystem,e=n.getIndicatorAxes();if(e.length){var i=t.get("shape"),r=t.getModel("splitLine"),o=t.getModel("splitArea"),a=r.getModel("lineStyle"),s=o.getModel("areaStyle"),l=r.get("show"),h=o.get("show"),c=a.get("color"),u=s.get("color");c=za.isArray(c)?c:[c],u=za.isArray(u)?u:[u];var d=[],p=[];if("circle"===i)for(var f=e[0].getTicksCoords(),g=n.cx,m=n.cy,v=0;v<f.length;v++){if(l)d[T(d,c,v)].push(new pf.Circle({shape:{cx:g,cy:m,r:f[v]}}));if(h&&v<f.length-1)p[T(p,u,v)].push(new pf.Ring({shape:{cx:g,cy:m,r0:f[v],r:f[v+1]}}))}else{var y,_=za.map(e,function(t,e){var i=t.getTicksCoords();return y=null==y?i.length-1:Math.min(i.length-1,y),za.map(i,function(t){return n.coordToPoint(t,e)})}),x=[];for(v=0;v<=y;v++){for(var w=[],b=0;b<e.length;b++)w.push(_[b][v]);if(w[0]&&w.push(w[0].slice()),l)d[T(d,c,v)].push(new pf.Polyline({shape:{points:w}}));if(h&&x)p[T(p,u,v-1)].push(new pf.Polygon({shape:{points:w.concat(x)}}));x=w.slice().reverse()}}var M=a.getLineStyle(),S=s.getAreaStyle();za.each(p,function(t,e){this.group.add(pf.mergePath(t,{style:za.defaults({stroke:"none",fill:u[e%u.length]},S),silent:!0}))},this),za.each(d,function(t,e){this.group.add(pf.mergePath(t,{style:za.defaults({fill:"none",stroke:c[e%c.length]},M),silent:!0}))},this)}function T(t,e,i){var n=i%e.length;return t[n]=t[n]||[],n}}}),Yc.encodeHTML),gw=Qg.extend({type:"series.radar",dependencies:["radar"],init:function(t){gw.superApply(this,"init",arguments),this.legendDataProvider=function(){return this.getRawData()}},getInitialData:function(t,e){var i=t.data||[],n=Gm([],i,{extraPrefix:"indicator_",extraFromZero:!0}),r=new Im(n,this);return r.initData(i),r},formatTooltip:function(t){var i=this.getRawValue(t),e=this.coordinateSystem.getIndicatorAxes(),n=this.getData().getName(t);return fw(""===n?this.name:n)+"<br/>"+za.map(e,function(t,e){return fw(t.name+" : "+i[e])}).join("<br />")},defaultOption:{zlevel:0,z:2,coordinateSystem:"radar",legendHoverLink:!0,radarIndex:0,lineStyle:{normal:{width:2,type:"solid"}},label:{normal:{position:"top"}},symbol:"emptyCircle",symbolSize:4}});fy.extendChartView({type:"radar",render:function(l,t,e){var i=l.coordinateSystem,v=this.group,y=l.getData(),s=this._data;function h(t,e){var i=t.getItemVisual(e,"symbol")||"circle",n=t.getItemVisual(e,"color");if("none"!==i){var r,o=(r=t.getItemVisual(e,"symbolSize"),za.isArray(r)||(r=[+r,+r]),r),a=Bv.createSymbol(i,-1,-1,2,2,n);return a.attr({style:{strokeNoScale:!0},z2:100,scale:[o[0]/2,o[1]/2]}),a}}function c(t,e,i,n,r,o){i.removeAll();for(var a=0;a<e.length-1;a++){var s=h(n,r);s&&(t[s.__dimIdx=a]?(s.attr("position",t[a]),pf[o?"initProps":"updateProps"](s,{position:e[a]},l,r)):s.attr("position",e[a]),i.add(s))}}function u(t){return za.map(t,function(t){return[i.cx,i.cy]})}y.diff(s).add(function(t){var e=y.getItemLayout(t);if(e){var i=new pf.Polygon,n=new pf.Polyline,r={shape:{points:e}};i.shape.points=u(e),n.shape.points=u(e),pf.initProps(i,r,l,t),pf.initProps(n,r,l,t);var o=new pf.Group,a=new pf.Group;o.add(n),o.add(i),o.add(a),c(n.shape.points,e,a,y,t,!0),y.setItemGraphicEl(t,o)}}).update(function(t,e){var i=s.getItemGraphicEl(e),n=i.childAt(0),r=i.childAt(1),o=i.childAt(2),a={shape:{points:y.getItemLayout(t)}};a.shape.points&&(c(n.shape.points,a.shape.points,o,y,t,!1),pf.updateProps(n,a,l),pf.updateProps(r,a,l),y.setItemGraphicEl(t,i))}).remove(function(t){v.remove(s.getItemGraphicEl(t))}).execute(),y.eachItemGraphicEl(function(t,e){var i=y.getItemModel(e),n=t.childAt(0),r=t.childAt(1),o=t.childAt(2),a=y.getItemVisual(e,"color");v.add(t),n.useStyle(za.defaults(i.getModel("lineStyle.normal").getLineStyle(),{fill:"none",stroke:a})),n.hoverStyle=i.getModel("lineStyle.emphasis").getLineStyle();var s=i.getModel("areaStyle.normal"),l=i.getModel("areaStyle.emphasis"),h=s.isEmpty()&&s.parentModel.isEmpty(),c=l.isEmpty()&&l.parentModel.isEmpty();c=c&&h,r.ignore=h,r.useStyle(za.defaults(s.getAreaStyle(),{fill:a,opacity:.7})),r.hoverStyle=l.getAreaStyle();var u=i.getModel("itemStyle.normal").getItemStyle(["color"]),d=i.getModel("itemStyle.emphasis").getItemStyle(),p=i.getModel("label.normal"),f=i.getModel("label.emphasis");function g(){r.attr("ignore",c)}function m(){r.attr("ignore",h)}o.eachChild(function(t){t.setStyle(u),t.hoverStyle=za.clone(d),pf.setLabelStyle(t.style,t.hoverStyle,p,f,{labelFetcher:y.hostModel,labelDataIndex:e,labelDimIndex:t.__dimIdx,defaultText:y.get(y.dimensions[t.__dimIdx],e),autoColor:a,isRectText:!0})}),t.off("mouseover").off("mouseout").off("normal").off("emphasis"),t.on("emphasis",g).on("mouseover",g).on("normal",m).on("mouseout",m),pf.setHoverStyle(t)}),this._data=y},remove:function(){this.group.removeAll(),this._data=null},dispose:function(){}});var mw=function(t){t.eachSeriesByType("radar",function(t){var e=t.getData(),i=[],n=t.coordinateSystem;if(n){for(var r=0;r<n.getIndicatorAxes().length;r++){var o=e.dimensions[r];e.each(o,a)}e.each(function(t){i[t][0]&&i[t].push(i[t][0].slice()),e.setItemLayout(t,i[t])})}function a(t,e){i[e]=i[e]||[],i[e][r]=n.dataToPoint(t,r)}})};var vw=function(i){var t=i.polar;if(t){za.isArray(t)||(t=[t]);var n=[];za.each(t,function(t,e){t.indicator?(t.type&&!t.shape&&(t.shape=t.type),i.radar=i.radar||[],za.isArray(i.radar)||(i.radar=[i.radar]),i.radar.push(t)):n.push(t)}),i.polar=n}za.each(i.series,function(t){t&&"radar"===t.type&&t.polarIndex&&(t.radarIndex=t.polarIndex)})};fy.registerVisual(za.curry(Zx,"radar")),fy.registerVisual(za.curry(e_,"radar","circle",null)),fy.registerLayout(mw),fy.registerProcessor(za.curry(tw,"radar")),fy.registerPreprocessor(vw);var yw=Ha.applyTransform;function _w(){hs.call(this)}function xw(t){this.name=t,this.zoomLimit,hs.call(this),this._roamTransform=new _w,this._viewTransform=new _w,this._center,this._zoom}function ww(t,e,i,n){var r=i.seriesModel,o=r?r.coordinateSystem:null;return o===this?o[t](n):null}za.mixin(_w,hs),xw.prototype={constructor:xw,type:"view",dimensions:["x","y"],setBoundingRect:function(t,e,i,n){return this._rect=new bl(t,e,i,n),this._rect},getBoundingRect:function(){return this._rect},setViewRect:function(t,e,i,n){this.transformTo(t,e,i,n),this._viewRect=new bl(t,e,i,n)},transformTo:function(t,e,i,n){var r=this.getBoundingRect(),o=this._viewTransform;o.transform=r.calculateTransform(new bl(t,e,i,n)),o.decomposeTransform(),this._updateTransform()},setCenter:function(t){t&&(this._center=t,this._updateCenterAndZoom())},setZoom:function(t){t=t||1;var e=this.zoomLimit;e&&(null!=e.max&&(t=Math.min(e.max,t)),null!=e.min&&(t=Math.max(e.min,t))),this._zoom=t,this._updateCenterAndZoom()},getDefaultCenter:function(){var t=this.getBoundingRect();return[t.x+t.width/2,t.y+t.height/2]},getCenter:function(){return this._center||this.getDefaultCenter()},getZoom:function(){return this._zoom||1},getRoamTransform:function(){return this._roamTransform},_updateCenterAndZoom:function(){var t=this._viewTransform.getLocalTransform(),e=this._roamTransform,i=this.getDefaultCenter(),n=this.getCenter(),r=this.getZoom();n=Ha.applyTransform([],n,t),i=Ha.applyTransform([],i,t),e.origin=n,e.position=[i[0]-n[0],i[1]-n[1]],e.scale=[r,r],this._updateTransform()},_updateTransform:function(){var t=this._roamTransform,e=this._viewTransform;(e.parent=t).updateTransform(),e.updateTransform(),e.transform&&ns.copy(this.transform||(this.transform=[]),e.transform),this.transform?(this.invTransform=this.invTransform||[],ns.invert(this.invTransform,this.transform)):this.invTransform=null,this.decomposeTransform()},getViewRect:function(){return this._viewRect},getViewRectAfterRoam:function(){var t=this.getBoundingRect().clone();return t.applyTransform(this.transform),t},dataToPoint:function(t){var e=this.transform;return e?yw([],t,e):[t[0],t[1]]},pointToData:function(t){var e=this.invTransform;return e?yw([],t,e):[t[0],t[1]]},convertToPixel:za.curry(ww,"dataToPoint"),convertFromPixel:za.curry(ww,"pointToData"),containPoint:function(t){return this.getViewRectAfterRoam().contain(t[0],t[1])}},za.mixin(xw,hs);for(var bw=xw,Mw=[126,25],Sw=[[[0,3.5],[7,11.2],[15,11.9],[30,7],[42,.7],[52,.7],[56,7.7],[59,.7],[64,.7],[64,0],[5,0],[0,3.5]],[[13,16.1],[19,14.7],[16,21.7],[11,23.1],[13,16.1]],[[12,32.2],[14,38.5],[15,38.5],[13,32.2],[12,32.2]],[[16,47.6],[12,53.2],[13,53.2],[18,47.6],[16,47.6]],[[6,64.4],[8,70],[9,70],[8,64.4],[6,64.4]],[[23,82.6],[29,79.8],[30,79.8],[25,82.6],[23,82.6]],[[37,70.7],[43,62.3],[44,62.3],[39,70.7],[37,70.7]],[[48,51.1],[51,45.5],[53,45.5],[50,51.1],[48,51.1]],[[51,35],[51,28.7],[53,28.7],[53,35],[51,35]],[[52,22.4],[55,17.5],[56,17.5],[53,22.4],[52,22.4]],[[58,12.6],[62,7],[63,7],[60,12.6],[58,12.6]],[[0,3.5],[0,93.1],[64,93.1],[64,0],[63,0],[63,92.4],[1,92.4],[1,3.5],[0,3.5]]],Tw=0;Tw<Sw.length;Tw++)for(var Cw=0;Cw<Sw[Tw].length;Cw++)Sw[Tw][Cw][0]/=10.5,Sw[Tw][Cw][1]/=-14,Sw[Tw][Cw][0]+=Mw[0],Sw[Tw][Cw][1]+=Mw[1];var Aw={"\u5357\u6d77\u8bf8\u5c9b":[32,80],"\u5e7f\u4e1c":[0,-10],"\u9999\u6e2f":[10,5],"\u6fb3\u95e8":[-10,10],"\u5929\u6d25":[5,5]};var Ew={Russia:[100,60],"United States":[-99,38],"United States of America":[-99,38]};var Pw=[[[123.45165252685547,25.73527164402261],[123.49731445312499,25.73527164402261],[123.49731445312499,25.750734064600884],[123.45165252685547,25.750734064600884],[123.45165252685547,25.73527164402261]]];var Lw=[function(t){"china"===t.map&&t.regions.push(new Yv("\u5357\u6d77\u8bf8\u5c9b",za.map(Sw,function(t){return{type:"polygon",exterior:t}}),Mw))},function(t){za.each(t.regions,function(t){var e=Aw[t.name];if(e){var i=t.center;i[0]+=e[0]/10.5,i[1]+=-e[1]/14}})},function(t){za.each(t.regions,function(t){var e=Ew[t.name];if(e){var i=t.center;i[0]=e[0],i[1]=e[1]}})},function(t){if("china"===t.map)for(var e=0,i=t.regions.length;e<i;++e)"\u53f0\u6e7e"===t.regions[e].name&&t.regions[e].geometries.push({type:"polygon",exterior:Pw[0]})}];function Iw(t,e,i,n,r){bw.call(this,t),this.map=e,this._nameCoordMap=za.createHashMap(),this.loadGeoJson(i,n,r)}function Rw(t,e,i,n){var r=i.geoModel,o=i.seriesModel,a=r?r.coordinateSystem:o?o.coordinateSystem||(o.getReferringComponents("geo")[0]||{}).coordinateSystem:null;return a===this?a[t](n):null}Iw.prototype={constructor:Iw,type:"geo",dimensions:["lng","lat"],containCoord:function(t){for(var e=this.regions,i=0;i<e.length;i++)if(e[i].contain(t))return!0;return!1},loadGeoJson:function(t,e,i){try{this.regions=t?Kv(t):[]}catch(t){throw"Invalid geoJson format\n"+t.message}e=e||{},i=i||{};for(var n=this.regions,r=za.createHashMap(),o=0;o<n.length;o++){var a=n[o].name;a=i.hasOwnProperty(a)?i[a]:a,n[o].name=a,r.set(a,n[o]),this.addGeoCoord(a,n[o].center);var s=e[a];s&&n[o].transformTo(s.left,s.top,s.width,s.height)}this._regionsMap=r,this._rect=null,za.each(Lw,function(t){t(this)},this)},transformTo:function(t,e,i,n){var r=this.getBoundingRect();(r=r.clone()).y=-r.y-r.height;var o=this._viewTransform;o.transform=r.calculateTransform(new bl(t,e,i,n)),o.decomposeTransform();var a=o.scale;a[1]=-a[1],o.updateTransform(),this._updateTransform()},getRegion:function(t){return this._regionsMap.get(t)},getRegionByCoord:function(t){for(var e=this.regions,i=0;i<e.length;i++)if(e[i].contain(t))return e[i]},addGeoCoord:function(t,e){this._nameCoordMap.set(t,e)},getGeoCoord:function(t){return this._nameCoordMap.get(t)},getBoundingRect:function(){if(this._rect)return this._rect;for(var t,e=this.regions,i=0;i<e.length;i++){var n=e[i].getBoundingRect();(t=t||n.clone()).union(n)}return this._rect=t||new bl(0,0,0,0)},dataToPoint:function(t){if("string"==typeof t&&(t=this.getGeoCoord(t)),t)return bw.prototype.dataToPoint.call(this,t)},convertToPixel:za.curry(Rw,"dataToPoint"),convertFromPixel:za.curry(Rw,"pointToData")},za.mixin(Iw,bw);var Dw=Iw;function Ow(t,e){var i=t.get("boundingCoords");if(null!=i){var n=i[0],r=i[1];isNaN(n[0])||isNaN(n[1])||isNaN(r[0])||isNaN(r[1])||this.setBoundingRect(n[0],n[1],r[0]-n[0],r[1]-n[1])}var o,a=this.getBoundingRect(),s=t.get("layoutCenter"),l=t.get("layoutSize"),h=e.getWidth(),c=e.getHeight(),u=t.get("aspectScale")||.75,d=a.width/a.height*u,p=!1;if(s&&l&&(s=[Uc.parsePercent(s[0],h),Uc.parsePercent(s[1],c)],l=Uc.parsePercent(l,Math.min(h,c)),isNaN(s[0])||isNaN(s[1])||isNaN(l)||(p=!0)),p){var f={};1<d?(f.width=l,f.height=l/d):(f.height=l,f.width=l*d),f.y=s[1]-f.height/2,f.x=s[0]-f.width/2}else(o=t.getBoxLayoutParams()).aspect=d,f=jf.getLayoutRect(o,{width:h,height:c});this.setViewRect(f.x,f.y,f.width,f.height),this.setCenter(t.get("center")),this.setZoom(t.get("zoom"))}function kw(i,t){za.each(t.get("geoCoord"),function(t,e){i.addGeoCoord(e,t)})}var zw={dimensions:Dw.prototype.dimensions,create:function(t,o){var a=[];t.eachComponent("geo",function(t,e){var i=t.get("map"),n=fy.getMap(i),r=new Dw(i+e,i,n&&n.geoJson,n&&n.specialAreas,t.get("nameMap"));r.zoomLimit=t.get("scaleLimit"),a.push(r),kw(r,t),(t.coordinateSystem=r).model=t,r.resize=Ow,r.resize(t,o)}),t.eachSeries(function(t){if("geo"===t.get("coordinateSystem")){var e=t.get("geoIndex")||0;t.coordinateSystem=a[e]}});var i={};return t.eachSeriesByType("map",function(t){if(!t.getHostGeoModel()){var e=t.getMapType();i[e]=i[e]||[],i[e].push(t)}}),za.each(i,function(t,e){var i=fy.getMap(e),n=za.map(t,function(t){return t.get("nameMap")}),r=new Dw(e,e,i&&i.geoJson,i&&i.specialAreas,za.mergeAll(n));r.zoomLimit=za.retrieve.apply(null,za.map(t,function(t){return t.get("scaleLimit")})),a.push(r),r.resize=Ow,r.resize(t[0],o),za.each(t,function(t){kw(t.coordinateSystem=r,t)})}),a},getFilledRegions:function(t,e,i){var n=(t||[]).slice();i=i||{};var r=fy.getMap(e),o=r&&r.geoJson;if(!o)return t;for(var a=za.createHashMap(),s=o.features,l=0;l<n.length;l++)a.set(n[l].name,n[l]);for(l=0;l<s.length;l++){var h=s[l].properties.name;a.get(h)||(i.hasOwnProperty(h)&&(h=i[h]),n.push({name:h}))}return n}};fy.registerCoordinateSystem("geo",zw);var Nw=zw,Bw=Yc.encodeHTML,Fw=Yc.addCommas,Gw=Qg.extend({type:"series.map",dependencies:["geo"],layoutMode:"box",needsDrawMap:!1,seriesGroup:[],init:function(t){this._fillOption(t,this.getMapType()),Gw.superApply(this,"init",arguments),this.updateSelectedMap(t.data)},getInitialData:function(t){var e=Gm(["value"],t.data||[]),i=new Im(e,this);return i.initData(t.data),i},mergeOption:function(t){this._fillOption(t,this.getMapType()),Gw.superApply(this,"mergeOption",arguments),this.updateSelectedMap(this.option.data)},getHostGeoModel:function(){var t=this.option.geoIndex;return null!=t?this.dependentModels.geo[t]:null},getMapType:function(){return(this.getHostGeoModel()||this).option.map},_fillOption:function(t,e){t.data=Nw.getFilledRegions(t.data,e,t.nameMap)},getRawValue:function(t){return this.getData().get("value",t)},getRegionModel:function(t){var e=this.getData();return e.getItemModel(e.indexOfName(t))},formatTooltip:function(t){for(var e=this.getData(),i=Fw(this.getRawValue(t)),n=e.getName(t),r=this.seriesGroup,o=[],a=0;a<r.length;a++){var s=r[a].originalData.indexOfName(n);isNaN(r[a].originalData.get("value",s))||o.push(Bw(r[a].name))}return o.join(", ")+"<br />"+Bw(n+" : "+i)},getTooltipPosition:function(t){if(null!=t){var e=this.getData().getName(t),i=this.coordinateSystem,n=i.getRegion(e);return n&&i.dataToPoint(n.center)}},setZoom:function(t){this.option.zoom=t},setCenter:function(t){this.option.center=t},defaultOption:{zlevel:0,z:2,coordinateSystem:"geo",map:"",left:"center",top:"center",aspectScale:.75,showLegendSymbol:!0,dataRangeHoverLink:!0,boundingCoords:null,center:null,zoom:1,scaleLimit:null,label:{normal:{show:!1,color:"#000"},emphasis:{show:!0,color:"rgb(100,0,0)"}},itemStyle:{normal:{borderWidth:.5,borderColor:"#444",areaColor:"#eee"},emphasis:{areaColor:"rgba(255,215,0,0.8)"}}}});za.mixin(Gw,Bx);var Vw="\0_ec_interaction_mutex";function Hw(t){return t[Vw]||(t[Vw]={})}fy.registerAction({type:"takeGlobalCursor",event:"globalCursorTaken",update:"update"},function(){});var Uw={take:function(t,e,i){Hw(t)[e]=i},release:function(t,e,i){var n=Hw(t);n[e]===i&&(n[e]=null)},isTaken:function(t,e){return!!Hw(t)[e]}};function Ww(i){this.pointerChecker,this._zr=i,this._opt={};var t=za.bind,n=t(jw,this),r=t(Zw,this),o=t(Xw,this),a=t(qw,this),s=t(Yw,this);qa.call(this),this.setPointerChecker=function(t){this.pointerChecker=t},this.enable=function(t,e){this.disable(),this._opt=za.defaults(za.clone(e)||{},{zoomOnMouseWheel:!0,moveOnMouseMove:!0,preventDefaultMouseMove:!0}),null==t&&(t=!0),!0!==t&&"move"!==t&&"pan"!==t||(i.on("mousedown",n),i.on("mousemove",r),i.on("mouseup",o)),!0!==t&&"scale"!==t&&"zoom"!==t||(i.on("mousewheel",a),i.on("pinch",s))},this.disable=function(){i.off("mousedown",n),i.off("mousemove",r),i.off("mouseup",o),i.off("mousewheel",a),i.off("pinch",s)},this.dispose=this.disable,this.isDragging=function(){return this._dragging},this.isPinching=function(){return this._pinching}}function jw(t){if(!(pc.notLeftMouse(t)||t.target&&t.target.draggable)){var e=t.offsetX,i=t.offsetY;this.pointerChecker&&this.pointerChecker(t,e,i)&&(this._x=e,this._y=i,this._dragging=!0)}}function Zw(t){if(!pc.notLeftMouse(t)&&Kw(this,"moveOnMouseMove",t)&&this._dragging&&"pinch"!==t.gestureEvent&&!Uw.isTaken(this._zr,"globalPan")){var e=t.offsetX,i=t.offsetY,n=this._x,r=this._y,o=e-n,a=i-r;this._x=e,this._y=i,this._opt.preventDefaultMouseMove&&pc.stop(t.event),this.trigger("pan",o,a,n,r,e,i)}}function Xw(t){pc.notLeftMouse(t)||(this._dragging=!1)}function qw(t){if(Kw(this,"zoomOnMouseWheel",t)&&0!==t.wheelDelta){var e=0<t.wheelDelta?1.1:1/1.1;Jw.call(this,t,e,t.offsetX,t.offsetY)}}function Yw(t){if(!Uw.isTaken(this._zr,"globalPan")){var e=1<t.pinchScale?1.1:1/1.1;Jw.call(this,t,e,t.pinchX,t.pinchY)}}function Jw(t,e,i,n){this.pointerChecker&&this.pointerChecker(t,i,n)&&(pc.stop(t.event),this.trigger("zoom",e,i,n))}function Kw(t,e,i){var n=t._opt[e];return n&&(!za.isString(n)||i.event[n+"Key"])}za.mixin(Ww,qa);var Qw=Ww;var $w={updateViewOnPan:function(t,e,i){var n=t.target,r=n.position;r[0]+=e,r[1]+=i,n.dirty()},updateViewOnZoom:function(t,e,i,n){var r=t.target,o=t.zoomLimit,a=r.position,s=r.scale,l=t.zoom=t.zoom||1;if(l*=e,o){var h=o.min||0,c=o.max||1/0;l=Math.max(Math.min(c,l),h)}var u=l/t.zoom;t.zoom=l,a[0]-=(i-a[0])*(u-1),a[1]-=(n-a[1])*(u-1),s[0]*=u,s[1]*=u,r.dirty()}},tb={axisPointer:1,tooltip:1,brush:1};var eb={onIrrelevantElement:function(t,e,i){var n=e.getComponentByElement(t.topTarget),r=n&&n.coordinateSystem;return n&&n!==i&&!tb[n.mainType]&&r&&r.model!==i}},ib=eb.onIrrelevantElement;function nb(t,e){var i=t.getItemStyle(),n=t.get("areaColor");return null!=n&&(i.fill=n),i}function rb(i,t){t.eachChild(function(e){za.each(e.__regions,function(t){e.trigger(i.isSelected(t.name)?"emphasis":"normal")})})}function ob(t,e){var i=new pf.Group;this._controller=new Qw(t.getZr()),this._controllerHost={target:e?i:null},this.group=i,this._updateGroup=e,this._mouseDownFlag}ob.prototype={constructor:ob,draw:function(_,t,e,i,n){var x="geo"===_.mainType,w=_.getData&&_.getData();x&&t.eachComponent({mainType:"series",subType:"map"},function(t){w||t.getHostGeoModel()!==_||(w=t.getData())});var r=_.coordinateSystem,b=this.group,M=r.scale,o={position:r.position,scale:M};!b.childAt(0)||n?b.attr(o):pf.updateProps(b,o,_),b.removeAll();var a,s,l,h,c,S=["itemStyle","normal"],T=["itemStyle","emphasis"],C=["label","normal"],A=["label","emphasis"],E=za.createHashMap();za.each(r.regions,function(t){var e=E.get(t.name)||E.set(t.name,new pf.Group),i=new pf.CompoundPath({shape:{paths:[]}});e.add(i);var n,r=(y=_.getRegionModel(t.name)||_).getModel(S),o=y.getModel(T),a=nb(r),s=nb(o),l=y.getModel(C),h=y.getModel(A);if(w){n=w.indexOfName(t.name);var c=w.getItemVisual(n,"color",!0);c&&(a.fill=c)}za.each(t.geometries,function(t){if("polygon"===t.type){i.shape.paths.push(new pf.Polygon({shape:{points:t.exterior}}));for(var e=0;e<(t.interiors?t.interiors.length:0);e++)i.shape.paths.push(new pf.Polygon({shape:{points:t.interiors[e]}}))}}),i.setStyle(a),i.style.strokeNoScale=!0,i.culling=!0;var u=l.get("show"),d=h.get("show"),p=w&&isNaN(w.get("value",n)),f=w&&w.getItemLayout(n);if(x||p&&(u||d)||f&&f.showLabel){var g,m=x?t.name:n;(!w||0<=n)&&(g=_);var v=new pf.Text({position:t.center.slice(),scale:[1/M[0],1/M[1]],z2:10,silent:!0});pf.setLabelStyle(v.style,v.hoverStyle={},l,h,{labelFetcher:g,labelDataIndex:m,defaultText:t.name,useInsideStyle:!1},{textAlign:"center",textVerticalAlign:"middle"}),e.add(v)}if(w)w.setItemGraphicEl(n,e);else{var y=_.getRegionModel(t.name);i.eventData={componentType:"geo",geoIndex:_.componentIndex,name:t.name,region:y&&y.option||{}}}(e.__regions||(e.__regions=[])).push(t),pf.setHoverStyle(e,s,{hoverSilentOnTouch:!!_.get("selectedMode")}),b.add(e)}),this._updateController(_,t,e),a=this,s=_,h=e,c=i,(l=b).off("click"),l.off("mousedown"),s.get("selectedMode")&&(l.on("mousedown",function(){a._mouseDownFlag=!0}),l.on("click",function(t){if(a._mouseDownFlag){a._mouseDownFlag=!1;for(var e=t.target;!e.__regions;)e=e.parent;if(e){var i={type:("geo"===s.mainType?"geo":"map")+"ToggleSelect",batch:za.map(e.__regions,function(t){return{name:t.name,from:c.uid}})};i[s.mainType+"Id"]=s.id,h.dispatchAction(i),rb(s,l)}}})),rb(_,b)},remove:function(){this.group.removeAll(),this._controller.dispose(),this._controllerHost={}},_updateController:function(n,t,o){var r=n.coordinateSystem,e=this._controller,a=this._controllerHost;a.zoomLimit=n.get("scaleLimit"),a.zoom=r.getZoom(),e.enable(n.get("roam")||!1);var i=n.mainType;function s(){var t={type:"geoRoam",componentType:i};return t[i+"Id"]=n.id,t}e.off("pan").on("pan",function(t,e){this._mouseDownFlag=!1,$w.updateViewOnPan(a,t,e),o.dispatchAction(za.extend(s(),{dx:t,dy:e}))},this),e.off("zoom").on("zoom",function(t,e,i){if(this._mouseDownFlag=!1,$w.updateViewOnZoom(a,t,e,i),o.dispatchAction(za.extend(s(),{zoom:t,originX:e,originY:i})),this._updateGroup){var n=this.group,r=n.scale;n.traverse(function(t){"text"===t.type&&t.attr("scale",[1/r[0],1/r[1]])})}},this),e.setPointerChecker(function(t,e,i){return r.getViewRectAfterRoam().contain(e,i)&&!ib(t,o,n)})}};var ab=ob;fy.extendChartView({type:"map",render:function(t,e,i,n){if(!n||"mapToggleSelect"!==n.type||n.from!==this.uid){var r=this.group;if(r.removeAll(),!t.getHostGeoModel()){if(n&&"geoRoam"===n.type&&"series"===n.componentType&&n.seriesId===t.id)(o=this._mapDraw)&&r.add(o.group);else if(t.needsDrawMap){var o=this._mapDraw||new ab(i,!0);r.add(o.group),o.draw(t,e,i,this,n),this._mapDraw=o}else this._mapDraw&&this._mapDraw.remove(),this._mapDraw=null;t.get("showLegendSymbol")&&e.getComponent("legend")&&this._renderSymbols(t,e,i)}}},remove:function(){this._mapDraw&&this._mapDraw.remove(),this._mapDraw=null,this.group.removeAll()},dispose:function(){this._mapDraw&&this._mapDraw.remove(),this._mapDraw=null},_renderSymbols:function(v,t,e){var y=v.originalData,_=this.group;y.each("value",function(t,e){if(!isNaN(t)){var i=y.getItemLayout(e);if(i&&i.point){var n=i.point,r=i.offset,o=new pf.Circle({style:{fill:v.getData().getVisual("color")},shape:{cx:n[0]+9*r,cy:n[1],r:3},silent:!0,z2:r?8:10});if(!r){var a=v.mainSeries.getData(),s=y.getName(e),l=a.indexOfName(s),h=y.getItemModel(e),c=h.getModel("label.normal"),u=h.getModel("label.emphasis"),d=a.getItemGraphicEl(l),p=za.retrieve2(v.getFormattedLabel(e,"normal"),s),f=za.retrieve2(v.getFormattedLabel(e,"emphasis"),p),g=function(){var t=pf.setTextStyle({},u,{text:u.get("show")?f:null},{isRectText:!0,useInsideStyle:!1},!0);o.style.extendFrom(t),o.__mapOriginalZ2=o.z2,o.z2+=1},m=function(){pf.setTextStyle(o.style,c,{text:c.get("show")?p:null,textPosition:c.getShallow("position")||"bottom"},{isRectText:!0,useInsideStyle:!1}),null!=o.__mapOriginalZ2&&(o.z2=o.__mapOriginalZ2,o.__mapOriginalZ2=null)};d.on("mouseover",g).on("mouseout",m).on("emphasis",g).on("normal",m),m()}_.add(o)}}})}});var sb={updateCenterAndZoom:function(t,e,i){var n=t.getZoom(),r=t.getCenter(),o=e.zoom,a=t.dataToPoint(r);null!=e.dx&&null!=e.dy&&(a[0]-=e.dx,a[1]-=e.dy,r=t.pointToData(a),t.setCenter(r));if(null!=o){if(i){var s=i.min||0,l=i.max||1/0;o=Math.max(Math.min(n*o,l),s)/n}t.scale[0]*=o,t.scale[1]*=o;var h=t.position,c=(e.originX-h[0])*(o-1),u=(e.originY-h[1])*(o-1);h[0]-=c,h[1]-=u,t.updateTransform(),r=t.pointToData(a),t.setCenter(r),t.setZoom(o*n)}return{center:t.getCenter(),zoom:t.getZoom()}}},lb=sb.updateCenterAndZoom;fy.registerAction({type:"geoRoam",event:"geoRoam",update:"updateLayout"},function(n,t){var r=n.componentType||"series";t.eachComponent({mainType:r,query:n},function(t){var e=t.coordinateSystem;if("geo"===e.type){var i=lb(e,n,t.get("scaleLimit"));t.setCenter&&t.setCenter(i.center),t.setZoom&&t.setZoom(i.zoom),"series"===r&&za.each(t.seriesGroup,function(t){t.setCenter(i.center),t.setZoom(i.zoom)})}})});var hb=function(i){var r={};i.eachSeriesByType("map",function(t){var e=t.getMapType();if(!t.getHostGeoModel()&&!r[e]){var l={};za.each(t.seriesGroup,function(t){var a=t.coordinateSystem,s=t.originalData;t.get("showLegendSymbol")&&i.getComponent("legend")&&s.each("value",function(t,e){var i=s.getName(e),n=a.getRegion(i);if(n&&!isNaN(t)){var r=l[i]||0,o=a.dataToPoint(n.center);l[i]=r+1,s.setItemLayout(e,{point:o,offset:r})}})});var n=t.getData();n.each(function(t){var e=n.getName(t),i=n.getItemLayout(t)||{};i.showLabel=!l[e],n.setItemLayout(t,i)}),r[e]=!0}})};var cb=function(t){t.eachSeriesByType("map",function(t){var e=t.get("color"),i=t.getModel("itemStyle.normal"),n=i.get("areaColor"),r=i.get("color")||e[t.seriesIndex%e.length];t.getData().setVisual({areaColor:n,color:r})})};var ub=function(t){var n={};t.eachSeriesByType("map",function(t){var e=t.getHostGeoModel(),i=e?"o"+e.id:"i"+t.getMapType();(n[i]=n[i]||[]).push(t)}),za.each(n,function(t,e){for(var h,c,u,i,n=(h=za.map(t,function(t){return t.getData()}),c=t[0].get("mapValueCalculation"),u={},i=["value"],za.each(h,function(n){n.each(i,function(t,e){var i="ec-"+n.getName(e);u[i]=u[i]||[],isNaN(t)||u[i].push(t)})}),h[0].map(i,function(t,e){for(var i,n="ec-"+h[0].getName(e),r=0,o=1/0,a=-1/0,s=u[n].length,l=0;l<s;l++)o=Math.min(o,u[n][l]),a=Math.max(a,u[n][l]),r+=u[n][l];return i="min"===c?o:"max"===c?a:"average"===c?r/s:r,0===s?NaN:i})),r=0;r<t.length;r++)t[r].originalData=t[r].getData();for(r=0;r<t.length;r++)(t[r].seriesGroup=t)[r].needsDrawMap=0===r&&!t[r].getHostGeoModel(),t[r].setData(n.cloneShallow()),t[r].mainSeries=t[0]})};var db=function(t){var e=[];za.each(t.series,function(t){t&&"map"===t.type&&(e.push(t),t.map=t.map||t.mapType,za.defaults(t,t.mapLocation))})};fy.registerLayout(hb),fy.registerVisual(cb),fy.registerProcessor(fy.PRIORITY.PROCESSOR.STATISTIC,ub),fy.registerPreprocessor(db),jx("map",[{type:"mapToggleSelect",event:"mapselectchanged",method:"toggleSelected"},{type:"mapSelect",event:"mapselected",method:"select"},{type:"mapUnSelect",event:"mapunselected",method:"unSelect"}]);var pb=za.each,fb="\0__link_datas",gb="\0__link_mainData";function mb(t,e){if((n=this)[gb]===n){var i=za.extend({},this[fb]);xb(i[this.dataType]=e,i,t)}else wb(e,this.dataType,this[gb],t);var n;return e}function vb(t,e){return t.struct&&t.struct.update(this),e}function yb(i,n){return pb(n[fb],function(t,e){t!==n&&wb(t.cloneShallow(),e,n,i)}),n}function _b(t){var e=this[gb];return null==t||null==e?e:e[fb][t]}function xb(i,t,n){i[fb]={},pb(t,function(t,e){wb(t,e,i,n)})}function wb(t,e,i,n){(i[fb][e]=t)[gb]=i,t.dataType=e,n.struct&&(t[n.structAttr]=n.struct,n.struct[n.datasAttr[e]]=t),t.getLinkedData=_b}var bb=function(i){var n=i.mainData,t=i.datas;t||(t={main:n},i.datasAttr={main:"data"}),i.datas=i.mainData=null,xb(n,t,i),pb(t,function(e){pb(n.TRANSFERABLE_METHODS,function(t){e.wrapMethod(t,za.curry(mb,i))})}),n.wrapMethod("cloneShallow",za.curry(yb,i)),pb(n.CHANGABLE_METHODS,function(t){n.wrapMethod(t,za.curry(vb,i))}),za.assert(t[n.dataType]===n)},Mb=function(t,e){this.name=t||"",this.depth=0,this.height=0,this.parentNode=null,this.dataIndex=-1,this.children=[],this.viewChildren=[],this.hostTree=e};function Sb(e,t,i){this.root,this.data,this._nodes=[],this.hostModel=e,this.levelModels=za.map(t||[],function(t){return new bf(t,e,e.ecModel)}),this.leavesModel=new bf(i||{},e,e.ecModel)}Mb.prototype={constructor:Mb,isRemoved:function(){return this.dataIndex<0},eachNode:function(t,e,i){"function"==typeof t&&(i=e,e=t,t=null),t=t||{},za.isString(t)&&(t={order:t});var n,r=t.order||"preorder",o=this[t.attr||"children"];"preorder"===r&&(n=e.call(i,this));for(var a=0;!n&&a<o.length;a++)o[a].eachNode(t,e,i);"postorder"===r&&e.call(i,this)},updateDepthAndHeight:function(t){var e=0;this.depth=t;for(var i=0;i<this.children.length;i++){var n=this.children[i];n.updateDepthAndHeight(t+1),n.height>e&&(e=n.height)}this.height=e+1},getNodeById:function(t){if(this.getId()===t)return this;for(var e=0,i=this.children,n=i.length;e<n;e++){var r=i[e].getNodeById(t);if(r)return r}},contains:function(t){if(t===this)return!0;for(var e=0,i=this.children,n=i.length;e<n;e++){var r=i[e].contains(t);if(r)return r}},getAncestors:function(t){for(var e=[],i=t?this:this.parentNode;i;)e.push(i),i=i.parentNode;return e.reverse(),e},getValue:function(t){var e=this.hostTree.data;return e.get(e.getDimension(t||"value"),this.dataIndex)},setLayout:function(t,e){0<=this.dataIndex&&this.hostTree.data.setItemLayout(this.dataIndex,t,e)},getLayout:function(){return this.hostTree.data.getItemLayout(this.dataIndex)},getModel:function(t){if(!(this.dataIndex<0)){var e,i=this.hostTree,n=i.data.getItemModel(this.dataIndex),r=this.getLevelModel();return r||0!==this.children.length&&(0===this.children.length||!1!==this.isExpand)||(e=this.getLeavesModel()),n.getModel(t,(r||e||i.hostModel).getModel(t))}},getLevelModel:function(){return(this.hostTree.levelModels||[])[this.depth]},getLeavesModel:function(){return this.hostTree.leavesModel},setVisual:function(t,e){0<=this.dataIndex&&this.hostTree.data.setItemVisual(this.dataIndex,t,e)},getVisual:function(t,e){return this.hostTree.data.getItemVisual(this.dataIndex,t,e)},getRawIndex:function(){return this.hostTree.data.getRawIndex(this.dataIndex)},getId:function(){return this.hostTree.data.getId(this.dataIndex)}},Sb.prototype={constructor:Sb,type:"tree",eachNode:function(t,e,i){this.root.eachNode(t,e,i)},getNodeByDataIndex:function(t){var e=this.data.getRawIndex(t);return this._nodes[e]},getNodeByName:function(t){return this.root.getNodeByName(t)},update:function(){for(var t=this.data,e=this._nodes,i=0,n=e.length;i<n;i++)e[i].dataIndex=-1;for(i=0,n=t.count();i<n;i++)e[t.getRawIndex(i)].dataIndex=i},clearLayouts:function(){this.data.clearItemLayouts()}},Sb.createTree=function(t,e,i){var s=new Sb(e,i.levels,i.leaves),l=[],h=1;!function t(e,i){var n=e.value;h=Math.max(h,za.isArray(n)?n.length:1);l.push(e);var r=new Mb(e.name,s);i?function(t,e){var i=e.children;if(t.parentNode===e)return;i.push(t),t.parentNode=e}(r,i):s.root=r;s._nodes.push(r);var o=e.children;if(o)for(var a=0;a<o.length;a++)t(o[a],r)}(t),s.root.updateDepthAndHeight(0);var n=Gm([{name:"value"}],l,{dimCount:h}),r=new Im(n,e);return r.initData(l),bb({mainData:r,struct:s,structAttr:"tree"}),s.update(),s};var Tb=Sb,Cb=Yc.encodeHTML;Qg.extend({type:"series.tree",layoutInfo:null,layoutMode:"box",getInitialData:function(t){var e={name:t.name,children:t.data},i=t.leaves||{},n={};n.leaves=i;var r=Tb.createTree(e,this,n),o=0;r.eachNode("preorder",function(t){t.depth>o&&(o=t.depth)});var a=t.expandAndCollapse&&0<=t.initialTreeDepth?t.initialTreeDepth:o;return r.root.eachNode("preorder",function(t){var e=t.hostTree.data.getRawDataItem(t.dataIndex);t.isExpand=e&&null!=e.collapsed?!e.collapsed:t.depth<=a}),r.data},formatTooltip:function(t){for(var e=this.getData().tree,i=e.root.children[0],n=e.getNodeByDataIndex(t),r=n.getValue(),o=n.name;n&&n!==i;)o=n.parentNode.name+"."+o,n=n.parentNode;return Cb(o+(isNaN(r)||null==r?"":" : "+r))},defaultOption:{zlevel:0,z:2,left:"12%",top:"12%",right:"12%",bottom:"12%",layout:"orthogonal",orient:"horizontal",symbol:"emptyCircle",symbolSize:7,expandAndCollapse:!0,initialTreeDepth:2,lineStyle:{normal:{color:"#ccc",width:1.5,curveness:.5}},itemStyle:{normal:{color:"lightsteelblue",borderColor:"#c23531",borderWidth:1.5}},label:{normal:{show:!0,color:"#555"}},leaves:{label:{normal:{show:!0}}},animationEasing:"linear",animationDuration:700,animationDurationUpdate:1e3}});function Ab(t){var e=t.children;return e.length&&t.isExpand?e[e.length-1]:t.hierNode.thread}function Eb(t){var e=t.children;return e.length&&t.isExpand?e[0]:t.hierNode.thread}function Pb(t,e){return t.parentNode===e.parentNode?1:2}var Lb={init:function(t){t.hierNode={defaultAncestor:null,ancestor:t,prelim:0,modifier:0,change:0,shift:0,i:0,thread:null};for(var e,i,n=[t];e=n.pop();)if(i=e.children,e.isExpand&&i.length)for(var r=i.length-1;0<=r;r--){var o=i[r];o.hierNode={defaultAncestor:null,ancestor:o,prelim:0,modifier:0,change:0,shift:0,i:r,thread:null},n.push(o)}},firstWalk:function(t,e){var i=t.isExpand?t.children:[],n=t.parentNode.children,r=t.hierNode.i?n[t.hierNode.i-1]:null;if(i.length){!function(t){for(var e=t.children,i=e.length,n=0,r=0;0<=--i;){var o=e[i];o.hierNode.prelim+=n,o.hierNode.modifier+=n,r+=o.hierNode.change,n+=o.hierNode.shift+r}}(t);var o=(i[0].hierNode.prelim+i[i.length-1].hierNode.prelim)/2;r?(t.hierNode.prelim=r.hierNode.prelim+e(t,r),t.hierNode.modifier=t.hierNode.prelim-o):t.hierNode.prelim=o}else r&&(t.hierNode.prelim=r.hierNode.prelim+e(t,r));t.parentNode.hierNode.defaultAncestor=function(t,e,i,n){if(e){for(var r=t,o=t,a=o.parentNode.children[0],s=e,l=r.hierNode.modifier,h=o.hierNode.modifier,c=a.hierNode.modifier,u=s.hierNode.modifier;s=Ab(s),o=Eb(o),s&&o;){r=Ab(r),a=Eb(a),r.hierNode.ancestor=t;var d=s.hierNode.prelim+u-o.hierNode.prelim-h+n(s,o);0<d&&(y=t,_=i,p=(v=s).hierNode.ancestor.parentNode===y.parentNode?v.hierNode.ancestor:_,void 0,m=(g=d)/((f=t).hierNode.i-p.hierNode.i),f.hierNode.change-=m,f.hierNode.shift+=g,f.hierNode.modifier+=g,f.hierNode.prelim+=g,p.hierNode.change+=m,h+=d,l+=d),u+=s.hierNode.modifier,h+=o.hierNode.modifier,l+=r.hierNode.modifier,c+=a.hierNode.modifier}s&&!Ab(r)&&(r.hierNode.thread=s,r.hierNode.modifier+=u-l),o&&!Eb(a)&&(a.hierNode.thread=o,a.hierNode.modifier+=h-c,i=t)}var p,f,g,m,v,y,_;return i}(t,r,t.parentNode.hierNode.defaultAncestor||n[0],e)},secondWalk:function(t){var e=t.hierNode.prelim+t.parentNode.hierNode.modifier;t.setLayout({x:e},!0),t.hierNode.modifier+=t.parentNode.hierNode.modifier},separation:function(t){return arguments.length?t:Pb},radialCoordinate:function(t,e){var i={};return t-=Math.PI/2,i.x=e*Math.cos(t),i.y=e*Math.sin(t),i},getViewRect:function(t,e){return jf.getLayoutRect(t.getBoxLayoutParams(),{width:e.getWidth(),height:e.getHeight()})}},Ib=Lb.radialCoordinate;fy.extendChartView({type:"tree",init:function(t,e){this._oldTree,this._mainGroup=new pf.Group,this.group.add(this._mainGroup)},render:function(n,t,i,e){var r=n.getData(),o=n.layoutInfo,a=this._mainGroup,s=n.get("layout");"radial"===s?a.attr("position",[o.x+o.width/2,o.y+o.height/2]):a.attr("position",[o.x,o.y]);var l=this._data,h={expandAndCollapse:n.get("expandAndCollapse"),layout:s,orient:n.get("orient"),curvature:n.get("lineStyle.normal.curveness"),symbolRotate:n.get("symbolRotate"),symbolOffset:n.get("symbolOffset"),hoverAnimation:n.get("hoverAnimation"),useNameLabel:!0,fadeIn:!0};r.diff(l).add(function(t){Rb(r,t)&&Ob(r,t,null,a,n,h)}).update(function(t,e){var i=l.getItemGraphicEl(e);Rb(r,t)?Ob(r,t,i,a,n,h):i&&kb(r,t,i,a,n,h)}).remove(function(t){var e=l.getItemGraphicEl(t);kb(r,t,e,a,n,h)}).execute(),!0===h.expandAndCollapse&&r.eachItemGraphicEl(function(t,e){t.off("click").on("click",function(){i.dispatchAction({type:"treeExpandAndCollapse",seriesId:n.id,dataIndex:e})})}),this._data=r},dispose:function(){},remove:function(){this._mainGroup.removeAll(),this._data=null}});function Rb(t,e){var i=t.getItemLayout(e);return i&&!isNaN(i.x)&&!isNaN(i.y)&&"none"!==t.getItemVisual(e,"symbol")}function Db(t,e,i){return i.itemModel=e,i.itemStyle=e.getModel("itemStyle.normal").getItemStyle(),i.hoverItemStyle=e.getModel("itemStyle.emphasis").getItemStyle(),i.lineStyle=e.getModel("lineStyle.normal").getLineStyle(),i.labelModel=e.getModel("label.normal"),i.hoverLabelModel=e.getModel("label.emphasis"),!1===t.isExpand&&0!==t.children.length?i.symbolInnerColor=i.itemStyle.fill:i.symbolInnerColor="#fff",i}function Ob(t,e,i,n,r,o){var a=!i,s=t.tree.getNodeByDataIndex(e),l=(o=Db(s,s.getModel(),o),t.tree.root),h=s.parentNode===l?s:s.parentNode||s,c=t.getItemGraphicEl(h.dataIndex),u=h.getLayout(),d=c?{x:c.position[0],y:c.position[1],rawX:c.__radialOldRawX,rawY:c.__radialOldRawY}:u,p=s.getLayout();a?(i=new Ey(t,e,o)).attr("position",[d.x,d.y]):i.updateData(t,e,o),i.__radialOldRawX=i.__radialRawX,i.__radialOldRawY=i.__radialRawY,i.__radialRawX=p.rawX,i.__radialRawY=p.rawY,n.add(i),t.setItemGraphicEl(e,i),pf.updateProps(i,{position:[p.x,p.y]},r);var f=i.getSymbolPath();if("radial"===o.layout){var g,m,v=l.children[0],y=v.getLayout(),_=v.children.length;if(p.x===y.x&&!0===s.isExpand){var x={};x.x=(v.children[0].getLayout().x+v.children[_-1].getLayout().x)/2,x.y=(v.children[0].getLayout().y+v.children[_-1].getLayout().y)/2,(g=Math.atan2(x.y-y.y,x.x-y.x))<0&&(g=2*Math.PI+g),(m=x.x<y.x)&&(g-=Math.PI)}else(g=Math.atan2(p.y-y.y,p.x-y.x))<0&&(g=2*Math.PI+g),0===s.children.length||0!==s.children.length&&!1===s.isExpand?(m=p.x<y.x)&&(g-=Math.PI):(m=p.x>y.x)||(g-=Math.PI);var w=m?"left":"right";f.setStyle({textPosition:w,textRotation:-g,textOrigin:"center",verticalAlign:"middle"})}if(s.parentNode&&s.parentNode!==l){var b=i.__edge;b||(b=i.__edge=new pf.BezierCurve({shape:zb(o,d,d),style:za.defaults({opacity:0},o.lineStyle)})),pf.updateProps(b,{shape:zb(o,u,p),style:{opacity:1}},r),n.add(b)}}function kb(t,e,i,n,r,o){for(var a,s=t.tree.getNodeByDataIndex(e),l=t.tree.root,h=(o=Db(s,s.getModel(),o),s.parentNode===l?s:s.parentNode||s);null==(a=h.getLayout());)h=h.parentNode===l?h:h.parentNode||h;pf.updateProps(i,{position:[a.x+1,a.y+1]},r,function(){n.remove(i),t.setItemGraphicEl(e,null)}),i.fadeOut(null,{keepLabel:!0});var c=i.__edge;c&&pf.updateProps(c,{shape:zb(o,a,a),style:{opacity:0}},r,function(){n.remove(c)})}function zb(t,e,i){var n,r,o,a,s=t.orient;if("radial"===t.layout){var l=e.rawX,h=e.rawY,c=i.rawX,u=i.rawY,d=Ib(l,h),p=Ib(l,h+(u-h)*t.curvature),f=Ib(c,u+(h-u)*t.curvature),g=Ib(c,u);return{x1:d.x,y1:d.y,x2:g.x,y2:g.y,cpx1:p.x,cpy1:p.y,cpx2:f.x,cpy2:f.y}}l=e.x,h=e.y,c=i.x,u=i.y;return"horizontal"===s&&(n=l+(c-l)*t.curvature,r=h,o=c+(l-c)*t.curvature,a=u),"vertical"===s&&(n=l,r=h+(u-h)*t.curvature,o=c,a=u+(h-u)*t.curvature),{x1:l,y1:h,x2:c,y2:u,cpx1:n,cpy1:r,cpx2:o,cpy2:a}}fy.registerAction({type:"treeExpandAndCollapse",event:"treeExpandAndCollapse",update:"update"},function(n,t){t.eachComponent({mainType:"series",subType:"tree",query:n},function(t){var e=n.dataIndex,i=t.getData().tree.getNodeByDataIndex(e);i.isExpand=!i.isExpand})});var Nb={eachAfter:function(t,e,i){for(var n,r=[t],o=[];n=r.pop();)if(o.push(n),n.isExpand){var a=n.children;if(a.length)for(var s=0;s<a.length;s++)r.push(a[s])}for(;n=o.pop();)e(n,i)},eachBefore:function(t,e){for(var i,n=[t];i=n.pop();)if(e(i),i.isExpand){var r=i.children;if(r.length)for(var o=r.length-1;0<=o;o--)n.push(r[o])}}},Bb=Nb.eachAfter,Fb=Nb.eachBefore,Gb=Lb.init,Vb=Lb.firstWalk,Hb=Lb.secondWalk,Ub=Lb.separation,Wb=Lb.radialCoordinate,jb=Lb.getViewRect;var Zb=function(t,e){var i=jb(t,e);t.layoutInfo=i;var n=t.get("layout"),r=0,o=0,a=null;"radial"===n?(r=2*Math.PI,o=Math.min(i.height,i.width)/2,a=Ub(function(t,e){return(t.parentNode===e.parentNode?1:2)/t.depth})):(r=i.width,o=i.height,a=Ub());var s=t.getData().tree.root,l=s.children[0];Gb(s),Bb(l,Vb,a),s.hierNode.modifier=-l.hierNode.prelim,Fb(l,Hb);var h=l,c=l,u=l;Fb(l,function(t){var e=t.getLayout().x;e<h.getLayout().x&&(h=t),e>c.getLayout().x&&(c=t),t.depth>u.depth&&(u=t)});var d=h===c?1:a(h,c)/2,p=d-h.getLayout().x,f=0,g=0,m=0,v=0;"radial"===n?(f=r/(c.getLayout().x+d+p),g=o/(u.depth-1||1),Fb(l,function(t){m=(t.getLayout().x+p)*f,v=(t.depth-1)*g;var e=Wb(m,v);t.setLayout({x:e.x,y:e.y,rawX:m,rawY:v},!0)})):"horizontal"===t.get("orient")?(g=o/(c.getLayout().x+d+p),f=r/(u.depth-1||1),Fb(l,function(t){v=(t.getLayout().x+p)*g,m=(t.depth-1)*f,t.setLayout({x:m,y:v},!0)})):(f=r/(c.getLayout().x+d+p),g=o/(u.depth-1||1),Fb(l,function(t){m=(t.getLayout().x+p)*f,v=(t.depth-1)*g,t.setLayout({x:m,y:v},!0)}))};var Xb=function(t,e){t.eachSeriesByType("tree",function(t){Zb(t,e)})};var qb=function(t,e){t.eachSeriesByType("tree",function(t){Zb(t,e)})};function Yb(t){for(var e=[];t;)(t=t.parentNode)&&e.push(t);return e.reverse()}fy.registerVisual(za.curry(e_,"tree","circle",null)),fy.registerLayout(Xb),fy.registerLayout(qb);var Jb={retrieveTargetInfo:function(t,e){if(t&&("treemapZoomToNode"===t.type||"treemapRootToNode"===t.type)){var i=e.getData().tree.root,n=t.targetNode;if(n&&i.contains(n))return{node:n};var r=t.targetNodeId;if(null!=r&&(n=i.getNodeById(r)))return{node:n}}},getPathToRoot:Yb,aboveViewRoot:function(t,e){var i=Yb(t);return 0<=za.indexOf(i,e)},wrapTreePathInfo:function(t,e){for(var i=[];t;){var n=t.dataIndex;i.push({name:t.name,dataIndex:n,value:e.getRawValue(n)}),t=t.parentNode}return i.reverse(),i}},Kb=Yc.encodeHTML,Qb=Yc.addCommas,$b=Jb.wrapTreePathInfo;Qg.extend({type:"series.treemap",layoutMode:"box",dependencies:["grid","polar"],_viewRoot:null,defaultOption:{progressive:0,hoverLayerThreshold:1/0,left:"center",top:"middle",right:null,bottom:null,width:"80%",height:"80%",sort:!0,clipWindow:"origin",squareRatio:.5*(1+Math.sqrt(5)),leafDepth:null,drillDownIcon:"\u25b6",zoomToNodeRatio:.1024,roam:!0,nodeClick:"zoomToNode",animation:!0,animationDurationUpdate:900,animationEasing:"quinticInOut",breadcrumb:{show:!0,height:22,left:"center",top:"bottom",emptyItemWidth:25,itemStyle:{normal:{color:"rgba(0,0,0,0.7)",borderColor:"rgba(255,255,255,0.7)",borderWidth:1,shadowColor:"rgba(150,150,150,1)",shadowBlur:3,shadowOffsetX:0,shadowOffsetY:0,textStyle:{color:"#fff"}},emphasis:{textStyle:{}}}},label:{normal:{show:!0,distance:0,padding:5,position:"inside",color:"#fff",ellipsis:!0}},upperLabel:{normal:{show:!1,position:[0,"50%"],height:20,color:"#fff",ellipsis:!0,verticalAlign:"middle"},emphasis:{show:!0,position:[0,"50%"],color:"#fff",ellipsis:!0,verticalAlign:"middle"}},itemStyle:{normal:{color:null,colorAlpha:null,colorSaturation:null,borderWidth:0,gapWidth:0,borderColor:"#fff",borderColorSaturation:null},emphasis:{}},visualDimension:0,visualMin:null,visualMax:null,color:[],colorAlpha:null,colorSaturation:null,colorMappingBy:"index",visibleMin:10,childrenVisibleMin:null,levels:[]},getInitialData:function(t,e){var i={name:t.name,children:t.data};!function i(t){var n=0;za.each(t.children,function(t){i(t);var e=t.value;za.isArray(e)&&(e=e[0]),n+=e});var e=t.value;za.isArray(e)&&(e=e[0]);(null==e||isNaN(e))&&(e=n);e<0&&(e=0);za.isArray(t.value)?t.value[0]=e:t.value=e}(i);var n=t.levels||[];n=t.levels=function(t,e){var n,i=e.get("color");if(!i)return;if(t=t||[],za.each(t,function(t){var e=new bf(t),i=e.get("color");(e.get("itemStyle.normal.color")||i&&"none"!==i)&&(n=!0)}),!n){var r=t[0]||(t[0]={});r.color=i.slice()}return t}(n,e);var r={};return r.levels=n,Tb.createTree(i,this,r).data},optionUpdated:function(){this.resetViewRoot()},formatTooltip:function(t){var e=this.getData(),i=this.getRawValue(t),n=za.isArray(i)?Qb(i[0]):Qb(i),r=e.getName(t);return Kb(r+": "+n)},getDataParams:function(t){var e=Qg.prototype.getDataParams.apply(this,arguments),i=this.getData().tree.getNodeByDataIndex(t);return e.treePathInfo=$b(i,this),e},setLayoutInfo:function(t){this.layoutInfo=this.layoutInfo||{},za.extend(this.layoutInfo,t)},mapIdToIndex:function(t){var e=this._idIndexMap;e||(e=this._idIndexMap=za.createHashMap(),this._idIndexMapCount=0);var i=e.get(t);return null==i&&e.set(t,i=this._idIndexMapCount++),i},getViewRoot:function(){return this._viewRoot},resetViewRoot:function(t){t?this._viewRoot=t:t=this._viewRoot;var e=this.getData().tree.root;t&&(t===e||e.contains(t))||(this._viewRoot=e)}});var tM=Jb.wrapTreePathInfo,eM=5;function iM(t){this.group=new pf.Group,t.add(this.group)}function nM(t,e,i,n,r,o){var a=[[r?t:t-eM,e],[t+i,e],[t+i,e+n],[r?t:t-eM,e+n]];return!o&&a.splice(2,0,[t+i+eM,e+n/2]),!r&&a.push([t,e+n/2]),a}iM.prototype={constructor:iM,render:function(t,e,i,n){var r=t.getModel("breadcrumb"),o=this.group;if(o.removeAll(),r.get("show")&&i){var a=r.getModel("itemStyle.normal"),s=a.getModel("textStyle"),l={pos:{left:r.get("left"),right:r.get("right"),top:r.get("top"),bottom:r.get("bottom")},box:{width:e.getWidth(),height:e.getHeight()},emptyItemWidth:r.get("emptyItemWidth"),totalWidth:0,renderList:[]};this._prepare(i,l,s),this._renderContent(t,l,a,s,n),jf.positionElement(o,l.pos,l.box)}},_prepare:function(t,e,i){for(var n=t;n;n=n.parentNode){var r=n.getModel().get("name"),o=i.getTextRect(r),a=Math.max(o.width+16,e.emptyItemWidth);e.totalWidth+=a+8,e.renderList.push({node:n,text:r,width:a})}},_renderContent:function(t,e,i,n,r){for(var o,a,s=0,l=e.emptyItemWidth,h=t.get("breadcrumb.height"),c=jf.getAvailableSize(e.pos,e.box),u=e.totalWidth,d=e.renderList,p=d.length-1;0<=p;p--){var f=d[p],g=f.node,m=f.width,v=f.text;u>c.width&&(u-=m-l,m=l,v=null);var y=new pf.Polygon({shape:{points:nM(s,0,m,h,p===d.length-1,0===p)},style:za.defaults(i.getItemStyle(),{lineJoin:"bevel",text:v,textFill:n.getTextColor(),textFont:n.getFont()}),z:10,onclick:za.curry(r,g)});this.group.add(y),o=t,a=g,y.eventData={componentType:"series",componentSubType:"treemap",seriesIndex:o.componentIndex,seriesName:o.name,seriesType:"treemap",selfType:"breadcrumb",nodeData:{dataIndex:a&&a.dataIndex,name:a&&a.name},treePathInfo:a&&tM(a,o)},s+=m+8}},remove:function(){this.group.removeAll()}};var rM=iM;var oM={createWrap:function(){var o,a=[],s={};return{add:function(t,e,i,n,r){return za.isString(n)&&(r=n,n=0),!s[t.id]&&(s[t.id]=1,a.push({el:t,target:e,time:i,delay:n,easing:r}),!0)},done:function(t){return o=t,this},start:function(){for(var t=a.length,e=0,i=a.length;e<i;e++){var n=a[e];n.el.animateTo(n.target,n.time,n.delay,n.easing,r)}return this;function r(){--t||(a.length=0,s={},o&&o())}}}}},aM=za.bind,sM=pf.Group,lM=pf.Rect,hM=za.each,cM=["label","normal"],uM=["label","emphasis"],dM=["upperLabel","normal"],pM=["upperLabel","emphasis"],fM=10,gM=nu([["fill","color"],["stroke","strokeColor"],["lineWidth","strokeWidth"],["shadowBlur"],["shadowOffsetX"],["shadowOffsetY"],["shadowColor"]]),mM=function(t){var e=gM(t);return e.stroke=e.fill=e.lineWidth=null,e};fy.extendChartView({type:"treemap",init:function(t,e){this._containerGroup,this._storage={nodeGroup:[],background:[],content:[]},this._oldTree,this._breadcrumb,this._controller,this._state="ready"},render:function(t,e,i,n){var r=e.findComponents({mainType:"series",subType:"treemap",query:n});if(!(za.indexOf(r,t)<0)){this.seriesModel=t,this.api=i,this.ecModel=e;var o=Jb.retrieveTargetInfo(n,t),a=n&&n.type,s=t.layoutInfo,l=!this._oldTree,h=this._storage,c="treemapRootToNode"===a&&o&&h?{rootNodeGroup:h.nodeGroup[o.node.getRawIndex()],direction:n.direction}:null,u=this._giveContainerGroup(s),d=this._doRender(u,t,c);l||a&&"treemapZoomToNode"!==a&&"treemapRootToNode"!==a?d.renderFinally():this._doAnimation(u,d,t,c),this._resetController(i),this._renderBreadcrumb(t,i,o)}},_giveContainerGroup:function(t){var e=this._containerGroup;return e||(e=this._containerGroup=new sM,this._initEvents(e),this.group.add(e)),e.attr("position",[t.x,t.y]),e},_doRender:function(t,e,i){var n=e.getData().tree,r=this._oldTree,o={nodeGroup:[],background:[],content:[]},a={nodeGroup:[],background:[],content:[]},s=this._storage,l=[],u=za.curry(vM,e,a,s,i,o,l);!function o(a,s,l,h,c){h?hM(s=a,function(t,e){!t.isRemoved()&&i(e,e)}):new ym(s,a,t,t).add(i).update(i).remove(za.curry(i,null)).execute();function t(t){return t.getId()}function i(t,e){var i=null!=t?a[t]:null,n=null!=e?s[e]:null,r=u(i,n,l,c);r&&o(i&&i.viewChildren||[],n&&n.viewChildren||[],r,h,c+1)}}(n.root?[n.root]:[],r&&r.root?[r.root]:[],t,n===r||!r,0);var h,c,d=(c={nodeGroup:[],background:[],content:[]},(h=s)&&hM(h,function(t,e){var i=c[e];hM(t,function(t){t&&(i.push(t),t.__tmWillDelete=1)})}),c);return this._oldTree=n,this._storage=a,{lastsForAnimation:o,willDeleteEls:d,renderFinally:function(){hM(d,function(t){hM(t,function(t){t.parent&&t.parent.remove(t)})}),hM(l,function(t){t.invisible=!0,t.dirty()})}}},_doAnimation:function(t,o,e,s){if(e.get("animation")){var l=e.get("animationDurationUpdate"),h=e.get("animationEasing"),c=oM.createWrap();hM(o.willDeleteEls,function(t,a){hM(t,function(t,e){if(!t.invisible){var i,n=t.parent;if(s&&"drillDown"===s.direction)i=n===s.rootNodeGroup?{shape:{x:0,y:0,width:n.__tmNodeWidth,height:n.__tmNodeHeight},style:{opacity:0}}:{style:{opacity:0}};else{var r=0,o=0;n.__tmWillDelete||(r=n.__tmNodeWidth/2,o=n.__tmNodeHeight/2),i="nodeGroup"===a?{position:[r,o],style:{opacity:0}}:{shape:{x:r,y:o,width:0,height:0},style:{opacity:0}}}i&&c.add(t,i,l,h)}})}),hM(this._storage,function(t,r){hM(t,function(t,e){var i=o.lastsForAnimation[r][e],n={};i&&("nodeGroup"===r?i.old&&(n.position=t.position.slice(),t.attr("position",i.old)):(i.old&&(n.shape=za.extend({},t.shape),t.setShape(i.old)),i.fadein?(t.setStyle("opacity",0),n.style={opacity:1}):1!==t.style.opacity&&(n.style={opacity:1})),c.add(t,n,l,h))})},this),this._state="animating",c.done(aM(function(){this._state="ready",o.renderFinally()},this)).start()}},_resetController:function(t){var e=this._controller;e||((e=this._controller=new Qw(t.getZr())).enable(this.seriesModel.get("roam")),e.on("pan",aM(this._onPan,this)),e.on("zoom",aM(this._onZoom,this)));var n=new bl(0,0,t.getWidth(),t.getHeight());e.setPointerChecker(function(t,e,i){return n.contain(e,i)})},_clearController:function(){var t=this._controller;t&&(t.dispose(),t=null)},_onPan:function(t,e){if("animating"!==this._state&&(3<Math.abs(t)||3<Math.abs(e))){var i=this.seriesModel.getData().tree.root;if(!i)return;var n=i.getLayout();if(!n)return;this.api.dispatchAction({type:"treemapMove",from:this.uid,seriesId:this.seriesModel.id,rootRect:{x:n.x+t,y:n.y+e,width:n.width,height:n.height}})}},_onZoom:function(t,e,i){if("animating"!==this._state){var n=this.seriesModel.getData().tree.root;if(!n)return;var r=n.getLayout();if(!r)return;var o=new bl(r.x,r.y,r.width,r.height),a=this.seriesModel.layoutInfo;e-=a.x,i-=a.y;var s=ns.create();ns.translate(s,s,[-e,-i]),ns.scale(s,s,[t,t]),ns.translate(s,s,[e,i]),o.applyTransform(s),this.api.dispatchAction({type:"treemapRender",from:this.uid,seriesId:this.seriesModel.id,rootRect:{x:o.x,y:o.y,width:o.width,height:o.height}})}},_initEvents:function(t){t.on("click",function(t){if("ready"===this._state){var e=this.seriesModel.get("nodeClick",!0);if(e){var i=this.findTarget(t.offsetX,t.offsetY);if(i){var n=i.node;if(n.getLayout().isLeafRoot)this._rootToNode(i);else if("zoomToNode"===e)this._zoomToNode(i);else if("link"===e){var r=n.hostTree.data.getItemModel(n.dataIndex),o=r.get("link",!0),a=r.get("target",!0)||"blank";o&&window.open(o,a)}}}}},this)},_renderBreadcrumb:function(e,t,i){i||(i=null!=e.get("leafDepth",!0)?{node:e.getViewRoot()}:this.findTarget(t.getWidth()/2,t.getHeight()/2))||(i={node:e.getData().tree.root}),(this._breadcrumb||(this._breadcrumb=new rM(this.group))).render(e,t,i.node,aM(function(t){"animating"!==this._state&&(Jb.aboveViewRoot(e.getViewRoot(),t)?this._rootToNode({node:t}):this._zoomToNode({node:t}))},this))},remove:function(){this._clearController(),this._containerGroup&&this._containerGroup.removeAll(),this._storage={nodeGroup:[],background:[],content:[]},this._state="ready",this._breadcrumb&&this._breadcrumb.remove()},dispose:function(){this._clearController()},_zoomToNode:function(t){this.api.dispatchAction({type:"treemapZoomToNode",from:this.uid,seriesId:this.seriesModel.id,targetNode:t.node})},_rootToNode:function(t){this.api.dispatchAction({type:"treemapRootToNode",from:this.uid,seriesId:this.seriesModel.id,targetNode:t.node})},findTarget:function(r,o){var a;return this.seriesModel.getViewRoot().eachNode({attr:"viewChildren",order:"preorder"},function(t){var e=this._storage.background[t.getRawIndex()];if(e){var i=e.transformCoordToLocal(r,o),n=e.shape;if(!(n.x<=i[0]&&i[0]<=n.x+n.width&&n.y<=i[1]&&i[1]<=n.y+n.height))return!1;a={node:t,offsetX:i[0],offsetY:i[1]}}},this),a}});function vM(d,u,p,f,g,i,m,t,e,n){if(m){var v=m.getLayout();if(v&&v.isInView){var s=v.width,l=v.height,h=v.borderWidth,y=v.invisible,_=m.getRawIndex(),x=t&&t.getRawIndex(),r=m.viewChildren,c=v.upperHeight,o=r&&r.length,w=m.getModel("itemStyle.normal"),b=m.getModel("itemStyle.emphasis"),a=A("nodeGroup",sM);if(a){if(e.add(a),a.attr("position",[v.x||0,v.y||0]),a.__tmNodeWidth=s,a.__tmNodeHeight=l,v.isAboveViewRoot)return a;var M=A("background",lM,n,1);if(M&&function(t,n,r){n.dataIndex=m.dataIndex,n.seriesIndex=d.seriesIndex,n.setShape({x:0,y:0,width:s,height:l});var o=m.getVisual("borderColor",!0),a=b.get("borderColor");T(n,function(){var t=mM(w);t.fill=o;var e=gM(b);if(e.fill=a,r){var i=s-2*h;C(t,e,o,i,c,{x:h,y:0,width:i,height:c})}else t.text=e.text=null;n.setStyle(t),pf.setHoverStyle(n,e)}),t.add(n)}(a,M,o&&v.upperHeight),!o){var S=A("content",lM,n,2);S&&function(t,i){i.dataIndex=m.dataIndex,i.seriesIndex=d.seriesIndex;var n=Math.max(s-2*h,0),r=Math.max(l-2*h,0);i.culling=!0,i.setShape({x:h,y:h,width:n,height:r});var o=m.getVisual("color",!0);T(i,function(){var t=mM(w);t.fill=o;var e=gM(b);C(t,e,o,n,r),i.setStyle(t),pf.setHoverStyle(i,e)}),t.add(i)}(a,S)}return a}}}function T(t,e){y?!t.invisible&&i.push(t):(e(),t.__tmWillVisible||(t.invisible=!1))}function C(t,e,i,n,r,o){var a=m.getModel(),s=za.retrieve(d.getFormattedLabel(m.dataIndex,"normal",null,null,o?"upperLabel":"label"),a.get("name"));if(!o&&v.isLeafRoot){var l=d.get("drillDownIcon",!0);s=l?l+" "+s:s}var h=a.getModel(o?dM:cM),c=a.getModel(o?pM:uM),u=h.getShallow("show");pf.setLabelStyle(t,e,h,c,{defaultText:u?s:null,autoColor:i,isRectText:!0}),o&&(t.textRect=za.clone(o)),t.truncate=u&&h.get("ellipsis")?{outerWidth:n,outerHeight:r,minChar:2}:null}function A(t,e,i,n){var r,o,a,s,l,h=null!=x&&p[t][x],c=g[t];return h?(p[t][x]=null,s=h,l=t,(c[_]={}).old="nodeGroup"===l?s.position.slice():za.extend({},s.shape)):y||((h=new e({z:(r=i,o=n,a=r*fM+o,(a-1)/a)})).__tmDepth=i,function(t,e,i){var n=t[_]={},r=m.parentNode;if(r&&(!f||"drillDown"===f.direction)){var o=0,a=0,s=g.background[r.getRawIndex()];!f&&s&&s.old&&(o=s.old.width,a=s.old.height),n.old="nodeGroup"===i?[0,a]:{x:o,y:a,width:0,height:0}}n.fadein="nodeGroup"!==i}(c,0,h.__tmStorageName=t)),u[t][_]=h}}for(var yM=function(){},_M=["treemapZoomToNode","treemapRender","treemapMove"],xM=0;xM<_M.length;xM++)fy.registerAction({type:_M[xM],update:"updateView"},yM);fy.registerAction({type:"treemapRootToNode",update:"updateView"},function(r,t){t.eachComponent({mainType:"series",subType:"treemap",query:r},function(t,e){var i=Jb.retrieveTargetInfo(r,t);if(i){var n=t.getViewRoot();n&&(r.direction=Jb.aboveViewRoot(n,i.node)?"rollUp":"drillDown"),t.resetViewRoot(i.node)}})});var wM=Uc.linearMap,bM=za.each,MM=za.isObject,SM=-1,TM=function(t){var e=t.mappingMethod,i=t.type,n=this.option=za.clone(t);this.type=i,this.mappingMethod=e,this._normalizeData=zM[e];var r,o,a=CM[i];this.applyVisual=a.applyVisual,this.getColorMapper=a.getColorMapper,this._doMap=a._doMap[e],"piecewise"===e?(AM(n),o=(r=n).pieceList,r.hasSpecialVisual=!1,za.each(o,function(t,e){t.originIndex=e,null!=t.visual&&(r.hasSpecialVisual=!0)})):"category"===e?n.categories?function(t){var e=t.categories,i=t.visual,n=t.categoryMap={};if(bM(e,function(t,e){n[t]=e}),!za.isArray(i)){var r=[];za.isObject(i)?bM(i,function(t,e){var i=n[e];r[null!=i?i:SM]=t}):r[SM]=i,i=kM(t,r)}for(var o=e.length-1;0<=o;o--)null==i[o]&&(delete n[e[o]],e.pop())}(n):AM(n,!0):(za.assert("linear"!==e||n.dataExtent),AM(n))};TM.prototype={constructor:TM,mapValueToVisual:function(t){var e=this._normalizeData(t);return this._doMap(e,t)},getNormalizer:function(){return za.bind(this._normalizeData,this)}};var CM=TM.visualHandlers={color:{applyVisual:LM("color"),getColorMapper:function(){var r=this.option;return za.bind("category"===r.mappingMethod?function(t,e){return!e&&(t=this._normalizeData(t)),IM.call(this,t)}:function(t,e,i){var n=!!i;return!e&&(t=this._normalizeData(t)),i=Ns.fastLerp(t,r.parsedVisual,i),n?i:Ns.stringify(i,"rgba")},this)},_doMap:{linear:function(t){return Ns.stringify(Ns.fastLerp(t,this.option.parsedVisual),"rgba")},category:IM,piecewise:function(t,e){var i=OM.call(this,e);return null==i&&(i=Ns.stringify(Ns.fastLerp(t,this.option.parsedVisual),"rgba")),i},fixed:RM}},colorHue:EM(function(t,e){return Ns.modifyHSL(t,e)}),colorSaturation:EM(function(t,e){return Ns.modifyHSL(t,null,e)}),colorLightness:EM(function(t,e){return Ns.modifyHSL(t,null,null,e)}),colorAlpha:EM(function(t,e){return Ns.modifyAlpha(t,e)}),opacity:{applyVisual:LM("opacity"),_doMap:DM([0,1])},symbol:{applyVisual:function(t,e,i){var n=this.mapValueToVisual(t);if(za.isString(n))i("symbol",n);else if(MM(n))for(var r in n)n.hasOwnProperty(r)&&i(r,n[r])},_doMap:{linear:PM,category:IM,piecewise:function(t,e){var i=OM.call(this,e);return null==i&&(i=PM.call(this,t)),i},fixed:RM}},symbolSize:{applyVisual:LM("symbolSize"),_doMap:DM([0,1])}};function AM(t,e){var i=t.visual,n=[];za.isObject(i)?bM(i,function(t){n.push(t)}):null!=i&&n.push(i);e||1!==n.length||{color:1,symbol:1}.hasOwnProperty(t.type)||(n[1]=n[0]),kM(t,n)}function EM(n){return{applyVisual:function(t,e,i){t=this.mapValueToVisual(t),i("color",n(e("color"),t))},_doMap:DM([0,1])}}function PM(t){var e=this.option.visual;return e[Math.round(wM(t,[0,1],[0,e.length-1],!0))]||{}}function LM(n){return function(t,e,i){i(n,this.mapValueToVisual(t))}}function IM(t){var e=this.option.visual;return e[this.option.loop&&t!==SM?t%e.length:t]}function RM(){return this.option.visual[0]}function DM(n){return{linear:function(t){return wM(t,n,this.option.visual,!0)},category:IM,piecewise:function(t,e){var i=OM.call(this,e);return null==i&&(i=wM(t,n,this.option.visual,!0)),i},fixed:RM}}function OM(t){var e=this.option,i=e.pieceList;if(e.hasSpecialVisual){var n=i[TM.findPieceIndex(t,i)];if(n&&n.visual)return n.visual[this.type]}}function kM(t,e){return t.visual=e,"color"===t.type&&(t.parsedVisual=za.map(e,function(t){return Ns.parse(t)})),e}var zM={linear:function(t){return wM(t,this.option.dataExtent,[0,1],!0)},piecewise:function(t){var e=this.option.pieceList,i=TM.findPieceIndex(t,e,!0);if(null!=i)return wM(i,[0,e.length-1],[0,1],!0)},category:function(t){var e=this.option.categories?this.option.categoryMap[t]:t;return null==e?SM:e},fixed:za.noop};function NM(t,e,i){return t?e<=i:e<i}TM.listVisualTypes=function(){var i=[];return za.each(CM,function(t,e){i.push(e)}),i},TM.addVisualHandler=function(t,e){CM[t]=e},TM.isValidType=function(t){return CM.hasOwnProperty(t)},TM.eachVisual=function(t,e,i){za.isObject(t)?za.each(t,e,i):e.call(i,t)},TM.mapVisual=function(t,n,r){var o,a=za.isArray(t)?[]:za.isObject(t)?{}:(o=!0,null);return TM.eachVisual(t,function(t,e){var i=n.call(r,t,e);o?a=i:a[e]=i}),a},TM.retrieveVisuals=function(i){var n,r={};return i&&bM(CM,function(t,e){i.hasOwnProperty(e)&&(r[e]=i[e],n=!0)}),n?r:null},TM.prepareVisualTypes=function(t){if(MM(t)){var i=[];bM(t,function(t,e){i.push(e)}),t=i}else{if(!za.isArray(t))return[];t=t.slice()}return t.sort(function(t,e){return"color"===e&&"color"!==t&&0===t.indexOf("color")?1:-1}),t},TM.dependsOn=function(t,e){return"color"===e?!(!t||0!==t.indexOf(e)):t===e},TM.findPieceIndex=function(n,t,e){for(var r,o=1/0,i=0,a=t.length;i<a;i++){var s=t[i].value;if(null!=s){if(s===n||"string"==typeof s&&s===n+"")return i;e&&u(s,i)}}for(i=0,a=t.length;i<a;i++){var l=t[i],h=l.interval,c=l.close;if(h){if(h[0]===-1/0){if(NM(c[1],n,h[1]))return i}else if(h[1]===1/0){if(NM(c[0],h[0],n))return i}else if(NM(c[0],h[0],n)&&NM(c[1],n,h[1]))return i;e&&u(h[0],i),e&&u(h[1],i)}}if(e)return n===1/0?t.length-1:n===-1/0?0:r;function u(t,e){var i=Math.abs(t-n);i<o&&(o=i,r=e)}};var BM=TM,FM=za.isArray,GM="itemStyle.normal";function VM(t){var e=HM(t,"color");if(e){var i=HM(t,"colorAlpha"),n=HM(t,"colorSaturation");return n&&(e=Ns.modifyHSL(e,null,null,n)),i&&(e=Ns.modifyAlpha(e,i)),e}}function HM(t,e){var i=t[e];if(null!=i&&"none"!==i)return i}function UM(t,e){var i=t.get(e);return FM(i)&&i.length?{name:e,range:i}:null}var WM=function(t,e,i){var n={mainType:"series",subType:"treemap",query:i};t.eachComponent(n,function(t){var e=t.getData().tree,i=e.root,n=t.getModel(GM);i.isRemoved()||function n(t,e,r,o,a,s){var l=t.getModel(),i=t.getLayout();if(i&&!i.invisible&&i.isInView){var h,c,u,d,p,f,g,m,v=t.getModel(GM),y=r[t.depth],_=(h=v,c=e,u=y,d=o,p=za.extend({},c),za.each(["color","colorAlpha","colorSaturation"],function(t){var e=h.get(t,!0);null==e&&u&&(e=u[t]),null==e&&(e=c[t]),null==e&&(e=d.get(t)),null!=e&&(p[t]=e)}),p),x=v.get("borderColor"),w=v.get("borderColorSaturation");null!=w&&(f=VM(_),g=w,x=null!=(m=f)?Ns.modifyHSL(m,null,null,g):null),t.setVisual("borderColor",x);var b=t.viewChildren;if(b&&b.length){var M=function(t,e,i,n,r,o){if(o&&o.length){var a=UM(e,"color")||null!=r.color&&"none"!==r.color&&(UM(e,"colorAlpha")||UM(e,"colorSaturation"));if(a){var s=e.get("visualMin"),l=e.get("visualMax"),h=i.dataExtent.slice();null!=s&&s<h[0]&&(h[0]=s),null!=l&&l>h[1]&&(h[1]=l);var c=e.get("colorMappingBy"),u={type:a.name,dataExtent:h,visual:a.range};"color"!==u.type||"index"!==c&&"id"!==c?u.mappingMethod="linear":(u.mappingMethod="category",u.loop=!0);var d=new BM(u);return d.__drColorMappingBy=c,d}}}(0,l,i,0,_,b);za.each(b,function(t,e){if(t.depth>=a.length||t===a[t.depth]){var i=function(t,e,i,n,r,o){var a=za.extend({},e);if(r){var s=r.type,l="color"===s&&r.__drColorMappingBy,h="index"===l?n:"id"===l?o.mapIdToIndex(i.getId()):i.getValue(t.get("visualDimension"));a[s]=r.mapValueToVisual(h)}return a}(l,_,t,e,M,s);n(t,i,r,o,a,s)}})}else f=VM(_),t.setVisual("color",f)}}(i,{},za.map(e.levelModels,function(t){return t?t.get(GM):null}),n,t.getViewRoot().getAncestors(),t)})},jM=Uc.parsePercent,ZM=Uc.MAX_SAFE_INTEGER,XM=Math.max,qM=Math.min,YM=za.retrieve,JM=za.each,KM=["itemStyle","normal","borderWidth"],QM=["itemStyle","normal","gapWidth"],$M=["upperLabel","normal","show"],tS=["upperLabel","normal","height"];function eS(t,e,i){for(var n,r=0,o=1/0,a=0,s=t.length;a<s;a++)(n=t[a].getLayout().area)&&(n<o&&(o=n),r<n&&(r=n));var l=t.area*t.area,h=e*e*i;return l?XM(h*r/l,l/(h*o)):1/0}function iS(t,e,i,n,r){var o=e===i.width?0:1,a=1-o,s=["x","y"],l=["width","height"],h=i[s[o]],c=e?t.area/e:0;(r||c>i[l[a]])&&(c=i[l[a]]);for(var u=0,d=t.length;u<d;u++){var p=t[u],f={},g=c?p.getLayout().area/c:0,m=f[l[a]]=XM(c-2*n,0),v=i[s[o]]+i[l[o]]-h,y=u===d-1||v<g?v:g,_=f[l[o]]=XM(y-2*n,0);f[s[a]]=i[s[a]]+qM(n,m/2),f[s[o]]=h+qM(n,_/2),h+=y,p.setLayout(f,!0)}i[s[a]]+=c,i[l[a]]-=c}function nS(t){return t.get($M)?t.get(tS):0}var rS=function(t,y,_){var e={mainType:"series",subType:"treemap",query:_};t.eachComponent(e,function(t){var e=y.getWidth(),i=y.getHeight(),n=t.option,r=jf.getLayoutRect(t.getBoxLayoutParams(),{width:y.getWidth(),height:y.getHeight()}),o=n.size||[],a=jM(YM(r.width,o[0]),e),s=jM(YM(r.height,o[1]),i),l=_&&_.type,h=Jb.retrieveTargetInfo(_,t),c="treemapRender"===l||"treemapMove"===l?_.rootRect:null,u=t.getViewRoot(),d=Jb.getPathToRoot(u);if("treemapMove"!==l){var p="treemapZoomToNode"===l?function(t,e,i,n,r){var o,a=(e||{}).node,s=[n,r];if(!a||a===i)return s;for(var l=n*r,h=l*t.option.zoomToNodeRatio;o=a.parentNode;){for(var c=0,u=o.children,d=0,p=u.length;d<p;d++)c+=u[d].getValue();var f=a.getValue();if(0===f)return s;h*=c/f;var g=o.getModel(),m=g.get(KM),v=Math.max(m,nS(g));h+=4*m*m+(3*m+v)*Math.pow(h,.5),ZM<h&&(h=ZM),a=o}h<l&&(h=l);var y=Math.pow(h/l,.5);return[n*y,r*y]}(t,h,u,a,s):c?[c.width,c.height]:[a,s],f=n.sort;f&&"asc"!==f&&"desc"!==f&&(f="desc");var g={squareRatio:n.squareRatio,sort:f,leafDepth:n.leafDepth};u.hostTree.clearLayouts();var m={x:0,y:0,width:p[0],height:p[1],area:p[0]*p[1]};u.setLayout(m),function t(e,i,n,r){var o,a;if(!e.isRemoved()){var s=e.getLayout();o=s.width,a=s.height;var l=e.getModel(),h=l.get(KM),c=l.get(QM)/2,u=nS(l),d=Math.max(h,u),p=h-c,f=d-c,l=e.getModel();e.setLayout({borderWidth:h,upperHeight:d,upperLabelHeight:u},!0),o=XM(o-2*p,0),a=XM(a-p-f,0);var g=o*a,m=function(t,e,i,n,r,o){var a=t.children||[],s=n.sort;"asc"!==s&&"desc"!==s&&(s=null);var l,h,c=null!=n.leafDepth&&n.leafDepth<=o;if(r&&!c)return t.viewChildren=[];l=a=za.filter(a,function(t){return!t.isRemoved()}),(h=s)&&l.sort(function(t,e){var i="asc"===h?t.getValue()-e.getValue():e.getValue()-t.getValue();return 0===i?"asc"===h?t.dataIndex-e.dataIndex:e.dataIndex-t.dataIndex:i});var u=function(t,e,i){for(var n=0,r=0,o=e.length;r<o;r++)n+=e[r].getValue();var a=t.get("visualDimension");if(e&&e.length)if("value"===a&&i)s=[e[e.length-1].getValue(),e[0].getValue()],"asc"===i&&s.reverse();else{var s=[1/0,-1/0];JM(e,function(t){var e=t.getValue(a);e<s[0]&&(s[0]=e),e>s[1]&&(s[1]=e)})}else s=[NaN,NaN];return{sum:n,dataExtent:s}}(e,a,s);if(0===u.sum)return t.viewChildren=[];if(u.sum=function(t,e,i,n,r){if(!n)return i;for(var o=t.get("visibleMin"),a=r.length,s=a,l=a-1;0<=l;l--){var h=r["asc"===n?a-l-1:l].getValue();h/i*e<o&&(s=l,i-=h)}return"asc"===n?r.splice(0,a-s):r.splice(s,a-s),i}(e,i,u.sum,s,a),0===u.sum)return t.viewChildren=[];for(var d=0,p=a.length;d<p;d++){var f=a[d].getValue()/u.sum*i;a[d].setLayout({area:f})}return c&&(a.length&&t.setLayout({isLeafRoot:!0},!0),a.length=0),t.viewChildren=a,t.setLayout({dataExtent:u.dataExtent},!0),a}(e,l,g,i,n,r);if(m.length){for(var v={x:p,y:f,width:o,height:a},y=qM(o,a),_=1/0,x=[],w=x.area=0,b=m.length;w<b;){var M=m[w];x.push(M),x.area+=M.getLayout().area;var S=eS(x,y,i.squareRatio);S<=_?(w++,_=S):(x.area-=x.pop().getLayout().area,iS(x,y,v,c,!1),y=qM(v.width,v.height),x.length=x.area=0,_=1/0)}if(x.length&&iS(x,y,v,c,!0),!n){var T=l.get("childrenVisibleMin");null!=T&&g<T&&(n=!0)}for(var w=0,b=m.length;w<b;w++)t(m[w],i,n,r+1)}}}(u,g,!1,0),m=u.getLayout(),JM(d,function(t,e){var i=(d[e+1]||u).getValue();t.setLayout(za.extend({dataExtent:[i,i],borderWidth:0,upperHeight:0},m))})}var v=t.getData().tree.root;v.setLayout(function(t,e,i){if(e)return{x:e.x,y:e.y};var n={x:0,y:0};if(!i)return n;var r=i.node,o=r.getLayout();if(!o)return n;for(var a=[o.width/2,o.height/2],s=r;s;){var l=s.getLayout();a[0]+=l.x,a[1]+=l.y,s=s.parentNode}return{x:t.width/2-a[0],y:t.height/2-a[1]}}(r,c,h),!0),t.setLayoutInfo(r),function e(t,i,n,r,o){var a=t.getLayout(),s=n[o],l=s&&s===t;if(!(s&&!l||o===n.length&&t!==r)){t.setLayout({isInView:!0,invisible:!l&&!i.intersect(a),isAboveViewRoot:l},!0);var h=new bl(i.x-a.x,i.y-a.y,i.width,i.height);JM(t.viewChildren||[],function(t){e(t,h,n,r,o+1)})}}(v,new bl(-r.x,-r.y,e,i),d,u,0)})};function oS(t){return"_EC_"+t}fy.registerVisual(WM),fy.registerLayout(rS);var aS=function(t){this._directed=t||!1,this.nodes=[],this.edges=[],this._nodesMap={},this._edgesMap={},this.data,this.edgeData},sS=aS.prototype;function lS(t,e){this.id=null==t?"":t,this.inEdges=[],this.outEdges=[],this.edges=[],this.hostGraph,this.dataIndex=null==e?-1:e}function hS(t,e,i){this.node1=t,this.node2=e,this.dataIndex=null==i?-1:i}sS.type="graph",sS.isDirected=function(){return this._directed},sS.addNode=function(t,e){t=t||""+e;var i=this._nodesMap;if(!i[oS(t)]){var n=new lS(t,e);return(n.hostGraph=this).nodes.push(n),i[oS(t)]=n}},sS.getNodeByIndex=function(t){var e=this.data.getRawIndex(t);return this.nodes[e]},sS.getNodeById=function(t){return this._nodesMap[oS(t)]},sS.addEdge=function(t,e,i){var n=this._nodesMap,r=this._edgesMap;if("number"==typeof t&&(t=this.nodes[t]),"number"==typeof e&&(e=this.nodes[e]),t instanceof lS||(t=n[oS(t)]),e instanceof lS||(e=n[oS(e)]),t&&e){var o=t.id+"-"+e.id;if(!r[o]){var a=new hS(t,e,i);return(a.hostGraph=this)._directed&&(t.outEdges.push(a),e.inEdges.push(a)),t.edges.push(a),t!==e&&e.edges.push(a),this.edges.push(a),r[o]=a}}},sS.getEdgeByIndex=function(t){var e=this.edgeData.getRawIndex(t);return this.edges[e]},sS.getEdge=function(t,e){t instanceof lS&&(t=t.id),e instanceof lS&&(e=e.id);var i=this._edgesMap;return this._directed?i[t+"-"+e]:i[t+"-"+e]||i[e+"-"+t]},sS.eachNode=function(t,e){for(var i=this.nodes,n=i.length,r=0;r<n;r++)0<=i[r].dataIndex&&t.call(e,i[r],r)},sS.eachEdge=function(t,e){for(var i=this.edges,n=i.length,r=0;r<n;r++)0<=i[r].dataIndex&&0<=i[r].node1.dataIndex&&0<=i[r].node2.dataIndex&&t.call(e,i[r],r)},sS.breadthFirstTraverse=function(t,e,i,n){if(e instanceof lS||(e=this._nodesMap[oS(e)]),e){for(var r="out"===i?"outEdges":"in"===i?"inEdges":"edges",o=0;o<this.nodes.length;o++)this.nodes[o].__visited=!1;if(!t.call(n,e,null))for(var a=[e];a.length;){var s=a.shift(),l=s[r];for(o=0;o<l.length;o++){var h=l[o],c=h.node1===s?h.node2:h.node1;if(!c.__visited){if(t.call(n,c,s))return;a.push(c),c.__visited=!0}}}}},sS.update=function(){for(var t=this.data,i=this.edgeData,e=this.nodes,n=this.edges,r=0,o=e.length;r<o;r++)e[r].dataIndex=-1;for(r=0,o=t.count();r<o;r++)e[t.getRawIndex(r)].dataIndex=r;i.filterSelf(function(t){var e=n[i.getRawIndex(t)];return 0<=e.node1.dataIndex&&0<=e.node2.dataIndex});for(r=0,o=n.length;r<o;r++)n[r].dataIndex=-1;for(r=0,o=i.count();r<o;r++)n[i.getRawIndex(r)].dataIndex=r},sS.clone=function(){for(var t=new aS(this._directed),e=this.nodes,i=this.edges,n=0;n<e.length;n++)t.addNode(e[n].id,e[n].dataIndex);for(n=0;n<i.length;n++){var r=i[n];t.addEdge(r.node1.id,r.node2.id,r.dataIndex)}return t},lS.prototype={constructor:lS,degree:function(){return this.edges.length},inDegree:function(){return this.inEdges.length},outDegree:function(){return this.outEdges.length},getModel:function(t){if(!(this.dataIndex<0))return this.hostGraph.data.getItemModel(this.dataIndex).getModel(t)}},hS.prototype.getModel=function(t){if(!(this.dataIndex<0))return this.hostGraph.edgeData.getItemModel(this.dataIndex).getModel(t)};var cS=function(i,n){return{getValue:function(t){var e=this[i][n];return e.get(e.getDimension(t||"value"),this.dataIndex)},setVisual:function(t,e){0<=this.dataIndex&&this[i][n].setItemVisual(this.dataIndex,t,e)},getVisual:function(t,e){return this[i][n].getItemVisual(this.dataIndex,t,e)},setLayout:function(t,e){0<=this.dataIndex&&this[i][n].setItemLayout(this.dataIndex,t,e)},getLayout:function(){return this[i][n].getItemLayout(this.dataIndex)},getGraphicEl:function(){return this[i][n].getItemGraphicEl(this.dataIndex)},getRawIndex:function(){return this[i][n].getRawIndex(this.dataIndex)}}};za.mixin(lS,cS("hostGraph","data")),za.mixin(hS,cS("hostGraph","edgeData")),aS.Node=lS,aS.Edge=hS;var uS=aS;var dS=function(t,e,i,n,r){for(var o=new uS(n),a=0;a<t.length;a++)o.addNode(za.retrieve(t[a].id,t[a].name,a),a);var s=[],l=[],h=0;for(a=0;a<e.length;a++){var c=e[a],u=c.source,d=c.target;o.addEdge(u,d,h)&&(l.push(c),s.push(za.retrieve(c.id,u+" > "+d)),h++)}var p,f=i.get("coordinateSystem");if("cartesian2d"===f||"polar"===f)p=Xm(t,i,i.ecModel);else{var g=mg.get(f),m=Gm((g&&"view"!==g.type&&g.dimensions||[]).concat(["value"]),t);(p=new Im(m,i)).initData(t)}var v=new Im(["value"],i);return v.initData(l,s),r&&r(p,v),bb({mainData:p,struct:o,structAttr:"graph",datas:{node:p,edge:v},datasAttr:{node:"data",edge:"edgeData"}}),o.update(),o},pS=If.defaultEmphasis,fS=Yc.encodeHTML,gS=fy.extendSeriesModel({type:"series.graph",init:function(t){gS.superApply(this,"init",arguments),this.legendDataProvider=function(){return this._categoriesData},this.fillDataTextStyle(t.edges||t.links),this._updateCategoriesData()},mergeOption:function(t){gS.superApply(this,"mergeOption",arguments),this.fillDataTextStyle(t.edges||t.links),this._updateCategoriesData()},mergeDefaultAndTheme:function(t){gS.superApply(this,"mergeDefaultAndTheme",arguments),pS(t.edgeLabel,["show"])},getInitialData:function(t,o){var e=t.edges||t.links||[],i=t.data||t.nodes||[],a=this;if(i&&e)return dS(i,e,this,!0,function(t,e){t.wrapMethod("getItemModel",function(t){var e=a._categoriesModels,i=t.getShallow("category"),n=e[i];return n&&(n.parentModel=t.parentModel,t.parentModel=n),t});var i=a.getModel("edgeLabel"),n=new bf({label:i.option},i.parentModel,o);function r(t){return(t=this.parsePath(t))&&"label"===t[0]?n:this.parentModel}e.wrapMethod("getItemModel",function(t){return t.customizeGetParent(r),t})}).data},getGraph:function(){return this.getData().graph},getEdgeData:function(){return this.getGraph().edgeData},getCategoriesData:function(){return this._categoriesData},formatTooltip:function(t,e,i){if("edge"===i){var n=this.getData(),r=this.getDataParams(t,i),o=n.graph.getEdgeByIndex(t),a=n.getName(o.node1.dataIndex),s=n.getName(o.node2.dataIndex),l=[];return null!=a&&l.push(a),null!=s&&l.push(s),l=fS(l.join(" > ")),r.value&&(l+=" : "+fS(r.value)),l}return gS.superApply(this,"formatTooltip",arguments)},_updateCategoriesData:function(){var t=za.map(this.option.categories||[],function(t){return null!=t.value?t:za.extend({value:0},t)}),e=new Im(["value"],this);e.initData(t),this._categoriesData=e,this._categoriesModels=e.mapArray(function(t){return e.getItemModel(t,!0)})},setZoom:function(t){this.option.zoom=t},setCenter:function(t){this.option.center=t},isAnimationEnabled:function(){return gS.superCall(this,"isAnimationEnabled")&&!("force"===this.get("layout")&&this.get("force.layoutAnimation"))},defaultOption:{zlevel:0,z:2,coordinateSystem:"view",legendHoverLink:!0,hoverAnimation:!0,layout:null,focusNodeAdjacency:!1,circular:{rotateLabel:!1},force:{initLayout:null,repulsion:[0,50],gravity:.1,edgeLength:30,layoutAnimation:!0},left:"center",top:"center",symbol:"circle",symbolSize:10,edgeSymbol:["none","none"],edgeSymbolSize:10,edgeLabel:{normal:{position:"middle"},emphasis:{}},draggable:!1,roam:!1,center:null,zoom:1,nodeScaleRatio:.6,label:{normal:{show:!1,formatter:"{b}"},emphasis:{show:!0}},itemStyle:{normal:{},emphasis:{}},lineStyle:{normal:{color:"#aaa",width:1,curveness:0,opacity:.5},emphasis:{}}}}),mS=pf.Line.prototype,vS=pf.BezierCurve.prototype;function yS(t){return isNaN(+t.cpx1)||isNaN(+t.cpy1)}var _S=pf.extendShape({type:"ec-line",style:{stroke:"#000",fill:null},shape:{x1:0,y1:0,x2:0,y2:0,percent:1,cpx1:null,cpy1:null},buildPath:function(t,e){(yS(e)?mS:vS).buildPath(t,e)},pointAt:function(t){return yS(this.shape)?mS.pointAt.call(this,t):vS.pointAt.call(this,t)},tangentAt:function(t){var e=this.shape,i=yS(e)?[e.x2-e.x1,e.y2-e.y1]:vS.tangentAt.call(this,t);return Ha.normalize(i,i)}}),xS=Uc.round,wS=["fromSymbol","toSymbol"];function bS(t){return"_"+t+"Type"}function MS(t,e,i){var n=e.getItemVisual(i,"color"),r=e.getItemVisual(i,t),o=e.getItemVisual(i,t+"Size");if(r&&"none"!==r){za.isArray(o)||(o=[o,o]);var a=Bv.createSymbol(r,-o[0]/2,-o[1]/2,o[0],o[1],n);return a.name=t,a}}function SS(t,e){var i=e[0],n=e[1],r=e[2];t.x1=i[0],t.y1=i[1],t.x2=n[0],t.y2=n[1],t.percent=1,r?(t.cpx1=r[0],t.cpy1=r[1]):(t.cpx1=NaN,t.cpy1=NaN)}function TS(t,e,i){pf.Group.call(this),this._createLine(t,e,i)}var CS=TS.prototype;CS.beforeUpdate=function(){var t=this.childOfName("fromSymbol"),e=this.childOfName("toSymbol"),i=this.childOfName("label");if(t||e||!i.ignore){for(var n=1,r=this.parent;r;)r.scale&&(n/=r.scale[0]),r=r.parent;var o=this.childOfName("line");if(this.__dirty||o.__dirty){var a=o.shape.percent,s=o.pointAt(0),l=o.pointAt(a),h=Ha.sub([],l,s);if(Ha.normalize(h,h),t){t.attr("position",s);var c=o.tangentAt(0);t.attr("rotation",Math.PI/2-Math.atan2(c[1],c[0])),t.attr("scale",[n*a,n*a])}if(e&&(e.attr("position",l),c=o.tangentAt(1),e.attr("rotation",-Math.PI/2-Math.atan2(c[1],c[0])),e.attr("scale",[n*a,n*a])),!i.ignore){var u,d,p;i.attr("position",l);var f=5*n;if("end"===i.__position)u=[h[0]*f+l[0],h[1]*f+l[1]],d=.8<h[0]?"left":h[0]<-.8?"right":"center",p=.8<h[1]?"top":h[1]<-.8?"bottom":"middle";else if("middle"===i.__position){var g=a/2,m=[(c=o.tangentAt(g))[1],-c[0]],v=o.pointAt(g);0<m[1]&&(m[0]=-m[0],m[1]=-m[1]),u=[v[0]+m[0]*f,v[1]+m[1]*f],d="center",p="bottom";var y=-Math.atan2(c[1],c[0]);l[0]<s[0]&&(y=Math.PI+y),i.attr("rotation",y)}else u=[-h[0]*f+s[0],-h[1]*f+s[1]],d=.8<h[0]?"right":h[0]<-.8?"left":"center",p=.8<h[1]?"bottom":h[1]<-.8?"top":"middle";i.attr({style:{textVerticalAlign:i.__verticalAlign||p,textAlign:i.__textAlign||d},position:u,scale:[n,n]})}}}},CS._createLine=function(i,n,t){var e,r,o=i.hostModel,a=i.getItemLayout(n),s=(e=a,SS((r=new _S({name:"line"})).shape,e),r);s.shape.percent=0,pf.initProps(s,{shape:{percent:1}},o,n),this.add(s);var l=new pf.Text({name:"label"});this.add(l),za.each(wS,function(t){var e=MS(t,i,n);this.add(e),this[bS(t)]=i.getItemVisual(n,t)},this),this._updateCommonStl(i,n,t)},CS.updateData=function(r,o,t){var e=r.hostModel,i=this.childOfName("line"),n=r.getItemLayout(o),a={shape:{}};SS(a.shape,n),pf.updateProps(i,a,e,o),za.each(wS,function(t){var e=r.getItemVisual(o,t),i=bS(t);if(this[i]!==e){this.remove(this.childOfName(t));var n=MS(t,r,o);this.add(n)}this[i]=e},this),this._updateCommonStl(r,o,t)},CS._updateCommonStl=function(t,e,i){var n=t.hostModel,r=this.childOfName("line"),o=i&&i.lineStyle,a=i&&i.hoverLineStyle,s=i&&i.labelModel,l=i&&i.hoverLabelModel;if(!i||t.hasItemOption){var h=t.getItemModel(e);o=h.getModel("lineStyle.normal").getLineStyle(),a=h.getModel("lineStyle.emphasis").getLineStyle(),s=h.getModel("label.normal"),l=h.getModel("label.emphasis")}var c=t.getItemVisual(e,"color"),u=za.retrieve3(t.getItemVisual(e,"opacity"),o.opacity,1);r.useStyle(za.defaults({strokeNoScale:!0,fill:"none",stroke:c,opacity:u},o)),r.hoverStyle=a,za.each(wS,function(t){var e=this.childOfName(t);e&&(e.setColor(c),e.setStyle({opacity:u}))},this);var d,p,f,g,m=s.getShallow("show"),v=l.getShallow("show"),y=this.childOfName("label");if(m||v){var _=n.getRawValue(e);p=null==_?p=t.getName(e):isFinite(_)?xS(_):_,d=c||"#000",f=za.retrieve2(n.getFormattedLabel(e,"normal",t.dataType),p),g=za.retrieve2(n.getFormattedLabel(e,"emphasis",t.dataType),f)}if(m){var x=pf.setTextStyle(y.style,s,{text:f},{autoColor:d});y.__textAlign=x.textAlign,y.__verticalAlign=x.textVerticalAlign,y.__position=s.get("position")||"middle"}else y.setStyle("text",null);y.hoverStyle=v?{text:g,textFill:l.getTextColor(!0),fontStyle:l.getShallow("fontStyle"),fontWeight:l.getShallow("fontWeight"),fontSize:l.getShallow("fontSize"),fontFamily:l.getShallow("fontFamily")}:{text:null},y.ignore=!m&&!v,pf.setHoverStyle(this)},CS.highlight=function(){this.trigger("emphasis")},CS.downplay=function(){this.trigger("normal")},CS.updateLayout=function(t,e){this.setLinePoints(t.getItemLayout(e))},CS.setLinePoints=function(t){var e=this.childOfName("line");SS(e.shape,t),e.dirty()},za.inherits(TS,pf.Group);var AS=TS;function ES(t){return isNaN(t[0])||isNaN(t[1])}function PS(t){return!ES(t[0])&&!ES(t[1])}function LS(t){this._ctor=t||AS,this.group=new pf.Group}var IS=LS.prototype;IS.updateData=function(n){var r=this._lineData,o=this.group,a=this._ctor,t=n.hostModel,s={lineStyle:t.getModel("lineStyle.normal").getLineStyle(),hoverLineStyle:t.getModel("lineStyle.emphasis").getLineStyle(),labelModel:t.getModel("label.normal"),hoverLabelModel:t.getModel("label.emphasis")};n.diff(r).add(function(t){if(PS(n.getItemLayout(t))){var e=new a(n,t,s);n.setItemGraphicEl(t,e),o.add(e)}}).update(function(t,e){var i=r.getItemGraphicEl(e);PS(n.getItemLayout(t))?(i?i.updateData(n,t,s):i=new a(n,t,s),n.setItemGraphicEl(t,i),o.add(i)):o.remove(i)}).remove(function(t){o.remove(r.getItemGraphicEl(t))}).execute(),this._lineData=n},IS.updateLayout=function(){var i=this._lineData;i.eachItemGraphicEl(function(t,e){t.updateLayout(i,e)},this)},IS.remove=function(){this.group.removeAll()};var RS=LS,DS=[],OS=[],kS=[],zS=wu.quadraticAt,NS=Ha.distSquare,BS=Math.abs;function FS(t,e,i){for(var n,r=t[0],o=t[1],a=t[2],s=1/0,l=i*i,h=.1,c=.1;c<=.9;c+=.1){DS[0]=zS(r[0],o[0],a[0],c),DS[1]=zS(r[1],o[1],a[1],c),(p=BS(NS(DS,e)-l))<s&&(s=p,n=c)}for(var u=0;u<32;u++){var d=n+h;OS[0]=zS(r[0],o[0],a[0],n),OS[1]=zS(r[1],o[1],a[1],n),kS[0]=zS(r[0],o[0],a[0],d),kS[1]=zS(r[1],o[1],a[1],d);var p=NS(OS,e)-l;if(BS(p)<.01)break;var f=NS(kS,e)-l;h/=2,p<0?0<=f?n+=h:n-=h:0<=f?n-=h:n+=h}return n}var GS=function(t,l){var h=[],c=wu.quadraticSubdivide,u=[[],[],[]],d=[[],[]],p=[];function f(t){var e=t.getVisual("symbolSize");return e instanceof Array&&(e=(e[0]+e[1])/2),e}l/=2,t.eachEdge(function(t,e){var i=t.getLayout(),n=t.getVisual("fromSymbol"),r=t.getVisual("toSymbol");i.__original||(i.__original=[Ha.clone(i[0]),Ha.clone(i[1])],i[2]&&i.__original.push(Ha.clone(i[2])));var o=i.__original;if(null!=i[2]){if(Ha.copy(u[0],o[0]),Ha.copy(u[1],o[2]),Ha.copy(u[2],o[1]),n&&"none"!=n){var a=f(t.node1),s=FS(u,o[0],a*l);c(u[0][0],u[1][0],u[2][0],s,h),u[0][0]=h[3],u[1][0]=h[4],c(u[0][1],u[1][1],u[2][1],s,h),u[0][1]=h[3],u[1][1]=h[4]}r&&"none"!=r&&(a=f(t.node2),s=FS(u,o[1],a*l),c(u[0][0],u[1][0],u[2][0],s,h),u[1][0]=h[1],u[2][0]=h[2],c(u[0][1],u[1][1],u[2][1],s,h),u[1][1]=h[1],u[2][1]=h[2]),Ha.copy(i[0],u[0]),Ha.copy(i[1],u[2]),Ha.copy(i[2],u[1])}else Ha.copy(d[0],o[0]),Ha.copy(d[1],o[1]),Ha.sub(p,d[1],d[0]),Ha.normalize(p,p),n&&"none"!=n&&(a=f(t.node1),Ha.scaleAndAdd(d[0],d[0],p,a*l)),r&&"none"!=r&&(a=f(t.node2),Ha.scaleAndAdd(d[1],d[1],p,-a*l)),Ha.copy(i[0],d[0]),Ha.copy(i[1],d[1])})},VS=eb.onIrrelevantElement,HS=["itemStyle","normal","opacity"],US=["lineStyle","normal","opacity"];function WS(t,e){return t.getVisual("opacity")||t.getModel().get(e)}function jS(t,e,i){var n=t.getGraphicEl(),r=WS(t,e);null!=i&&(null==r&&(r=1),r*=i),n.downplay&&n.downplay(),n.traverse(function(t){"group"!==t.type&&t.setStyle("opacity",r)})}function ZS(t,e){var i=WS(t,e),n=t.getGraphicEl();n.highlight&&n.highlight(),n.traverse(function(t){"group"!==t.type&&t.setStyle("opacity",i)})}fy.extendChartView({type:"graph",init:function(t,e){var i=new Ry,n=new RS,r=this.group;this._controller=new Qw(e.getZr()),this._controllerHost={target:r},r.add(i.group),r.add(n.group),this._symbolDraw=i,this._lineDraw=n,this._firstRender=!0},render:function(r,t,o){var e=r.coordinateSystem;this._model=r,this._nodeScaleRatio=r.get("nodeScaleRatio");var i=this._symbolDraw,n=this._lineDraw,a=this.group;if("view"===e.type){var s={position:e.position,scale:e.scale};this._firstRender?a.attr(s):pf.updateProps(a,s,r)}GS(r.getGraph(),this._getNodeGlobalScale(r));var l=r.getData();i.updateData(l);var h=r.getEdgeData();n.updateData(h),this._updateNodeAndLinkScale(),this._updateController(r,t,o),clearTimeout(this._layoutTimeout);var c=r.forceLayout,u=r.get("force.layoutAnimation");c&&this._startForceLayoutIteration(c,u),l.eachItemGraphicEl(function(t,e){var i=l.getItemModel(e);t.off("drag").off("dragend");var n=l.getItemModel(e).get("draggable");n&&t.on("drag",function(){c&&(c.warmUp(),!this._layouting&&this._startForceLayoutIteration(c,u),c.setFixed(e),l.setItemLayout(e,t.position))},this).on("dragend",function(){c&&c.setUnfixed(e)},this),t.setDraggable(n&&c),t.off("mouseover",t.__focusNodeAdjacency),t.off("mouseout",t.__unfocusNodeAdjacency),i.get("focusNodeAdjacency")&&(t.on("mouseover",t.__focusNodeAdjacency=function(){o.dispatchAction({type:"focusNodeAdjacency",seriesId:r.id,dataIndex:t.dataIndex})}),t.on("mouseout",t.__unfocusNodeAdjacency=function(){o.dispatchAction({type:"unfocusNodeAdjacency",seriesId:r.id})}))},this),l.graph.eachEdge(function(t){var e=t.getGraphicEl();e.off("mouseover",e.__focusNodeAdjacency),e.off("mouseout",e.__unfocusNodeAdjacency),t.getModel().get("focusNodeAdjacency")&&(e.on("mouseover",e.__focusNodeAdjacency=function(){o.dispatchAction({type:"focusNodeAdjacency",seriesId:r.id,edgeDataIndex:t.dataIndex})}),e.on("mouseout",e.__unfocusNodeAdjacency=function(){o.dispatchAction({type:"unfocusNodeAdjacency",seriesId:r.id})}))});var d="circular"===r.get("layout")&&r.get("circular.rotateLabel"),p=l.getLayout("cx"),f=l.getLayout("cy");l.eachItemGraphicEl(function(t,e){var i=t.getSymbolPath();if(d){var n=l.getItemLayout(e),r=Math.atan2(n[1]-f,n[0]-p);r<0&&(r=2*Math.PI+r);var o=n[0]<p;o&&(r-=Math.PI);var a=o?"left":"right";i.setStyle({textRotation:-r,textPosition:a,textOrigin:"center"}),i.hoverStyle&&(i.hoverStyle.textPosition=a)}else i.setStyle({textRotation:0})}),this._firstRender=!1},dispose:function(){this._controller&&this._controller.dispose(),this._controllerHost={}},focusNodeAdjacency:function(t,e,i,n){var r=this._model.getData().graph,o=n.dataIndex,a=n.edgeDataIndex,s=r.getNodeByIndex(o),l=r.getEdgeByIndex(a);(s||l)&&(r.eachNode(function(t){jS(t,HS,.1)}),r.eachEdge(function(t){jS(t,US,.1)}),s&&(ZS(s,HS),za.each(s.edges,function(t){t.dataIndex<0||(ZS(t,US),ZS(t.node1,HS),ZS(t.node2,HS))})),l&&(ZS(l,US),ZS(l.node1,HS),ZS(l.node2,HS)))},unfocusNodeAdjacency:function(t,e,i,n){var r=this._model.getData().graph;r.eachNode(function(t){jS(t,HS)}),r.eachEdge(function(t){jS(t,US)})},_startForceLayoutIteration:function(t,i){var n=this;!function e(){t.step(function(t){n.updateLayout(n._model),(n._layouting=!t)&&(i?n._layoutTimeout=setTimeout(e,16):e())})}()},_updateController:function(r,t,o){var e=this._controller,n=this._controllerHost,a=this.group;e.setPointerChecker(function(t,e,i){var n=a.getBoundingRect();return n.applyTransform(a.transform),n.contain(e,i)&&!VS(t,o,r)}),"view"===r.coordinateSystem.type?(e.enable(r.get("roam")),n.zoomLimit=r.get("scaleLimit"),n.zoom=r.coordinateSystem.getZoom(),e.off("pan").off("zoom").on("pan",function(t,e){$w.updateViewOnPan(n,t,e),o.dispatchAction({seriesId:r.id,type:"graphRoam",dx:t,dy:e})}).on("zoom",function(t,e,i){$w.updateViewOnZoom(n,t,e,i),o.dispatchAction({seriesId:r.id,type:"graphRoam",zoom:t,originX:e,originY:i}),this._updateNodeAndLinkScale(),GS(r.getGraph(),this._getNodeGlobalScale(r)),this._lineDraw.updateLayout()},this)):e.disable()},_updateNodeAndLinkScale:function(){var t=this._model,e=t.getData(),i=this._getNodeGlobalScale(t),n=[i,i];e.eachItemGraphicEl(function(t,e){t.attr("scale",n)})},_getNodeGlobalScale:function(t){var e=t.coordinateSystem;if("view"!==e.type)return 1;var i=this._nodeScaleRatio,n=e.scale,r=n&&n[0]||1;return((e.getZoom()-1)*i+1)/r},updateLayout:function(t){GS(t.getGraph(),this._getNodeGlobalScale(t)),this._symbolDraw.updateLayout(),this._lineDraw.updateLayout()},remove:function(t,e){this._symbolDraw&&this._symbolDraw.remove(),this._lineDraw&&this._lineDraw.remove()}});var XS=sb.updateCenterAndZoom;fy.registerAction({type:"graphRoam",event:"graphRoam",update:"none"},function(n,t){t.eachComponent({mainType:"series",query:n},function(t){var e=t.coordinateSystem,i=XS(e,n);t.setCenter&&t.setCenter(i.center),t.setZoom&&t.setZoom(i.zoom)})}),fy.registerAction({type:"focusNodeAdjacency",event:"focusNodeAdjacency",update:"series.graph:focusNodeAdjacency"},function(){}),fy.registerAction({type:"unfocusNodeAdjacency",event:"unfocusNodeAdjacency",update:"series.graph:unfocusNodeAdjacency"},function(){});var qS=function(t){var o=t.findComponents({mainType:"legend"});o&&o.length&&t.eachSeriesByType("graph",function(t){var e=t.getCategoriesData(),n=t.getGraph().data,r=e.mapArray(e.getName);n.filterSelf(function(t){var e=n.getItemModel(t).getShallow("category");if(null!=e){"number"==typeof e&&(e=r[e]);for(var i=0;i<o.length;i++)if(!o[i].isSelected(e))return!1}return!0})},this)};var YS=function(t){var a={};t.eachSeriesByType("graph",function(n){var r=n.getCategoriesData(),i=n.getData(),o={};r.each(function(t){var e=r.getName(t);o["ec-"+e]=t;var i=r.getItemModel(t).get("itemStyle.normal.color")||n.getColorFromPalette(e,a);r.setItemVisual(t,"color",i)}),r.count()&&i.each(function(t){var e=i.getItemModel(t).getShallow("category");null!=e&&("string"==typeof e&&(e=o["ec-"+e]),i.getItemVisual(t,"color",!0)||i.setItemVisual(t,"color",r.getItemVisual(e,"color")))})})};function JS(t){return t instanceof Array||(t=[t,t]),t}var KS=function(t){t.eachSeriesByType("graph",function(t){var s=t.getGraph(),l=t.getEdgeData(),e=JS(t.get("edgeSymbol")),i=JS(t.get("edgeSymbolSize")),h="lineStyle.normal.color".split("."),c="lineStyle.normal.opacity".split(".");l.setVisual("fromSymbol",e&&e[0]),l.setVisual("toSymbol",e&&e[1]),l.setVisual("fromSymbolSize",i&&i[0]),l.setVisual("toSymbolSize",i&&i[1]),l.setVisual("color",t.get(h)),l.setVisual("opacity",t.get(c)),l.each(function(t){var e=l.getItemModel(t),i=s.getEdgeByIndex(t),n=JS(e.getShallow("symbol",!0)),r=JS(e.getShallow("symbolSize",!0)),o=e.get(h),a=e.get(c);switch(o){case"source":o=i.node1.getVisual("color");break;case"target":o=i.node2.getVisual("color")}n[0]&&i.setVisual("fromSymbol",n[0]),n[1]&&i.setVisual("toSymbol",n[1]),r[0]&&i.setVisual("fromSymbolSize",r[0]),r[1]&&i.setVisual("toSymbolSize",r[1]),i.setVisual("color",o),i.setVisual("opacity",a)})})};function QS(t){t.eachEdge(function(t){var e=t.getModel().get("lineStyle.normal.curveness")||0,i=Ha.clone(t.node1.getLayout()),n=Ha.clone(t.node2.getLayout()),r=[i,n];+e&&r.push([(i[0]+n[0])/2-(i[1]-n[1])*e,(i[1]+n[1])/2-(n[0]-i[0])*e]),t.setLayout(r)})}var $S={simpleLayout:function(t){var e=t.coordinateSystem;if(!e||"view"===e.type){var i=t.getGraph();i.eachNode(function(t){var e=t.getModel();t.setLayout([+e.get("x"),+e.get("y")])}),QS(i)}},simpleLayoutEdge:QS},tT=$S.simpleLayout,eT=$S.simpleLayoutEdge;var iT=function(t,e){t.eachSeriesByType("graph",function(t){var e=t.get("layout"),o=t.coordinateSystem;if(o&&"view"!==o.type){var a=t.getData(),s=o.dimensions;a.each(s,function(){for(var t,e=arguments,i=[],n=0;n<s.length;n++)isNaN(e[n])||(t=!0),i.push(e[n]);var r=e[e.length-1];t?a.setItemLayout(r,o.dataToPoint(i)):a.setItemLayout(r,[NaN,NaN])}),eT(a.graph)}else e&&"none"!==e||tT(t)})};var nT={circularLayout:function(t){var e=t.coordinateSystem;if(!e||"view"===e.type){var i=e.getBoundingRect(),n=t.getData(),r=n.graph,o=0,a=n.getSum("value"),s=2*Math.PI/(a||n.count()),l=i.width/2+i.x,h=i.height/2+i.y,c=Math.min(i.width,i.height)/2;r.eachNode(function(t){var e=t.getValue("value");o+=s*(a?e:1)/2,t.setLayout([c*Math.cos(o)+l,c*Math.sin(o)+h]),o+=s*(a?e:1)/2}),n.setLayout({cx:l,cy:h}),r.eachEdge(function(t){var e,i=t.getModel().get("lineStyle.normal.curveness")||0,n=Ha.clone(t.node1.getLayout()),r=Ha.clone(t.node2.getLayout()),o=(n[0]+r[0])/2,a=(n[1]+r[1])/2;+i&&(e=[l*(i*=3)+o*(1-i),h*i+a*(1-i)]),t.setLayout([n,r,e])})}}},rT=nT.circularLayout;var oT=function(t){t.eachSeriesByType("graph",function(t){"circular"===t.get("layout")&&rT(t)})},aT=Ha.scaleAndAdd;var sT={forceLayout:function(p,f,t){for(var e=t.rect,i=e.width,n=e.height,g=[e.x+i/2,e.y+n/2],m=null==t.gravity?.1:t.gravity,r=0;r<p.length;r++){var o=p[r];o.p||(o.p=Ha.create(i*(Math.random()-.5)+g[0],n*(Math.random()-.5)+g[1])),o.pp=Ha.clone(o.p),o.edges=null}var v=.6;return{warmUp:function(){v=.5},setFixed:function(t){p[t].fixed=!0},setUnfixed:function(t){p[t].fixed=!1},step:function(t){for(var e=[],i=p.length,n=0;n<f.length;n++){var r=f[n],o=r.n1,a=r.n2;Ha.sub(e,a.p,o.p);var s=Ha.len(e)-r.d,l=a.w/(o.w+a.w);isNaN(l)&&(l=0),Ha.normalize(e,e),!o.fixed&&aT(o.p,o.p,e,l*s*v),!a.fixed&&aT(a.p,a.p,e,-(1-l)*s*v)}for(n=0;n<i;n++)(d=p[n]).fixed||(Ha.sub(e,g,d.p),aT(d.p,d.p,e,m*v));for(n=0;n<i;n++){o=p[n];for(var h=n+1;h<i;h++){a=p[h],Ha.sub(e,a.p,o.p),0===(s=Ha.len(e))&&(Ha.set(e,Math.random()-.5,Math.random()-.5),s=1);var c=(o.rep+a.rep)/s/s;!o.fixed&&aT(o.pp,o.pp,e,c),!a.fixed&&aT(a.pp,a.pp,e,-c)}}var u=[];for(n=0;n<i;n++){var d;(d=p[n]).fixed||(Ha.sub(u,d.p,d.pp),aT(d.p,d.p,u,v),Ha.copy(d.pp,d.p))}v*=.992,t&&t(p,f,v<.01)}}}}.forceLayout,lT=$S.simpleLayout,hT=nT.circularLayout,cT=Uc.linearMap;var uT=function(t){t.eachSeriesByType("graph",function(t){if(!(l=t.coordinateSystem)||"view"===l.type)if("force"===t.get("layout")){var u=t.preservedPoints||{},d=t.getGraph(),p=d.data,e=d.edgeData,i=t.getModel("force"),n=i.get("initLayout");t.preservedPoints?p.each(function(t){var e=p.getId(t);p.setItemLayout(t,u[e]||[NaN,NaN])}):n&&"none"!==n?"circular"===n&&hT(t):lT(t);var r=p.getDataExtent("value"),o=e.getDataExtent("value"),a=i.get("repulsion"),s=i.get("edgeLength");za.isArray(a)||(a=[a,a]),za.isArray(s)||(s=[s,s]),s=[s[1],s[0]];var l,h=p.mapArray("value",function(t,e){var i=p.getItemLayout(e),n=cT(t,r,a);return isNaN(n)&&(n=(a[0]+a[1])/2),{w:n,rep:n,fixed:p.getItemModel(e).get("fixed"),p:!i||isNaN(i[0])||isNaN(i[1])?null:i}}),c=e.mapArray("value",function(t,e){var i=d.getEdgeByIndex(e),n=cT(t,o,s);return isNaN(n)&&(n=(s[0]+s[1])/2),{n1:h[i.node1.dataIndex],n2:h[i.node2.dataIndex],d:n,curveness:i.getModel().get("lineStyle.normal.curveness")||0}}),f=(l=t.coordinateSystem).getBoundingRect(),g=sT(h,c,{rect:f,gravity:i.get("gravity")}),m=g.step;g.step=function(c){for(var t=0,e=h.length;t<e;t++)h[t].fixed&&Ha.copy(h[t].p,d.getNodeByIndex(t).getLayout());m(function(t,e,i){for(var n=0,r=t.length;n<r;n++)t[n].fixed||d.getNodeByIndex(n).setLayout(t[n].p),u[p.getId(n)]=t[n].p;for(n=0,r=e.length;n<r;n++){var o=e[n],a=d.getEdgeByIndex(n),s=o.n1.p,l=o.n2.p,h=a.getLayout();(h=h?h.slice():[])[0]=h[0]||[],h[1]=h[1]||[],Ha.copy(h[0],s),Ha.copy(h[1],l),+o.curveness&&(h[2]=[(s[0]+l[0])/2-(s[1]-l[1])*o.curveness,(s[1]+l[1])/2-(l[0]-s[0])*o.curveness]),a.setLayout(h)}c&&c(i)})},t.forceLayout=g,t.preservedPoints=u,g.step()}else t.forceLayout=null})},dT=jf.getLayoutRect;var pT=function(t,m){var v=[];return t.eachSeriesByType("graph",function(t){var e,i,n,r=t.get("coordinateSystem");if(!r||"view"===r){var o=t.getData(),a=o.mapArray(function(t){var e=o.getItemModel(t);return[+e.get("x"),+e.get("y")]}),s=[],l=[];Ru.fromPoints(a,s,l),l[0]-s[0]==0&&(l[0]+=1,s[0]-=1),l[1]-s[1]==0&&(l[1]+=1,s[1]-=1);var h=(l[0]-s[0])/(l[1]-s[1]),c=(e=m,i=h,(n=t.getBoxLayoutParams()).aspect=i,dT(n,{width:e.getWidth(),height:e.getHeight()}));isNaN(h)&&(s=[c.x,c.y],l=[c.x+c.width,c.y+c.height]);var u=l[0]-s[0],d=l[1]-s[1],p=c.width,f=c.height,g=t.coordinateSystem=new bw;g.zoomLimit=t.get("scaleLimit"),g.setBoundingRect(s[0],s[1],u,d),g.setViewRect(c.x,c.y,p,f),g.setCenter(t.get("center")),g.setZoom(t.get("zoom")),v.push(g)}}),v};fy.registerProcessor(qS),fy.registerVisual(za.curry(e_,"graph","circle",null)),fy.registerVisual(YS),fy.registerVisual(KS),fy.registerLayout(iT),fy.registerLayout(oT),fy.registerLayout(uT),fy.registerCoordinateSystem("graphView",{create:pT});Qg.extend({type:"series.gauge",getInitialData:function(t,e){var i=new Im(["value"],this),n=t.data||[];return za.isArray(n)||(n=[n]),i.initData(n),i},defaultOption:{zlevel:0,z:2,center:["50%","50%"],legendHoverLink:!0,radius:"75%",startAngle:225,endAngle:-45,clockwise:!0,min:0,max:100,splitNumber:10,axisLine:{show:!0,lineStyle:{color:[[.2,"#91c7ae"],[.8,"#63869e"],[1,"#c23531"]],width:30}},splitLine:{show:!0,length:30,lineStyle:{color:"#eee",width:2,type:"solid"}},axisTick:{show:!0,splitNumber:5,length:8,lineStyle:{color:"#eee",width:1,type:"solid"}},axisLabel:{show:!0,distance:5,color:"auto"},pointer:{show:!0,length:"80%",width:8},itemStyle:{normal:{color:"auto"}},title:{show:!0,offsetCenter:[0,"-40%"],color:"#333",fontSize:15},detail:{show:!0,backgroundColor:"rgba(0,0,0,0)",borderWidth:0,borderColor:"#ccc",width:100,height:null,padding:[5,10],offsetCenter:[0,"40%"],color:"auto",fontSize:30}}});var fT=_d.extend({type:"echartsGaugePointer",shape:{angle:0,width:10,r:10,x:0,y:0},buildPath:function(t,e){var i=Math.cos,n=Math.sin,r=e.r,o=e.width,a=e.angle,s=e.x-i(a)*o*(r/3<=o?1:2),l=e.y-n(a)*o*(r/3<=o?1:2);a=e.angle-Math.PI/2,t.moveTo(s,l),t.lineTo(e.x+i(a)*o,e.y+n(a)*o),t.lineTo(e.x+i(e.angle)*r,e.y+n(e.angle)*r),t.lineTo(e.x-i(a)*o,e.y-n(a)*o),t.lineTo(s,l)}}),gT=Uc.parsePercent,mT=Uc.round,vT=Uc.linearMap;function yT(t,e){return e&&("string"==typeof e?t=e.replace("{value}",null!=t?t:""):"function"==typeof e&&(t=e(t))),t}var _T=2*Math.PI,xT=(am.extend({type:"gauge",render:function(t,e,i){this.group.removeAll();var n,r,o,a,s,l,h=t.get("axisLine.lineStyle.color"),c=(r=i,o=(n=t).get("center"),a=r.getWidth(),s=r.getHeight(),l=Math.min(a,s),{cx:gT(o[0],r.getWidth()),cy:gT(o[1],r.getHeight()),r:gT(n.get("radius"),l/2)});this._renderMain(t,e,i,h,c)},dispose:function(){},_renderMain:function(t,e,i,n,r){for(var o=this.group,a=t.getModel("axisLine").getModel("lineStyle"),s=t.get("clockwise"),l=-t.get("startAngle")/180*Math.PI,h=((p=-t.get("endAngle")/180*Math.PI)-l)%_T,c=l,u=a.get("width"),d=0;d<n.length;d++){var p=l+h*Math.min(Math.max(n[d][0],0),1),f=new pf.Sector({shape:{startAngle:c,endAngle:p,cx:r.cx,cy:r.cy,clockwise:s,r0:r.r-u,r:r.r},silent:!0});f.setStyle({fill:n[d][1]}),f.setStyle(a.getLineStyle(["color","borderWidth","borderColor"])),o.add(f),c=p}var g=function(t){if(t<=0)return n[0][1];for(var e=0;e<n.length;e++)if(n[e][0]>=t&&(0===e?0:n[e-1][0])<t)return n[e][1];return n[e-1][1]};if(!s){var m=l;l=p,p=m}this._renderTicks(t,e,i,g,r,l,p,s),this._renderPointer(t,e,i,g,r,l,p,s),this._renderTitle(t,e,i,g,r),this._renderDetail(t,e,i,g,r)},_renderTicks:function(t,e,i,n,r,o,a,s){for(var l=this.group,h=r.cx,c=r.cy,u=r.r,d=+t.get("min"),p=+t.get("max"),f=t.getModel("splitLine"),g=t.getModel("axisTick"),m=t.getModel("axisLabel"),v=t.get("splitNumber"),y=g.get("splitNumber"),_=gT(f.get("length"),u),x=gT(g.get("length"),u),w=o,b=(a-o)/v,M=b/y,S=f.getModel("lineStyle").getLineStyle(),T=g.getModel("lineStyle").getLineStyle(),C=0;C<=v;C++){var A=Math.cos(w),E=Math.sin(w);if(f.get("show")){var P=new pf.Line({shape:{x1:A*u+h,y1:E*u+c,x2:A*(u-_)+h,y2:E*(u-_)+c},style:S,silent:!0});"auto"===S.stroke&&P.setStyle({stroke:n(C/v)}),l.add(P)}if(m.get("show")){var L=yT(mT(C/v*(p-d)+d),m.get("formatter")),I=m.get("distance"),R=n(C/v);l.add(new pf.Text({style:pf.setTextStyle({},m,{text:L,x:A*(u-_-I)+h,y:E*(u-_-I)+c,textVerticalAlign:E<-.4?"top":.4<E?"bottom":"middle",textAlign:A<-.4?"left":.4<A?"right":"center"},{autoColor:R}),silent:!0}))}if(g.get("show")&&C!==v){for(var D=0;D<=y;D++){A=Math.cos(w),E=Math.sin(w);var O=new pf.Line({shape:{x1:A*u+h,y1:E*u+c,x2:A*(u-x)+h,y2:E*(u-x)+c},silent:!0,style:T});"auto"===T.stroke&&O.setStyle({stroke:n((C+D/y)/v)}),l.add(O),w+=M}w-=M}else w+=b}},_renderPointer:function(n,t,e,r,o,i,a,s){var l=this.group,h=this._data;if(n.get("pointer.show")){var c=[+n.get("min"),+n.get("max")],u=[i,a],d=n.getData();d.diff(h).add(function(t){var e=new fT({shape:{angle:i}});pf.initProps(e,{shape:{angle:vT(d.get("value",t),c,u,!0)}},n),l.add(e),d.setItemGraphicEl(t,e)}).update(function(t,e){var i=h.getItemGraphicEl(e);pf.updateProps(i,{shape:{angle:vT(d.get("value",t),c,u,!0)}},n),l.add(i),d.setItemGraphicEl(t,i)}).remove(function(t){var e=h.getItemGraphicEl(t);l.remove(e)}).execute(),d.eachItemGraphicEl(function(t,e){var i=d.getItemModel(e),n=i.getModel("pointer");t.setShape({x:o.cx,y:o.cy,width:gT(n.get("width"),o.r),r:gT(n.get("length"),o.r)}),t.useStyle(i.getModel("itemStyle.normal").getItemStyle()),"auto"===t.style.fill&&t.setStyle("fill",r(vT(d.get("value",e),c,[0,1],!0))),pf.setHoverStyle(t,i.getModel("itemStyle.emphasis").getItemStyle())}),this._data=d}else h&&h.eachItemGraphicEl(function(t){l.remove(t)})},_renderTitle:function(t,e,i,n,r){var o=t.getModel("title");if(o.get("show")){var a=o.get("offsetCenter"),s=r.cx+gT(a[0],r.r),l=r.cy+gT(a[1],r.r),h=+t.get("min"),c=+t.get("max"),u=t.getData().get("value",0),d=n(vT(u,[h,c],[0,1],!0));this.group.add(new pf.Text({silent:!0,style:pf.setTextStyle({},o,{x:s,y:l,text:t.getData().getName(0),textAlign:"center",textVerticalAlign:"middle"},{autoColor:d,forceRich:!0})}))}},_renderDetail:function(t,e,i,n,r){var o=t.getModel("detail"),a=+t.get("min"),s=+t.get("max");if(o.get("show")){var l=o.get("offsetCenter"),h=r.cx+gT(l[0],r.r),c=r.cy+gT(l[1],r.r),u=gT(o.get("width"),r.r),d=gT(o.get("height"),r.r),p=t.getData().get("value",0),f=n(vT(p,[a,s],[0,1],!0));this.group.add(new pf.Text({silent:!0,style:pf.setTextStyle({},o,{x:h,y:c,text:yT(p,o.get("formatter")),textWidth:isNaN(u)?null:u,textHeight:isNaN(d)?null:d,textAlign:"center",textVerticalAlign:"middle"},{autoColor:f,forceRich:!0})}))}}}),If.defaultEmphasis),wT=fy.extendSeriesModel({type:"series.funnel",init:function(t){wT.superApply(this,"init",arguments),this.legendDataProvider=function(){return this.getRawData()},this._defaultLabelLine(t)},getInitialData:function(t,e){var i=Gm(["value"],t.data),n=new Im(i,this);return n.initData(t.data),n},_defaultLabelLine:function(t){xT(t.labelLine,["show"]);var e=t.labelLine.normal,i=t.labelLine.emphasis;e.show=e.show&&t.label.normal.show,i.show=i.show&&t.label.emphasis.show},getDataParams:function(t){var e=this.getData(),i=wT.superCall(this,"getDataParams",t),n=e.getSum("value");return i.percent=n?+(e.get("value",t)/n*100).toFixed(2):0,i.$vars.push("percent"),i},defaultOption:{zlevel:0,z:2,legendHoverLink:!0,left:80,top:60,right:80,bottom:60,minSize:"0%",maxSize:"100%",sort:"descending",gap:0,funnelAlign:"center",label:{normal:{show:!0,position:"outer"},emphasis:{show:!0}},labelLine:{normal:{show:!0,length:20,lineStyle:{width:1,type:"solid"}},emphasis:{}},itemStyle:{normal:{borderColor:"#fff",borderWidth:1},emphasis:{}}}});function bT(t,e){pf.Group.call(this);var i=new pf.Polygon,n=new pf.Polyline,r=new pf.Text;function o(){n.ignore=n.hoverIgnore,r.ignore=r.hoverIgnore}function a(){n.ignore=n.normalIgnore,r.ignore=r.normalIgnore}this.add(i),this.add(n),this.add(r),this.updateData(t,e,!0),this.on("emphasis",o).on("normal",a).on("mouseover",o).on("mouseout",a)}var MT=bT.prototype,ST=["itemStyle","normal","opacity"];MT.updateData=function(t,e,i){var n=this.childAt(0),r=t.hostModel,o=t.getItemModel(e),a=t.getItemLayout(e),s=t.getItemModel(e).get(ST);s=null==s?1:s,n.useStyle({}),i?(n.setShape({points:a.points}),n.setStyle({opacity:0}),pf.initProps(n,{style:{opacity:s}},r,e)):pf.updateProps(n,{style:{opacity:s},shape:{points:a.points}},r,e);var l=o.getModel("itemStyle"),h=t.getItemVisual(e,"color");n.setStyle(za.defaults({lineJoin:"round",fill:h},l.getModel("normal").getItemStyle(["opacity"]))),n.hoverStyle=l.getModel("emphasis").getItemStyle(),this._updateLabel(t,e),pf.setHoverStyle(this)},MT._updateLabel=function(t,e){var i=this.childAt(1),n=this.childAt(2),r=t.hostModel,o=t.getItemModel(e),a=t.getItemLayout(e).label,s=t.getItemVisual(e,"color");pf.updateProps(i,{shape:{points:a.linePoints||a.linePoints}},r,e),pf.updateProps(n,{style:{x:a.x,y:a.y}},r,e),n.attr({rotation:a.rotation,origin:[a.x,a.y],z2:10});var l=o.getModel("label.normal"),h=o.getModel("label.emphasis"),c=o.getModel("labelLine.normal"),u=o.getModel("labelLine.emphasis");s=t.getItemVisual(e,"color");pf.setLabelStyle(n.style,n.hoverStyle={},l,h,{labelFetcher:t.hostModel,labelDataIndex:e,defaultText:t.getName(e),autoColor:s,useInsideStyle:!!a.inside},{textAlign:a.textAlign,textVerticalAlign:a.verticalAlign}),n.ignore=n.normalIgnore=!l.get("show"),n.hoverIgnore=!h.get("show"),i.ignore=i.normalIgnore=!c.get("show"),i.hoverIgnore=!u.get("show"),i.setStyle({stroke:s}),i.setStyle(c.getModel("lineStyle").getLineStyle()),i.hoverStyle=u.getModel("lineStyle").getLineStyle()},za.inherits(bT,pf.Group);am.extend({type:"funnel",render:function(t,e,i){var n=t.getData(),r=this._data,o=this.group;n.diff(r).add(function(t){var e=new bT(n,t);n.setItemGraphicEl(t,e),o.add(e)}).update(function(t,e){var i=r.getItemGraphicEl(e);i.updateData(n,t),o.add(i),n.setItemGraphicEl(t,i)}).remove(function(t){var e=r.getItemGraphicEl(t);o.remove(e)}).execute(),this._data=n},remove:function(){this.group.removeAll(),this._data=null},dispose:function(){}});var TT=Uc.parsePercent,CT=Uc.linearMap;var AT=function(t,b,e){t.eachSeriesByType("funnel",function(t){var e,i,o=t.getData(),n=t.get("sort"),a=(e=t,i=b,jf.getLayoutRect(e.getBoxLayoutParams(),{width:i.getWidth(),height:i.getHeight()})),r=function(t,e){for(var i=t.mapArray("value",function(t){return t}),n=[],r="ascending"===e,o=0,a=t.count();o<a;o++)n[o]=o;return"function"==typeof e?n.sort(e):"none"!==e&&n.sort(function(t,e){return r?i[t]-i[e]:i[e]-i[t]}),n}(o,n),s=[TT(t.get("minSize"),a.width),TT(t.get("maxSize"),a.width)],l=o.getDataExtent("value"),h=t.get("min"),c=t.get("max");null==h&&(h=Math.min(l[0],0)),null==c&&(c=l[1]);var g,u=t.get("funnelAlign"),d=t.get("gap"),p=(a.height-d*(o.count()-1))/o.count(),f=a.y,m=function(t,e){var i,n=o.get("value",t)||0,r=CT(n,[h,c],s,!0);switch(u){case"left":i=a.x;break;case"center":i=a.x+(a.width-r)/2;break;case"right":i=a.x+a.width-r}return[[i,e],[i+r,e]]};"ascending"===n&&(p=-p,d=-d,f+=a.height,r=r.reverse());for(var v=0;v<r.length;v++){var y=r[v],_=r[v+1],x=m(y,f),w=m(_,f+p);f+=p+d,o.setItemLayout(y,{points:x.concat(w.slice().reverse())})}(g=o).each(function(t){var e,i,n,r,o=g.getItemModel(t),a=o.getModel("label.normal").get("position"),s=o.getModel("labelLine.normal"),l=g.getItemLayout(t),h=l.points,c="inner"===a||"inside"===a||"center"===a;if(c)e="center",r=[[i=(h[0][0]+h[1][0]+h[2][0]+h[3][0])/4,n=(h[0][1]+h[1][1]+h[2][1]+h[3][1])/4],[i,n]];else{var u,d,p,f=s.get("length");"left"===a?(u=(h[3][0]+h[0][0])/2,d=(h[3][1]+h[0][1])/2,i=(p=u-f)-5,e="right"):(u=(h[1][0]+h[2][0])/2,d=(h[1][1]+h[2][1])/2,i=(p=u+f)+5,e="left"),r=[[u,d],[p,d]],n=d}l.label={linePoints:r,x:i,y:n,verticalAlign:"middle",textAlign:e,inside:c}})})};fy.registerVisual(za.curry(Zx,"funnel")),fy.registerLayout(AT),fy.registerProcessor(za.curry(tw,"funnel"));var ET=function(t){var n,e;!function(t){if(!t.parallel){var e=!1;za.each(t.series,function(t){t&&"parallel"===t.type&&(e=!0)}),e&&(t.parallel=[{}])}}(t),n=t,e=If.normalizeToArray(n.parallelAxis),za.each(e,function(t){if(za.isObject(t)){var e=t.parallelIndex||0,i=If.normalizeToArray(n.parallel)[e];i&&i.parallelAxisDefault&&za.merge(t,i.parallelAxisDefault,!1)}})},PT=function(t,e,i,n,r){Wv.call(this,t,e,i),this.type=n||"value",this.axisIndex=r};PT.prototype={constructor:PT,model:null,isHorizontal:function(){return"horizontal"!==this.coordinateSystem.getModel().get("layout")}},za.inherits(PT,Wv);var LT=PT;function IT(t,e){var i=t[e]-t[1-e];return{span:Math.abs(i),sign:0<i?-1:i<0?1:e?-1:1}}function RT(t,e){return Math.min(e[1],Math.max(e[0],t))}var DT=function(t,e,i,n,r,o){e[0]=RT(e[0],i),e[1]=RT(e[1],i),t=t||0;var a=i[1]-i[0];null!=r&&(r=RT(r,[0,a])),null!=o&&(o=Math.max(o,null!=r?r:0)),"all"===n&&(r=o=Math.abs(e[1]-e[0]),n=0);var s=IT(e,n);e[n]+=t;var l=r||0,h=i.slice();s.sign<0?h[0]+=l:h[1]-=l,e[n]=RT(e[n],h);var c=IT(e,n);return null!=r&&(c.sign!==s.sign||c.span<r)&&(e[1-n]=e[n]+s.sign*r),c=IT(e,n),null!=o&&c.span>o&&(e[1-n]=e[n]+c.sign*o),e},OT=za.each,kT=Math.min,zT=Math.max,NT=Math.floor,BT=Math.ceil,FT=Uc.round,GT=Math.PI;function VT(t,e,i){this._axesMap=za.createHashMap(),this._axesLayout={},this.dimensions=t.dimensions,this._rect,this._model=t,this._init(t,e,i)}function HT(t,e){return kT(zT(t,e[0]),e[1])}VT.prototype={type:"parallel",constructor:VT,_init:function(t,a,e){var i=t.dimensions,s=t.parallelAxisIndex;OT(i,function(t,e){var i=s[e],n=a.getComponent("parallelAxis",i),r=this._axesMap.set(t,new LT(t,Cv.createScaleByModel(n),[0,0],n.get("type"),i)),o="category"===r.type;r.onBand=o&&n.get("boundaryGap"),r.inverse=n.get("inverse"),(n.axis=r).model=n,r.coordinateSystem=n.coordinateSystem=this},this)},update:function(t,e){this._updateAxesFromSeries(this._model,t)},containPoint:function(t){var e=this._makeLayoutInfo(),i=e.axisBase,n=e.layoutBase,r=e.pixelDimIndex,o=t[1-r],a=t[r];return i<=o&&o<=i+e.axisLength&&n<=a&&a<=n+e.layoutLength},getModel:function(){return this._model},_updateAxesFromSeries:function(e,n){n.eachSeries(function(t){if(e.contains(t,n)){var i=t.getData();OT(this.dimensions,function(t){var e=this._axesMap.get(t);e.scale.unionExtentFromData(i,t),Cv.niceScaleExtent(e.scale,e.model)},this)}},this)},resize:function(t,e){this._rect=jf.getLayoutRect(t.getBoxLayoutParams(),{width:e.getWidth(),height:e.getHeight()}),this._layoutAxes()},getRect:function(){return this._rect},_makeLayoutInfo:function(){var t,e=this._model,i=this._rect,n=["x","y"],r=["width","height"],o=e.get("layout"),a="horizontal"===o?0:1,s=i[r[a]],l=[0,s],h=this.dimensions.length,c=HT(e.get("axisExpandWidth"),l),u=HT(e.get("axisExpandCount")||0,[0,h]),d=e.get("axisExpandable")&&3<h&&u<h&&1<u&&0<c&&0<s,p=e.get("axisExpandWindow");p?(t=HT(p[1]-p[0],l),p[1]=p[0]+t):(t=HT(c*(u-1),l),(p=[c*(e.get("axisExpandCenter")||NT(h/2))-t/2])[1]=p[0]+t);var f=(s-t)/(h-u);f<3&&(f=0);var g=[NT(FT(p[0]/c,1))+1,BT(FT(p[1]/c,1))-1],m=f/c*p[0];return{layout:o,pixelDimIndex:a,layoutBase:i[n[a]],layoutLength:s,axisBase:i[n[1-a]],axisLength:i[r[1-a]],axisExpandable:d,axisExpandWidth:c,axisCollapseWidth:f,axisExpandWindow:p,axisCount:h,winInnerIndices:g,axisExpandWindow0Pos:m}},_layoutAxes:function(){var l=this._rect,h=this._axesMap,t=this.dimensions,c=this._makeLayoutInfo(),u=c.layout;h.each(function(t){var e=[0,c.axisLength],i=t.inverse?1:0;t.setExtent(e[i],e[1-i])}),OT(t,function(t,e){var i=(c.axisExpandable?function(t,e){var i,n,r=e.layoutLength,o=e.axisExpandWidth,a=e.axisCount,s=e.axisCollapseWidth,l=e.winInnerIndices,h=s,c=!1;t<l[0]?(i=t*s,n=s):t<=l[1]?(i=e.axisExpandWindow0Pos+t*o-e.axisExpandWindow[0],h=o,c=!0):(i=r-(a-1-t)*s,n=s);return{position:i,axisNameAvailableWidth:h,axisLabelShow:c,nameTruncateMaxWidth:n}}:function(t,e){var i=e.layoutLength/(e.axisCount-1);return{position:i*t,axisNameAvailableWidth:i,axisLabelShow:!0}})(e,c),n={horizontal:{x:i.position,y:c.axisLength},vertical:{x:0,y:i.position}},r={horizontal:GT/2,vertical:0},o=[n[u].x+l.x,n[u].y+l.y],a=r[u],s=ns.create();ns.rotate(s,s,a),ns.translate(s,s,o),this._axesLayout[t]={position:o,rotation:a,transform:s,axisNameAvailableWidth:i.axisNameAvailableWidth,axisLabelShow:i.axisLabelShow,nameTruncateMaxWidth:i.nameTruncateMaxWidth,tickDirection:1,labelDirection:1,labelInterval:h.get(t).getLabelInterval()}},this)},getAxis:function(t){return this._axesMap.get(t)},dataToPoint:function(t,e){return this.axisCoordToPoint(this._axesMap.get(e).dataToCoord(t),e)},eachActiveState:function(t,e,i){for(var n=this.dimensions,r=this._axesMap,o=this.hasAxisBrushed(),a=0,s=t.count();a<s;a++){var l,h=t.getValues(n,a);if(o){l="active";for(var c=0,u=n.length;c<u;c++){var d=n[c];if("inactive"===r.get(d).model.getActiveState(h[c],c)){l="inactive";break}}}else l="normal";e.call(i,l,a)}},hasAxisBrushed:function(){for(var t=this.dimensions,e=this._axesMap,i=!1,n=0,r=t.length;n<r;n++)"normal"!==e.get(t[n]).model.getActiveState()&&(i=!0);return i},axisCoordToPoint:function(t,e){var i=this._axesLayout[e];return pf.applyTransform([t,0],i.transform)},getAxisLayout:function(t){return za.clone(this._axesLayout[t])},getSlidedAxisExpandWindow:function(t){var e=this._makeLayoutInfo(),i=e.pixelDimIndex,n=e.axisExpandWindow.slice(),r=n[1]-n[0],o=[0,e.axisExpandWidth*(e.axisCount-1)];if(!this.containPoint(t))return{behavior:"none",axisExpandWindow:n};var a,s=t[i]-e.layoutBase-e.axisExpandWindow0Pos,l="slide",h=e.axisCollapseWidth,c=this._model.get("axisExpandSlideTriggerArea"),u=null!=c[0];if(h)u&&h&&s<r*c[0]?(l="jump",a=s-r*c[2]):u&&h&&s>r*(1-c[0])?(l="jump",a=s-r*(1-c[2])):0<=(a=s-r*c[1])&&(a=s-r*(1-c[1]))<=0&&(a=0),(a*=e.axisExpandWidth/h)?DT(a,n,o,"all"):l="none";else{r=n[1]-n[0];(n=[zT(0,o[1]*s/r-r/2)])[1]=kT(o[1],n[0]+r),n[0]=n[1]-r}return{axisExpandWindow:n,behavior:l}}};var UT=VT;mg.register("parallel",{create:function(n,r){var o=[];return n.eachComponent("parallel",function(t,e){var i=new UT(t,n,r);i.name="parallel_"+e,i.resize(t,r),(t.coordinateSystem=i).model=t,o.push(i)}),n.eachSeries(function(t){if("parallel"===t.get("coordinateSystem")){var e=n.queryComponents({mainType:"parallel",index:t.get("parallelIndex"),id:t.get("parallelId")})[0];t.coordinateSystem=e.coordinateSystem}}),o}});var WT=Yf.extend({type:"baseParallelAxis",axis:null,activeIntervals:[],getAreaSelectStyle:function(){return nu([["fill","color"],["lineWidth","borderWidth"],["stroke","borderColor"],["width","width"],["opacity","opacity"]])(this.getModel("areaSelectStyle"))},setActiveIntervals:function(t){var e=this.activeIntervals=za.clone(t);if(e)for(var i=e.length-1;0<=i;i--)Uc.asc(e[i])},getActiveState:function(t){var e=this.activeIntervals;if(!e.length)return"normal";if(null==t)return"inactive";for(var i=0,n=e.length;i<n;i++)if(e[i][0]<=t&&t<=e[i][1])return"active";return"inactive"}});za.merge(WT.prototype,Ev),__("parallel",WT,function(t,e){return e.type||(e.data?"category":"value")},{type:"value",dim:null,areaSelectStyle:{width:20,borderWidth:1,borderColor:"rgba(160,197,232)",color:"rgba(160,197,232)",opacity:.3},realtime:!0,z:10});Yf.extend({type:"parallel",dependencies:["parallelAxis"],coordinateSystem:null,dimensions:null,parallelAxisIndex:null,layoutMode:"box",defaultOption:{zlevel:0,z:0,left:80,top:60,right:80,bottom:60,layout:"horizontal",axisExpandable:!1,axisExpandCenter:null,axisExpandCount:0,axisExpandWidth:50,axisExpandRate:17,axisExpandDebounce:50,axisExpandSlideTriggerArea:[-.15,.05,.4],axisExpandTriggerOn:"click",parallelAxisDefault:null},init:function(){Yf.prototype.init.apply(this,arguments),this.mergeOption({})},mergeOption:function(t){var e=this.option;t&&za.merge(e,t,!0),this._initDimensions()},contains:function(t,e){var i=t.get("parallelIndex");return null!=i&&e.getComponent("parallel",i)===this},setAxisExpand:function(e){za.each(["axisExpandable","axisExpandCenter","axisExpandCount","axisExpandWidth","axisExpandWindow"],function(t){e.hasOwnProperty(t)&&(this.option[t]=e[t])},this)},_initDimensions:function(){var e=this.dimensions=[],i=this.parallelAxisIndex=[],t=za.filter(this.dependentModels.parallelAxis,function(t){return(t.get("parallelIndex")||0)===this.componentIndex},this);za.each(t,function(t){e.push("dim"+t.get("dim")),i.push(t.componentIndex)})}});fy.registerAction({type:"axisAreaSelect",event:"axisAreaSelected",update:"updateVisual"},function(e,t){t.eachComponent({mainType:"parallelAxis",query:e},function(t){t.axis.model.setActiveIntervals(e.intervals)})}),fy.registerAction("parallelAxisExpand",function(e,t){t.eachComponent({mainType:"parallel",query:e},function(t){t.setAxisExpand(e)})});var jT=za.curry,ZT=za.each,XT=za.map,qT=Math.min,YT=Math.max,JT=Math.pow,KT=1e4,QT=6,$T=6,tC="globalPan",eC={w:[0,0],e:[0,1],n:[1,0],s:[1,1]},iC={w:"ew",e:"ew",n:"ns",s:"ns",ne:"nesw",sw:"nesw",nw:"nwse",se:"nwse"},nC={brushStyle:{lineWidth:2,stroke:"rgba(0,0,0,0.3)",fill:"rgba(0,0,0,0.1)"},transformable:!0,brushMode:"single",removeOnClick:!1},rC=0;function oC(t){qa.call(this),this._zr=t,this.group=new pf.Group,this._brushType,this._brushOption,this._panels,this._track=[],this._dragging,this._covers=[],this._creatingCover,this._creatingPanel,this._enableGlobalPan,this._uid="brushController_"+rC++,this._handlers={},ZT(IC,function(t,e){this._handlers[e]=za.bind(t,this)},this)}function aC(t,e){var i=DC[e.brushType].createCover(t,e);return i.__brushOption=e,hC(i,e),t.group.add(i),i}function sC(t,e){var i=uC(e);return i.endCreating&&(i.endCreating(t,e),hC(e,e.__brushOption)),e}function lC(t,e){var i=e.__brushOption;uC(e).updateCoverShape(t,e,i.range,i)}function hC(t,e){var i=e.z;null==i&&(i=KT),t.traverse(function(t){t.z=i,t.z2=i})}function cC(t,e){uC(e).updateCommon(t,e),lC(t,e)}function uC(t){return DC[t.__brushOption.brushType]}function dC(t,e,i){var n,r=t._panels;if(!r)return!0;var o=t._transform;return ZT(r,function(t){t.isTargetByCursor(e,i,o)&&(n=t)}),n}function pC(t,e){var i=t._panels;if(!i)return!0;var n=e.__brushOption.panelId;return null==n||i[n]}function fC(e){var t=e._covers,i=t.length;return ZT(t,function(t){e.group.remove(t)},e),t.length=0,!!i}function gC(t,e){var i=XT(t._covers,function(t){var e=t.__brushOption,i=za.clone(e.range);return{brushType:e.brushType,panelId:e.panelId,range:i}});t.trigger("brush",i,{isEnd:!!e.isEnd,removeOnClick:!!e.removeOnClick})}function mC(t){var e=t.length-1;return e<0&&(e=0),[t[0],t[e]]}function vC(e,i,t,n){var r=new pf.Group;return r.add(new pf.Rect({name:"main",style:wC(t),silent:!0,draggable:!0,cursor:"move",drift:jT(e,i,r,"nswe"),ondragend:jT(gC,i,{isEnd:!0})})),ZT(n,function(t){r.add(new pf.Rect({name:t,style:{opacity:0},draggable:!0,silent:!0,invisible:!0,drift:jT(e,i,r,t),ondragend:jT(gC,i,{isEnd:!0})}))}),r}function yC(t,e,i,n){var r=n.brushStyle.lineWidth||0,o=YT(r,$T),a=i[0][0],s=i[1][0],l=a-r/2,h=s-r/2,c=i[0][1],u=i[1][1],d=c-o+r/2,p=u-o+r/2,f=c-a,g=u-s,m=f+r,v=g+r;xC(t,e,"main",a,s,f,g),n.transformable&&(xC(t,e,"w",l,h,o,v),xC(t,e,"e",d,h,o,v),xC(t,e,"n",l,h,m,o),xC(t,e,"s",l,p,m,o),xC(t,e,"nw",l,h,o,o),xC(t,e,"ne",d,h,o,o),xC(t,e,"sw",l,p,o,o),xC(t,e,"se",d,p,o,o))}function _C(n,r){var t=r.__brushOption,o=t.transformable,e=r.childAt(0);e.useStyle(wC(t)),e.attr({silent:!o,cursor:o?"move":"default"}),ZT(["w","e","n","s","se","sw","ne","nw"],function(t){var e=r.childOfName(t),i=function t(e,i){{if(1<i.length){i=i.split("");var n=[t(e,i[0]),t(e,i[1])];return("e"===n[0]||"w"===n[0])&&n.reverse(),n.join("")}var n=pf.transformDirection({w:"left",e:"right",n:"top",s:"bottom"}[i],(r=e,pf.getTransform(r.group)));return{left:"w",right:"e",top:"n",bottom:"s"}[n]}var r}(n,t);e&&e.attr({silent:!o,invisible:!o,cursor:o?iC[i]+"-resize":null})})}function xC(t,e,i,n,r,o,a){var s,l,h,c,u,d=e.childOfName(i);d&&d.setShape((s=CC(t,e,[[n,r],[n+o,r+a]]),l=qT(s[0][0],s[1][0]),h=qT(s[0][1],s[1][1]),c=YT(s[0][0],s[1][0]),u=YT(s[0][1],s[1][1]),{x:l,y:h,width:c-l,height:u-h}))}function wC(t){return za.defaults({strokeNoScale:!0},t.brushStyle)}function bC(t,e,i,n){var r=[qT(t,i),qT(e,n)],o=[YT(t,i),YT(e,n)];return[[r[0],o[0]],[r[1],o[1]]]}function MC(t,e,i,n,r,o,a,s){var l=n.__brushOption,h=t(l.range),c=TC(i,o,a);ZT(r.split(""),function(t){var e=eC[t];h[e[0]][e[1]]+=c[e[0]]}),l.range=e(bC(h[0][0],h[1][0],h[0][1],h[1][1])),cC(i,n),gC(i,{isEnd:!1})}function SC(t,e,i,n,r){var o=e.__brushOption.range,a=TC(t,i,n);ZT(o,function(t){t[0]+=a[0],t[1]+=a[1]}),cC(t,e),gC(t,{isEnd:!1})}function TC(t,e,i){var n=t.group,r=n.transformCoordToLocal(e,i),o=n.transformCoordToLocal(0,0);return[r[0]-o[0],r[1]-o[1]]}function CC(t,e,i){var n=pC(t,e);return n&&!0!==n?n.clipPath(i,t._transform):za.clone(i)}function AC(t){var e=t.event;e.preventDefault&&e.preventDefault()}function EC(t,e,i){return t.childOfName("main").contain(e,i)}function PC(t,e,i,n){var r,o=t._creatingCover,a=t._creatingPanel,s=t._brushOption;if(t._track.push(i.slice()),function(t){var e=t._track;if(!e.length)return!1;var i=e[e.length-1],n=e[0],r=i[0]-n[0],o=i[1]-n[1],a=JT(r*r+o*o,.5);return QT<a}(t)||o){if(a&&!o){"single"===s.brushMode&&fC(t);var l=za.clone(s);l.brushType=LC(l.brushType,a),l.panelId=!0===a?null:a.panelId,o=t._creatingCover=aC(t,l),t._covers.push(o)}if(o){var h=DC[LC(t._brushType,a)];o.__brushOption.range=h.getCreatingRange(CC(t,o,t._track)),n&&(sC(t,o),h.updateCommon(t,o)),lC(t,o),r={isEnd:n}}}else n&&"single"===s.brushMode&&s.removeOnClick&&dC(t,e,i)&&fC(t)&&(r={isEnd:n,removeOnClick:!0});return r}function LC(t,e){return"auto"===t?e.defaultBrushType:t}oC.prototype={constructor:oC,enableBrush:function(t){var e,i;return this._brushType&&(i=(e=this)._zr,Uw.release(i,tC,e._uid),ZT(e._handlers,function(t,e){i.off(e,t)}),e._brushType=e._brushOption=null),t.brushType&&function(t,e){var i=t._zr;t._enableGlobalPan||Uw.take(i,tC,t._uid);ZT(t._handlers,function(t,e){i.on(e,t)}),t._brushType=e.brushType,t._brushOption=za.merge(za.clone(nC),e,!0)}(this,t),this},setPanels:function(t){if(t&&t.length){var e=this._panels={};za.each(t,function(t){e[t.panelId]=za.clone(t)})}else this._panels=null;return this},mount:function(t){t=t||{},this._enableGlobalPan=t.enableGlobalPan;var e=this.group;return this._zr.add(e),e.attr({position:t.position||[0,0],rotation:t.rotation||0,scale:t.scale||[1,1]}),this._transform=e.getLocalTransform(),this},eachCover:function(t,e){ZT(this._covers,t,e)},updateCovers:function(r){r=za.map(r,function(t){return za.merge(za.clone(nC),t,!0)});var i="\0-brush-index-",o=this._covers,a=this._covers=[],s=this,l=this._creatingCover;return new ym(o,r,function(t,e){return n(t.__brushOption,e)},n).add(t).update(t).remove(function(t){o[t]!==l&&s.group.remove(o[t])}).execute(),this;function n(t,e){return(null!=t.id?t.id:i+e)+"-"+t.brushType}function t(t,e){var i=r[t];if(null!=e&&o[e]===l)a[t]=o[e];else{var n=a[t]=null!=e?(o[e].__brushOption=i,o[e]):sC(s,aC(s,i));cC(s,n)}}},unmount:function(){return this.enableBrush(!1),fC(this),this._zr.remove(this.group),this},dispose:function(){this.unmount(),this.off()}},za.mixin(oC,qa);var IC={mousedown:function(t){if(this._dragging)RC.call(this,t);else if(!t.target||!t.target.draggable){AC(t);var e=this.group.transformCoordToLocal(t.offsetX,t.offsetY);this._creatingCover=null,(this._creatingPanel=dC(this,t,e))&&(this._dragging=!0,this._track=[e.slice()])}},mousemove:function(t){var e=this.group.transformCoordToLocal(t.offsetX,t.offsetY);if(function(t,e,i){if(t._brushType){var n=t._zr,r=t._covers,o=dC(t,e,i);if(!t._dragging)for(var a=0;a<r.length;a++){var s=r[a].__brushOption;if(o&&(!0===o||s.panelId===o.panelId)&&DC[s.brushType].contain(r[a],i[0],i[1]))return}o&&n.setCursorStyle("crosshair")}}(this,t,e),this._dragging){AC(t);var i=PC(this,t,e,!1);i&&gC(this,i)}},mouseup:RC};function RC(t){if(this._dragging){AC(t);var e=PC(this,t,this.group.transformCoordToLocal(t.offsetX,t.offsetY),!0);this._dragging=!1,this._track=[],this._creatingCover=null,e&&gC(this,e)}}var DC={lineX:OC(0),lineY:OC(1),rect:{createCover:function(t,e){return vC(jT(MC,function(t){return t},function(t){return t}),t,e,["w","e","n","s","se","sw","ne","nw"])},getCreatingRange:function(t){var e=mC(t);return bC(e[1][0],e[1][1],e[0][0],e[0][1])},updateCoverShape:function(t,e,i,n){yC(t,e,i,n)},updateCommon:_C,contain:EC},polygon:{createCover:function(t,e){var i=new pf.Group;return i.add(new pf.Polyline({name:"main",style:wC(e),silent:!0})),i},getCreatingRange:function(t){return t},endCreating:function(t,e){e.remove(e.childAt(0)),e.add(new pf.Polygon({name:"main",draggable:!0,drift:jT(SC,t,e),ondragend:jT(gC,t,{isEnd:!0})}))},updateCoverShape:function(t,e,i,n){e.childAt(0).setShape({points:CC(t,e,i)})},updateCommon:_C,contain:EC}};function OC(l){return{createCover:function(t,e){return vC(jT(MC,function(t){var e=[t,[0,100]];return l&&e.reverse(),e},function(t){return t[l]}),t,e,[["w","e"],["n","s"]][l])},getCreatingRange:function(t){var e=mC(t);return[qT(e[0][l],e[1][l]),YT(e[0][l],e[1][l])]},updateCoverShape:function(t,e,i,n){var r,o=pC(t,e);if(!0!==o&&o.getLinearBrushOtherExtent)r=o.getLinearBrushOtherExtent(l,t._transform);else{var a=t._zr;r=[0,[a.getWidth(),a.getHeight()][1-l]]}var s=[i,r];l&&s.reverse(),yC(t,e,s,n)},updateCommon:_C,contain:EC}}var kC=oC,zC=eb.onIrrelevantElement;function NC(t){return bl.create(t)}var BC={makeRectPanelClipPath:function(i){return i=NC(i),function(t,e){return pf.clipPointsByRect(t,i)}},makeLinearBrushOtherExtent:function(r,o){return r=NC(r),function(t){var e=null!=o?o:t,i=e?r.width:r.height,n=e?r.x:r.y;return[n,n+(i||0)]}},makeRectIsTargetByCursor:function(n,r,o){return n=NC(n),function(t,e,i){return n.contain(e[0],e[1])&&!zC(t,r,o)}}},FC=["axisLine","axisTickLabel","axisName"],GC=fy.extendComponentView({type:"parallelAxis",init:function(t,e){GC.superApply(this,"init",arguments),(this._brushController=new kC(e.getZr())).on("brush",za.bind(this._onBrush,this))},render:function(t,e,i,n){if(r=t,o=e,!(a=n)||"axisAreaSelect"!==a.type||o.findComponents({mainType:"parallelAxis",query:a})[0]!==r){var r,o,a;this.axisModel=t,this.api=i,this.group.removeAll();var s=this._axisGroup;if(this._axisGroup=new pf.Group,this.group.add(this._axisGroup),t.get("show")){var l,h=(l=t,e.getComponent("parallel",l.get("parallelIndex"))),c=h.coordinateSystem,u=t.getAreaSelectStyle(),d=u.width,p=t.axis.dim,f=c.getAxisLayout(p),g=za.extend({strokeContainThreshold:d},f),m=new tx(t,g);za.each(FC,m.add,m),this._axisGroup.add(m.getGroup()),this._refreshBrushController(g,u,t,h,d,i);var v=n&&!1===n.animation?null:t;pf.groupTransition(s,this._axisGroup,v)}}},updateVisual:function(t,e,i,n){this._brushController&&this._brushController.updateCovers(VC(t))},_refreshBrushController:function(t,e,i,n,r,o){var a=i.axis.getExtent(),s=a[1]-a[0],l=Math.min(30,.1*Math.abs(s)),h=pf.BoundingRect.create({x:a[0],y:-r/2,width:s,height:r});h.x-=l,h.width+=2*l,this._brushController.mount({enableGlobalPan:!0,rotation:t.rotation,position:t.position}).setPanels([{panelId:"pl",clipPath:BC.makeRectPanelClipPath(h),isTargetByCursor:BC.makeRectIsTargetByCursor(h,o,n),getLinearBrushOtherExtent:BC.makeLinearBrushOtherExtent(h,0)}]).enableBrush({brushType:"lineX",brushStyle:e,removeOnClick:!0}).updateCovers(VC(i))},_onBrush:function(t,e){var i=this.axisModel,n=i.axis,r=za.map(t,function(t){return[n.coordToData(t.range[0],!0),n.coordToData(t.range[1],!0)]});(!i.option.realtime===e.isEnd||e.removeOnClick)&&this.api.dispatchAction({type:"axisAreaSelect",parallelAxisId:i.id,intervals:r})},dispose:function(){this._brushController.dispose()}});function VC(t){var e=t.axis;return za.map(t.activeIntervals,function(t){return{brushType:"lineX",panelId:"pl",range:[e.dataToCoord(t[0],!0),e.dataToCoord(t[1],!0)]}})}fy.extendComponentView({type:"parallel",render:function(t,e,i){this._model=t,this._api=i,this._handlers||(this._handlers={},za.each(HC,function(t,e){i.getZr().on(e,this._handlers[e]=za.bind(t,this))},this)),um.createOrUpdate(this,"_throttledDispatchExpand",t.get("axisExpandRate"),"fixRate")},dispose:function(t,i){za.each(this._handlers,function(t,e){i.getZr().off(e,t)}),this._handlers=null},_throttledDispatchExpand:function(t){this._dispatchExpand(t)},_dispatchExpand:function(t){t&&this._api.dispatchAction(za.extend({type:"parallelAxisExpand"},t))}});var HC={mousedown:function(t){UC(this,"click")&&(this._mouseDownPoint=[t.offsetX,t.offsetY])},mouseup:function(t){var e=this._mouseDownPoint;if(UC(this,"click")&&e){var i=[t.offsetX,t.offsetY];if(5<Math.pow(e[0]-i[0],2)+Math.pow(e[1]-i[1],2))return;var n=this._model.coordinateSystem.getSlidedAxisExpandWindow([t.offsetX,t.offsetY]);"none"!==n.behavior&&this._dispatchExpand({axisExpandWindow:n.axisExpandWindow})}this._mouseDownPoint=null},mousemove:function(t){if(!this._mouseDownPoint&&UC(this,"mousemove")){var e=this._model,i=e.coordinateSystem.getSlidedAxisExpandWindow([t.offsetX,t.offsetY]),n=i.behavior;"jump"===n&&this._throttledDispatchExpand.debounceNextCall(e.get("axisExpandDebounce")),this._throttledDispatchExpand("none"===n?null:{axisExpandWindow:i.axisExpandWindow,animation:"jump"===n&&null})}}};function UC(t,e){var i=t._model;return i.get("axisExpandable")&&i.get("axisExpandTriggerOn")===e}fy.registerPreprocessor(ET);Qg.extend({type:"series.parallel",dependencies:["parallel"],visualColorAccessPath:"lineStyle.normal.color",getInitialData:function(t,l){var e=l.getComponent("parallel",this.get("parallelIndex")),h=e.parallelAxisIndex,c=t.data,u=e.dimensions,i=function(t,e){var i=0;za.each(t,function(t){var e=WC(t);i<e&&(i=e)});var n=e[0];n&&n.length-1>i&&(i=n.length-1);for(var r=[],o=0;o<=i;o++)r.push("dim"+o);return r}(u,c),n=za.map(i,function(t,e){var i,n,r,o,a=za.indexOf(u,t),s=0<=a&&l.getComponent("parallelAxis",h[a]);return s&&"category"===s.get("type")?(i=t,n=c,r=s.get("data"),o=WC(i),r&&r.length&&za.each(n,function(t){if(t){var e=za.indexOf(r,t[o]);t[o]=0<=e?e:NaN}}),{name:t,type:"ordinal"}):a<0&&Gm.guessOrdinal(c,e)?{name:t,type:"ordinal"}:t}),r=new Im(n,this);return r.initData(c),this.option.progressive&&(this.option.animation=!1),r},getRawIndicesByActiveState:function(i){var t=this.coordinateSystem,n=this.getData(),r=[];return t.eachActiveState(n,function(t,e){i===t&&r.push(n.getRawIndex(e))}),r},defaultOption:{zlevel:0,z:2,coordinateSystem:"parallel",parallelIndex:0,label:{normal:{show:!1},emphasis:{show:!1}},inactiveOpacity:.05,activeOpacity:1,lineStyle:{normal:{width:1,opacity:.45,type:"solid"}},progressive:!1,smooth:!1,animationEasing:"linear"}});function WC(t){return+t.replace("dim","")}am.extend({type:"parallel",init:function(){this._dataGroup=new pf.Group,this.group.add(this._dataGroup),this._data},render:function(t,e,i,n){this._renderForNormal(t,n)},dispose:function(){},_renderForNormal:function(o,a){var r,s,l,h,t,e,i,n,c,u,d,p=this._dataGroup,f=o.getData(),g=this._data,m=o.coordinateSystem,v=m.dimensions,y=o.option.smooth?.3:null;if(f.diff(g).add(function(t){e=f,i=p,n=t,r=v,o=m,a=jC(e,n,r,o),s=new pf.Polyline({shape:{points:a},silent:!0,z2:10}),i.add(s),e.setItemGraphicEl(n,s);var e,i,n,r,o,a,s}).update(function(t,e){var i=g.getItemGraphicEl(e),n=jC(f,t,v,m);f.setItemGraphicEl(t,i);var r=a&&!1===a.animation?null:o;pf.updateProps(i,{shape:{points:n}},r,t)}).remove(function(t){var e=g.getItemGraphicEl(t);p.remove(e)}).execute(),s=y,l=(r=f).hostModel.getModel("lineStyle.normal"),h=l.getLineStyle(),r.eachItemGraphicEl(function(t,e){if(r.hasItemOption){var i=r.getItemModel(e),n=i.getModel("lineStyle.normal",l);h=n.getLineStyle(["color","stroke"])}t.useStyle(za.extend(h,{fill:null,stroke:r.getItemVisual(e,"color"),opacity:r.getItemVisual(e,"opacity")})),t.shape.smooth=s}),!this._data){var _=(e=o,i=function(){setTimeout(function(){p.removeClipPath()})},n=(t=m).model,c=t.getRect(),u=new pf.Rect({shape:{x:c.x,y:c.y,width:c.width,height:c.height}}),d="horizontal"===n.get("layout")?"width":"height",u.setShape(d,0),pf.initProps(u,{shape:{width:c.width,height:c.height}},e,i),u);p.setClipPath(_)}this._data=f},remove:function(){this._dataGroup&&this._dataGroup.removeAll(),this._data=null}});function jC(t,e,i,n){for(var r,o=[],a=0;a<i.length;a++){var s=i[a],l=t.get(s,e);r=l,("category"===n.getAxis(s).type?null==r:null==r||isNaN(r))||o.push(n.dataToPoint(l,s))}return o}var ZC=["lineStyle","normal","opacity"];var XC=function(u){u.eachSeriesByType("parallel",function(t){var e=t.getModel("itemStyle.normal"),i=t.getModel("lineStyle.normal"),n=u.get("color"),r=i.get("color")||e.get("color")||n[t.seriesIndex%n.length],o=t.get("inactiveOpacity"),a=t.get("activeOpacity"),s=t.getModel("lineStyle.normal").getLineStyle(),l=t.coordinateSystem,h=t.getData(),c={normal:s.opacity,active:a,inactive:o};l.eachActiveState(h,function(t,e){var i=h.getItemModel(e),n=c[t];if("normal"===t){var r=i.get(ZC,!0);null!=r&&(n=r)}h.setItemVisual(e,"opacity",n)}),h.setVisual("color",r)})};fy.registerVisual(XC);var qC=Yc.encodeHTML,YC=Qg.extend({type:"series.sankey",layoutInfo:null,getInitialData:function(t){var e=t.edges||t.links,i=t.data||t.nodes;if(i&&e)return dS(i,e,this,!0).data},getGraph:function(){return this.getData().graph},getEdgeData:function(){return this.getGraph().edgeData},formatTooltip:function(t,e,i){if("edge"===i){var n=this.getDataParams(t,i),r=n.data,o=r.source+" -- "+r.target;return n.value&&(o+=" : "+n.value),qC(o)}return YC.superCall(this,"formatTooltip",t,e)},defaultOption:{zlevel:0,z:2,coordinateSystem:"view",layout:null,left:"5%",top:"5%",right:"20%",bottom:"5%",nodeWidth:20,nodeGap:8,layoutIterations:32,label:{normal:{show:!0,position:"right",color:"#000",fontSize:12},emphasis:{show:!0}},itemStyle:{normal:{borderWidth:1,borderColor:"#333"}},lineStyle:{normal:{color:"#314656",opacity:.2,curveness:.5},emphasis:{opacity:.6}},animationEasing:"linear",animationDuration:1e3}}),JC=pf.extendShape({shape:{x1:0,y1:0,x2:0,y2:0,cpx1:0,cpy1:0,cpx2:0,cpy2:0,extent:0},buildPath:function(t,e){var i=e.extent/2;t.moveTo(e.x1,e.y1-i),t.bezierCurveTo(e.cpx1,e.cpy1-i,e.cpx2,e.cpy2-i,e.x2,e.y2-i),t.lineTo(e.x2,e.y2+i),t.bezierCurveTo(e.cpx2,e.cpy2+i,e.cpx1,e.cpy1+i,e.x1,e.y1+i),t.closePath()}});fy.extendChartView({type:"sankey",_model:null,render:function(g,t,e){var i,n,r,o,a=g.getGraph(),m=this.group,s=g.layoutInfo,l=g.getData(),v=g.getData("edge");this._model=g,m.removeAll(),m.attr("position",[s.x,s.y]),a.eachEdge(function(t){var e=new JC;e.dataIndex=t.dataIndex,e.seriesIndex=g.seriesIndex,e.dataType="edge";var i=t.getModel("lineStyle.normal"),n=i.get("curveness"),r=t.node1.getLayout(),o=t.node2.getLayout(),a=t.getLayout();e.shape.extent=Math.max(1,a.dy);var s=r.x+r.dx,l=r.y+a.sy+a.dy/2,h=o.x,c=o.y+a.ty+a.dy/2,u=s*(1-n)+h*n,d=l,p=s*n+h*(1-n),f=c;switch(e.setShape({x1:s,y1:l,x2:h,y2:c,cpx1:u,cpy1:d,cpx2:p,cpy2:f}),e.setStyle(i.getItemStyle()),e.style.fill){case"source":e.style.fill=t.node1.getVisual("color");break;case"target":e.style.fill=t.node2.getVisual("color")}pf.setHoverStyle(e,t.getModel("lineStyle.emphasis").getItemStyle()),m.add(e),v.setItemGraphicEl(t.dataIndex,e)}),a.eachNode(function(t){var e=t.getLayout(),i=t.getModel(),n=i.getModel("label.normal"),r=i.getModel("label.emphasis"),o=new pf.Rect({shape:{x:e.x,y:e.y,width:t.getLayout().dx,height:t.getLayout().dy},style:i.getModel("itemStyle.normal").getItemStyle()}),a=t.getModel("itemStyle.emphasis").getItemStyle();pf.setLabelStyle(o.style,a,n,r,{labelFetcher:g,labelDataIndex:t.dataIndex,defaultText:t.id,isRectText:!0}),o.setStyle("fill",t.getVisual("color")),pf.setHoverStyle(o,a),m.add(o),l.setItemGraphicEl(t.dataIndex,o),o.dataType="node"}),!this._data&&g.get("animation")&&m.setClipPath((i=m.getBoundingRect(),n=g,r=function(){m.removeClipPath()},o=new pf.Rect({shape:{x:i.x-10,y:i.y-10,width:0,height:i.height+20}}),pf.initProps(o,{shape:{width:i.width+20,height:i.height+20}},n,r),o)),this._data=g.getData()},dispose:function(){}});var KC=function(){var c=[],e=[];return{key:function(t){return c.push(t),this},sortKeys:function(t){return e[c.length-1]=t,this},entries:function(t){return function i(t,n){if(n>=c.length)return t;var r=[],o=e[n++];return za.each(t,function(t,e){r.push({key:e,values:i(t,n)})}),o?r.sort(function(t,e){return o(t.key,e.key)}):r}(function i(t,n){if(n>=c.length)return t;for(var e=-1,r=t.length,o=c[n++],a={},s={};++e<r;){var l=o(t[e]),h=s[l];h?h.push(t[e]):s[l]=[t[e]]}return za.each(s,function(t,e){a[e]=i(t,n)}),a}(t,0),0)}}};function QC(t,s,l){za.each(t,function(t){var e,i,n,r=0,o=t.length;for(t.sort(sA),n=0;n<o;n++){if(0<(i=r-(e=t[n]).getLayout().y)){var a=e.getLayout().y+i;e.setLayout({y:a},!0)}r=e.getLayout().y+e.getLayout().dy+s}if(0<(i=r-s-l)){a=e.getLayout().y-i;for(e.setLayout({y:a},!0),r=e.getLayout().y,n=o-2;0<=n;--n)0<(i=(e=t[n]).getLayout().y+e.getLayout().dy+s-r)&&(a=e.getLayout().y-i,e.setLayout({y:a},!0)),r=e.getLayout().y}})}function $C(t,n){za.each(t.slice().reverse(),function(t){za.each(t,function(t){if(t.outEdges.length){var e=oA(t.outEdges,tA)/oA(t.outEdges,hA),i=t.getLayout().y+(e-aA(t))*n;t.setLayout({y:i},!0)}})})}function tA(t){return aA(t.node2)*t.getValue()}function eA(t,n){za.each(t,function(t){za.each(t,function(t){if(t.inEdges.length){var e=oA(t.inEdges,iA)/oA(t.inEdges,hA),i=t.getLayout().y+(e-aA(t))*n;t.setLayout({y:i},!0)}})})}function iA(t){return aA(t.node1)*t.getValue()}function nA(t,e){return t.node2.getLayout().y-e.node2.getLayout().y}function rA(t,e){return t.node1.getLayout().y-e.node1.getLayout().y}function oA(t,e){for(var i=0,n=t.length,r=-1;++r<n;){var o=+e.call(t,t[r],r);isNaN(o)||(i+=o)}return i}function aA(t){return t.getLayout().y+t.getLayout().dy/2}function sA(t,e){return t.getLayout().y-e.getLayout().y}function lA(t,e){return t<e?-1:e<t?1:t===e?0:NaN}function hA(t){return t.getValue()}var cA=function(t,_,e){t.eachSeriesByType("sankey",function(t){var e,i,n,r=t.get("nodeWidth"),o=t.get("nodeGap"),a=(e=t,i=_,jf.getLayoutRect(e.getBoxLayoutParams(),{width:i.getWidth(),height:i.getHeight()})),s=(t.layoutInfo=a).width,l=a.height,h=t.getGraph(),c=h.nodes,u=h.edges;n=c,za.each(n,function(t){var e=oA(t.outEdges,hA),i=oA(t.inEdges,hA),n=Math.max(e,i);t.setLayout({value:n},!0)});var d,p,f,g,m,v,y=0!==za.filter(c,function(t){return 0===t.getLayout().value}).length?0:t.get("layoutIterations");p=u,f=o,g=l,m=y,function(t,e,i){for(var n,r,o,a,s=t,l=null,h=0;s.length;){l=[];for(var c=0,u=s.length;c<u;c++){var d=s[c];d.setLayout({x:h},!0),d.setLayout({dx:e},!0);for(var p=0,f=d.outEdges.length;p<f;p++)l.push(d.outEdges[p].node2)}s=l,++h}o=t,a=h,za.each(o,function(t){t.outEdges.length||t.setLayout({x:a-1},!0)}),n=t,r=(i-e)/(h-1),za.each(n,function(t){var e=t.getLayout().x*r;t.setLayout({x:e},!0)})}(d=c,r,s),function(t,e,i,n,r){var o=KC().key(function(t){return t.getLayout().x}).sortKeys(lA).entries(t).map(function(t){return t.values});(function(t,e,i,r,o){var a=[];za.each(e,function(t){var e=t.length,i=0;za.each(t,function(t){i+=t.getLayout().value});var n=(r-(e-1)*o)/i;a.push(n)}),a.sort(function(t,e){return t-e});var n=a[0];za.each(e,function(t){za.each(t,function(t,e){t.setLayout({y:e},!0);var i=t.getLayout().value*n;t.setLayout({dy:i},!0)})}),za.each(i,function(t){var e=+t.getValue()*n;t.setLayout({dy:e},!0)})})(0,o,e,i,n),QC(o,n,i);for(var a=1;0<r;r--)$C(o,a*=.99),QC(o,n,i),eA(o,a),QC(o,n,i)}(d,p,g,f,m),v=d,za.each(v,function(t){t.outEdges.sort(nA),t.inEdges.sort(rA)}),za.each(v,function(t){var e=0,i=0;za.each(t.outEdges,function(t){t.setLayout({sy:e},!0),e+=t.getLayout().dy}),za.each(t.inEdges,function(t){t.setLayout({ty:i},!0),i+=t.getLayout().dy})})})};var uA=function(t,e){t.eachSeriesByType("sankey",function(n){var t=n.getGraph().nodes;t.sort(function(t,e){return t.getLayout().value-e.getLayout().value});var r=t[0].getLayout().value,o=t[t.length-1].getLayout().value;za.each(t,function(t){var e=new BM({type:"color",mappingMethod:"linear",dataExtent:[r,o],visual:n.get("color")}).mapValueToVisual(t.getLayout().value);t.setVisual("color",e);var i=t.getModel().get("itemStyle.normal.color");null!=i&&t.setVisual("color",i)})})};fy.registerLayout(cA),fy.registerVisual(uA);var dA=_d.extend({type:"whiskerInBox",shape:{},buildPath:function(t,e){for(var i in e)if(e.hasOwnProperty(i)&&0===i.indexOf("ends")){var n=e[i];t.moveTo(n[0][0],n[0][1]),t.lineTo(n[1][0],n[1][1])}}});function pA(t,e,i,n){pf.Group.call(this),this.bodyIndex,this.whiskerIndex,this.styleUpdater=i,this._createContent(t,e,n),this.updateData(t,e,n),this._seriesModel}var fA=pA.prototype;function gA(t,e,i){return za.map(t,function(t){return(t=t.slice())[e]=i.initBaseline,t})}function mA(t){var i={};return za.each(t,function(t,e){i["ends"+e]=t}),i}function vA(t){this.group=new pf.Group,this.styleUpdater=t}fA._createContent=function(t,e,i){var n=t.getItemLayout(e),r="horizontal"===n.chartLayout?1:0,o=0;this.add(new pf.Polygon({shape:{points:i?gA(n.bodyEnds,r,n):n.bodyEnds},style:{strokeNoScale:!0},z2:100})),this.bodyIndex=o++;var a=za.map(n.whiskerEnds,function(t){return i?gA(t,r,n):t});this.add(new dA({shape:mA(a),style:{strokeNoScale:!0},z2:100})),this.whiskerIndex=o++},fA.updateData=function(t,e,i){var n=this._seriesModel=t.hostModel,r=t.getItemLayout(e),o=pf[i?"initProps":"updateProps"];o(this.childAt(this.bodyIndex),{shape:{points:r.bodyEnds}},n,e),o(this.childAt(this.whiskerIndex),{shape:mA(r.whiskerEnds)},n,e),this.styleUpdater.call(null,this,t,e)},za.inherits(pA,pf.Group);var yA=vA.prototype;yA.updateData=function(n){var r=this.group,o=this._data,a=this.styleUpdater;n.diff(o).add(function(t){if(n.hasValue(t)){var e=new pA(n,t,a,!0);n.setItemGraphicEl(t,e),r.add(e)}}).update(function(t,e){var i=o.getItemGraphicEl(e);n.hasValue(t)?(i?i.updateData(n,t):i=new pA(n,t,a),r.add(i),n.setItemGraphicEl(t,i)):r.remove(i)}).remove(function(t){var e=o.getItemGraphicEl(t);e&&r.remove(e)}).execute(),this._data=n},yA.remove=function(){var e=this.group,t=this._data;this._data=null,t&&t.eachItemGraphicEl(function(t){t&&e.remove(t)})};var _A=vA,xA={seriesModelMixin:{_baseAxisDim:null,getInitialData:function(t,e){var i,n,r=e.getComponent("xAxis",this.get("xAxisIndex")),o=e.getComponent("yAxis",this.get("yAxisIndex")),a=r.get("type"),s=o.get("type");"category"===a?(t.layout="horizontal",i=r.getCategories(),n=!0):"category"===s?(t.layout="vertical",i=o.getCategories(),n=!0):t.layout=t.layout||"horizontal";var l=["x","y"],h="horizontal"===t.layout?0:1,c=this._baseAxisDim=l[h],u=l[1-h],d=t.data;n&&za.each(d,function(t,e){t.value&&za.isArray(t.value)?t.value.unshift(e):za.isArray(t)&&t.unshift(e)});var p=this.defaultValueDimensions,f=[{name:c,otherDims:{tooltip:!1},dimsDef:["base"]},{name:u,dimsDef:p.slice()}];f=Gm(f,d,{encodeDef:this.get("encode"),dimsDef:this.get("dimensions"),dimCount:p.length+1});var g=new Im(f,this);return g.initData(d,i?i.slice():null),g},getBaseAxis:function(){var t=this._baseAxisDim;return this.ecModel.getComponent(t+"Axis",this.get(t+"AxisIndex")).axis}},viewMixin:{init:function(){var t=this._whiskerBoxDraw=new _A(this.getStyleUpdater());this.group.add(t.group)},render:function(t,e,i){this._whiskerBoxDraw.updateData(t.getData())},remove:function(t){this._whiskerBoxDraw.remove()}}},wA=xA.seriesModelMixin,bA=Qg.extend({type:"series.boxplot",dependencies:["xAxis","yAxis","grid"],defaultValueDimensions:["min","Q1","median","Q3","max"],dimensions:null,defaultOption:{zlevel:0,z:2,coordinateSystem:"cartesian2d",legendHoverLink:!0,hoverAnimation:!0,layout:null,boxWidth:[7,50],itemStyle:{normal:{color:"#fff",borderWidth:1},emphasis:{borderWidth:2,shadowBlur:5,shadowOffsetX:2,shadowOffsetY:2,shadowColor:"rgba(0,0,0,0.4)"}},animationEasing:"elasticOut",animationDuration:800}});za.mixin(bA,wA,!0);var MA=xA.viewMixin,SA=am.extend({type:"boxplot",getStyleUpdater:function(){return AA},dispose:za.noop});za.mixin(SA,MA,!0);var TA=["itemStyle","normal"],CA=["itemStyle","emphasis"];function AA(t,e,i){var n=e.getItemModel(i),r=n.getModel(TA),o=e.getItemVisual(i,"color"),a=r.getItemStyle(["borderColor"]),s=t.childAt(t.whiskerIndex);s.style.set(a),s.style.stroke=o,s.dirty();var l=t.childAt(t.bodyIndex);l.style.set(a),l.style.stroke=o,l.dirty();var h=n.getModel(CA).getItemStyle();pf.setHoverStyle(t,h)}var EA=["itemStyle","normal","borderColor"];var PA=function(n,t){var r=n.get("color");n.eachRawSeriesByType("boxplot",function(t){var e=r[t.seriesIndex%r.length],i=t.getData();i.setVisual({legendSymbol:"roundRect",color:t.get(EA)||e}),n.isSeriesFiltered(t)||i.each(function(t){var e=i.getItemModel(t);i.setItemVisual(t,{color:e.get(EA,!0)})})})},LA=Uc.parsePercent,IA=za.each;var RA=function(t){var n,r,e=(n=[],r=[],t.eachSeriesByType("boxplot",function(t){var e=t.getBaseAxis(),i=za.indexOf(r,e);i<0&&(i=r.length,r[i]=e,n[i]={axis:e,seriesModels:[]}),n[i].seriesModels.push(t)}),n);IA(e,function(a){var t=a.seriesModels;t.length&&(function(t){var e,i,n=t.axis,r=t.seriesModels,o=r.length,a=t.boxWidthList=[],s=t.boxOffsetList=[],l=[];if("category"===n.type)i=n.getBandWidth();else{var h=0;IA(r,function(t){h=Math.max(h,t.getData().count())}),e=n.getExtent(),Math.abs(e[1]-e[0])}IA(r,function(t){var e=t.get("boxWidth");za.isArray(e)||(e=[e,e]),l.push([LA(e[0],i)||0,LA(e[1],i)||0])});var c=.8*i-2,u=c/o*.3,d=(c-u*(o-1))/o,p=d/2-c/2;IA(r,function(t,e){s.push(p),p+=u+d,a.push(Math.min(Math.max(d,l[e][0]),l[e][1]))})}(a),IA(t,function(t,e){var i,u,n,r,d,p,f,g,m,v,o,y;i=t,u=a.boxOffsetList[e],n=a.boxWidthList[e],d=i.coordinateSystem,p=i.getData(),f=n/2,g=i.get("layout"),v=1-(m="horizontal"===g?0:1),o=["x","y"],y=[],za.each(p.dimensions,function(t){var e=p.getDimensionInfo(t).coordDim;e===o[v]?y.push(t):e===o[m]&&(r=t)}),null==r||y.length<5||p.each([r].concat(y),function(){var t=arguments,n=t[0],e=t[y.length+1],i=l(t[3]),r=l(t[1]),o=l(t[5]),a=[[r,l(t[2])],[o,l(t[4])]];c(r),c(o),c(i);var s=[];function l(t){var e,i=[];return i[m]=n,i[v]=t,isNaN(n)||isNaN(t)?e=[NaN,NaN]:(e=d.dataToPoint(i))[m]+=u,e}function h(t,e){var i=t.slice(),n=t.slice();i[m]+=f,n[m]-=f,e?s.push(i,n):s.push(n,i)}function c(t){var e=[t.slice(),t.slice()];e[0][m]-=f,e[1][m]+=f,a.push(e)}h(a[0][1],0),h(a[1][1],1),p.setItemLayout(e,{chartLayout:g,initBaseline:i[v],median:i,bodyEnds:s,whiskerEnds:a})})}))})};fy.registerVisual(PA),fy.registerLayout(RA);var DA=xA.seriesModelMixin,OA=Qg.extend({type:"series.candlestick",dependencies:["xAxis","yAxis","grid"],defaultValueDimensions:["open","close","lowest","highest"],dimensions:null,defaultOption:{zlevel:0,z:2,coordinateSystem:"cartesian2d",legendHoverLink:!0,hoverAnimation:!0,layout:null,itemStyle:{normal:{color:"#c23531",color0:"#314656",borderWidth:1,borderColor:"#c23531",borderColor0:"#314656"},emphasis:{borderWidth:2}},barMaxWidth:null,barMinWidth:null,barWidth:null,animationUpdate:!1,animationEasing:"linear",animationDuration:300},getShadowDim:function(){return"open"},brushSelector:function(t,e,i){var n=e.getItemLayout(t);return i.rect(n.brushRect)}});za.mixin(OA,DA,!0);var kA=xA.viewMixin,zA=am.extend({type:"candlestick",getStyleUpdater:function(){return FA},dispose:za.noop});za.mixin(zA,kA,!0);var NA=["itemStyle","normal"],BA=["itemStyle","emphasis"];function FA(t,e,i){var n=e.getItemModel(i),r=n.getModel(NA),o=e.getItemVisual(i,"color"),a=e.getItemVisual(i,"borderColor")||o,s=r.getItemStyle(["color","color0","borderColor","borderColor0"]),l=t.childAt(t.whiskerIndex);l.useStyle(s),l.style.stroke=a;var h=t.childAt(t.bodyIndex);h.useStyle(s),h.style.fill=o,h.style.stroke=a;var c=n.getModel(BA).getItemStyle();pf.setHoverStyle(t,c)}var GA=function(t){t&&za.isArray(t.series)&&za.each(t.series,function(t){za.isObject(t)&&"k"===t.type&&(t.type="candlestick")})},VA=["itemStyle","normal","borderColor"],HA=["itemStyle","normal","borderColor0"],UA=["itemStyle","normal","color"],WA=["itemStyle","normal","color0"];var jA=function(e,t){e.eachRawSeriesByType("candlestick",function(t){var n=t.getData();n.setVisual({legendSymbol:"roundRect"}),e.isSeriesFiltered(t)||n.each(function(t){var e=n.getItemModel(t),i=n.getItemLayout(t).sign;n.setItemVisual(t,{color:e.get(0<i?UA:WA),borderColor:e.get(0<i?VA:HA)})})})},ZA=Uc.parsePercent,XA=pf.subPixelOptimize,qA=za.retrieve2;var YA=function(t){t.eachSeriesByType("candlestick",function(t){var e,i,n,r,o,a,s,l,h,x=t.coordinateSystem,w=t.getData(),b=(i=w,r=(e=t).getBaseAxis(),o="category"===r.type?r.getBandWidth():(n=r.getExtent(),Math.abs(n[1]-n[0])/i.count()),a=ZA(qA(e.get("barMaxWidth"),o),o),s=ZA(qA(e.get("barMinWidth"),1),o),null!=(l=e.get("barWidth"))?ZA(l,o):Math.max(Math.min(o/2,a),s)),M=t.get("layout"),S="horizontal"===M?0:1,T=1-S,c=["x","y"],C=[];if(za.each(w.dimensions,function(t){var e=w.getDimensionInfo(t).coordDim;e===c[T]?C.push(t):e===c[S]&&(h=t)}),!(null==h||C.length<4)){var A=0;w.each([h].concat(C),function(){var t,e,i,n=arguments,r=n[0],o=n[C.length+1],a=n[1],s=n[2],l=n[3],h=n[4],c=Math.min(a,s),u=Math.max(a,s),d=v(c),p=v(u),f=v(l),g=[[_(v(h)),_(p)],[_(f),_(d)]],m=[];function v(t){var e=[];return e[S]=r,e[T]=t,isNaN(r)||isNaN(t)?[NaN,NaN]:x.dataToPoint(e)}function y(t,e){var i=t.slice(),n=t.slice();i[S]=XA(i[S]+b/2,1,!1),n[S]=XA(n[S]-b/2,1,!0),e?m.push(i,n):m.push(n,i)}function _(t){return t[S]=XA(t[S],1),t}y(p,0),y(d,1),t=s<a?-1:a<s?1:0<A?w.getItemModel(A-1).get()[2]<=s?1:-1:1,w.setItemLayout(o,{chartLayout:M,sign:t,initBaseline:s<a?p[T]:d[T],bodyEnds:m,whiskerEnds:g,brushRect:(e=v(Math.min(a,s,l,h)),i=v(Math.max(a,s,l,h)),e[S]-=b/2,i[S]-=b/2,{x:e[0],y:e[1],width:T?b:i[0]-e[0],height:T?i[1]-e[1]:b})}),++A},!0)}})};fy.registerPreprocessor(GA),fy.registerVisual(jA),fy.registerLayout(YA);Qg.extend({type:"series.effectScatter",dependencies:["grid","polar"],getInitialData:function(t,e){return Xm(t.data,this,e)},brushSelector:"point",defaultOption:{coordinateSystem:"cartesian2d",zlevel:0,z:2,legendHoverLink:!0,effectType:"ripple",progressive:0,showEffectOn:"render",rippleEffect:{period:4,scale:2.5,brushType:"fill"},symbolSize:10}});var JA=Bv.createSymbol,KA=pf.Group,QA=Uc.parsePercent;function $A(t,e){t.eachChild(function(t){t.attr({z:e.z,zlevel:e.zlevel,style:{stroke:"stroke"===e.brushType?e.color:null,fill:"fill"===e.brushType?e.color:null}})})}function tE(t,e){KA.call(this);var i=new Ey(t,e),n=new KA;this.add(i),this.add(n),n.beforeUpdate=function(){this.attr(i.getScale())},this.updateData(t,e)}var eE=tE.prototype;eE.stopEffectAnimation=function(){this.childAt(1).removeAll()},eE.startEffectAnimation=function(t){for(var e=t.symbolType,i=t.color,n=this.childAt(1),r=0;r<3;r++){var o=JA(e,-1,-1,2,2,i);o.attr({style:{strokeNoScale:!0},z2:99,silent:!0,scale:[.5,.5]});var a=-r/3*t.period+t.effectOffset;o.animate("",!0).when(t.period,{scale:[t.rippleScale/2,t.rippleScale/2]}).delay(a).start(),o.animateStyle(!0).when(t.period,{opacity:0}).delay(a).start(),n.add(o)}$A(n,t)},eE.updateEffectAnimation=function(t){for(var e=this._effectCfg,i=this.childAt(1),n=["symbolType","period","rippleScale"],r=0;r<n.length;r++){var o=n[r];if(e[o]!==t[o])return this.stopEffectAnimation(),void this.startEffectAnimation(t)}$A(i,t)},eE.highlight=function(){this.trigger("emphasis")},eE.downplay=function(){this.trigger("normal")},eE.updateData=function(t,e){var i=t.hostModel;this.childAt(0).updateData(t,e);var n,r=this.childAt(1),o=t.getItemModel(e),a=t.getItemVisual(e,"symbol"),s=(n=t.getItemVisual(e,"symbolSize"),za.isArray(n)||(n=[+n,+n]),n),l=t.getItemVisual(e,"color");r.attr("scale",s),r.traverse(function(t){t.attr({fill:l})});var h=o.getShallow("symbolOffset");if(h){var c=r.position;c[0]=QA(h[0],s[0]),c[1]=QA(h[1],s[1])}r.rotation=(o.getShallow("symbolRotate")||0)*Math.PI/180||0;var u={};if(u.showEffectOn=i.get("showEffectOn"),u.rippleScale=o.get("rippleEffect.scale"),u.brushType=o.get("rippleEffect.brushType"),u.period=1e3*o.get("rippleEffect.period"),u.effectOffset=e/t.count(),u.z=o.getShallow("z")||0,u.zlevel=o.getShallow("zlevel")||0,u.symbolType=a,u.color=l,this.off("mouseover").off("mouseout").off("emphasis").off("normal"),"render"===u.showEffectOn)this._effectCfg?this.updateEffectAnimation(u):this.startEffectAnimation(u),this._effectCfg=u;else{this._effectCfg=null,this.stopEffectAnimation();var d=this.childAt(0),p=function(){d.highlight(),"render"!==u.showEffectOn&&this.startEffectAnimation(u)},f=function(){d.downplay(),"render"!==u.showEffectOn&&this.stopEffectAnimation()};this.on("mouseover",p,this).on("mouseout",f,this).on("emphasis",p,this).on("normal",f,this)}this._effectCfg=u},eE.fadeOut=function(t){this.off("mouseover").off("mouseout").off("emphasis").off("normal"),t&&t()},za.inherits(tE,KA);var iE=tE;fy.extendChartView({type:"effectScatter",init:function(){this._symbolDraw=new Ry(iE)},render:function(t,e,i){var n=t.getData(),r=this._symbolDraw;r.updateData(n),this.group.add(r.group)},updateLayout:function(){this._symbolDraw.updateLayout()},remove:function(t,e){this._symbolDraw&&this._symbolDraw.remove(e)},dispose:function(){}});fy.registerVisual(za.curry(e_,"effectScatter","circle",null)),fy.registerLayout(za.curry(i_,"effectScatter"));var nE=Yc.encodeHTML;function rE(t){var e=t.data;e&&e[0]&&e[0][0]&&e[0][0].coord&&(t.data=za.map(e,function(t){var e={coords:[t[0].coord,t[1].coord]};return t[0].name&&(e.fromName=t[0].name),t[1].name&&(e.toName=t[1].name),za.mergeAll([e,t[0],t[1]])}))}var oE=Qg.extend({type:"series.lines",dependencies:["grid","polar"],visualColorAccessPath:"lineStyle.normal.color",init:function(t){rE(t),oE.superApply(this,"init",arguments)},mergeOption:function(t){rE(t),oE.superApply(this,"mergeOption",arguments)},getInitialData:function(t,e){var o=new Im(["value"],this);return o.hasItemOption=!1,o.initData(t.data,[],function(t,e,i,n){if(t instanceof Array)return NaN;o.hasItemOption=!0;var r=t.value;return null!=r?r instanceof Array?r[n]:r:void 0}),o},formatTooltip:function(t){var e=this.getData().getItemModel(t),i=e.get("name");if(i)return i;var n=e.get("fromName"),r=e.get("toName"),o=[];return null!=n&&o.push(n),null!=r&&o.push(r),nE(o.join(" > "))},defaultOption:{coordinateSystem:"geo",zlevel:0,z:2,legendHoverLink:!0,hoverAnimation:!0,xAxisIndex:0,yAxisIndex:0,symbol:["none","none"],symbolSize:[10,10],geoIndex:0,effect:{show:!1,period:4,constantSpeed:0,symbol:"circle",symbolSize:3,loop:!0,trailLength:.2},large:!1,largeThreshold:2e3,polyline:!1,label:{normal:{show:!1,position:"end"}},lineStyle:{normal:{opacity:.5}}}}),aE=Bv.createSymbol;function sE(t,e,i){pf.Group.call(this),this.add(this.createLine(t,e,i)),this._updateEffectSymbol(t,e)}var lE=sE.prototype;lE.createLine=function(t,e,i){return new AS(t,e,i)},lE._updateEffectSymbol=function(t,e){var i=t.getItemModel(e).getModel("effect"),n=i.get("symbolSize"),r=i.get("symbol");za.isArray(n)||(n=[n,n]);var o=i.get("color")||t.getItemVisual(e,"color"),a=this.childAt(1);this._symbolType!==r&&(this.remove(a),(a=aE(r,-.5,-.5,1,1,o)).z2=100,a.culling=!0,this.add(a)),a&&(a.setStyle("shadowColor",o),a.setStyle(i.getItemStyle(["color"])),a.attr("scale",n),a.setColor(o),a.attr("scale",n),this._symbolType=r,this._updateEffectAnimation(t,i,e))},lE._updateEffectAnimation=function(e,t,i){var n=this.childAt(1);if(n){var r=this,o=e.getItemLayout(i),a=1e3*t.get("period"),s=t.get("loop"),l=t.get("constantSpeed"),h=za.retrieve(t.get("delay"),function(t){return t/e.count()*a/3}),c="function"==typeof h;if(n.ignore=!0,this.updateAnimationPoints(n,o),0<l&&(a=this.getLineLength(n)/l*1e3),a!==this._period||s!==this._loop){n.stopAnimation();var u=h;c&&(u=h(i)),0<n.__t&&(u=-a*n.__t),n.__t=0;var d=n.animate("",s).when(a,{__t:1}).delay(u).during(function(){r.updateSymbolPosition(n)});s||d.done(function(){r.remove(n)}),d.start()}this._period=a,this._loop=s}},lE.getLineLength=function(t){return Ha.dist(t.__p1,t.__cp1)+Ha.dist(t.__cp1,t.__p2)},lE.updateAnimationPoints=function(t,e){t.__p1=e[0],t.__p2=e[1],t.__cp1=e[2]||[(e[0][0]+e[1][0])/2,(e[0][1]+e[1][1])/2]},lE.updateData=function(t,e,i){this.childAt(0).updateData(t,e,i),this._updateEffectSymbol(t,e)},lE.updateSymbolPosition=function(t){var e=t.__p1,i=t.__p2,n=t.__cp1,r=t.__t,o=t.position,a=wu.quadraticAt,s=wu.quadraticDerivativeAt;o[0]=a(e[0],n[0],i[0],r),o[1]=a(e[1],n[1],i[1],r);var l=s(e[0],n[0],i[0],r),h=s(e[1],n[1],i[1],r);t.rotation=-Math.atan2(h,l)-Math.PI/2,t.ignore=!1},lE.updateLayout=function(t,e){this.childAt(0).updateLayout(t,e);var i=t.getItemModel(e).getModel("effect");this._updateEffectAnimation(t,i,e)},za.inherits(sE,pf.Group);var hE=sE;function cE(t,e,i){pf.Group.call(this),this._createPolyline(t,e,i)}var uE=cE.prototype;uE._createPolyline=function(t,e,i){var n=t.getItemLayout(e),r=new pf.Polyline({shape:{points:n}});this.add(r),this._updateCommonStl(t,e,i)},uE.updateData=function(t,e,i){var n=t.hostModel,r=this.childAt(0),o={shape:{points:t.getItemLayout(e)}};pf.updateProps(r,o,n,e),this._updateCommonStl(t,e,i)},uE._updateCommonStl=function(t,e,i){var n=this.childAt(0),r=t.getItemModel(e),o=t.getItemVisual(e,"color"),a=i&&i.lineStyle,s=i&&i.hoverLineStyle;i&&!t.hasItemOption||(a=r.getModel("lineStyle.normal").getLineStyle(),s=r.getModel("lineStyle.emphasis").getLineStyle()),n.useStyle(za.defaults({strokeNoScale:!0,fill:"none",stroke:o},a)),n.hoverStyle=s,pf.setHoverStyle(this)},uE.updateLayout=function(t,e){this.childAt(0).setShape("points",t.getItemLayout(e))},za.inherits(cE,pf.Group);var dE=cE;function pE(t,e,i){hE.call(this,t,e,i),this._lastFrame=0,this._lastFramePercent=0}var fE=pE.prototype;fE.createLine=function(t,e,i){return new dE(t,e,i)},fE.updateAnimationPoints=function(t,e){this._points=e;for(var i=[0],n=0,r=1;r<e.length;r++){var o=e[r-1],a=e[r];n+=Ha.dist(o,a),i.push(n)}if(0!==n){for(r=0;r<i.length;r++)i[r]/=n;this._offsets=i,this._length=n}},fE.getLineLength=function(t){return this._length},fE.updateSymbolPosition=function(t){var e=t.__t,i=this._points,n=this._offsets,r=i.length;if(n){var o=this._lastFrame;if(e<this._lastFramePercent){for(a=Math.min(o+1,r-1);0<=a&&!(n[a]<=e);a--);a=Math.min(a,r-2)}else{for(var a=o;a<r&&!(n[a]>e);a++);a=Math.min(a-1,r-2)}Ha.lerp(t.position,i[a],i[a+1],(e-n[a])/(n[a+1]-n[a]));var s=i[a+1][0]-i[a][0],l=i[a+1][1]-i[a][1];t.rotation=-Math.atan2(l,s)-Math.PI/2,this._lastFrame=a,this._lastFramePercent=e,t.ignore=!1}},za.inherits(pE,hE);var gE=pE,mE=pf.extendShape({shape:{polyline:!1,segs:[]},buildPath:function(t,e){for(var i=e.segs,n=e.polyline,r=0;r<i.length;r++){var o=i[r];if(n){t.moveTo(o[0][0],o[0][1]);for(var a=1;a<o.length;a++)t.lineTo(o[a][0],o[a][1])}else t.moveTo(o[0][0],o[0][1]),2<o.length?t.quadraticCurveTo(o[2][0],o[2][1],o[1][0],o[1][1]):t.lineTo(o[1][0],o[1][1])}},findDataIndex:function(t,e){for(var i=this.shape,n=i.segs,r=i.polyline,o=Math.max(this.style.lineWidth,1),a=0;a<n.length;a++){var s=n[a];if(r){for(var l=1;l<s.length;l++)if(qu.containStroke(s[l-1][0],s[l-1][1],s[l][0],s[l][1],o,t,e))return a}else if(2<s.length){if(Ku.containStroke(s[0][0],s[0][1],s[2][0],s[2][1],s[1][0],s[1][1],o,t,e))return a}else if(qu.containStroke(s[0][0],s[0][1],s[1][0],s[1][1],o,t,e))return a}return-1}});function vE(){this.group=new pf.Group,this._lineEl=new mE}var yE=vE.prototype;yE.updateData=function(t){this.group.removeAll();var i=this._lineEl,e=t.hostModel;i.setShape({segs:t.mapArray(t.getItemLayout),polyline:e.get("polyline")}),i.useStyle(e.getModel("lineStyle.normal").getLineStyle());var n=t.getVisual("color");n&&i.setStyle("stroke",n),i.setStyle("fill"),i.seriesIndex=e.seriesIndex,i.on("mousemove",function(t){i.dataIndex=null;var e=i.findDataIndex(t.offsetX,t.offsetY);0<e&&(i.dataIndex=e)}),this.group.add(i)},yE.updateLayout=function(t){var e=t.getData();this._lineEl.setShape({segs:e.mapArray(e.getItemLayout)})},yE.remove=function(){this.group.removeAll()};var _E=vE;fy.extendChartView({type:"lines",init:function(){},render:function(t,e,i){var n=t.getData(),r=this._lineDraw,o=t.get("effect.show"),a=t.get("polyline"),s=t.get("large")&&n.count()>=t.get("largeThreshold");o===this._hasEffet&&a===this._isPolyline&&s===this._isLarge||(r&&r.remove(),r=this._lineDraw=s?new _E:new RS(a?o?gE:dE:o?hE:AS),this._hasEffet=o,this._isPolyline=a,this._isLarge=s);var l=t.get("zlevel"),h=t.get("effect.trailLength"),c=i.getZr(),u="svg"===c.painter.getType();u||c.painter.getLayer(l).clear(!0),null==this._lastZlevel||u||c.configLayer(this._lastZlevel,{motionBlur:!1}),o&&h&&(u||c.configLayer(l,{motionBlur:!0,lastFrameAlpha:Math.max(Math.min(h/10+.9,1),0)})),this.group.add(r.group),r.updateData(n),this._lastZlevel=l},updateLayout:function(t,e,i){this._lineDraw.updateLayout(t);var n=i.getZr();"svg"===n.painter.getType()||n.painter.getLayer(this._lastZlevel).clear(!0)},remove:function(t,e){this._lineDraw&&this._lineDraw.remove(e,!0);var i=e.getZr();"svg"===i.painter.getType()||i.painter.getLayer(this._lastZlevel).clear(!0)},dispose:function(){}});var xE=function(t){t.eachSeriesByType("lines",function(a){var s=a.coordinateSystem,l=a.getData();l.each(function(t){var e=l.getItemModel(t),i=e.option instanceof Array?e.option:e.get("coords"),n=[];if(a.get("polyline"))for(var r=0;r<i.length;r++)n.push(s.dataToPoint(i[r]));else{n[0]=s.dataToPoint(i[0]),n[1]=s.dataToPoint(i[1]);var o=e.get("lineStyle.normal.curveness");+o&&(n[2]=[(n[0][0]+n[1][0])/2-(n[0][1]-n[1][1])*o,(n[0][1]+n[1][1])/2-(n[1][0]-n[0][0])*o])}l.setItemLayout(t,n)})})};function wE(t){return t instanceof Array||(t=[t,t]),t}var bE=function(t){t.eachSeriesByType("lines",function(t){var o=t.getData(),e=wE(t.get("symbol")),i=wE(t.get("symbolSize")),a="lineStyle.normal.opacity".split(".");o.setVisual("fromSymbol",e&&e[0]),o.setVisual("toSymbol",e&&e[1]),o.setVisual("fromSymbolSize",i&&i[0]),o.setVisual("toSymbolSize",i&&i[1]),o.setVisual("opacity",t.get(a)),o.each(function(t){var e=o.getItemModel(t),i=wE(e.getShallow("symbol",!0)),n=wE(e.getShallow("symbolSize",!0)),r=e.get(a);i[0]&&o.setItemVisual(t,"fromSymbol",i[0]),i[1]&&o.setItemVisual(t,"toSymbol",i[1]),n[0]&&o.setItemVisual(t,"fromSymbolSize",n[0]),n[1]&&o.setItemVisual(t,"toSymbolSize",n[1]),o.setItemVisual(t,"opacity",r)})})};fy.registerLayout(xE),fy.registerVisual(bE);Qg.extend({type:"series.heatmap",getInitialData:function(t,e){return Xm(t.data,this,e)},defaultOption:{coordinateSystem:"cartesian2d",zlevel:0,z:2,geoIndex:0,blurSize:30,pointSize:20,maxOpacity:1,minOpacity:0}});function ME(){var t=za.createCanvas();this.canvas=t,this.blurSize=30,this.pointSize=20,this.maxOpacity=1,this.minOpacity=0,this._gradientPixels={}}ME.prototype={update:function(t,e,i,n,r,o){var a=this._getBrush(),s=this._getGradient(t,r,"inRange"),l=this._getGradient(t,r,"outOfRange"),h=this.pointSize+this.blurSize,c=this.canvas,u=c.getContext("2d"),d=t.length;c.width=e,c.height=i;for(var p=0;p<d;++p){var f=t[p],g=f[0],m=f[1],v=n(f[2]);u.globalAlpha=v,u.drawImage(a,g-h,m-h)}if(!c.width||!c.height)return c;for(var y=u.getImageData(0,0,c.width,c.height),_=y.data,x=0,w=_.length,b=this.minOpacity,M=this.maxOpacity-b;x<w;){v=_[x+3]/256;var S=4*Math.floor(255*v);if(0<v){var T=o(v)?s:l;0<v&&(v=v*M+b),_[x++]=T[S],_[x++]=T[S+1],_[x++]=T[S+2],_[x++]=T[S+3]*v*256}else x+=4}return u.putImageData(y,0,0),c},_getBrush:function(){var t=this._brushCanvas||(this._brushCanvas=za.createCanvas()),e=this.pointSize+this.blurSize,i=2*e;t.width=i,t.height=i;var n=t.getContext("2d");return n.clearRect(0,0,i,i),n.shadowOffsetX=i,n.shadowBlur=this.blurSize,n.shadowColor="#000",n.beginPath(),n.arc(-e,e,this.pointSize,0,2*Math.PI,!0),n.closePath(),n.fill(),t},_getGradient:function(t,e,i){for(var n=this._gradientPixels,r=n[i]||(n[i]=new Uint8ClampedArray(1024)),o=[0,0,0,0],a=0,s=0;s<256;s++)e[i](s/255,!0,o),r[a++]=o[0],r[a++]=o[1],r[a++]=o[2],r[a++]=o[3];return r}};var SE=ME;fy.extendChartView({type:"heatmap",render:function(i,t,e){var n;t.eachComponent("visualMap",function(e){e.eachTargetSeries(function(t){t===i&&(n=e)})}),this.group.removeAll();var r,o=i.coordinateSystem;"cartesian2d"===o.type||"calendar"===o.type?this._renderOnCartesianAndCalendar(o,i,e):"lng"===(r=o.dimensions)[0]&&"lat"===r[1]&&this._renderOnGeo(o,i,n,e)},dispose:function(){},_renderOnCartesianAndCalendar:function(a,s,t){if("cartesian2d"===a.type)var e=a.getAxis("x"),i=a.getAxis("y"),l=e.getBandWidth(),h=i.getBandWidth();var c=this.group,u=s.getData(),d="itemStyle.normal",p="itemStyle.emphasis",f=s.getModel(d).getItemStyle(["color"]),g=s.getModel(p).getItemStyle(),m=s.getModel("label.normal"),v=s.getModel("label.emphasis"),y=a.type,_="cartesian2d"===y?[s.coordDimToDataDim("x")[0],s.coordDimToDataDim("y")[0],s.coordDimToDataDim("value")[0]]:[s.coordDimToDataDim("time")[0],s.coordDimToDataDim("value")[0]];u.each(function(t){var e;if("cartesian2d"===y){if(isNaN(u.get(_[2],t)))return;var i=a.dataToPoint([u.get(_[0],t),u.get(_[1],t)]);e=new pf.Rect({shape:{x:i[0]-l/2,y:i[1]-h/2,width:l,height:h},style:{fill:u.getItemVisual(t,"color"),opacity:u.getItemVisual(t,"opacity")}})}else{if(isNaN(u.get(_[1],t)))return;e=new pf.Rect({z2:1,shape:a.dataToRect([u.get(_[0],t)]).contentShape,style:{fill:u.getItemVisual(t,"color"),opacity:u.getItemVisual(t,"opacity")}})}var n=u.getItemModel(t);u.hasItemOption&&(f=n.getModel(d).getItemStyle(["color"]),g=n.getModel(p).getItemStyle(),m=n.getModel("label.normal"),v=n.getModel("label.emphasis"));var r=s.getRawValue(t),o="-";r&&null!=r[2]&&(o=r[2]),pf.setLabelStyle(f,g,m,v,{labelFetcher:s,labelDataIndex:t,defaultText:o,isRectText:!0}),e.setStyle(f),pf.setHoverStyle(e,u.hasItemOption?g:za.extend({},g)),c.add(e),u.setItemGraphicEl(t,e)})},_renderOnGeo:function(r,t,e,i){var n=e.targetVisuals.inRange,o=e.targetVisuals.outOfRange,a=t.getData(),s=this._hmLayer||this._hmLayer||new SE;s.blurSize=t.get("blurSize"),s.pointSize=t.get("pointSize"),s.minOpacity=t.get("minOpacity"),s.maxOpacity=t.get("maxOpacity");var l=r.getViewRect().clone(),h=r.getRoamTransform().transform;l.applyTransform(h);var c,u,d,p,f,g,m,v,y,_=Math.max(l.x,0),x=Math.max(l.y,0),w=Math.min(l.width+l.x,i.getWidth()),b=Math.min(l.height+l.y,i.getHeight()),M=w-_,S=b-x,T=a.mapArray(["lng","lat","value"],function(t,e,i){var n=r.dataToPoint([t,e]);return n[0]-=_,n[1]-=x,n.push(i),n}),C=e.getExtent(),A="visualMap.continuous"===e.type?(m=C,v=e.option.range,y=m[1]-m[0],v=[(v[0]-m[0])/y,(v[1]-m[0])/y],function(t){return t>=v[0]&&t<=v[1]}):(c=C,u=e.getPieceList(),d=e.option.selected,p=c[1]-c[0],f=(u=za.map(u,function(t){return{interval:[(t.interval[0]-c[0])/p,(t.interval[1]-c[0])/p]}})).length,g=0,function(t){for(var e=g;e<f;e++)if((i=u[e].interval)[0]<=t&&t<=i[1]){g=e;break}if(e===f)for(e=g-1;0<=e;e--){var i;if((i=u[e].interval)[0]<=t&&t<=i[1]){g=e;break}}return 0<=e&&e<f&&d[e]});s.update(T,M,S,n.color.getNormalizer(),{inRange:n.color.getColorMapper(),outOfRange:o.color.getColorMapper()},A);var E=new pf.Image({style:{width:M,height:S,x:_,y:x,image:s.canvas},silent:!0});this.group.add(E)}});var TE=Cx.extend({type:"series.pictorialBar",dependencies:["grid"],defaultOption:{symbol:"circle",symbolSize:null,symbolRotate:null,symbolPosition:null,symbolOffset:null,symbolMargin:null,symbolRepeat:!1,symbolRepeatDirection:"end",symbolClip:!1,symbolBoundingData:null,symbolPatternSize:400,barGap:"-100%",progressive:0,hoverAnimation:!1},getInitialData:function(t){return t.stack=null,TE.superApply(this,"getInitialData",arguments)}}),CE=Bv.createSymbol,AE=Uc.parsePercent,EE=Uc.isNumeric,PE=Ex.setLabel,LE=["itemStyle","normal","borderWidth"],IE=[{xy:"x",wh:"width",index:0,posDesc:["left","right"]},{xy:"y",wh:"height",index:1,posDesc:["top","bottom"]}],RE=new pf.Circle;fy.extendChartView({type:"pictorialBar",render:function(t,e,i){var a=this.group,s=t.getData(),l=this._data,n=t.coordinateSystem,r=!!n.getBaseAxis().isHorizontal(),o=n.grid.getRect(),h={ecSize:{width:i.getWidth(),height:i.getHeight()},seriesModel:t,coordSys:n,coordSysExtent:[[o.x,o.x+o.width],[o.y,o.y+o.height]],isHorizontal:r,valueDim:IE[+r],categoryDim:IE[1-r]};return s.diff(l).add(function(t){if(s.hasValue(t)){var e=GE(s,t),i=DE(s,t,e,h),n=WE(s,h,i);s.setItemGraphicEl(t,n),a.add(n),YE(n,h,i)}}).update(function(t,e){var i=l.getItemGraphicEl(e);if(s.hasValue(t)){var n=GE(s,t),r=DE(s,t,n,h),o=ZE(s,r);i&&o!==i.__pictorialShapeStr&&(a.remove(i),s.setItemGraphicEl(t,null),i=null),i?function(t,e,i){var n=i.animationModel,r=i.dataIndex,o=t.__pictorialBundle;pf.updateProps(o,{position:i.bundlePosition.slice()},n,r),i.symbolRepeat?zE(t,e,i,!0):NE(t,e,i,!0);BE(t,i,!0),FE(t,e,i,!0)}(i,h,r):i=WE(s,h,r,!0),s.setItemGraphicEl(t,i),i.__pictorialSymbolMeta=r,a.add(i),YE(i,h,r)}else a.remove(i)}).remove(function(t){var e=l.getItemGraphicEl(t);e&&jE(l,t,e.__pictorialSymbolMeta.animationModel,e)}).execute(),this._data=s,this.group},dispose:za.noop,remove:function(e,t){var i=this.group,n=this._data;e.get("animation")?n&&n.eachItemGraphicEl(function(t){jE(n,t.dataIndex,e,t)}):i.removeAll()}});function DE(t,e,i,n){var r=t.getItemLayout(e),o=i.get("symbolRepeat"),a=i.get("symbolClip"),s=i.get("symbolPosition")||"start",l=(i.get("symbolRotate")||0)*Math.PI/180||0,h=i.get("symbolPatternSize")||2,c=i.isAnimationEnabled(),u={dataIndex:e,layout:r,itemModel:i,symbolType:t.getItemVisual(e,"symbol")||"circle",color:t.getItemVisual(e,"color"),symbolClip:a,symbolRepeat:o,symbolRepeatDirection:i.get("symbolRepeatDirection"),symbolPatternSize:h,rotation:l,animationModel:c?i:null,hoverAnimation:c&&i.get("hoverAnimation"),z2:i.getShallow("z",!0)||0};!function(t,e,i,n,r){var o,a=n.valueDim,s=t.get("symbolBoundingData"),l=n.coordSys.getOtherAxis(n.coordSys.getBaseAxis()),h=l.toGlobalCoord(l.dataToCoord(0)),c=1-+(i[a.wh]<=0);if(za.isArray(s)){var u=[OE(l,s[0])-h,OE(l,s[1])-h];u[1]<u[0]&&u.reverse(),o=u[c]}else o=null!=s?OE(l,s)-h:e?n.coordSysExtent[a.index][c]-h:i[a.wh];r.boundingLength=o,e&&(r.repeatCutLength=i[a.wh]);r.pxSign=0<o?1:o<0?-1:0}(i,o,r,n,u),function(t,e,i,n,r,o,a,s,l,h){var c=l.valueDim,u=l.categoryDim,d=Math.abs(i[u.wh]),p=t.getItemVisual(e,"symbolSize");za.isArray(p)?p=p.slice():(null==p&&(p="100%"),p=[p,p]);p[u.index]=AE(p[u.index],d),p[c.index]=AE(p[c.index],n?d:Math.abs(o)),h.symbolSize=p,(h.symbolScale=[p[0]/s,p[1]/s])[c.index]*=(l.isHorizontal?-1:1)*a}(t,e,r,o,0,u.boundingLength,u.pxSign,h,n,u),function(t,e,i,n,r){var o=t.get(LE)||0;o&&(RE.attr({scale:e.slice(),rotation:i}),RE.updateTransform(),o/=RE.getLineScale(),o*=e[n.valueDim.index]);r.valueLineWidth=o}(i,u.symbolScale,l,n,u);var d=u.symbolSize,p=i.get("symbolOffset");return za.isArray(p)&&(p=[AE(p[0],d[0]),AE(p[1],d[1])]),function(t,e,i,n,r,o,a,s,l,h,c,u){var d=c.categoryDim,p=c.valueDim,f=u.pxSign,g=Math.max(e[p.index]+s,0),m=g;if(n){var v=Math.abs(l),y=za.retrieve(t.get("symbolMargin"),"15%")+"",_=!1;y.lastIndexOf("!")===y.length-1&&(_=!0,y=y.slice(0,y.length-1)),y=AE(y,e[p.index]);var x=Math.max(g+2*y,0),w=_?0:2*y,b=EE(n),M=b?n:JE((v+w)/x),S=v-M*g;x=g+2*(y=S/2/(_?M:M-1)),w=_?0:2*y,b||"fixed"===n||(M=h?JE((Math.abs(h)+w)/x):0),m=M*x-w,u.repeatTimes=M,u.symbolMargin=y}var T=f*(m/2),C=u.pathPosition=[];C[d.index]=i[d.wh]/2,C[p.index]="start"===a?T:"end"===a?l-T:l/2,o&&(C[0]+=o[0],C[1]+=o[1]);var A=u.bundlePosition=[];A[d.index]=i[d.xy],A[p.index]=i[p.xy];var E=u.barRectShape=za.extend({},i);E[p.wh]=f*Math.max(Math.abs(i[p.wh]),Math.abs(C[p.index]+T)),E[d.wh]=i[d.wh];var P=u.clipShape={};P[d.xy]=-i[d.xy],P[d.wh]=c.ecSize[d.wh],P[p.xy]=0,P[p.wh]=i[p.wh]}(i,d,r,o,0,p,s,u.valueLineWidth,u.boundingLength,u.repeatCutLength,n,u),u}function OE(t,e){return t.toGlobalCoord(t.dataToCoord(t.scale.parse(e)))}function kE(t){var e=t.symbolPatternSize,i=CE(t.symbolType,-e/2,-e/2,e,e,t.color);return i.attr({culling:!0}),"image"!==i.type&&i.setStyle({strokeNoScale:!0}),i}function zE(t,e,r,i){var n=t.__pictorialBundle,o=r.symbolSize,a=r.valueLineWidth,s=r.pathPosition,l=e.valueDim,h=r.repeatTimes||0,c=0,u=o[e.valueDim.index]+a+2*r.symbolMargin;for(XE(t,function(t){t.__pictorialAnimationIndex=c,t.__pictorialRepeatTimes=h,c<h?qE(t,null,f(c),r,i):qE(t,null,{scale:[0,0]},r,i,function(){n.remove(t)}),UE(t,r),c++});c<h;c++){var d=kE(r);d.__pictorialAnimationIndex=c,d.__pictorialRepeatTimes=h,n.add(d);var p=f(c);qE(d,{position:p.position,scale:[0,0]},{scale:p.scale,rotation:p.rotation},r,i),d.on("mouseover",g).on("mouseout",m),UE(d,r)}function f(t){var e=s.slice(),i=r.pxSign,n=t;return("start"===r.symbolRepeatDirection?0<i:i<0)&&(n=h-1-t),e[l.index]=u*(n-h/2+.5)+s[l.index],{position:e,scale:r.symbolScale.slice(),rotation:r.rotation}}function g(){XE(t,function(t){t.trigger("emphasis")})}function m(){XE(t,function(t){t.trigger("normal")})}}function NE(t,e,i,n){var r=t.__pictorialBundle,o=t.__pictorialMainPath;o?qE(o,null,{position:i.pathPosition.slice(),scale:i.symbolScale.slice(),rotation:i.rotation},i,n):(o=t.__pictorialMainPath=kE(i),r.add(o),qE(o,{position:i.pathPosition.slice(),scale:[0,0],rotation:i.rotation},{scale:i.symbolScale.slice()},i,n),o.on("mouseover",function(){this.trigger("emphasis")}).on("mouseout",function(){this.trigger("normal")})),UE(o,i)}function BE(t,e,i){var n=za.extend({},e.barRectShape),r=t.__pictorialBarRect;r?qE(r,null,{shape:n},e,i):(r=t.__pictorialBarRect=new pf.Rect({z2:2,shape:n,silent:!0,style:{stroke:"transparent",fill:"transparent",lineWidth:0}}),t.add(r))}function FE(t,e,i,n){if(i.symbolClip){var r=t.__pictorialClipPath,o=za.extend({},i.clipShape),a=e.valueDim,s=i.animationModel,l=i.dataIndex;if(r)pf.updateProps(r,{shape:o},s,l);else{o[a.wh]=0,r=new pf.Rect({shape:o}),t.__pictorialBundle.setClipPath(r),t.__pictorialClipPath=r;var h={};h[a.wh]=i.clipShape[a.wh],pf[n?"updateProps":"initProps"](r,{shape:h},s,l)}}}function GE(t,e){var i=t.getItemModel(e);return i.getAnimationDelayParams=VE,i.isAnimationEnabled=HE,i}function VE(t){return{index:t.__pictorialAnimationIndex,count:t.__pictorialRepeatTimes}}function HE(){return this.parentModel.isAnimationEnabled()&&!!this.getShallow("animation")}function UE(t,e){t.off("emphasis").off("normal");var i=e.symbolScale.slice();e.hoverAnimation&&t.on("emphasis",function(){this.animateTo({scale:[1.1*i[0],1.1*i[1]]},400,"elasticOut")}).on("normal",function(){this.animateTo({scale:i.slice()},400,"elasticOut")})}function WE(t,e,i,n){var r=new pf.Group,o=new pf.Group;return r.add(o),(r.__pictorialBundle=o).attr("position",i.bundlePosition.slice()),i.symbolRepeat?zE(r,e,i):NE(r,0,i),BE(r,i,n),FE(r,e,i,n),r.__pictorialShapeStr=ZE(t,i),r.__pictorialSymbolMeta=i,r}function jE(t,e,i,n){var r=n.__pictorialBarRect;r&&(r.style.text=null);var o=[];XE(n,function(t){o.push(t)}),n.__pictorialMainPath&&o.push(n.__pictorialMainPath),n.__pictorialClipPath&&(i=null),za.each(o,function(t){pf.updateProps(t,{scale:[0,0]},i,e,function(){n.parent&&n.parent.remove(n)})}),t.setItemGraphicEl(e,null)}function ZE(t,e){return[t.getItemVisual(e.dataIndex,"symbol")||"none",!!e.symbolRepeat,!!e.symbolClip].join(":")}function XE(e,i,n){za.each(e.__pictorialBundle.children(),function(t){t!==e.__pictorialBarRect&&i.call(n,t)})}function qE(t,e,i,n,r,o){e&&t.attr(e),n.symbolClip&&!r?i&&t.attr(i):i&&pf[r?"updateProps":"initProps"](t,i,n.animationModel,n.dataIndex,o)}function YE(t,e,i){var n=i.color,r=i.dataIndex,o=i.itemModel,a=o.getModel("itemStyle.normal").getItemStyle(["color"]),s=o.getModel("itemStyle.emphasis").getItemStyle(),l=o.getShallow("cursor");XE(t,function(t){t.setColor(n),t.setStyle(za.defaults({fill:n,opacity:i.opacity},a)),pf.setHoverStyle(t,s),l&&(t.cursor=l),t.z2=i.z2});var h={},c=e.valueDim.posDesc[+(0<i.boundingLength)],u=t.__pictorialBarRect;PE(u.style,h,o,n,e.seriesModel,r,c),pf.setHoverStyle(u,h)}function JE(t){var e=Math.round(t);return Math.abs(t-e)<1e-4?e:Math.ceil(t)}fy.registerLayout(za.curry(Tx,"pictorialBar")),fy.registerVisual(za.curry(e_,"pictorialBar","roundRect",null));var KE=function(t,e,i,n,r){Wv.call(this,t,e,i),this.type=n||"value",this.position=r||"bottom",this.orient=null,this._labelInterval=null};KE.prototype={constructor:KE,model:null,isHorizontal:function(){var t=this.position;return"top"===t||"bottom"===t},pointToData:function(t,e){return this.coordinateSystem.pointToData(t,e)[0]},toGlobalCoord:null,toLocalCoord:null},za.inherits(KE,Wv);var QE=KE,$E=jf.getLayoutRect;function tP(t,e,i){this.dimension="single",this.dimensions=["single"],this._axis=null,this._rect,this._init(t,e,i),this.model=t}tP.prototype={type:"singleAxis",axisPointerEnabled:!0,constructor:tP,_init:function(t,e,i){var n=this.dimension,r=new QE(n,Cv.createScaleByModel(t),[0,0],t.get("type"),t.get("position")),o="category"===r.type;r.onBand=o&&t.get("boundaryGap"),r.inverse=t.get("inverse"),r.orient=t.get("orient"),(t.axis=r).model=t,(r.coordinateSystem=this)._axis=r},update:function(t,e){t.eachSeries(function(t){if(t.coordinateSystem===this){var e=t.getData(),i=this.dimension;this._axis.scale.unionExtentFromData(e,t.coordDimToDataDim(i)),Cv.niceScaleExtent(this._axis.scale,this._axis.model)}},this)},resize:function(t,e){this._rect=$E({left:t.get("left"),top:t.get("top"),right:t.get("right"),bottom:t.get("bottom"),width:t.get("width"),height:t.get("height")},{width:e.getWidth(),height:e.getHeight()}),this._adjustAxis()},getRect:function(){return this._rect},_adjustAxis:function(){var t=this._rect,e=this._axis,i=e.isHorizontal(),n=i?[0,t.width]:[0,t.height],r=e.reverse?1:0;e.setExtent(n[r],n[1-r]),this._updateAxisTransform(e,i?t.x:t.y)},_updateAxisTransform:function(t,e){var i=t.getExtent(),n=i[0]+i[1],r=t.isHorizontal();t.toGlobalCoord=r?function(t){return t+e}:function(t){return n-t+e},t.toLocalCoord=r?function(t){return t-e}:function(t){return n-t+e}},getAxis:function(){return this._axis},getBaseAxis:function(){return this._axis},getAxes:function(){return[this._axis]},getTooltipAxes:function(){return{baseAxes:[this.getAxis()]}},containPoint:function(t){var e=this.getRect(),i=this.getAxis();return"horizontal"===i.orient?i.contain(i.toLocalCoord(t[0]))&&t[1]>=e.y&&t[1]<=e.y+e.height:i.contain(i.toLocalCoord(t[1]))&&t[0]>=e.y&&t[0]<=e.y+e.height},pointToData:function(t){var e=this.getAxis();return[e.coordToData(e.toLocalCoord(t["horizontal"===e.orient?0:1]))]},dataToPoint:function(t){var e=this.getAxis(),i=this.getRect(),n=[],r="horizontal"===e.orient?0:1;return t instanceof Array&&(t=t[0]),n[r]=e.toGlobalCoord(e.dataToCoord(+t)),n[1-r]=0===r?i.y+i.height/2:i.x+i.width/2,n}};var eP=tP;mg.register("single",{create:function(n,r){var o=[];return n.eachComponent("singleAxis",function(t,e){var i=new eP(t,n,r);i.name="single_"+e,i.resize(t,r),t.coordinateSystem=i,o.push(i)}),n.eachSeries(function(t){if("singleAxis"===t.get("coordinateSystem")){var e=n.queryComponents({mainType:"singleAxis",index:t.get("singleAxisIndex"),id:t.get("singleAxisId")})[0];t.coordinateSystem=e&&e.coordinateSystem}}),o},dimensions:eP.prototype.dimensions});var iP={layout:function(t,e){e=e||{};var i=t.coordinateSystem,n=t.axis,r={},o=n.position,a=n.orient,s=i.getRect(),l=[s.x,s.x+s.width,s.y,s.y+s.height],h={horizontal:{top:l[2],bottom:l[3]},vertical:{left:l[0],right:l[1]}};r.position=["vertical"===a?h.vertical[o]:l[0],"horizontal"===a?h.horizontal[o]:l[3]],r.rotation=Math.PI/2*{horizontal:0,vertical:1}[a],r.labelDirection=r.tickDirection=r.nameDirection={top:-1,bottom:1,right:1,left:-1}[o],t.get("axisTick.inside")&&(r.tickDirection=-r.tickDirection),za.retrieve(e.labelInside,t.get("axisLabel.inside"))&&(r.labelDirection=-r.labelDirection);var c=e.rotate;return null==c&&(c=t.get("axisLabel.rotate")),r.labelRotation="top"===o?-c:c,r.labelInterval=n.getLabelInterval(),r.z2=1,r}},nP=tx.getInterval,rP=tx.ifIgnoreOnTick,oP=["axisLine","axisTickLabel","axisName"],aP="splitLine",sP=dx.extend({type:"singleAxis",axisPointerClass:"SingleAxisPointer",render:function(t,e,i,n){var r=this.group;r.removeAll();var o=iP.layout(t),a=new tx(t,o);za.each(oP,a.add,a),r.add(a.getGroup()),t.get(aP+".show")&&this["_"+aP](t,o.labelInterval),sP.superCall(this,"render",t,e,i,n)},_splitLine:function(t,e){var i=t.axis;if(!i.scale.isBlank()){var n=t.getModel("splitLine"),r=n.getModel("lineStyle"),o=r.get("width"),a=r.get("color"),s=nP(n,e);a=a instanceof Array?a:[a];for(var l=t.coordinateSystem.getRect(),h=i.isHorizontal(),c=[],u=0,d=i.getTicksCoords(),p=[],f=[],g=t.get("axisLabel.showMinLabel"),m=t.get("axisLabel.showMaxLabel"),v=0;v<d.length;++v)if(!rP(i,v,s,d.length,g,m)){var y=i.toGlobalCoord(d[v]);h?(p[0]=y,p[1]=l.y,f[0]=y,f[1]=l.y+l.height):(p[0]=l.x,p[1]=y,f[0]=l.x+l.width,f[1]=y);var _=u++%a.length;c[_]=c[_]||[],c[_].push(new pf.Line(pf.subPixelOptimizeLine({shape:{x1:p[0],y1:p[1],x2:f[0],y2:f[1]},style:{lineWidth:o},silent:!0})))}for(v=0;v<c.length;++v)this.group.add(pf.mergePath(c[v],{style:{stroke:a[v%a.length],lineDash:r.getLineDash(o),lineWidth:o},silent:!0}))}}}),lP=Yf.extend({type:"singleAxis",layoutMode:"box",axis:null,coordinateSystem:null,getCoordSysModel:function(){return this}});za.merge(lP.prototype,Ev),__("single",lP,function(t,e){return e.type||(e.data?"category":"value")},{left:"5%",top:"5%",right:"5%",bottom:"5%",type:"value",position:"bottom",orient:"horizontal",axisLine:{show:!0,lineStyle:{width:2,type:"solid"}},tooltip:{show:!0},axisTick:{show:!0,length:6,lineStyle:{width:2}},axisLabel:{show:!0,interval:"auto"},splitLine:{show:!0,lineStyle:{type:"dashed",opacity:.2}}});var hP=function(t,e){var i,n=[],r=t.seriesIndex;if(null==r||!(i=e.getSeriesByIndex(r)))return{point:[]};var o=i.getData(),a=If.queryDataIndex(o,t);if(null==a||za.isArray(a))return{point:[]};var s=o.getItemGraphicEl(a),l=i.coordinateSystem;if(i.getTooltipPosition)n=i.getTooltipPosition(a)||[];else if(l&&l.dataToPoint)n=l.dataToPoint(o.getValues(za.map(l.dimensions,function(t){return i.coordDimToDataDim(t)[0]}),a,!0))||[];else if(s){var h=s.getBoundingRect().clone();h.applyTransform(s.transform),n=[h.x+h.width/2,h.y+h.height/2]}return{point:n,el:s}},cP=za.each,uP=za.curry,dP=If.makeGetter();function pP(t,e,i,n,r){var o=t.axis;if(!o.scale.isBlank()&&o.containData(e))if(t.involveSeries){var l,a,h,c,u,d,p,f,s=(l=e,h=(a=t).axis,c=h.dim,u=l,d=[],p=Number.MAX_VALUE,f=-1,cP(a.seriesModels,function(e,t){var i,n,r=e.coordDimToDataDim(c);if(e.getAxisTooltipData){var o=e.getAxisTooltipData(r,l,h);n=o.dataIndices,i=o.nestestValue}else{if(!(n=e.getData().indicesOfNearest(r[0],l,!1,"category"===h.type?.5:null)).length)return;i=e.getData().get(r[0],n[0])}if(null!=i&&isFinite(i)){var a=l-i,s=Math.abs(a);s<=p&&((s<p||0<=a&&f<0)&&(p=s,f=a,u=i,d.length=0),cP(n,function(t){d.push({seriesIndex:e.seriesIndex,dataIndexInside:t,dataIndex:e.getData().getRawIndex(t)})}))}}),{payloadBatch:d,snapToValue:u}),g=s.payloadBatch,m=s.snapToValue;g[0]&&null==r.seriesIndex&&za.extend(r,g[0]),!n&&t.snap&&o.containData(m)&&null!=m&&(e=m),i.showPointer(t,e,g,r),i.showTooltip(t,s,m)}else i.showPointer(t,e)}function fP(t,e,i,n){t[e.key]={value:i,payloadBatch:n}}function gP(t,e,i,n){var r=i.payloadBatch,o=e.axis,a=o.model,s=e.axisPointerModel;if(e.triggerTooltip&&r.length){var l=e.coordSys.model,h=sx.makeKey(l),c=t.map[h];c||(c=t.map[h]={coordSysId:l.id,coordSysIndex:l.componentIndex,coordSysType:l.type,coordSysMainType:l.mainType,dataByAxis:[]},t.list.push(c)),c.dataByAxis.push({axisDim:o.dim,axisIndex:a.componentIndex,axisType:a.type,axisId:a.id,value:n,valueLabelOpt:{precision:s.get("label.precision"),formatter:s.get("label.formatter")},seriesDataIndices:r.slice()})}}function mP(t){var e=t.axis.model,i={},n=i.axisDim=t.axis.dim;return i.axisIndex=i[n+"AxisIndex"]=e.componentIndex,i.axisName=i[n+"AxisName"]=e.name,i.axisId=i[n+"AxisId"]=e.id,i}function vP(t){return!t||null==t[0]||isNaN(t[0])||null==t[1]||isNaN(t[1])}var yP=function(t,e,i){var n=t.currTrigger,a=[t.x,t.y],r=t,o=t.dispatchAction||za.bind(i.dispatchAction,i),s=e.getComponent("axisPointer").coordSysAxesInfo;if(s){vP(a)&&(a=hP({seriesIndex:r.seriesIndex,dataIndex:r.dataIndex},e).point);var l=vP(a),h=r.axesInfo,c=s.axesInfo,u="leave"===n||vP(a),d={},p={},f={list:[],map:{}},g={showPointer:uP(fP,p),showTooltip:uP(gP,f)};cP(s.coordSysMap,function(t,e){var o=l||t.containPoint(a);cP(s.coordSysAxesInfo[e],function(t,e){var i=t.axis,n=function(t,e){for(var i=0;i<(t||[]).length;i++){var n=t[i];if(e.axis.dim===n.axisDim&&e.axis.model.componentIndex===n.axisIndex)return n}}(h,t);if(!u&&o&&(!h||n)){var r=n&&n.value;null!=r||l||(r=i.pointToData(a)),null!=r&&pP(t,r,g,!1,d)}})});var m,v,y,_={};return cP(c,function(r,t){var o=r.linkGroup;o&&!p[t]&&cP(o.axesInfo,function(t,e){var i=p[e];if(t!==r&&i){var n=i.value;o.mapper&&(n=r.axis.scale.parse(o.mapper(n,mP(t),mP(r)))),_[r.key]=n}})}),cP(_,function(t,e){pP(c[e],t,g,!0,d)}),m=p,v=c,y=d.axesInfo=[],cP(v,function(t,e){var i=t.axisPointerModel.option,n=m[e];n?(!t.useHandle&&(i.status="show"),i.value=n.value,i.seriesDataIndices=(n.payloadBatch||[]).slice()):!t.useHandle&&(i.status="hide"),"show"===i.status&&y.push({axisDim:t.axis.dim,axisIndex:t.axis.model.componentIndex,value:i.value})}),function(t,e,i,n){if(vP(e)||!t.list.length)return n({type:"hideTip"});var r=((t.list[0].dataByAxis[0]||{}).seriesDataIndices||[])[0]||{};n({type:"showTip",escapeConnect:!0,x:e[0],y:e[1],tooltipOption:i.tooltipOption,position:i.position,dataIndexInside:r.dataIndexInside,dataIndex:r.dataIndex,seriesIndex:r.seriesIndex,dataByCoordSys:t.list})}(f,a,t,o),function(t,e,i){var n=i.getZr(),r="axisPointerLastHighlights",o=dP(n)[r]||{},a=dP(n)[r]={};cP(t,function(t,e){var i=t.axisPointerModel.option;"show"===i.status&&cP(i.seriesDataIndices,function(t){var e=t.seriesIndex+" | "+t.dataIndex;a[e]=t})});var s=[],l=[];za.each(o,function(t,e){!a[e]&&l.push(t)}),za.each(a,function(t,e){!o[e]&&s.push(t)}),l.length&&i.dispatchAction({type:"downplay",escapeConnect:!0,batch:l}),s.length&&i.dispatchAction({type:"highlight",escapeConnect:!0,batch:s})}(c,0,i),d}},_P=(fy.extendComponentModel({type:"axisPointer",coordSysAxesInfo:null,defaultOption:{show:"auto",triggerOn:null,zlevel:0,z:50,type:"line",snap:!1,triggerTooltip:!0,value:null,status:null,link:[],animation:null,animationDurationUpdate:200,lineStyle:{color:"#aaa",width:1,type:"solid"},shadowStyle:{color:"rgba(150,150,150,0.3)"},label:{show:!0,formatter:null,precision:"auto",margin:3,color:"#fff",padding:[5,7,5,7],backgroundColor:"auto",borderColor:null,borderWidth:0,shadowBlur:3,shadowColor:"#aaa"},handle:{show:!1,icon:"M10.7,11.9v-1.3H9.3v1.3c-4.9,0.3-8.8,4.4-8.8,9.4c0,5,3.9,9.1,8.8,9.4h1.3c4.9-0.3,8.8-4.4,8.8-9.4C19.5,16.3,15.6,12.2,10.7,11.9z M13.3,24.4H6.7v-1.2h6.6z M13.3,22H6.7v-1.2h6.6z M13.3,19.6H6.7v-1.2h6.6z",size:45,margin:50,color:"#333",shadowBlur:3,shadowColor:"#aaa",shadowOffsetX:0,shadowOffsetY:2,throttle:40}}}),If.makeGetter()),xP=za.each;function wP(t,e,i){t.handler("leave",null,i)}function bP(t,e,i,n){e.handler(t,i,n)}var MP={register:function(t,e,i){if(!ca.node){var n=e.getZr();_P(n).records||(_P(n).records={}),function(u,d){function t(t,c){u.on(t,function(e){var i,n,r,t,o,a,s,l,h=(i=d,{dispatchAction:r=function(t){var e=n[t.type];e?e.push(t):(t.dispatchAction=r,i.dispatchAction(t))},pendings:n={showTip:[],hideTip:[]}});xP(_P(u).records,function(t){t&&c(t,e,h.dispatchAction)}),t=h.pendings,o=d,s=t.showTip.length,l=t.hideTip.length,s?a=t.showTip[s-1]:l&&(a=t.hideTip[l-1]),a&&(a.dispatchAction=null,o.dispatchAction(a))})}_P(u).initialized||(_P(u).initialized=!0,t("click",za.curry(bP,"click")),t("mousemove",za.curry(bP,"mousemove")),t("globalout",wP))}(n,e),(_P(n).records[t]||(_P(n).records[t]={})).handler=i}},unregister:function(t,e){if(!ca.node){var i=e.getZr();(_P(i).records||{})[t]&&(_P(i).records[t]=null)}}},SP=fy.extendComponentView({type:"axisPointer",render:function(t,e,i){var n=e.getComponent("tooltip"),r=t.get("triggerOn")||n&&n.get("triggerOn")||"mousemove|click";MP.register("axisPointer",i,function(t,e,i){"none"!==r&&("leave"===t||0<=r.indexOf(t))&&i({type:"updateAxisPointer",currTrigger:t,x:e&&e.offsetX,y:e&&e.offsetY})})},remove:function(t,e){MP.unregister(e.getZr(),"axisPointer"),SP.superApply(this._model,"remove",arguments)},dispose:function(t,e){MP.unregister("axisPointer",e),SP.superApply(this._model,"dispose",arguments)}}),TP=If.makeGetter(),CP=za.clone,AP=za.bind;function EP(){}function PP(t,e,i,n){(function i(n,t){{if(za.isObject(n)&&za.isObject(t)){var r=!0;return za.each(t,function(t,e){r=r&&i(n[e],t)}),!!r}return n===t}})(TP(i).lastProp,n)||(TP(i).lastProp=n,e?pf.updateProps(i,n,t):(i.stopAnimation(),i.attr(n)))}function LP(t,e){t[e.get("label.show")?"show":"hide"]()}function IP(t){return{position:t.position.slice(),rotation:t.rotation||0}}function RP(t,e,i){var n=e.get("z"),r=e.get("zlevel");t&&t.traverse(function(t){"group"!==t.type&&(null!=n&&(t.z=n),null!=r&&(t.zlevel=r),t.silent=i)})}(EP.prototype={_group:null,_lastGraphicKey:null,_handle:null,_dragging:!1,_lastValue:null,_lastStatus:null,_payloadInfo:null,animationThreshold:15,render:function(t,e,i,n){var r=e.get("value"),o=e.get("status");if(this._axisModel=t,this._axisPointerModel=e,this._api=i,n||this._lastValue!==r||this._lastStatus!==o){this._lastValue=r,this._lastStatus=o;var a=this._group,s=this._handle;if(!o||"hide"===o)return a&&a.hide(),void(s&&s.hide());a&&a.show(),s&&s.show();var l={};this.makeElOption(l,r,t,e,i);var h=l.graphicKey;h!==this._lastGraphicKey&&this.clear(i),this._lastGraphicKey=h;var c=this._moveAnimation=this.determineAnimation(t,e);if(a){var u=za.curry(PP,e,c);this.updatePointerEl(a,l,u,e),this.updateLabelEl(a,l,u,e)}else a=this._group=new pf.Group,this.createPointerEl(a,l,t,e),this.createLabelEl(a,l,t,e),i.getZr().add(a);RP(a,e,!0),this._renderHandle(r)}},remove:function(t){this.clear(t)},dispose:function(t){this.clear(t)},determineAnimation:function(t,e){var i=e.get("animation"),n=t.axis,r="category"===n.type,o=e.get("snap");if(!o&&!r)return!1;if("auto"===i||null==i){var a=this.animationThreshold;if(r&&n.getBandWidth()>a)return!0;if(o){var s=sx.getAxisInfo(t).seriesDataCount,l=n.getExtent();return Math.abs(l[0]-l[1])/s>a}return!1}return!0===i},makeElOption:function(t,e,i,n,r){},createPointerEl:function(t,e,i,n){var r=e.pointer;if(r){var o=TP(t).pointerEl=new pf[r.type](CP(e.pointer));t.add(o)}},createLabelEl:function(t,e,i,n){if(e.label){var r=TP(t).labelEl=new pf.Rect(CP(e.label));t.add(r),LP(r,n)}},updatePointerEl:function(t,e,i){var n=TP(t).pointerEl;n&&(n.setStyle(e.pointer.style),i(n,{shape:e.pointer.shape}))},updateLabelEl:function(t,e,i,n){var r=TP(t).labelEl;r&&(r.setStyle(e.label.style),i(r,{shape:e.label.shape,position:e.label.position}),LP(r,n))},_renderHandle:function(t){if(!this._dragging&&this.updateHandleTransform){var e,i=this._axisPointerModel,n=this._api.getZr(),r=this._handle,o=i.getModel("handle"),a=i.get("status");if(!o.get("show")||!a||"hide"===a)return r&&n.remove(r),void(this._handle=null);this._handle||(e=!0,r=this._handle=pf.createIcon(o.get("icon"),{cursor:"move",draggable:!0,onmousemove:function(t){pc.stop(t.event)},onmousedown:AP(this._onHandleDragMove,this,0,0),drift:AP(this._onHandleDragMove,this),ondragend:AP(this._onHandleDragEnd,this)}),n.add(r)),RP(r,i,!1);r.setStyle(o.getItemStyle(null,["color","borderColor","borderWidth","opacity","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY"]));var s=o.get("size");za.isArray(s)||(s=[s,s]),r.attr("scale",[s[0]/2,s[1]/2]),um.createOrUpdate(this,"_doDispatchAxisPointer",o.get("throttle")||0,"fixRate"),this._moveHandleToValue(t,e)}},_moveHandleToValue:function(t,e){PP(this._axisPointerModel,!e&&this._moveAnimation,this._handle,IP(this.getHandleTransform(t,this._axisModel,this._axisPointerModel)))},_onHandleDragMove:function(t,e){var i=this._handle;if(i){this._dragging=!0;var n=this.updateHandleTransform(IP(i),[t,e],this._axisModel,this._axisPointerModel);this._payloadInfo=n,i.stopAnimation(),i.attr(IP(n)),TP(i).lastProp=null,this._doDispatchAxisPointer()}},_doDispatchAxisPointer:function(){if(this._handle){var t=this._payloadInfo,e=this._axisModel;this._api.dispatchAction({type:"updateAxisPointer",x:t.cursorPoint[0],y:t.cursorPoint[1],tooltipOption:t.tooltipOption,axesInfo:[{axisDim:e.axis.dim,axisIndex:e.componentIndex}]})}},_onHandleDragEnd:function(t){if(this._dragging=!1,this._handle){var e=this._axisPointerModel.get("value");this._moveHandleToValue(e),this._api.dispatchAction({type:"hideTip"})}},getHandleTransform:null,updateHandleTransform:null,clear:function(t){this._lastValue=null,this._lastStatus=null;var e=t.getZr(),i=this._group,n=this._handle;e&&i&&(this._lastGraphicKey=null,i&&e.remove(i),n&&e.remove(n),this._group=null,this._handle=null,this._payloadInfo=null)},doClear:function(){},buildLabel:function(t,e,i){return{x:t[i=i||0],y:t[1-i],width:e[i],height:e[1-i]}}}).constructor=EP,iu.enableClassExtend(EP);var DP=EP;function OP(t,e,i,n,r){var o=kP(i.get("value"),e.axis,e.ecModel,i.get("seriesDataIndices"),{precision:i.get("label.precision"),formatter:i.get("label.formatter")}),a=i.getModel("label"),s=Yc.normalizeCssArray(a.get("padding")||0),l=a.getFont(),h=Sh.getBoundingRect(o,l),c=r.position,u=h.width+s[1]+s[3],d=h.height+s[0]+s[2],p=r.align;"right"===p&&(c[0]-=u),"center"===p&&(c[0]-=u/2);var f,g,m,v,y,_,x=r.verticalAlign;"bottom"===x&&(c[1]-=d),"middle"===x&&(c[1]-=d/2),f=c,g=u,m=d,y=(v=n).getWidth(),_=v.getHeight(),f[0]=Math.min(f[0]+g,y)-g,f[1]=Math.min(f[1]+m,_)-m,f[0]=Math.max(f[0],0),f[1]=Math.max(f[1],0);var w=a.get("backgroundColor");w&&"auto"!==w||(w=e.get("axisLine.lineStyle.color")),t.label={shape:{x:0,y:0,width:u,height:d,r:a.get("borderRadius")},position:c.slice(),style:{text:o,textFont:l,textFill:a.getTextColor(),textPosition:"inside",fill:w,stroke:a.get("borderColor")||"transparent",lineWidth:a.get("borderWidth")||0,shadowBlur:a.get("shadowBlur"),shadowColor:a.get("shadowColor"),shadowOffsetX:a.get("shadowOffsetX"),shadowOffsetY:a.get("shadowOffsetY")},z2:10}}function kP(t,e,r,i,n){var o=e.scale.getLabel(t,{precision:n.precision}),a=n.formatter;if(a){var s={value:Cv.getAxisRawValue(e,t),seriesData:[]};za.each(i,function(t){var e=r.getSeriesByIndex(t.seriesIndex),i=t.dataIndexInside,n=e&&e.getDataParams(i);n&&s.seriesData.push(n)}),za.isString(a)?o=a.replace("{value}",o):za.isFunction(a)&&(o=a(s))}return o}function zP(t,e,i){var n=ns.create();return ns.rotate(n,n,i.rotation),ns.translate(n,n,i.position),pf.applyTransform([t.dataToCoord(e),(i.labelOffset||0)+(i.labelDirection||1)*(i.labelMargin||0)],n)}var NP={buildElStyle:function(t){var e,i=t.get("type"),n=t.getModel(i+"Style");return"line"===i?(e=n.getLineStyle()).fill=null:"shadow"===i&&((e=n.getAreaStyle()).stroke=null),e},buildLabelElOption:OP,getValueLabel:kP,getTransformedPosition:zP,buildCartesianSingleLabelElOption:function(t,e,i,n,r,o){var a=tx.innerTextLayout(i.rotation,0,i.labelDirection);i.labelMargin=r.get("label.margin"),OP(e,n,r,o,{position:zP(n.axis,t,i),align:a.textAlign,verticalAlign:a.textVerticalAlign})},makeLineShape:function(t,e,i){return{x1:t[i=i||0],y1:t[1-i],x2:e[i],y2:e[1-i]}},makeRectShape:function(t,e,i){return{x:t[i=i||0],y:t[1-i],width:e[i],height:e[1-i]}},makeSectorShape:function(t,e,i,n,r,o){return{cx:t,cy:e,r0:i,r:n,startAngle:r,endAngle:o,clockwise:!0}}},BP=DP.extend({makeElOption:function(t,e,i,n,r){var o=i.axis,a=o.grid,s=n.get("type"),l=FP(a,o).getOtherAxis(o).getGlobalExtent(),h=o.toGlobalCoord(o.dataToCoord(e,!0));if(s&&"none"!==s){var c=NP.buildElStyle(n),u=GP[s](o,h,l,c);u.style=c,t.graphicKey=u.type,t.pointer=u}var d=px.layout(a.model,i);NP.buildCartesianSingleLabelElOption(e,t,d,i,n,r)},getHandleTransform:function(t,e,i){var n=px.layout(e.axis.grid.model,e,{labelInside:!1});return n.labelMargin=i.get("handle.margin"),{position:NP.getTransformedPosition(e.axis,t,n),rotation:n.rotation+(n.labelDirection<0?Math.PI:0)}},updateHandleTransform:function(t,e,i,n){var r=i.axis,o=r.grid,a=r.getGlobalExtent(!0),s=FP(o,r).getOtherAxis(r).getGlobalExtent(),l="x"===r.dim?0:1,h=t.position;h[l]+=e[l],h[l]=Math.min(a[1],h[l]),h[l]=Math.max(a[0],h[l]);var c=(s[1]+s[0])/2,u=[c,c];u[l]=h[l];return{position:h,rotation:t.rotation,cursorPoint:u,tooltipOption:[{verticalAlign:"middle"},{align:"center"}][l]}}});function FP(t,e){var i={};return i[e.dim+"AxisIndex"]=e.index,t.getCartesian(i)}var GP={line:function(t,e,i,n){var r=NP.makeLineShape([e,i[0]],[e,i[1]],VP(t));return pf.subPixelOptimizeLine({shape:r,style:n}),{type:"Line",shape:r}},shadow:function(t,e,i,n){var r=t.getBandWidth(),o=i[1]-i[0];return{type:"Rect",shape:NP.makeRectShape([e-r/2,i[0]],[r,o],VP(t))}}};function VP(t){return"x"===t.dim?0:1}dx.registerAxisPointerClass("CartesianAxisPointer",BP),fy.registerPreprocessor(function(t){if(t){(!t.axisPointer||0===t.axisPointer.length)&&(t.axisPointer={});var e=t.axisPointer.link;e&&!za.isArray(e)&&(t.axisPointer.link=[e])}}),fy.registerProcessor(fy.PRIORITY.PROCESSOR.STATISTIC,function(t,e){t.getComponent("axisPointer").coordSysAxesInfo=sx.collect(t,e)}),fy.registerAction({type:"updateAxisPointer",event:"updateAxisPointer",update:":updateAxisPointer"},yP);var HP=["x","y"],UP=["width","height"],WP=DP.extend({makeElOption:function(t,e,i,n,r){var o=i.axis,a=o.coordinateSystem,s=XP(a,1-ZP(o)),l=a.dataToPoint(e)[0],h=n.get("type");if(h&&"none"!==h){var c=NP.buildElStyle(n),u=jP[h](o,l,s,c);u.style=c,t.graphicKey=u.type,t.pointer=u}var d=iP.layout(i);NP.buildCartesianSingleLabelElOption(e,t,d,i,n,r)},getHandleTransform:function(t,e,i){var n=iP.layout(e,{labelInside:!1});return n.labelMargin=i.get("handle.margin"),{position:NP.getTransformedPosition(e.axis,t,n),rotation:n.rotation+(n.labelDirection<0?Math.PI:0)}},updateHandleTransform:function(t,e,i,n){var r=i.axis,o=r.coordinateSystem,a=ZP(r),s=XP(o,a),l=t.position;l[a]+=e[a],l[a]=Math.min(s[1],l[a]),l[a]=Math.max(s[0],l[a]);var h=XP(o,1-a),c=(h[1]+h[0])/2,u=[c,c];return u[a]=l[a],{position:l,rotation:t.rotation,cursorPoint:u,tooltipOption:{verticalAlign:"middle"}}}}),jP={line:function(t,e,i,n){var r=NP.makeLineShape([e,i[0]],[e,i[1]],ZP(t));return pf.subPixelOptimizeLine({shape:r,style:n}),{type:"Line",shape:r}},shadow:function(t,e,i,n){var r=t.getBandWidth(),o=i[1]-i[0];return{type:"Rect",shape:NP.makeRectShape([e-r/2,i[0]],[r,o],ZP(t))}}};function ZP(t){return t.isHorizontal()?0:1}function XP(t,e){var i=t.getRect();return[i[HP[e]],i[HP[e]]+i[UP[e]]]}dx.registerAxisPointerClass("SingleAxisPointer",WP),fy.extendComponentView({type:"single"});var qP=Yc.encodeHTML,YP=Qg.extend({type:"series.themeRiver",dependencies:["singleAxis"],nameMap:null,init:function(t){YP.superApply(this,"init",arguments),this.legendDataProvider=function(){return this.getRawData()}},fixData:function(t){for(var e=t.length,i=KC().key(function(t){return t[2]}).entries(t),n=za.map(i,function(t){return{name:t.key,dataList:t.values}}),r=n.length,o=-1,a=-1,s=0;s<r;++s){var l=n[s].dataList.length;o<l&&(o=l,a=s)}for(var h=0;h<r;++h)if(h!==a)for(var c=n[h].name,u=0;u<o;++u){for(var d=n[a].dataList[u][0],p=n[h].dataList.length,f=-1,g=0;g<p;++g){if(n[h].dataList[g][0]===d){f=g;break}}-1===f&&(t[e]=[],t[e][0]=d,t[e][1]=0,t[e][2]=c,e++)}return t},getInitialData:function(t,e){var i=[],n=e.queryComponents({mainType:"singleAxis",index:this.get("singleAxisIndex"),id:this.get("singleAxisId")})[0].get("type");i=[{name:"time",type:"category"===n?"ordinal":"time"===n?"time":"float"},{name:"value",type:"float"},{name:"name",type:"ordinal"}];for(var r=za.filter(t.data,function(t){return void 0!==t[2]}),o=this.fixData(r||[]),a=[],s=this.nameMap=za.createHashMap(),l=0,h=0;h<o.length;++h)a.push(o[h][2]),s.get(o[h][2])||(s.set(o[h][2],l),l++);i=Gm(i,o);var c=new Im(i,this);return c.initData(o,a),c},coordDimToDataDim:function(t){return["time"]},getLayerSeries:function(){for(var i=this.getData(),t=i.count(),e=[],n=0;n<t;++n)e[n]=n;for(var r=KC().key(function(t){return i.get("name",t)}).entries(e),o=za.map(r,function(t){return{name:t.key,indices:t.values}}),a=0;a<o.length;++a)o[a].indices.sort(s);function s(t,e){return i.get("time",t)-i.get("time",e)}return o},getAxisTooltipData:function(t,e,i){za.isArray(t)||(t=t?[t]:[]);for(var n,r=this.getData(),o=this.getLayerSeries(),a=[],s=o.length,l=0;l<s;++l){for(var h=Number.MAX_VALUE,c=-1,u=o[l].indices.length,d=0;d<u;++d){var p=r.get(t[0],o[l].indices[d]),f=Math.abs(p-e);f<=h&&(n=p,h=f,c=o[l].indices[d])}a.push(c)}return{dataIndices:a,nestestValue:n}},formatTooltip:function(t){var e=this.getData(),i=e.get("name",t),n=e.get("value",t);return(isNaN(n)||null==n)&&(n="-"),qP(i+" : "+n)},defaultOption:{zlevel:0,z:2,coordinateSystem:"singleAxis",boundaryGap:["10%","10%"],singleAxisIndex:0,animationEasing:"linear",label:{normal:{margin:4,textAlign:"right",show:!0,position:"left",color:"#000",fontSize:11},emphasis:{show:!0}}}}),JP=Zy.Polygon,KP=za.bind,QP=za.extend;fy.extendChartView({type:"themeRiver",init:function(){this._layers=[]},render:function(C,t,e){var A=C.getData(),E=this.group,P=C.getLayerSeries(),i=A.getLayout("layoutInfo"),n=i.rect,r=i.boundaryGap;function o(t){return t.name}E.attr("position",[0,n.y+r[0]]);var a=new ym(this._layersSeries||[],P,o,o),L={};function s(t,e,i){var n=this._layers;if("remove"!==t){for(var r,o,a,s=[],l=[],h=P[e].indices,c=0;c<h.length;c++){var u=A.getItemLayout(h[c]),d=u.x,p=u.y0,f=u.y;s.push([d,p]),l.push([d,p+f]),r=A.getItemVisual(h[c],"color")}var g,m,v,y,_=A.getItemLayout(h[0]),x=A.getItemModel(h[c-1]),w=x.getModel("label.normal"),b=w.get("margin");if("add"===t){var M=L[e]=new pf.Group;o=new JP({shape:{points:s,stackedOnPoints:l,smooth:.4,stackedOnSmooth:.4,smoothConstraint:!1},z2:0}),a=new pf.Text({style:{x:_.x-b,y:_.y0+_.y/2}}),M.add(o),M.add(a),E.add(M),o.setClipPath((g=o.getBoundingRect(),m=C,v=function(){o.removeClipPath()},y=new pf.Rect({shape:{x:g.x-10,y:g.y-10,width:0,height:g.height+20}}),pf.initProps(y,{shape:{width:g.width+20,height:g.height+20}},m,v),y))}else{M=n[i];o=M.childAt(0),a=M.childAt(1),E.add(M),L[e]=M,pf.updateProps(o,{shape:{points:s,stackedOnPoints:l}},C),pf.updateProps(a,{style:{x:_.x-b,y:_.y0+_.y/2}},C)}var S=x.getModel("itemStyle.emphasis"),T=x.getModel("itemStyle.normal");pf.setTextStyle(a.style,w,{text:w.get("show")?C.getFormattedLabel(h[c-1],"normal")||A.getName(h[c-1]):null,textVerticalAlign:"middle"}),o.setStyle(QP({fill:r},T.getItemStyle(["color"]))),pf.setHoverStyle(o,S.getItemStyle())}else E.remove(n[e])}a.add(KP(s,this,"add")).update(KP(s,this,"update")).remove(KP(s,this,"remove")).execute(),this._layersSeries=P,this._layers=L},dispose:function(){}});function $P(i,t,e){if(i.count())for(var n,r=t.coordinateSystem,o=t.getLayerSeries(),a=za.map(o,function(t){return za.map(t.indices,function(t){var e=r.dataToPoint(i.get("time",t));return e[1]=i.get("value",t),e})}),s=function(t){for(var e=t.length,i=t[0].length,n=[],r=[],o=0,a={},s=0;s<i;++s){for(var l=0,h=0;l<e;++l)h+=t[l][s][1];o<h&&(o=h),n.push(h)}for(var c=0;c<i;++c)r[c]=(o-n[c])/2;for(var u=o=0;u<i;++u){var d=n[u]+r[u];o<d&&(o=d)}return a.y0=r,a.max=o,a}(a),l=s.y0,h=e/s.max,c=o.length,u=o[0].indices.length,d=0;d<u;++d){n=l[d]*h,i.setItemLayout(o[0].indices[d],{layerIndex:0,x:a[0][d][0],y0:n,y:a[0][d][1]*h});for(var p=1;p<c;++p)n+=a[p-1][d][1]*h,i.setItemLayout(o[p].indices[d],{layerIndex:p,x:a[p][d][0],y0:n,y:a[p][d][1]*h})}}var tL=function(t,e){t.eachSeriesByType("themeRiver",function(t){var e=t.getData(),i=t.coordinateSystem,n={},r=i.getRect();n.rect=r;var o=t.get("boundaryGap"),a=i.getAxis();n.boundaryGap=o,"horizontal"===a.orient?(o[0]=Uc.parsePercent(o[0],r.height),o[1]=Uc.parsePercent(o[1],r.height),$P(e,t,r.height-o[0]-o[1])):(o[0]=Uc.parsePercent(o[0],r.width),o[1]=Uc.parsePercent(o[1],r.width),$P(e,t,r.width-o[0]-o[1])),e.setLayout("layoutInfo",n)})},eL=za.createHashMap;var iL=function(t){t.eachSeriesByType("themeRiver",function(r){var o=r.getData(),a=r.getRawData(),s=r.get("color"),l=eL();o.each(function(t){l.set(o.getRawIndex(t),t)}),a.each(function(t){var e=a.getName(t),i=s[(r.nameMap.get(e)-1)%s.length];a.setItemVisual(t,"color",i);var n=l.get(t);null!=n&&o.setItemVisual(n,"color",i)})})};function nL(o,a){return a=a||[0,0],za.map(["x","y"],function(t,e){var i=this.getAxis(t),n=a[e],r=o[e]/2;return"category"===i.type?i.getBandWidth():Math.abs(i.dataToCoord(n-r)-i.dataToCoord(n+r))},this)}function rL(o,a){return a=a||[0,0],za.map([0,1],function(t){var e=a[t],i=o[t]/2,n=[],r=[];return n[t]=e-i,r[t]=e+i,n[1-t]=r[1-t]=a[1-t],Math.abs(this.dataToPoint(n)[t]-this.dataToPoint(r)[t])},this)}function oL(t,e){var i=this.getAxis(),n=e instanceof Array?e[0]:e,r=(t instanceof Array?t[0]:t)/2;return"category"===i.type?i.getBandWidth():Math.abs(i.dataToCoord(n-r)-i.dataToCoord(n+r))}function aL(s,l){return za.map(["Radius","Angle"],function(t,e){var i=this["get"+t+"Axis"](),n=l[e],r=s[e]/2,o="dataTo"+t,a="category"===i.type?i.getBandWidth():Math.abs(i[o](n-r)-i[o](n+r));return"Angle"===t&&(a=a*Math.PI/180),a},this)}fy.registerLayout(tL),fy.registerVisual(iL),fy.registerProcessor(za.curry(tw,"themeRiver"));var sL=my.findLabelValueDim,lL=["itemStyle","normal"],hL=["itemStyle","emphasis"],cL=["label","normal"],uL=["label","emphasis"],dL="e\0\0",pL={cartesian2d:function(t){var e=t.grid.getRect();return{coordSys:{type:"cartesian2d",x:e.x,y:e.y,width:e.width,height:e.height},api:{coord:za.bind(t.dataToPoint,t),size:za.bind(nL,t)}}},geo:function(t){var e=t.getBoundingRect();return{coordSys:{type:"geo",x:e.x,y:e.y,width:e.width,height:e.height},api:{coord:za.bind(t.dataToPoint,t),size:za.bind(rL,t)}}},singleAxis:function(t){var e=t.getRect();return{coordSys:{type:"singleAxis",x:e.x,y:e.y,width:e.width,height:e.height},api:{coord:za.bind(t.dataToPoint,t),size:za.bind(oL,t)}}},polar:function(r){var o=r.getRadiusAxis(),a=r.getAngleAxis(),t=o.getExtent();return t[0]>t[1]&&t.reverse(),{coordSys:{type:"polar",cx:r.cx,cy:r.cy,r:t[1],r0:t[0]},api:{coord:za.bind(function(t){var e=o.dataToRadius(t[0]),i=a.dataToAngle(t[1]),n=r.coordToPoint([e,i]);return n.push(e,i*Math.PI/180),n}),size:za.bind(aL,r)}}},calendar:function(t){var e=t.getRect(),i=t.getRangeInfo();return{coordSys:{type:"calendar",x:e.x,y:e.y,width:e.width,height:e.height,cellWidth:t.getCellWidth(),cellHeight:t.getCellHeight(),rangeInfo:{start:i.start,end:i.end,weeks:i.weeks,dayCount:i.allDay}},api:{coord:za.bind(t.dataToPoint,t)}}}};function fL(t,e,i,n,r){null==i[t]||r||(e[t]=i[t],i[t]=n[t])}function gL(t,e,i,n,r,o){(t=mL(t,e,i,n,r,o))&&o.setItemGraphicEl(e,t)}function mL(t,e,i,n,r,o){var a=i.type;if(!t||a===t.__customGraphicType||"path"===a&&i.pathData===t.__customPathData||"image"===a&&i.style.image===t.__customImagePath||"text"===a&&i.style.text===t.__customText||(r.remove(t),t=null),null!=a){var s,l=!t;if(!t&&(t=function(t){var e,i=t.type;if("path"===i){var n=t.shape;(e=pf.makePath(n.pathData,null,{x:n.x||0,y:n.y||0,width:n.width||0,height:n.height||0},"center")).__customPathData=t.pathData}else"image"===i?(e=new pf.Image({})).__customImagePath=t.style.image:"text"===i?(e=new pf.Text({})).__customText=t.style.text:e=new(pf[i.charAt(0).toUpperCase()+i.slice(1)]);return e.__customGraphicType=i,e.name=t.name,e}(i)),function(e,t,i,n,r,o){var a={},s=i.style||{};if(i.shape&&(a.shape=za.clone(i.shape)),i.position&&(a.position=i.position.slice()),i.scale&&(a.scale=i.scale.slice()),i.origin&&(a.origin=i.origin.slice()),i.rotation&&(a.rotation=i.rotation),"image"===e.type&&i.style){var l=a.style={};za.each(["x","y","width","height"],function(t){fL(t,l,s,e.style,o)})}"text"===e.type&&i.style&&(l=a.style={},za.each(["x","y"],function(t){fL(t,l,s,e.style,o)}),!s.hasOwnProperty("textFill")&&s.fill&&(s.textFill=s.fill),!s.hasOwnProperty("textStroke")&&s.stroke&&(s.textStroke=s.stroke));if("group"!==e.type&&(e.useStyle(s),o)){e.style.opacity=0;var h=s.opacity;null==h&&(h=1),pf.initProps(e,{style:{opacity:h}},n,t)}o?e.attr(a):pf.updateProps(e,a,n,t),e.attr({z2:i.z2||0,silent:i.silent}),!1!==i.styleEmphasis&&pf.setHoverStyle(e,i.styleEmphasis)}(t,e,i,n,0,l),"group"===a){var h=t.children()||[],c=i.children||[];if(i.diffChildrenByName)new ym((s={oldChildren:h,newChildren:c,dataIndex:e,animatableModel:n,group:t,data:o}).oldChildren,s.newChildren,vL,vL,s).add(yL).update(yL).remove(_L).execute();else{for(var u=0;u<c.length;u++)mL(t.childAt(u),e,c[u],n,t,o);for(;u<h.length;u++)h[u]&&t.remove(h[u])}}return r.add(t),t}}function vL(t,e){var i=t&&t.name;return null!=i?i:dL+e}function yL(t,e){var i=this.context,n=null!=t?i.newChildren[t]:null;mL(null!=e?i.oldChildren[e]:null,i.dataIndex,n,i.animatableModel,i.group,i.data)}function _L(t){var e=this.context,i=e.oldChildren[t];i&&e.group.remove(i)}fy.extendSeriesModel({type:"series.custom",dependencies:["grid","polar","geo","singleAxis","calendar"],defaultOption:{coordinateSystem:"cartesian2d",zlevel:0,z:2,legendHoverLink:!0},getInitialData:function(t,e){return Xm(t.data,this,e)}}),fy.extendChartView({type:"custom",_data:null,render:function(n,t,e){var r=this._data,o=n.getData(),a=this.group,s=function(r,o,e,i){var n=r.get("renderItem"),a=r.coordinateSystem,t={};a&&(t=a.prepareCustoms?a.prepareCustoms():pL[a.type](a));var s,l,h,c,u,d,p=za.defaults({getWidth:i.getWidth,getHeight:i.getHeight,getZr:i.getZr,getDevicePixelRatio:i.getDevicePixelRatio,value:function(t,e){return null==e&&(e=s),o.get(o.getDimension(t||0),e)},style:function(t,e){null==e&&(e=s),y(e);var i=l.getModel(lL).getItemStyle();null!=d&&(i.fill=d);var n=o.getItemVisual(e,"opacity");null!=n&&(i.opacity=n),null!=u&&(pf.setTextStyle(i,h,null,{autoColor:d,isRectText:!0}),i.text=h.getShallow("show")?za.retrieve2(r.getFormattedLabel(e,"normal"),o.get(u,e)):null);return t&&za.extend(i,t),i},styleEmphasis:function(t,e){null==e&&(e=s),y(e);var i=l.getModel(hL).getItemStyle();null!=u&&(pf.setTextStyle(i,c,null,{isRectText:!0},!0),i.text=c.getShallow("show")?za.retrieve3(r.getFormattedLabel(e,"emphasis"),r.getFormattedLabel(e,"normal"),o.get(u,e)):null);return t&&za.extend(i,t),i},visual:function(t,e){return null==e&&(e=s),o.getItemVisual(e,t)},barLayout:function(t){if(a.getBaseAxis){var e=a.getBaseAxis();return Tx.getLayoutOnAxis(za.defaults({axis:e},t),i)}},currentSeriesIndices:function(){return e.getCurrentSeriesIndices()},font:function(t){return pf.getFont(t,e)}},t.api||{}),f={context:{},seriesId:r.id,seriesName:r.name,seriesIndex:r.seriesIndex,coordSys:t.coordSys,dataInsideLength:o.count(),encode:(m=r.getData(),v={},za.each(m.dimensions,function(t,e){var i=m.getDimensionInfo(t);if(!i.isExtraCoord){var n=i.coordDim;(v[n]=v[n]||[])[i.coordDimIndex]=e}}),v)},g=!0;var m,v;return function(t){return s=t,g=!0,n&&n(za.defaults({dataIndexInside:t,dataIndex:o.getRawIndex(t)},f),p)||{}};function y(t){null==t&&(t=s),g&&(l=o.getItemModel(t),h=l.getModel(cL),c=l.getModel(uL),u=sL(o),d=o.getItemVisual(t,"color"),g=!1)}}(n,o,t,e);o.diff(r).add(function(t){o.hasValue(t)&&gL(null,t,s(t),n,a,o)}).update(function(t,e){var i=r.getItemGraphicEl(e);o.hasValue(t)?gL(i,t,s(t),n,a,o):i&&a.remove(i)}).remove(function(t){var e=r.getItemGraphicEl(t);e&&a.remove(e)}).execute(),this._data=o},dispose:za.noop}),fy.registerPreprocessor(function(t){var e=t.graphic;za.isArray(e)?e[0]&&e[0].elements?t.graphic=[t.graphic[0]]:t.graphic=[{elements:e}]:e&&!e.elements&&(t.graphic=[{elements:[e]}])});var xL=fy.extendComponentModel({type:"graphic",defaultOption:{elements:[],parentId:null},_elOptionsToUpdate:null,mergeOption:function(t){var e=this.option.elements;this.option.elements=null,xL.superApply(this,"mergeOption",arguments),this.option.elements=e},optionUpdated:function(t,e){var i=this.option,n=(e?i:t).elements,h=i.elements=e?[]:i.elements,r=[];this._flatten(n,r);var o=If.mappingToExists(h,r);If.makeIdAndName(o);var c=this._elOptionsToUpdate=[];za.each(o,function(t,e){var i,n,r,o,a,s,l=t.option;l&&(c.push(l),function(t,e){var i=t.exist;if(e.id=t.keyInfo.id,!e.type&&i&&(e.type=i.type),null==e.parentId){var n=e.parentOption;n?e.parentId=n.id:i&&(e.parentId=i.parentId)}e.parentOption=null}(t,l),i=h,n=e,r=l,o=za.extend({},r),a=i[n],"merge"===(s=r.$action||"merge")?a?(za.merge(a,o,!0),jf.mergeLayoutParam(a,o,{ignoreSize:!0}),jf.copyLayoutParams(r,a)):i[n]=o:"replace"===s?i[n]=o:"remove"===s&&a&&(i[n]=null),function(t,e){if(!t)return;t.hv=e.hv=[ML(e,["left","right"]),ML(e,["top","bottom"])],"group"===t.type&&(null==t.width&&(t.width=e.width=0),null==t.height&&(t.height=e.height=0))}(h[e],l))},this);for(var a=h.length-1;0<=a;a--)null==h[a]?h.splice(a,1):delete h[a].$action},_flatten:function(t,i,n){za.each(t,function(t){if(t){n&&(t.parentOption=n),i.push(t);var e=t.children;"group"===t.type&&e&&this._flatten(e,i,t),delete t.children}},this)},useElOptionsToUpdate:function(){var t=this._elOptionsToUpdate;return this._elOptionsToUpdate=null,t}});function wL(t,e,i,n){var r=i.type,o=new(pf[r.charAt(0).toUpperCase()+r.slice(1)])(i);e.add(o),n.set(t,o),o.__ecGraphicId=t}function bL(t,e){var i=t&&t.parent;i&&("group"===t.type&&t.traverse(function(t){bL(t,e)}),e.removeKey(t.__ecGraphicId),i.remove(t))}function ML(e,t){var i;return za.each(t,function(t){null!=e[t]&&"auto"!==e[t]&&(i=!0)}),i}fy.extendComponentView({type:"graphic",init:function(t,e){this._elMap=za.createHashMap(),this._lastGraphicModel},render:function(t,e,i){t!==this._lastGraphicModel&&this._clear(),this._lastGraphicModel=t,this._updateElements(t,i),this._relocate(t,i)},_updateElements:function(t,e){var i=t.useElOptionsToUpdate();if(i){var c=this._elMap,u=this.group;za.each(i,function(t){var e=t.$action,i=t.id,n=c.get(i),r=t.parentId,o=null!=r?c.get(r):u;if("text"===t.type){var a=t.style;t.hv&&t.hv[1]&&(a.textVerticalAlign=a.textBaseline=null),!a.hasOwnProperty("textFill")&&a.fill&&(a.textFill=a.fill),!a.hasOwnProperty("textStroke")&&a.stroke&&(a.textStroke=a.stroke)}var s,l=(s=t,s=za.extend({},s),za.each(["id","parentId","$action","hv","bounding"].concat(jf.LOCATION_PARAMS),function(t){delete s[t]}),s);e&&"merge"!==e?"replace"===e?(bL(n,c),wL(i,o,l,c)):"remove"===e&&bL(n,c):n?n.attr(l):wL(i,o,l,c);var h=c.get(i);h&&(h.__ecGraphicWidth=t.width,h.__ecGraphicHeight=t.height)})}},_relocate:function(t,e){for(var i=t.option.elements,n=this.group,r=this._elMap,o=i.length-1;0<=o;o--){var a=i[o],s=r.get(a.id);if(s){var l=s.parent,h=l===n?{width:e.getWidth(),height:e.getHeight()}:{width:l.__ecGraphicWidth||0,height:l.__ecGraphicHeight||0};jf.positionElement(s,a,h,null,{hv:a.hv,boundingMode:a.bounding})}}},_clear:function(){var e=this._elMap;e.each(function(t){bL(t,e)}),this._elMap=za.createHashMap()},dispose:function(){this._clear()}});var SL=fy.extendComponentModel({type:"legend.plain",dependencies:["series"],layoutMode:{type:"box",ignoreSize:!0},init:function(t,e,i){this.mergeDefaultAndTheme(t,i),t.selected=t.selected||{}},mergeOption:function(t){SL.superCall(this,"mergeOption",t)},optionUpdated:function(){this._updateData(this.ecModel);var t=this._data;if(t[0]&&"single"===this.get("selectedMode")){for(var e=!1,i=0;i<t.length;i++){var n=t[i].get("name");if(this.isSelected(n)){this.select(n),e=!0;break}}!e&&this.select(t[0].get("name"))}},_updateData:function(t){var e=za.map(this.get("data")||[],function(t){return"string"!=typeof t&&"number"!=typeof t||(t={name:t}),new bf(t,this,this.ecModel)},this);this._data=e;var i=za.map(t.getSeries(),function(t){return t.name});t.eachSeries(function(t){if(t.legendDataProvider){var e=t.legendDataProvider();i=i.concat(e.mapArray(e.getName))}}),this._availableNames=i},getData:function(){return this._data},select:function(t){var e=this.option.selected;if("single"===this.get("selectedMode")){var i=this._data;za.each(i,function(t){e[t.get("name")]=!1})}e[t]=!0},unSelect:function(t){"single"!==this.get("selectedMode")&&(this.option.selected[t]=!1)},toggleSelected:function(t){var e=this.option.selected;e.hasOwnProperty(t)||(e[t]=!0),this[e[t]?"unSelect":"select"](t)},isSelected:function(t){var e=this.option.selected;return!(e.hasOwnProperty(t)&&!e[t])&&0<=za.indexOf(this._availableNames,t)},defaultOption:{zlevel:0,z:4,show:!0,orient:"horizontal",left:"center",top:0,align:"auto",backgroundColor:"rgba(0,0,0,0)",borderColor:"#ccc",borderRadius:0,borderWidth:0,padding:5,itemGap:10,itemWidth:25,itemHeight:14,inactiveColor:"#ccc",textStyle:{color:"#333"},selectedMode:!0,tooltip:{show:!1}}}),TL=SL;function CL(e,i,t){var r,o={},a="toggleSelected"===e;return t.eachComponent("legend",function(n){a&&null!=r?n[r?"select":"unSelect"](i.name):(n[e](i.name),r=n.isSelected(i.name));var t=n.getData();za.each(t,function(t){var e=t.get("name");if("\n"!==e&&""!==e){var i=n.isSelected(e);o.hasOwnProperty(e)?o[e]=o[e]&&i:o[e]=i}})}),{name:i.name,selected:o}}fy.registerAction("legendToggleSelect","legendselectchanged",za.curry(CL,"toggleSelected")),fy.registerAction("legendSelect","legendselected",za.curry(CL,"select")),fy.registerAction("legendUnSelect","legendunselected",za.curry(CL,"unSelect"));var AL=jf.getLayoutRect,EL=jf.box,PL=jf.positionElement;var LL={layout:function(t,e,i){var n=e.getBoxLayoutParams(),r=e.get("padding"),o={width:i.getWidth(),height:i.getHeight()},a=AL(n,o,r);EL(e.get("orient"),t,e.get("itemGap"),a.width,a.height),PL(t,n,o,r)},makeBackground:function(t,e){var i=Yc.normalizeCssArray(e.get("padding")),n=e.getItemStyle(["color","opacity"]);return n.fill=e.get("backgroundColor"),t=new pf.Rect({shape:{x:t.x-i[3],y:t.y-i[0],width:t.width+i[1]+i[3],height:t.height+i[0]+i[2],r:e.get("borderRadius")},style:n,silent:!0,z2:-1})}},IL=Bv.createSymbol,RL=LL.makeBackground,DL=za.curry,OL=za.each,kL=pf.Group;function zL(t,e){e.dispatchAction({type:"legendToggleSelect",name:t})}function NL(t,e,i){var n=i.getZr().storage.getDisplayList()[0];n&&n.useHoverLayer||t.get("legendHoverLink")&&i.dispatchAction({type:"highlight",seriesName:t.name,name:e})}function BL(t,e,i){var n=i.getZr().storage.getDisplayList()[0];n&&n.useHoverLayer||t.get("legendHoverLink")&&i.dispatchAction({type:"downplay",seriesName:t.name,name:e})}var FL=fy.extendComponentView({type:"legend.plain",newlineDisabled:!1,init:function(){this.group.add(this._contentGroup=new kL),this._backgroundEl},getContentGroup:function(){return this._contentGroup},render:function(t,e,i){if(this.resetInner(),t.get("show",!0)){var n=t.get("align");n&&"auto"!==n||(n="right"===t.get("left")&&"vertical"===t.get("orient")?"right":"left"),this.renderInner(n,t,e,i);var r=t.getBoxLayoutParams(),o={width:i.getWidth(),height:i.getHeight()},a=t.get("padding"),s=jf.getLayoutRect(r,o,a),l=this.layoutInner(t,n,s),h=jf.getLayoutRect(za.defaults({width:l.width,height:l.height},r),o,a);this.group.attr("position",[h.x-l.x,h.y-l.y]),this.group.add(this._backgroundEl=RL(l,t))}},resetInner:function(){this.getContentGroup().removeAll(),this._backgroundEl&&this.group.remove(this._backgroundEl)},renderInner:function(l,h,c,u){var d=this.getContentGroup(),p=za.createHashMap(),f=h.get("selectedMode");OL(h.getData(),function(r,o){var a=r.get("name");if(this.newlineDisabled||""!==a&&"\n"!==a){var t=c.getSeriesByName(a)[0];if(!p.get(a))if(t){var e=t.getData(),i=e.getVisual("color");"function"==typeof i&&(i=i(t.getDataParams(0)));var n=e.getVisual("legendSymbol")||"roundRect",s=e.getVisual("symbol");this._createItem(a,o,r,h,n,s,l,i,f).on("click",DL(zL,a,u)).on("mouseover",DL(NL,t,null,u)).on("mouseout",DL(BL,t,null,u)),p.set(a,!0)}else c.eachRawSeries(function(t){if(!p.get(a)&&t.legendDataProvider){var e=t.legendDataProvider(),i=e.indexOfName(a);if(i<0)return;var n=e.getItemVisual(i,"color");this._createItem(a,o,r,h,"roundRect",null,l,n,f).on("click",DL(zL,a,u)).on("mouseover",DL(NL,t,a,u)).on("mouseout",DL(BL,t,a,u)),p.set(a,!0)}},this)}else d.add(new kL({newline:!0}))},this)},_createItem:function(t,e,i,n,r,o,a,s,l){var h=n.get("itemWidth"),c=n.get("itemHeight"),u=n.get("inactiveColor"),d=n.isSelected(t),p=new kL,f=i.getModel("textStyle"),g=i.get("icon"),m=i.getModel("tooltip"),v=m.parentModel;if(r=g||r,p.add(IL(r,0,0,h,c,d?s:u,!0)),!g&&o&&(o!==r||"none"==o)){var y=.8*c;"none"===o&&(o="circle"),p.add(IL(o,(h-y)/2,(c-y)/2,y,y,d?s:u))}var _="left"===a?h+5:-5,x=a,w=n.get("formatter"),b=t;"string"==typeof w&&w?b=w.replace("{name}",null!=t?t:""):"function"==typeof w&&(b=w(t)),p.add(new pf.Text({style:pf.setTextStyle({},f,{text:b,x:_,y:c/2,textFill:d?f.getTextColor():u,textAlign:x,textVerticalAlign:"middle"})}));var M=new pf.Rect({shape:p.getBoundingRect(),invisible:!0,tooltip:m.get("show")?za.extend({content:t,formatter:v.get("formatter",!0)||function(){return t},formatterParams:{componentType:"legend",legendIndex:n.componentIndex,name:t,$vars:["name"]}},m.option):null});return p.add(M),p.eachChild(function(t){t.silent=!0}),M.silent=!l,this.getContentGroup().add(p),pf.setHoverStyle(p),p.__legendDataIndex=e,p},layoutInner:function(t,e,i){var n=this.getContentGroup();jf.box(t.get("orient"),n,t.get("itemGap"),i.width,i.height);var r=n.getBoundingRect();return n.attr("position",[-r.x,-r.y]),this.group.getBoundingRect()}});var GL=function(t){var i=t.findComponents({mainType:"legend"});i&&i.length&&t.filterSeries(function(t){for(var e=0;e<i.length;e++)if(!i[e].isSelected(t.name))return!1;return!0})};fy.registerProcessor(GL),Yf.registerSubTypeDefaulter("legend",function(){return"plain"});var VL=jf.mergeLayoutParam,HL=jf.getLayoutParams,UL=TL.extend({type:"legend.scroll",setScrollDataIndex:function(t){this.option.scrollDataIndex=t},defaultOption:{scrollDataIndex:0,pageButtonItemGap:5,pageButtonGap:null,pageButtonPosition:"end",pageFormatter:"{current}/{total}",pageIcons:{horizontal:["M0,0L12,-10L12,10z","M0,0L-12,-10L-12,10z"],vertical:["M0,0L20,0L10,-20z","M0,0L20,0L10,20z"]},pageIconColor:"#2f4554",pageIconInactiveColor:"#aaa",pageIconSize:15,pageTextStyle:{color:"#333"},animationDurationUpdate:800},init:function(t,e,i,n){var r=HL(t);UL.superCall(this,"init",t,e,i,n),WL(this,t,r)},mergeOption:function(t,e){UL.superCall(this,"mergeOption",t,e),WL(this,this.option,t)},getOrient:function(){return"vertical"===this.get("orient")?{index:1,name:"vertical"}:{index:0,name:"horizontal"}}});function WL(t,e,i){var n=[1,1];n[t.getOrient().index]=0,VL(e,i,{type:"box",ignoreSize:n})}var jL=pf.Group,ZL=["width","height"],XL=["x","y"],qL=FL.extend({type:"legend.scroll",newlineDisabled:!0,init:function(){qL.superCall(this,"init"),this._currentIndex=0,this.group.add(this._containerGroup=new jL),this._containerGroup.add(this.getContentGroup()),this.group.add(this._controllerGroup=new jL),this._showController},resetInner:function(){qL.superCall(this,"resetInner"),this._controllerGroup.removeAll(),this._containerGroup.removeClipPath(),this._containerGroup.__rectSize=null},renderInner:function(t,r,e,o){var a=this;qL.superCall(this,"renderInner",t,r,e,o);var s=this._controllerGroup,l=r.get("pageIconSize",!0);za.isArray(l)||(l=[l,l]),n("pagePrev",0);var i=r.getModel("pageTextStyle");function n(t,e){var i=t+"DataIndex",n=pf.createIcon(r.get("pageIcons",!0)[r.getOrient().name][e],{onclick:za.bind(a._pageGo,a,i,r,o)},{x:-l[0]/2,y:-l[1]/2,width:l[0],height:l[1]});n.name=t,s.add(n)}s.add(new pf.Text({name:"pageText",style:{textFill:i.getTextColor(),font:i.getFont(),textVerticalAlign:"middle",textAlign:"center"},silent:!0})),n("pageNext",1)},layoutInner:function(t,e,i){var n=this.getContentGroup(),r=this._containerGroup,o=this._controllerGroup,a=t.getOrient().index,s=ZL[a],l=ZL[1-a],h=XL[1-a];jf.box(t.get("orient"),n,t.get("itemGap"),a?i.width:null,a?null:i.height),jf.box("horizontal",o,t.get("pageButtonItemGap",!0));var c=n.getBoundingRect(),u=o.getBoundingRect(),d=this._showController=c[s]>i[s],p=[-c.x,-c.y];p[a]=n.position[a];var f=[0,0],g=[-u.x,-u.y],m=za.retrieve2(t.get("pageButtonGap",!0),t.get("itemGap",!0));d&&("end"===t.get("pageButtonPosition",!0)?g[a]+=i[s]-u[s]:f[a]+=u[s]+m);g[1-a]+=c[l]/2-u[l]/2,n.attr("position",p),r.attr("position",f),o.attr("position",g);var v=this.group.getBoundingRect();if((v={x:0,y:0})[s]=d?i[s]:c[s],v[l]=Math.max(c[l],u[l]),v[h]=Math.min(0,u[h]+g[1-a]),r.__rectSize=i[s],d){var y={x:0,y:0};y[s]=Math.max(i[s]-u[s]-m,0),y[l]=v[l],r.setClipPath(new pf.Rect({shape:y})),r.__rectSize=y[s]}else o.eachChild(function(t){t.attr({invisible:!0,silent:!0})});var _=this._getPageInfo(t);return null!=_.pageIndex&&pf.updateProps(n,{position:_.contentPosition},!!d&&t),this._updatePageInfoView(t,_),v},_pageGo:function(t,e,i){var n=this._getPageInfo(e)[t];null!=n&&i.dispatchAction({type:"legendScroll",scrollDataIndex:n,legendId:e.id})},_updatePageInfoView:function(n,r){var o=this._controllerGroup;za.each(["pagePrev","pageNext"],function(t){var e=null!=r[t+"DataIndex"],i=o.childOfName(t);i&&(i.setStyle("fill",e?n.get("pageIconColor",!0):n.get("pageIconInactiveColor",!0)),i.cursor=e?"pointer":"default")});var t=o.childOfName("pageText"),e=n.get("pageFormatter"),i=r.pageIndex,a=null!=i?i+1:0,s=r.pageCount;t&&e&&t.setStyle("text",za.isString(e)?e.replace("{current}",a).replace("{total}",s):e({current:a,total:s}))},_getPageInfo:function(t){var e,i,n,r,o=t.get("scrollDataIndex",!0),a=this.getContentGroup(),s=a.getBoundingRect(),l=this._containerGroup.__rectSize,h=t.getOrient().index,c=ZL[h],u=ZL[1-h],d=XL[h],p=a.position.slice();this._showController?a.eachChild(function(t){t.__legendDataIndex===o&&(r=t)}):r=a.childAt(0);var f=l?Math.ceil(s[c]/l):0;if(r){var g=r.getBoundingRect(),m=r.position[h]+g[d];p[h]=-m-s[d],e=Math.floor(f*(m+g[d]+l/2)/s[c]),e=s[c]&&f?Math.max(0,Math.min(f-1,e)):-1;var v,y={x:0,y:0};y[c]=l,y[u]=s[u],y[d]=-p[h]-s[d];var _=a.children();if(a.eachChild(function(t,e){var i=w(t);i.intersect(y)&&(null==v&&(v=e),n=t.__legendDataIndex),e===_.length-1&&i[d]+i[c]<=y[d]+y[c]&&(n=null)}),null!=v){var x=w(_[v]);if(y[d]=x[d]+x[c]-y[c],v<=0&&x[d]>=y[d])i=null;else{for(;0<v&&w(_[v-1]).intersect(y);)v--;i=_[v].__legendDataIndex}}}return{contentPosition:p,pageIndex:e,pageCount:f,pagePrevDataIndex:i,pageNextDataIndex:n};function w(t){var e=t.getBoundingRect().clone();return e[d]+=t.position[h],e}}});fy.registerAction("legendScroll","legendscroll",function(t,e){var i=t.scrollDataIndex;null!=i&&e.eachComponent({mainType:"legend",subType:"scroll",query:t},function(t){t.setScrollDataIndex(i)})});fy.extendComponentModel({type:"tooltip",dependencies:["axisPointer"],defaultOption:{zlevel:0,z:8,show:!0,showContent:!0,trigger:"item",triggerOn:"mousemove|click",alwaysShowContent:!1,displayMode:"single",confine:!1,showDelay:0,hideDelay:100,transitionDuration:.4,enterable:!1,backgroundColor:"rgba(50,50,50,0.7)",borderColor:"#333",borderRadius:4,borderWidth:0,padding:5,extraCssText:"",axisPointer:{type:"line",axis:"auto",animation:"auto",animationDurationUpdate:200,animationEasingUpdate:"exponentialOut",crossStyle:{color:"#999",width:1,type:"dashed",textStyle:{}}},textStyle:{color:"#fff",fontSize:14}}});var YL=za.each,JL=Yc.toCamelCase,KL=["","-webkit-","-moz-","-o-"];function QL(r){var t,e,i,n,o,a,s,l=[],h=r.get("transitionDuration"),c=r.get("backgroundColor"),u=r.getModel("textStyle"),d=r.get("padding");return h&&l.push((i="left "+(t=h)+"s "+(e="cubic-bezier(0.23, 1, 0.32, 1)")+",top "+t+"s "+e,za.map(KL,function(t){return t+"transition:"+i}).join(";"))),c&&(ca.canvasSupported?l.push("background-Color:"+c):(l.push("background-Color:#"+Ns.toHex(c)),l.push("filter:alpha(opacity=70)"))),YL(["width","color","radius"],function(t){var e="border-"+t,i=JL(e),n=r.get(i);null!=n&&l.push(e+":"+n+("color"===t?"":"px"))}),l.push((o=[],a=(n=u).get("fontSize"),(s=n.getTextColor())&&o.push("color:"+s),o.push("font:"+n.getFont()),a&&o.push("line-height:"+Math.round(3*a/2)+"px"),YL(["decoration","align"],function(t){var e=n.get(t);e&&o.push("text-"+t+":"+e)}),o.join(";"))),null!=d&&l.push("padding:"+Yc.normalizeCssArray(d).join("px ")+"px"),l.join(";")+";"}function $L(i,t){var e=document.createElement("div"),n=this._zr=t.getZr();this.el=e,this._x=t.getWidth()/2,this._y=t.getHeight()/2,i.appendChild(e),this._container=i,this._show=!1,this._hideTimeout;var r=this;e.onmouseenter=function(){r._enterable&&(clearTimeout(r._hideTimeout),r._show=!0),r._inContent=!0},e.onmousemove=function(t){if(t=t||window.event,!r._enterable){var e=n.handler;pc.normalizeEvent(i,t,!0),e.dispatch("mousemove",t)}},e.onmouseleave=function(){r._enterable&&r._show&&r.hideLater(r._hideDelay),r._inContent=!1}}$L.prototype={constructor:$L,_enterable:!0,update:function(){var t=this._container,e=t.currentStyle||document.defaultView.getComputedStyle(t),i=t.style;"absolute"!==i.position&&"absolute"!==e.position&&(i.position="relative")},show:function(t){clearTimeout(this._hideTimeout);var e=this.el;e.style.cssText="position:absolute;display:block;border-style:solid;white-space:nowrap;z-index:9999999;"+QL(t)+";left:"+this._x+"px;top:"+this._y+"px;"+(t.get("extraCssText")||""),e.style.display=e.innerHTML?"block":"none",this._show=!0},setContent:function(t){this.el.innerHTML=null==t?"":t},setEnterable:function(t){this._enterable=t},getSize:function(){var t=this.el;return[t.clientWidth,t.clientHeight]},moveTo:function(t,e){var i,n=this._zr;n&&n.painter&&(i=n.painter.getViewportRootOffset())&&(t+=i.offsetLeft,e+=i.offsetTop);var r=this.el.style;r.left=t+"px",r.top=e+"px",this._x=t,this._y=e},hide:function(){this.el.style.display="none",this._show=!1},hideLater:function(t){!this._show||this._inContent&&this._enterable||(t?(this._hideDelay=t,this._show=!1,this._hideTimeout=setTimeout(za.bind(this.hide,this),t)):this.hide())},isShow:function(){return this._show}};var tI=$L,eI=za.bind,iI=za.each,nI=Uc.parsePercent,rI=new pf.Rect({shape:{x:-1,y:-1,width:2,height:2}});fy.extendComponentView({type:"tooltip",init:function(t,e){if(!ca.node){var i=new tI(e.getDom(),e);this._tooltipContent=i}},render:function(t,e,i){if(!ca.node){this.group.removeAll(),this._tooltipModel=t,this._ecModel=e,this._api=i,this._lastDataByCoordSys=null,this._alwaysShowContent=t.get("alwaysShowContent");var n=this._tooltipContent;n.update(),n.setEnterable(t.get("enterable")),this._initGlobalListener(),this._keepShow()}},_initGlobalListener:function(){var n=this._tooltipModel.get("triggerOn");MP.register("itemTooltip",this._api,eI(function(t,e,i){"none"!==n&&(0<=n.indexOf(t)?this._tryShow(e,i):"leave"===t&&this._hide(i))},this))},_keepShow:function(){var t=this._tooltipModel,e=this._ecModel,i=this._api;if(null!=this._lastX&&null!=this._lastY&&"none"!==t.get("triggerOn")){var n=this;clearTimeout(this._refreshUpdateTimeout),this._refreshUpdateTimeout=setTimeout(function(){n.manuallyShowTip(t,e,i,{x:n._lastX,y:n._lastY})})}},manuallyShowTip:function(t,e,i,n){if(n.from!==this.uid&&!ca.node){var r=aI(n,i);this._ticket="";var o=n.dataByCoordSys;if(n.tooltip&&null!=n.x&&null!=n.y){var a=rI;a.position=[n.x,n.y],a.update(),a.tooltip=n.tooltip,this._tryShow({offsetX:n.x,offsetY:n.y,target:a},r)}else if(o)this._tryShow({offsetX:n.x,offsetY:n.y,position:n.position,event:{},dataByCoordSys:n.dataByCoordSys,tooltipOption:n.tooltipOption},r);else if(null!=n.seriesIndex){if(this._manuallyAxisShowTip(t,e,i,n))return;var s=hP(n,e),l=s.point[0],h=s.point[1];null!=l&&null!=h&&this._tryShow({offsetX:l,offsetY:h,position:n.position,target:s.el,event:{}},r)}else null!=n.x&&null!=n.y&&(i.dispatchAction({type:"updateAxisPointer",x:n.x,y:n.y}),this._tryShow({offsetX:n.x,offsetY:n.y,position:n.position,target:i.getZr().findHover(n.x,n.y).target,event:{}},r))}},manuallyHideTip:function(t,e,i,n){var r=this._tooltipContent;this._alwaysShowContent||r.hideLater(this._tooltipModel.get("hideDelay")),this._lastX=this._lastY=null,n.from!==this.uid&&this._hide(aI(n,i))},_manuallyAxisShowTip:function(t,e,i,n){var r=n.seriesIndex,o=n.dataIndex,a=e.getComponent("axisPointer").coordSysAxesInfo;if(null!=r&&null!=o&&null!=a){var s=e.getSeriesByIndex(r);if(s)if("axis"===(t=oI([s.getData().getItemModel(o),s,(s.coordinateSystem||{}).model,t])).get("trigger"))return i.dispatchAction({type:"updateAxisPointer",seriesIndex:r,dataIndex:o,position:n.position}),!0}},_tryShow:function(t,e){var i=t.target;if(this._tooltipModel){this._lastX=t.offsetX,this._lastY=t.offsetY;var n=t.dataByCoordSys;n&&n.length?this._showAxisTooltip(n,t):i&&null!=i.dataIndex?(this._lastDataByCoordSys=null,this._showSeriesItemTooltip(t,i,e)):i&&i.tooltip?(this._lastDataByCoordSys=null,this._showComponentItemTooltip(t,i,e)):(this._lastDataByCoordSys=null,this._hide(e))}},_showOrMove:function(t,e){var i=t.get("showDelay");e=za.bind(e,this),clearTimeout(this._showTimout),0<i?this._showTimout=setTimeout(e,i):e()},_showAxisTooltip:function(t,e){var h=this._ecModel,i=this._tooltipModel,n=[e.offsetX,e.offsetY],c=[],u=[],r=oI([e.tooltipOption,i]);iI(t,function(t){iI(t.dataByAxis,function(r){var o=h.getComponent(r.axisDim+"Axis",r.axisIndex),a=r.value,s=[];if(o&&null!=a){var l=NP.getValueLabel(a,o.axis,h,r.seriesDataIndices,r.valueLabelOpt);za.each(r.seriesDataIndices,function(t){var e=h.getSeriesByIndex(t.seriesIndex),i=t.dataIndexInside,n=e&&e.getDataParams(i);n.axisDim=r.axisDim,n.axisIndex=r.axisIndex,n.axisType=r.axisType,n.axisId=r.axisId,n.axisValue=Cv.getAxisRawValue(o.axis,a),n.axisValueLabel=l,n&&(u.push(n),s.push(e.formatTooltip(i,!0)))});var t=l;c.push((t?Yc.encodeHTML(t)+"<br />":"")+s.join("<br />"))}})},this),c.reverse(),c=c.join("<br /><br />");var o=e.position;this._showOrMove(r,function(){this._updateContentNotChangedOnAxis(t)?this._updatePosition(r,o,n[0],n[1],this._tooltipContent,u):this._showTooltipContent(r,c,u,Math.random(),n[0],n[1],o)})},_showSeriesItemTooltip:function(t,e,i){var n=this._ecModel,r=e.seriesIndex,o=n.getSeriesByIndex(r),a=e.dataModel||o,s=e.dataIndex,l=e.dataType,h=a.getData(),c=oI([h.getItemModel(s),a,o&&(o.coordinateSystem||{}).model,this._tooltipModel]),u=c.get("trigger");if(null==u||"item"===u){var d=a.getDataParams(s,l),p=a.formatTooltip(s,!1,l),f="item_"+a.name+"_"+s;this._showOrMove(c,function(){this._showTooltipContent(c,p,d,f,t.offsetX,t.offsetY,t.position,t.target)}),i({type:"showTip",dataIndexInside:s,dataIndex:h.getRawIndex(s),seriesIndex:r,from:this.uid})}},_showComponentItemTooltip:function(t,e,i){var n=e.tooltip;if("string"==typeof n){n={content:n,formatter:n}}var r=new bf(n,this._tooltipModel,this._ecModel),o=r.get("content"),a=Math.random();this._showOrMove(r,function(){this._showTooltipContent(r,o,r.get("formatterParams")||{},a,t.offsetX,t.offsetY,t.position,e)}),i({type:"showTip",from:this.uid})},_showTooltipContent:function(i,t,n,e,r,o,a,s){if(this._ticket="",i.get("showContent")&&i.get("show")){var l=this._tooltipContent,h=i.get("formatter");a=a||i.get("position");var c=t;if(h&&"string"==typeof h)c=Yc.formatTpl(h,n,!0);else if("function"==typeof h){var u=eI(function(t,e){t===this._ticket&&(l.setContent(e),this._updatePosition(i,a,r,o,l,n,s))},this);this._ticket=e,c=h(n,e,u)}l.setContent(c),l.show(i),this._updatePosition(i,a,r,o,l,n,s)}},_updatePosition:function(t,e,i,n,r,o,a){var s=this._api.getWidth(),l=this._api.getHeight();e=e||t.get("position");var h,c,u,d,p,f,g,m,v=r.getSize(),y=t.get("align"),_=t.get("verticalAlign"),x=a&&a.getBoundingRect().clone();if(a&&x.applyTransform(a.transform),"function"==typeof e&&(e=e([i,n],o,r.el,x,{viewSize:[s,l],contentSize:v.slice()})),za.isArray(e))i=nI(e[0],s),n=nI(e[1],l);else if(za.isObject(e)){e.width=v[0],e.height=v[1];var w=jf.getLayoutRect(e,{width:s,height:l});i=w.x,n=w.y,_=y=null}else if("string"==typeof e&&a){i=(b=function(t,e,i){var n=i[0],r=i[1],o=0,a=0,s=e.width,l=e.height;switch(t){case"inside":o=e.x+s/2-n/2,a=e.y+l/2-r/2;break;case"top":o=e.x+s/2-n/2,a=e.y-r-5;break;case"bottom":o=e.x+s/2-n/2,a=e.y+l+5;break;case"left":o=e.x-n-5,a=e.y+l/2-r/2;break;case"right":o=e.x+s+5,a=e.y+l/2-r/2}return[o,a]}(e,x,v))[0],n=b[1]}else{var b;i=(b=function(t,e,i,n,r,o,a){var s=sI(i),l=s.width,h=s.height;null!=o&&(n<t+l+o?t-=l+o:t+=o);null!=a&&(r<e+h+a?e-=h+a:e+=a);return[t,e]}(i,n,r.el,s,l,y?null:20,_?null:20))[0],n=b[1]}(y&&(i-=lI(y)?v[0]/2:"right"===y?v[0]:0),_&&(n-=lI(_)?v[1]/2:"bottom"===_?v[1]:0),t.get("confine"))&&(i=(b=(h=i,c=n,u=r.el,d=s,p=l,f=sI(u),g=f.width,m=f.height,h=Math.min(h+g,d)-g,c=Math.min(c+m,p)-m,h=Math.max(h,0),c=Math.max(c,0),[h,c]))[0],n=b[1]);r.moveTo(i,n)},_updateContentNotChangedOnAxis:function(n){var t=this._lastDataByCoordSys,a=!!t&&t.length===n.length;return a&&iI(t,function(t,e){var i=t.dataByAxis||{},o=(n[e]||{}).dataByAxis||[];(a&=i.length===o.length)&&iI(i,function(t,e){var i=o[e]||{},n=t.seriesDataIndices||[],r=i.seriesDataIndices||[];(a&=t.value===i.value&&t.axisType===i.axisType&&t.axisId===i.axisId&&n.length===r.length)&&iI(n,function(t,e){var i=r[e];a&=t.seriesIndex===i.seriesIndex&&t.dataIndex===i.dataIndex})})}),this._lastDataByCoordSys=n,!!a},_hide:function(t){this._lastDataByCoordSys=null,t({type:"hideTip",from:this.uid})},dispose:function(t,e){ca.node||(this._tooltipContent.hide(),MP.unregister("itemTooltip",e))}});function oI(t){for(var e=t.pop();t.length;){var i=t.pop();i&&(i instanceof bf&&(i=i.get("tooltip",!0)),"string"==typeof i&&(i={formatter:i}),e=new bf(i,e,e.ecModel))}return e}function aI(t,e){return t.dispatchAction||za.bind(e.dispatchAction,e)}function sI(t){var e=t.clientWidth,i=t.clientHeight;if(document.defaultView&&document.defaultView.getComputedStyle){var n=document.defaultView.getComputedStyle(t);n&&(e+=parseInt(n.paddingLeft,10)+parseInt(n.paddingRight,10)+parseInt(n.borderLeftWidth,10)+parseInt(n.borderRightWidth,10),i+=parseInt(n.paddingTop,10)+parseInt(n.paddingBottom,10)+parseInt(n.borderTopWidth,10)+parseInt(n.borderBottomWidth,10))}return{width:e,height:i}}function lI(t){return"center"===t||"middle"===t}fy.registerAction({type:"showTip",event:"showTip",update:"tooltip:manuallyShowTip"},function(){}),fy.registerAction({type:"hideTip",event:"hideTip",update:"tooltip:manuallyHideTip"},function(){});var hI=Uc.parsePercent;function cI(t){return t.get("stack")||"__ec_stack_"+t.seriesIndex}function uI(t){return t.dim}var dI=function(t,e,i){var o=i.getWidth(),a=i.getHeight(),A={},E={},s=function(t,e){var f={};za.each(t,function(t,e){var i=t.getData(),n=t.coordinateSystem,r=n.getBaseAxis(),o=r.getExtent(),a="category"===r.type?r.getBandWidth():Math.abs(o[1]-o[0])/i.count(),s=f[uI(r)]||{bandWidth:a,remainedWidth:a,autoWidthCount:0,categoryGap:"20%",gap:"30%",stacks:{}},l=s.stacks;f[uI(r)]=s;var h=cI(t);l[h]||s.autoWidthCount++,l[h]=l[h]||{width:0,maxWidth:0};var c=hI(t.get("barWidth"),a),u=hI(t.get("barMaxWidth"),a),d=t.get("barGap"),p=t.get("barCategoryGap");c&&!l[h].width&&(c=Math.min(s.remainedWidth,c),l[h].width=c,s.remainedWidth-=c),u&&(l[h].maxWidth=u),null!=d&&(s.gap=d),null!=p&&(s.categoryGap=p)});var d={};return za.each(f,function(t,i){d[i]={};var e=t.stacks,n=t.bandWidth,r=hI(t.categoryGap,n),o=hI(t.gap,1),a=t.remainedWidth,s=t.autoWidthCount,l=(a-r)/(s+(s-1)*o);l=Math.max(l,0),za.each(e,function(t,e){var i=t.maxWidth;i&&i<l&&(i=Math.min(i,a),t.width&&(i=Math.min(i,t.width)),a-=i,t.width=i,s--)}),l=(a-r)/(s+(s-1)*o),l=Math.max(l,0);var h,c=0;za.each(e,function(t,e){t.width||(t.width=l),c+=(h=t).width*(1+o)}),h&&(c-=h.width*o);var u=-c/2;za.each(e,function(t,e){d[i][e]=d[i][e]||{offset:u,width:t.width},u+=t.width*(1+o)})}),d}(za.filter(e.getSeriesByType(t),function(t){return!e.isSeriesFiltered(t)&&t.coordinateSystem&&"polar"===t.coordinateSystem.type}));e.eachSeriesByType(t,function(t){if("polar"===t.coordinateSystem.type){var d=t.getData(),p=t.coordinateSystem,f=p.getAngleAxis(),e=p.getBaseAxis(),g=cI(t),i=s[uI(e)][g],m=i.offset,v=i.width,y=p.getOtherAxis(e),n=t.get("center")||["50%","50%"],_=hI(n[0],o),x=hI(n[1],a),w=t.get("barMinHeight")||0,b=t.get("barMinAngle")||0,M=y.getExtent()[0],S=y.model.get("max"),T=y.model.get("min"),r=[t.coordDimToDataDim("radius")[0],t.coordDimToDataDim("angle")[0]],C=d.mapArray(r,function(t,e){return p.dataToPoint([t,e])},!0);A[g]=A[g]||[],E[g]=E[g]||[],d.each(t.coordDimToDataDim(y.dim)[0],function(t,e){if(!isNaN(t)){A[g][e]||(A[g][e]={p:M,n:M},E[g][e]={p:M,n:M});var i,n,r,o,a=0<=t?"p":"n",s=p.pointToCoord(C[e]),l=E[g][e][a];if("radius"===y.dim)i=l,n=s[0],o=(r=(-s[1]+m)*Math.PI/180)+v*Math.PI/180,Math.abs(n)<w&&(n=i+(n<0?-1:1)*w),E[g][e][a]=n;else{n=(i=s[0]+m)+v,null!=S&&(t=Math.min(t,S)),null!=T&&(t=Math.max(t,T));var h=f.dataToAngle(t);Math.abs(h-l)<b&&(h=l-(t<0?-1:1)*b),r=-l*Math.PI/180,o=-h*Math.PI/180;var c=f.getExtent(),u=h;u===c[0]&&0<t?u=c[1]:u===c[1]&&t<0&&(u=c[0]),E[g][e][a]=u}d.setItemLayout(e,{cx:_,cy:x,r0:i,r:n,startAngle:r,endAngle:o})}},!0)}},this)};function pI(t,e){Wv.call(this,"radius",t,e),this.type="category"}pI.prototype={constructor:pI,pointToData:function(t,e){return this.polar.pointToData(t,e)["radius"===this.dim?0:1]},dataToRadius:Wv.prototype.dataToCoord,radiusToData:Wv.prototype.coordToData},za.inherits(pI,Wv);var fI=pI;function gI(t,e){e=e||[0,360],Wv.call(this,"angle",t,e),this.type="category"}gI.prototype={constructor:gI,pointToData:function(t,e){return this.polar.pointToData(t,e)["radius"===this.dim?0:1]},dataToAngle:Wv.prototype.dataToCoord,angleToData:Wv.prototype.coordToData},za.inherits(gI,Wv);var mI=gI,vI=function(t){this.name=t||"",this.cx=0,this.cy=0,this._radiusAxis=new fI,this._angleAxis=new mI,this._radiusAxis.polar=this._angleAxis.polar=this};vI.prototype={type:"polar",axisPointerEnabled:!0,constructor:vI,dimensions:["radius","angle"],model:null,containPoint:function(t){var e=this.pointToCoord(t);return this._radiusAxis.contain(e[0])&&this._angleAxis.contain(e[1])},containData:function(t){return this._radiusAxis.containData(t[0])&&this._angleAxis.containData(t[1])},getAxis:function(t){return this["_"+t+"Axis"]},getAxes:function(){return[this._radiusAxis,this._angleAxis]},getAxesByScale:function(t){var e=[],i=this._angleAxis,n=this._radiusAxis;return i.scale.type===t&&e.push(i),n.scale.type===t&&e.push(n),e},getAngleAxis:function(){return this._angleAxis},getRadiusAxis:function(){return this._radiusAxis},getOtherAxis:function(t){var e=this._angleAxis;return t===e?this._radiusAxis:e},getBaseAxis:function(){return this.getAxesByScale("ordinal")[0]||this.getAxesByScale("time")[0]||this.getAngleAxis()},getTooltipAxes:function(t){var e=null!=t&&"auto"!==t?this.getAxis(t):this.getBaseAxis();return{baseAxes:[e],otherAxes:[this.getOtherAxis(e)]}},dataToPoint:function(t,e){return this.coordToPoint([this._radiusAxis.dataToRadius(t[0],e),this._angleAxis.dataToAngle(t[1],e)])},pointToData:function(t,e){var i=this.pointToCoord(t);return[this._radiusAxis.radiusToData(i[0],e),this._angleAxis.angleToData(i[1],e)]},pointToCoord:function(t){var e=t[0]-this.cx,i=t[1]-this.cy,n=this.getAngleAxis(),r=n.getExtent(),o=Math.min(r[0],r[1]),a=Math.max(r[0],r[1]);n.inverse?o=a-360:a=o+360;var s=Math.sqrt(e*e+i*i);e/=s,i/=s;for(var l=Math.atan2(-i,e)/Math.PI*180,h=l<o?1:-1;l<o||a<l;)l+=360*h;return[s,l]},coordToPoint:function(t){var e=t[0],i=t[1]/180*Math.PI;return[Math.cos(i)*e+this.cx,-Math.sin(i)*e+this.cy]}};var yI=vI,_I=Yf.extend({type:"polarAxis",axis:null,getCoordSysModel:function(){return this.ecModel.queryComponents({mainType:"polar",index:this.option.polarIndex,id:this.option.polarId})[0]}});za.merge(_I.prototype,Ev);var xI={splitNumber:5};function wI(t,e){return e.type||(e.data?"category":"value")}__("angle",_I,wI,{startAngle:90,clockwise:!0,splitNumber:12,axisLabel:{rotate:!1}}),__("radius",_I,wI,xI);fy.extendComponentModel({type:"polar",dependencies:["polarAxis","angleAxis"],coordinateSystem:null,findAxisModel:function(t){var e;return this.ecModel.eachComponent(t,function(t){t.getCoordSysModel()===this&&(e=t)},this),e},defaultOption:{zlevel:0,z:0,center:["50%","50%"],radius:"80%"}});var bI=Uc.parsePercent,MI=Cv.createScaleByModel,SI=Cv.niceScaleExtent;function TI(t,e){var i=this,n=i.getAngleAxis(),r=i.getRadiusAxis();if(n.scale.setExtent(1/0,-1/0),r.scale.setExtent(1/0,-1/0),t.eachSeries(function(t){if(t.coordinateSystem===i){var e=t.getData();r.scale.unionExtentFromData(e,"radius"),n.scale.unionExtentFromData(e,"angle")}}),SI(n.scale,n.model),SI(r.scale,r.model),"category"===n.type&&!n.onBand){var o=n.getExtent(),a=360/n.scale.count();n.inverse?o[1]+=a:o[1]-=a,n.setExtent(o[0],o[1])}}function CI(t,e){if(t.type=e.get("type"),t.scale=MI(e),t.onBand=e.get("boundaryGap")&&"category"===t.type,t.inverse=e.get("inverse"),"angleAxis"===e.mainType){t.inverse^=e.get("clockwise");var i=e.get("startAngle");t.setExtent(i,i+(t.inverse?-360:360))}(e.axis=t).model=e}var AI={dimensions:yI.prototype.dimensions,create:function(i,s){var l=[];return i.eachComponent("polar",function(t,e){var i=new yI(e);i.update=TI;var n=i.getRadiusAxis(),r=i.getAngleAxis(),o=t.findAxisModel("radiusAxis"),a=t.findAxisModel("angleAxis");CI(n,o),CI(r,a),function(t,e,i){var n=e.get("center"),r=i.getWidth(),o=i.getHeight();t.cx=bI(n[0],r),t.cy=bI(n[1],o);var a=t.getRadiusAxis(),s=Math.min(r,o)/2,l=bI(e.get("radius"),s);a.inverse?a.setExtent(l,0):a.setExtent(0,l)}(i,t,s),l.push(i),(t.coordinateSystem=i).model=t}),i.eachSeries(function(t){if("polar"===t.get("coordinateSystem")){var e=i.queryComponents({mainType:"polar",index:t.get("polarIndex"),id:t.get("polarId")})[0];t.coordinateSystem=e.coordinateSystem}}),l}};mg.register("polar",AI);var EI=["axisLine","axisLabel","axisTick","splitLine","splitArea"];function PI(t,e,i){e[1]>e[0]&&(e=e.slice().reverse());var n=t.coordToPoint([e[0],i]),r=t.coordToPoint([e[1],i]);return{x1:n[0],y1:n[1],x2:r[0],y2:r[1]}}function LI(t){return t.getRadiusAxis().inverse?0:1}dx.extend({type:"angleAxis",axisPointerClass:"PolarAxisPointer",render:function(e,t){if(this.group.removeAll(),e.get("show")){var i=e.axis,n=i.polar,r=n.getRadiusAxis().getExtent(),o=i.getTicksCoords();"category"!==i.type&&o.pop(),za.each(EI,function(t){!e.get(t+".show")||i.scale.isBlank()&&"axisLine"!==t||this["_"+t](e,n,o,r)},this)}},_axisLine:function(t,e,i,n){var r=t.getModel("axisLine.lineStyle"),o=new pf.Circle({shape:{cx:e.cx,cy:e.cy,r:n[LI(e)]},style:r.getLineStyle(),z2:1,silent:!0});o.style.fill=null,this.group.add(o)},_axisTick:function(t,e,i,n){var r=t.getModel("axisTick"),o=(r.get("inside")?-1:1)*r.get("length"),a=n[LI(e)],s=za.map(i,function(t){return new pf.Line({shape:PI(e,[a,a+o],t)})});this.group.add(pf.mergePath(s,{style:za.defaults(r.getModel("lineStyle").getLineStyle(),{stroke:t.get("axisLine.lineStyle.color")})}))},_axisLabel:function(t,e,i,n){for(var r=t.axis,o=t.get("data"),a=t.getModel("axisLabel"),s=t.getFormattedLabels(),l=a.get("margin"),h=r.getLabelsCoords(),c=0;c<i.length;c++){var u=n[LI(e)],d=e.coordToPoint([u+l,h[c]]),p=e.cx,f=e.cy,g=Math.abs(d[0]-p)/u<.3?"center":d[0]>p?"left":"right",m=Math.abs(d[1]-f)/u<.3?"middle":d[1]>f?"top":"bottom";o&&o[c]&&o[c].textStyle&&(a=new bf(o[c].textStyle,a,a.ecModel));var v=new pf.Text({silent:!0});this.group.add(v),pf.setTextStyle(v.style,a,{x:d[0],y:d[1],textFill:a.getTextColor()||t.get("axisLine.lineStyle.color"),text:s[c],textAlign:g,textVerticalAlign:m})}},_splitLine:function(t,e,i,n){var r=t.getModel("splitLine").getModel("lineStyle"),o=r.get("color"),a=0;o=o instanceof Array?o:[o];for(var s=[],l=0;l<i.length;l++){var h=a++%o.length;s[h]=s[h]||[],s[h].push(new pf.Line({shape:PI(e,n,i[l])}))}for(l=0;l<s.length;l++)this.group.add(pf.mergePath(s[l],{style:za.defaults({stroke:o[l%o.length]},r.getLineStyle()),silent:!0,z:t.get("z")}))},_splitArea:function(t,e,i,n){var r=t.getModel("splitArea").getModel("areaStyle"),o=r.get("color"),a=0;o=o instanceof Array?o:[o];for(var s=[],l=Math.PI/180,h=-i[0]*l,c=Math.min(n[0],n[1]),u=Math.max(n[0],n[1]),d=t.get("clockwise"),p=1;p<i.length;p++){var f=a++%o.length;s[f]=s[f]||[],s[f].push(new pf.Sector({shape:{cx:e.cx,cy:e.cy,r0:c,r:u,startAngle:h,endAngle:-i[p]*l,clockwise:d},silent:!0})),h=-i[p]*l}for(p=0;p<s.length;p++)this.group.add(pf.mergePath(s[p],{style:za.defaults({fill:o[p%o.length]},r.getAreaStyle()),silent:!0}))}});var II=["axisLine","axisTickLabel","axisName"],RI=["splitLine","splitArea"];dx.extend({type:"radiusAxis",axisPointerClass:"PolarAxisPointer",render:function(e,t){if(this.group.removeAll(),e.get("show")){var i,n,r,o=e.axis,a=o.polar,s=a.getAngleAxis(),l=o.getTicksCoords(),h=s.getExtent()[0],c=o.getExtent(),u=(n=e,r=h,{position:[(i=a).cx,i.cy],rotation:r/180*Math.PI,labelDirection:-1,tickDirection:-1,nameDirection:1,labelRotate:n.getModel("axisLabel").get("rotate"),z2:1}),d=new tx(e,u);za.each(II,d.add,d),this.group.add(d.getGroup()),za.each(RI,function(t){e.get(t+".show")&&!o.scale.isBlank()&&this["_"+t](e,a,h,c,l)},this)}},_splitLine:function(t,e,i,n,r){var o=t.getModel("splitLine").getModel("lineStyle"),a=o.get("color"),s=0;a=a instanceof Array?a:[a];for(var l=[],h=0;h<r.length;h++){var c=s++%a.length;l[c]=l[c]||[],l[c].push(new pf.Circle({shape:{cx:e.cx,cy:e.cy,r:r[h]},silent:!0}))}for(h=0;h<l.length;h++)this.group.add(pf.mergePath(l[h],{style:za.defaults({stroke:a[h%a.length],fill:null},o.getLineStyle()),silent:!0}))},_splitArea:function(t,e,i,n,r){var o=t.getModel("splitArea").getModel("areaStyle"),a=o.get("color"),s=0;a=a instanceof Array?a:[a];for(var l=[],h=r[0],c=1;c<r.length;c++){var u=s++%a.length;l[u]=l[u]||[],l[u].push(new pf.Sector({shape:{cx:e.cx,cy:e.cy,r0:h,r:r[c],startAngle:0,endAngle:2*Math.PI},silent:!0})),h=r[c]}for(c=0;c<l.length;c++)this.group.add(pf.mergePath(l[c],{style:za.defaults({fill:a[c%a.length]},o.getAreaStyle()),silent:!0}))}});var DI=DP.extend({makeElOption:function(t,e,i,n,r){var o=i.axis;"angle"===o.dim&&(this.animationThreshold=Math.PI/18);var a,s=o.polar,l=s.getOtherAxis(o).getExtent();a=o["dataTo"+Yc.capitalFirst(o.dim)](e);var h=n.get("type");if(h&&"none"!==h){var c=NP.buildElStyle(n),u=OI[h](o,s,a,l,c);u.style=c,t.graphicKey=u.type,t.pointer=u}var d=function(t,e,i,n,r){var o=e.axis,a=o.dataToCoord(t),s=n.getAngleAxis().getExtent()[0];s=s/180*Math.PI;var l,h,c,u=n.getRadiusAxis().getExtent();if("radius"===o.dim){var d=ns.create();ns.rotate(d,d,s),ns.translate(d,d,[n.cx,n.cy]),l=pf.applyTransform([a,-r],d);var p=e.getModel("axisLabel").get("rotate")||0,f=tx.innerTextLayout(s,p*Math.PI/180,-1);h=f.textAlign,c=f.textVerticalAlign}else{var g=u[1];l=n.coordToPoint([g+r,a]);var m=n.cx,v=n.cy;h=Math.abs(l[0]-m)/g<.3?"center":l[0]>m?"left":"right",c=Math.abs(l[1]-v)/g<.3?"middle":l[1]>v?"top":"bottom"}return{position:l,align:h,verticalAlign:c}}(e,i,0,s,n.get("label.margin"));NP.buildLabelElOption(t,i,n,r,d)}});var OI={line:function(t,e,i,n,r){return"angle"===t.dim?{type:"Line",shape:NP.makeLineShape(e.coordToPoint([n[0],i]),e.coordToPoint([n[1],i]))}:{type:"Circle",shape:{cx:e.cx,cy:e.cy,r:i}}},shadow:function(t,e,i,n,r){var o=t.getBandWidth(),a=Math.PI/180;return"angle"===t.dim?{type:"Sector",shape:NP.makeSectorShape(e.cx,e.cy,n[0],n[1],(-i-o/2)*a,(o/2-i)*a)}:{type:"Sector",shape:NP.makeSectorShape(e.cx,e.cy,i-o/2,i+o/2,0,2*Math.PI)}}};dx.registerAxisPointerClass("PolarAxisPointer",DI),fy.registerLayout(za.curry(dI,"bar")),fy.extendComponentView({type:"polar"});var kI=Yf.extend({type:"geo",coordinateSystem:null,layoutMode:"box",init:function(t){Yf.prototype.init.apply(this,arguments),If.defaultEmphasis(t.label,["show"])},optionUpdated:function(){var t=this.option,i=this;t.regions=Nw.getFilledRegions(t.regions,t.map,t.nameMap),this._optionModelMap=za.reduce(t.regions||[],function(t,e){return e.name&&t.set(e.name,new bf(e,i)),t},za.createHashMap()),this.updateSelectedMap(t.regions)},defaultOption:{zlevel:0,z:0,show:!0,left:"center",top:"center",aspectScale:.75,silent:!1,map:"",boundingCoords:null,center:null,zoom:1,scaleLimit:null,label:{normal:{show:!1,color:"#000"},emphasis:{show:!0,color:"rgb(100,0,0)"}},itemStyle:{normal:{borderWidth:.5,borderColor:"#444",color:"#eee"},emphasis:{color:"rgba(255,215,0,0.8)"}},regions:[]},getRegionModel:function(t){return this._optionModelMap.get(t)||new bf(null,this,this.ecModel)},getFormattedLabel:function(t,e){var i=this.getRegionModel(t).get("label."+e+".formatter"),n={name:t};return"function"==typeof i?(n.status=e,i(n)):"string"==typeof i?i.replace("{a}",null!=t?t:""):void 0},setZoom:function(t){this.option.zoom=t},setCenter:function(t){this.option.center=t}});za.mixin(kI,Bx);fy.extendComponentView({type:"geo",init:function(t,e){var i=new ab(e,!0);this._mapDraw=i,this.group.add(i.group)},render:function(t,e,i,n){if(!n||"geoToggleSelect"!==n.type||n.from!==this.uid){var r=this._mapDraw;t.get("show")?r.draw(t,e,i,this,n):this._mapDraw.group.removeAll(),this.group.silent=t.get("silent")}},dispose:function(){this._mapDraw&&this._mapDraw.remove()}});function zI(r,t){t.update="updateView",fy.registerAction(t,function(i,t){var n={};return t.eachComponent({mainType:"geo",query:i},function(e){e[r](i.name);var t=e.coordinateSystem;za.each(t.regions,function(t){n[t.name]=e.isSelected(t.name)||!1})}),{selected:n,name:i.name}})}zI("toggleSelected",{type:"geoToggleSelect",event:"geoselectchanged"}),zI("select",{type:"geoSelect",event:"geoselected"}),zI("unSelect",{type:"geoUnSelect",event:"geounselected"});var NI=["rect","polygon","keep","clear"];var BI=function(t,e){var i=t&&t.brush;if(za.isArray(i)||(i=i?[i]:[]),i.length){var n=[];za.each(i,function(t){var e=t.hasOwnProperty("toolbox")?t.toolbox:[];e instanceof Array&&(n=n.concat(e))});var r=t&&t.toolbox;za.isArray(r)&&(r=r[0]),r||(r={feature:{}},t.toolbox=[r]);var o,a,s=r.feature||(r.feature={}),l=s.brush||(s.brush={}),h=l.type||(l.type=[]);h.push.apply(h,n),o=h,a={},za.each(o,function(t){a[t]=1}),o.length=0,za.each(a,function(t,e){o.push(e)}),e&&!h.length&&h.push.apply(h,NI)}},FI=za.each;function GI(t){if(t)for(var e in t)if(t.hasOwnProperty(e))return!0}var VI={createVisualMappings:function(e,t,o){var i={};return FI(t,function(n){var t,r=i[n]=((t=function(){}).prototype.__hidden=t.prototype,new t);FI(e[n],function(t,e){if(BM.isValidType(e)){var i={type:e,visual:t};o&&o(i,n),r[e]=new BM(i),"opacity"===e&&((i=za.clone(i)).type="colorAlpha",r.__hidden.__alphaForOpacity=new BM(i))}})}),i},replaceVisualOption:function(e,i,t){var n;za.each(t,function(t){i.hasOwnProperty(t)&&GI(i[t])&&(n=!0)}),n&&za.each(t,function(t){i.hasOwnProperty(t)&&GI(i[t])?e[t]=za.clone(i[t]):delete e[t]})},applyVisual:function(t,h,c,u,d,p){var f,g={};function m(t){return c.getItemVisual(f,t)}function v(t,e){c.setItemVisual(f,t,e)}function e(t,e){f=null==p?t:e;var i=c.getRawDataItem(f);if(!i||!1!==i.visualMap)for(var n=u.call(d,t),r=h[n],o=g[n],a=0,s=o.length;a<s;a++){var l=o[a];r[l]&&r[l].applyVisual(t,m,v)}}za.each(t,function(t){var e=BM.prepareVisualTypes(h[t]);g[t]=e}),null==p?c.each(e,!0):c.each([p],e,!0)}};function HI(o){var a=["x","y"],s=["width","height"];return{point:function(t,e,i){if(t){var n=i.range;return UI(t[o],n)}},rect:function(t,e,i){if(t){var n=i.range,r=[t[a[o]],t[a[o]]+t[s[o]]];return r[1]<r[0]&&r.reverse(),UI(r[0],n)||UI(r[1],n)||UI(n[0],r)||UI(n[1],r)}}}}function UI(t,e){return e[0]<=t&&t<=e[1]}function WI(t,e,i,n,r){for(var o=0,a=r[r.length-1];o<r.length;o++){var s=r[o];if(jI(t,e,i,n,s[0],s[1],a[0],a[1]))return!0;a=s}}function jI(t,e,i,n,r,o,a,s){var l,h=ZI(i-t,r-a,n-e,o-s);if((l=h)<=1e-6&&-1e-6<=l)return!1;var c=ZI(r-t,r-a,o-e,o-s)/h;if(c<0||1<c)return!1;var u=ZI(i-t,r-t,n-e,o-e)/h;return!(u<0||1<u)}function ZI(t,e,i,n){return t*n-e*i}var XI={lineX:HI(0),lineY:HI(1),rect:{point:function(t,e,i){return t&&i.boundingRect.contain(t[0],t[1])},rect:function(t,e,i){return t&&i.boundingRect.intersect(t)}},polygon:{point:function(t,e,i){return t&&i.boundingRect.contain(t[0],t[1])&&Xv.contain(i.range,t[0],t[1])},rect:function(t,e,i){var n=i.range;if(!t||n.length<=1)return!1;var r=t.x,o=t.y,a=t.width,s=t.height,l=n[0];return!!(Xv.contain(n,r,o)||Xv.contain(n,r+a,o)||Xv.contain(n,r,o+s)||Xv.contain(n,r+a,o+s)||bl.create(t).contain(l[0],l[1])||WI(r,o,r+a,o,n)||WI(r,o,r,o+s,n)||WI(r+a,o,r+a,o+s,n)||WI(r,o+s,r+a,o+s,n))||void 0}}},qI=za.each,YI=za.indexOf,JI=za.curry,KI=["dataToPoint","pointToData"],QI=["grid","xAxis","yAxis","geo","graph","polar","radiusAxis","angleAxis","bmap"];function $I(t,e,i){var n=this._targetInfoList=[],r={},o=iR(e,t);qI(nR,function(t,e){(!i||!i.include||0<=YI(i.include,e))&&t(o,n,r)})}var tR=$I.prototype;function eR(t){return t[0]>t[1]&&t.reverse(),t}function iR(t,e){return If.parseFinder(t,e,{includeMainTypes:QI})}tR.setOutputRanges=function(t,e){this.matchOutputRanges(t,e,function(t,e,i){if((t.coordRanges||(t.coordRanges=[])).push(e),!t.coordRange){t.coordRange=e;var n=aR[t.brushType](0,i,e);t.__rangeOffset={offset:lR[t.brushType](n.values,t.range,[1,1]),xyMinMax:n.xyMinMax}}})},tR.matchOutputRanges=function(t,n,r){qI(t,function(i){var t=this.findTargetInfo(i,n);t&&!0!==t&&za.each(t.coordSyses,function(t){var e=aR[i.brushType](1,t,i.range);r(i,e.values,t,n)})},this)},tR.setInputRanges=function(t,h){qI(t,function(t){var e,i,n,r,o,a=this.findTargetInfo(t,h);if(t.range=t.range||[],a&&!0!==a){t.panelId=a.panelId;var s=aR[t.brushType](0,a.coordSys,t.coordRange),l=t.__rangeOffset;t.range=l?lR[t.brushType](s.values,l.offset,(e=s.xyMinMax,i=l.xyMinMax,n=cR(e),r=cR(i),o=[n[0]/r[0],n[1]/r[1]],isNaN(o[0])&&(o[0]=1),isNaN(o[1])&&(o[1]=1),o)):s.values}},this)},tR.makePanelOpts=function(i,n){return za.map(this._targetInfoList,function(t){var e=t.getPanelRect();return{panelId:t.panelId,defaultBrushType:n&&n(t),clipPath:BC.makeRectPanelClipPath(e),isTargetByCursor:BC.makeRectIsTargetByCursor(e,i,t.coordSysModel),getLinearBrushOtherExtent:BC.makeLinearBrushOtherExtent(e)}})},tR.controlSeries=function(t,e,i){var n=this.findTargetInfo(t,i);return!0===n||n&&0<=YI(n.coordSyses,e.coordinateSystem)},tR.findTargetInfo=function(t,e){for(var i=this._targetInfoList,n=iR(e,t),r=0;r<i.length;r++){var o=i[r],a=t.panelId;if(a){if(o.panelId===a)return o}else for(r=0;r<rR.length;r++)if(rR[r](n,o))return o}return!0};var nR={grid:function(t,n){var r=t.xAxisModels,o=t.yAxisModels,e=t.gridModels,i=za.createHashMap(),a={},s={};(r||o||e)&&(qI(r,function(t){var e=t.axis.grid.model;i.set(e.id,e),a[e.id]=!0}),qI(o,function(t){var e=t.axis.grid.model;i.set(e.id,e),s[e.id]=!0}),qI(e,function(t){i.set(t.id,t),a[t.id]=!0,s[t.id]=!0}),i.each(function(t){var e=t.coordinateSystem,i=[];qI(e.getCartesians(),function(t,e){(0<=YI(r,t.getAxis("x").model)||0<=YI(o,t.getAxis("y").model))&&i.push(t)}),n.push({panelId:"grid--"+t.id,gridModel:t,coordSysModel:t,coordSys:i[0],coordSyses:i,getPanelRect:oR.grid,xAxisDeclared:a[t.id],yAxisDeclared:s[t.id]})}))},geo:function(t,i){qI(t.geoModels,function(t){var e=t.coordinateSystem;i.push({panelId:"geo--"+t.id,geoModel:t,coordSysModel:t,coordSys:e,coordSyses:[e],getPanelRect:oR.geo})})}},rR=[function(t,e){var i=t.xAxisModel,n=t.yAxisModel,r=t.gridModel;return!r&&i&&(r=i.axis.grid.model),!r&&n&&(r=n.axis.grid.model),r&&r===e.gridModel},function(t,e){var i=t.geoModel;return i&&i===e.geoModel}],oR={grid:function(){return this.coordSys.grid.getRect().clone()},geo:function(){var t=this.coordSys,e=t.getBoundingRect().clone();return e.applyTransform(pf.getTransform(t)),e}},aR={lineX:JI(sR,0),lineY:JI(sR,1),rect:function(t,e,i){var n=e[KI[t]]([i[0][0],i[1][0]]),r=e[KI[t]]([i[0][1],i[1][1]]),o=[eR([n[0],r[0]]),eR([n[1],r[1]])];return{values:o,xyMinMax:o}},polygon:function(i,n,t){var r=[[1/0,-1/0],[1/0,-1/0]];return{values:za.map(t,function(t){var e=n[KI[i]](t);return r[0][0]=Math.min(r[0][0],e[0]),r[1][0]=Math.min(r[1][0],e[1]),r[0][1]=Math.max(r[0][1],e[0]),r[1][1]=Math.max(r[1][1],e[1]),e}),xyMinMax:r}}};function sR(t,e,i,n){var r=i.getAxis(["x","y"][t]),o=eR(za.map([0,1],function(t){return e?r.coordToData(r.toLocalCoord(n[t])):r.toGlobalCoord(r.dataToCoord(n[t]))})),a=[];return a[t]=o,a[1-t]=[NaN,NaN],{values:o,xyMinMax:a}}var lR={lineX:JI(hR,0),lineY:JI(hR,1),rect:function(t,e,i){return[[t[0][0]-i[0]*e[0][0],t[0][1]-i[0]*e[0][1]],[t[1][0]-i[1]*e[1][0],t[1][1]-i[1]*e[1][1]]]},polygon:function(t,i,n){return za.map(t,function(t,e){return[t[0]-n[0]*i[e][0],t[1]-n[1]*i[e][1]]})}};function hR(t,e,i,n){return[e[0]-n[t]*i[0],e[1]-n[t]*i[1]]}function cR(t){return t?[t[0][1]-t[0][0],t[1][1]-t[1][0]]:[NaN,NaN]}var uR=$I,dR=["inBrush","outOfBrush"],pR="__ecBrushSelect",fR="__ecInBrushSelectEvent",gR=fy.PRIORITY.VISUAL.BRUSH;function mR(t,e){if(!t.isDisposed()){var i=t.getZr();i[fR]=!0,t.dispatchAction({type:"brushSelect",batch:e}),i[fR]=!1}}function vR(t,e,i,n){for(var r=0,o=e.length;r<o;r++){var a=e[r];if(t[a.brushType](n,i,a.selectors,a))return!0}}function yR(t){var a=t.brushSelector;if(za.isString(a)){var e=[];return za.each(XI,function(o,t){e[t]=function(t,e,i,n){var r=e.getItemLayout(t);return o[a](r,i,n)}}),e}if(za.isFunction(a)){var i={};return za.each(XI,function(t,e){i[e]=a}),i}return a}fy.registerLayout(gR,function(e,t,i){e.eachComponent({mainType:"brush"},function(t){i&&"takeGlobalCursor"===i.type&&t.setBrushOption("brush"===i.key?i.brushOption:{brushType:!1}),(t.brushTargetManager=new uR(t.option,e)).setInputRanges(t.areas,e)})}),fy.registerVisual(gR,function(m,t,e){var r,o,a=[];m.eachComponent({mainType:"brush"},function(l,t){var s={brushId:l.id,brushIndex:t,brushName:l.name,areas:za.clone(l.areas),selected:[]};a.push(s);var e=l.option,i=e.brushLink,n=[],h=[],c=[],u=0;t||(r=e.throttleType,o=e.throttleDelay);var d=za.map(l.areas,function(t){return i=za.defaults({boundingRect:_R[t.brushType](t)},t),n=i.selectors={},za.each(XI[i.brushType],function(e,t){n[t]=function(t){return e(t,n,i)}}),i;var i,n}),p=VI.createVisualMappings(l.option,dR,function(t){t.mappingMethod="fixed"});function f(t){return"all"===i||n[t]}function g(t){return!!t.length}za.isArray(i)&&za.each(i,function(t){n[t]=1}),m.eachSeries(function(t,e){var i,n,r,o=c[e]=[];"parallel"===t.subType?(n=e,r=(i=t).coordinateSystem,u|=r.hasAxisBrushed(),f(n)&&r.eachActiveState(i.getData(),function(t,e){"active"===t&&(h[e]=1)})):function(e,t,i){var n=yR(e);if(!n||(r=l,o=t,a=r.option.seriesIndex,null!=a&&"all"!==a&&(za.isArray(a)?za.indexOf(a,o)<0:o!==a)))return;var r,o,a;if(za.each(d,function(t){n[t.brushType]&&l.brushTargetManager.controlSeries(t,e,m)&&i.push(t),u|=g(i)}),f(t)&&g(i)){var s=e.getData();s.each(function(t){vR(n,i,s,t)&&(h[t]=1)})}}(t,e,o)}),m.eachSeries(function(t,e){var i={seriesId:t.id,seriesIndex:e,seriesName:t.name,dataIndex:[]};s.selected.push(i);var n=yR(t),r=c[e],o=t.getData(),a=f(e)?function(t){return h[t]?(i.dataIndex.push(o.getRawIndex(t)),"inBrush"):"outOfBrush"}:function(t){return vR(n,r,o,t)?(i.dataIndex.push(o.getRawIndex(t)),"inBrush"):"outOfBrush"};(f(e)?u:g(r))&&VI.applyVisual(dR,p,o,a)})}),function(t,e,i,n,r){if(!r)return;var o=t.getZr();if(o[fR])return;o[pR]||(o[pR]=mR);um.createOrUpdate(o,pR,i,e)(t,n)}(t,r,o,a,e)});var _R={lineX:za.noop,lineY:za.noop,rect:function(t){return xR(t.range)},polygon:function(t){for(var e,i=t.range,n=0,r=i.length;n<r;n++){e=e||[[1/0,-1/0],[1/0,-1/0]];var o=i[n];o[0]<e[0][0]&&(e[0][0]=o[0]),o[0]>e[0][1]&&(e[0][1]=o[0]),o[1]<e[1][0]&&(e[1][0]=o[1]),o[1]>e[1][1]&&(e[1][1]=o[1])}return e&&xR(e)}};function xR(t){return new bl(t[0][0],t[1][0],t[0][1]-t[0][0],t[1][1]-t[1][0])}var wR=["#ddd"];fy.extendComponentModel({type:"brush",dependencies:["geo","grid","xAxis","yAxis","parallel","series"],defaultOption:{toolbox:null,brushLink:null,seriesIndex:"all",geoIndex:null,xAxisIndex:null,yAxisIndex:null,brushType:"rect",brushMode:"single",transformable:!0,brushStyle:{borderWidth:1,color:"rgba(120,140,180,0.3)",borderColor:"rgba(120,140,180,0.8)"},throttleType:"fixRate",throttleDelay:0,removeOnClick:!0,z:1e4},areas:[],brushType:null,brushOption:{},coordInfoList:[],optionUpdated:function(t,e){var i=this.option;!e&&VI.replaceVisualOption(i,t,["inBrush","outOfBrush"]),i.inBrush=i.inBrush||{},i.outOfBrush=i.outOfBrush||{color:wR}},setAreas:function(t){t&&(this.areas=za.map(t,function(t){return bR(this.option,t)},this))},setBrushOption:function(t){this.brushOption=bR(this.option,t),this.brushType=this.brushOption.brushType}});function bR(t,e){return za.merge({brushType:t.brushType,brushMode:t.brushMode,transformable:t.transformable,brushStyle:new bf(t.brushStyle).getItemStyle(),removeOnClick:t.removeOnClick,z:t.z},e,!0)}fy.extendComponentView({type:"brush",init:function(t,e){this.ecModel=t,this.api=e,this.model,(this._brushController=new kC(e.getZr())).on("brush",za.bind(this._onBrush,this)).mount()},render:function(t){return this.model=t,MR.apply(this,arguments)},updateView:MR,updateLayout:MR,updateVisual:MR,dispose:function(){this._brushController.dispose()},_onBrush:function(t,e){var i=this.model.id;this.model.brushTargetManager.setOutputRanges(t,this.ecModel),(!e.isEnd||e.removeOnClick)&&this.api.dispatchAction({type:"brush",brushId:i,areas:za.clone(t),$from:i})}});function MR(t,e,i,n){(!n||n.$from!==t.id)&&this._brushController.setPanels(t.brushTargetManager.makePanelOpts(i)).enableBrush(t.brushOption).updateCovers(t.areas.slice())}fy.registerAction({type:"brush",event:"brush",update:"updateView"},function(e,t){t.eachComponent({mainType:"brush",query:e},function(t){t.setAreas(e.areas)})}),fy.registerAction({type:"brushSelect",event:"brushSelected",update:"none"},function(){});var SR={};var TR={register:function(t,e){SR[t]=e},get:function(t){return SR[t]}},CR={toolbox:{brush:{title:{rect:"\u77e9\u5f62\u9009\u62e9",polygon:"\u5708\u9009",lineX:"\u6a2a\u5411\u9009\u62e9",lineY:"\u7eb5\u5411\u9009\u62e9",keep:"\u4fdd\u6301\u9009\u62e9",clear:"\u6e05\u9664\u9009\u62e9"}},dataView:{title:"\u6570\u636e\u89c6\u56fe",lang:["\u6570\u636e\u89c6\u56fe","\u5173\u95ed","\u5237\u65b0"]},dataZoom:{title:{zoom:"\u533a\u57df\u7f29\u653e",back:"\u533a\u57df\u7f29\u653e\u8fd8\u539f"}},magicType:{title:{line:"\u5207\u6362\u4e3a\u6298\u7ebf\u56fe",bar:"\u5207\u6362\u4e3a\u67f1\u72b6\u56fe",stack:"\u5207\u6362\u4e3a\u5806\u53e0",tiled:"\u5207\u6362\u4e3a\u5e73\u94fa"}},restore:{title:"\u8fd8\u539f"},saveAsImage:{title:"\u4fdd\u5b58\u4e3a\u56fe\u7247",lang:["\u53f3\u952e\u53e6\u5b58\u4e3a\u56fe\u7247"]}}},AR=CR.toolbox.brush;function ER(t,e,i){this.model=t,this.ecModel=e,this.api=i,this._brushType,this._brushMode}ER.defaultOption={show:!0,type:["rect","polygon","lineX","lineY","keep","clear"],icon:{rect:"M7.3,34.7 M0.4,10V-0.2h9.8 M89.6,10V-0.2h-9.8 M0.4,60v10.2h9.8 M89.6,60v10.2h-9.8 M12.3,22.4V10.5h13.1 M33.6,10.5h7.8 M49.1,10.5h7.8 M77.5,22.4V10.5h-13 M12.3,31.1v8.2 M77.7,31.1v8.2 M12.3,47.6v11.9h13.1 M33.6,59.5h7.6 M49.1,59.5 h7.7 M77.5,47.6v11.9h-13",polygon:"M55.2,34.9c1.7,0,3.1,1.4,3.1,3.1s-1.4,3.1-3.1,3.1 s-3.1-1.4-3.1-3.1S53.5,34.9,55.2,34.9z M50.4,51c1.7,0,3.1,1.4,3.1,3.1c0,1.7-1.4,3.1-3.1,3.1c-1.7,0-3.1-1.4-3.1-3.1 C47.3,52.4,48.7,51,50.4,51z M55.6,37.1l1.5-7.8 M60.1,13.5l1.6-8.7l-7.8,4 M59,19l-1,5.3 M24,16.1l6.4,4.9l6.4-3.3 M48.5,11.6 l-5.9,3.1 M19.1,12.8L9.7,5.1l1.1,7.7 M13.4,29.8l1,7.3l6.6,1.6 M11.6,18.4l1,6.1 M32.8,41.9 M26.6,40.4 M27.3,40.2l6.1,1.6 M49.9,52.1l-5.6-7.6l-4.9-1.2",lineX:"M15.2,30 M19.7,15.6V1.9H29 M34.8,1.9H40.4 M55.3,15.6V1.9H45.9 M19.7,44.4V58.1H29 M34.8,58.1H40.4 M55.3,44.4 V58.1H45.9 M12.5,20.3l-9.4,9.6l9.6,9.8 M3.1,29.9h16.5 M62.5,20.3l9.4,9.6L62.3,39.7 M71.9,29.9H55.4",lineY:"M38.8,7.7 M52.7,12h13.2v9 M65.9,26.6V32 M52.7,46.3h13.2v-9 M24.9,12H11.8v9 M11.8,26.6V32 M24.9,46.3H11.8v-9 M48.2,5.1l-9.3-9l-9.4,9.2 M38.9-3.9V12 M48.2,53.3l-9.3,9l-9.4-9.2 M38.9,62.3V46.4",keep:"M4,10.5V1h10.3 M20.7,1h6.1 M33,1h6.1 M55.4,10.5V1H45.2 M4,17.3v6.6 M55.6,17.3v6.6 M4,30.5V40h10.3 M20.7,40 h6.1 M33,40h6.1 M55.4,30.5V40H45.2 M21,18.9h62.9v48.6H21V18.9z",clear:"M22,14.7l30.9,31 M52.9,14.7L22,45.7 M4.7,16.8V4.2h13.1 M26,4.2h7.8 M41.6,4.2h7.8 M70.3,16.8V4.2H57.2 M4.7,25.9v8.6 M70.3,25.9v8.6 M4.7,43.2v12.6h13.1 M26,55.8h7.8 M41.6,55.8h7.8 M70.3,43.2v12.6H57.2"},title:za.clone(AR.title)};var PR=ER.prototype;PR.render=PR.updateView=PR.updateLayout=function(e,t,i){var n,r,o;t.eachComponent({mainType:"brush"},function(t){n=t.brushType,r=t.brushOption.brushMode||"single",o|=t.areas.length}),this._brushType=n,this._brushMode=r,za.each(e.get("type",!0),function(t){e.setIconStatus(t,("keep"===t?"multiple"===r:"clear"===t?o:t===n)?"emphasis":"normal")})},PR.getIcons=function(){var t=this.model,e=t.get("icon",!0),i={};return za.each(t.get("type",!0),function(t){e[t]&&(i[t]=e[t])}),i},PR.onclick=function(t,e,i){var n=this._brushType,r=this._brushMode;"clear"===i?(e.dispatchAction({type:"axisAreaSelect",intervals:[]}),e.dispatchAction({type:"brush",command:"clear",areas:[]})):e.dispatchAction({type:"takeGlobalCursor",key:"brush",brushOption:{brushType:"keep"===i?n:n!==i&&i,brushMode:"keep"===i?"multiple"===r?"single":"multiple":r}})},TR.register("brush",ER),fy.registerPreprocessor(BI);function LR(t,e,i){this._model=t}function IR(t,e,i,n){var r=i.calendarModel,o=i.seriesModel,a=r?r.coordinateSystem:o?o.coordinateSystem:null;return a===this?a[t](n):null}LR.prototype={constructor:LR,type:"calendar",dimensions:["time","value"],getDimensionsInfo:function(){return[{name:"time",type:"time"}]},getRangeInfo:function(){return this._rangeInfo},getModel:function(){return this._model},getRect:function(){return this._rect},getCellWidth:function(){return this._sw},getCellHeight:function(){return this._sh},getOrient:function(){return this._orient},getFirstDayOfWeek:function(){return this._firstDayOfWeek},getDateInfo:function(t){var e=(t=Uc.parseDate(t)).getFullYear(),i=t.getMonth()+1;i=i<10?"0"+i:i;var n=t.getDate();n=n<10?"0"+n:n;var r=t.getDay();return{y:e,m:i,d:n,day:r=Math.abs((r+7-this.getFirstDayOfWeek())%7),time:t.getTime(),formatedDate:e+"-"+i+"-"+n,date:t}},getNextNDay:function(t,e){return 0===(e=e||0)||(t=new Date(this.getDateInfo(t).time)).setDate(t.getDate()+e),this.getDateInfo(t)},update:function(t,e){this._firstDayOfWeek=+this._model.getModel("dayLabel").get("firstDay"),this._orient=this._model.get("orient"),this._lineWidth=this._model.getModel("itemStyle.normal").getItemStyle().lineWidth||0,this._rangeInfo=this._getRangeInfo(this._initRangeOption());var i=this._rangeInfo.weeks||1,n=["width","height"],r=this._model.get("cellSize").slice(),o=this._model.getBoxLayoutParams(),a="horizontal"===this._orient?[i,7]:[7,i];za.each([0,1],function(t){h(r,t)&&(o[n[t]]=r[t]*a[t])});var s={width:e.getWidth(),height:e.getHeight()},l=this._rect=jf.getLayoutRect(o,s);function h(t,e){return null!=t[e]&&"auto"!==t[e]}za.each([0,1],function(t){h(r,t)||(r[t]=l[n[t]]/a[t])}),this._sw=r[0],this._sh=r[1]},dataToPoint:function(t,e){za.isArray(t)&&(t=t[0]),null==e&&(e=!0);var i=this.getDateInfo(t),n=this._rangeInfo,r=i.formatedDate;if(e&&!(i.time>=n.start.time&&i.time<=n.end.time))return[NaN,NaN];var o=i.day,a=this._getRangeInfo([n.start.time,r]).nthWeek;return"vertical"===this._orient?[this._rect.x+o*this._sw+this._sw/2,this._rect.y+a*this._sh+this._sh/2]:[this._rect.x+a*this._sw+this._sw/2,this._rect.y+o*this._sh+this._sh/2]},pointToData:function(t){var e=this.pointToDate(t);return e&&e.time},dataToRect:function(t,e){var i=this.dataToPoint(t,e);return{contentShape:{x:i[0]-(this._sw-this._lineWidth)/2,y:i[1]-(this._sh-this._lineWidth)/2,width:this._sw-this._lineWidth,height:this._sh-this._lineWidth},center:i,tl:[i[0]-this._sw/2,i[1]-this._sh/2],tr:[i[0]+this._sw/2,i[1]-this._sh/2],br:[i[0]+this._sw/2,i[1]+this._sh/2],bl:[i[0]-this._sw/2,i[1]+this._sh/2]}},pointToDate:function(t){var e=Math.floor((t[0]-this._rect.x)/this._sw)+1,i=Math.floor((t[1]-this._rect.y)/this._sh)+1,n=this._rangeInfo.range;return"vertical"===this._orient?this._getDateByWeeksAndDay(i,e-1,n):this._getDateByWeeksAndDay(e,i-1,n)},convertToPixel:za.curry(IR,"dataToPoint"),convertFromPixel:za.curry(IR,"pointToData"),_initRangeOption:function(){var t=this._model.get("range"),e=t;if(za.isArray(e)&&1===e.length&&(e=e[0]),/^\d{4}$/.test(e)&&(t=[e+"-01-01",e+"-12-31"]),/^\d{4}[\/|-]\d{1,2}$/.test(e)){var i=this.getDateInfo(e),n=i.date;n.setMonth(n.getMonth()+1);var r=this.getNextNDay(n,-1);t=[i.formatedDate,r.formatedDate]}/^\d{4}[\/|-]\d{1,2}[\/|-]\d{1,2}$/.test(e)&&(t=[e,e]);var o=this._getRangeInfo(t);return o.start.time>o.end.time&&t.reverse(),t},_getRangeInfo:function(t){var e;(t=[this.getDateInfo(t[0]),this.getDateInfo(t[1])])[0].time>t[1].time&&(e=!0,t.reverse());var i=Math.floor(t[1].time/864e5)-Math.floor(t[0].time/864e5)+1,n=new Date(t[0].time),r=n.getDate(),o=t[1].date.getDate();if(n.setDate(r+i-1),n.getDate()!==o)for(var a=0<n.getTime()-t[1].time?1:-1;n.getDate()!==o&&0<(n.getTime()-t[1].time)*a;)i-=a,n.setDate(r+i-1);var s=Math.floor((i+t[0].day+6)/7),l=e?1-s:s-1;return e&&t.reverse(),{range:[t[0].formatedDate,t[1].formatedDate],start:t[0],end:t[1],allDay:i,weeks:s,nthWeek:l,fweek:t[0].day,lweek:t[1].day}},_getDateByWeeksAndDay:function(t,e,i){var n=this._getRangeInfo(i);if(t>n.weeks||0===t&&e<n.fweek||t===n.weeks&&e>n.lweek)return!1;var r=7*(t-1)-n.fweek+e,o=new Date(n.start.time);return o.setDate(n.start.d+r),this.getDateInfo(o)}},LR.dimensions=LR.prototype.dimensions,LR.getDimensionsInfo=LR.prototype.getDimensionsInfo,LR.create=function(i,n){var r=[];return i.eachComponent("calendar",function(t){var e=new LR(t,i,n);r.push(e),t.coordinateSystem=e}),i.eachSeries(function(t){"calendar"===t.get("coordinateSystem")&&(t.coordinateSystem=r[t.get("calendarIndex")||0])}),r},mg.register("calendar",LR);var RR=jf.getLayoutParams,DR=jf.sizeCalculable,OR=jf.mergeLayoutParam,kR=Yf.extend({type:"calendar",coordinateSystem:null,defaultOption:{zlevel:0,z:2,left:80,top:60,cellSize:20,orient:"horizontal",splitLine:{show:!0,lineStyle:{color:"#000",width:1,type:"solid"}},itemStyle:{normal:{color:"#fff",borderWidth:1,borderColor:"#ccc"}},dayLabel:{show:!0,firstDay:0,position:"start",margin:"50%",nameMap:"en",color:"#000"},monthLabel:{show:!0,position:"start",margin:5,align:"center",nameMap:"en",formatter:null,color:"#000"},yearLabel:{show:!0,position:null,margin:30,formatter:null,color:"#ccc",fontFamily:"sans-serif",fontWeight:"bolder",fontSize:20}},init:function(t,e,i,n){var r=RR(t);kR.superApply(this,"init",arguments),zR(t,r)},mergeOption:function(t,e){kR.superApply(this,"mergeOption",arguments),zR(this.option,t)}});function zR(t,e){var i=t.cellSize;za.isArray(i)?1===i.length&&(i[1]=i[0]):i=t.cellSize=[i,i];var n=za.map([0,1],function(t){return DR(e,t)&&(i[t]="auto"),null!=i[t]&&"auto"!==i[t]});OR(t,e,{type:"box",ignoreSize:n})}var NR={EN:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],CN:["\u4e00\u6708","\u4e8c\u6708","\u4e09\u6708","\u56db\u6708","\u4e94\u6708","\u516d\u6708","\u4e03\u6708","\u516b\u6708","\u4e5d\u6708","\u5341\u6708","\u5341\u4e00\u6708","\u5341\u4e8c\u6708"]},BR={EN:["S","M","T","W","T","F","S"],CN:["\u65e5","\u4e00","\u4e8c","\u4e09","\u56db","\u4e94","\u516d"]},FR=(fy.extendComponentView({type:"calendar",_tlpoints:null,_blpoints:null,_firstDayOfMonth:null,_firstDayPoints:null,render:function(t,e,i){var n=this.group;n.removeAll();var r=t.coordinateSystem,o=r.getRangeInfo(),a=r.getOrient();this._renderDayRect(t,o,n),this._renderLines(t,o,a,n),this._renderYearText(t,o,a,n),this._renderMonthText(t,a,n),this._renderWeekText(t,o,a,n)},_renderDayRect:function(t,e,i){for(var n=t.coordinateSystem,r=t.getModel("itemStyle.normal").getItemStyle(),o=n.getCellWidth(),a=n.getCellHeight(),s=e.start.time;s<=e.end.time;s=n.getNextNDay(s,1).time){var l=n.dataToRect([s],!1).tl,h=new pf.Rect({shape:{x:l[0],y:l[1],width:o,height:a},cursor:"default",style:r});i.add(h)}},_renderLines:function(i,t,n,r){var o=this,a=i.coordinateSystem,s=i.getModel("splitLine.lineStyle").getLineStyle(),l=i.get("splitLine.show"),e=s.lineWidth;this._tlpoints=[],this._blpoints=[],this._firstDayOfMonth=[],this._firstDayPoints=[];for(var h=t.start,c=0;h.time<=t.end.time;c++){d(h.formatedDate),0===c&&(h=a.getDateInfo(t.start.y+"-"+t.start.m));var u=h.date;u.setMonth(u.getMonth()+1),h=a.getDateInfo(u)}function d(t){o._firstDayOfMonth.push(a.getDateInfo(t)),o._firstDayPoints.push(a.dataToRect([t],!1).tl);var e=o._getLinePointsOfOneWeek(i,t,n);o._tlpoints.push(e[0]),o._blpoints.push(e[e.length-1]),l&&o._drawSplitline(e,s,r)}d(a.getNextNDay(t.end.time,1).formatedDate),l&&this._drawSplitline(o._getEdgesPoints(o._tlpoints,e,n),s,r),l&&this._drawSplitline(o._getEdgesPoints(o._blpoints,e,n),s,r)},_getEdgesPoints:function(t,e,i){var n=[t[0].slice(),t[t.length-1].slice()],r="horizontal"===i?0:1;return n[0][r]=n[0][r]-e/2,n[1][r]=n[1][r]+e/2,n},_drawSplitline:function(t,e,i){var n=new pf.Polyline({z2:20,shape:{points:t},style:e});i.add(n)},_getLinePointsOfOneWeek:function(t,e,i){var n=t.coordinateSystem;e=n.getDateInfo(e);for(var r=[],o=0;o<7;o++){var a=n.getNextNDay(e.time,o),s=n.dataToRect([a.time],!1);r[2*a.day]=s.tl,r[2*a.day+1]=s["horizontal"===i?"bl":"tr"]}return r},_formatterLabel:function(t,e){return"string"==typeof t&&t?Yc.formatTplSimple(t,e):"function"==typeof t?t(e):e.nameMap},_yearTextPositionControl:function(t,e,i,n,r){e=e.slice();var o=["center","bottom"];"bottom"===n?(e[1]+=r,o=["center","top"]):"left"===n?e[0]-=r:"right"===n?(e[0]+=r,o=["center","top"]):e[1]-=r;var a=0;return"left"!==n&&"right"!==n||(a=Math.PI/2),{rotation:a,position:e,style:{textAlign:o[0],textVerticalAlign:o[1]}}},_renderYearText:function(t,e,i,n){var r=t.getModel("yearLabel");if(r.get("show")){var o=r.get("margin"),a=r.get("position");a||(a="horizontal"!==i?"top":"left");var s=[this._tlpoints[this._tlpoints.length-1],this._blpoints[0]],l=(s[0][0]+s[1][0])/2,h=(s[0][1]+s[1][1])/2,c="horizontal"===i?0:1,u={top:[l,s[c][1]],bottom:[l,s[1-c][1]],left:[s[1-c][0],h],right:[s[c][0],h]},d=e.start.y;+e.end.y>+e.start.y&&(d=d+"-"+e.end.y);var p=r.get("formatter"),f={start:e.start.y,end:e.end.y,nameMap:d},g=this._formatterLabel(p,f),m=new pf.Text({z2:30});pf.setTextStyle(m.style,r,{text:g}),m.attr(this._yearTextPositionControl(m,u[a],i,a,o)),n.add(m)}},_monthTextPositionControl:function(t,e,i,n,r){var o="left",a="top",s=t[0],l=t[1];return"horizontal"===i?(l+=r,e&&(o="center"),"start"===n&&(a="bottom")):(s+=r,e&&(a="middle"),"start"===n&&(o="right")),{x:s,y:l,textAlign:o,textVerticalAlign:a}},_renderMonthText:function(t,e,i){var n=t.getModel("monthLabel");if(n.get("show")){var r=n.get("nameMap"),o=n.get("margin"),a=n.get("position"),s=n.get("align"),l=[this._tlpoints,this._blpoints];za.isString(r)&&(r=NR[r.toUpperCase()]||[]);var h="start"===a?0:1,c="horizontal"===e?0:1;o="start"===a?-o:o;for(var u="center"===s,d=0;d<l[h].length-1;d++){var p=l[h][d].slice(),f=this._firstDayOfMonth[d];if(u){var g=this._firstDayPoints[d];p[c]=(g[c]+l[0][d+1][c])/2}var m=n.get("formatter"),v=r[+f.m-1],y={yyyy:f.y,yy:(f.y+"").slice(2),MM:f.m,M:+f.m,nameMap:v},_=this._formatterLabel(m,y),x=new pf.Text({z2:30});za.extend(pf.setTextStyle(x.style,n,{text:_}),this._monthTextPositionControl(p,u,e,a,o)),i.add(x)}}},_weekTextPositionControl:function(t,e,i,n,r){var o="center",a="middle",s=t[0],l=t[1],h="start"===i;return"horizontal"===e?(s=s+n+(h?1:-1)*r[0]/2,o=h?"right":"left"):(l=l+n+(h?1:-1)*r[1]/2,a=h?"bottom":"top"),{x:s,y:l,textAlign:o,textVerticalAlign:a}},_renderWeekText:function(t,e,i,n){var r=t.getModel("dayLabel");if(r.get("show")){var o=t.coordinateSystem,a=r.get("position"),s=r.get("nameMap"),l=r.get("margin"),h=o.getFirstDayOfWeek();za.isString(s)&&(s=BR[s.toUpperCase()]||[]);var c=o.getNextNDay(e.end.time,7-e.lweek).time,u=[o.getCellWidth(),o.getCellHeight()];l=Uc.parsePercent(l,u["horizontal"===i?0:1]),"start"===a&&(c=o.getNextNDay(e.start.time,-(7+e.fweek)).time,l=-l);for(var d=0;d<7;d++){var p,f=o.getNextNDay(c,d),g=o.dataToRect([f.time],!1).center;p=Math.abs((d+h)%7);var m=new pf.Text({z2:30});za.extend(pf.setTextStyle(m.style,r,{text:s[p]}),this._weekTextPositionControl(g,i,a,l,u)),n.add(m)}}}}),jf.getLayoutRect);fy.extendComponentModel({type:"title",layoutMode:{type:"box",ignoreSize:!0},defaultOption:{zlevel:0,z:6,show:!0,text:"",target:"blank",subtext:"",subtarget:"blank",left:0,top:0,backgroundColor:"rgba(0,0,0,0)",borderColor:"#ccc",borderWidth:0,padding:5,itemGap:10,textStyle:{fontSize:18,fontWeight:"bolder",color:"#333"},subtextStyle:{color:"#aaa"}}}),fy.extendComponentView({type:"title",render:function(t,e,i){if(this.group.removeAll(),t.get("show")){var n=this.group,r=t.getModel("textStyle"),o=t.getModel("subtextStyle"),a=t.get("textAlign"),s=t.get("textBaseline"),l=new pf.Text({style:pf.setTextStyle({},r,{text:t.get("text"),textFill:r.getTextColor()},{disableBox:!0}),z2:10}),h=l.getBoundingRect(),c=t.get("subtext"),u=new pf.Text({style:pf.setTextStyle({},o,{text:c,textFill:o.getTextColor(),y:h.height+t.get("itemGap"),textVerticalAlign:"top"},{disableBox:!0}),z2:10}),d=t.get("link"),p=t.get("sublink");l.silent=!d,u.silent=!p,d&&l.on("click",function(){window.open(d,"_"+t.get("target"))}),p&&u.on("click",function(){window.open(p,"_"+t.get("subtarget"))}),n.add(l),c&&n.add(u);var f=n.getBoundingRect(),g=t.getBoxLayoutParams();g.width=f.width,g.height=f.height;var m=FR(g,{width:i.getWidth(),height:i.getHeight()},t.get("padding"));a||("middle"===(a=t.get("left")||t.get("right"))&&(a="center"),"right"===a?m.x+=m.width:"center"===a&&(m.x+=m.width/2)),s||("center"===(s=t.get("top")||t.get("bottom"))&&(s="middle"),"bottom"===s?m.y+=m.height:"middle"===s&&(m.y+=m.height/2),s=s||"top"),n.attr("position",[m.x,m.y]);var v={textAlign:a,textVerticalAlign:s};l.setStyle(v),u.setStyle(v),f=n.getBoundingRect();var y=m.margin,_=t.getItemStyle(["color","opacity"]);_.fill=t.get("backgroundColor");var x=new pf.Rect({shape:{x:f.x-y[3],y:f.y-y[0],width:f.width+y[1]+y[3],height:f.height+y[0]+y[2],r:t.get("borderRadius")},style:_,silent:!0});pf.subPixelOptimizeRect(x),n.add(x)}}}),Yf.registerSubTypeDefaulter("dataZoom",function(){return"slider"});var GR=["cartesian2d","polar","singleAxis"];function VR(t,a){t=t.slice();var s=za.map(t,Yc.capitalFirst);a=(a||[]).slice();var l=za.map(a,Yc.capitalFirst);return function(r,o){za.each(t,function(t,e){for(var i={name:t,capital:s[e]},n=0;n<a.length;n++)i[a[n]]=t+l[n];r.call(o,i)})}}var HR=VR(["x","y","z","radius","angle","single"],["axisIndex","axis","index","id"]);var UR={isCoordSupported:function(t){return 0<=za.indexOf(GR,t)},createNameEach:VR,eachAxisDim:HR,createLinkedNodesFinder:function(i,l,h){return function(t){var a,s={nodes:[],records:{}};if(l(function(t){s.records[t.name]={}}),!t)return s;for(c(t,s);a=!1,i(e),a;);function e(t){var i,n,r,e,o;e=t,o=s,0<=za.indexOf(o.nodes,e)||(i=t,n=s,r=!1,l(function(e){za.each(h(i,e)||[],function(t){n.records[e.name][t]&&(r=!0)})}),!r)||(c(t,s),a=!0)}return s};function c(t,i){i.nodes.push(t),l(function(e){za.each(h(t,e)||[],function(t){i.records[e.name][t]=!0})})}}},WR=za.each,jR=Uc.asc,ZR=function(t,e,i,n){this._dimName=t,this._axisIndex=e,this._valueWindow,this._percentWindow,this._dataExtent,this._minMaxSpan,this.ecModel=n,this._dataZoomModel=i};function XR(t,e){var i=t.getAxisModel(),n=t._percentWindow,r=t._valueWindow;if(n){var o=Uc.getPixelPrecision(r,[0,500]);o=Math.min(o,20);var a=e||0===n[0]&&100===n[1];i.setRange(a?null:+r[0].toFixed(o),a?null:+r[1].toFixed(o))}}ZR.prototype={constructor:ZR,hostedBy:function(t){return this._dataZoomModel===t},getDataValueWindow:function(){return this._valueWindow.slice()},getDataPercentWindow:function(){return this._percentWindow.slice()},getTargetSeriesModels:function(){var n=[],r=this.ecModel;return r.eachSeries(function(t){if(UR.isCoordSupported(t.get("coordinateSystem"))){var e=this._dimName,i=r.queryComponents({mainType:e+"Axis",index:t.get(e+"AxisIndex"),id:t.get(e+"AxisId")})[0];this._axisIndex===(i&&i.componentIndex)&&n.push(t)}},this),n},getAxisModel:function(){return this.ecModel.getComponent(this._dimName+"Axis",this._axisIndex)},getOtherAxisModel:function(){var t,e,i,n=this._dimName,r=this.ecModel,o=this.getAxisModel();return"x"===n||"y"===n?(e="gridIndex",t="x"===n?"y":"x"):(e="polarIndex",t="angle"===n?"radius":"angle"),r.eachComponent(t+"Axis",function(t){(t.get(e)||0)===(o.get(e)||0)&&(i=t)}),i},getMinMaxSpan:function(){return za.clone(this._minMaxSpan)},calculateDataWindow:function(e){var n=this._dataExtent,r=this.getAxisModel().axis.scale,o=this._dataZoomModel.getRangePropMode(),a=[0,100],s=[e.start,e.end],l=[];return WR(["startValue","endValue"],function(t){l.push(null!=e[t]?r.parse(e[t]):null)}),WR([0,1],function(t){var e=l[t],i=s[t];"percent"===o[t]?(null==i&&(i=a[t]),e=r.parse(Uc.linearMap(i,a,n,!0))):i=Uc.linearMap(e,n,a,!0),l[t]=e,s[t]=i}),{valueWindow:jR(l),percentWindow:jR(s)}},reset:function(t){if(t===this._dataZoomModel){this._dataExtent=function(t,e,i){var n=[1/0,-1/0];WR(i,function(t){var i=t.getData();i&&WR(t.coordDimToDataDim(e),function(t){var e=i.getDataExtent(t);e[0]<n[0]&&(n[0]=e[0]),e[1]>n[1]&&(n[1]=e[1])})}),n[1]<n[0]&&(n=[NaN,NaN]);return function(t,e){var i=t.getAxisModel(),n=i.getMin(!0),r="category"===i.get("type"),o=r&&(i.get("data")||[]).length;null!=n&&"dataMin"!==n&&"function"!=typeof n?e[0]=n:r&&(e[0]=0<o?0:NaN);var a=i.getMax(!0);null!=a&&"dataMax"!==a&&"function"!=typeof a?e[1]=a:r&&(e[1]=0<o?o-1:NaN),i.get("scale",!0)||(0<e[0]&&(e[0]=0),e[1]<0&&(e[1]=0))}(t,n),n}(this,this._dimName,this.getTargetSeriesModels());var n,r,o,e=this.calculateDataWindow(t.option);this._valueWindow=e.valueWindow,this._percentWindow=e.percentWindow,r=(n=this)._minMaxSpan={},o=n._dataZoomModel,WR(["min","max"],function(t){r[t+"Span"]=o.get(t+"Span");var e=o.get(t+"ValueSpan");if(null!=e&&(r[t+"ValueSpan"]=e,null!=(e=n.getAxisModel().axis.scale.parse(e)))){var i=n._dataExtent;r[t+"Span"]=Uc.linearMap(i[0]+e,i,[0,100],!0)}}),XR(this)}},restore:function(t){t===this._dataZoomModel&&(this._valueWindow=this._percentWindow=null,XR(this,!0))},filterData:function(t){if(t===this._dataZoomModel){var i=this._dimName,e=this.getTargetSeriesModels(),n=t.get("filterMode"),u=this._valueWindow;if("none"!==n){var r=this.getOtherAxisModel();t.get("$fromToolbox")&&r&&"category"===r.get("type")&&(n="empty"),WR(e,function(e){var h=e.getData(),c=e.coordDimToDataDim(i);"weakFilter"===n?h&&h.filterSelf(function(t){for(var e,i,n,r=0;r<c.length;r++){var o=h.get(c[r],t),a=!isNaN(o),s=o<u[0],l=o>u[1];if(a&&!s&&!l)return!0;a&&(n=!0),s&&(e=!0),l&&(i=!0)}return n&&e&&i}):h&&WR(c,function(t){"empty"===n?e.setData(h.map(t,function(t){return o(t)?t:NaN})):h.filterSelf(t,o)})})}}function o(t){return t>=u[0]&&t<=u[1]}}};var qR=ZR,YR=za.each,JR=UR.eachAxisDim;function KR(e){var i={};return YR(["start","end","startValue","endValue","throttle"],function(t){e.hasOwnProperty(t)&&(i[t]=e[t])}),i}function QR(t,r){var o=t._rangePropMode,a=t.get("rangeMode");YR([["start","startValue"],["end","endValue"]],function(t,e){var i=null!=r[t[0]],n=null!=r[t[1]];i&&!n?o[e]="percent":!i&&n?o[e]="value":a?o[e]=a[e]:i&&(o[e]="percent")})}var $R=fy.extendComponentModel({type:"dataZoom",dependencies:["xAxis","yAxis","zAxis","radiusAxis","angleAxis","singleAxis","series"],defaultOption:{zlevel:0,z:4,orient:null,xAxisIndex:null,yAxisIndex:null,filterMode:"filter",throttle:null,start:0,end:100,startValue:null,endValue:null,minSpan:null,maxSpan:null,minValueSpan:null,maxValueSpan:null,rangeMode:null},init:function(t,e,i){this._dataIntervalByAxis={},this._dataInfo={},this._axisProxies={},this.textStyleModel,this._autoThrottle=!0,this._rangePropMode=["percent","percent"];var n=KR(t);this.mergeDefaultAndTheme(t,i),this.doInit(n)},mergeOption:function(t){var e=KR(t);za.merge(this.option,t,!0),this.doInit(e)},doInit:function(t){var i=this.option;ca.canvasSupported||(i.realtime=!1),this._setDefaultThrottle(t),QR(this,t),YR([["start","startValue"],["end","endValue"]],function(t,e){"value"===this._rangePropMode[e]&&(i[t[0]]=null)},this),this.textStyleModel=this.getModel("textStyle"),this._resetTarget(),this._giveAxisProxies()},_giveAxisProxies:function(){var a=this._axisProxies;this.eachTargetAxis(function(t,e,i,n){var r=this.dependentModels[t.axis][e],o=r.__dzAxisProxy||(r.__dzAxisProxy=new qR(t.name,e,this,n));a[t.name+"_"+e]=o},this)},_resetTarget:function(){var i=this.option,t=this._judgeAutoMode();JR(function(t){var e=t.axisIndex;i[e]=If.normalizeToArray(i[e])},this),"axisIndex"===t?this._autoSetAxisIndex():"orient"===t&&this._autoSetOrient()},_judgeAutoMode:function(){var e=this.option,i=!1;JR(function(t){null!=e[t.axisIndex]&&(i=!0)},this);var t=e.orient;return null==t&&i?"orient":i?void 0:(null==t&&(e.orient="horizontal"),"axisIndex")},_autoSetAxisIndex:function(){var o=!0,e=this.get("orient",!0),a=this.option,t=this.dependentModels;if(o){var i="vertical"===e?"y":"x";t[i+"Axis"].length?(a[i+"AxisIndex"]=[0],o=!1):YR(t.singleAxis,function(t){o&&t.get("orient",!0)===e&&(a.singleAxisIndex=[t.componentIndex],o=!1)})}o&&JR(function(t){if(o){var e=[],i=this.dependentModels[t.axis];if(i.length&&!e.length)for(var n=0,r=i.length;n<r;n++)"category"===i[n].get("type")&&e.push(n);(a[t.axisIndex]=e).length&&(o=!1)}},this),o&&this.ecModel.eachSeries(function(r){this._isSeriesHasAllAxesTypeOf(r,"value")&&JR(function(t){var e=a[t.axisIndex],i=r.get(t.axisIndex),n=r.get(t.axisId);i=r.ecModel.queryComponents({mainType:t.axis,index:i,id:n})[0].componentIndex,za.indexOf(e,i)<0&&e.push(i)})},this)},_autoSetOrient:function(){var e;this.eachTargetAxis(function(t){!e&&(e=t.name)},this),this.option.orient="y"===e?"vertical":"horizontal"},_isSeriesHasAllAxesTypeOf:function(n,r){var o=!0;return JR(function(t){var e=n.get(t.axisIndex),i=this.dependentModels[t.axis][e];i&&i.get("type")===r||(o=!1)},this),o},_setDefaultThrottle:function(t){if(t.hasOwnProperty("throttle")&&(this._autoThrottle=!1),this._autoThrottle){var e=this.ecModel.option;this.option.throttle=e.animation&&0<e.animationDurationUpdate?100:20}},getFirstTargetAxisModel:function(){var i;return JR(function(t){if(null==i){var e=this.get(t.axisIndex);e.length&&(i=this.dependentModels[t.axis][e[0]])}},this),i},eachTargetAxis:function(i,n){var r=this.ecModel;JR(function(e){YR(this.get(e.axisIndex),function(t){i.call(n,e,t,this,r)},this)},this)},getAxisProxy:function(t,e){return this._axisProxies[t+"_"+e]},getAxisModel:function(t,e){var i=this.getAxisProxy(t,e);return i&&i.getAxisModel()},setRawRange:function(e,t){var i=this.option;YR([["start","startValue"],["end","endValue"]],function(t){null==e[t[0]]&&null==e[t[1]]||(i[t[0]]=e[t[0]],i[t[1]]=e[t[1]])},this),!t&&QR(this,e)},getPercentRange:function(){var t=this.findRepresentativeAxisProxy();if(t)return t.getDataPercentWindow()},getValueRange:function(t,e){if(null!=t||null!=e)return this.getAxisProxy(t,e).getDataValueWindow();var i=this.findRepresentativeAxisProxy();return i?i.getDataValueWindow():void 0},findRepresentativeAxisProxy:function(t){if(t)return t.__dzAxisProxy;var e=this._axisProxies;for(var i in e)if(e.hasOwnProperty(i)&&e[i].hostedBy(this))return e[i];for(var i in e)if(e.hasOwnProperty(i)&&!e[i].hostedBy(this))return e[i]},getRangePropMode:function(){return this._rangePropMode.slice()}}),tD=em.extend({type:"dataZoom",render:function(t,e,i,n){this.dataZoomModel=t,this.ecModel=e,this.api=i},getTargetCoordInfo:function(){var t=this.dataZoomModel,r=this.ecModel,o={};return t.eachTargetAxis(function(t,e){var i=r.getComponent(t.axis,e);if(i){var n=i.getCoordSysModel();n&&function(t,e,i,n){for(var r,o=0;o<i.length;o++)if(i[o].model===t){r=i[o];break}r||i.push(r={model:t,axisModels:[],coordIndex:n});r.axisModels.push(e)}(n,i,o[n.mainType]||(o[n.mainType]=[]),n.componentIndex)}},this),o}}),eD=($R.extend({type:"dataZoom.slider",layoutMode:"box",defaultOption:{show:!0,right:"ph",top:"ph",width:"ph",height:"ph",left:null,bottom:null,backgroundColor:"rgba(47,69,84,0)",dataBackground:{lineStyle:{color:"#2f4554",width:.5,opacity:.3},areaStyle:{color:"rgba(47,69,84,0.3)",opacity:.3}},borderColor:"#ddd",fillerColor:"rgba(167,183,204,0.4)",handleIcon:"M8.2,13.6V3.9H6.3v9.7H3.1v14.9h3.3v9.7h1.8v-9.7h3.3V13.6H8.2z M9.7,24.4H4.8v-1.4h4.9V24.4z M9.7,19.1H4.8v-1.4h4.9V19.1z",handleSize:"100%",handleStyle:{color:"#a7b7cc"},labelPrecision:null,labelFormatter:null,showDetail:!0,showDataShadow:"auto",realtime:!0,zoomLock:!1,textStyle:{color:"#333"}}}),pf.Rect),iD=Uc.linearMap,nD=Uc.asc,rD=za.bind,oD=za.each,aD="horizontal",sD="vertical",lD=["line","bar","candlestick","scatter"],hD=tD.extend({type:"dataZoom.slider",init:function(t,e){this._displayables={},this._orient,this._range,this._handleEnds,this._size,this._handleWidth,this._handleHeight,this._location,this._dragging,this._dataShadowInfo,this.api=e},render:function(t,e,i,n){hD.superApply(this,"render",arguments),um.createOrUpdate(this,"_dispatchZoomAction",this.dataZoomModel.get("throttle"),"fixRate"),this._orient=t.get("orient"),!1!==this.dataZoomModel.get("show")?(n&&"dataZoom"===n.type&&n.from===this.uid||this._buildView(),this._updateView()):this.group.removeAll()},remove:function(){hD.superApply(this,"remove",arguments),um.clear(this,"_dispatchZoomAction")},dispose:function(){hD.superApply(this,"dispose",arguments),um.clear(this,"_dispatchZoomAction")},_buildView:function(){var t=this.group;t.removeAll(),this._resetLocation(),this._resetInterval();var e=this._displayables.barGroup=new pf.Group;this._renderBackground(),this._renderHandle(),this._renderDataShadow(),t.add(e),this._positionGroup()},_resetLocation:function(){var t=this.dataZoomModel,e=this.api,i=this._findCoordRect(),n={width:e.getWidth(),height:e.getHeight()},r=this._orient===aD?{right:n.width-i.x-i.width,top:n.height-30-7,width:i.width,height:30}:{right:7,top:i.y,width:30,height:i.height},o=jf.getLayoutParams(t.option);za.each(["right","top","width","height"],function(t){"ph"===o[t]&&(o[t]=r[t])});var a=jf.getLayoutRect(o,n,t.padding);this._location={x:a.x,y:a.y},this._size=[a.width,a.height],this._orient===sD&&this._size.reverse()},_positionGroup:function(){var t=this.group,e=this._location,i=this._orient,n=this.dataZoomModel.getFirstTargetAxisModel(),r=n&&n.get("inverse"),o=this._displayables.barGroup,a=(this._dataShadowInfo||{}).otherAxisInverse;o.attr(i!==aD||r?i===aD&&r?{scale:a?[-1,1]:[-1,-1]}:i!==sD||r?{scale:a?[-1,-1]:[-1,1],rotation:Math.PI/2}:{scale:a?[1,-1]:[1,1],rotation:Math.PI/2}:{scale:a?[1,1]:[1,-1]});var s=t.getBoundingRect([o]);t.attr("position",[e.x-s.x,e.y-s.y])},_getViewExtent:function(){return[0,this._size[0]]},_renderBackground:function(){var t=this.dataZoomModel,e=this._size,i=this._displayables.barGroup;i.add(new eD({silent:!0,shape:{x:0,y:0,width:e[0],height:e[1]},style:{fill:t.get("backgroundColor")},z2:-40})),i.add(new eD({shape:{x:0,y:0,width:e[0],height:e[1]},style:{fill:"transparent"},z2:0,onclick:za.bind(this._onClickPanelClick,this)}))},_renderDataShadow:function(){var t=this._dataShadowInfo=this._prepareDataShadowInfo();if(t){var e=this._size,i=t.series,n=i.getRawData(),r=i.getShadowDim?i.getShadowDim():t.otherDim;if(null!=r){var o=n.getDataExtent(r),a=.3*(o[1]-o[0]);o=[o[0]-a,o[1]+a];var s,l=[0,e[1]],h=[0,e[0]],c=[[e[0],0],[0,0]],u=[],d=h[1]/(n.count()-1),p=0,f=Math.round(n.count()/e[0]);n.each([r],function(t,e){if(0<f&&e%f)p+=d;else{var i=null==t||isNaN(t)||""===t,n=i?0:iD(t,o,l,!0);i&&!s&&e?(c.push([c[c.length-1][0],0]),u.push([u[u.length-1][0],0])):!i&&s&&(c.push([p,0]),u.push([p,0])),c.push([p,n]),u.push([p,n]),p+=d,s=i}});var g=this.dataZoomModel;this._displayables.barGroup.add(new pf.Polygon({shape:{points:c},style:za.defaults({fill:g.get("dataBackgroundColor")},g.getModel("dataBackground.areaStyle").getAreaStyle()),silent:!0,z2:-20})),this._displayables.barGroup.add(new pf.Polyline({shape:{points:u},style:g.getModel("dataBackground.lineStyle").getLineStyle(),silent:!0,z2:-19}))}}},_prepareDataShadowInfo:function(){var e=this.dataZoomModel,s=e.get("showDataShadow");if(!1!==s){var l,h=this.ecModel;return e.eachTargetAxis(function(o,a){var t=e.getAxisProxy(o.name,a).getTargetSeriesModels();za.each(t,function(t){if(!(l||!0!==s&&za.indexOf(lD,t.get("type"))<0)){var e,i=h.getComponent(o.axis,a).axis,n={x:"y",y:"x",radius:"angle",angle:"radius"}[o.name],r=t.coordinateSystem;null!=n&&r.getOtherAxis&&(e=r.getOtherAxis(i).inverse),l={thisAxis:i,series:t,thisDim:o.name,otherDim:n,otherAxisInverse:e}}},this)},this),l}},_renderHandle:function(){var t=this._displayables,o=t.handles=[],a=t.handleLabels=[],s=this._displayables.barGroup,e=this._size,l=this.dataZoomModel;s.add(t.filler=new eD({draggable:!0,cursor:cD(this._orient),drift:rD(this._onDragMove,this,"all"),onmousemove:function(t){pc.stop(t.event)},ondragstart:rD(this._showDataInfo,this,!0),ondragend:rD(this._onDragEnd,this),onmouseover:rD(this._showDataInfo,this,!0),onmouseout:rD(this._showDataInfo,this,!1),style:{fill:l.get("fillerColor"),textPosition:"inside"}})),s.add(new eD(pf.subPixelOptimizeRect({silent:!0,shape:{x:0,y:0,width:e[0],height:e[1]},style:{stroke:l.get("dataBackgroundColor")||l.get("borderColor"),lineWidth:1,fill:"rgba(0,0,0,0)"}}))),oD([0,1],function(t){var e=pf.createIcon(l.get("handleIcon"),{cursor:cD(this._orient),draggable:!0,drift:rD(this._onDragMove,this,t),onmousemove:function(t){pc.stop(t.event)},ondragend:rD(this._onDragEnd,this),onmouseover:rD(this._showDataInfo,this,!0),onmouseout:rD(this._showDataInfo,this,!1)},{x:-1,y:0,width:2,height:2}),i=e.getBoundingRect();this._handleHeight=Uc.parsePercent(l.get("handleSize"),this._size[1]),this._handleWidth=i.width/i.height*this._handleHeight,e.setStyle(l.getModel("handleStyle").getItemStyle());var n=l.get("handleColor");null!=n&&(e.style.fill=n),s.add(o[t]=e);var r=l.textStyleModel;this.group.add(a[t]=new pf.Text({silent:!0,invisible:!0,style:{x:0,y:0,text:"",textVerticalAlign:"middle",textAlign:"center",textFill:r.getTextColor(),textFont:r.getFont()},z2:10}))},this)},_resetInterval:function(){var t=this._range=this.dataZoomModel.getPercentRange(),e=this._getViewExtent();this._handleEnds=[iD(t[0],[0,100],e,!0),iD(t[1],[0,100],e,!0)]},_updateInterval:function(t,e){var i=this.dataZoomModel,n=this._handleEnds,r=this._getViewExtent(),o=i.findRepresentativeAxisProxy().getMinMaxSpan(),a=[0,100];DT(e,n,r,i.get("zoomLock")?"all":t,null!=o.minSpan?iD(o.minSpan,a,r,!0):null,null!=o.maxSpan?iD(o.maxSpan,a,r,!0):null),this._range=nD([iD(n[0],r,a,!0),iD(n[1],r,a,!0)])},_updateView:function(t){var n=this._displayables,r=this._handleEnds,e=nD(r.slice()),o=this._size;oD([0,1],function(t){var e=n.handles[t],i=this._handleHeight;e.attr({scale:[i/2,i/2],position:[r[t],o[1]/2-i/2]})},this),n.filler.setShape({x:e[0],y:0,width:e[1]-e[0],height:o[1]}),this._updateDataInfo(t)},_updateDataInfo:function(t){var e=this.dataZoomModel,o=this._displayables,a=o.handleLabels,s=this._orient,l=["",""];if(e.get("showDetail")){var i=e.findRepresentativeAxisProxy();if(i){var n=i.getAxisModel().axis,r=this._range,h=t?i.calculateDataWindow({start:r[0],end:r[1]}).valueWindow:i.getDataValueWindow();l=[this._formatLabel(h[0],n),this._formatLabel(h[1],n)]}}var c=nD(this._handleEnds.slice());function u(t){var e=pf.getTransform(o.handles[t].parent,this.group),i=pf.transformDirection(0===t?"right":"left",e),n=this._handleWidth/2+5,r=pf.applyTransform([c[t]+(0===t?-n:n),this._size[1]/2],e);a[t].setStyle({x:r[0],y:r[1],textVerticalAlign:s===aD?"middle":i,textAlign:s===aD?i:"center",text:l[t]})}u.call(this,0),u.call(this,1)},_formatLabel:function(t,e){var i=this.dataZoomModel,n=i.get("labelFormatter"),r=i.get("labelPrecision");null!=r&&"auto"!==r||(r=e.getPixelPrecision());var o=null==t||isNaN(t)?"":"category"===e.type||"time"===e.type?e.scale.getLabel(Math.round(t)):t.toFixed(Math.min(r,20));return za.isFunction(n)?n(t,o):za.isString(n)?n.replace("{value}",o):o},_showDataInfo:function(t){t=this._dragging||t;var e=this._displayables.handleLabels;e[0].attr("invisible",!t),e[1].attr("invisible",!t)},_onDragMove:function(t,e,i){this._dragging=!0;var n=this._displayables.barGroup.getLocalTransform(),r=pf.applyTransform([e,i],n,!0);this._updateInterval(t,r[0]);var o=this.dataZoomModel.get("realtime");this._updateView(!o),o&&o&&this._dispatchZoomAction()},_onDragEnd:function(){this._dragging=!1,this._showDataInfo(!1),this._dispatchZoomAction()},_onClickPanelClick:function(t){var e=this._size,i=this._displayables.barGroup.transformCoordToLocal(t.offsetX,t.offsetY);if(!(i[0]<0||i[0]>e[0]||i[1]<0||i[1]>e[1])){var n=this._handleEnds,r=(n[0]+n[1])/2;this._updateInterval("all",i[0]-r),this._updateView(),this._dispatchZoomAction()}},_dispatchZoomAction:function(){var t=this._range;this.api.dispatchAction({type:"dataZoom",from:this.uid,dataZoomId:this.dataZoomModel.id,start:t[0],end:t[1]})},_findCoordRect:function(){var i;if(oD(this.getTargetCoordInfo(),function(t){if(!i&&t.length){var e=t[0].model.coordinateSystem;i=e.getRect&&e.getRect()}}),!i){var t=this.api.getWidth(),e=this.api.getHeight();i={x:.2*t,y:.2*e,width:.6*t,height:.6*e}}return i}});function cD(t){return"vertical"===t?"ns-resize":"ew-resize"}$R.extend({type:"dataZoom.inside",defaultOption:{disabled:!1,zoomLock:!1,zoomOnMouseWheel:!0,moveOnMouseMove:!0,preventDefaultMouseMove:!0}});var uD=za.curry,dD="\0_ec_dataZoom_roams";function pD(t){var e=t.getZr();return e[dD]||(e[dD]={})}function fD(i){za.each(i,function(t,e){t.count||(t.controller.dispose(),delete i[e])})}function gD(e,i,n,r,o,a,s){vD(e,function(t){return t.panGetRange(e.controller,i,n,r,o,a,s)})}function mD(e,i,n,r){vD(e,function(t){return t.zoomGetRange(e.controller,i,n,r)})}function vD(t,i){var n=[];za.each(t.dataZoomInfos,function(t){var e=i(t);!t.disabled&&e&&n.push({dataZoomId:t.dataZoomId,start:e[0],end:e[1]})}),t.dispatchAction(n)}function yD(t,e){t.dispatchAction({type:"dataZoom",batch:e})}var _D={register:function(t,n){var e=pD(t),r=n.dataZoomId,o=n.coordId;za.each(e,function(t,e){var i=t.dataZoomInfos;i[r]&&za.indexOf(n.allCoordIds,o)<0&&(delete i[r],t.count--)}),fD(e);var i,a,s=e[o];s||((s=e[o]={coordId:o,dataZoomInfos:{},count:0}).controller=(i=s,(a=new Qw(t.getZr())).on("pan",uD(gD,i)),a.on("zoom",uD(mD,i)),a),s.dispatchAction=za.curry(yD,t)),!s.dataZoomInfos[r]&&s.count++,s.dataZoomInfos[r]=n;var l,h,c,u,d=(l=s.dataZoomInfos,c={},u={true:2,move:1,false:0,undefined:-1},za.each(l,function(t){var e=!t.disabled&&(!t.zoomLock||"move");u[h]<u[e]&&(h=e),za.extend(c,t.roamControllerOpt)}),{controlType:h,opt:c});s.controller.enable(d.controlType,d.opt),s.controller.setPointerChecker(n.containsPoint),um.createOrUpdate(s,"dispatchAction",n.throttleRate,"fixRate")},unregister:function(t,i){var e=pD(t);za.each(e,function(t){t.controller.dispose();var e=t.dataZoomInfos;e[i]&&(delete e[i],t.count--)}),fD(e)},shouldRecordRange:function(t,e){if(t&&"dataZoom"===t.type&&t.batch)for(var i=0,n=t.batch.length;i<n;i++)if(t.batch[i].dataZoomId===e)return!1;return!0},generateCoordId:function(t){return t.type+"\0_"+t.id}},xD=za.bind,wD=tD.extend({type:"dataZoom.inside",init:function(t,e){this._range},render:function(o,t,a,e){wD.superApply(this,"render",arguments),_D.shouldRecordRange(e,o.id)&&(this._range=o.getPercentRange()),za.each(this.getTargetCoordInfo(),function(t,i){var r=za.map(t,function(t){return _D.generateCoordId(t.model)});za.each(t,function(t){var n=t.model,e=o.option;_D.register(a,{coordId:_D.generateCoordId(n),allCoordIds:r,containsPoint:function(t,e,i){return n.coordinateSystem.containPoint([e,i])},dataZoomId:o.id,throttleRate:o.get("throttle",!0),panGetRange:xD(this._onPan,this,t,i),zoomGetRange:xD(this._onZoom,this,t,i),zoomLock:e.zoomLock,disabled:e.disabled,roamControllerOpt:{zoomOnMouseWheel:e.zoomOnMouseWheel,moveOnMouseMove:e.moveOnMouseMove,preventDefaultMouseMove:e.preventDefaultMouseMove}})},this)},this)},dispose:function(){_D.unregister(this.api,this.dataZoomModel.id),wD.superApply(this,"dispose",arguments),this._range=null},_onPan:function(t,e,i,n,r,o,a,s,l){var h=this._range.slice(),c=t.axisModels[0];if(c){var u=bD[e]([o,a],[s,l],c,i,t),d=u.signal*(h[1]-h[0])*u.pixel/u.pixelLength;return DT(d,h,[0,100],"all"),this._range=h}},_onZoom:function(t,e,i,n,r,o){var a=this._range.slice(),s=t.axisModels[0];if(s){var l=bD[e](null,[r,o],s,i,t),h=(0<l.signal?l.pixelStart+l.pixelLength-l.pixel:l.pixel-l.pixelStart)/l.pixelLength*(a[1]-a[0])+a[0];n=Math.max(1/n,0),a[0]=(a[0]-h)*n+h,a[1]=(a[1]-h)*n+h;var c=this.dataZoomModel.findRepresentativeAxisProxy().getMinMaxSpan();return DT(0,a,[0,100],0,c.minSpan,c.maxSpan),this._range=a}}}),bD={grid:function(t,e,i,n,r){var o=i.axis,a={},s=r.model.coordinateSystem.getRect();return t=t||[0,0],"x"===o.dim?(a.pixel=e[0]-t[0],a.pixelLength=s.width,a.pixelStart=s.x,a.signal=o.inverse?1:-1):(a.pixel=e[1]-t[1],a.pixelLength=s.height,a.pixelStart=s.y,a.signal=o.inverse?-1:1),a},polar:function(t,e,i,n,r){var o=i.axis,a={},s=r.model.coordinateSystem,l=s.getRadiusAxis().getExtent(),h=s.getAngleAxis().getExtent();return t=t?s.pointToCoord(t):[0,0],e=s.pointToCoord(e),"radiusAxis"===i.mainType?(a.pixel=e[0]-t[0],a.pixelLength=l[1]-l[0],a.pixelStart=l[0],a.signal=o.inverse?1:-1):(a.pixel=e[1]-t[1],a.pixelLength=h[1]-h[0],a.pixelStart=h[0],a.signal=o.inverse?-1:1),a},singleAxis:function(t,e,i,n,r){var o=i.axis,a=r.model.coordinateSystem.getRect(),s={};return t=t||[0,0],"horizontal"===o.orient?(s.pixel=e[0]-t[0],s.pixelLength=a.width,s.pixelStart=a.x,s.signal=o.inverse?1:-1):(s.pixel=e[1]-t[1],s.pixelLength=a.height,s.pixelStart=a.y,s.signal=o.inverse?-1:1),s}};function MD(t,e,i){i.getAxisProxy(t.name,e).reset(i)}function SD(t,e,i){i.getAxisProxy(t.name,e).filterData(i)}fy.registerProcessor(function(t,e){t.eachComponent("dataZoom",function(t){t.eachTargetAxis(MD),t.eachTargetAxis(SD)}),t.eachComponent("dataZoom",function(t){var e=t.findRepresentativeAxisProxy(),i=e.getDataPercentWindow(),n=e.getDataValueWindow();t.setRawRange({start:i[0],end:i[1],startValue:n[0],endValue:n[1]},!0)})}),fy.registerAction("dataZoom",function(i,t){var n=UR.createLinkedNodesFinder(za.bind(t.eachComponent,t,"dataZoom"),UR.eachAxisDim,function(t,e){return t.get(e.axisIndex)}),r=[];t.eachComponent({mainType:"dataZoom",query:i},function(t,e){r.push.apply(r,n(t).nodes)}),za.each(r,function(t,e){t.setRawRange({start:i.start,end:i.end,startValue:i.startValue,endValue:i.endValue})})});var TD=za.each;function CD(t,e){return t&&t.hasOwnProperty&&t.hasOwnProperty(e)}var AD=function(t){var e=t&&t.visualMap;za.isArray(e)||(e=e?[e]:[]),TD(e,function(t){if(t){CD(t,"splitList")&&!CD(t,"pieces")&&(t.pieces=t.splitList,delete t.splitList);var e=t.pieces;e&&za.isArray(e)&&TD(e,function(t){za.isObject(t)&&(CD(t,"start")&&!CD(t,"min")&&(t.min=t.start),CD(t,"end")&&!CD(t,"max")&&(t.max=t.end))})}})};function ED(t,e,i,n){for(var r=e.targetVisuals[n],o=BM.prepareVisualTypes(r),a={color:t.getData().getVisual("color")},s=0,l=o.length;s<l;s++){var h=o[s],c=r["opacity"===h?"__alphaForOpacity":h];c&&c.applyVisual(i,u,d)}return a.color;function u(t){return a[t]}function d(t,e){a[t]=e}}Yf.registerSubTypeDefaulter("visualMap",function(t){return t.categories||(t.pieces?0<t.pieces.length:0<t.splitNumber)&&!t.calculable?"piecewise":"continuous"}),fy.registerVisual(fy.PRIORITY.VISUAL.COMPONENT,function(t){var e;t.eachComponent("visualMap",function(t){var i;(i=t).eachTargetSeries(function(t){var e=t.getData();VI.applyVisual(i.stateList,i.targetVisuals,e,i.getValueState,i,i.getDataDimension(e))})}),(e=t).eachSeries(function(i){var n=i.getData(),r=[];e.eachComponent("visualMap",function(t){if(t.isTargetSeries(i)){var e=t.getVisualMeta(za.bind(ED,null,i,t))||{stops:[],outerColors:[]};e.dimension=t.getDataDimension(n),r.push(e)}}),i.getData().setVisual("visualMeta",r)})});var PD={get:function(t,e,i){var n=za.clone((LD[t]||{})[e]);return i&&za.isArray(n)?n[n.length-1]:n}},LD={color:{active:["#006edd","#e0ffff"],inactive:["rgba(0,0,0,0)"]},colorHue:{active:[0,360],inactive:[0,0]},colorSaturation:{active:[.3,1],inactive:[0,0]},colorLightness:{active:[.9,.5],inactive:[0,0]},colorAlpha:{active:[.3,1],inactive:[0,0]},opacity:{active:[.3,1],inactive:[0,0]},symbol:{active:["circle","roundRect","diamond"],inactive:["none"]},symbolSize:{active:[10,50],inactive:[0,0]}},ID=PD,RD=BM.mapVisual,DD=BM.eachVisual,OD=za.isArray,kD=za.each,zD=Uc.asc,ND=Uc.linearMap,BD=za.noop,FD=["#f6efa6","#d88273","#bf444c"],GD=fy.extendComponentModel({type:"visualMap",dependencies:["series"],stateList:["inRange","outOfRange"],replacableOptionKeys:["inRange","outOfRange","target","controller","color"],dataBound:[-1/0,1/0],layoutMode:{type:"box",ignoreSize:!0},defaultOption:{show:!0,zlevel:0,z:4,seriesIndex:"all",min:0,max:200,dimension:null,inRange:null,outOfRange:null,left:0,right:null,top:null,bottom:0,itemWidth:null,itemHeight:null,inverse:!1,orient:"vertical",backgroundColor:"rgba(0,0,0,0)",borderColor:"#ccc",contentColor:"#5793f3",inactiveColor:"#aaa",borderWidth:0,padding:5,textGap:10,precision:0,color:null,formatter:null,text:null,textStyle:{color:"#333"}},init:function(t,e,i){this._dataExtent,this.targetVisuals={},this.controllerVisuals={},this.textStyleModel,this.itemSize,this.mergeDefaultAndTheme(t,i)},optionUpdated:function(t,e){var i=this.option;ca.canvasSupported||(i.realtime=!1),!e&&VI.replaceVisualOption(i,t,this.replacableOptionKeys),this.textStyleModel=this.getModel("textStyle"),this.resetItemSize(),this.completeVisualOption()},resetVisual:function(t){var e=this.stateList;t=za.bind(t,this),this.controllerVisuals=VI.createVisualMappings(this.option.controller,e,t),this.targetVisuals=VI.createVisualMappings(this.option.target,e,t)},getTargetSeriesIndices:function(){var t=this.option.seriesIndex,i=[];return null==t||"all"===t?this.ecModel.eachSeries(function(t,e){i.push(e)}):i=If.normalizeToArray(t),i},eachTargetSeries:function(e,i){za.each(this.getTargetSeriesIndices(),function(t){e.call(i,this.ecModel.getSeriesByIndex(t))},this)},isTargetSeries:function(e){var i=!1;return this.eachTargetSeries(function(t){t===e&&(i=!0)}),i},formatValueText:function(t,e,i){var n,r,o=this.option,a=o.precision,s=this.dataBound,l=o.formatter;return i=i||["<",">"],za.isArray(t)&&(t=t.slice(),n=!0),r=e?t:n?[h(t[0]),h(t[1])]:h(t),za.isString(l)?l.replace("{value}",n?r[0]:r).replace("{value2}",n?r[1]:r):za.isFunction(l)?n?l(t[0],t[1]):l(t):n?t[0]===s[0]?i[0]+" "+r[1]:t[1]===s[1]?i[1]+" "+r[0]:r[0]+" - "+r[1]:r;function h(t){return t===s[0]?"min":t===s[1]?"max":(+t).toFixed(Math.min(a,20))}},resetExtent:function(){var t=this.option,e=zD([t.min,t.max]);this._dataExtent=e},getDataDimension:function(t){var e=this.option.dimension;return null!=e?e:t.dimensions.length-1},getExtent:function(){return this._dataExtent.slice()},completeVisualOption:function(){var t=this.option,e={inRange:t.inRange,outOfRange:t.outOfRange},i=t.target||(t.target={}),n=t.controller||(t.controller={});za.merge(i,e),za.merge(n,e);var h=this.isCategory();function r(n){OD(t.color)&&!n.inRange&&(n.inRange={color:t.color.slice().reverse()}),n.inRange=n.inRange||{color:FD},kD(this.stateList,function(t){var e=n[t];if(za.isString(e)){var i=ID.get(e,"active",h);i?(n[t]={},n[t][e]=i):delete n[t]}},this)}r.call(this,i),r.call(this,n),function(t,e,i){var n=t[e],r=t[i];n&&!r&&(r=t[i]={},kD(n,function(t,e){if(BM.isValidType(e)){var i=ID.get(e,"inactive",h);null!=i&&(r[e]=i,"color"!==e||r.hasOwnProperty("opacity")||r.hasOwnProperty("colorAlpha")||(r.opacity=[0,0]))}}))}.call(this,i,"inRange","outOfRange"),function(o){var a=(o.inRange||{}).symbol||(o.outOfRange||{}).symbol,s=(o.inRange||{}).symbolSize||(o.outOfRange||{}).symbolSize,l=this.get("inactiveColor");kD(this.stateList,function(t){var e=this.itemSize,i=o[t];i||(i=o[t]={color:h?l:[l]}),null==i.symbol&&(i.symbol=a&&za.clone(a)||(h?"roundRect":["roundRect"])),null==i.symbolSize&&(i.symbolSize=s&&za.clone(s)||(h?e[0]:[e[0],e[0]])),i.symbol=RD(i.symbol,function(t){return"none"===t||"square"===t?"roundRect":t});var n=i.symbolSize;if(null!=n){var r=-1/0;DD(n,function(t){r<t&&(r=t)}),i.symbolSize=RD(n,function(t){return ND(t,[0,r],[0,e[0]],!0)})}},this)}.call(this,n)},resetItemSize:function(){this.itemSize=[parseFloat(this.get("itemWidth")),parseFloat(this.get("itemHeight"))]},isCategory:function(){return!!this.option.categories},setSelected:BD,getValueState:BD,getVisualMeta:BD}),VD=[20,140],HD=GD.extend({type:"visualMap.continuous",defaultOption:{align:"auto",calculable:!1,range:null,realtime:!0,itemHeight:null,itemWidth:null,hoverLink:!0,hoverLinkDataSize:null,hoverLinkOnHandle:null},optionUpdated:function(t,e){HD.superApply(this,"optionUpdated",arguments),this.resetExtent(),this.resetVisual(function(t){t.mappingMethod="linear",t.dataExtent=this.getExtent()}),this._resetRange()},resetItemSize:function(){HD.superApply(this,"resetItemSize",arguments);var t=this.itemSize;"horizontal"===this._orient&&t.reverse(),(null==t[0]||isNaN(t[0]))&&(t[0]=VD[0]),(null==t[1]||isNaN(t[1]))&&(t[1]=VD[1])},_resetRange:function(){var t=this.getExtent(),e=this.option.range;!e||e.auto?(t.auto=1,this.option.range=t):za.isArray(e)&&(e[0]>e[1]&&e.reverse(),e[0]=Math.max(e[0],t[0]),e[1]=Math.min(e[1],t[1]))},completeVisualOption:function(){GD.prototype.completeVisualOption.apply(this,arguments),za.each(this.stateList,function(t){var e=this.option.controller[t].symbolSize;e&&e[0]!==e[1]&&(e[0]=0)},this)},setSelected:function(t){this.option.range=t.slice(),this._resetRange()},getSelected:function(){var t=this.getExtent(),e=Uc.asc((this.get("range")||[]).slice());return e[0]>t[1]&&(e[0]=t[1]),e[1]>t[1]&&(e[1]=t[1]),e[0]<t[0]&&(e[0]=t[0]),e[1]<t[0]&&(e[1]=t[0]),e},getValueState:function(t){var e=this.option.range,i=this.getExtent();return(e[0]<=i[0]||e[0]<=t)&&(e[1]>=i[1]||t<=e[1])?"inRange":"outOfRange"},findTargetDataIndices:function(n){var r=[];return this.eachTargetSeries(function(t){var i=[],e=t.getData();e.each(this.getDataDimension(e),function(t,e){n[0]<=t&&t<=n[1]&&i.push(e)},!0,this),r.push({seriesId:t.id,dataIndex:i})},this),r},getVisualMeta:function(i){var t=UD(this,"outOfRange",this.getExtent()),e=UD(this,"inRange",this.option.range.slice()),n=[];function r(t,e){n.push({value:t,color:i(t,e)})}for(var o=0,a=0,s=e.length,l=t.length;a<l&&(!e.length||t[a]<=e[0]);a++)t[a]<e[o]&&r(t[a],"outOfRange");for(var h=1;o<s;o++,h=0)h&&n.length&&r(e[o],"outOfRange"),r(e[o],"inRange");for(h=1;a<l;a++)(!e.length||e[e.length-1]<t[a])&&(h&&(n.length&&r(n[n.length-1].value,"outOfRange"),h=0),r(t[a],"outOfRange"));var c=n.length;return{stops:n,outerColors:[c?n[0].color:"transparent",c?n[c-1].color:"transparent"]}}});function UD(t,e,i){if(i[0]===i[1])return i.slice();for(var n=(i[1]-i[0])/200,r=i[0],o=[],a=0;a<=200&&r<i[1];a++)o.push(r),r+=n;return o.push(i[1]),o}var WD=fy.extendComponentView({type:"visualMap",autoPositionValues:{left:1,right:1,top:1,bottom:1},init:function(t,e){this.ecModel=t,this.api=e,this.visualMapModel},render:function(t,e,i,n){!1!==(this.visualMapModel=t).get("show")?this.doRender.apply(this,arguments):this.group.removeAll()},renderBackground:function(t){var e=this.visualMapModel,i=Yc.normalizeCssArray(e.get("padding")||0),n=t.getBoundingRect();t.add(new pf.Rect({z2:-1,silent:!0,shape:{x:n.x-i[3],y:n.y-i[0],width:n.width+i[3]+i[1],height:n.height+i[0]+i[2]},style:{fill:e.get("backgroundColor"),stroke:e.get("borderColor"),lineWidth:e.get("borderWidth")}}))},getControllerVisual:function(i,n,r){var t=(r=r||{}).forceState,e=this.visualMapModel,o={};if("symbol"===n&&(o.symbol=e.get("itemSymbol")),"color"===n){var a=e.get("contentColor");o.color=a}function s(t){return o[t]}function l(t,e){o[t]=e}var h=e.controllerVisuals[t||e.getValueState(i)],c=BM.prepareVisualTypes(h);return za.each(c,function(t){var e=h[t];r.convertOpacityToAlpha&&"opacity"===t&&(t="colorAlpha",e=h.__alphaForOpacity),BM.dependsOn(t,n)&&e&&e.applyVisual(i,s,l)}),o[n]},positionGroup:function(t){var e=this.visualMapModel,i=this.api;jf.positionElement(t,e.getBoxLayoutParams(),{width:i.getWidth(),height:i.getHeight()})},doRender:za.noop}),jD=jf.getLayoutRect;var ZD={getItemAlign:function(t,e,i){var n=t.option,r=n.align;if(null!=r&&"auto"!==r)return r;for(var o={width:e.getWidth(),height:e.getHeight()},a="horizontal"===n.orient?1:0,s=[["left","right","width"],["top","bottom","height"]],l=s[a],h=[0,null,10],c={},u=0;u<3;u++)c[s[1-a][u]]=h[u],c[l[u]]=2===u?i[0]:n[l[u]];var d=[["x","width",3],["y","height",0]][a],p=jD(c,o,n.padding);return l[(p.margin[d[2]]||0)+p[d[0]]+.5*p[d[1]]<.5*o[d[1]]?0:1]},convertDataIndex:function(e){return za.each(e||[],function(t){null!=e.dataIndex&&(e.dataIndexInside=e.dataIndex,e.dataIndex=null)}),e}},XD=Uc.linearMap,qD=za.each,YD=Math.min,JD=Math.max,KD=WD.extend({type:"visualMap.continuous",init:function(){KD.superApply(this,"init",arguments),this._shapes={},this._dataInterval=[],this._handleEnds=[],this._orient,this._useHandle,this._hoverLinkDataIndices=[],this._dragging,this._hovering},doRender:function(t,e,i,n){n&&"selectDataRange"===n.type&&n.from===this.uid||this._buildView()},_buildView:function(){this.group.removeAll();var t=this.visualMapModel,e=this.group;this._orient=t.get("orient"),this._useHandle=t.get("calculable"),this._resetInterval(),this._renderBar(e);var i=t.get("text");this._renderEndsText(e,i,0),this._renderEndsText(e,i,1),this._updateView(!0),this.renderBackground(e),this._updateView(),this._enableHoverLinkToSeries(),this._enableHoverLinkFromSeries(),this.positionGroup(e)},_renderEndsText:function(t,e,i){if(e){var n=e[1-i];n=null!=n?n+"":"";var r=this.visualMapModel,o=r.get("textGap"),a=r.itemSize,s=this._shapes.barGroup,l=this._applyTransform([a[0]/2,0===i?-o:a[1]+o],s),h=this._applyTransform(0===i?"bottom":"top",s),c=this._orient,u=this.visualMapModel.textStyleModel;this.group.add(new pf.Text({style:{x:l[0],y:l[1],textVerticalAlign:"horizontal"===c?"middle":h,textAlign:"horizontal"===c?h:"center",text:n,textFont:u.getFont(),textFill:u.getTextColor()}}))}},_renderBar:function(t){var e=this.visualMapModel,i=this._shapes,n=e.itemSize,r=this._orient,o=this._useHandle,a=ZD.getItemAlign(e,this.api,n),s=i.barGroup=this._createBarGroup(a);s.add(i.outOfRange=QD()),s.add(i.inRange=QD(null,o?tO(this._orient):null,za.bind(this._dragHandle,this,"all",!1),za.bind(this._dragHandle,this,"all",!0)));var l=e.textStyleModel.getTextRect("\u56fd"),h=JD(l.width,l.height);o&&(i.handleThumbs=[],i.handleLabels=[],i.handleLabelPoints=[],this._createHandle(s,0,n,h,r,a),this._createHandle(s,1,n,h,r,a)),this._createIndicator(s,n,h,r),t.add(s)},_createHandle:function(t,e,i,n,r){var o,a=za.bind(this._dragHandle,this,e,!1),s=za.bind(this._dragHandle,this,e,!0),l=QD((o=n,0===e?[[0,0],[o,0],[o,-o]]:[[0,0],[o,0],[o,o]]),tO(this._orient),a,s);l.position[0]=i[0],t.add(l);var h=this.visualMapModel.textStyleModel,c=new pf.Text({draggable:!0,drift:a,onmousemove:function(t){pc.stop(t.event)},ondragend:s,style:{x:0,y:0,text:"",textFont:h.getFont(),textFill:h.getTextColor()}});this.group.add(c);var u=["horizontal"===r?n/2:1.5*n,"horizontal"===r?0===e?-1.5*n:1.5*n:0===e?-n/2:n/2],d=this._shapes;d.handleThumbs[e]=l,d.handleLabelPoints[e]=u,d.handleLabels[e]=c},_createIndicator:function(t,e,i,n){var r=QD([[0,0]],"move");r.position[0]=e[0],r.attr({invisible:!0,silent:!0}),t.add(r);var o=this.visualMapModel.textStyleModel,a=new pf.Text({silent:!0,invisible:!0,style:{x:0,y:0,text:"",textFont:o.getFont(),textFill:o.getTextColor()}});this.group.add(a);var s=["horizontal"===n?i/2:9,0],l=this._shapes;l.indicator=r,l.indicatorLabel=a,l.indicatorLabelPoint=s},_dragHandle:function(t,e,i,n){if(this._useHandle){if(this._dragging=!e,!e){var r=this._applyTransform([i,n],this._shapes.barGroup,!0);this._updateInterval(t,r[1]),this._updateView()}e===!this.visualMapModel.get("realtime")&&this.api.dispatchAction({type:"selectDataRange",from:this.uid,visualMapId:this.visualMapModel.id,selected:this._dataInterval.slice()}),e?!this._hovering&&this._clearHoverLinkToSeries():$D(this.visualMapModel)&&this._doHoverLinkToSeries(this._handleEnds[t],!1)}},_resetInterval:function(){var t=this.visualMapModel,e=this._dataInterval=t.getSelected(),i=t.getExtent(),n=[0,t.itemSize[1]];this._handleEnds=[XD(e[0],i,n,!0),XD(e[1],i,n,!0)]},_updateInterval:function(t,e){e=e||0;var i=this.visualMapModel,n=this._handleEnds,r=[0,i.itemSize[1]];DT(e,n,r,t,0);var o=i.getExtent();this._dataInterval=[XD(n[0],r,o,!0),XD(n[1],r,o,!0)]},_updateView:function(t){var e=this.visualMapModel,i=e.getExtent(),n=this._shapes,r=[0,e.itemSize[1]],o=t?r:this._handleEnds,a=this._createBarVisual(this._dataInterval,i,o,"inRange"),s=this._createBarVisual(i,i,r,"outOfRange");n.inRange.setStyle({fill:a.barColor,opacity:a.opacity}).setShape("points",a.barPoints),n.outOfRange.setStyle({fill:s.barColor,opacity:s.opacity}).setShape("points",s.barPoints),this._updateHandle(o,a)},_createBarVisual:function(t,e,i,n){var r={forceState:n,convertOpacityToAlpha:!0},o=this._makeColorGradient(t,r),a=[this.getControllerVisual(t[0],"symbolSize",r),this.getControllerVisual(t[1],"symbolSize",r)],s=this._createBarPoints(i,a);return{barColor:new xp(0,0,0,1,o),barPoints:s,handlesColor:[o[0].color,o[o.length-1].color]}},_makeColorGradient:function(t,e){var i=[],n=(t[1]-t[0])/100;i.push({color:this.getControllerVisual(t[0],"color",e),offset:0});for(var r=1;r<100;r++){var o=t[0]+n*r;if(o>t[1])break;i.push({color:this.getControllerVisual(o,"color",e),offset:r/100})}return i.push({color:this.getControllerVisual(t[1],"color",e),offset:1}),i},_createBarPoints:function(t,e){var i=this.visualMapModel.itemSize;return[[i[0]-e[0],t[0]],[i[0],t[0]],[i[0],t[1]],[i[0]-e[1],t[1]]]},_createBarGroup:function(t){var e=this._orient,i=this.visualMapModel.get("inverse");return new pf.Group("horizontal"!==e||i?"horizontal"===e&&i?{scale:"bottom"===t?[-1,1]:[1,1],rotation:-Math.PI/2}:"vertical"!==e||i?{scale:"left"===t?[1,1]:[-1,1]}:{scale:"left"===t?[1,-1]:[-1,-1]}:{scale:"bottom"===t?[1,1]:[-1,1],rotation:Math.PI/2})},_updateHandle:function(n,r){if(this._useHandle){var o=this._shapes,a=this.visualMapModel,s=o.handleThumbs,l=o.handleLabels;qD([0,1],function(t){var e=s[t];e.setStyle("fill",r.handlesColor[t]),e.position[1]=n[t];var i=pf.applyTransform(o.handleLabelPoints[t],pf.getTransform(e,this.group));l[t].setStyle({x:i[0],y:i[1],text:a.formatValueText(this._dataInterval[t]),textVerticalAlign:"middle",textAlign:this._applyTransform("horizontal"===this._orient?0===t?"bottom":"top":"left",o.barGroup)})},this)}},_showIndicator:function(t,e,i,n){var r=this.visualMapModel,o=r.getExtent(),a=r.itemSize,s=[0,a[1]],l=XD(t,o,s,!0),h=this._shapes,c=h.indicator;if(c){var u,d,p,f;c.position[1]=l,c.attr("invisible",!1),c.setShape("points",(u=!!i,d=n,p=l,f=a[1],u?[[0,-YD(d,JD(p,0))],[6,0],[0,YD(d,JD(f-p,0))]]:[[0,0],[5,-5],[5,5]]));var g=this.getControllerVisual(t,"color",{convertOpacityToAlpha:!0});c.setStyle("fill",g);var m=pf.applyTransform(h.indicatorLabelPoint,pf.getTransform(c,this.group)),v=h.indicatorLabel;v.attr("invisible",!1);var y=this._applyTransform("left",h.barGroup),_=this._orient;v.setStyle({text:(i||"")+r.formatValueText(e),textVerticalAlign:"horizontal"===_?y:"middle",textAlign:"horizontal"===_?"center":y,x:m[0],y:m[1]})}},_enableHoverLinkToSeries:function(){var n=this;this._shapes.barGroup.on("mousemove",function(t){if(n._hovering=!0,!n._dragging){var e=n.visualMapModel.itemSize,i=n._applyTransform([t.offsetX,t.offsetY],n._shapes.barGroup,!0,!0);i[1]=YD(JD(0,i[1]),e[1]),n._doHoverLinkToSeries(i[1],0<=i[0]&&i[0]<=e[0])}}).on("mouseout",function(){n._hovering=!1,!n._dragging&&n._clearHoverLinkToSeries()})},_enableHoverLinkFromSeries:function(){var t=this.api.getZr();this.visualMapModel.option.hoverLink?(t.on("mouseover",this._hoverLinkFromSeriesMouseOver,this),t.on("mouseout",this._hideIndicator,this)):this._clearHoverLinkFromSeries()},_doHoverLinkToSeries:function(t,e){var i=this.visualMapModel,n=i.itemSize;if(i.option.hoverLink){var r=[0,n[1]],o=i.getExtent();t=YD(JD(r[0],t),r[1]);var a=function(t,e,i){var n=6,r=t.get("hoverLinkDataSize");r&&(n=XD(r,e,i,!0)/2);return n}(i,o,r),s=[t-a,t+a],l=XD(t,r,o,!0),h=[XD(s[0],r,o,!0),XD(s[1],r,o,!0)];s[0]<r[0]&&(h[0]=-1/0),r[1]<s[1]&&(h[1]=1/0),e&&(h[0]===-1/0?this._showIndicator(l,h[1],"< ",a):h[1]===1/0?this._showIndicator(l,h[0],"> ",a):this._showIndicator(l,l,"\u2248 ",a));var c=this._hoverLinkDataIndices,u=[];(e||$D(i))&&(u=this._hoverLinkDataIndices=i.findTargetDataIndices(h));var d=If.compressBatches(c,u);this._dispatchHighDown("downplay",ZD.convertDataIndex(d[0])),this._dispatchHighDown("highlight",ZD.convertDataIndex(d[1]))}},_hoverLinkFromSeriesMouseOver:function(t){var e=t.target,i=this.visualMapModel;if(e&&null!=e.dataIndex){var n=this.ecModel.getSeriesByIndex(e.seriesIndex);if(i.isTargetSeries(n)){var r=n.getData(e.dataType),o=r.getDimension(i.getDataDimension(r)),a=r.get(o,e.dataIndex,!0);isNaN(a)||this._showIndicator(a,a)}}},_hideIndicator:function(){var t=this._shapes;t.indicator&&t.indicator.attr("invisible",!0),t.indicatorLabel&&t.indicatorLabel.attr("invisible",!0)},_clearHoverLinkToSeries:function(){this._hideIndicator();var t=this._hoverLinkDataIndices;this._dispatchHighDown("downplay",ZD.convertDataIndex(t)),t.length=0},_clearHoverLinkFromSeries:function(){this._hideIndicator();var t=this.api.getZr();t.off("mouseover",this._hoverLinkFromSeriesMouseOver),t.off("mouseout",this._hideIndicator)},_applyTransform:function(t,e,i,n){var r=pf.getTransform(e,n?null:this.group);return pf[za.isArray(t)?"applyTransform":"transformDirection"](t,r,i)},_dispatchHighDown:function(t,e){e&&e.length&&this.api.dispatchAction({type:t,batch:e})},dispose:function(){this._clearHoverLinkFromSeries(),this._clearHoverLinkToSeries()},remove:function(){this._clearHoverLinkFromSeries(),this._clearHoverLinkToSeries()}});function QD(t,e,i,n){return new pf.Polygon({shape:{points:t},draggable:!!i,cursor:e,drift:i,onmousemove:function(t){pc.stop(t.event)},ondragend:n})}function $D(t){var e=t.get("hoverLinkOnHandle");return!!(null==e?t.get("realtime"):e)}function tO(t){return"vertical"===t?"ns-resize":"ew-resize"}fy.registerAction({type:"selectDataRange",event:"dataRangeSelected",update:"update"},function(e,t){t.eachComponent({mainType:"visualMap",query:e},function(t){t.setSelected(e.selected)})}),fy.registerPreprocessor(AD);var eO=Uc.reformIntervals,iO=GD.extend({type:"visualMap.piecewise",defaultOption:{selected:null,minOpen:!1,maxOpen:!1,align:"auto",itemWidth:20,itemHeight:14,itemSymbol:"roundRect",pieceList:null,categories:null,splitNumber:5,selectedMode:"multiple",itemGap:10,hoverLink:!0,showLabel:null},optionUpdated:function(t,e){iO.superApply(this,"optionUpdated",arguments),this._pieceList=[],this.resetExtent();var i=this._mode=this._determineMode();nO[this._mode].call(this),this._resetSelected(t,e);var n=this.option.categories;this.resetVisual(function(t,e){"categories"===i?(t.mappingMethod="category",t.categories=za.clone(n)):(t.dataExtent=this.getExtent(),t.mappingMethod="piecewise",t.pieceList=za.map(this._pieceList,function(t){t=za.clone(t);return"inRange"!==e&&(t.visual=null),t}))})},completeVisualOption:function(){var n=this.option,i={},t=BM.listVisualTypes(),r=this.isCategory();function o(t,e,i){return t&&t[e]&&(za.isObject(t[e])?t[e].hasOwnProperty(i):t[e]===i)}za.each(n.pieces,function(e){za.each(t,function(t){e.hasOwnProperty(t)&&(i[t]=1)})}),za.each(i,function(t,e){var i=0;za.each(this.stateList,function(t){i|=o(n,t,e)||o(n.target,t,e)},this),!i&&za.each(this.stateList,function(t){(n[t]||(n[t]={}))[e]=ID.get(e,"inRange"===t?"active":"inactive",r)})},this),GD.prototype.completeVisualOption.apply(this,arguments)},_resetSelected:function(t,e){var i=this.option,n=this._pieceList,r=(e?i:t).selected||{};if(i.selected=r,za.each(n,function(t,e){var i=this.getSelectedMapKey(t);r.hasOwnProperty(i)||(r[i]=!0)},this),"single"===i.selectedMode){var o=!1;za.each(n,function(t,e){var i=this.getSelectedMapKey(t);r[i]&&(o?r[i]=!1:o=!0)},this)}},getSelectedMapKey:function(t){return"categories"===this._mode?t.value+"":t.index+""},getPieceList:function(){return this._pieceList},_determineMode:function(){var t=this.option;return t.pieces&&0<t.pieces.length?"pieces":this.option.categories?"categories":"splitNumber"},setSelected:function(t){this.option.selected=za.clone(t)},getValueState:function(t){var e=BM.findPieceIndex(t,this._pieceList);return null!=e&&this.option.selected[this.getSelectedMapKey(this._pieceList[e])]?"inRange":"outOfRange"},findTargetDataIndices:function(n){var r=[];return this.eachTargetSeries(function(t){var i=[],e=t.getData();e.each(this.getDataDimension(e),function(t,e){BM.findPieceIndex(t,this._pieceList)===n&&i.push(e)},!0,this),r.push({seriesId:t.id,dataIndex:i})},this),r},getRepresentValue:function(t){var e;if(this.isCategory())e=t.value;else if(null!=t.value)e=t.value;else{var i=t.interval||[];e=i[0]===-1/0&&i[1]===1/0?0:(i[0]+i[1])/2}return e},getVisualMeta:function(r){if(!this.isCategory()){var o=[],a=[],s=this,t=this._pieceList.slice();if(t.length){var e=t[0].interval[0];e!==-1/0&&t.unshift({interval:[-1/0,e]}),(e=t[t.length-1].interval[1])!==1/0&&t.push({interval:[e,1/0]})}else t.push({interval:[-1/0,1/0]});var i=-1/0;return za.each(t,function(t){var e=t.interval;e&&(e[0]>i&&n([i,e[0]],"outOfRange"),n(e.slice()),i=e[1])},this),{stops:o,outerColors:a}}function n(t,e){var i=s.getRepresentValue({interval:t});e||(e=s.getValueState(i));var n=r(i,e);t[0]===-1/0?a[0]=n:t[1]===1/0?a[1]=n:o.push({value:t[0],color:n},{value:t[1],color:n})}}}),nO={splitNumber:function(){var t=this.option,e=this._pieceList,i=Math.min(t.precision,20),n=this.getExtent(),r=t.splitNumber;r=Math.max(parseInt(r,10),1),t.splitNumber=r;for(var o=(n[1]-n[0])/r;+o.toFixed(i)!==o&&i<5;)i++;t.precision=i,o=+o.toFixed(i);var a=0;t.minOpen&&e.push({index:a++,interval:[-1/0,n[0]],close:[0,0]});for(var s=n[0],l=a+r;a<l;s+=o){var h=a===r-1?n[1]:s+o;e.push({index:a++,interval:[s,h],close:[1,1]})}t.maxOpen&&e.push({index:a++,interval:[n[1],1/0],close:[0,0]}),eO(e),za.each(e,function(t){t.text=this.formatValueText(t.interval)},this)},categories:function(){var t=this.option;za.each(t.categories,function(t){this._pieceList.push({text:this.formatValueText(t,!0),value:t})},this),rO(t,this._pieceList)},pieces:function(){var t=this.option,d=this._pieceList;za.each(t.pieces,function(t,e){za.isObject(t)||(t={value:t});var i={text:"",index:e};if(null!=t.label&&(i.text=t.label),t.hasOwnProperty("value")){var n=i.value=t.value;i.interval=[n,n],i.close=[1,1]}else{for(var r=i.interval=[],o=i.close=[0,0],a=[1,0,1],s=[-1/0,1/0],l=[],h=0;h<2;h++){for(var c=[["gte","gt","min"],["lte","lt","max"]][h],u=0;u<3&&null==r[h];u++)r[h]=t[c[u]],o[h]=a[u],l[h]=2===u;null==r[h]&&(r[h]=s[h])}l[0]&&r[1]===1/0&&(o[0]=0),l[1]&&r[0]===-1/0&&(o[1]=0),r[0]===r[1]&&o[0]&&o[1]&&(i.value=r[0])}i.visual=BM.retrieveVisuals(t),d.push(i)},this),rO(t,d),eO(d),za.each(d,function(t){var e=t.close,i=[["<","\u2264"][e[1]],[">","\u2265"][e[0]]];t.text=t.text||this.formatValueText(null!=t.value?t.value:t.interval,!1,i)},this)}};function rO(t,e){var i=t.inverse;("vertical"===t.orient?!i:i)&&e.reverse()}var oO=Bv.createSymbol;WD.extend({type:"visualMap.piecewise",doRender:function(){var o=this.group;o.removeAll();var a=this.visualMapModel,s=a.get("textGap"),t=a.textStyleModel,l=t.getFont(),h=t.getTextColor(),c=this._getItemAlign(),u=a.itemSize,e=this._getViewData(),i=e.endsText,d=za.retrieve(a.get("showLabel",!0),!i);i&&this._renderEndsText(o,i[0],u,d,c),za.each(e.viewPieceList,function(t){var e=t.piece,i=new pf.Group;i.onclick=za.bind(this._onItemClick,this,e),this._enableHoverLink(i,t.indexInModelPieceList);var n=a.getRepresentValue(e);if(this._createItemSymbol(i,n,[0,0,u[0],u[1]]),d){var r=this.visualMapModel.getValueState(n);i.add(new pf.Text({style:{x:"right"===c?-s:u[0]+s,y:u[1]/2,text:e.text,textVerticalAlign:"middle",textAlign:c,textFont:l,textFill:h,opacity:"outOfRange"===r?.5:1}}))}o.add(i)},this),i&&this._renderEndsText(o,i[1],u,d,c),jf.box(a.get("orient"),o,a.get("itemGap")),this.renderBackground(o),this.positionGroup(o)},_enableHoverLink:function(t,i){function e(t){var e=this.visualMapModel;e.option.hoverLink&&this.api.dispatchAction({type:t,batch:ZD.convertDataIndex(e.findTargetDataIndices(i))})}t.on("mouseover",za.bind(e,this,"highlight")).on("mouseout",za.bind(e,this,"downplay"))},_getItemAlign:function(){var t=this.visualMapModel,e=t.option;if("vertical"===e.orient)return ZD.getItemAlign(t,this.api,t.itemSize);var i=e.align;return i&&"auto"!==i||(i="left"),i},_renderEndsText:function(t,e,i,n,r){if(e){var o=new pf.Group,a=this.visualMapModel.textStyleModel;o.add(new pf.Text({style:{x:n?"right"===r?i[0]:0:i[0]/2,y:i[1]/2,textVerticalAlign:"middle",textAlign:n?r:"center",text:e,textFont:a.getFont(),textFill:a.getTextColor()}})),t.add(o)}},_getViewData:function(){var t=this.visualMapModel,e=za.map(t.getPieceList(),function(t,e){return{piece:t,indexInModelPieceList:e}}),i=t.get("text"),n=t.get("orient"),r=t.get("inverse");return("horizontal"===n?r:!r)?e.reverse():i&&(i=i.slice().reverse()),{viewPieceList:e,endsText:i}},_createItemSymbol:function(t,e,i){t.add(oO(this.getControllerVisual(e,"symbol"),i[0],i[1],i[2],i[3],this.getControllerVisual(e,"color")))},_onItemClick:function(t){var e=this.visualMapModel,i=e.option,n=za.clone(i.selected),r=e.getSelectedMapKey(t);"single"===i.selectedMode?(n[r]=!0,za.each(n,function(t,e){n[e]=e===r})):n[r]=!n[r],this.api.dispatchAction({type:"selectDataRange",from:this.uid,visualMapId:this.visualMapModel.id,selected:n})}});fy.registerPreprocessor(AD);var aO=Yc.addCommas,sO=Yc.encodeHTML;function lO(t){If.defaultEmphasis(t.label,["show"])}var hO=fy.extendComponentModel({type:"marker",dependencies:["series","grid","polar","geo"],init:function(t,e,i,n){this.mergeDefaultAndTheme(t,i),this.mergeOption(t,i,n.createdBySelf,!0)},isAnimationEnabled:function(){if(ca.node)return!1;var t=this.__hostSeries;return this.getShallow("animation")&&t&&t.isAnimationEnabled()},mergeOption:function(t,n,e,r){var o=this.constructor,a=this.mainType+"Model";e||n.eachSeries(function(t){var e=t.get(this.mainType),i=t[a];e&&e.data?(i?i.mergeOption(e,n,!0):(r&&lO(e),za.each(e.data,function(t){t instanceof Array?(lO(t[0]),lO(t[1])):lO(t)}),i=new o(e,this,n),za.extend(i,{mainType:this.mainType,seriesIndex:t.seriesIndex,name:t.name,createdBySelf:!0}),i.__hostSeries=t),t[a]=i):t[a]=null},this)},formatTooltip:function(t){var e=this.getData(),i=this.getRawValue(t),n=za.isArray(i)?za.map(i,aO).join(", "):aO(i),r=e.getName(t),o=sO(this.name);return(null!=i||r)&&(o+="<br />"),r&&(o+=sO(r),null!=i&&(o+=" : ")),null!=i&&(o+=sO(n)),o},getData:function(){return this._data},setData:function(t){this._data=t}});za.mixin(hO,If.dataFormatMixin);var cO=hO,uO=(cO.extend({type:"markPoint",defaultOption:{zlevel:0,z:5,symbol:"pin",symbolSize:50,tooltip:{trigger:"item"},label:{normal:{show:!0,position:"inside"},emphasis:{show:!0}},itemStyle:{normal:{borderWidth:2}}}}),za.indexOf);function dO(t,e,i,n,r,o){var a=[],s=mO(e,n,t),l=e.indicesOfNearest(n,s,!0)[0];a[r]=e.get(i,l,!0),a[o]=e.get(n,l,!0);var h=function(t,e,i){for(var n=-1;n=Math.max(Uc.getPrecision(t.get(e,i)),n),t=t.stackedOn;);return n}(e,n,l);return 0<=(h=Math.min(h,20))&&(a[o]=+a[o].toFixed(h)),a}var pO=za.curry,fO={min:pO(dO,"min"),max:pO(dO,"max"),average:pO(dO,"average")};function gO(t,e,i,n){var r={};return null!=t.valueIndex||null!=t.valueDim?(r.valueDataDim=null!=t.valueIndex?e.getDimension(t.valueIndex):t.valueDim,r.valueAxis=i.getAxis(n.dataDimToCoordDim(r.valueDataDim)),r.baseAxis=i.getOtherAxis(r.valueAxis),r.baseDataDim=n.coordDimToDataDim(r.baseAxis.dim)[0]):(r.baseAxis=n.getBaseAxis(),r.valueAxis=i.getOtherAxis(r.baseAxis),r.baseDataDim=n.coordDimToDataDim(r.baseAxis.dim)[0],r.valueDataDim=n.coordDimToDataDim(r.valueAxis.dim)[0]),r}function mO(t,e,i){if("average"===i){var n=0,r=0;return t.each(e,function(t,e){isNaN(t)||(n+=t,r++)},!0),n/r}return t.getDataExtent(e,!0)["max"===i?1:0]}var vO={dataTransform:function(t,e){var i,n=t.getData(),r=t.coordinateSystem;if(e&&(i=e,isNaN(parseFloat(i.x))||isNaN(parseFloat(i.y)))&&!za.isArray(e.coord)&&r){var o=r.dimensions,a=gO(e,n,r,t);if((e=za.clone(e)).type&&fO[e.type]&&a.baseAxis&&a.valueAxis){var s=uO(o,a.baseAxis.dim),l=uO(o,a.valueAxis.dim);e.coord=fO[e.type](n,a.baseDataDim,a.valueDataDim,s,l),e.value=e.coord[l]}else{for(var h=[null!=e.xAxis?e.xAxis:e.radiusAxis,null!=e.yAxis?e.yAxis:e.angleAxis],c=0;c<2;c++)if(fO[h[c]]){var u=t.coordDimToDataDim(o[c])[0];h[c]=mO(n,u,h[c])}e.coord=h}}return e},getAxisInfo:gO,dataFilter:function(t,e){return!(t&&t.containData&&e.coord&&(i=e,isNaN(parseFloat(i.x))&&isNaN(parseFloat(i.y))))||t.containData(e.coord);var i},dimValueGetter:function(t,e,i,n){return n<2?t.coord&&t.coord[n]:t.value},numCalculate:mO},yO=fy.extendComponentView({type:"marker",init:function(){this.markerGroupMap=za.createHashMap()},render:function(t,i,n){var e=this.markerGroupMap;e.each(function(t){t.__keep=!1});var r=this.type+"Model";i.eachSeries(function(t){var e=t[r];e&&this.renderSeries(t,e,i,n)},this),e.each(function(t){!t.__keep&&this.group.remove(t.group)},this)},renderSeries:function(){}});function _O(s,l,h){var c=l.coordinateSystem;s.each(function(t){var e,i=s.getItemModel(t),n=Uc.parsePercent(i.get("x"),h.getWidth()),r=Uc.parsePercent(i.get("y"),h.getHeight());if(isNaN(n)||isNaN(r)){if(l.getMarkerPosition)e=l.getMarkerPosition(s.getValues(s.dimensions,t));else if(c){var o=s.get(c.dimensions[0],t),a=s.get(c.dimensions[1],t);e=c.dataToPoint([o,a])}}else e=[n,r];isNaN(n)||(e[0]=n),isNaN(r)||(e[1]=r),s.setItemLayout(t,e)})}yO.extend({type:"markPoint",updateLayout:function(t,e,i){e.eachSeries(function(t){var e=t.markPointModel;e&&(_O(e.getData(),t,i),this.markerGroupMap.get(t.id).updateLayout(e))},this)},renderSeries:function(t,n,e,i){var r=t.coordinateSystem,o=t.id,a=t.getData(),s=this.markerGroupMap,l=s.get(o)||s.set(o,new Ry),h=function(t,i,e){var n;n=t?za.map(t&&t.dimensions,function(t){var e=i.getData().getDimensionInfo(i.coordDimToDataDim(t)[0])||{};return e.name=t,e}):[{name:"value",type:"float"}];var r=new Im(n,e),o=za.map(e.get("data"),za.curry(vO.dataTransform,i));t&&(o=za.filter(o,za.curry(vO.dataFilter,t)));return r.initData(o,null,t?vO.dimValueGetter:function(t){return t.value}),r}(r,t,n);n.setData(h),_O(n.getData(),t,i),h.each(function(t){var e=h.getItemModel(t),i=e.getShallow("symbolSize");"function"==typeof i&&(i=i(n.getRawValue(t),n.getDataParams(t))),h.setItemVisual(t,{symbolSize:i,color:e.get("itemStyle.normal.color")||a.getVisual("color"),symbol:e.getShallow("symbol")})}),l.updateData(h),this.group.add(l.group),h.eachItemGraphicEl(function(t){t.traverse(function(t){t.dataModel=n})}),l.__keep=!0,l.group.silent=n.get("silent")||t.get("silent")}});fy.registerPreprocessor(function(t){t.markPoint=t.markPoint||{}});cO.extend({type:"markLine",defaultOption:{zlevel:0,z:5,symbol:["circle","arrow"],symbolSize:[8,16],precision:2,tooltip:{trigger:"item"},label:{normal:{show:!0,position:"end"},emphasis:{show:!0}},lineStyle:{normal:{type:"dashed"},emphasis:{width:3}},animationEasing:"linear"}});var xO=function(t,e,i,n){var r=t.getData(),o=n.type;if(!za.isArray(n)&&("min"===o||"max"===o||"average"===o||null!=n.xAxis||null!=n.yAxis)){var a,s;if(null!=n.yAxis||null!=n.xAxis)a=null!=n.yAxis?"y":"x",e.getAxis(a),s=za.retrieve(n.yAxis,n.xAxis);else{var l=vO.getAxisInfo(n,r,e,t);a=l.valueDataDim,l.valueAxis,s=vO.numCalculate(r,a,o)}var h="x"===a?0:1,c=1-h,u=za.clone(n),d={};u.type=null,u.coord=[],d.coord=[],u.coord[c]=-1/0,d.coord[c]=1/0;var p=i.get("precision");0<=p&&"number"==typeof s&&(s=+s.toFixed(Math.min(p,20))),u.coord[h]=d.coord[h]=s,n=[u,d,{type:o,valueIndex:n.valueIndex,value:s}]}return(n=[vO.dataTransform(t,n[0]),vO.dataTransform(t,n[1]),za.extend({},n[2])])[2].type=n[2].type||"",za.merge(n[2],n[0]),za.merge(n[2],n[1]),n};function wO(t){return!isNaN(t)&&!isFinite(t)}function bO(t,e,i,n){var r=1-t,o=n.dimensions[t];return wO(e[r])&&wO(i[r])&&e[t]===i[t]&&n.getAxis(o).containData(e[t])}function MO(t,e){if("cartesian2d"===t.type){var i=e[0].coord,n=e[1].coord;if(i&&n&&(bO(1,i,n,t)||bO(0,i,n,t)))return!0}return vO.dataFilter(t,e[0])&&vO.dataFilter(t,e[1])}function SO(t,e,i,n,r){var o,a=n.coordinateSystem,s=t.getItemModel(e),l=Uc.parsePercent(s.get("x"),r.getWidth()),h=Uc.parsePercent(s.get("y"),r.getHeight());if(isNaN(l)||isNaN(h)){if(n.getMarkerPosition)o=n.getMarkerPosition(t.getValues(t.dimensions,e));else{var c=a.dimensions,u=t.get(c[0],e),d=t.get(c[1],e);o=a.dataToPoint([u,d])}if("cartesian2d"===a.type){var p=a.getAxis("x"),f=a.getAxis("y");c=a.dimensions;wO(t.get(c[0],e))?o[0]=p.toGlobalCoord(p.getExtent()[i?0:1]):wO(t.get(c[1],e))&&(o[1]=f.toGlobalCoord(f.getExtent()[i?0:1]))}isNaN(l)||(o[0]=l),isNaN(h)||(o[1]=h)}else o=[l,h];t.setItemLayout(e,o)}yO.extend({type:"markLine",updateLayout:function(t,e,o){e.eachSeries(function(e){var t=e.markLineModel;if(t){var i=t.getData(),n=t.__from,r=t.__to;n.each(function(t){SO(n,t,!0,e,o),SO(r,t,!1,e,o)}),i.each(function(t){i.setItemLayout(t,[n.getItemLayout(t),r.getItemLayout(t)])}),this.markerGroupMap.get(e.id).updateLayout()}},this)},renderSeries:function(r,i,t,o){var e=r.coordinateSystem,n=r.id,a=r.getData(),s=this.markerGroupMap,l=s.get(n)||s.set(n,new RS);this.group.add(l.group);var h=function(t,i,e){var n;n=t?za.map(t&&t.dimensions,function(t){var e=i.getData().getDimensionInfo(i.coordDimToDataDim(t)[0])||{};return e.name=t,e}):[{name:"value",type:"float"}];var r=new Im(n,e),o=new Im(n,e),a=new Im([],e),s=za.map(e.get("data"),za.curry(xO,i,t,e));t&&(s=za.filter(s,za.curry(MO,t)));var l=t?vO.dimValueGetter:function(t){return t.value};return r.initData(za.map(s,function(t){return t[0]}),null,l),o.initData(za.map(s,function(t){return t[1]}),null,l),a.initData(za.map(s,function(t){return t[2]})),a.hasItemOption=!0,{from:r,to:o,line:a}}(e,r,i),c=h.from,u=h.to,d=h.line;i.__from=c,i.__to=u,i.setData(d);var p=i.get("symbol"),f=i.get("symbolSize");function g(t,e,i){var n=t.getItemModel(e);SO(t,e,i,r,o),t.setItemVisual(e,{symbolSize:n.get("symbolSize")||f[i?0:1],symbol:n.get("symbol",!0)||p[i?0:1],color:n.get("itemStyle.normal.color")||a.getVisual("color")})}za.isArray(p)||(p=[p,p]),"number"==typeof f&&(f=[f,f]),h.from.each(function(t){g(c,t,!0),g(u,t,!1)}),d.each(function(t){var e=d.getItemModel(t).get("lineStyle.normal.color");d.setItemVisual(t,{color:e||c.getItemVisual(t,"color")}),d.setItemLayout(t,[c.getItemLayout(t),u.getItemLayout(t)]),d.setItemVisual(t,{fromSymbolSize:c.getItemVisual(t,"symbolSize"),fromSymbol:c.getItemVisual(t,"symbol"),toSymbolSize:u.getItemVisual(t,"symbolSize"),toSymbol:u.getItemVisual(t,"symbol")})}),l.updateData(d),h.line.eachItemGraphicEl(function(t,e){t.traverse(function(t){t.dataModel=i})}),l.__keep=!0,l.group.silent=i.get("silent")||r.get("silent")}});fy.registerPreprocessor(function(t){t.markLine=t.markLine||{}});cO.extend({type:"markArea",defaultOption:{zlevel:0,z:1,tooltip:{trigger:"item"},animation:!1,label:{normal:{show:!0,position:"top"},emphasis:{show:!0,position:"top"}},itemStyle:{normal:{borderWidth:0}}}});var TO=function(t,e,i,n){var r=vO.dataTransform(t,n[0]),o=vO.dataTransform(t,n[1]),a=za.retrieve,s=r.coord,l=o.coord;s[0]=a(s[0],-1/0),s[1]=a(s[1],-1/0),l[0]=a(l[0],1/0),l[1]=a(l[1],1/0);var h=za.mergeAll([{},r,o]);return h.coord=[r.coord,o.coord],h.x0=r.x,h.y0=r.y,h.x1=o.x,h.y1=o.y,h};function CO(t){return!isNaN(t)&&!isFinite(t)}function AO(t,e,i,n){var r=1-t;return CO(e[r])&&CO(i[r])}function EO(t,e){var i=e.coord[0],n=e.coord[1];return!("cartesian2d"!==t.type||!i||!n||!AO(1,i,n)&&!AO(0,i,n))||(vO.dataFilter(t,{coord:i,x:e.x0,y:e.y0})||vO.dataFilter(t,{coord:n,x:e.x1,y:e.y1}))}function PO(t,e,i,n,r){var o,a=n.coordinateSystem,s=t.getItemModel(e),l=Uc.parsePercent(s.get(i[0]),r.getWidth()),h=Uc.parsePercent(s.get(i[1]),r.getHeight());if(isNaN(l)||isNaN(h)){if(n.getMarkerPosition)o=n.getMarkerPosition(t.getValues(i,e));else{var c=t.get(i[0],e),u=t.get(i[1],e);o=a.dataToPoint([c,u],!0)}if("cartesian2d"===a.type){var d=a.getAxis("x"),p=a.getAxis("y");c=t.get(i[0],e),u=t.get(i[1],e);CO(c)?o[0]=d.toGlobalCoord(d.getExtent()["x0"===i[0]?0:1]):CO(u)&&(o[1]=p.toGlobalCoord(p.getExtent()["y0"===i[1]?0:1]))}isNaN(l)||(o[0]=l),isNaN(h)||(o[1]=h)}else o=[l,h];return o}var LO=[["x0","y0"],["x1","y0"],["x1","y1"],["x0","y1"]];function IO(t){var e=t.itemStyle||(t.itemStyle={}),i=e.emphasis||(e.emphasis={}),n=t.label||t.label||{},r=n.normal||(n.normal={}),o={normal:1,emphasis:1};za.each(n,function(t,e){o[e]||RO(r,e)||(r[e]=t)}),i.label&&!RO(n,"emphasis")&&(n.emphasis=i.label,delete i.label)}function RO(t,e){return t.hasOwnProperty(e)}yO.extend({type:"markArea",updateLayout:function(t,e,r){e.eachSeries(function(i){var t=i.markAreaModel;if(t){var n=t.getData();n.each(function(e){var t=za.map(LO,function(t){return PO(n,e,t,i,r)});n.setItemLayout(e,t),n.getItemGraphicEl(e).setShape("points",t)})}},this)},renderSeries:function(i,a,t,n){var e=i.coordinateSystem,r=i.name,o=i.getData(),s=this.markerGroupMap,l=s.get(r)||s.set(r,{group:new pf.Group});this.group.add(l.group),l.__keep=!0;var h=function(t,i,e){var n,r;t?(n=za.map(t&&t.dimensions,function(t){var e=i.getData().getDimensionInfo(i.coordDimToDataDim(t)[0])||{};return e.name=t,e}),r=new Im(za.map(["x0","y0","x1","y1"],function(t,e){return{name:t,type:n[e%2].type}}),e)):r=new Im(n=[{name:"value",type:"float"}],e);var o=za.map(e.get("data"),za.curry(TO,i,t,e));t&&(o=za.filter(o,za.curry(EO,t)));var a=t?function(t,e,i,n){return t.coord[Math.floor(n/2)][n%2]}:function(t){return t.value};return r.initData(o,null,a),r.hasItemOption=!0,r}(e,i,a);a.setData(h),h.each(function(e){h.setItemLayout(e,za.map(LO,function(t){return PO(h,e,t,i,n)})),h.setItemVisual(e,{color:o.getVisual("color")})}),h.diff(l.__data).add(function(t){var e=new pf.Polygon({shape:{points:h.getItemLayout(t)}});h.setItemGraphicEl(t,e),l.group.add(e)}).update(function(t,e){var i=l.__data.getItemGraphicEl(e);pf.updateProps(i,{shape:{points:h.getItemLayout(t)}},a,t),l.group.add(i),h.setItemGraphicEl(t,i)}).remove(function(t){var e=l.__data.getItemGraphicEl(t);l.group.remove(e)}).execute(),h.eachItemGraphicEl(function(t,e){var i=h.getItemModel(e),n=i.getModel("label.normal"),r=i.getModel("label.emphasis"),o=h.getItemVisual(e,"color");t.useStyle(za.defaults(i.getModel("itemStyle.normal").getItemStyle(),{fill:Ns.modifyAlpha(o,.4),stroke:o})),t.hoverStyle=i.getModel("itemStyle.emphasis").getItemStyle(),pf.setLabelStyle(t.style,t.hoverStyle,n,r,{labelFetcher:a,labelDataIndex:e,defaultText:h.getName(e)||"",isRectText:!0,autoColor:o}),pf.setHoverStyle(t,{}),t.dataModel=a}),l.__data=h,l.group.silent=a.get("silent")||i.get("silent")}}),fy.registerPreprocessor(function(t){t.markArea=t.markArea||{}});var DO=function(t){var e=t&&t.timeline;za.isArray(e)||(e=e?[e]:[]),za.each(e,function(t){t&&function(t){var e=t.type,i={number:"value",time:"time"};if(i[e]&&(t.axisType=i[e],delete t.type),IO(t),RO(t,"controlPosition")){var n=t.controlStyle||(t.controlStyle={});RO(n,"position")||(n.position=t.controlPosition),"none"!==n.position||RO(n,"show")||(n.show=!1,delete n.position),delete t.controlPosition}za.each(t.data||[],function(t){za.isObject(t)&&!za.isArray(t)&&(!RO(t,"value")&&RO(t,"name")&&(t.value=t.name),IO(t))})}(t)})};Yf.registerSubTypeDefaulter("timeline",function(){return"slider"}),fy.registerAction({type:"timelineChange",event:"timelineChanged",update:"prepareAndUpdate"},function(t,e){var i=e.getComponent("timeline");return i&&null!=t.currentIndex&&(i.setCurrentIndex(t.currentIndex),!i.get("loop",!0)&&i.isIndexMax()&&i.setPlayState(!1)),e.resetOption("timeline"),za.defaults({currentIndex:i.option.currentIndex},t)}),fy.registerAction({type:"timelinePlayChange",event:"timelinePlayChanged",update:"update"},function(t,e){var i=e.getComponent("timeline");i&&null!=t.playState&&i.setPlayState(t.playState)});var OO=Yf.extend({type:"timeline",layoutMode:"box",defaultOption:{zlevel:0,z:4,show:!0,axisType:"time",realtime:!0,left:"20%",top:null,right:"20%",bottom:0,width:null,height:40,padding:5,controlPosition:"left",autoPlay:!1,rewind:!1,loop:!0,playInterval:2e3,currentIndex:0,itemStyle:{normal:{},emphasis:{}},label:{normal:{color:"#000"},emphasis:{}},data:[]},init:function(t,e,i){this._data,this._names,this.mergeDefaultAndTheme(t,i),this._initData()},mergeOption:function(t){OO.superApply(this,"mergeOption",arguments),this._initData()},setCurrentIndex:function(t){null==t&&(t=this.option.currentIndex);var e=this._data.count();this.option.loop?t=(t%e+e)%e:(e<=t&&(t=e-1),t<0&&(t=0)),this.option.currentIndex=t},getCurrentIndex:function(){return this.option.currentIndex},isIndexMax:function(){return this.getCurrentIndex()>=this._data.count()-1},setPlayState:function(t){this.option.autoPlay=!!t},getPlayState:function(){return!!this.option.autoPlay},_initData:function(){var t=this.option,e=t.data||[],i=t.axisType,r=this._names=[];if("category"===i){var o=[];za.each(e,function(t,e){var i,n=If.getDataItemValue(t);za.isObject(t)?(i=za.clone(t)).value=e:i=e,o.push(i),za.isString(n)||null!=n&&!isNaN(n)||(n=""),r.push(n+"")}),e=o}var n={category:"ordinal",time:"time"}[i]||"number";(this._data=new Im([{name:"value",type:n}],this)).initData(e,r)},getData:function(){return this._data},getCategories:function(){if("category"===this.get("axisType"))return this._names.slice()}}),kO=OO.extend({type:"timeline.slider",defaultOption:{backgroundColor:"rgba(0,0,0,0)",borderColor:"#ccc",borderWidth:0,orient:"horizontal",inverse:!1,tooltip:{trigger:"item"},symbol:"emptyCircle",symbolSize:10,lineStyle:{show:!0,width:2,color:"#304654"},label:{position:"auto",normal:{show:!0,interval:"auto",rotate:0,color:"#304654"},emphasis:{show:!0,color:"#c23531"}},itemStyle:{normal:{color:"#304654",borderWidth:1},emphasis:{color:"#c23531"}},checkpointStyle:{symbol:"circle",symbolSize:13,color:"#c23531",borderWidth:5,borderColor:"rgba(194,53,49, 0.5)",animation:!0,animationDuration:300,animationEasing:"quinticInOut"},controlStyle:{show:!0,showPlayBtn:!0,showPrevBtn:!0,showNextBtn:!0,itemSize:22,itemGap:12,position:"left",playIcon:"path://M31.6,53C17.5,53,6,41.5,6,27.4S17.5,1.8,31.6,1.8C45.7,1.8,57.2,13.3,57.2,27.4S45.7,53,31.6,53z M31.6,3.3 C18.4,3.3,7.5,14.1,7.5,27.4c0,13.3,10.8,24.1,24.1,24.1C44.9,51.5,55.7,40.7,55.7,27.4C55.7,14.1,44.9,3.3,31.6,3.3z M24.9,21.3 c0-2.2,1.6-3.1,3.5-2l10.5,6.1c1.899,1.1,1.899,2.9,0,4l-10.5,6.1c-1.9,1.1-3.5,0.2-3.5-2V21.3z",stopIcon:"path://M30.9,53.2C16.8,53.2,5.3,41.7,5.3,27.6S16.8,2,30.9,2C45,2,56.4,13.5,56.4,27.6S45,53.2,30.9,53.2z M30.9,3.5C17.6,3.5,6.8,14.4,6.8,27.6c0,13.3,10.8,24.1,24.101,24.1C44.2,51.7,55,40.9,55,27.6C54.9,14.4,44.1,3.5,30.9,3.5z M36.9,35.8c0,0.601-0.4,1-0.9,1h-1.3c-0.5,0-0.9-0.399-0.9-1V19.5c0-0.6,0.4-1,0.9-1H36c0.5,0,0.9,0.4,0.9,1V35.8z M27.8,35.8 c0,0.601-0.4,1-0.9,1h-1.3c-0.5,0-0.9-0.399-0.9-1V19.5c0-0.6,0.4-1,0.9-1H27c0.5,0,0.9,0.4,0.9,1L27.8,35.8L27.8,35.8z",nextIcon:"path://M18.6,50.8l22.5-22.5c0.2-0.2,0.3-0.4,0.3-0.7c0-0.3-0.1-0.5-0.3-0.7L18.7,4.4c-0.1-0.1-0.2-0.3-0.2-0.5 c0-0.4,0.3-0.8,0.8-0.8c0.2,0,0.5,0.1,0.6,0.3l23.5,23.5l0,0c0.2,0.2,0.3,0.4,0.3,0.7c0,0.3-0.1,0.5-0.3,0.7l-0.1,0.1L19.7,52 c-0.1,0.1-0.3,0.2-0.5,0.2c-0.4,0-0.8-0.3-0.8-0.8C18.4,51.2,18.5,51,18.6,50.8z",prevIcon:"path://M43,52.8L20.4,30.3c-0.2-0.2-0.3-0.4-0.3-0.7c0-0.3,0.1-0.5,0.3-0.7L42.9,6.4c0.1-0.1,0.2-0.3,0.2-0.5 c0-0.4-0.3-0.8-0.8-0.8c-0.2,0-0.5,0.1-0.6,0.3L18.3,28.8l0,0c-0.2,0.2-0.3,0.4-0.3,0.7c0,0.3,0.1,0.5,0.3,0.7l0.1,0.1L41.9,54 c0.1,0.1,0.3,0.2,0.5,0.2c0.4,0,0.8-0.3,0.8-0.8C43.2,53.2,43.1,53,43,52.8z",normal:{color:"#304654",borderColor:"#304654",borderWidth:1},emphasis:{color:"#c23531",borderColor:"#c23531",borderWidth:2}},data:[]}});za.mixin(kO,If.dataFormatMixin);var zO=em.extend({type:"timeline"}),NO=function(t,e,i,n){Wv.call(this,t,e,i),this.type=n||"value",this._autoLabelInterval,this.model=null};NO.prototype={constructor:NO,getLabelInterval:function(){var t,e=this.model,i=e.getModel("label.normal");return null!=(t=i.get("interval"))&&"auto"!=t||(t=this._autoLabelInterval)||(t=this._autoLabelInterval=Cv.getAxisLabelInterval(za.map(this.scale.getTicks(),this.dataToCoord,this),Cv.getFormattedLabels(this,i.get("formatter")),i.getFont(),"horizontal"===e.get("orient")?0:90,i.get("rotate"))),t},isLabelIgnored:function(t){if("category"===this.type){var e=this.getLabelInterval();return"function"==typeof e&&!e(t,this.scale.getLabel(t))||t%(e+1)}}},za.inherits(NO,Wv);var BO=NO,FO=Bv.createSymbol,GO=Yc.encodeHTML,VO=za.bind,HO=za.each,UO=Math.PI;zO.extend({type:"timeline.slider",init:function(t,e){this.api=e,this._axis,this._viewRect,this._timer,this._currentPointer,this._mainGroup,this._labelGroup},render:function(e,t,i,n){if(this.model=e,this.api=i,this.ecModel=t,this.group.removeAll(),e.get("show",!0)){var r=this._layout(e,i),o=this._createGroup("mainGroup"),a=this._createGroup("labelGroup"),s=this._axis=this._createAxis(r,e);e.formatTooltip=function(t){return GO(s.scale.getLabel(t))},HO(["AxisLine","AxisTick","Control","CurrentPointer"],function(t){this["_render"+t](r,o,s,e)},this),this._renderAxisLabel(r,a,s,e),this._position(r,e)}this._doPlayStop()},remove:function(){this._clearTimer(),this.group.removeAll()},dispose:function(){this._clearTimer()},_layout:function(t,e){var i,n,r=t.get("label.normal.position"),o=t.get("orient"),a=(i=t,n=e,jf.getLayoutRect(i.getBoxLayoutParams(),{width:n.getWidth(),height:n.getHeight()},i.get("padding")));null==r||"auto"===r?r="horizontal"===o?a.y+a.height/2<e.getHeight()/2?"-":"+":a.x+a.width/2<e.getWidth()/2?"+":"-":isNaN(r)&&(r={horizontal:{top:"-",bottom:"+"},vertical:{left:"-",right:"+"}}[o][r]);var s,l,h,c,u={horizontal:"center",vertical:0<=r||"+"===r?"left":"right"},d={horizontal:0<=r||"+"===r?"top":"bottom",vertical:"middle"},p={horizontal:0,vertical:UO/2},f="vertical"===o?a.height:a.width,g=t.getModel("controlStyle"),m=(x=g.get("show"))?g.get("itemSize"):0,v=x?g.get("itemGap"):0,y=m+v,_=t.get("label.normal.rotate")||0;_=_*UO/180;var x,w=g.get("position",!0),b=(x=g.get("show",!0))&&g.get("showPlayBtn",!0),M=x&&g.get("showPrevBtn",!0),S=x&&g.get("showNextBtn",!0),T=0,C=f;return"left"===w||"bottom"===w?(b&&(s=[0,0],T+=y),M&&(l=[T,0],T+=y)):(b&&(s=[C-m,0],C-=y),M&&(l=[0,0],T+=y)),S&&(h=[C-m,0],C-=y),c=[T,C],t.get("inverse")&&c.reverse(),{viewRect:a,mainLength:f,orient:o,rotation:p[o],labelRotation:_,labelPosOpt:r,labelAlign:t.get("label.normal.align")||u[o],labelBaseline:t.get("label.normal.verticalAlign")||t.get("label.normal.baseline")||d[o],playPosition:s,prevBtnPosition:l,nextBtnPosition:h,axisExtent:c,controlSize:m,controlGap:v}},_position:function(t,e){var i=this._mainGroup,n=this._labelGroup,r=t.viewRect;if("vertical"===t.orient){var o=ns.create(),a=r.x,s=r.y+r.height;ns.translate(o,o,[-a,-s]),ns.rotate(o,o,-UO/2),ns.translate(o,o,[a,s]),(r=r.clone()).applyTransform(o)}var l=m(r),h=m(i.getBoundingRect()),c=m(n.getBoundingRect()),u=i.position,d=n.position;d[0]=u[0]=l[0][0];var p,f=t.labelPosOpt;isNaN(f)?(v(u,h,l,1,p="+"===f?0:1),v(d,c,l,1,1-p)):(v(u,h,l,1,p=0<=f?0:1),d[1]=u[1]+f);function g(t){var e=t.position;t.origin=[l[0][0]-e[0],l[1][0]-e[1]]}function m(t){return[[t.x,t.x+t.width],[t.y,t.y+t.height]]}function v(t,e,i,n,r){t[n]+=i[n][r]-e[n][r]}i.attr("position",u),n.attr("position",d),i.rotation=n.rotation=t.rotation,g(i),g(n)},_createAxis:function(t,e){var i=e.getData(),n=e.get("axisType"),r=Cv.createScaleByModel(e,n),o=i.getDataExtent("value");r.setExtent(o[0],o[1]),this._customizeScale(r,i),r.niceTicks();var a=new BO("value",r,t.axisExtent,n);return a.model=e,a},_customizeScale:function(t,e){t.getTicks=function(){return e.mapArray(["value"],function(t){return t})},t.getTicksLabels=function(){return za.map(this.getTicks(),t.getLabel,t)}},_createGroup:function(t){var e=this["_"+t]=new pf.Group;return this.group.add(e),e},_renderAxisLine:function(t,e,i,n){var r=i.getExtent();n.get("lineStyle.show")&&e.add(new pf.Line({shape:{x1:r[0],y1:0,x2:r[1],y2:0},style:za.extend({lineCap:"round"},n.getModel("lineStyle").getLineStyle()),silent:!0,z2:1}))},_renderAxisTick:function(t,l,h,c){var u=c.getData(),e=h.scale.getTicks();HO(e,function(t,e){var i=h.dataToCoord(t),n=u.getItemModel(e),r=n.getModel("itemStyle.normal"),o=n.getModel("itemStyle.emphasis"),a={position:[i,0],onclick:VO(this._changeTimeline,this,e)},s=WO(n,r,l,a);pf.setHoverStyle(s,o.getItemStyle()),n.get("tooltip")?(s.dataIndex=e,s.dataModel=c):s.dataIndex=s.dataModel=null},this)},_renderAxisLabel:function(s,l,h,t){var e=t.getModel("label.normal");if(e.get("show")){var c=t.getData(),i=h.scale.getTicks(),u=Cv.getFormattedLabels(h,e.get("formatter")),d=h.getLabelInterval();HO(i,function(t,e){if(!h.isLabelIgnored(e,d)){var i=c.getItemModel(e),n=i.getModel("label.normal"),r=i.getModel("label.emphasis"),o=h.dataToCoord(t),a=new pf.Text({position:[o,0],rotation:s.labelRotation-s.rotation,onclick:VO(this._changeTimeline,this,e),silent:!1});pf.setTextStyle(a.style,n,{text:u[e],textAlign:s.labelAlign,textVerticalAlign:s.labelBaseline}),l.add(a),pf.setHoverStyle(a,pf.setTextStyle({},r))}},this)}},_renderControl:function(t,h,e,c){var u=t.controlSize,d=t.rotation,p=c.getModel("controlStyle.normal").getItemStyle(),f=c.getModel("controlStyle.emphasis").getItemStyle(),g=[0,-u/2,u,u],i=c.getPlayState(),n=c.get("inverse",!0);function r(t,e,i,n){if(t){var r,o,a,s,l=(r=c,o=e,a=g,s={position:t,origin:[u/2,0],rotation:n?-d:0,rectHover:!0,style:p,onclick:i},pf.makePath(r.get(o).replace(/^path:\/\//,""),za.clone(s||{}),new bl(a[0],a[1],a[2],a[3]),"center"));h.add(l),pf.setHoverStyle(l,f)}}r(t.nextBtnPosition,"controlStyle.nextIcon",VO(this._changeTimeline,this,n?"-":"+")),r(t.prevBtnPosition,"controlStyle.prevIcon",VO(this._changeTimeline,this,n?"+":"-")),r(t.playPosition,"controlStyle."+(i?"stopIcon":"playIcon"),VO(this._handlePlayClick,this,!i),!0)},_renderCurrentPointer:function(t,e,i,n){var r=n.getData(),o=n.getCurrentIndex(),a=r.getItemModel(o).getModel("checkpointStyle"),s=this,l={onCreate:function(t){t.draggable=!0,t.drift=VO(s._handlePointerDrag,s),t.ondragend=VO(s._handlePointerDragend,s),jO(t,o,i,n,!0)},onUpdate:function(t){jO(t,o,i,n)}};this._currentPointer=WO(a,a,this._mainGroup,{},this._currentPointer,l)},_handlePlayClick:function(t){this._clearTimer(),this.api.dispatchAction({type:"timelinePlayChange",playState:t,from:this.uid})},_handlePointerDrag:function(t,e,i){this._clearTimer(),this._pointerChangeTimeline([i.offsetX,i.offsetY])},_handlePointerDragend:function(t){this._pointerChangeTimeline([t.offsetX,t.offsetY],!0)},_pointerChangeTimeline:function(t,e){var i=this._toAxisCoord(t)[0],n=this._axis,r=Uc.asc(n.getExtent().slice());i>r[1]&&(i=r[1]),i<r[0]&&(i=r[0]),this._currentPointer.position[0]=i,this._currentPointer.dirty();var o=this._findNearestTick(i),a=this.model;(e||o!==a.getCurrentIndex()&&a.get("realtime"))&&this._changeTimeline(o)},_doPlayStop:function(){this._clearTimer(),this.model.getPlayState()&&(this._timer=setTimeout(VO(function(){var t=this.model;this._changeTimeline(t.getCurrentIndex()+(t.get("rewind",!0)?-1:1))},this),this.model.get("playInterval")))},_toAxisCoord:function(t){var e=this._mainGroup.getLocalTransform();return pf.applyTransform(t,e,!0)},_findNearestTick:function(r){var o,t=this.model.getData(),a=1/0,s=this._axis;return t.each(["value"],function(t,e){var i=s.dataToCoord(t),n=Math.abs(i-r);n<a&&(a=n,o=e)}),o},_clearTimer:function(){this._timer&&(clearTimeout(this._timer),this._timer=null)},_changeTimeline:function(t){var e=this.model.getCurrentIndex();"+"===t?t=e+1:"-"===t&&(t=e-1),this.api.dispatchAction({type:"timelineChange",currentIndex:t,from:this.uid})}});function WO(t,e,i,n,r,o){var a=e.get("color");if(r)r.setColor(a),i.add(r),o&&o.onUpdate(r);else{var s=t.get("symbol");(r=FO(s,-1,-1,2,2,a)).setStyle("strokeNoScale",!0),i.add(r),o&&o.onCreate(r)}var l=e.getItemStyle(["color","symbol","symbolSize"]);r.setStyle(l),n=za.merge({rectHover:!0,z2:100},n,!0);var h=t.get("symbolSize");(h=h instanceof Array?h.slice():[+h,+h])[0]/=2,h[1]/=2,n.scale=h;var c=t.get("symbolOffset");if(c){var u=n.position=n.position||[0,0];u[0]+=Uc.parsePercent(c[0],h[0]),u[1]+=Uc.parsePercent(c[1],h[1])}var d=t.get("symbolRotate");return n.rotation=(d||0)*Math.PI/180||0,r.attr(n),r.updateTransform(),r}function jO(t,e,i,n,r){if(!t.dragging){var o=n.getModel("checkpointStyle"),a=i.dataToCoord(n.getData().get(["value"],e));r||!o.get("animation",!0)?t.attr({position:[a,0]}):(t.stopAnimation(!0),t.animateTo({position:[a,0]},o.get("animationDuration",!0),o.get("animationEasing",!0)))}}fy.registerPreprocessor(DO);var ZO=fy.extendComponentModel({type:"toolbox",layoutMode:{type:"box",ignoreSize:!0},mergeDefaultAndTheme:function(t){ZO.superApply(this,"mergeDefaultAndTheme",arguments),za.each(this.option.feature,function(t,e){var i=TR.get(e);i&&za.merge(t,i.defaultOption)})},defaultOption:{show:!0,z:6,zlevel:0,orient:"horizontal",left:"right",top:"top",backgroundColor:"transparent",borderColor:"#ccc",borderRadius:0,borderWidth:0,padding:5,itemSize:15,itemGap:8,showTitle:!0,iconStyle:{normal:{borderColor:"#666",color:"none"},emphasis:{borderColor:"#3E98C5"}}}});fy.extendComponentView({type:"toolbox",render:function(h,c,u,l){var d=this.group;if(d.removeAll(),h.get("show")){var p=+h.get("itemSize"),f=h.get("feature")||{},g=this._features||(this._features={}),m=[];za.each(f,function(t,e){m.push(e)}),new ym(this._featureNames||[],m).add(t).update(t).remove(za.curry(t,null)).execute(),this._featureNames=m,LL.layout(d,h,u),d.add(LL.makeBackground(d.getBoundingRect(),h)),d.eachChild(function(t){var e=t.__title,i=t.hoverStyle;if(i&&e){var n=Sh.getBoundingRect(e,Sh.makeFont(i)),r=t.position[0]+d.position[0],o=!1;t.position[1]+d.position[1]+p+n.height>u.getHeight()&&(i.textPosition="top",o=!0);var a=o?-5-n.height:p+8;r+n.width/2>u.getWidth()?(i.textPosition=["100%",a],i.textAlign="right"):r-n.width/2<0&&(i.textPosition=[0,a],i.textAlign="left")}})}function t(t,e){var i,n=m[t],r=m[e],o=f[n],a=new bf(o,h,h.ecModel);if(n&&!r){if(0===n.indexOf("my"))i={model:a,onclick:a.option.onclick,featureName:n};else{var s=TR.get(n);if(!s)return;i=new s(a,c,u)}g[n]=i}else{if(!(i=g[r]))return;i.model=a,i.ecModel=c,i.api=u}n||!r?a.get("show")&&!i.unusable?(!function(n,r,t){var o=n.getModel("iconStyle"),e=r.getIcons?r.getIcons():n.get("icon"),a=n.get("title")||{};if("string"==typeof e){var i=e,s=a;a={},(e={})[t]=i,a[t]=s}var l=n.iconPaths={};za.each(e,function(t,e){var i=pf.createIcon(t,{},{x:-p/2,y:-p/2,width:p,height:p});i.setStyle(o.getModel("normal").getItemStyle()),i.hoverStyle=o.getModel("emphasis").getItemStyle(),pf.setHoverStyle(i),h.get("showTitle")&&(i.__title=a[e],i.on("mouseover",function(){var t=o.getModel("emphasis").getItemStyle();i.setStyle({text:a[e],textPosition:t.textPosition||"bottom",textFill:t.fill||t.stroke||"#000",textAlign:t.textAlign||"center"})}).on("mouseout",function(){i.setStyle({textFill:null})})),i.trigger(n.get("iconStatus."+e)||"normal"),d.add(i),i.on("click",za.bind(r.onclick,r,c,u,e)),l[e]=i})}(a,i,n),a.setIconStatus=function(t,e){var i=this.option,n=this.iconPaths;i.iconStatus=i.iconStatus||{},i.iconStatus[t]=e,n[t]&&n[t].trigger(e)},i.render&&i.render(a,c,u,l)):i.remove&&i.remove(c,u):i.dispose&&i.dispose(c,u)}},updateView:function(t,e,i,n){za.each(this._features,function(t){t.updateView&&t.updateView(t.model,e,i,n)})},updateLayout:function(t,e,i,n){za.each(this._features,function(t){t.updateLayout&&t.updateLayout(t.model,e,i,n)})},remove:function(e,i){za.each(this._features,function(t){t.remove&&t.remove(e,i)}),this.group.removeAll()},dispose:function(e,i){za.each(this._features,function(t){t.dispose&&t.dispose(e,i)})}});var XO=CR.toolbox.saveAsImage;function qO(t){this.model=t}qO.defaultOption={show:!0,icon:"M4.7,22.9L29.3,45.5L54.7,23.4M4.6,43.6L4.6,58L53.8,58L53.8,43.6M29.2,45.1L29.2,0",title:XO.title,type:"png",name:"",excludeComponents:["toolbox"],pixelRatio:1,lang:XO.lang.slice()},qO.prototype.unusable=!ca.canvasSupported,qO.prototype.onclick=function(t,e){var i=this.model,n=i.get("name")||t.get("title.0.text")||"echarts",r=document.createElement("a"),o=i.get("type",!0)||"png";r.download=n+"."+o,r.target="_blank";var a=e.getConnectedDataURL({type:o,backgroundColor:i.get("backgroundColor",!0)||t.get("backgroundColor")||"#fff",excludeComponents:i.get("excludeComponents"),pixelRatio:i.get("pixelRatio")});if(r.href=a,"function"!=typeof MouseEvent||ca.browser.ie||ca.browser.edge)if(window.navigator.msSaveOrOpenBlob){for(var s=atob(a.split(",")[1]),l=s.length,h=new Uint8Array(l);l--;)h[l]=s.charCodeAt(l);var c=new Blob([h]);window.navigator.msSaveOrOpenBlob(c,n+"."+o)}else{var u=i.get("lang"),d='<body style="margin:0;"><img src="'+a+'" style="max-width:100%;" title="'+(u&&u[0]||"")+'" /></body>';window.open().document.write(d)}else{var p=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!1});r.dispatchEvent(p)}},TR.register("saveAsImage",qO);var YO=CR.toolbox.magicType;function JO(t){this.model=t}JO.defaultOption={show:!0,type:[],icon:{line:"M4.1,28.9h7.1l9.3-22l7.4,38l9.7-19.7l3,12.8h14.9M4.1,58h51.4",bar:"M6.7,22.9h10V48h-10V22.9zM24.9,13h10v35h-10V13zM43.2,2h10v46h-10V2zM3.1,58h53.7",stack:"M8.2,38.4l-8.4,4.1l30.6,15.3L60,42.5l-8.1-4.1l-21.5,11L8.2,38.4z M51.9,30l-8.1,4.2l-13.4,6.9l-13.9-6.9L8.2,30l-8.4,4.2l8.4,4.2l22.2,11l21.5-11l8.1-4.2L51.9,30z M51.9,21.7l-8.1,4.2L35.7,30l-5.3,2.8L24.9,30l-8.4-4.1l-8.3-4.2l-8.4,4.2L8.2,30l8.3,4.2l13.9,6.9l13.4-6.9l8.1-4.2l8.1-4.1L51.9,21.7zM30.4,2.2L-0.2,17.5l8.4,4.1l8.3,4.2l8.4,4.2l5.5,2.7l5.3-2.7l8.1-4.2l8.1-4.2l8.1-4.1L30.4,2.2z",tiled:"M2.3,2.2h22.8V25H2.3V2.2z M35,2.2h22.8V25H35V2.2zM2.3,35h22.8v22.8H2.3V35z M35,35h22.8v22.8H35V35z"},title:za.clone(YO.title),option:{},seriesIndex:{}};var KO=JO.prototype;KO.getIcons=function(){var t=this.model,e=t.get("icon"),i={};return za.each(t.get("type"),function(t){e[t]&&(i[t]=e[t])}),i};var QO={line:function(t,e,i,n){if("bar"===t)return za.merge({id:e,type:"line",data:i.get("data"),stack:i.get("stack"),markPoint:i.get("markPoint"),markLine:i.get("markLine")},n.get("option.line")||{},!0)},bar:function(t,e,i,n){if("line"===t)return za.merge({id:e,type:"bar",data:i.get("data"),stack:i.get("stack"),markPoint:i.get("markPoint"),markLine:i.get("markLine")},n.get("option.bar")||{},!0)},stack:function(t,e,i,n){if("line"===t||"bar"===t)return za.merge({id:e,stack:"__ec_magicType_stack__"},n.get("option.stack")||{},!0)},tiled:function(t,e,i,n){if("line"===t||"bar"===t)return za.merge({id:e,stack:""},n.get("option.tiled")||{},!0)}},$O=[["line","bar"],["stack","tiled"]];KO.onclick=function(h,t,c){var u=this.model,e=u.get("seriesIndex."+c);if(QO[c]){var d={series:[]};za.each($O,function(t){0<=za.indexOf(t,c)&&za.each(t,function(t){u.setIconStatus(t,"normal")})}),u.setIconStatus(c,"emphasis"),h.eachComponent({mainType:"series",query:null==e?null:{seriesIndex:e}},function(t){var e=t.subType,i=t.id,n=QO[c](e,i,t,u);n&&(za.defaults(n,t.option),d.series.push(n));var r=t.coordinateSystem;if(r&&"cartesian2d"===r.type&&("line"===c||"bar"===c)){var o=r.getAxesByScale("ordinal")[0];if(o){var a=o.dim+"Axis",s=h.queryComponents({mainType:a,index:t.get(name+"Index"),id:t.get(name+"Id")})[0].componentIndex;d[a]=d[a]||[];for(var l=0;l<=s;l++)d[a][s]=d[a][s]||{};d[a][s].boundaryGap="bar"===c}}}),t.dispatchAction({type:"changeMagicType",currentType:c,newOption:d})}},fy.registerAction({type:"changeMagicType",event:"magicTypeChanged",update:"prepareAndUpdate"},function(t,e){e.mergeOption(t.newOption)}),TR.register("magicType",JO);var tk=CR.toolbox.dataView,ek=new Array(60).join("-"),ik="\t";function nk(t){var r,o,a,e,i,c,n=(r={},o=[],a=[],t.eachRawSeries(function(t){var e=t.coordinateSystem;if(!e||"cartesian2d"!==e.type&&"polar"!==e.type)o.push(t);else{var i=e.getBaseAxis();if("category"===i.type){var n=i.dim+"_"+i.index;r[n]||(r[n]={categoryAxis:i,valueAxis:e.getOtherAxis(i),series:[]},a.push({axisDim:i.dim,axisIndex:i.index})),r[n].series.push(t)}else o.push(t)}}),{seriesGroupByCategoryAxis:r,other:o,meta:a});return{value:za.filter([(i=n.seriesGroupByCategoryAxis,c=[],za.each(i,function(t,e){var i=t.categoryAxis,n=t.valueAxis.dim,r=[" "].concat(za.map(t.series,function(t){return t.name})),o=[i.model.getCategories()];za.each(t.series,function(t){o.push(t.getRawData().mapArray(n,function(t){return t}))});for(var a=[r.join(ik)],s=0;s<o[0].length;s++){for(var l=[],h=0;h<o.length;h++)l.push(o[h][s]);a.push(l.join(ik))}c.push(a.join("\n"))}),c.join("\n\n"+ek+"\n\n")),(e=n.other,za.map(e,function(t){var r=t.getRawData(),o=[t.name],a=[];return r.each(r.dimensions,function(){for(var t=arguments.length,e=arguments[t-1],i=r.getName(e),n=0;n<t-1;n++)a[n]=arguments[n];o.push((i?i+ik:"")+a.join(ik))}),o.join("\n")}).join("\n\n"+ek+"\n\n"))],function(t){return t.replace(/[\n\t\s]/g,"")}).join("\n\n"+ek+"\n\n"),meta:n.meta}}function rk(t){return t.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}var ok=new RegExp("["+ik+"]+","g");function ak(t,o){var e=t.split(new RegExp("\n*"+ek+"\n*","g")),a={series:[]};return za.each(e,function(t,e){if(function(t){if(0<=t.slice(0,t.indexOf("\n")).indexOf(ik))return!0}(t)){var i=function(t){for(var e=t.split(/\n+/g),i=rk(e.shift()).split(ok),n=[],r=za.map(i,function(t){return{name:t,data:[]}}),o=0;o<e.length;o++){var a=rk(e[o]).split(ok);n.push(a.shift());for(var s=0;s<a.length;s++)r[s]&&(r[s].data[o]=a[s])}return{series:r,categories:n}}(t),n=o[e],r=n.axisDim+"Axis";n&&(a[r]=a[r]||[],a[r][n.axisIndex]={data:i.categories},a.series=a.series.concat(i.series))}else{i=function(t){for(var e=t.split(/\n+/g),i=rk(e.shift()),n=[],r=0;r<e.length;r++){var o,a=rk(e[r]).split(ok),s="",l=!1;isNaN(a[0])?(l=!0,s=a[0],a=a.slice(1),n[r]={name:s,value:[]},o=n[r].value):o=n[r]=[];for(var h=0;h<a.length;h++)o.push(+a[h]);1===o.length&&(l?n[r].value=o[0]:n[r]=o[0])}return{name:i,data:n}}(t);a.series.push(i)}}),a}function sk(t){this._dom=null,this.model=t}sk.defaultOption={show:!0,readOnly:!1,optionToContent:null,contentToOption:null,icon:"M17.5,17.3H33 M17.5,17.3H33 M45.4,29.5h-28 M11.5,2v56H51V14.8L38.4,2H11.5z M38.4,2.2v12.7H51 M45.4,41.7h-28",title:za.clone(tk.title),lang:za.clone(tk.lang),backgroundColor:"#fff",textColor:"#000",textareaColor:"#fff",textareaBorderColor:"#333",buttonColor:"#c23531",buttonTextColor:"#fff"},sk.prototype.onclick=function(t,e){var i=e.getDom(),n=this.model;this._dom&&i.removeChild(this._dom);var r=document.createElement("div");r.style.cssText="position:absolute;left:5px;top:5px;bottom:5px;right:5px;",r.style.backgroundColor=n.get("backgroundColor")||"#fff";var o=document.createElement("h4"),a=n.get("lang")||[];o.innerHTML=a[0]||n.get("title"),o.style.cssText="margin: 10px 20px;",o.style.color=n.get("textColor");var s=document.createElement("div"),l=document.createElement("textarea");s.style.cssText="display:block;width:100%;overflow:auto;";var h=n.get("optionToContent"),c=n.get("contentToOption"),u=nk(t);if("function"==typeof h){var d=h(e.getOption());"string"==typeof d?s.innerHTML=d:za.isDom(d)&&s.appendChild(d)}else s.appendChild(l),l.readOnly=n.get("readOnly"),l.style.cssText="width:100%;height:100%;font-family:monospace;font-size:14px;line-height:1.6rem;",l.style.color=n.get("textColor"),l.style.borderColor=n.get("textareaBorderColor"),l.style.backgroundColor=n.get("textareaColor"),l.value=u.value;var p=u.meta,f=document.createElement("div");f.style.cssText="position:absolute;bottom:0;left:0;right:0;";var g="float:right;margin-right:20px;border:none;cursor:pointer;padding:2px 5px;font-size:12px;border-radius:3px",m=document.createElement("div"),v=document.createElement("div");g+=";background-color:"+n.get("buttonColor"),g+=";color:"+n.get("buttonTextColor");var y=this;function _(){i.removeChild(r),y._dom=null}pc.addEventListener(m,"click",_),pc.addEventListener(v,"click",function(){var t;try{t="function"==typeof c?c(s,e.getOption()):ak(l.value,p)}catch(t){throw _(),new Error("Data view format error "+t)}t&&e.dispatchAction({type:"changeDataView",newOption:t}),_()}),m.innerHTML=a[1],v.innerHTML=a[2],v.style.cssText=g,m.style.cssText=g,!n.get("readOnly")&&f.appendChild(v),f.appendChild(m),pc.addEventListener(l,"keydown",function(t){if(9===(t.keyCode||t.which)){var e=this.value,i=this.selectionStart,n=this.selectionEnd;this.value=e.substring(0,i)+ik+e.substring(n),this.selectionStart=this.selectionEnd=i+1,pc.stop(t)}}),r.appendChild(o),r.appendChild(s),r.appendChild(f),s.style.height=i.clientHeight-80+"px",i.appendChild(r),this._dom=r},sk.prototype.remove=function(t,e){this._dom&&e.getDom().removeChild(this._dom)},sk.prototype.dispose=function(t,e){this.remove(t,e)},TR.register("dataView",sk),fy.registerAction({type:"changeDataView",event:"dataViewChanged",update:"prepareAndUpdate"},function(t,o){var a=[];za.each(t.newOption.series,function(t){var e,n,i=o.getSeriesByName(t.name)[0];if(i){var r=i.get("data");a.push({name:t.name,data:(e=t.data,n=r,za.map(e,function(t,e){var i=n&&n[e];return za.isObject(i)&&!za.isArray(i)?(za.isObject(t)&&!za.isArray(t)&&(t=t.value),za.defaults({value:t},i)):t}))})}else a.push(za.extend({type:"scatter"},t))}),o.mergeOption(za.defaults({series:a},t.newOption))});var lk=za.each,hk="\0_ec_hist_store";function ck(t){var e=t[hk];return e||(e=t[hk]=[{}]),e}var uk={push:function(o,t){var a=ck(o);lk(t,function(t,e){for(var i=a.length-1;0<=i&&!a[i][e];i--);if(i<0){var n=o.queryComponents({mainType:"dataZoom",subType:"select",id:e})[0];if(n){var r=n.getPercentRange();a[0][e]={dataZoomId:e,start:r[0],end:r[1]}}}}),a.push(t)},pop:function(t){var n=ck(t),e=n[n.length-1];1<n.length&&n.pop();var r={};return lk(e,function(t,e){for(var i=n.length-1;0<=i;i--)if(t=n[i][e]){r[e]=t;break}}),r},clear:function(t){t[hk]=null},count:function(t){return ck(t).length}},dk=($R.extend({type:"dataZoom.select"}),tD.extend({type:"dataZoom.select"}),CR.toolbox.dataZoom),pk=za.each;function fk(t,e,i){(this._brushController=new kC(i.getZr())).on("brush",za.bind(this._onBrush,this)).mount(),this._isZoomActive}fk.defaultOption={show:!0,icon:{zoom:"M0,13.5h26.9 M13.5,26.9V0 M32.1,13.5H58V58H13.5 V32.1",back:"M22,1.4L9.9,13.5l12.3,12.3 M10.3,13.5H54.9v44.6 H10.3v-26"},title:za.clone(dk.title)};var gk=fk.prototype;gk.render=function(t,e,i,n){var r;this.model=t,this.ecModel=e,this.api=i,function(t,e,i,n,r){var o=i._isZoomActive;n&&"takeGlobalCursor"===n.type&&(o="dataZoomSelect"===n.key&&n.dataZoomSelectActive);i._isZoomActive=o,t.setIconStatus("zoom",o?"emphasis":"normal");var a=new uR(vk(t.option),e,{include:["grid"]});i._brushController.setPanels(a.makePanelOpts(r,function(t){return t.xAxisDeclared&&!t.yAxisDeclared?"lineX":!t.xAxisDeclared&&t.yAxisDeclared?"lineY":"rect"})).enableBrush(!!o&&{brushType:"auto",brushStyle:{lineWidth:0,fill:"rgba(0,0,0,0.2)"}})}(t,e,this,n,i),r=e,t.setIconStatus("back",1<uk.count(r)?"emphasis":"normal")},gk.onclick=function(t,e,i){mk[i].call(this)},gk.remove=function(t,e){this._brushController.unmount()},gk.dispose=function(t,e){this._brushController.dispose()};var mk={zoom:function(){var t=!this._isZoomActive;this.api.dispatchAction({type:"takeGlobalCursor",key:"dataZoomSelect",dataZoomSelectActive:t})},back:function(){this._dispatchZoomAction(uk.pop(this.ecModel))}};function vk(e){var i={};return za.each(["xAxisIndex","yAxisIndex"],function(t){i[t]=e[t],null==i[t]&&(i[t]="all"),(!1===i[t]||"none"===i[t])&&(i[t]=[])}),i}gk._onBrush=function(t,e){if(e.isEnd&&t.length){var c={},u=this.ecModel;this._brushController.updateCovers([]),new uR(vk(this.model.option),u,{include:["grid"]}).matchOutputRanges(t,u,function(t,e,i){if("cartesian2d"===i.type){var n=t.brushType;"rect"===n?(r("x",i,e[0]),r("y",i,e[1])):r({lineX:"x",lineY:"y"}[n],i,e)}}),uk.push(u,c),this._dispatchZoomAction(c)}function r(t,e,i){var n,r,o,a=e.getAxis(t),s=a.model,l=(n=t,r=s,u.eachComponent({mainType:"dataZoom",subType:"select"},function(t){t.getAxisModel(n,r.componentIndex)&&(o=t)}),o),h=l.findRepresentativeAxisProxy(s).getMinMaxSpan();null==h.minValueSpan&&null==h.maxValueSpan||(i=DT(0,i.slice(),a.scale.getExtent(),0,h.minValueSpan,h.maxValueSpan)),l&&(c[l.id]={dataZoomId:l.id,startValue:i[0],endValue:i[1]})}},gk._dispatchZoomAction=function(t){var i=[];pk(t,function(t,e){i.push(za.clone(t))}),i.length&&this.api.dispatchAction({type:"dataZoom",from:this.uid,batch:i})},TR.register("dataZoom",fk),fy.registerPreprocessor(function(a){if(a){var s=a.dataZoom||(a.dataZoom=[]);za.isArray(s)||(a.dataZoom=s=[s]);var t=a.toolbox;if(t&&(za.isArray(t)&&(t=t[0]),t&&t.feature)){var e=t.feature.dataZoom;i("xAxis",e),i("yAxis",e)}}function i(n,t){if(t){var r=n+"Index",o=t[r];null==o||"all"==o||za.isArray(o)||(o=!1===o||"none"===o?[]:[o]),function(t,e){var i=a[t];za.isArray(i)||(i=i?[i]:[]);pk(i,e)}(n,function(t,e){if(null==o||"all"==o||-1!==za.indexOf(o,e)){var i={type:"select",$fromToolbox:!0,id:"\0_ec_\0toolbox-dataZoom_"+n+e};i[r]=e,s.push(i)}})}}});var yk=CR.toolbox.restore;function _k(t){this.model=t}_k.defaultOption={show:!0,icon:"M3.8,33.4 M47,18.9h9.8V8.7 M56.3,20.1 C52.1,9,40.5,0.6,26.8,2.1C12.6,3.7,1.6,16.2,2.1,30.6 M13,41.1H3.1v10.2 M3.7,39.9c4.2,11.1,15.8,19.5,29.5,18 c14.2-1.6,25.2-14.1,24.7-28.5",title:yk.title},_k.prototype.onclick=function(t,e,i){uk.clear(t),e.dispatchAction({type:"restore",from:this.uid})},TR.register("restore",_k),fy.registerAction({type:"restore",event:"restore",update:"prepareAndUpdate"},function(t,e){e.resetOption("recreate")});var xk,wk="urn:schemas-microsoft-com:vml",bk="undefined"==typeof window?null:window,Mk=!1,Sk=bk&&bk.document;if(Sk&&!ca.canvasSupported)try{!Sk.namespaces.zrvml&&Sk.namespaces.add("zrvml",wk),xk=function(t){return Sk.createElement("<zrvml:"+t+' class="zrvml">')}}catch(t){xk=function(t){return Sk.createElement("<"+t+' xmlns="'+wk+'" class="zrvml">')}}var Tk={doc:Sk,createNode:function(t){return xk(t)},initVML:function(){if(!Mk&&Sk){Mk=!0;var t=Sk.styleSheets;t.length<31?Sk.createStyleSheet().addRule(".zrvml","behavior:url(#default#VML)"):t[0].addRule(".zrvml","behavior:url(#default#VML)")}}},Ck=Ha.applyTransform,Ak=Xu.CMD,Ek=Math.round,Pk=Math.sqrt,Lk=Math.abs,Ik=Math.cos,Rk=Math.sin,Dk=Math.max;if(!ca.canvasSupported){var Ok=",",kk="progid:DXImageTransform.Microsoft",zk=21600,Nk=zk/2,Bk=function(t){t.style.cssText="position:absolute;left:0;top:0;width:1px;height:1px;",t.coordsize=zk+","+zk,t.coordorigin="0,0"},Fk=function(t,e,i){return"rgb("+[t,e,i].join(",")+")"},Gk=function(t,e){e&&t&&e.parentNode!==t&&t.appendChild(e)},Vk=function(t,e){e&&t&&e.parentNode===t&&t.removeChild(e)},Hk=function(t,e,i){return 1e5*(parseFloat(t)||0)+1e3*(parseFloat(e)||0)+i},Uk=function(t,e){return"string"==typeof t?0<=t.lastIndexOf("%")?parseFloat(t)/100*e:parseFloat(t):t},Wk=function(t,e,i){var n=Ns.parse(e);i=+i,isNaN(i)&&(i=1),n&&(t.color=Fk(n[0],n[1],n[2]),t.opacity=i*n[3])},jk=function(t,e,i,n){var r,o,a="fill"==e,s=t.getElementsByTagName(e)[0];null!=i[e]&&"none"!==i[e]&&(a||!a&&i.lineWidth)?(t[a?"filled":"stroked"]="true",i[e]instanceof yp&&Vk(t,s),s||(s=Tk.createNode(e)),a?function(t,e,i){var n,r,o=e.fill;if(null!=o)if(o instanceof yp){var a,s=0,l=[0,0],h=0,c=1,u=i.getBoundingRect(),d=u.width,p=u.height;if("linear"===o.type){a="gradient";var f=i.transform,g=[o.x*d,o.y*p],m=[o.x2*d,o.y2*p];f&&(Ck(g,g,f),Ck(m,m,f));var v=m[0]-g[0],y=m[1]-g[1];(s=180*Math.atan2(v,y)/Math.PI)<0&&(s+=360),s<1e-6&&(s=0)}else{a="gradientradial",g=[o.x*d,o.y*p],f=i.transform;var _=i.scale,x=d,w=p;l=[(g[0]-u.x)/x,(g[1]-u.y)/w],f&&Ck(g,g,f),x/=_[0]*zk,w/=_[1]*zk;var b=Dk(x,w);h=0/b,c=2*o.r/b-h}var M=o.colorStops.slice();M.sort(function(t,e){return t.offset-e.offset});for(var S=M.length,T=[],C=[],A=0;A<S;A++){var E=M[A],P=(n=E.color,r=Ns.parse(n),[Fk(r[0],r[1],r[2]),r[3]]);C.push(E.offset*c+h+" "+P[0]),0!==A&&A!==S-1||T.push(P)}if(2<=S){var L=T[0][0],I=T[1][0],R=T[0][1]*e.opacity,D=T[1][1]*e.opacity;t.type=a,t.method="none",t.focus="100%",t.angle=s,t.color=L,t.color2=I,t.colors=C.join(","),t.opacity=D,t.opacity2=R}"radial"===a&&(t.focusposition=l.join(","))}else Wk(t,o,e.opacity)}(s,i,n):(r=s,null!=(o=i).lineDash&&(r.dashstyle=o.lineDash.join(" ")),null==o.stroke||o.stroke instanceof yp||Wk(r,o.stroke,o.opacity)),Gk(t,s)):(t[a?"filled":"stroked"]="false",Vk(t,s))},Zk=[[],[],[]];_d.prototype.brushVML=function(t){var e=this.style,i=this._vmlEl;i||(i=Tk.createNode("shape"),Bk(i),this._vmlEl=i),jk(i,"fill",e,this),jk(i,"stroke",e,this);var n=this.transform,r=null!=n,o=i.getElementsByTagName("stroke")[0];if(o){var a=e.lineWidth;if(r&&!e.strokeNoScale){var s=n[0]*n[3]-n[1]*n[2];a*=Pk(Lk(s))}o.weight=a+"px"}var l=this.path||(this.path=new Xu);this.__dirtyPath&&(l.beginPath(),this.buildPath(l,this.shape),l.toStatic(),this.__dirtyPath=!1),i.path=function(t,e){var i,n,r,o,a,s,l=Ak.M,h=Ak.C,c=Ak.L,u=Ak.A,d=Ak.Q,p=[],f=t.data,g=t.len();for(o=0;o<g;){switch(n="",i=0,r=f[o++]){case l:n=" m ",i=1,a=f[o++],s=f[o++],Zk[0][0]=a,Zk[0][1]=s;break;case c:n=" l ",i=1,a=f[o++],s=f[o++],Zk[0][0]=a,Zk[0][1]=s;break;case d:case h:n=" c ",i=3;var m,v,y=f[o++],_=f[o++],x=f[o++],w=f[o++];r===d?(x=((m=x)+2*y)/3,w=((v=w)+2*_)/3,y=(a+2*y)/3,_=(s+2*_)/3):(m=f[o++],v=f[o++]),Zk[0][0]=y,Zk[0][1]=_,Zk[1][0]=x,Zk[1][1]=w,a=Zk[2][0]=m,s=Zk[2][1]=v;break;case u:var b=0,M=0,S=1,T=1,C=0;e&&(b=e[4],M=e[5],S=Pk(e[0]*e[0]+e[1]*e[1]),T=Pk(e[2]*e[2]+e[3]*e[3]),C=Math.atan2(-e[1]/T,e[0]/S));var A=f[o++],E=f[o++],P=f[o++],L=f[o++],I=f[o++]+C,R=f[o++]+I+C;o++;var D=f[o++],O=A+Ik(I)*P,k=E+Rk(I)*L,z=(y=A+Ik(R)*P,_=E+Rk(R)*L,D?" wa ":" at ");Math.abs(O-y)<1e-4&&(.01<Math.abs(R-I)?D&&(O+=.0125):Math.abs(k-E)<1e-4?D&&O<A||!D&&A<O?_-=.0125:_+=.0125:D&&k<E||!D&&E<k?y+=.0125:y-=.0125),p.push(z,Ek(((A-P)*S+b)*zk-Nk),Ok,Ek(((E-L)*T+M)*zk-Nk),Ok,Ek(((A+P)*S+b)*zk-Nk),Ok,Ek(((E+L)*T+M)*zk-Nk),Ok,Ek((O*S+b)*zk-Nk),Ok,Ek((k*T+M)*zk-Nk),Ok,Ek((y*S+b)*zk-Nk),Ok,Ek((_*T+M)*zk-Nk)),a=y,s=_;break;case Ak.R:var N=Zk[0],B=Zk[1];N[0]=f[o++],N[1]=f[o++],B[0]=N[0]+f[o++],B[1]=N[1]+f[o++],e&&(Ck(N,N,e),Ck(B,B,e)),N[0]=Ek(N[0]*zk-Nk),B[0]=Ek(B[0]*zk-Nk),N[1]=Ek(N[1]*zk-Nk),B[1]=Ek(B[1]*zk-Nk),p.push(" m ",N[0],Ok,N[1]," l ",B[0],Ok,N[1]," l ",B[0],Ok,B[1]," l ",N[0],Ok,B[1]);break;case Ak.Z:p.push(" x ")}if(0<i){p.push(n);for(var F=0;F<i;F++){var G=Zk[F];e&&Ck(G,G,e),p.push(Ek(G[0]*zk-Nk),Ok,Ek(G[1]*zk-Nk),F<i-1?Ok:"")}}}return p.join("")}(l,this.transform),i.style.zIndex=Hk(this.zlevel,this.z,this.z2),Gk(t,i),null!=e.text?this.drawRectText(t,this.getBoundingRect()):this.removeRectText(t)},_d.prototype.onRemove=function(t){Vk(t,this._vmlEl),this.removeRectText(t)},_d.prototype.onAdd=function(t){Gk(t,this._vmlEl),this.appendRectText(t)};$h.prototype.brushVML=function(t){var e,i,n,r=this.style,o=r.image;if("object"==typeof(n=o)&&n.tagName&&"IMG"===n.tagName.toUpperCase()){var a=o.src;if(a===this._imageSrc)e=this._imageWidth,i=this._imageHeight;else{var s=o.runtimeStyle,l=s.width,h=s.height;s.width="auto",s.height="auto",e=o.width,i=o.height,s.width=l,s.height=h,this._imageSrc=a,this._imageWidth=e,this._imageHeight=i}o=a}else o===this._imageSrc&&(e=this._imageWidth,i=this._imageHeight);if(o){var c=r.x||0,u=r.y||0,d=r.width,p=r.height,f=r.sWidth,g=r.sHeight,m=r.sx||0,v=r.sy||0,y=f&&g,_=this._vmlEl;_||(_=Tk.doc.createElement("div"),Bk(_),this._vmlEl=_);var x,w=_.style,b=!1,M=1,S=1;if(this.transform&&(x=this.transform,M=Pk(x[0]*x[0]+x[1]*x[1]),S=Pk(x[2]*x[2]+x[3]*x[3]),b=x[1]||x[2]),b){var T=[c,u],C=[c+d,u],A=[c,u+p],E=[c+d,u+p];Ck(T,T,x),Ck(C,C,x),Ck(A,A,x),Ck(E,E,x);var P=Dk(T[0],C[0],A[0],E[0]),L=Dk(T[1],C[1],A[1],E[1]),I=[];I.push("M11=",x[0]/M,Ok,"M12=",x[2]/S,Ok,"M21=",x[1]/M,Ok,"M22=",x[3]/S,Ok,"Dx=",Ek(c*M+x[4]),Ok,"Dy=",Ek(u*S+x[5])),w.padding="0 "+Ek(P)+"px "+Ek(L)+"px 0",w.filter=kk+".Matrix("+I.join("")+", SizingMethod=clip)"}else x&&(c=c*M+x[4],u=u*S+x[5]),w.filter="",w.left=Ek(c)+"px",w.top=Ek(u)+"px";var R=this._imageEl,D=this._cropEl;R||(R=Tk.doc.createElement("div"),this._imageEl=R);var O=R.style;if(y){if(e&&i)O.width=Ek(M*e*d/f)+"px",O.height=Ek(S*i*p/g)+"px";else{var k=new Image,z=this;k.onload=function(){k.onload=null,e=k.width,i=k.height,O.width=Ek(M*e*d/f)+"px",O.height=Ek(S*i*p/g)+"px",z._imageWidth=e,z._imageHeight=i,z._imageSrc=o},k.src=o}D||((D=Tk.doc.createElement("div")).style.overflow="hidden",this._cropEl=D);var N=D.style;N.width=Ek((d+m*d/f)*M),N.height=Ek((p+v*p/g)*S),N.filter=kk+".Matrix(Dx="+-m*d/f*M+",Dy="+-v*p/g*S+")",D.parentNode||_.appendChild(D),R.parentNode!=D&&D.appendChild(R)}else O.width=Ek(M*d)+"px",O.height=Ek(S*p)+"px",_.appendChild(R),D&&D.parentNode&&(_.removeChild(D),this._cropEl=null);var B="",F=r.opacity;F<1&&(B+=".Alpha(opacity="+Ek(100*F)+") "),B+=kk+".AlphaImageLoader(src="+o+", SizingMethod=scale)",O.filter=B,_.style.zIndex=Hk(this.zlevel,this.z,this.z2),Gk(t,_),null!=r.text&&this.drawRectText(t,this.getBoundingRect())}},$h.prototype.onRemove=function(t){Vk(t,this._vmlEl),this._vmlEl=null,this._cropEl=null,this._imageEl=null,this.removeRectText(t)},$h.prototype.onAdd=function(t){Gk(t,this._vmlEl),this.appendRectText(t)};var Xk,qk="normal",Yk={},Jk=0,Kk=document.createElement("div");Sh.$override("measureText",function(t,e){var i=Tk.doc;Xk||((Xk=i.createElement("div")).style.cssText="position:absolute;top:-20000px;left:0;padding:0;margin:0;border:none;white-space:pre;",Tk.doc.body.appendChild(Xk));try{Xk.style.font=e}catch(t){}return Xk.innerHTML="",Xk.appendChild(i.createTextNode(t)),{width:Xk.offsetWidth}});for(var Qk=new bl,$k=function(t,e,i,n){var r=this.style;this.__dirty&&Zh.normalizeTextStyle(r,!0);var o=r.text;if(null!=o&&(o+=""),o){if(r.rich){var a=Sh.parseRichText(o,r);o=[];for(var s=0;s<a.lines.length;s++){for(var l=a.lines[s].tokens,h=[],c=0;c<l.length;c++)h.push(l[c].text);o.push(h.join(""))}o=o.join("\n")}var u,d,p=r.textAlign,f=r.textVerticalAlign,g=function(t){var e=Yk[t];if(!e){100<Jk&&(Jk=0,Yk={});var i,n=Kk.style;try{n.font=t,i=n.fontFamily.split(",")[0]}catch(t){}e={style:n.fontStyle||qk,variant:n.fontVariant||qk,weight:n.fontWeight||qk,size:0|parseFloat(n.fontSize||12),family:i||"Microsoft YaHei"},Yk[t]=e,Jk++}return e}(r.font),m=g.style+" "+g.variant+" "+g.weight+" "+g.size+'px "'+g.family+'"';i=i||Sh.getBoundingRect(o,m,p,f);var v=this.transform;if(v&&!n&&(Qk.copy(e),Qk.applyTransform(v),e=Qk),n)u=e.x,d=e.y;else{var y=r.textPosition,_=r.textDistance;if(y instanceof Array)u=e.x+Uk(y[0],e.width),d=e.y+Uk(y[1],e.height),p=p||"left";else{var x=Sh.adjustTextPositionOnRect(y,e,_);u=x.x,d=x.y,p=p||x.textAlign,f=f||x.textVerticalAlign}}u=Sh.adjustTextX(u,i.width,p),d=Sh.adjustTextY(d,i.height,f),d+=i.height/2;var w,b,M,S=Tk.createNode,T=this._textVmlEl;T?b=(w=(M=T.firstChild).nextSibling).nextSibling:(T=S("line"),w=S("path"),b=S("textpath"),M=S("skew"),b.style["v-text-align"]="left",Bk(T),w.textpathok=!0,b.on=!0,T.from="0 0",T.to="1000 0.05",Gk(T,M),Gk(T,w),Gk(T,b),this._textVmlEl=T);var C=[u,d],A=T.style;v&&n?(Ck(C,C,v),M.on=!0,M.matrix=v[0].toFixed(3)+Ok+v[2].toFixed(3)+Ok+v[1].toFixed(3)+Ok+v[3].toFixed(3)+",0,0",M.offset=(Ek(C[0])||0)+","+(Ek(C[1])||0),M.origin="0 0",A.left="0px",A.top="0px"):(M.on=!1,A.left=Ek(u)+"px",A.top=Ek(d)+"px"),b.string=String(o).replace(/&/g,"&amp;").replace(/"/g,"&quot;");try{b.style.font=m}catch(t){}jk(T,"fill",{fill:r.textFill,opacity:r.opacity},this),jk(T,"stroke",{stroke:r.textStroke,opacity:r.opacity,lineDash:r.lineDash},this),T.style.zIndex=Hk(this.zlevel,this.z,this.z2),Gk(t,T)}},tz=function(t){Vk(t,this._textVmlEl),this._textVmlEl=null},ez=function(t){Gk(t,this._textVmlEl)},iz=[Yh,Kh,$h,_d,Bd],nz=0;nz<iz.length;nz++){var rz=iz[nz].prototype;rz.drawRectText=$k,rz.removeRectText=tz,rz.appendRectText=ez}Bd.prototype.brushVML=function(t){var e=this.style;null!=e.text?this.drawRectText(t,{x:e.x||0,y:e.y||0,width:0,height:0},this.getBoundingRect(),!0):this.removeRectText(t)},Bd.prototype.onRemove=function(t){this.removeRectText(t)},Bd.prototype.onAdd=function(t){this.appendRectText(t)}}var oz=za.each;function az(t){return parseInt(t,10)}function sz(t,e){Tk.initVML(),this.root=t,this.storage=e;var i=document.createElement("div"),n=document.createElement("div");i.style.cssText="display:inline-block;overflow:hidden;position:relative;width:300px;height:150px;",n.style.cssText="position:absolute;left:0;top:0;",t.appendChild(i),this._vmlRoot=n,this._vmlViewport=i,this.resize();var r=e.delFromStorage,o=e.addToStorage;e.delFromStorage=function(t){r.call(e,t),t&&t.onRemove&&t.onRemove(n)},e.addToStorage=function(t){t.onAdd&&t.onAdd(n),o.call(e,t)},this._firstPaint=!0}sz.prototype={constructor:sz,getType:function(){return"vml"},getViewportRoot:function(){return this._vmlViewport},getViewportRootOffset:function(){var t=this.getViewportRoot();if(t)return{offsetLeft:t.offsetLeft||0,offsetTop:t.offsetTop||0}},refresh:function(){var t=this.storage.getDisplayList(!0,!0);this._paintList(t)},_paintList:function(t){for(var e=this._vmlRoot,i=0;i<t.length;i++){var n=t[i];n.invisible||n.ignore?(n.__alreadyNotVisible||n.onRemove(e),n.__alreadyNotVisible=!0):(n.__alreadyNotVisible&&n.onAdd(e),n.__alreadyNotVisible=!1,n.__dirty&&(n.beforeBrush&&n.beforeBrush(),(n.brushVML||n.brush).call(n,e),n.afterBrush&&n.afterBrush())),n.__dirty=!1}this._firstPaint&&(this._vmlViewport.appendChild(e),this._firstPaint=!1)},resize:function(t,e){t=null==t?this._getWidth():t,e=null==e?this._getHeight():e;if(this._width!=t||this._height!=e){this._width=t,this._height=e;var i=this._vmlViewport.style;i.width=t+"px",i.height=e+"px"}},dispose:function(){this.root.innerHTML="",this._vmlRoot=this._vmlViewport=this.storage=null},getWidth:function(){return this._width},getHeight:function(){return this._height},clear:function(){this._vmlViewport&&this.root.removeChild(this._vmlViewport)},_getWidth:function(){var t=this.root,e=t.currentStyle;return(t.clientWidth||az(e.width))-az(e.paddingLeft)-az(e.paddingRight)|0},_getHeight:function(){var t=this.root,e=t.currentStyle;return(t.clientHeight||az(e.height))-az(e.paddingTop)-az(e.paddingBottom)|0}},oz(["getLayer","insertLayer","eachLayer","eachBuiltinLayer","eachOtherLayer","getLayers","modLayer","delLayer","clearLayer","toDataURL","pathToImage"],function(t){var e;sz.prototype[t]=(e=t,function(){rl('In IE8.0 VML mode painter not support method "'+e+'"')})});var lz=sz;(0,Gc.registerPainter)("vml",lz);var hz={createElement:function(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}},cz=hz.createElement,uz=Xu.CMD,dz=Array.prototype.join,pz="none",fz=Math.round,gz=Math.sin,mz=Math.cos,vz=Math.PI,yz=2*Math.PI,_z=180/vz,xz=1e-4;function wz(t){return fz(1e4*t)/1e4}function bz(t){return t<xz&&-xz<t}function Mz(t,e){e&&Sz(t,"transform","matrix("+dz.call(e,",")+")")}function Sz(t,e,i){(!i||"linear"!==i.type&&"radial"!==i.type)&&t.setAttribute(e,i)}function Tz(t,e,i){if(r=e,null!=(o=i?r.textFill:r.fill)&&o!==pz){var n=i?e.textFill:e.fill;n="transparent"===n?pz:n,"none"!==t.getAttribute("clip-path")&&n===pz&&(n="rgba(0, 0, 0, 0.002)"),Sz(t,"fill",n),Sz(t,"fill-opacity",e.opacity)}else Sz(t,"fill",pz);var r,o,a,s;if(a=e,null!=(s=i?a.textStroke:a.stroke)&&s!==pz){var l=i?e.textStroke:e.stroke;Sz(t,"stroke",l="transparent"===l?pz:l),Sz(t,"stroke-width",(i?e.textStrokeWidth:e.lineWidth)/(e.strokeNoScale?e.host.getLineScale():1)),Sz(t,"paint-order","stroke"),Sz(t,"stroke-opacity",e.opacity),e.lineDash?(Sz(t,"stroke-dasharray",e.lineDash.join(",")),Sz(t,"stroke-dashoffset",fz(e.lineDashOffset||0))):Sz(t,"stroke-dasharray",""),e.lineCap&&Sz(t,"stroke-linecap",e.lineCap),e.lineJoin&&Sz(t,"stroke-linejoin",e.lineJoin),e.miterLimit&&Sz(t,"stroke-miterlimit",e.miterLimit)}else Sz(t,"stroke",pz)}var Cz={};Cz.brush=function(t){var e=t.style,i=t.__svgEl;i||(i=cz("path"),t.__svgEl=i),t.path||t.createPathProxy();var n=t.path;if(t.__dirtyPath){n.beginPath(),t.buildPath(n,t.shape),t.__dirtyPath=!1;var r=function(t){for(var e=[],i=t.data,n=t.len(),r=0;r<n;){var o="",a=0;switch(i[r++]){case uz.M:o="M",a=2;break;case uz.L:o="L",a=2;break;case uz.Q:o="Q",a=4;break;case uz.C:o="C",a=6;break;case uz.A:var s=i[r++],l=i[r++],h=i[r++],c=i[r++],u=i[r++],d=i[r++],p=i[r++],f=i[r++],g=Math.abs(d),m=bz(g%yz)&&!bz(g),v=!1;v=yz<=g||!bz(g)&&(-vz<d&&d<0||vz<d)==!!f;var y=wz(s+h*mz(u)),_=wz(l+c*gz(u));m&&(d=f?yz-1e-4:1e-4-yz,v=!0,9===r&&e.push("M",y,_));var x=wz(s+h*mz(u+d)),w=wz(l+c*gz(u+d));e.push("A",wz(h),wz(c),fz(p*_z),+v,+f,x,w);break;case uz.Z:o="Z";break;case uz.R:x=wz(i[r++]),w=wz(i[r++]);var b=wz(i[r++]),M=wz(i[r++]);e.push("M",x,w,"L",x+b,w,"L",x+b,w+M,"L",x,w+M,"L",x,w)}o&&e.push(o);for(var S=0;S<a;S++)e.push(wz(i[r++]))}return e.join(" ")}(n);r.indexOf("NaN")<0&&Sz(i,"d",r)}Tz(i,e),Mz(i,t.transform),null!=e.text&&Lz(t,t.getBoundingRect())};var Az={brush:function(t){var e=t.style,i=e.image;i instanceof HTMLImageElement&&(i=i.src);if(i){var n,r,o=e.x||0,a=e.y||0,s=e.width,l=e.height,h=t.__svgEl;h||(h=cz("image"),t.__svgEl=h),i!==t.__imageSrc&&(n="href",r=i,h.setAttributeNS("http://www.w3.org/1999/xlink",n,r),t.__imageSrc=i),Sz(h,"width",s),Sz(h,"height",l),Sz(h,"x",o),Sz(h,"y",a),Mz(h,t.transform),null!=e.text&&Lz(t,t.getBoundingRect())}}},Ez={},Pz=new bl,Lz=function(t,e,i){var n=t.style;t.__dirty&&Zh.normalizeTextStyle(n,!0);var r=n.text;if(null!=r){r+="";var o,a,s=t.__textSvgEl;if(s||(s=cz("text"),t.__textSvgEl=s),Tz(s,n,!0),t instanceof Bd||t.style.transformText)Mz(s,t.transform);else if(t.transform)Pz.copy(e),Pz.applyTransform(t.transform),e=Pz;else{var l=t.transformCoordToGlobal(e.x,e.y);e.x=l[0],e.y=l[1]}var h=n.textPosition,c=n.textDistance,u=n.textAlign||"left";"number"==typeof n.fontSize&&(n.fontSize+="px");var d=n.font||[n.fontStyle||"",n.fontWeight||"",n.fontSize||"",n.fontFamily||""].join(" ")||Sh.DEFAULT_FONT,p=Iz(n.textVerticalAlign),f=(i=Sh.getBoundingRect(r,d,u,p)).lineHeight;if(h instanceof Array)o=e.x+h[0],a=e.y+h[1];else{var g=Sh.adjustTextPositionOnRect(h,e,c);o=g.x,a=g.y,p=Iz(g.textVerticalAlign),u=g.textAlign}Sz(s,"alignment-baseline",p),d&&(s.style.font=d);var m=n.textPadding;Sz(s,"x",o),Sz(s,"y",a);var v=r.split("\n"),y=v.length,_=u;"left"===_?(_="start",m&&(o+=m[3])):"right"===_?(_="end",m&&(o-=m[1])):"center"===_&&(_="middle",m&&(o+=(m[3]-m[1])/2));var x=0;if("baseline"===p?(x=-i.height+f,m&&(x-=m[2])):"middle"===p?(x=(-i.height+f)/2,m&&(a+=(m[0]-m[2])/2)):m&&(x+=m[0]),t.__text!==r||t.__textFont!==d){var w=t.__tspanList||[];t.__tspanList=w;for(var b=0;b<y;b++){(S=w[b])?S.innerHTML="":(S=w[b]=cz("tspan"),s.appendChild(S),Sz(S,"alignment-baseline",p),Sz(S,"text-anchor",_)),Sz(S,"x",o),Sz(S,"y",a+b*f+x),S.appendChild(document.createTextNode(v[b]))}for(;b<w.length;b++)s.removeChild(w[b]);w.length=y,t.__text=r,t.__textFont=d}else if(t.__tspanList.length){var M=t.__tspanList.length;for(b=0;b<M;++b){var S;(S=t.__tspanList[b])&&(Sz(S,"x",o),Sz(S,"y",a+b*f+x))}}}};function Iz(t){return"middle"===t?"middle":"bottom"===t?"baseline":"hanging"}Ez.drawRectText=Lz,Ez.brush=function(t){var e=t.style;null!=e.text&&(e.textPosition=[0,0],Lz(t,{x:e.x||0,y:e.y||0,width:0,height:0},t.getBoundingRect()))};var Rz={path:Cz,image:Az,text:Ez};function Dz(){}function Oz(t,e,i,n){for(var r=0,o=e.length,a=0,s=0;r<o;r++){var l=e[r];if(l.removed){for(h=[],c=s;c<s+l.count;c++)h.push(c);l.indices=h,s+=l.count}else{for(var h=[],c=a;c<a+l.count;c++)h.push(c);l.indices=h,a+=l.count,l.added||(s+=l.count)}}return e}Dz.prototype={diff:function(l,h,t){t||(t=function(t,e){return t===e}),this.equals=t;var c=this;l=l.slice();var u=(h=h.slice()).length,d=l.length,p=1,e=u+d,f=[{newPos:-1,components:[]}],i=this.extractCommon(f[0],h,l,0);if(f[0].newPos+1>=u&&d<=i+1){for(var n=[],r=0;r<h.length;r++)n.push(r);return[{indices:n,count:h.length}]}function o(){for(var t=-1*p;t<=p;t+=2){var e,i=f[t-1],n=f[t+1],r=(n?n.newPos:0)-t;i&&(f[t-1]=void 0);var o=i&&i.newPos+1<u,a=n&&0<=r&&r<d;if(o||a){if(!o||a&&i.newPos<n.newPos?(e={newPos:(s=n).newPos,components:s.components.slice(0)},c.pushComponent(e.components,void 0,!0)):((e=i).newPos++,c.pushComponent(e.components,!0,void 0)),r=c.extractCommon(e,h,l,t),e.newPos+1>=u&&d<=r+1)return Oz(c,e.components,h,l);f[t]=e}else f[t]=void 0}var s;p++}for(;p<=e;){var a=o();if(a)return a}},pushComponent:function(t,e,i){var n=t[t.length-1];n&&n.added===e&&n.removed===i?t[t.length-1]={count:n.count+1,added:e,removed:i}:t.push({count:1,added:e,removed:i})},extractCommon:function(t,e,i,n){for(var r=e.length,o=i.length,a=t.newPos,s=a-n,l=0;a+1<r&&s+1<o&&this.equals(e[a+1],i[s+1]);)a++,s++,l++;return l&&t.components.push({count:l}),t.newPos=a,s},tokenize:function(t){return t.slice()},join:function(t){return t.slice()}};var kz=new Dz;var zz=function(t,e,i){return kz.diff(t,e,i)},Nz=Rz.path,Bz=Rz.image,Fz=Rz.text;function Gz(t,e,i){this._svgRoot=t,this._tagNames="string"==typeof e?[e]:e,this._markLabel=i,this.nextId=0}Gz.prototype.createElement=hz.createElement,Gz.prototype.getDefs=function(t){var e=this._svgRoot,n=this._svgRoot.getElementsByTagName("defs");return 0===n.length?t?((n=e.insertBefore(this.createElement("defs"),e.firstChild)).contains||(n.contains=function(t){var e=n.children;if(!e)return!1;for(var i=e.length-1;0<=i;--i)if(e[i]===t)return!0;return!1}),n):null:n[0]},Gz.prototype.update=function(t,e){if(t){var i=this.getDefs(!1);if(t._dom&&i.contains(t._dom))"function"==typeof e&&e();else{var n=this.add(t);n&&(t._dom=n)}}},Gz.prototype.addDom=function(t){this.getDefs(!0).appendChild(t)},Gz.prototype.removeDom=function(t){this.getDefs(!1).removeChild(t._dom)},Gz.prototype.getDoms=function(){var i=this.getDefs(!1);if(!i)return[];var n=[];return za.each(this._tagNames,function(t){var e=i.getElementsByTagName(t);n=n.concat([].slice.call(e))}),n},Gz.prototype.markAllUnused=function(){var t=this.getDoms(),e=this;za.each(t,function(t){t[e._markLabel]="0"})},Gz.prototype.markUsed=function(t){t&&(t[this._markLabel]="1")},Gz.prototype.removeUnused=function(){var e=this.getDefs(!1);if(e){var t=this.getDoms(),i=this;za.each(t,function(t){"1"!==t[i._markLabel]&&e.removeChild(t)})}},Gz.prototype.getSvgProxy=function(t){return t instanceof _d?Nz:t instanceof $h?Bz:t instanceof Bd?Fz:Nz},Gz.prototype.getTextSvgElement=function(t){return t.__textSvgEl},Gz.prototype.getSvgElement=function(t){return t.__svgEl};var Vz=Gz;function Hz(t){Vz.call(this,t,["linearGradient","radialGradient"],"__gradient_in_use__")}za.inherits(Hz,Vz),Hz.prototype.addWithoutUpdate=function(o,a){if(a&&a.style){var s=this;za.each(["fill","stroke"],function(t){if(a.style[t]&&("linear"===a.style[t].type||"radial"===a.style[t].type)){var e,i=a.style[t],n=s.getDefs(!0);i._dom?(e=i._dom,n.contains(i._dom)||s.addDom(e)):e=s.add(i),s.markUsed(a);var r=e.getAttribute("id");o.setAttribute(t,"url(#"+r+")")}})}},Hz.prototype.add=function(t){var e;if("linear"===t.type)e=this.createElement("linearGradient");else{if("radial"!==t.type)return rl("Illegal gradient type."),null;e=this.createElement("radialGradient")}return t.id=t.id||this.nextId++,e.setAttribute("id","zr-gradient-"+t.id),this.updateDom(t,e),this.addDom(e),e},Hz.prototype.update=function(i){var n=this;Vz.prototype.update.call(this,i,function(){var t=i.type,e=i._dom.tagName;"linear"===t&&"linearGradient"===e||"radial"===t&&"radialGradient"===e?n.updateDom(i,i._dom):(n.removeDom(i),n.add(i))})},Hz.prototype.updateDom=function(t,e){if("linear"===t.type)e.setAttribute("x1",t.x),e.setAttribute("y1",t.y),e.setAttribute("x2",t.x2),e.setAttribute("y2",t.y2);else{if("radial"!==t.type)return void rl("Illegal gradient type.");e.setAttribute("cx",t.x),e.setAttribute("cy",t.y),e.setAttribute("r",t.r)}t.global?e.setAttribute("gradientUnits","userSpaceOnUse"):e.setAttribute("gradientUnits","objectBoundingBox"),e.innerHTML="";for(var i=t.colorStops,n=0,r=i.length;n<r;++n){var o=this.createElement("stop");o.setAttribute("offset",100*i[n].offset+"%"),o.setAttribute("stop-color",i[n].color),e.appendChild(o)}t._dom=e},Hz.prototype.markUsed=function(t){if(t.style){var e=t.style.fill;e&&e._dom&&Vz.prototype.markUsed.call(this,e._dom),(e=t.style.stroke)&&e._dom&&Vz.prototype.markUsed.call(this,e._dom)}};var Uz=Hz;function Wz(t){Vz.call(this,t,"clipPath","__clippath_in_use__")}za.inherits(Wz,Vz),Wz.prototype.update=function(t){var e=this.getSvgElement(t);e&&this.updateDom(e,t.__clipPaths,!1);var i=this.getTextSvgElement(t);i&&this.updateDom(i,t.__clipPaths,!0),this.markUsed(t)},Wz.prototype.updateDom=function(t,e,i){if(e&&0<e.length){var n,r,o=this.getDefs(!0),a=e[0],s=i?"_textDom":"_dom";a[s]?(r=a[s].getAttribute("id"),n=a[s],o.contains(n)||o.appendChild(n)):(r="zr-clip-"+this.nextId,++this.nextId,(n=this.createElement("clipPath")).setAttribute("id",r),o.appendChild(n),a[s]=n);var l=this.getSvgProxy(a);if(a.transform&&a.parent.invTransform&&!i){var h=Array.prototype.slice.call(a.transform);ns.mul(a.transform,a.parent.invTransform,a.transform),l.brush(a),a.transform=h}else l.brush(a);var c=this.getSvgElement(a);n.appendChild(c.cloneNode()),t.setAttribute("clip-path","url(#"+r+")"),1<e.length&&this.updateDom(n,e.slice(1),i)}else t&&t.setAttribute("clip-path","none")},Wz.prototype.markUsed=function(t){var e=this;t.__clipPaths&&0<t.__clipPaths.length&&za.each(t.__clipPaths,function(t){t._dom&&Vz.prototype.markUsed.call(e,t._dom),t._textDom&&Vz.prototype.markUsed.call(e,t._textDom)})};var jz=Wz,Zz=hz.createElement,Xz=za.each,qz=Rz.path,Yz=Rz.image,Jz=Rz.text;function Kz(t){return parseInt(t,10)}function Qz(t,e){return e&&t&&e.parentNode!==t}function $z(t,e,i){if(Qz(t,e)&&i){var n=i.nextSibling;n?t.insertBefore(e,n):t.appendChild(e)}}function tN(t,e){if(Qz(t,e)){var i=t.firstChild;i?t.insertBefore(e,i):t.appendChild(e)}}function eN(t,e){e&&t&&e.parentNode===t&&t.removeChild(e)}function iN(t){return t.__textSvgEl}function nN(t){return t.__svgEl}var rN=function(t,e,i){this.root=t,this.storage=e,this._opts=i=za.extend({},i||{});var n=Zz("svg");n.setAttribute("xmlns","http://www.w3.org/2000/svg"),n.setAttribute("version","1.1"),n.setAttribute("baseProfile","full"),n.style["user-select"]="none",n.style.cssText="position:absolute;left:0;top:0;",this.gradientManager=new Uz(n),this.clipPathManager=new jz(n);var r=document.createElement("div");r.style.cssText="overflow:hidden;position:relative",this._svgRoot=n,this._viewport=r,t.appendChild(r),r.appendChild(n),this.resize(i.width,i.height),this._visibleList=[]};rN.prototype={constructor:rN,getType:function(){return"svg"},getViewportRoot:function(){return this._viewport},getViewportRootOffset:function(){var t=this.getViewportRoot();if(t)return{offsetLeft:t.offsetLeft||0,offsetTop:t.offsetTop||0}},refresh:function(){var t=this.storage.getDisplayList(!0);this._paintList(t)},_paintList:function(t){this.gradientManager.markAllUnused(),this.clipPathManager.markAllUnused();var e,i,n=this._svgRoot,r=this._visibleList,o=t.length,a=[];for(e=0;e<o;e++){var s=t[e],l=(i=s)instanceof _d?qz:i instanceof $h?Yz:i instanceof Bd?Jz:qz;s.invisible||(s.__dirty&&(l&&l.brush(s),this.clipPathManager.update(s),s.style&&(this.gradientManager.update(s.style.fill),this.gradientManager.update(s.style.stroke)),s.__dirty=!1),a.push(s))}var h,c=zz(r,a);for(e=0;e<c.length;e++){if((f=c[e]).removed)for(var u=0;u<f.count;u++){var d=nN(s=r[f.indices[u]]),p=iN(s);eN(n,d),eN(n,p)}}for(e=0;e<c.length;e++){var f;if((f=c[e]).added)for(u=0;u<f.count;u++){d=nN(s=a[f.indices[u]]),p=iN(s);h?$z(n,d,h):tN(n,d),d?$z(n,p,d):h?$z(n,p,h):tN(n,p),$z(n,p,d),h=p||d||h,this.gradientManager.addWithoutUpdate(d,s),this.clipPathManager.markUsed(s)}else if(!f.removed)for(u=0;u<f.count;u++){h=d=iN(s=a[f.indices[u]])||nN(s)||h,this.gradientManager.markUsed(s),this.gradientManager.addWithoutUpdate(d,s),this.clipPathManager.markUsed(s)}}this.gradientManager.removeUnused(),this.clipPathManager.removeUnused(),this._visibleList=a},_getDefs:function(t){var n,e=this._svgRoot;return 0===(n=this._svgRoot.getElementsByTagName("defs")).length?t?((n=e.insertBefore(Zz("defs"),e.firstChild)).contains||(n.contains=function(t){var e=n.children;if(!e)return!1;for(var i=e.length-1;0<=i;--i)if(e[i]===t)return!0;return!1}),n):null:n[0]},resize:function(t,e){var i=this._viewport;i.style.display="none";var n=this._opts;if(null!=t&&(n.width=t),null!=e&&(n.height=e),t=this._getSize(0),e=this._getSize(1),i.style.display="",this._width!==t&&this._height!==e){this._width=t,this._height=e;var r=i.style;r.width=t+"px",r.height=e+"px";var o=this._svgRoot;o.setAttribute("width",t),o.setAttribute("height",e)}},getWidth:function(){return this._width},getHeight:function(){return this._height},_getSize:function(t){var e=this._opts,i=["width","height"][t],n=["clientWidth","clientHeight"][t],r=["paddingLeft","paddingTop"][t],o=["paddingRight","paddingBottom"][t];if(null!=e[i]&&"auto"!==e[i])return parseFloat(e[i]);var a=this.root,s=document.defaultView.getComputedStyle(a);return(a[n]||Kz(s[i])||Kz(a.style[i]))-(Kz(s[r])||0)-(Kz(s[o])||0)|0},dispose:function(){this.root.innerHTML="",this._svgRoot=this._viewport=this.storage=null},clear:function(){this._viewport&&this.root.removeChild(this._viewport)},pathToSvg:function(){this.refresh();var t=this._svgRoot.outerHTML;return"data:img/svg+xml;utf-8,"+unescape(t)}},Xz(["getLayer","insertLayer","eachLayer","eachBuiltinLayer","eachOtherLayer","getLayers","modLayer","delLayer","clearLayer","toDataURL","pathToImage"],function(t){var e;rN.prototype[t]=(e=t,function(){rl('In SVG mode painter not support method "'+e+'"')})});var oN=rN;(0,Gc.registerPainter)("svg",oN);var aN,sN=ji(function(t,e){!function(){for(var t in fy){if(null==fy||!fy.hasOwnProperty(t)||"default"===t||"__esModule"===t)return;e[t]=fy[t]}}(),function(){for(var t in py){if(null==py||!py.hasOwnProperty(t)||"default"===t||"__esModule"===t)return;e[t]=py[t]}}()}),lN=(aN=sN)&&aN.__esModule&&Object.prototype.hasOwnProperty.call(aN,"default")?aN.default:aN,hN=function(r){function o(t,e,i){u(this,o);var n=v(this,r.call(this,t,i));return n._ecOptions=e,n}return m(o,r),o.prototype.getEChartsOption=function(){return this._ecOptions},o.prototype.setEChartsOption=function(t){return this._ecOptions=t,this._getRenderer()&&this._getRenderer()._clearAndRedraw(),this},o.prototype.toJSON=function(){return{type:this.getJSONType(),id:this.getId(),ecOptions:this._ecOptions,options:this.config()}},o.fromJSON=function(t){return t&&"E3Layer"===t.type?new o(t.id,t.ecOptions,t.options):null},o}(Ji);hN.mergeOptions({container:"front",renderer:"dom",hideOnZooming:!1,hideOnMoving:!1,hideOnRotating:!1}),hN.registerJSONType("E3Layer"),hN.registerRenderer("dom",function(){function e(t){u(this,e),this.layer=t}return e.prototype.render=function(){this._container||this._createLayerContainer(),this._ec?this._isVisible()&&this._ec.resize():(this._ec=lN.init(this._container),this._prepareECharts(),this._ec.setOption(this.layer._ecOptions,!1)),this.layer.fire("layerload")},e.prototype.drawOnInteracting=function(){this._isVisible()&&this._ec.resize()},e.prototype.needToRedraw=function(){var t=this.getMap(),e=t._getRenderer();return t.isInteracting()||e&&(e.isStateChanged&&e.isStateChanged()||e.isViewChanged&&e.isViewChanged())},e.prototype.getMap=function(){return this.layer.getMap()},e.prototype._isVisible=function(){return this._container&&""===this._container.style.display},e.prototype.show=function(){this._container&&(this._container.style.display="")},e.prototype.hide=function(){this._container&&(this._container.style.display="none")},e.prototype.remove=function(){this._ec.clear(),this._ec.dispose(),delete this._ec,this._removeLayerContainer()},e.prototype.clear=function(){this._ec.clear()},e.prototype.setZIndex=function(t){this._zIndex=t,this._container&&(this._container.style.zIndex=t)},e.prototype.isCanvasRender=function(){return!1},e.prototype._prepareECharts=function(){this._registered||(this._coordSystemName="mapcan"+mapcan.Util.GUID(),lN.registerCoordinateSystem(this._coordSystemName,this._getE3CoordinateSystem(this.getMap())),this._registered=!0);var t=this.layer._ecOptions.series;if(t)for(var e=t.length-1;0<=e;e--)t[e].coordinateSystem=this._coordSystemName,t[e].animation=!1},e.prototype._createLayerContainer=function(){var t=this._container=Ie("div");t.style.cssText="position:absolute;left:0px;top:0px;",this._zIndex&&(t.style.zIndex=this._zIndex),this._resetContainer(),("front"===this.layer.options.container?this.getMap()._panels.frontStatic:this.getMap()._panels.backStatic).appendChild(t)},e.prototype._removeLayerContainer=function(){this._container&&De(this._container),delete this._levelContainers},e.prototype._resetContainer=function(){var t=this.getMap().getSize();this._container.style.width=t.width+"px",this._container.style.height=t.height+"px"},e.prototype._getE3CoordinateSystem=function(e){var i=function(t){this.map=t,this._mapOffset=[0,0]},n=this;return i.create=function(t){t.eachSeries(function(t){t.get("coordinateSystem")===n._coordSystemName&&(t.coordinateSystem=new i(e))})},i.getDimensionsInfo=function(){return["x","y"]},i.dimensions=["x","y"],_(i.prototype,{dimensions:["x","y"],setMapOffset:function(t){this._mapOffset=t},dataToPoint:function(t){var e=new yi(t),i=this.map.coordinateToContainerPoint(e),n=this._mapOffset;return[i.x-n[0],i.y-n[1]]},pointToData:function(t){var e=this._mapOffset,i=this.map.containerPointToCoordinate({x:t[0]+e[0],y:t[1]+e[1]});return[i.x,i.y]},getViewRect:function(){var t=this.map.getSize();return new lN.graphic.BoundingRect(0,0,t.width,t.height)},getRoamTransform:function(){return lN.matrix.create()}}),i},e.prototype.getEvents=function(){return{_zoomstart:this.onZoomStart,_zoomend:this.onZoomEnd,_dragrotatestart:this.onDragRotateStart,_dragrotateend:this.onDragRotateEnd,_movestart:this.onMoveStart,_moveend:this.onMoveEnd,_resize:this._resetContainer}},e.prototype._clearAndRedraw=function(){this._container&&"none"===this._container.style.display||(this._ec.clear(),this._ec.resize(),this._prepareECharts(),this._ec.setOption(this.layer._ecOptions,!1))},e.prototype.onZoomStart=function(){this.layer.options.hideOnZooming&&this.hide()},e.prototype.onZoomEnd=function(){this.layer.options.hideOnZooming&&(this.show(),this._clearAndRedraw())},e.prototype.onDragRotateStart=function(){this.layer.options.hideOnRotating&&this.hide()},e.prototype.onDragRotateEnd=function(){this.layer.options.hideOnRotating&&(this.show(),this._clearAndRedraw())},e.prototype.onMoveStart=function(){this.layer.options.hideOnMoving&&this.hide()},e.prototype.onMoveEnd=function(){this.layer.options.hideOnMoving&&(this.show(),this._clearAndRedraw())},e}());var cN=ji(function(t){function e(t){if(!(this instanceof e))return new e(t);this._canvas=t="string"==typeof t?document.getElementById(t):t,this._ctx=t.getContext("2d"),this._width=t.width,this._height=t.height,this._max=1,this._data=[]}(t.exports=e).prototype={defaultRadius:25,defaultGradient:{.4:"blue",.6:"cyan",.7:"lime",.8:"yellow",1:"red"},data:function(t){return this._data=t,this},max:function(t){return this._max=t,this},add:function(t){return this._data.push(t),this},clear:function(){return this._data=[],this},radius:function(t,e){e=void 0===e?15:e;var i=this._circle=this._createCanvas(),n=i.getContext("2d"),r=this._r=t+e;return i.width=i.height=2*r,n.shadowOffsetX=n.shadowOffsetY=2*r,n.shadowBlur=e,n.shadowColor="black",n.beginPath(),n.arc(-r,-r,t,0,2*Math.PI,!0),n.closePath(),n.fill(),this},resize:function(){this._width=this._canvas.width,this._height=this._canvas.height},gradient:function(t){var e=this._createCanvas(),i=e.getContext("2d"),n=i.createLinearGradient(0,0,0,256);for(var r in e.width=1,e.height=256,t)n.addColorStop(+r,t[r]);return i.fillStyle=n,i.fillRect(0,0,1,256),this._grad=i.getImageData(0,0,1,256).data,this},draw:function(t){this._circle||this.radius(this.defaultRadius),this._grad||this.gradient(this.defaultGradient);var e=this._ctx;e.clearRect(0,0,this._width,this._height);for(var i,n=0,r=this._data.length;n<r;n++)i=this._data[n],e.globalAlpha=Math.max(i[2]/this._max,void 0===t?.05:t),e.drawImage(this._circle,i[0]-this._r,i[1]-this._r);var o=e.getImageData(0,0,this._width,this._height);return this._colorize(o.data,this._grad),e.putImageData(o,0,0),this},_colorize:function(t,e){for(var i,n=0,r=t.length;n<r;n+=4)(i=4*t[n+3])&&(t[n]=e[i],t[n+1]=e[i+1],t[n+2]=e[i+2])},_createCanvas:function(){return"undefined"!=typeof document?document.createElement("canvas"):new this._canvas.constructor}}}),uN={max:1,gradient:{.4:"blue",.6:"cyan",.7:"lime",.8:"yellow",1:"red"},radius:25,blur:15,minOpacity:.05},dN=function(r){function o(t,e,i){u(this,o),Array.isArray(e)||(i=e,e=null);var n=v(this,r.call(this,t,i));return n._heats=e||[],n}return m(o,r),o.prototype.getData=function(){return this._heats},o.prototype.setData=function(t){return this._heats=t||[],this.redraw()},o.prototype.addPoint=function(t){return t?(t[0]&&Array.isArray(t[0])?D(this._heats,t):this._heats.push(t),this.redraw()):this},o.prototype.onConfig=function(t){for(var e in t)if(uN[e])return this.redraw();return this},o.prototype.redraw=function(){var t=this._getRenderer();return t&&(t.clearHeatCache(),t.setToRedraw()),this},o.prototype.isEmpty=function(){return!this._heats.length},o.prototype.clear=function(){return this._heats=[],this.redraw(),this.fire("clear"),this},o.prototype.toJSON=function(t){t||(t={});var e={type:this.getJSONType(),id:this.getId(),options:this.config()},i=this.getData();if(t.clipExtent){var n=new wi(t.clipExtent),r=this._getHeatRadius();r&&(n=n._expand(r));for(var o=[],a=0,s=i.length;a<s;a++)n.contains(new yi(i[a][0],i[a][1]))&&o.push(i[a]);e.data=o}else e.data=i;return e},o.fromJSON=function(t){return t&&"HeatLayer"===t.type?new o(t.id,t.data,t.options):null},o.prototype._getHeatRadius=function(){return this._getRenderer()?this._getRenderer()._heatRadius:null},o}(Ji);function pN(){}dN.mergeOptions(uN),dN.registerJSONType("HeatLayer"),dN.registerRenderer("canvas",function(t){function e(){return u(this,e),v(this,t.apply(this,arguments))}return m(e,t),e.prototype.draw=function(){var e=this.getMap(),t=this.layer,i=e.getContainerExtent(),n=this.prepareCanvas(),r=i;if(n){if(!(n=n.convertTo(function(t){return e._pointToContainerPoint(t)})).intersects(i))return void this.completeRender();r=i.intersection(n)}this._heater||(this._heater=cN(this.canvas)),this._heater.radius(t.options.radius||this._heater.defaultRadius,t.options.blur),t.options.gradient&&this._heater.gradient(t.options.gradient),this._heater.max(t.options.max),this._heatViews||(this._heatViews=[]);var o=t.getData();if(0!==o.length){var a=this._heatData(o,r);this._heater.data(a).draw(t.options.minOpacity),this.completeRender()}else this.completeRender()},e.prototype.drawOnInteracting=function(){this.draw()},e.prototype._heatData=function(t,e){var i=this.getMap(),n=this.layer,r=i.getProjection(),o=[],a=this._heater._r,s=void 0===n.options.max?1:n.options.max,l=Y(n.options.maxZoom)?i.getMaxZoom():n.options.maxZoom,h=1/Math.pow(2,Math.max(0,Math.min(l-i.getZoom(),12))),c=a/2,u=[],d=i.offsetPlatform(),p=d.x%c,f=d.y%c,g=void 0,m=void 0,v=void 0,y=void 0,_=void 0,x=void 0;e=e.expand(a).convertTo(function(t){return new le(i._containerPointToPrj(t))}),this._heatRadius=a;for(var w=0,b=t.length;w<b;w++)g=t[w],this._heatViews[w]||(this._heatViews[w]=r.project(new yi(g[0],g[1]))),m=this._heatViews[w],e.contains(m)&&(m=i._prjToContainerPoint(m),y=Math.floor((m.x-p)/c)+2,_=Math.floor((m.y-f)/c)+2,x=(void 0!==g.alt?g.alt:void 0!==g[2]?+g[2]:1)*h,u[_]=u[_]||[],(v=u[_][y])?(v[0]=(v[0]*v[2]+m.x*x)/(v[2]+x),v[1]=(v[1]*v[2]+m.y*x)/(v[2]+x),v[2]+=x):u[_][y]=[m.x,m.y,x]);for(var M=0,S=u.length;M<S;M++)if(u[M])for(var T=0,C=u[M].length;T<C;T++)(v=u[M][T])&&o.push([Math.round(v[0]),Math.round(v[1]),Math.min(v[2],s)]);return o},e.prototype.onZoomEnd=function(){delete this._heatViews,t.prototype.onZoomEnd.apply(this,arguments)},e.prototype.onResize=function(){this.canvas&&(this._heater._width=this.canvas.width,this._heater._height=this.canvas.height),t.prototype.onResize.apply(this,arguments)},e.prototype.onRemove=function(){this.clearHeatCache(),delete this._heater},e.prototype.clearHeatCache=function(){delete this._heatViews},e}(qi)),void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Math.sign&&(Math.sign=function(t){return t<0?-1:0<t?1:+t}),void 0===Function.prototype.name&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),void 0===Object.assign&&(Object.assign=function(t){if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),i=1;i<arguments.length;i++){var n=arguments[i];if(null!=n)for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}),pN.prototype={addEventListener:function(t,e){void 0===this._listeners&&(this._listeners={});var i=this._listeners;void 0===i[t]&&(i[t]=[]),-1===i[t].indexOf(e)&&i[t].push(e)},hasEventListener:function(t,e){if(void 0===this._listeners)return!1;var i=this._listeners;return void 0!==i[t]&&-1!==i[t].indexOf(e)},removeEventListener:function(t,e){if(void 0!==this._listeners){var i=this._listeners[t];if(void 0!==i){var n=i.indexOf(e);-1!==n&&i.splice(n,1)}}},dispatchEvent:function(t){if(void 0!==this._listeners){var e=this._listeners[t.type];if(void 0!==e){t.target=this;var i=[],n=0,r=e.length;for(n=0;n<r;n++)i[n]=e[n];for(n=0;n<r;n++)i[n].call(this,t)}}}};var fN,gN,mN,vN,yN,_N,xN=0,wN=1,bN=2,MN=1,SN=2,TN=0,CN=1,AN=2,EN=1,PN=2,LN=0,IN=0,RN=1,DN=2,ON=3,kN=4,zN=5,NN=100,BN=204,FN=205,GN=0,VN=1,HN=2,UN=3,WN=4,jN=5,ZN=6,XN=7,qN=0,YN=1,JN=2,KN=0,QN=1,$N=2,tB=3,eB=4,iB=301,nB=302,rB=303,oB=304,aB=305,sB=306,lB=307,hB=1e3,cB=1001,uB=1002,dB=1003,pB=1004,fB=1005,gB=1006,mB=1008,vB=1009,yB=1012,_B=1014,xB=1015,wB=1016,bB=1020,MB=1022,SB=1023,TB=SB,CB=1026,AB=1027,EB=2300,PB=2301,LB=2400,IB=2401,RB=2402,DB=0,OB=3e3,kB=3001,zB=3007,NB=3002,BB=3004,FB=3005,GB=3006,VB=3200,HB=3201,UB={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:(gN="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),mN=new Array(36),vN=0,function(){for(var t=0;t<36;t++)8===t||13===t||18===t||23===t?mN[t]="-":14===t?mN[t]="4":(vN<=2&&(vN=33554432+16777216*Math.random()|0),fN=15&vN,vN>>=4,mN[t]=gN[19===t?3&fN|8:fN]);return mN.join("")}),clamp:function(t,e,i){return Math.max(e,Math.min(i,t))},euclideanModulo:function(t,e){return(t%e+e)%e},mapLinear:function(t,e,i,n,r){return n+(t-e)*(r-n)/(i-e)},lerp:function(t,e,i){return(1-i)*t+i*e},smoothstep:function(t,e,i){return t<=e?0:i<=t?1:(t=(t-e)/(i-e))*t*(3-2*t)},smootherstep:function(t,e,i){return t<=e?0:i<=t?1:(t=(t-e)/(i-e))*t*t*(t*(6*t-15)+10)},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},degToRad:function(t){return t*UB.DEG2RAD},radToDeg:function(t){return t*UB.RAD2DEG},isPowerOfTwo:function(t){return 0==(t&t-1)&&0!==t},nearestPowerOfTwo:function(t){return Math.pow(2,Math.round(Math.log(t)/Math.LN2))},nextPowerOfTwo:function(t){return t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,++t}};function WB(t,e){this.x=t||0,this.y=e||0}WB.prototype={constructor:WB,isVector2:!0,get width(){return this.x},set width(t){this.x=t},get height(){return this.y},set height(t){this.y=t},set:function(t,e){return this.x=t,this.y=e,this},setScalar:function(t){return this.x=t,this.y=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(t){return this.x=t.x,this.y=t.y,this},add:function(t,e){return void 0!==e?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this)},addScalar:function(t){return this.x+=t,this.y+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this},sub:function(t,e){return void 0!==e?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this)},subScalar:function(t){return this.x-=t,this.y-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this},multiply:function(t){return this.x*=t.x,this.y*=t.y,this},multiplyScalar:function(t){return isFinite(t)?(this.x*=t,this.y*=t):(this.x=0,this.y=0),this},divide:function(t){return this.x/=t.x,this.y/=t.y,this},divideScalar:function(t){return this.multiplyScalar(1/t)},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this},clampScalar:function(t,e){return void 0===yN&&(yN=new WB,_N=new WB),yN.set(t,t),_N.set(e,e),this.clamp(yN,_N)},clampLength:function(t,e){var i=this.length();return this.multiplyScalar(Math.max(t,Math.min(e,i))/i)},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(t){return this.x*t.x+this.y*t.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length())},angle:function(){var t=Math.atan2(this.y,this.x);return t<0&&(t+=2*Math.PI),t},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,i=this.y-t.y;return e*e+i*i},distanceToManhattan:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)},setLength:function(t){return this.multiplyScalar(t/this.length())},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this},lerpVectors:function(t,e,i){return this.subVectors(e,t).multiplyScalar(i).add(t)},equals:function(t){return t.x===this.x&&t.y===this.y},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t},fromBufferAttribute:function(t,e,i){return void 0!==i&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this},rotateAround:function(t,e){var i=Math.cos(e),n=Math.sin(e),r=this.x-t.x,o=this.y-t.y;return this.x=r*i-o*n+t.x,this.y=r*n+o*i+t.y,this}};var jB,ZB,XB,qB,YB,JB,KB,QB,$B,tF,eF,iF,nF,rF,oF,aF,sF,lF,hF,cF=0;function uF(t,e,i,n,r,o,a,s,l,h){Object.defineProperty(this,"id",{value:cF++}),this.uuid=UB.generateUUID(),this.name="",this.image=void 0!==t?t:uF.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==e?e:uF.DEFAULT_MAPPING,this.wrapS=void 0!==i?i:cB,this.wrapT=void 0!==n?n:cB,this.magFilter=void 0!==r?r:gB,this.minFilter=void 0!==o?o:mB,this.anisotropy=void 0!==l?l:1,this.format=void 0!==a?a:SB,this.type=void 0!==s?s:vB,this.offset=new WB(0,0),this.repeat=new WB(1,1),this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=void 0!==h?h:OB,this.version=0,this.onUpdate=null}function dF(t,e,i,n){this.x=t||0,this.y=e||0,this.z=i||0,this.w=void 0!==n?n:1}function pF(t,e,i){this.uuid=UB.generateUUID(),this.width=t,this.height=e,this.scissor=new dF(0,0,t,e),this.scissorTest=!1,this.viewport=new dF(0,0,t,e),void 0===(i=i||{}).minFilter&&(i.minFilter=gB),this.texture=new uF(void 0,void 0,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.depthBuffer=void 0===i.depthBuffer||i.depthBuffer,this.stencilBuffer=void 0===i.stencilBuffer||i.stencilBuffer,this.depthTexture=void 0!==i.depthTexture?i.depthTexture:null}function fF(t,e,i){pF.call(this,t,e,i),this.activeCubeFace=0,this.activeMipMapLevel=0}function gF(t,e,i,n){this._x=t||0,this._y=e||0,this._z=i||0,this._w=void 0!==n?n:1}function mF(t,e,i){this.x=t||0,this.y=e||0,this.z=i||0}function vF(){this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),0<arguments.length&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}function yF(t,e,i,n,r,o,a,s,l,h){uF.call(this,t=void 0!==t?t:[],e=void 0!==e?e:iB,i,n,r,o,a,s,l,h),this.flipY=!1}uF.DEFAULT_IMAGE=void 0,uF.DEFAULT_MAPPING=300,uF.prototype={constructor:uF,isTexture:!0,set needsUpdate(t){!0===t&&this.version++},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.image=t.image,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this},toJSON:function(t){if(void 0!==t.textures[this.uuid])return t.textures[this.uuid];var e,i,n={metadata:{version:4.4,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],wrap:[this.wrapS,this.wrapT],minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY};if(void 0!==this.image){var r=this.image;void 0===r.uuid&&(r.uuid=UB.generateUUID()),void 0===t.images[r.uuid]&&(t.images[r.uuid]={uuid:r.uuid,url:(e=r,void 0!==e.toDataURL?i=e:((i=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")).width=e.width,i.height=e.height,i.getContext("2d").drawImage(e,0,0,e.width,e.height)),2048<i.width||2048<i.height?i.toDataURL("image/jpeg",.6):i.toDataURL("image/png"))}),n.image=r.uuid}return t.textures[this.uuid]=n},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(t){if(300===this.mapping){if(t.multiply(this.repeat),t.add(this.offset),t.x<0||1<t.x)switch(this.wrapS){case hB:t.x=t.x-Math.floor(t.x);break;case cB:t.x=t.x<0?0:1;break;case uB:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||1<t.y)switch(this.wrapT){case hB:t.y=t.y-Math.floor(t.y);break;case cB:t.y=t.y<0?0:1;break;case uB:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}this.flipY&&(t.y=1-t.y)}}},Object.assign(uF.prototype,pN.prototype),dF.prototype={constructor:dF,isVector4:!0,set:function(t,e,i,n){return this.x=t,this.y=e,this.z=i,this.w=n,this},setScalar:function(t){return this.x=t,this.y=t,this.z=t,this.w=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setW:function(t){return this.w=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this},add:function(t,e){return void 0!==e?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this},sub:function(t,e){return void 0!==e?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this},multiplyScalar:function(t){return isFinite(t)?(this.x*=t,this.y*=t,this.z*=t,this.w*=t):(this.x=0,this.y=0,this.z=0,this.w=0),this},applyMatrix4:function(t){var e=this.x,i=this.y,n=this.z,r=this.w,o=t.elements;return this.x=o[0]*e+o[4]*i+o[8]*n+o[12]*r,this.y=o[1]*e+o[5]*i+o[9]*n+o[13]*r,this.z=o[2]*e+o[6]*i+o[10]*n+o[14]*r,this.w=o[3]*e+o[7]*i+o[11]*n+o[15]*r,this},divideScalar:function(t){return this.multiplyScalar(1/t)},setAxisAngleFromQuaternion:function(t){this.w=2*Math.acos(t.w);var e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this},setAxisAngleFromRotationMatrix:function(t){var e,i,n,r,o=t.elements,a=o[0],s=o[4],l=o[8],h=o[1],c=o[5],u=o[9],d=o[2],p=o[6],f=o[10];if(Math.abs(s-h)<.01&&Math.abs(l-d)<.01&&Math.abs(u-p)<.01){if(Math.abs(s+h)<.1&&Math.abs(l+d)<.1&&Math.abs(u+p)<.1&&Math.abs(a+c+f-3)<.1)return this.set(1,0,0,0),this;e=Math.PI;var g=(a+1)/2,m=(c+1)/2,v=(f+1)/2,y=(s+h)/4,_=(l+d)/4,x=(u+p)/4;return m<g&&v<g?g<.01?(i=0,r=n=.707106781):(n=y/(i=Math.sqrt(g)),r=_/i):v<m?m<.01?(n=0,r=i=.707106781):(i=y/(n=Math.sqrt(m)),r=x/n):v<.01?(n=i=.707106781,r=0):(i=_/(r=Math.sqrt(v)),n=x/r),this.set(i,n,r,e),this}var w=Math.sqrt((p-u)*(p-u)+(l-d)*(l-d)+(h-s)*(h-s));return Math.abs(w)<.001&&(w=1),this.x=(p-u)/w,this.y=(l-d)/w,this.z=(h-s)/w,this.w=Math.acos((a+c+f-1)/2),this},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this},clampScalar:function(t,e){return void 0===jB&&(jB=new dF,ZB=new dF),jB.set(t,t,t,t),ZB.set(e,e,e,e),this.clamp(jB,ZB)},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(t){return this.multiplyScalar(t/this.length())},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this},lerpVectors:function(t,e,i){return this.subVectors(e,t).multiplyScalar(i).add(t)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t},fromBufferAttribute:function(t,e,i){return void 0!==i&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}},pF.prototype={constructor:pF,isWebGLRenderTarget:!0,setSize:function(t,e){this.width===t&&this.height===e||(this.width=t,this.height=e,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.width=t.width,this.height=t.height,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.depthTexture=t.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}},Object.assign(pF.prototype,pN.prototype),((fF.prototype=Object.create(pF.prototype)).constructor=fF).prototype.isWebGLRenderTargetCube=!0,gF.prototype={constructor:gF,get x(){return this._x},set x(t){this._x=t,this.onChangeCallback()},get y(){return this._y},set y(t){this._y=t,this.onChangeCallback()},get z(){return this._z},set z(t){this._z=t,this.onChangeCallback()},get w(){return this._w},set w(t){this._w=t,this.onChangeCallback()},set:function(t,e,i,n){return this._x=t,this._y=e,this._z=i,this._w=n,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this.onChangeCallback(),this},setFromEuler:function(t,e){if(!1===(t&&t.isEuler))throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var i=Math.cos(t._x/2),n=Math.cos(t._y/2),r=Math.cos(t._z/2),o=Math.sin(t._x/2),a=Math.sin(t._y/2),s=Math.sin(t._z/2),l=t.order;return"XYZ"===l?(this._x=o*n*r+i*a*s,this._y=i*a*r-o*n*s,this._z=i*n*s+o*a*r,this._w=i*n*r-o*a*s):"YXZ"===l?(this._x=o*n*r+i*a*s,this._y=i*a*r-o*n*s,this._z=i*n*s-o*a*r,this._w=i*n*r+o*a*s):"ZXY"===l?(this._x=o*n*r-i*a*s,this._y=i*a*r+o*n*s,this._z=i*n*s+o*a*r,this._w=i*n*r-o*a*s):"ZYX"===l?(this._x=o*n*r-i*a*s,this._y=i*a*r+o*n*s,this._z=i*n*s-o*a*r,this._w=i*n*r+o*a*s):"YZX"===l?(this._x=o*n*r+i*a*s,this._y=i*a*r+o*n*s,this._z=i*n*s-o*a*r,this._w=i*n*r-o*a*s):"XZY"===l&&(this._x=o*n*r-i*a*s,this._y=i*a*r-o*n*s,this._z=i*n*s+o*a*r,this._w=i*n*r+o*a*s),!1!==e&&this.onChangeCallback(),this},setFromAxisAngle:function(t,e){var i=e/2,n=Math.sin(i);return this._x=t.x*n,this._y=t.y*n,this._z=t.z*n,this._w=Math.cos(i),this.onChangeCallback(),this},setFromRotationMatrix:function(t){var e,i=t.elements,n=i[0],r=i[4],o=i[8],a=i[1],s=i[5],l=i[9],h=i[2],c=i[6],u=i[10],d=n+s+u;return 0<d?(e=.5/Math.sqrt(d+1),this._w=.25/e,this._x=(c-l)*e,this._y=(o-h)*e,this._z=(a-r)*e):s<n&&u<n?(e=2*Math.sqrt(1+n-s-u),this._w=(c-l)/e,this._x=.25*e,this._y=(r+a)/e,this._z=(o+h)/e):u<s?(e=2*Math.sqrt(1+s-n-u),this._w=(o-h)/e,this._x=(r+a)/e,this._y=.25*e,this._z=(l+c)/e):(e=2*Math.sqrt(1+u-n-s),this._w=(a-r)/e,this._x=(o+h)/e,this._y=(l+c)/e,this._z=.25*e),this.onChangeCallback(),this},setFromUnitVectors:function(t,e){return void 0===XB&&(XB=new mF),(qB=t.dot(e)+1)<1e-6?(qB=0,Math.abs(t.x)>Math.abs(t.z)?XB.set(-t.y,t.x,0):XB.set(0,-t.z,t.y)):XB.crossVectors(t,e),this._x=XB.x,this._y=XB.y,this._z=XB.z,this._w=qB,this.normalize()},inverse:function(){return this.conjugate().normalize()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this},dot:function(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this.onChangeCallback(),this},multiply:function(t,e){return void 0!==e?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):this.multiplyQuaternions(this,t)},premultiply:function(t){return this.multiplyQuaternions(t,this)},multiplyQuaternions:function(t,e){var i=t._x,n=t._y,r=t._z,o=t._w,a=e._x,s=e._y,l=e._z,h=e._w;return this._x=i*h+o*a+n*l-r*s,this._y=n*h+o*s+r*a-i*l,this._z=r*h+o*l+i*s-n*a,this._w=o*h-i*a-n*s-r*l,this.onChangeCallback(),this},slerp:function(t,e){if(0===e)return this;if(1===e)return this.copy(t);var i=this._x,n=this._y,r=this._z,o=this._w,a=o*t._w+i*t._x+n*t._y+r*t._z;if(a<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,a=-a):this.copy(t),1<=a)return this._w=o,this._x=i,this._y=n,this._z=r,this;var s=Math.sqrt(1-a*a);if(Math.abs(s)<.001)return this._w=.5*(o+this._w),this._x=.5*(i+this._x),this._y=.5*(n+this._y),this._z=.5*(r+this._z),this;var l=Math.atan2(s,a),h=Math.sin((1-e)*l)/s,c=Math.sin(e*l)/s;return this._w=o*h+this._w*c,this._x=i*h+this._x*c,this._y=n*h+this._y*c,this._z=r*h+this._z*c,this.onChangeCallback(),this},equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w},fromArray:function(t,e){return void 0===e&&(e=0),this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this.onChangeCallback(),this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t},onChange:function(t){return this.onChangeCallback=t,this},onChangeCallback:function(){}},Object.assign(gF,{slerp:function(t,e,i,n){return i.copy(t).slerp(e,n)},slerpFlat:function(t,e,i,n,r,o,a){var s=i[n+0],l=i[n+1],h=i[n+2],c=i[n+3],u=r[o+0],d=r[o+1],p=r[o+2],f=r[o+3];if(c!==f||s!==u||l!==d||h!==p){var g=1-a,m=s*u+l*d+h*p+c*f,v=0<=m?1:-1,y=1-m*m;if(y>Number.EPSILON){var _=Math.sqrt(y),x=Math.atan2(_,m*v);g=Math.sin(g*x)/_,a=Math.sin(a*x)/_}var w=a*v;if(s=s*g+u*w,l=l*g+d*w,h=h*g+p*w,c=c*g+f*w,g===1-a){var b=1/Math.sqrt(s*s+l*l+h*h+c*c);s*=b,l*=b,h*=b,c*=b}}t[e]=s,t[e+1]=l,t[e+2]=h,t[e+3]=c}}),mF.prototype={constructor:mF,isVector3:!0,set:function(t,e,i){return this.x=t,this.y=e,this.z=i,this},setScalar:function(t){return this.x=t,this.y=t,this.z=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},add:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this},sub:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this},multiply:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)},multiplyScalar:function(t){return isFinite(t)?(this.x*=t,this.y*=t,this.z*=t):(this.x=0,this.y=0,this.z=0),this},multiplyVectors:function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this},applyEuler:function(t){return!1===(t&&t.isEuler)&&console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),void 0===iF&&(iF=new gF),this.applyQuaternion(iF.setFromEuler(t))},applyAxisAngle:function(t,e){return void 0===eF&&(eF=new gF),this.applyQuaternion(eF.setFromAxisAngle(t,e))},applyMatrix3:function(t){var e=this.x,i=this.y,n=this.z,r=t.elements;return this.x=r[0]*e+r[3]*i+r[6]*n,this.y=r[1]*e+r[4]*i+r[7]*n,this.z=r[2]*e+r[5]*i+r[8]*n,this},applyMatrix4:function(t){var e=this.x,i=this.y,n=this.z,r=t.elements;this.x=r[0]*e+r[4]*i+r[8]*n+r[12],this.y=r[1]*e+r[5]*i+r[9]*n+r[13],this.z=r[2]*e+r[6]*i+r[10]*n+r[14];var o=r[3]*e+r[7]*i+r[11]*n+r[15];return this.divideScalar(o)},applyQuaternion:function(t){var e=this.x,i=this.y,n=this.z,r=t.x,o=t.y,a=t.z,s=t.w,l=s*e+o*n-a*i,h=s*i+a*e-r*n,c=s*n+r*i-o*e,u=-r*e-o*i-a*n;return this.x=l*s+u*-r+h*-a-c*-o,this.y=h*s+u*-o+c*-r-l*-a,this.z=c*s+u*-a+l*-o-h*-r,this},project:function(t){return void 0===tF&&(tF=new vF),tF.multiplyMatrices(t.projectionMatrix,tF.getInverse(t.matrixWorld)),this.applyMatrix4(tF)},unproject:function(t){return void 0===$B&&($B=new vF),$B.multiplyMatrices(t.matrixWorld,$B.getInverse(t.projectionMatrix)),this.applyMatrix4($B)},transformDirection:function(t){var e=this.x,i=this.y,n=this.z,r=t.elements;return this.x=r[0]*e+r[4]*i+r[8]*n,this.y=r[1]*e+r[5]*i+r[9]*n,this.z=r[2]*e+r[6]*i+r[10]*n,this.normalize()},divide:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this},divideScalar:function(t){return this.multiplyScalar(1/t)},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this},clampScalar:function(t,e){return void 0===KB&&(KB=new mF,QB=new mF),KB.set(t,t,t),QB.set(e,e,e),this.clamp(KB,QB)},clampLength:function(t,e){var i=this.length();return this.multiplyScalar(Math.max(t,Math.min(e,i))/i)},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(t){return this.multiplyScalar(t/this.length())},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this},lerpVectors:function(t,e,i){return this.subVectors(e,t).multiplyScalar(i).add(t)},cross:function(t,e){if(void 0!==e)return console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e);var i=this.x,n=this.y,r=this.z;return this.x=n*t.z-r*t.y,this.y=r*t.x-i*t.z,this.z=i*t.y-n*t.x,this},crossVectors:function(t,e){var i=t.x,n=t.y,r=t.z,o=e.x,a=e.y,s=e.z;return this.x=n*s-r*a,this.y=r*o-i*s,this.z=i*a-n*o,this},projectOnVector:function(t){var e=t.dot(this)/t.lengthSq();return this.copy(t).multiplyScalar(e)},projectOnPlane:function(t){return void 0===JB&&(JB=new mF),JB.copy(this).projectOnVector(t),this.sub(JB)},reflect:function(t){return void 0===YB&&(YB=new mF),this.sub(YB.copy(t).multiplyScalar(2*this.dot(t)))},angleTo:function(t){var e=this.dot(t)/Math.sqrt(this.lengthSq()*t.lengthSq());return Math.acos(UB.clamp(e,-1,1))},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,i=this.y-t.y,n=this.z-t.z;return e*e+i*i+n*n},distanceToManhattan:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)},setFromSpherical:function(t){var e=Math.sin(t.phi)*t.radius;return this.x=e*Math.sin(t.theta),this.y=Math.cos(t.phi)*t.radius,this.z=e*Math.cos(t.theta),this},setFromCylindrical:function(t){return this.x=t.radius*Math.sin(t.theta),this.y=t.y,this.z=t.radius*Math.cos(t.theta),this},setFromMatrixPosition:function(t){return this.setFromMatrixColumn(t,3)},setFromMatrixScale:function(t){var e=this.setFromMatrixColumn(t,0).length(),i=this.setFromMatrixColumn(t,1).length(),n=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=i,this.z=n,this},setFromMatrixColumn:function(t,e){if("number"==typeof t){console.warn("THREE.Vector3: setFromMatrixColumn now expects ( matrix, index ).");var i=t;t=e,e=i}return this.fromArray(t.elements,4*e)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t},fromBufferAttribute:function(t,e,i){return void 0!==i&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}},vF.prototype={constructor:vF,isMatrix4:!0,set:function(t,e,i,n,r,o,a,s,l,h,c,u,d,p,f,g){var m=this.elements;return m[0]=t,m[4]=e,m[8]=i,m[12]=n,m[1]=r,m[5]=o,m[9]=a,m[13]=s,m[2]=l,m[6]=h,m[10]=c,m[14]=u,m[3]=d,m[7]=p,m[11]=f,m[15]=g,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new vF).fromArray(this.elements)},copy:function(t){return this.elements.set(t.elements),this},copyPosition:function(t){var e=this.elements,i=t.elements;return e[12]=i[12],e[13]=i[13],e[14]=i[14],this},extractBasis:function(t,e,i){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this},makeBasis:function(t,e,i){return this.set(t.x,e.x,i.x,0,t.y,e.y,i.y,0,t.z,e.z,i.z,0,0,0,0,1),this},extractRotation:function(t){void 0===hF&&(hF=new mF);var e=this.elements,i=t.elements,n=1/hF.setFromMatrixColumn(t,0).length(),r=1/hF.setFromMatrixColumn(t,1).length(),o=1/hF.setFromMatrixColumn(t,2).length();return e[0]=i[0]*n,e[1]=i[1]*n,e[2]=i[2]*n,e[4]=i[4]*r,e[5]=i[5]*r,e[6]=i[6]*r,e[8]=i[8]*o,e[9]=i[9]*o,e[10]=i[10]*o,this},makeRotationFromEuler:function(t){!1===(t&&t.isEuler)&&console.error("THREE.Matrix: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var e=this.elements,i=t.x,n=t.y,r=t.z,o=Math.cos(i),a=Math.sin(i),s=Math.cos(n),l=Math.sin(n),h=Math.cos(r),c=Math.sin(r);if("XYZ"===t.order){var u=o*h,d=o*c,p=a*h,f=a*c;e[0]=s*h,e[4]=-s*c,e[8]=l,e[1]=d+p*l,e[5]=u-f*l,e[9]=-a*s,e[2]=f-u*l,e[6]=p+d*l,e[10]=o*s}else if("YXZ"===t.order){var g=s*h,m=s*c,v=l*h,y=l*c;e[0]=g+y*a,e[4]=v*a-m,e[8]=o*l,e[1]=o*c,e[5]=o*h,e[9]=-a,e[2]=m*a-v,e[6]=y+g*a,e[10]=o*s}else if("ZXY"===t.order){g=s*h,m=s*c,v=l*h,y=l*c;e[0]=g-y*a,e[4]=-o*c,e[8]=v+m*a,e[1]=m+v*a,e[5]=o*h,e[9]=y-g*a,e[2]=-o*l,e[6]=a,e[10]=o*s}else if("ZYX"===t.order){u=o*h,d=o*c,p=a*h,f=a*c;e[0]=s*h,e[4]=p*l-d,e[8]=u*l+f,e[1]=s*c,e[5]=f*l+u,e[9]=d*l-p,e[2]=-l,e[6]=a*s,e[10]=o*s}else if("YZX"===t.order){var _=o*s,x=o*l,w=a*s,b=a*l;e[0]=s*h,e[4]=b-_*c,e[8]=w*c+x,e[1]=c,e[5]=o*h,e[9]=-a*h,e[2]=-l*h,e[6]=x*c+w,e[10]=_-b*c}else if("XZY"===t.order){_=o*s,x=o*l,w=a*s,b=a*l;e[0]=s*h,e[4]=-c,e[8]=l*h,e[1]=_*c+b,e[5]=o*h,e[9]=x*c-w,e[2]=w*c-x,e[6]=a*h,e[10]=b*c+_}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},makeRotationFromQuaternion:function(t){var e=this.elements,i=t.x,n=t.y,r=t.z,o=t.w,a=i+i,s=n+n,l=r+r,h=i*a,c=i*s,u=i*l,d=n*s,p=n*l,f=r*l,g=o*a,m=o*s,v=o*l;return e[0]=1-(d+f),e[4]=c-v,e[8]=u+m,e[1]=c+v,e[5]=1-(h+f),e[9]=p-g,e[2]=u-m,e[6]=p+g,e[10]=1-(h+d),e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},lookAt:function(t,e,i){void 0===aF&&(aF=new mF,sF=new mF,lF=new mF);var n=this.elements;return lF.subVectors(t,e).normalize(),0===lF.lengthSq()&&(lF.z=1),aF.crossVectors(i,lF).normalize(),0===aF.lengthSq()&&(lF.z+=1e-4,aF.crossVectors(i,lF).normalize()),sF.crossVectors(lF,aF),n[0]=aF.x,n[4]=sF.x,n[8]=lF.x,n[1]=aF.y,n[5]=sF.y,n[9]=lF.y,n[2]=aF.z,n[6]=sF.z,n[10]=lF.z,this},multiply:function(t,e){return void 0!==e?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,e)):this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,e){var i=t.elements,n=e.elements,r=this.elements,o=i[0],a=i[4],s=i[8],l=i[12],h=i[1],c=i[5],u=i[9],d=i[13],p=i[2],f=i[6],g=i[10],m=i[14],v=i[3],y=i[7],_=i[11],x=i[15],w=n[0],b=n[4],M=n[8],S=n[12],T=n[1],C=n[5],A=n[9],E=n[13],P=n[2],L=n[6],I=n[10],R=n[14],D=n[3],O=n[7],k=n[11],z=n[15];return r[0]=o*w+a*T+s*P+l*D,r[4]=o*b+a*C+s*L+l*O,r[8]=o*M+a*A+s*I+l*k,r[12]=o*S+a*E+s*R+l*z,r[1]=h*w+c*T+u*P+d*D,r[5]=h*b+c*C+u*L+d*O,r[9]=h*M+c*A+u*I+d*k,r[13]=h*S+c*E+u*R+d*z,r[2]=p*w+f*T+g*P+m*D,r[6]=p*b+f*C+g*L+m*O,r[10]=p*M+f*A+g*I+m*k,r[14]=p*S+f*E+g*R+m*z,r[3]=v*w+y*T+_*P+x*D,r[7]=v*b+y*C+_*L+x*O,r[11]=v*M+y*A+_*I+x*k,r[15]=v*S+y*E+_*R+x*z,this},multiplyToArray:function(t,e,i){var n=this.elements;return this.multiplyMatrices(t,e),i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=n[4],i[5]=n[5],i[6]=n[6],i[7]=n[7],i[8]=n[8],i[9]=n[9],i[10]=n[10],i[11]=n[11],i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15],this},multiplyScalar:function(t){var e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this},applyToBufferAttribute:function(t){void 0===oF&&(oF=new mF);for(var e=0,i=t.count;e<i;e++)oF.x=t.getX(e),oF.y=t.getY(e),oF.z=t.getZ(e),oF.applyMatrix4(this),t.setXYZ(e,oF.x,oF.y,oF.z);return t},determinant:function(){var t=this.elements,e=t[0],i=t[4],n=t[8],r=t[12],o=t[1],a=t[5],s=t[9],l=t[13],h=t[2],c=t[6],u=t[10],d=t[14];return t[3]*(+r*s*c-n*l*c-r*a*u+i*l*u+n*a*d-i*s*d)+t[7]*(+e*s*d-e*l*u+r*o*u-n*o*d+n*l*h-r*s*h)+t[11]*(+e*l*c-e*a*d-r*o*c+i*o*d+r*a*h-i*l*h)+t[15]*(-n*a*h-e*s*c+e*a*u+n*o*c-i*o*u+i*s*h)},transpose:function(){var t,e=this.elements;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this},setPosition:function(t){var e=this.elements;return e[12]=t.x,e[13]=t.y,e[14]=t.z,this},getInverse:function(t,e){var i=this.elements,n=t.elements,r=n[0],o=n[1],a=n[2],s=n[3],l=n[4],h=n[5],c=n[6],u=n[7],d=n[8],p=n[9],f=n[10],g=n[11],m=n[12],v=n[13],y=n[14],_=n[15],x=p*y*u-v*f*u+v*c*g-h*y*g-p*c*_+h*f*_,w=m*f*u-d*y*u-m*c*g+l*y*g+d*c*_-l*f*_,b=d*v*u-m*p*u+m*h*g-l*v*g-d*h*_+l*p*_,M=m*p*c-d*v*c-m*h*f+l*v*f+d*h*y-l*p*y,S=r*x+o*w+a*b+s*M;if(0===S){var T="THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0";if(!0===e)throw new Error(T);return console.warn(T),this.identity()}var C=1/S;return i[0]=x*C,i[1]=(v*f*s-p*y*s-v*a*g+o*y*g+p*a*_-o*f*_)*C,i[2]=(h*y*s-v*c*s+v*a*u-o*y*u-h*a*_+o*c*_)*C,i[3]=(p*c*s-h*f*s-p*a*u+o*f*u+h*a*g-o*c*g)*C,i[4]=w*C,i[5]=(d*y*s-m*f*s+m*a*g-r*y*g-d*a*_+r*f*_)*C,i[6]=(m*c*s-l*y*s-m*a*u+r*y*u+l*a*_-r*c*_)*C,i[7]=(l*f*s-d*c*s+d*a*u-r*f*u-l*a*g+r*c*g)*C,i[8]=b*C,i[9]=(m*p*s-d*v*s-m*o*g+r*v*g+d*o*_-r*p*_)*C,i[10]=(l*v*s-m*h*s+m*o*u-r*v*u-l*o*_+r*h*_)*C,i[11]=(d*h*s-l*p*s-d*o*u+r*p*u+l*o*g-r*h*g)*C,i[12]=M*C,i[13]=(d*v*a-m*p*a+m*o*f-r*v*f-d*o*y+r*p*y)*C,i[14]=(m*h*a-l*v*a-m*o*c+r*v*c+l*o*y-r*h*y)*C,i[15]=(l*p*a-d*h*a+d*o*c-r*p*c-l*o*f+r*h*f)*C,this},scale:function(t){var e=this.elements,i=t.x,n=t.y,r=t.z;return e[0]*=i,e[4]*=n,e[8]*=r,e[1]*=i,e[5]*=n,e[9]*=r,e[2]*=i,e[6]*=n,e[10]*=r,e[3]*=i,e[7]*=n,e[11]*=r,this},getMaxScaleOnAxis:function(){var t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],n=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,i,n))},makeTranslation:function(t,e,i){return this.set(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1),this},makeRotationX:function(t){var e=Math.cos(t),i=Math.sin(t);return this.set(1,0,0,0,0,e,-i,0,0,i,e,0,0,0,0,1),this},makeRotationY:function(t){var e=Math.cos(t),i=Math.sin(t);return this.set(e,0,i,0,0,1,0,0,-i,0,e,0,0,0,0,1),this},makeRotationZ:function(t){var e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,0,i,e,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(t,e){var i=Math.cos(e),n=Math.sin(e),r=1-i,o=t.x,a=t.y,s=t.z,l=r*o,h=r*a;return this.set(l*o+i,l*a-n*s,l*s+n*a,0,l*a+n*s,h*a+i,h*s-n*o,0,l*s-n*a,h*s+n*o,r*s*s+i,0,0,0,0,1),this},makeScale:function(t,e,i){return this.set(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1),this},makeShear:function(t,e,i){return this.set(1,e,i,0,t,1,i,0,t,e,1,0,0,0,0,1),this},compose:function(t,e,i){return this.makeRotationFromQuaternion(e),this.scale(i),this.setPosition(t),this},decompose:function(t,e,i){void 0===nF&&(nF=new mF,rF=new vF);var n=this.elements,r=nF.set(n[0],n[1],n[2]).length(),o=nF.set(n[4],n[5],n[6]).length(),a=nF.set(n[8],n[9],n[10]).length();this.determinant()<0&&(r=-r),t.x=n[12],t.y=n[13],t.z=n[14],rF.elements.set(this.elements);var s=1/r,l=1/o,h=1/a;return rF.elements[0]*=s,rF.elements[1]*=s,rF.elements[2]*=s,rF.elements[4]*=l,rF.elements[5]*=l,rF.elements[6]*=l,rF.elements[8]*=h,rF.elements[9]*=h,rF.elements[10]*=h,e.setFromRotationMatrix(rF),i.x=r,i.y=o,i.z=a,this},makePerspective:function(t,e,i,n,r,o){void 0===o&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var a=this.elements,s=2*r/(e-t),l=2*r/(i-n),h=(e+t)/(e-t),c=(i+n)/(i-n),u=-(o+r)/(o-r),d=-2*o*r/(o-r);return a[0]=s,a[4]=0,a[8]=h,a[12]=0,a[1]=0,a[5]=l,a[9]=c,a[13]=0,a[2]=0,a[6]=0,a[10]=u,a[14]=d,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this},makeOrthographic:function(t,e,i,n,r,o){var a=this.elements,s=1/(e-t),l=1/(i-n),h=1/(o-r),c=(e+t)*s,u=(i+n)*l,d=(o+r)*h;return a[0]=2*s,a[4]=0,a[8]=0,a[12]=-c,a[1]=0,a[5]=2*l,a[9]=0,a[13]=-u,a[2]=0,a[6]=0,a[10]=-2*h,a[14]=-d,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this},equals:function(t){for(var e=this.elements,i=t.elements,n=0;n<16;n++)if(e[n]!==i[n])return!1;return!0},fromArray:function(t,e){void 0===e&&(e=0);for(var i=0;i<16;i++)this.elements[i]=t[i+e];return this},toArray:function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);var i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t[e+9]=i[9],t[e+10]=i[10],t[e+11]=i[11],t[e+12]=i[12],t[e+13]=i[13],t[e+14]=i[14],t[e+15]=i[15],t}},((yF.prototype=Object.create(uF.prototype)).constructor=yF).prototype.isCubeTexture=!0,Object.defineProperty(yF.prototype,"images",{get:function(){return this.image},set:function(t){this.image=t}});var _F=new uF,xF=new yF;function wF(){this.seq=[],this.map={}}var bF=[],MF=[];function SF(t,e,i){var n=t[0];if(n<=0||0<n)return t;var r=e*i,o=bF[r];if(void 0===o&&(o=new Float32Array(r),bF[r]=o),0!==e){n.toArray(o,0);for(var a=1,s=0;a!==e;++a)s+=i,t[a].toArray(o,s)}return o}function TF(t,e){var i=MF[e];void 0===i&&(i=new Int32Array(e),MF[e]=i);for(var n=0;n!==e;++n)i[n]=t.allocTextureUnit();return i}function CF(t,e){t.uniform1f(this.addr,e)}function AF(t,e){t.uniform1i(this.addr,e)}function EF(t,e){void 0===e.x?t.uniform2fv(this.addr,e):t.uniform2f(this.addr,e.x,e.y)}function PF(t,e){void 0!==e.x?t.uniform3f(this.addr,e.x,e.y,e.z):void 0!==e.r?t.uniform3f(this.addr,e.r,e.g,e.b):t.uniform3fv(this.addr,e)}function LF(t,e){void 0===e.x?t.uniform4fv(this.addr,e):t.uniform4f(this.addr,e.x,e.y,e.z,e.w)}function IF(t,e){t.uniformMatrix2fv(this.addr,!1,e.elements||e)}function RF(t,e){t.uniformMatrix3fv(this.addr,!1,e.elements||e)}function DF(t,e){t.uniformMatrix4fv(this.addr,!1,e.elements||e)}function OF(t,e,i){var n=i.allocTextureUnit();t.uniform1i(this.addr,n),i.setTexture2D(e||_F,n)}function kF(t,e,i){var n=i.allocTextureUnit();t.uniform1i(this.addr,n),i.setTextureCube(e||xF,n)}function zF(t,e){t.uniform2iv(this.addr,e)}function NF(t,e){t.uniform3iv(this.addr,e)}function BF(t,e){t.uniform4iv(this.addr,e)}function FF(t,e){t.uniform1fv(this.addr,e)}function GF(t,e){t.uniform1iv(this.addr,e)}function VF(t,e){t.uniform2fv(this.addr,SF(e,this.size,2))}function HF(t,e){t.uniform3fv(this.addr,SF(e,this.size,3))}function UF(t,e){t.uniform4fv(this.addr,SF(e,this.size,4))}function WF(t,e){t.uniformMatrix2fv(this.addr,!1,SF(e,this.size,4))}function jF(t,e){t.uniformMatrix3fv(this.addr,!1,SF(e,this.size,9))}function ZF(t,e){t.uniformMatrix4fv(this.addr,!1,SF(e,this.size,16))}function XF(t,e,i){var n=e.length,r=TF(i,n);t.uniform1iv(this.addr,r);for(var o=0;o!==n;++o)i.setTexture2D(e[o]||_F,r[o])}function qF(t,e,i){var n=e.length,r=TF(i,n);t.uniform1iv(this.addr,r);for(var o=0;o!==n;++o)i.setTextureCube(e[o]||xF,r[o])}function YF(t,e,i){this.id=t,this.addr=i,this.setValue=function(t){switch(t){case 5126:return CF;case 35664:return EF;case 35665:return PF;case 35666:return LF;case 35674:return IF;case 35675:return RF;case 35676:return DF;case 35678:return OF;case 35680:return kF;case 5124:case 35670:return AF;case 35667:case 35671:return zF;case 35668:case 35672:return NF;case 35669:case 35673:return BF}}(e.type)}function JF(t,e,i){this.id=t,this.addr=i,this.size=e.size,this.setValue=function(t){switch(t){case 5126:return FF;case 35664:return VF;case 35665:return HF;case 35666:return UF;case 35674:return WF;case 35675:return jF;case 35676:return ZF;case 35678:return XF;case 35680:return qF;case 5124:case 35670:return GF;case 35667:case 35671:return zF;case 35668:case 35672:return NF;case 35669:case 35673:return BF}}(e.type)}function KF(t){this.id=t,wF.call(this)}KF.prototype.setValue=function(t,e){for(var i=this.seq,n=0,r=i.length;n!==r;++n){var o=i[n];o.setValue(t,e[o.id])}};var QF=/([\w\d_]+)(\])?(\[|\.)?/g;function $F(t,e){t.seq.push(e),t.map[e.id]=e}function tG(t,e,i){var n=t.name,r=n.length;for(QF.lastIndex=0;;){var o=QF.exec(n),a=QF.lastIndex,s=o[1],l="]"===o[2],h=o[3];if(l&&(s|=0),void 0===h||"["===h&&a+2===r){$F(i,void 0===h?new YF(s,t,e):new JF(s,t,e));break}var c=i.map[s];void 0===c&&$F(i,c=new KF(s)),i=c}}function eG(t,e,i){wF.call(this),this.renderer=i;for(var n=t.getProgramParameter(e,t.ACTIVE_UNIFORMS),r=0;r<n;++r){var o=t.getActiveUniform(e,r),a=o.name;tG(o,t.getUniformLocation(e,a),this)}}eG.prototype.setValue=function(t,e,i){var n=this.map[e];void 0!==n&&n.setValue(t,i,this.renderer)},eG.prototype.set=function(t,e,i){var n=this.map[i];void 0!==n&&n.setValue(t,e[i],this.renderer)},eG.prototype.setOptional=function(t,e,i){var n=e[i];void 0!==n&&this.setValue(t,i,n)},eG.upload=function(t,e,i,n){for(var r=0,o=e.length;r!==o;++r){var a=e[r],s=i[a.id];!1!==s.needsUpdate&&a.setValue(t,s.value,n)}},eG.seqWithValue=function(t,e){for(var i=[],n=0,r=t.length;n!==r;++n){var o=t[n];o.id in e&&i.push(o)}return i};var iG={merge:function(t){for(var e={},i=0;i<t.length;i++){var n=this.clone(t[i]);for(var r in n)e[r]=n[r]}return e},clone:function(t){var e={};for(var i in t)for(var n in e[i]={},t[i]){var r=t[i][n];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture)?e[i][n]=r.clone():Array.isArray(r)?e[i][n]=r.slice():e[i][n]=r}return e}},nG={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif\n",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif\n",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif\n",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif\n",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"\nvec3 transformed = vec3( position );\n",beginnormal_vertex:"\nvec3 objectNormal = vec3( normal );\n",bsdfs:"float punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t\tif( decayExponent > 0.0 ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\t\tfloat maxDistanceCutoffFactor = pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t\treturn distanceFalloff * maxDistanceCutoffFactor;\n#else\n\t\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n#endif\n\t\t}\n\t\treturn 1.0;\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 ltcTextureCoords( const in GeometricContext geometry, const in float roughness ) {\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = (LUT_SIZE - 1.0)/LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5/LUT_SIZE;\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\tvec3 P = geometry.position;\n\tfloat theta = acos( dot( N, V ) );\n\tvec2 uv = vec2(\n\t\tsqrt( saturate( roughness ) ),\n\t\tsaturate( theta / ( 0.5 * PI ) ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nvoid clipQuadToHorizon( inout vec3 L[5], out int n ) {\n\tint config = 0;\n\tif ( L[0].z > 0.0 ) config += 1;\n\tif ( L[1].z > 0.0 ) config += 2;\n\tif ( L[2].z > 0.0 ) config += 4;\n\tif ( L[3].z > 0.0 ) config += 8;\n\tn = 0;\n\tif ( config == 0 ) {\n\t} else if ( config == 1 ) {\n\t\tn = 3;\n\t\tL[1] = -L[1].z * L[0] + L[0].z * L[1];\n\t\tL[2] = -L[3].z * L[0] + L[0].z * L[3];\n\t} else if ( config == 2 ) {\n\t\tn = 3;\n\t\tL[0] = -L[0].z * L[1] + L[1].z * L[0];\n\t\tL[2] = -L[2].z * L[1] + L[1].z * L[2];\n\t} else if ( config == 3 ) {\n\t\tn = 4;\n\t\tL[2] = -L[2].z * L[1] + L[1].z * L[2];\n\t\tL[3] = -L[3].z * L[0] + L[0].z * L[3];\n\t} else if ( config == 4 ) {\n\t\tn = 3;\n\t\tL[0] = -L[3].z * L[2] + L[2].z * L[3];\n\t\tL[1] = -L[1].z * L[2] + L[2].z * L[1];\n\t} else if ( config == 5 ) {\n\t\tn = 0;\n\t} else if ( config == 6 ) {\n\t\tn = 4;\n\t\tL[0] = -L[0].z * L[1] + L[1].z * L[0];\n\t\tL[3] = -L[3].z * L[2] + L[2].z * L[3];\n\t} else if ( config == 7 ) {\n\t\tn = 5;\n\t\tL[4] = -L[3].z * L[0] + L[0].z * L[3];\n\t\tL[3] = -L[3].z * L[2] + L[2].z * L[3];\n\t} else if ( config == 8 ) {\n\t\tn = 3;\n\t\tL[0] = -L[0].z * L[3] + L[3].z * L[0];\n\t\tL[1] = -L[2].z * L[3] + L[3].z * L[2];\n\t\tL[2] =  L[3];\n\t} else if ( config == 9 ) {\n\t\tn = 4;\n\t\tL[1] = -L[1].z * L[0] + L[0].z * L[1];\n\t\tL[2] = -L[2].z * L[3] + L[3].z * L[2];\n\t} else if ( config == 10 ) {\n\t\tn = 0;\n\t} else if ( config == 11 ) {\n\t\tn = 5;\n\t\tL[4] = L[3];\n\t\tL[3] = -L[2].z * L[3] + L[3].z * L[2];\n\t\tL[2] = -L[2].z * L[1] + L[1].z * L[2];\n\t} else if ( config == 12 ) {\n\t\tn = 4;\n\t\tL[1] = -L[1].z * L[2] + L[2].z * L[1];\n\t\tL[0] = -L[0].z * L[3] + L[3].z * L[0];\n\t} else if ( config == 13 ) {\n\t\tn = 5;\n\t\tL[4] = L[3];\n\t\tL[3] = L[2];\n\t\tL[2] = -L[1].z * L[2] + L[2].z * L[1];\n\t\tL[1] = -L[1].z * L[0] + L[0].z * L[1];\n\t} else if ( config == 14 ) {\n\t\tn = 5;\n\t\tL[4] = -L[0].z * L[3] + L[3].z * L[0];\n\t\tL[0] = -L[0].z * L[1] + L[1].z * L[0];\n\t} else if ( config == 15 ) {\n\t\tn = 4;\n\t}\n\tif ( n == 3 )\n\t\tL[3] = L[0];\n\tif ( n == 4 )\n\t\tL[4] = L[0];\n}\nfloat integrateLtcBrdfOverRectEdge( vec3 v1, vec3 v2 ) {\n\tfloat cosTheta = dot( v1, v2 );\n\tfloat theta = acos( cosTheta );\n\tfloat res = cross( v1, v2 ).z * ( ( theta > 0.001 ) ? theta / sin( theta ) : 1.0 );\n\treturn res;\n}\nvoid initRectPoints( const in vec3 pos, const in vec3 halfWidth, const in vec3 halfHeight, out vec3 rectPoints[4] ) {\n\trectPoints[0] = pos - halfWidth - halfHeight;\n\trectPoints[1] = pos + halfWidth - halfHeight;\n\trectPoints[2] = pos + halfWidth + halfHeight;\n\trectPoints[3] = pos - halfWidth + halfHeight;\n}\nvec3 integrateLtcBrdfOverRect( const in GeometricContext geometry, const in mat3 brdfMat, const in vec3 rectPoints[4] ) {\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\tvec3 P = geometry.position;\n\tvec3 T1, T2;\n\tT1 = normalize(V - N * dot( V, N ));\n\tT2 = - cross( N, T1 );\n\tmat3 brdfWrtSurface = brdfMat * transpose( mat3( T1, T2, N ) );\n\tvec3 clippedRect[5];\n\tclippedRect[0] = brdfWrtSurface * ( rectPoints[0] - P );\n\tclippedRect[1] = brdfWrtSurface * ( rectPoints[1] - P );\n\tclippedRect[2] = brdfWrtSurface * ( rectPoints[2] - P );\n\tclippedRect[3] = brdfWrtSurface * ( rectPoints[3] - P );\n\tint n;\n\tclipQuadToHorizon(clippedRect, n);\n\tif ( n == 0 )\n\t\treturn vec3( 0, 0, 0 );\n\tclippedRect[0] = normalize( clippedRect[0] );\n\tclippedRect[1] = normalize( clippedRect[1] );\n\tclippedRect[2] = normalize( clippedRect[2] );\n\tclippedRect[3] = normalize( clippedRect[3] );\n\tclippedRect[4] = normalize( clippedRect[4] );\n\tfloat sum = 0.0;\n\tsum += integrateLtcBrdfOverRectEdge( clippedRect[0], clippedRect[1] );\n\tsum += integrateLtcBrdfOverRectEdge( clippedRect[1], clippedRect[2] );\n\tsum += integrateLtcBrdfOverRectEdge( clippedRect[2], clippedRect[3] );\n\tif (n >= 4)\n\t\tsum += integrateLtcBrdfOverRectEdge( clippedRect[3], clippedRect[4] );\n\tif (n == 5)\n\t\tsum += integrateLtcBrdfOverRectEdge( clippedRect[4], clippedRect[0] );\n\tsum = max( 0.0, sum );\n\tvec3 Lo_i = vec3( sum, sum, sum );\n\treturn Lo_i;\n}\nvec3 Rect_Area_Light_Specular_Reflectance(\n\t\tconst in GeometricContext geometry,\n\t\tconst in vec3 lightPos, const in vec3 lightHalfWidth, const in vec3 lightHalfHeight,\n\t\tconst in float roughness,\n\t\tconst in sampler2D ltcMat, const in sampler2D ltcMag ) {\n\tvec3 rectPoints[4];\n\tinitRectPoints( lightPos, lightHalfWidth, lightHalfHeight, rectPoints );\n\tvec2 uv = ltcTextureCoords( geometry, roughness );\n\tvec4 brdfLtcApproxParams, t;\n\tbrdfLtcApproxParams = texture2D( ltcMat, uv );\n\tt = texture2D( ltcMat, uv );\n\tfloat brdfLtcScalar = texture2D( ltcMag, uv ).a;\n\tmat3 brdfLtcApproxMat = mat3(\n\t\tvec3(   1,   0, t.y ),\n\t\tvec3(   0, t.z,   0 ),\n\t\tvec3( t.w,   0, t.x )\n\t);\n\tvec3 specularReflectance = integrateLtcBrdfOverRect( geometry, brdfLtcApproxMat, rectPoints );\n\tspecularReflectance *= brdfLtcScalar;\n\treturn specularReflectance;\n}\nvec3 Rect_Area_Light_Diffuse_Reflectance(\n\t\tconst in GeometricContext geometry,\n\t\tconst in vec3 lightPos, const in vec3 lightHalfWidth, const in vec3 lightHalfHeight ) {\n\tvec3 rectPoints[4];\n\tinitRectPoints( lightPos, lightHalfWidth, lightHalfHeight, rectPoints );\n\tmat3 diffuseBrdfMat = mat3(1);\n\tvec3 diffuseReflectance = integrateLtcBrdfOverRect( geometry, diffuseBrdfMat, rectPoints );\n\treturn diffuseReflectance;\n}\nvec3 BRDF_Specular_GGX_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\n\treturn specularColor * AB.x + AB.y;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = dFdx( surf_pos );\n\t\tvec3 vSigmaY = dFdy( surf_pos );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif\n",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; ++ i ) {\n\t\tvec4 plane = clippingPlanes[ i ];\n\t\tif ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t\t\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; ++ i ) {\n\t\t\tvec4 plane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vViewPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\tif ( clipped ) discard;\n\t\n\t#endif\n#endif\n",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\t#if ! defined( PHYSICAL ) && ! defined( PHONG )\n\t\tvarying vec3 vViewPosition;\n\t#endif\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif\n",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvarying vec3 vViewPosition;\n#endif\n",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n",color_fragment:"#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif\n",color_pars_vertex:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif",common:"#define PI 3.14159265359\n#define PI2 6.28318530718\n#define PI_HALF 1.5707963267949\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transpose( const in mat3 v ) {\n\tmat3 tmp;\n\ttmp[0] = vec3(v[0].x, v[1].x, v[2].x);\n\ttmp[1] = vec3(v[0].y, v[1].y, v[2].y);\n\ttmp[2] = vec3(v[0].z, v[1].z, v[2].z);\n\treturn tmp;\n}\n",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n#define cubeUV_textureSize (1024.0)\nint getFaceFromDirection(vec3 direction) {\n\tvec3 absDirection = abs(direction);\n\tint face = -1;\n\tif( absDirection.x > absDirection.z ) {\n\t\tif(absDirection.x > absDirection.y )\n\t\t\tface = direction.x > 0.0 ? 0 : 3;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\telse {\n\t\tif(absDirection.z > absDirection.y )\n\t\t\tface = direction.z > 0.0 ? 2 : 5;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\treturn face;\n}\n#define cubeUV_maxLods1  (log2(cubeUV_textureSize*0.25) - 1.0)\n#define cubeUV_rangeClamp (exp2((6.0 - 1.0) * 2.0))\nvec2 MipLevelInfo( vec3 vec, float roughnessLevel, float roughness ) {\n\tfloat scale = exp2(cubeUV_maxLods1 - roughnessLevel);\n\tfloat dxRoughness = dFdx(roughness);\n\tfloat dyRoughness = dFdy(roughness);\n\tvec3 dx = dFdx( vec * scale * dxRoughness );\n\tvec3 dy = dFdy( vec * scale * dyRoughness );\n\tfloat d = max( dot( dx, dx ), dot( dy, dy ) );\n\td = clamp(d, 1.0, cubeUV_rangeClamp);\n\tfloat mipLevel = 0.5 * log2(d);\n\treturn vec2(floor(mipLevel), fract(mipLevel));\n}\n#define cubeUV_maxLods2 (log2(cubeUV_textureSize*0.25) - 2.0)\n#define cubeUV_rcpTextureSize (1.0 / cubeUV_textureSize)\nvec2 getCubeUV(vec3 direction, float roughnessLevel, float mipLevel) {\n\tmipLevel = roughnessLevel > cubeUV_maxLods2 - 3.0 ? 0.0 : mipLevel;\n\tfloat a = 16.0 * cubeUV_rcpTextureSize;\n\tvec2 exp2_packed = exp2( vec2( roughnessLevel, mipLevel ) );\n\tvec2 rcp_exp2_packed = vec2( 1.0 ) / exp2_packed;\n\tfloat powScale = exp2_packed.x * exp2_packed.y;\n\tfloat scale = rcp_exp2_packed.x * rcp_exp2_packed.y * 0.25;\n\tfloat mipOffset = 0.75*(1.0 - rcp_exp2_packed.y) * rcp_exp2_packed.x;\n\tbool bRes = mipLevel == 0.0;\n\tscale =  bRes && (scale < a) ? a : scale;\n\tvec3 r;\n\tvec2 offset;\n\tint face = getFaceFromDirection(direction);\n\tfloat rcpPowScale = 1.0 / powScale;\n\tif( face == 0) {\n\t\tr = vec3(direction.x, -direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 1) {\n\t\tr = vec3(direction.y, direction.x, direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 2) {\n\t\tr = vec3(direction.z, direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 3) {\n\t\tr = vec3(direction.x, direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse if( face == 4) {\n\t\tr = vec3(direction.y, direction.x, -direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse {\n\t\tr = vec3(direction.z, -direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\tr = normalize(r);\n\tfloat texelOffset = 0.5 * cubeUV_rcpTextureSize;\n\tvec2 s = ( r.yz / abs( r.x ) + vec2( 1.0 ) ) * 0.5;\n\tvec2 base = offset + vec2( texelOffset );\n\treturn base + s * ( scale - 2.0 * texelOffset );\n}\n#define cubeUV_maxLods3 (log2(cubeUV_textureSize*0.25) - 3.0)\nvec4 textureCubeUV(vec3 reflectedDirection, float roughness ) {\n\tfloat roughnessVal = roughness* cubeUV_maxLods3;\n\tfloat r1 = floor(roughnessVal);\n\tfloat r2 = r1 + 1.0;\n\tfloat t = fract(roughnessVal);\n\tvec2 mipInfo = MipLevelInfo(reflectedDirection, r1, roughness);\n\tfloat s = mipInfo.y;\n\tfloat level0 = mipInfo.x;\n\tfloat level1 = level0 + 1.0;\n\tlevel1 = level1 > 5.0 ? 5.0 : level1;\n\tlevel0 += min( floor( s + 0.5 ), 5.0 );\n\tvec2 uv_10 = getCubeUV(reflectedDirection, r1, level0);\n\tvec4 color10 = envMapTexelToLinear(texture2D(envMap, uv_10));\n\tvec2 uv_20 = getCubeUV(reflectedDirection, r2, level0);\n\tvec4 color20 = envMapTexelToLinear(texture2D(envMap, uv_20));\n\tvec4 result = mix(color10, color20, t);\n\treturn vec4(result.rgb, 1.0);\n}\n#endif\n",defaultnormal_vertex:"#ifdef FLIP_SIDED\n\tobjectNormal = -objectNormal;\n#endif\nvec3 transformedNormal = normalMatrix * objectNormal;\n",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif\n",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normal * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );\n#endif\n",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif\n",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif\n",encodings_fragment:"  gl_FragColor = linearToOutputTexel( gl_FragColor );\n",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.xyz * value.w * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.x, max( value.g, value.b ) );\n\tfloat M      = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM            = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.x, max( value.g, value.b ) );\n\tfloat D      = max( maxRange / maxRGB, 1.0 );\n\tD            = min( floor( D ) / 255.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n\tvec3 Xp_Y_XYZp = value.rgb * cLogLuvM;\n\tXp_Y_XYZp = max(Xp_Y_XYZp, vec3(1e-6, 1e-6, 1e-6));\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract(Le);\n\tvResult.z = (Le - (floor(vResult.w*255.0))/255.0)/255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2((Le - 127.0) / 2.0);\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = Xp_Y_XYZp.rgb * cLogLuvInverseM;\n\treturn vec4( max(vRGB, 0.0), 1.0 );\n}\n",envmap_fragment:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\tsampleUV.y = saturate( flipNormal * reflectVec.y * 0.5 + 0.5 );\n\t\tsampleUV.x = atan( flipNormal * reflectVec.z, flipNormal * reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\tvec3 reflectView = flipNormal * normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\tenvColor = envMapTexelToLinear( envColor );\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif\n",envmap_pars_fragment:"#if defined( USE_ENVMAP ) || defined( PHYSICAL )\n\tuniform float reflectivity;\n\tuniform float envMapIntensity;\n#endif\n#ifdef USE_ENVMAP\n\t#if ! defined( PHYSICAL ) && ( defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) )\n\t\tvarying vec3 vWorldPosition;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\tuniform float flipEnvMap;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( PHYSICAL )\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif\n",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif\n",envmap_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif\n",fog_vertex:"\n#ifdef USE_FOG\nfogDepth = -mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n  varying float fogDepth;\n#endif\n",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * fogDepth * fogDepth * LOG2 ) );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif\n",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif\n",gradientmap_pars_fragment:"#ifdef TOON\n\tuniform sampler2D gradientMap;\n\tvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\t\tfloat dotNL = dot( normal, lightDirection );\n\t\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t\t#ifdef USE_GRADIENTMAP\n\t\t\treturn texture2D( gradientMap, coord ).rgb;\n\t\t#else\n\t\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t\t#endif\n\t}\n#endif\n",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\treflectedLight.indirectDiffuse += PI * texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n#endif\n",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n#if NUM_POINT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_DIR_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvLightFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n#endif\n",lights_pars:"uniform vec3 ambientLightColor;\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltcMat;\tuniform sampler2D ltcMag;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif\n#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( queryVec, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar - 0.79248 - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in GeometricContext geometry, const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -geometry.viewDir, geometry.normal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -geometry.viewDir, geometry.normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( blinnShininessExponent, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\tvec4 envMapColor = textureCubeUV(queryReflectVec, BlinnExponentToGGXRoughness(blinnShininessExponent));\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV;\n\t\t\tsampleUV.y = saturate( reflectVec.y * 0.5 + 0.5 );\n\t\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif\n",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;\n",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_BlinnPhong( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 matDiffColor = material.diffuseColor;\n\t\tvec3 matSpecColor = material.specularColor;\n\t\tvec3 lightColor   = rectAreaLight.color;\n\t\tfloat roughness = BlinnExponentToGGXRoughness( material.specularShininess );\n\t\tvec3 spec = Rect_Area_Light_Specular_Reflectance(\n\t\t\t\tgeometry,\n\t\t\t\trectAreaLight.position, rectAreaLight.halfWidth, rectAreaLight.halfHeight,\n\t\t\t\troughness,\n\t\t\t\tltcMat, ltcMag );\n\t\tvec3 diff = Rect_Area_Light_Diffuse_Reflectance(\n\t\t\t\tgeometry,\n\t\t\t\trectAreaLight.position, rectAreaLight.halfWidth, rectAreaLight.halfHeight );\n\t\treflectedLight.directSpecular += lightColor * matSpecColor * spec / PI2;\n\t\treflectedLight.directDiffuse  += lightColor * matDiffColor * diff / PI2;\n\t}\n#endif\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifdef TOON\n\t\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#else\n\t\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\t\tvec3 irradiance = dotNL * directLight.color;\n\t#endif\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)\n",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nmaterial.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );\n#ifdef STANDARD\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.clearCoat = saturate( clearCoat );\tmaterial.clearCoatRoughness = clamp( clearCoatRoughness, 0.04, 1.0 );\n#endif\n",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n\t#ifndef STANDARD\n\t\tfloat clearCoat;\n\t\tfloat clearCoatRoughness;\n\t#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearCoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 matDiffColor = material.diffuseColor;\n\t\tvec3 matSpecColor = material.specularColor;\n\t\tvec3 lightColor   = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 spec = Rect_Area_Light_Specular_Reflectance(\n\t\t\t\tgeometry,\n\t\t\t\trectAreaLight.position, rectAreaLight.halfWidth, rectAreaLight.halfHeight,\n\t\t\t\troughness,\n\t\t\t\tltcMat, ltcMag );\n\t\tvec3 diff = Rect_Area_Light_Diffuse_Reflectance(\n\t\t\t\tgeometry,\n\t\t\t\trectAreaLight.position, rectAreaLight.halfWidth, rectAreaLight.halfHeight );\n\t\treflectedLight.directSpecular += lightColor * matSpecColor * spec;\n\t\treflectedLight.directDiffuse  += lightColor * matDiffColor * diff;\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifndef STANDARD\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.directSpecular += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry, material.specularColor, material.specularRoughness );\n\treflectedLight.directDiffuse += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\t#ifndef STANDARD\n\t\treflectedLight.directSpecular += irradiance * material.clearCoat * BRDF_Specular_GGX( directLight, geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 clearCoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifndef STANDARD\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\tfloat dotNL = dotNV;\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.indirectSpecular += ( 1.0 - clearCoatDHR ) * radiance * BRDF_Specular_GGX_Environment( geometry, material.specularColor, material.specularRoughness );\n\t#ifndef STANDARD\n\t\treflectedLight.indirectSpecular += clearCoatRadiance * material.clearCoat * BRDF_Specular_GGX_Environment( geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\n#define Material_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.specularRoughness )\n#define Material_ClearCoat_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.clearCoatRoughness )\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}\n",lights_template:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = normalize( vViewPosition );\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( pointLight.shadow, directLight.visible ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( spotLight.shadow, directLight.visible ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( directionalLight.shadow, directLight.visible ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#ifdef USE_LIGHTMAP\n\t\tvec3 lightMapIrradiance = texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tirradiance += getLightProbeIndirectIrradiance( geometry, 8 );\n\t#endif\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tvec3 radiance = getLightProbeIndirectRadiance( geometry, Material_BlinnShininessExponent( material ), 8 );\n\t#ifndef STANDARD\n\t\tvec3 clearCoatRadiance = getLightProbeIndirectRadiance( geometry, Material_ClearCoat_BlinnShininessExponent( material ), 8 );\n\t#else\n\t\tvec3 clearCoatRadiance = vec3( 0.0 );\n\t#endif\n\tRE_IndirectSpecular( radiance, clearCoatRadiance, geometry, material, reflectedLight );\n#endif\n",logdepthbuf_fragment:"#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\n\tgl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#ifdef USE_LOGDEPTHBUF\n\tuniform float logDepthBufFC;\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n#endif\n",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n\tuniform float logDepthBufFC;\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\tgl_Position.z = log2(max( EPSILON, gl_Position.w + 1.0 )) * logDepthBufFC;\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t#else\n\t\tgl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n\t#endif\n#endif\n",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif\n",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n",map_particle_fragment:"#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) * offsetRepeat.zw + offsetRepeat.xy );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n",map_particle_pars_fragment:"#ifdef USE_MAP\n\tuniform vec4 offsetRepeat;\n\tuniform sampler2D map;\n#endif\n",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.r;\n#endif\n",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tobjectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tobjectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tobjectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n#endif\n",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\ttransformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\ttransformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\ttransformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\ttransformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\ttransformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\ttransformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\t#endif\n#endif\n",normal_flip:"#ifdef DOUBLE_SIDED\n\tfloat flipNormal = ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n#else\n\tfloat flipNormal = 1.0;\n#endif\n",normal_fragment:"#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal ) * flipNormal;\n#endif\n#ifdef USE_NORMALMAP\n\tnormal = perturbNormal2Arb( -vViewPosition, normal );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif\n",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 S = normalize( q0 * st1.t - q1 * st0.t );\n\t\tvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n\t\tvec3 N = normalize( surf_norm );\n\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\tmapN.xy = normalScale * mapN.xy;\n\t\tmat3 tsn = mat3( S, T, N );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif\n",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 1.0 - 2.0 * rgb.xyz;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}\n",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif\n",project_vertex:"#ifdef USE_SKINNING\n\tvec4 mvPosition = modelViewMatrix * skinned;\n#else\n\tvec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\n#endif\ngl_Position = projectionMatrix * mvPosition;\n",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.r;\n#endif\n",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tfloat texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {\n\t\tconst vec2 offset = vec2( 0.0, 1.0 );\n\t\tvec2 texelSize = vec2( 1.0 ) / size;\n\t\tvec2 centroidUV = floor( uv * size + 0.5 ) / size;\n\t\tfloat lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );\n\t\tfloat lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );\n\t\tfloat rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );\n\t\tfloat rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );\n\t\tvec2 f = fract( uv * size + 0.5 );\n\t\tfloat a = mix( lb, lt, f.y );\n\t\tfloat b = mix( rb, rt, f.y );\n\t\tfloat c = mix( a, b, f.x );\n\t\treturn c;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\treturn (\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn 1.0;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\tfloat dp = ( length( lightToPosition ) - shadowBias ) / 1000.0;\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif\n",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n#endif\n",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n#endif\n",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tDirectionalLight directionalLight;\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tshadow *= bool( directionalLight.shadow ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tSpotLight spotLight;\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tshadow *= bool( spotLight.shadow ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tPointLight pointLight;\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tshadow *= bool( pointLight.shadow ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#endif\n\treturn shadow;\n}\n",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform sampler2D boneTexture;\n\t\tuniform int boneTextureWidth;\n\t\tuniform int boneTextureHeight;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureWidth ) );\n\t\t\tfloat y = floor( j / float( boneTextureWidth ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureWidth );\n\t\t\tfloat dy = 1.0 / float( boneTextureHeight );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif\n",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\tskinned  = bindMatrixInverse * skinned;\n#endif\n",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n#endif\n",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n  gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif\n",tonemapping_pars_fragment:"#define saturate(a) clamp( a, 0.0, 1.0 )\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\n",uv_pars_fragment:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n\tuniform vec4 offsetRepeat;\n#endif\n",uv_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = uv2;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( PHYSICAL ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\n\t#ifdef USE_SKINNING\n\t\tvec4 worldPosition = modelMatrix * skinned;\n\t#else\n\t\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n\t#endif\n#endif\n",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tgl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );\n\tgl_FragColor.a *= opacity;\n}\n",cube_vert:"varying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}\n",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( gl_FragCoord.z ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( gl_FragCoord.z );\n\t#endif\n}\n",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#include <begin_vertex>\n\t#include <displacementmap_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}\n",distanceRGBA_frag:"uniform vec3 lightPos;\nvarying vec4 vWorldPosition;\n#include <common>\n#include <packing>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tgl_FragColor = packDepthToRGBA( length( vWorldPosition.xyz - lightPos.xyz ) / 1000.0 );\n}\n",distanceRGBA_vert:"varying vec4 vWorldPosition;\n#include <common>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <skinbase_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition;\n}\n",equirect_frag:"uniform sampler2D tEquirect;\nuniform float tFlip;\nvarying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldPosition );\n\tvec2 sampleUV;\n\tsampleUV.y = saturate( tFlip * direction.y * -0.5 + 0.5 );\n\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n}\n",equirect_vert:"varying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}\n",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\tvLineDistance = scale * lineDistance;\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}\n",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\treflectedLight.indirectDiffuse += texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <normal_flip>\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}\n",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <bsdfs>\n#include <lights_pars>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <normal_flip>\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_flip>\n\t#include <normal_fragment>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_template>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <displacementmap_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",meshphysical_frag:"#define PHYSICAL\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifndef STANDARD\n\tuniform float clearCoat;\n\tuniform float clearCoatRoughness;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <lights_pars>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_flip>\n\t#include <normal_fragment>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_template>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",meshphysical_vert:"#define PHYSICAL\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <displacementmap_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\t#include <normal_flip>\n\t#include <normal_fragment>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}\n",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <displacementmap_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}\n",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#ifdef USE_SIZEATTENUATION\n\t\tgl_PointSize = size * ( scale / - mvPosition.z );\n\t#else\n\t\tgl_PointSize = size;\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",shadow_frag:"uniform float opacity;\n#include <common>\n#include <packing>\n#include <bsdfs>\n#include <lights_pars>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( 0.0, 0.0, 0.0, opacity * ( 1.0 - getShadowMask() ) );\n}\n",shadow_vert:"#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n}\n"};function rG(t,e,i){return void 0===e&&void 0===i?this.set(t):this.setRGB(t,e,i)}rG.prototype={constructor:rG,isColor:!0,r:1,g:1,b:1,set:function(t){return t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t),this},setScalar:function(t){return this.r=t,this.g=t,this.b=t,this},setHex:function(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this},setRGB:function(t,e,i){return this.r=t,this.g=e,this.b=i,this},setHSL:function(){function o(t,e,i){return i<0&&(i+=1),1<i&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+6*(e-t)*(2/3-i):t}return function(t,e,i){if(t=UB.euclideanModulo(t,1),e=UB.clamp(e,0,1),i=UB.clamp(i,0,1),0===e)this.r=this.g=this.b=i;else{var n=i<=.5?i*(1+e):i+e-i*e,r=2*i-n;this.r=o(r,n,t+1/3),this.g=o(r,n,t),this.b=o(r,n,t-1/3)}return this}}(),setStyle:function(e){function t(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}var i;if(i=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(e)){var n,r=i[1],o=i[2];switch(r){case"rgb":case"rgba":if(n=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o))return this.r=Math.min(255,parseInt(n[1],10))/255,this.g=Math.min(255,parseInt(n[2],10))/255,this.b=Math.min(255,parseInt(n[3],10))/255,t(n[5]),this;if(n=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o))return this.r=Math.min(100,parseInt(n[1],10))/100,this.g=Math.min(100,parseInt(n[2],10))/100,this.b=Math.min(100,parseInt(n[3],10))/100,t(n[5]),this;break;case"hsl":case"hsla":if(n=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o)){var a=parseFloat(n[1])/360,s=parseInt(n[2],10)/100,l=parseInt(n[3],10)/100;return t(n[5]),this.setHSL(a,s,l)}}}else if(i=/^\#([A-Fa-f0-9]+)$/.exec(e)){var h,c=(h=i[1]).length;if(3===c)return this.r=parseInt(h.charAt(0)+h.charAt(0),16)/255,this.g=parseInt(h.charAt(1)+h.charAt(1),16)/255,this.b=parseInt(h.charAt(2)+h.charAt(2),16)/255,this;if(6===c)return this.r=parseInt(h.charAt(0)+h.charAt(1),16)/255,this.g=parseInt(h.charAt(2)+h.charAt(3),16)/255,this.b=parseInt(h.charAt(4)+h.charAt(5),16)/255,this}e&&0<e.length&&(void 0!==(h=oG[e])?this.setHex(h):console.warn("THREE.Color: Unknown color "+e));return this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this},copyGammaToLinear:function(t,e){return void 0===e&&(e=2),this.r=Math.pow(t.r,e),this.g=Math.pow(t.g,e),this.b=Math.pow(t.b,e),this},copyLinearToGamma:function(t,e){void 0===e&&(e=2);var i=0<e?1/e:1;return this.r=Math.pow(t.r,i),this.g=Math.pow(t.g,i),this.b=Math.pow(t.b,i),this},convertGammaToLinear:function(){var t=this.r,e=this.g,i=this.b;return this.r=t*t,this.g=e*e,this.b=i*i,this},convertLinearToGamma:function(){return this.r=Math.sqrt(this.r),this.g=Math.sqrt(this.g),this.b=Math.sqrt(this.b),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(t){var e,i,n=t||{h:0,s:0,l:0},r=this.r,o=this.g,a=this.b,s=Math.max(r,o,a),l=Math.min(r,o,a),h=(l+s)/2;if(l===s)i=e=0;else{var c=s-l;switch(i=h<=.5?c/(s+l):c/(2-s-l),s){case r:e=(o-a)/c+(o<a?6:0);break;case o:e=(a-r)/c+2;break;case a:e=(r-o)/c+4}e/=6}return n.h=e,n.s=i,n.l=h,n},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(t,e,i){var n=this.getHSL();return n.h+=t,n.s+=e,n.l+=i,this.setHSL(n.h,n.s,n.l),this},add:function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this},addColors:function(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this},addScalar:function(t){return this.r+=t,this.g+=t,this.b+=t,this},sub:function(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this},multiply:function(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this},multiplyScalar:function(t){return this.r*=t,this.g*=t,this.b*=t,this},lerp:function(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this},equals:function(t){return t.r===this.r&&t.g===this.g&&t.b===this.b},fromArray:function(t,e){return void 0===e&&(e=0),this.r=t[e],this.g=t[e+1],this.b=t[e+2],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t},toJSON:function(){return this.getHex()}};var oG={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function aG(t,e,i,n,r,o,a,s,l,h,c,u){uF.call(this,null,o,a,s,l,h,n,r,c,u),this.image={data:t,width:e,height:i},this.magFilter=void 0!==l?l:dB,this.minFilter=void 0!==h?h:dB,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}((aG.prototype=Object.create(uF.prototype)).constructor=aG).prototype.isDataTexture=!0;var sG,lG,hG={common:{diffuse:{value:new rG(15658734)},opacity:{value:1},map:{value:null},offsetRepeat:{value:new dF(0,0,1,1)},specularMap:{value:null},alphaMap:{value:null},envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new WB(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new rG(16777215)}},lights:{ambientLightColor:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new rG(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},offsetRepeat:{value:new dF(0,0,1,1)}}},cG={basic:{uniforms:iG.merge([hG.common,hG.aomap,hG.lightmap,hG.fog]),vertexShader:nG.meshbasic_vert,fragmentShader:nG.meshbasic_frag},lambert:{uniforms:iG.merge([hG.common,hG.aomap,hG.lightmap,hG.emissivemap,hG.fog,hG.lights,{emissive:{value:new rG(0)}}]),vertexShader:nG.meshlambert_vert,fragmentShader:nG.meshlambert_frag},phong:{uniforms:iG.merge([hG.common,hG.aomap,hG.lightmap,hG.emissivemap,hG.bumpmap,hG.normalmap,hG.displacementmap,hG.gradientmap,hG.fog,hG.lights,{emissive:{value:new rG(0)},specular:{value:new rG(1118481)},shininess:{value:30}}]),vertexShader:nG.meshphong_vert,fragmentShader:nG.meshphong_frag},standard:{uniforms:iG.merge([hG.common,hG.aomap,hG.lightmap,hG.emissivemap,hG.bumpmap,hG.normalmap,hG.displacementmap,hG.roughnessmap,hG.metalnessmap,hG.fog,hG.lights,{emissive:{value:new rG(0)},roughness:{value:.5},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:nG.meshphysical_vert,fragmentShader:nG.meshphysical_frag},points:{uniforms:iG.merge([hG.points,hG.fog]),vertexShader:nG.points_vert,fragmentShader:nG.points_frag},dashed:{uniforms:iG.merge([hG.common,hG.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:nG.linedashed_vert,fragmentShader:nG.linedashed_frag},depth:{uniforms:iG.merge([hG.common,hG.displacementmap]),vertexShader:nG.depth_vert,fragmentShader:nG.depth_frag},normal:{uniforms:iG.merge([hG.common,hG.bumpmap,hG.normalmap,hG.displacementmap,{opacity:{value:1}}]),vertexShader:nG.normal_vert,fragmentShader:nG.normal_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:nG.cube_vert,fragmentShader:nG.cube_frag},equirect:{uniforms:{tEquirect:{value:null},tFlip:{value:-1}},vertexShader:nG.equirect_vert,fragmentShader:nG.equirect_frag},distanceRGBA:{uniforms:{lightPos:{value:new mF}},vertexShader:nG.distanceRGBA_vert,fragmentShader:nG.distanceRGBA_frag}};function uG(t,e){this.min=void 0!==t?t:new WB(1/0,1/0),this.max=void 0!==e?e:new WB(-1/0,-1/0)}function dG(y,_){var x,w,s,b,M,S,T,C,A=y.context,E=y.state;function P(){var t,e,i,n,r,o=new Float32Array([-1,-1,0,0,1,-1,1,0,1,1,1,1,-1,1,0,1]),a=new Uint16Array([0,1,2,0,2,3]);x=A.createBuffer(),w=A.createBuffer(),A.bindBuffer(A.ARRAY_BUFFER,x),A.bufferData(A.ARRAY_BUFFER,o,A.STATIC_DRAW),A.bindBuffer(A.ELEMENT_ARRAY_BUFFER,w),A.bufferData(A.ELEMENT_ARRAY_BUFFER,a,A.STATIC_DRAW),T=A.createTexture(),C=A.createTexture(),E.bindTexture(A.TEXTURE_2D,T),A.texImage2D(A.TEXTURE_2D,0,A.RGB,16,16,0,A.RGB,A.UNSIGNED_BYTE,null),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_WRAP_S,A.CLAMP_TO_EDGE),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_WRAP_T,A.CLAMP_TO_EDGE),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MAG_FILTER,A.NEAREST),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MIN_FILTER,A.NEAREST),E.bindTexture(A.TEXTURE_2D,C),A.texImage2D(A.TEXTURE_2D,0,A.RGBA,16,16,0,A.RGBA,A.UNSIGNED_BYTE,null),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_WRAP_S,A.CLAMP_TO_EDGE),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_WRAP_T,A.CLAMP_TO_EDGE),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MAG_FILTER,A.NEAREST),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MIN_FILTER,A.NEAREST),s={vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","uniform sampler2D occlusionMap;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","varying float vVisibility;","void main() {","vUV = uv;","vec2 pos = position;","if ( renderType == 2 ) {","vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );","vVisibility =        visibility.r / 9.0;","vVisibility *= 1.0 - visibility.g / 9.0;","vVisibility *=       visibility.b / 9.0;","vVisibility *= 1.0 - visibility.a / 9.0;","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["uniform lowp int renderType;","uniform sampler2D map;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","varying float vVisibility;","void main() {","if ( renderType == 0 ) {","gl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );","} else if ( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * vVisibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")},t=s,e=A.createProgram(),i=A.createShader(A.FRAGMENT_SHADER),n=A.createShader(A.VERTEX_SHADER),r="precision "+y.getPrecision()+" float;\n",A.shaderSource(i,r+t.fragmentShader),A.shaderSource(n,r+t.vertexShader),A.compileShader(i),A.compileShader(n),A.attachShader(e,i),A.attachShader(e,n),A.linkProgram(e),b=e,M={vertex:A.getAttribLocation(b,"position"),uv:A.getAttribLocation(b,"uv")},S={renderType:A.getUniformLocation(b,"renderType"),map:A.getUniformLocation(b,"map"),occlusionMap:A.getUniformLocation(b,"occlusionMap"),opacity:A.getUniformLocation(b,"opacity"),color:A.getUniformLocation(b,"color"),scale:A.getUniformLocation(b,"scale"),rotation:A.getUniformLocation(b,"rotation"),screenPosition:A.getUniformLocation(b,"screenPosition")}}this.render=function(t,e,i){if(0!==_.length){var n=new mF,r=i.w/i.z,o=.5*i.z,a=.5*i.w,s=16/i.w,l=new WB(s*r,s),h=new mF(1,1,0),c=new WB(1,1),u=new uG;u.min.set(i.x,i.y),u.max.set(i.x+(i.z-16),i.y+(i.w-16)),void 0===b&&P(),A.useProgram(b),E.initAttributes(),E.enableAttribute(M.vertex),E.enableAttribute(M.uv),E.disableUnusedAttributes(),A.uniform1i(S.occlusionMap,0),A.uniform1i(S.map,1),A.bindBuffer(A.ARRAY_BUFFER,x),A.vertexAttribPointer(M.vertex,2,A.FLOAT,!1,16,0),A.vertexAttribPointer(M.uv,2,A.FLOAT,!1,16,8),A.bindBuffer(A.ELEMENT_ARRAY_BUFFER,w),E.disable(A.CULL_FACE),E.setDepthWrite(!1);for(var d=0,p=_.length;d<p;d++){s=16/i.w,l.set(s*r,s);var f=_[d];if(n.set(f.matrixWorld.elements[12],f.matrixWorld.elements[13],f.matrixWorld.elements[14]),n.applyMatrix4(e.matrixWorldInverse),n.applyMatrix4(e.projectionMatrix),h.copy(n),c.x=i.x+h.x*o+o-8,c.y=i.y+h.y*a+a-8,!0===u.containsPoint(c)){E.activeTexture(A.TEXTURE0),E.bindTexture(A.TEXTURE_2D,null),E.activeTexture(A.TEXTURE1),E.bindTexture(A.TEXTURE_2D,T),A.copyTexImage2D(A.TEXTURE_2D,0,A.RGB,c.x,c.y,16,16,0),A.uniform1i(S.renderType,0),A.uniform2f(S.scale,l.x,l.y),A.uniform3f(S.screenPosition,h.x,h.y,h.z),E.disable(A.BLEND),E.enable(A.DEPTH_TEST),A.drawElements(A.TRIANGLES,6,A.UNSIGNED_SHORT,0),E.activeTexture(A.TEXTURE0),E.bindTexture(A.TEXTURE_2D,C),A.copyTexImage2D(A.TEXTURE_2D,0,A.RGBA,c.x,c.y,16,16,0),A.uniform1i(S.renderType,1),E.disable(A.DEPTH_TEST),E.activeTexture(A.TEXTURE1),E.bindTexture(A.TEXTURE_2D,T),A.drawElements(A.TRIANGLES,6,A.UNSIGNED_SHORT,0),f.positionScreen.copy(h),f.customUpdateCallback?f.customUpdateCallback(f):f.updateLensFlares(),A.uniform1i(S.renderType,2),E.enable(A.BLEND);for(var g=0,m=f.lensFlares.length;g<m;g++){var v=f.lensFlares[g];.001<v.opacity&&.001<v.scale&&(h.x=v.x,h.y=v.y,h.z=v.z,s=v.size*v.scale/i.w,l.x=s*r,l.y=s,A.uniform3f(S.screenPosition,h.x,h.y,h.z),A.uniform2f(S.scale,l.x,l.y),A.uniform1f(S.rotation,v.rotation),A.uniform1f(S.opacity,v.opacity),A.uniform3f(S.color,v.color.r,v.color.g,v.color.b),E.setBlending(v.blending,v.blendEquation,v.blendSrc,v.blendDst),y.setTexture2D(v.texture,1),A.drawElements(A.TRIANGLES,6,A.UNSIGNED_SHORT,0))}}}E.enable(A.CULL_FACE),E.enable(A.DEPTH_TEST),E.setDepthWrite(!0),y.resetGLState()}}}function pG(u,d){var p,f,g,m,v,y,_=u.context,x=u.state,w=new mF,b=new gF,M=new mF;function S(){var t,e,i,n=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]),r=new Uint16Array([0,1,2,0,2,3]);p=_.createBuffer(),f=_.createBuffer(),_.bindBuffer(_.ARRAY_BUFFER,p),_.bufferData(_.ARRAY_BUFFER,n,_.STATIC_DRAW),_.bindBuffer(_.ELEMENT_ARRAY_BUFFER,f),_.bufferData(_.ELEMENT_ARRAY_BUFFER,r,_.STATIC_DRAW),t=_.createProgram(),e=_.createShader(_.VERTEX_SHADER),i=_.createShader(_.FRAGMENT_SHADER),_.shaderSource(e,["precision "+u.getPrecision()+" float;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 scale;","uniform vec2 uvOffset;","uniform vec2 uvScale;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uvOffset + uv * uvScale;","vec2 alignedPosition = position * scale;","vec2 rotatedPosition;","rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;","rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;","vec4 finalPosition;","finalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","finalPosition.xy += rotatedPosition;","finalPosition = projectionMatrix * finalPosition;","gl_Position = finalPosition;","}"].join("\n")),_.shaderSource(i,["precision "+u.getPrecision()+" float;","uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","void main() {","vec4 texture = texture2D( map, vUV );","if ( texture.a < alphaTest ) discard;","gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );","if ( fogType > 0 ) {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float fogFactor = 0.0;","if ( fogType == 1 ) {","fogFactor = smoothstep( fogNear, fogFar, depth );","} else {","const float LOG2 = 1.442695;","fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","}","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}","}"].join("\n")),_.compileShader(e),_.compileShader(i),_.attachShader(t,e),_.attachShader(t,i),_.linkProgram(t),g=t,m={position:_.getAttribLocation(g,"position"),uv:_.getAttribLocation(g,"uv")},v={uvOffset:_.getUniformLocation(g,"uvOffset"),uvScale:_.getUniformLocation(g,"uvScale"),rotation:_.getUniformLocation(g,"rotation"),scale:_.getUniformLocation(g,"scale"),color:_.getUniformLocation(g,"color"),map:_.getUniformLocation(g,"map"),opacity:_.getUniformLocation(g,"opacity"),modelViewMatrix:_.getUniformLocation(g,"modelViewMatrix"),projectionMatrix:_.getUniformLocation(g,"projectionMatrix"),fogType:_.getUniformLocation(g,"fogType"),fogDensity:_.getUniformLocation(g,"fogDensity"),fogNear:_.getUniformLocation(g,"fogNear"),fogFar:_.getUniformLocation(g,"fogFar"),fogColor:_.getUniformLocation(g,"fogColor"),alphaTest:_.getUniformLocation(g,"alphaTest")};var o=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");o.width=8,o.height=8;var a=o.getContext("2d");a.fillStyle="white",a.fillRect(0,0,8,8),(y=new uF(o)).needsUpdate=!0}function T(t,e){return t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:e.id-t.id}this.render=function(t,e){if(0!==d.length){void 0===g&&S(),_.useProgram(g),x.initAttributes(),x.enableAttribute(m.position),x.enableAttribute(m.uv),x.disableUnusedAttributes(),x.disable(_.CULL_FACE),x.enable(_.BLEND),_.bindBuffer(_.ARRAY_BUFFER,p),_.vertexAttribPointer(m.position,2,_.FLOAT,!1,16,0),_.vertexAttribPointer(m.uv,2,_.FLOAT,!1,16,8),_.bindBuffer(_.ELEMENT_ARRAY_BUFFER,f),_.uniformMatrix4fv(v.projectionMatrix,!1,e.projectionMatrix.elements),x.activeTexture(_.TEXTURE0),_.uniform1i(v.map,0);var i=0,n=0,r=t.fog;r?(_.uniform3f(v.fogColor,r.color.r,r.color.g,r.color.b),r.isFog?(_.uniform1f(v.fogNear,r.near),_.uniform1f(v.fogFar,r.far),_.uniform1i(v.fogType,1),n=i=1):r.isFogExp2&&(_.uniform1f(v.fogDensity,r.density),_.uniform1i(v.fogType,2),n=i=2)):(_.uniform1i(v.fogType,0),n=i=0);for(var o=0,a=d.length;o<a;o++){(l=d[o]).modelViewMatrix.multiplyMatrices(e.matrixWorldInverse,l.matrixWorld),l.z=-l.modelViewMatrix.elements[14]}d.sort(T);var s=[];for(o=0,a=d.length;o<a;o++){var l,h=(l=d[o]).material;if(!1!==h.visible){_.uniform1f(v.alphaTest,h.alphaTest),_.uniformMatrix4fv(v.modelViewMatrix,!1,l.modelViewMatrix.elements),l.matrixWorld.decompose(w,b,M),s[0]=M.x,s[1]=M.y;var c=0;t.fog&&h.fog&&(c=n),i!==c&&(_.uniform1i(v.fogType,c),i=c),null!==h.map?(_.uniform2f(v.uvOffset,h.map.offset.x,h.map.offset.y),_.uniform2f(v.uvScale,h.map.repeat.x,h.map.repeat.y)):(_.uniform2f(v.uvOffset,0,0),_.uniform2f(v.uvScale,1,1)),_.uniform1f(v.opacity,h.opacity),_.uniform3f(v.color,h.color.r,h.color.g,h.color.b),_.uniform1f(v.rotation,h.rotation),_.uniform2fv(v.scale,s),x.setBlending(h.blending,h.blendEquation,h.blendSrc,h.blendDst),x.setDepthTest(h.depthTest),x.setDepthWrite(h.depthWrite),h.map?u.setTexture2D(h.map,0):u.setTexture2D(y,0),_.drawElements(_.TRIANGLES,6,_.UNSIGNED_SHORT,0)}}x.enable(_.CULL_FACE),u.resetGLState()}}}cG.physical={uniforms:iG.merge([cG.standard.uniforms,{clearCoat:{value:0},clearCoatRoughness:{value:0}}]),vertexShader:nG.meshphysical_vert,fragmentShader:nG.meshphysical_frag},uG.prototype={constructor:uG,set:function(t,e){return this.min.copy(t),this.max.copy(e),this},setFromPoints:function(t){this.makeEmpty();for(var e=0,i=t.length;e<i;e++)this.expandByPoint(t[e]);return this},setFromCenterAndSize:(lG=new WB,function(t,e){var i=lG.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}),clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(t){var e=t||new WB;return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(t){var e=t||new WB;return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByVector:function(t){return this.min.sub(t),this.max.add(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},containsPoint:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y},getParameter:function(t,e){return(e||new WB).set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)},clampPoint:function(t,e){return(e||new WB).copy(t).clamp(this.min,this.max)},distanceToPoint:(sG=new WB,function(t){return sG.copy(t).clamp(this.min,this.max).sub(t).length()}),intersect:function(t){return this.min.max(t.min),this.max.min(t.max),this},union:function(t){return this.min.min(t.min),this.max.max(t.max),this},translate:function(t){return this.min.add(t),this.max.add(t),this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}};var fG,gG,mG,vG,yG,_G,xG,wG,bG,MG,SG,TG,CG,AG,EG,PG,LG,IG,RG,DG,OG,kG,zG,NG,BG,FG,GG,VG,HG,UG,WG=0;function jG(){Object.defineProperty(this,"id",{value:WG++}),this.uuid=UB.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.lights=!0,this.blending=RN,this.side=TN,this.shading=PN,this.vertexColors=LN,this.opacity=1,this.transparent=!1,this.blendSrc=BN,this.blendDst=FN,this.blendEquation=NN,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=UN,this.depthTest=!0,this.depthWrite=!0,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.alphaTest=0,this.premultipliedAlpha=!1,this.overdraw=0,this.visible=!0,this._needsUpdate=!0}function ZG(t){jG.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},(this.index0AttributeName=void 0)!==t&&(void 0!==t.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(t))}function XG(t){jG.call(this),this.type="MeshDepthMaterial",this.depthPacking=VB,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.setValues(t)}function qG(t,e){this.min=void 0!==t?t:new mF(1/0,1/0,1/0),this.max=void 0!==e?e:new mF(-1/0,-1/0,-1/0)}function YG(t,e){this.center=void 0!==t?t:new mF,this.radius=void 0!==e?e:0}function JG(){this.elements=new Float32Array([1,0,0,0,1,0,0,0,1]),0<arguments.length&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}function KG(t,e){this.normal=void 0!==t?t:new mF(1,0,0),this.constant=void 0!==e?e:0}function QG(t,e,i,n,r,o){this.planes=[void 0!==t?t:new KG,void 0!==e?e:new KG,void 0!==i?i:new KG,void 0!==n?n:new KG,void 0!==r?r:new KG,void 0!==o?o:new KG]}function $G(L,t,I,e){var R=L.context,D=L.state,O=new QG,k=new vF,z=t.shadows,N=new WB,B=new WB(e.maxTextureSize,e.maxTextureSize),F=new mF,G=new mF,V=[],m=1,v=2,i=1+(m|v),y=new Array(i),_=new Array(i),x={},H=[new mF(1,0,0),new mF(-1,0,0),new mF(0,0,1),new mF(0,0,-1),new mF(0,1,0),new mF(0,-1,0)],U=[new mF(0,1,0),new mF(0,1,0),new mF(0,1,0),new mF(0,1,0),new mF(0,0,1),new mF(0,0,-1)],W=[new dF,new dF,new dF,new dF,new dF,new dF],n=new XG;n.depthPacking=HB,n.clipping=!0;for(var r=cG.distanceRGBA,o=iG.clone(r.uniforms),a=0;a!==i;++a){var s=0!=(a&m),l=0!=(a&v),h=n.clone();h.morphTargets=s,h.skinning=l,y[a]=h;var c=new ZG({defines:{USE_SHADOWMAP:""},uniforms:o,vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,morphTargets:s,skinning:l,clipping:!0});_[a]=c}var j=this;function Z(t,e,i,n){var r=t.geometry,o=null,a=y,s=t.customDepthMaterial;if(i&&(a=_,s=t.customDistanceMaterial),s)o=s;else{var l=!1;e.morphTargets&&(r&&r.isBufferGeometry?l=r.morphAttributes&&r.morphAttributes.position&&0<r.morphAttributes.position.length:r&&r.isGeometry&&(l=r.morphTargets&&0<r.morphTargets.length));var h=t.isSkinnedMesh&&e.skinning,c=0;l&&(c|=m),h&&(c|=v),o=a[c]}if(L.localClippingEnabled&&!0===e.clipShadows&&0!==e.clippingPlanes.length){var u=o.uuid,d=e.uuid,p=x[u];void 0===p&&(p={},x[u]=p);var f=p[d];void 0===f&&(f=o.clone(),p[d]=f),o=f}o.visible=e.visible,o.wireframe=e.wireframe;var g=e.side;return j.renderSingleSided&&g==AN&&(g=TN),j.renderReverseSided&&(g===TN?g=CN:g===CN&&(g=TN)),o.side=g,o.clipShadows=e.clipShadows,o.clippingPlanes=e.clippingPlanes,o.wireframeLinewidth=e.wireframeLinewidth,o.linewidth=e.linewidth,i&&void 0!==o.uniforms.lightPos&&o.uniforms.lightPos.value.copy(n),o}function X(t,e,i){if(!1!==t.visible){if(0!=(t.layers.mask&e.layers.mask)&&(t.isMesh||t.isLine||t.isPoints))if(t.castShadow&&(!1===t.frustumCulled||!0===O.intersectsObject(t)))!0===t.material.visible&&(t.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,t.matrixWorld),V.push(t));for(var n=t.children,r=0,o=n.length;r<o;r++)X(n[r],e,i)}}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=MN,this.renderReverseSided=!0,this.renderSingleSided=!0,this.render=function(t,e){if(!1!==j.enabled&&(!1!==j.autoUpdate||!1!==j.needsUpdate)&&0!==z.length){var i,n;D.buffers.color.setClear(1,1,1,1),D.disable(R.BLEND),D.setDepthTest(!0),D.setScissorTest(!1);for(var r=0,o=z.length;r<o;r++){var a=z[r],s=a.shadow;if(void 0!==s){var l=s.camera;if(N.copy(s.mapSize),N.min(B),a&&a.isPointLight){i=6,n=!0;var h=N.x,c=N.y;W[0].set(2*h,c,h,c),W[1].set(0,c,h,c),W[2].set(3*h,c,h,c),W[3].set(h,c,h,c),W[4].set(3*h,0,h,c),W[5].set(h,0,h,c),N.x*=4,N.y*=2}else n=!(i=1);if(null===s.map){var u={minFilter:dB,magFilter:dB,format:SB};s.map=new pF(N.x,N.y,u),l.updateProjectionMatrix()}s.isSpotLightShadow&&s.update(a),s&&s.isRectAreaLightShadow&&s.update(a);var d=s.map,p=s.matrix;G.setFromMatrixPosition(a.matrixWorld),l.position.copy(G),L.setRenderTarget(d),L.clear();for(var f=0;f<i;f++){if(n){F.copy(l.position),F.add(H[f]),l.up.copy(U[f]),l.lookAt(F);var g=W[f];D.viewport(g)}else F.setFromMatrixPosition(a.target.matrixWorld),l.lookAt(F);l.updateMatrixWorld(),l.matrixWorldInverse.getInverse(l.matrixWorld),p.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),p.multiply(l.projectionMatrix),p.multiply(l.matrixWorldInverse),k.multiplyMatrices(l.projectionMatrix,l.matrixWorldInverse),O.setFromMatrix(k),V.length=0,X(t,e,l);for(var m=0,v=V.length;m<v;m++){var y=V[m],_=I.update(y),x=y.material;if(x&&x.isMultiMaterial)for(var w=_.groups,b=x.materials,M=0,S=w.length;M<S;M++){var T=w[M],C=b[T.materialIndex];if(!0===C.visible){var A=Z(y,C,n,G);L.renderBufferDirect(l,null,_,A,y,T)}}else{A=Z(y,x,n,G);L.renderBufferDirect(l,null,_,A,y,null)}}}}else console.warn("THREE.WebGLShadowMap:",a,"has no shadow.")}var E=L.getClearColor(),P=L.getClearAlpha();L.setClearColor(E,P),j.needsUpdate=!1}}}function tV(t,e){this.origin=void 0!==t?t:new mF,this.direction=void 0!==e?e:new mF}function eV(t,e,i,n){this._x=t||0,this._y=e||0,this._z=i||0,this._order=n||eV.DefaultOrder}function iV(){this.mask=1}jG.prototype={constructor:jG,isMaterial:!0,get needsUpdate(){return this._needsUpdate},set needsUpdate(t){!0===t&&this.update(),this._needsUpdate=t},setValues:function(t){if(void 0!==t)for(var e in t){var i=t[e];if(void 0!==i){var n=this[e];void 0!==n?n&&n.isColor?n.set(i):n&&n.isVector3&&i&&i.isVector3?n.copy(i):this[e]="overdraw"===e?Number(i):i:console.warn("THREE."+this.type+": '"+e+"' is not a property of this material.")}else console.warn("THREE.Material: '"+e+"' parameter is undefined.")}},toJSON:function(t){var e=void 0===t;e&&(t={textures:{},images:{}});var i={metadata:{version:4.4,type:"Material",generator:"Material.toJSON"}};function n(t){var e=[];for(var i in t){var n=t[i];delete n.metadata,e.push(n)}return e}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),void 0!==this.roughness&&(i.roughness=this.roughness),void 0!==this.metalness&&(i.metalness=this.metalness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),void 0!==this.shininess&&(i.shininess=this.shininess),void 0!==this.clearCoat&&(i.clearCoat=this.clearCoat),void 0!==this.clearCoatRoughness&&(i.clearCoatRoughness=this.clearCoatRoughness),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(t).uuid),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(t).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(t).uuid,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(t).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(t).uuid,i.reflectivity=this.reflectivity),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.size&&(i.size=this.size),void 0!==this.sizeAttenuation&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==RN&&(i.blending=this.blending),this.shading!==PN&&(i.shading=this.shading),this.side!==TN&&(i.side=this.side),this.vertexColors!==LN&&(i.vertexColors=this.vertexColors),this.opacity<1&&(i.opacity=this.opacity),!0===this.transparent&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,0<this.alphaTest&&(i.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(i.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(i.wireframe=this.wireframe),1<this.wireframeLinewidth&&(i.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(i.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(i.wireframeLinejoin=this.wireframeLinejoin),i.skinning=this.skinning,i.morphTargets=this.morphTargets,e){var r=n(t.textures),o=n(t.images);0<r.length&&(i.textures=r),0<o.length&&(i.images=o)}return i},clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.name=t.name,this.fog=t.fog,this.lights=t.lights,this.blending=t.blending,this.side=t.side,this.shading=t.shading,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.alphaTest=t.alphaTest,this.premultipliedAlpha=t.premultipliedAlpha,this.overdraw=t.overdraw,this.visible=t.visible,this.clipShadows=t.clipShadows,this.clipIntersection=t.clipIntersection;var e=t.clippingPlanes,i=null;if(null!==e){var n=e.length;i=new Array(n);for(var r=0;r!==n;++r)i[r]=e[r].clone()}return this.clippingPlanes=i,this},update:function(){this.dispatchEvent({type:"update"})},dispose:function(){this.dispatchEvent({type:"dispose"})}},Object.assign(jG.prototype,pN.prototype),((ZG.prototype=Object.create(jG.prototype)).constructor=ZG).prototype.isShaderMaterial=!0,ZG.prototype.copy=function(t){return jG.prototype.copy.call(this,t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=iG.clone(t.uniforms),this.defines=t.defines,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.lights=t.lights,this.clipping=t.clipping,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.extensions=t.extensions,this},ZG.prototype.toJSON=function(t){var e=jG.prototype.toJSON.call(this,t);return e.uniforms=this.uniforms,e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader,e},((XG.prototype=Object.create(jG.prototype)).constructor=XG).prototype.isMeshDepthMaterial=!0,XG.prototype.copy=function(t){return jG.prototype.copy.call(this,t),this.depthPacking=t.depthPacking,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this},qG.prototype={constructor:qG,isBox3:!0,set:function(t,e){return this.min.copy(t),this.max.copy(e),this},setFromArray:function(t){for(var e=1/0,i=1/0,n=1/0,r=-1/0,o=-1/0,a=-1/0,s=0,l=t.length;s<l;s+=3){var h=t[s],c=t[s+1],u=t[s+2];h<e&&(e=h),c<i&&(i=c),u<n&&(n=u),r<h&&(r=h),o<c&&(o=c),a<u&&(a=u)}return this.min.set(e,i,n),this.max.set(r,o,a),this},setFromBufferAttribute:function(t){for(var e=1/0,i=1/0,n=1/0,r=-1/0,o=-1/0,a=-1/0,s=0,l=t.count;s<l;s++){var h=t.getX(s),c=t.getY(s),u=t.getZ(s);h<e&&(e=h),c<i&&(i=c),u<n&&(n=u),r<h&&(r=h),o<c&&(o=c),a<u&&(a=u)}return this.min.set(e,i,n),this.max.set(r,o,a),this},setFromPoints:function(t){this.makeEmpty();for(var e=0,i=t.length;e<i;e++)this.expandByPoint(t[e]);return this},setFromCenterAndSize:(_G=new mF,function(t,e){var i=_G.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}),setFromObject:function(t){return this.makeEmpty(),this.expandByObject(t)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(t){var e=t||new mF;return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(t){var e=t||new mF;return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByVector:function(t){return this.min.sub(t),this.max.add(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},expandByObject:(yG=new mF,function(t){var a=this;return t.updateMatrixWorld(!0),t.traverse(function(t){var e,i,n=t.geometry;if(void 0!==n)if(n.isGeometry){var r=n.vertices;for(e=0,i=r.length;e<i;e++)yG.copy(r[e]),yG.applyMatrix4(t.matrixWorld),a.expandByPoint(yG)}else if(n.isBufferGeometry){var o=n.attributes.position;if(void 0!==o)for(e=0,i=o.count;e<i;e++)yG.fromBufferAttribute(o,e).applyMatrix4(t.matrixWorld),a.expandByPoint(yG)}}),this}),containsPoint:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z},getParameter:function(t,e){return(e||new mF).set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)},intersectsSphere:function(t){return void 0===vG&&(vG=new mF),this.clampPoint(t.center,vG),vG.distanceToSquared(t.center)<=t.radius*t.radius},intersectsPlane:function(t){var e,i;return 0<t.normal.x?(e=t.normal.x*this.min.x,i=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,i=t.normal.x*this.min.x),0<t.normal.y?(e+=t.normal.y*this.min.y,i+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,i+=t.normal.y*this.min.y),0<t.normal.z?(e+=t.normal.z*this.min.z,i+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,i+=t.normal.z*this.min.z),e<=t.constant&&i>=t.constant},clampPoint:function(t,e){return(e||new mF).copy(t).clamp(this.min,this.max)},distanceToPoint:(mG=new mF,function(t){return mG.copy(t).clamp(this.min,this.max).sub(t).length()}),getBoundingSphere:(gG=new mF,function(t){var e=t||new YG;return this.getCenter(e.center),e.radius=.5*this.getSize(gG).length(),e}),intersect:function(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this},union:function(t){return this.min.min(t.min),this.max.max(t.max),this},applyMatrix4:(fG=[new mF,new mF,new mF,new mF,new mF,new mF,new mF,new mF],function(t){return this.isEmpty()||(fG[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),fG[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),fG[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),fG[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),fG[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),fG[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),fG[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),fG[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(fG)),this}),translate:function(t){return this.min.add(t),this.max.add(t),this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}},YG.prototype={constructor:YG,set:function(t,e){return this.center.copy(t),this.radius=e,this},setFromPoints:function(t,e){void 0===xG&&(xG=new qG);var i=this.center;void 0!==e?i.copy(e):xG.setFromPoints(t).getCenter(i);for(var n=0,r=0,o=t.length;r<o;r++)n=Math.max(n,i.distanceToSquared(t[r]));return this.radius=Math.sqrt(n),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.center.copy(t.center),this.radius=t.radius,this},empty:function(){return this.radius<=0},containsPoint:function(t){return t.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(t){return t.distanceTo(this.center)-this.radius},intersectsSphere:function(t){var e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e},intersectsBox:function(t){return t.intersectsSphere(this)},intersectsPlane:function(t){return Math.abs(this.center.dot(t.normal)-t.constant)<=this.radius},clampPoint:function(t,e){var i=this.center.distanceToSquared(t),n=e||new mF;return n.copy(t),i>this.radius*this.radius&&(n.sub(this.center).normalize(),n.multiplyScalar(this.radius).add(this.center)),n},getBoundingBox:function(t){var e=t||new qG;return e.set(this.center,this.center),e.expandByScalar(this.radius),e},applyMatrix4:function(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this},translate:function(t){return this.center.add(t),this},equals:function(t){return t.center.equals(this.center)&&t.radius===this.radius}},JG.prototype={constructor:JG,isMatrix3:!0,set:function(t,e,i,n,r,o,a,s,l){var h=this.elements;return h[0]=t,h[1]=n,h[2]=a,h[3]=e,h[4]=r,h[5]=s,h[6]=i,h[7]=o,h[8]=l,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(t){var e=t.elements;return this.set(e[0],e[3],e[6],e[1],e[4],e[7],e[2],e[5],e[8]),this},setFromMatrix4:function(t){var e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this},applyToBufferAttribute:function(t){void 0===wG&&(wG=new mF);for(var e=0,i=t.count;e<i;e++)wG.x=t.getX(e),wG.y=t.getY(e),wG.z=t.getZ(e),wG.applyMatrix3(this),t.setXYZ(e,wG.x,wG.y,wG.z);return t},multiplyScalar:function(t){var e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this},determinant:function(){var t=this.elements,e=t[0],i=t[1],n=t[2],r=t[3],o=t[4],a=t[5],s=t[6],l=t[7],h=t[8];return e*o*h-e*a*l-i*r*h+i*a*s+n*r*l-n*o*s},getInverse:function(t,e){t&&t.isMatrix4&&console.error("THREE.Matrix3.getInverse no longer takes a Matrix4 argument.");var i=t.elements,n=this.elements,r=i[0],o=i[1],a=i[2],s=i[3],l=i[4],h=i[5],c=i[6],u=i[7],d=i[8],p=d*l-h*u,f=h*c-d*s,g=u*s-l*c,m=r*p+o*f+a*g;if(0===m){var v="THREE.Matrix3.getInverse(): can't invert matrix, determinant is 0";if(!0===e)throw new Error(v);return console.warn(v),this.identity()}var y=1/m;return n[0]=p*y,n[1]=(a*u-d*o)*y,n[2]=(h*o-a*l)*y,n[3]=f*y,n[4]=(d*r-a*c)*y,n[5]=(a*s-h*r)*y,n[6]=g*y,n[7]=(o*c-u*r)*y,n[8]=(l*r-o*s)*y,this},transpose:function(){var t,e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this},getNormalMatrix:function(t){return this.setFromMatrix4(t).getInverse(this).transpose()},transposeIntoArray:function(t){var e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this},fromArray:function(t,e){void 0===e&&(e=0);for(var i=0;i<9;i++)this.elements[i]=t[i+e];return this},toArray:function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);var i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t}},KG.prototype={constructor:KG,set:function(t,e){return this.normal.copy(t),this.constant=e,this},setComponents:function(t,e,i,n){return this.normal.set(t,e,i),this.constant=n,this},setFromNormalAndCoplanarPoint:function(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this},setFromCoplanarPoints:(TG=new mF,CG=new mF,function(t,e,i){var n=TG.subVectors(i,e).cross(CG.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(n,t),this}),clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.normal.copy(t.normal),this.constant=t.constant,this},normalize:function(){var t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(t){return this.normal.dot(t)+this.constant},distanceToSphere:function(t){return this.distanceToPoint(t.center)-t.radius},projectPoint:function(t,e){return this.orthoPoint(t,e).sub(t).negate()},orthoPoint:function(t,e){var i=this.distanceToPoint(t);return(e||new mF).copy(this.normal).multiplyScalar(i)},intersectLine:(SG=new mF,function(t,e){var i=e||new mF,n=t.delta(SG),r=this.normal.dot(n);if(0===r)return 0===this.distanceToPoint(t.start)?i.copy(t.start):void 0;var o=-(t.start.dot(this.normal)+this.constant)/r;return o<0||1<o?void 0:i.copy(n).multiplyScalar(o).add(t.start)}),intersectsLine:function(t){var e=this.distanceToPoint(t.start),i=this.distanceToPoint(t.end);return e<0&&0<i||i<0&&0<e},intersectsBox:function(t){return t.intersectsPlane(this)},intersectsSphere:function(t){return t.intersectsPlane(this)},coplanarPoint:function(t){return(t||new mF).copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:(bG=new mF,MG=new JG,function(t,e){var i=this.coplanarPoint(bG).applyMatrix4(t),n=e||MG.getNormalMatrix(t),r=this.normal.applyMatrix3(n).normalize();return this.constant=-i.dot(r),this}),translate:function(t){return this.constant=this.constant-t.dot(this.normal),this},equals:function(t){return t.normal.equals(this.normal)&&t.constant===this.constant}},QG.prototype={constructor:QG,set:function(t,e,i,n,r,o){var a=this.planes;return a[0].copy(t),a[1].copy(e),a[2].copy(i),a[3].copy(n),a[4].copy(r),a[5].copy(o),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){for(var e=this.planes,i=0;i<6;i++)e[i].copy(t.planes[i]);return this},setFromMatrix:function(t){var e=this.planes,i=t.elements,n=i[0],r=i[1],o=i[2],a=i[3],s=i[4],l=i[5],h=i[6],c=i[7],u=i[8],d=i[9],p=i[10],f=i[11],g=i[12],m=i[13],v=i[14],y=i[15];return e[0].setComponents(a-n,c-s,f-u,y-g).normalize(),e[1].setComponents(a+n,c+s,f+u,y+g).normalize(),e[2].setComponents(a+r,c+l,f+d,y+m).normalize(),e[3].setComponents(a-r,c-l,f-d,y-m).normalize(),e[4].setComponents(a-o,c-h,f-p,y-v).normalize(),e[5].setComponents(a+o,c+h,f+p,y+v).normalize(),this},intersectsObject:(LG=new YG,function(t){var e=t.geometry;return null===e.boundingSphere&&e.computeBoundingSphere(),LG.copy(e.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(LG)}),intersectsSprite:(PG=new YG,function(t){return PG.center.set(0,0,0),PG.radius=.7071067811865476,PG.applyMatrix4(t.matrixWorld),this.intersectsSphere(PG)}),intersectsSphere:function(t){for(var e=this.planes,i=t.center,n=-t.radius,r=0;r<6;r++){if(e[r].distanceToPoint(i)<n)return!1}return!0},intersectsBox:(AG=new mF,EG=new mF,function(t){for(var e=this.planes,i=0;i<6;i++){var n=e[i];AG.x=0<n.normal.x?t.min.x:t.max.x,EG.x=0<n.normal.x?t.max.x:t.min.x,AG.y=0<n.normal.y?t.min.y:t.max.y,EG.y=0<n.normal.y?t.max.y:t.min.y,AG.z=0<n.normal.z?t.min.z:t.max.z,EG.z=0<n.normal.z?t.max.z:t.min.z;var r=n.distanceToPoint(AG),o=n.distanceToPoint(EG);if(r<0&&o<0)return!1}return!0}),containsPoint:function(t){for(var e=this.planes,i=0;i<6;i++)if(e[i].distanceToPoint(t)<0)return!1;return!0}},tV.prototype={constructor:tV,set:function(t,e){return this.origin.copy(t),this.direction.copy(e),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this},at:function(t,e){return(e||new mF).copy(this.direction).multiplyScalar(t).add(this.origin)},lookAt:function(t){return this.direction.copy(t).sub(this.origin).normalize(),this},recast:(VG=new mF,function(t){return this.origin.copy(this.at(t,VG)),this}),closestPointToPoint:function(t,e){var i=e||new mF;i.subVectors(t,this.origin);var n=i.dot(this.direction);return n<0?i.copy(this.origin):i.copy(this.direction).multiplyScalar(n).add(this.origin)},distanceToPoint:function(t){return Math.sqrt(this.distanceSqToPoint(t))},distanceSqToPoint:(GG=new mF,function(t){var e=GG.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(GG.copy(this.direction).multiplyScalar(e).add(this.origin),GG.distanceToSquared(t))}),distanceSqToSegment:(NG=new mF,BG=new mF,FG=new mF,function(t,e,i,n){NG.copy(t).add(e).multiplyScalar(.5),BG.copy(e).sub(t).normalize(),FG.copy(this.origin).sub(NG);var r,o,a,s,l=.5*t.distanceTo(e),h=-this.direction.dot(BG),c=FG.dot(this.direction),u=-FG.dot(BG),d=FG.lengthSq(),p=Math.abs(1-h*h);if(0<p)if(o=h*c-u,s=l*p,0<=(r=h*u-c))if(-s<=o)if(o<=s){var f=1/p;a=(r*=f)*(r+h*(o*=f)+2*c)+o*(h*r+o+2*u)+d}else o=l,a=-(r=Math.max(0,-(h*o+c)))*r+o*(o+2*u)+d;else o=-l,a=-(r=Math.max(0,-(h*o+c)))*r+o*(o+2*u)+d;else o<=-s?a=-(r=Math.max(0,-(-h*l+c)))*r+(o=0<r?-l:Math.min(Math.max(-l,-u),l))*(o+2*u)+d:o<=s?(r=0,a=(o=Math.min(Math.max(-l,-u),l))*(o+2*u)+d):a=-(r=Math.max(0,-(h*l+c)))*r+(o=0<r?l:Math.min(Math.max(-l,-u),l))*(o+2*u)+d;else o=0<h?-l:l,a=-(r=Math.max(0,-(h*o+c)))*r+o*(o+2*u)+d;return i&&i.copy(this.direction).multiplyScalar(r).add(this.origin),n&&n.copy(BG).multiplyScalar(o).add(NG),a}),intersectSphere:(zG=new mF,function(t,e){zG.subVectors(t.center,this.origin);var i=zG.dot(this.direction),n=zG.dot(zG)-i*i,r=t.radius*t.radius;if(r<n)return null;var o=Math.sqrt(r-n),a=i-o,s=i+o;return a<0&&s<0?null:a<0?this.at(s,e):this.at(a,e)}),intersectsSphere:function(t){return this.distanceToPoint(t.center)<=t.radius},distanceToPlane:function(t){var e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;var i=-(this.origin.dot(t.normal)+t.constant)/e;return 0<=i?i:null},intersectPlane:function(t,e){var i=this.distanceToPlane(t);return null===i?null:this.at(i,e)},intersectsPlane:function(t){var e=t.distanceToPoint(this.origin);return 0===e||t.normal.dot(this.direction)*e<0},intersectBox:function(t,e){var i,n,r,o,a,s,l=1/this.direction.x,h=1/this.direction.y,c=1/this.direction.z,u=this.origin;return 0<=l?(i=(t.min.x-u.x)*l,n=(t.max.x-u.x)*l):(i=(t.max.x-u.x)*l,n=(t.min.x-u.x)*l),0<=h?(r=(t.min.y-u.y)*h,o=(t.max.y-u.y)*h):(r=(t.max.y-u.y)*h,o=(t.min.y-u.y)*h),o<i||n<r?null:((i<r||i!=i)&&(i=r),(o<n||n!=n)&&(n=o),0<=c?(a=(t.min.z-u.z)*c,s=(t.max.z-u.z)*c):(a=(t.max.z-u.z)*c,s=(t.min.z-u.z)*c),s<i||n<a?null:((i<a||i!=i)&&(i=a),(s<n||n!=n)&&(n=s),n<0?null:this.at(0<=i?i:n,e)))},intersectsBox:(kG=new mF,function(t){return null!==this.intersectBox(t,kG)}),intersectTriangle:(IG=new mF,RG=new mF,DG=new mF,OG=new mF,function(t,e,i,n,r){RG.subVectors(e,t),DG.subVectors(i,t),OG.crossVectors(RG,DG);var o,a=this.direction.dot(OG);if(0<a){if(n)return null;o=1}else{if(!(a<0))return null;o=-1,a=-a}IG.subVectors(this.origin,t);var s=o*this.direction.dot(DG.crossVectors(IG,DG));if(s<0)return null;var l=o*this.direction.dot(RG.cross(IG));if(l<0)return null;if(a<s+l)return null;var h=-o*IG.dot(OG);return h<0?null:this.at(h/a,r)}),applyMatrix4:function(t){return this.direction.add(this.origin).applyMatrix4(t),this.origin.applyMatrix4(t),this.direction.sub(this.origin),this.direction.normalize(),this},equals:function(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}},eV.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],eV.DefaultOrder="XYZ",eV.prototype={constructor:eV,isEuler:!0,get x(){return this._x},set x(t){this._x=t,this.onChangeCallback()},get y(){return this._y},set y(t){this._y=t,this.onChangeCallback()},get z(){return this._z},set z(t){this._z=t,this.onChangeCallback()},get order(){return this._order},set order(t){this._order=t,this.onChangeCallback()},set:function(t,e,i,n){return this._x=t,this._y=e,this._z=i,this._order=n||this._order,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this.onChangeCallback(),this},setFromRotationMatrix:function(t,e,i){var n=UB.clamp,r=t.elements,o=r[0],a=r[4],s=r[8],l=r[1],h=r[5],c=r[9],u=r[2],d=r[6],p=r[10];return"XYZ"===(e=e||this._order)?(this._y=Math.asin(n(s,-1,1)),Math.abs(s)<.99999?(this._x=Math.atan2(-c,p),this._z=Math.atan2(-a,o)):(this._x=Math.atan2(d,h),this._z=0)):"YXZ"===e?(this._x=Math.asin(-n(c,-1,1)),Math.abs(c)<.99999?(this._y=Math.atan2(s,p),this._z=Math.atan2(l,h)):(this._y=Math.atan2(-u,o),this._z=0)):"ZXY"===e?(this._x=Math.asin(n(d,-1,1)),Math.abs(d)<.99999?(this._y=Math.atan2(-u,p),this._z=Math.atan2(-a,h)):(this._y=0,this._z=Math.atan2(l,o))):"ZYX"===e?(this._y=Math.asin(-n(u,-1,1)),Math.abs(u)<.99999?(this._x=Math.atan2(d,p),this._z=Math.atan2(l,o)):(this._x=0,this._z=Math.atan2(-a,h))):"YZX"===e?(this._z=Math.asin(n(l,-1,1)),Math.abs(l)<.99999?(this._x=Math.atan2(-c,h),this._y=Math.atan2(-u,o)):(this._x=0,this._y=Math.atan2(s,p))):"XZY"===e?(this._z=Math.asin(-n(a,-1,1)),Math.abs(a)<.99999?(this._x=Math.atan2(d,h),this._y=Math.atan2(s,o)):(this._x=Math.atan2(-c,p),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+e),this._order=e,!1!==i&&this.onChangeCallback(),this},setFromQuaternion:function(t,e,i){return void 0===UG&&(UG=new vF),UG.makeRotationFromQuaternion(t),this.setFromRotationMatrix(UG,e,i)},setFromVector3:function(t,e){return this.set(t.x,t.y,t.z,e||this._order)},reorder:(HG=new gF,function(t){return HG.setFromEuler(this),this.setFromQuaternion(HG,t)}),equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order},fromArray:function(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this.onChangeCallback(),this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t},toVector3:function(t){return t?t.set(this._x,this._y,this._z):new mF(this._x,this._y,this._z)},onChange:function(t){return this.onChangeCallback=t,this},onChangeCallback:function(){}},iV.prototype={constructor:iV,set:function(t){this.mask=1<<t},enable:function(t){this.mask|=1<<t},toggle:function(t){this.mask^=1<<t},disable:function(t){this.mask&=~(1<<t)},test:function(t){return 0!=(this.mask&t.mask)}};var nV,rV,oV,aV,sV,lV,hV,cV,uV,dV,pV,fV,gV,mV,vV,yV,_V,xV,wV,bV,MV,SV,TV,CV,AV,EV,PV,LV,IV,RV=0;function DV(){Object.defineProperty(this,"id",{value:RV++}),this.uuid=UB.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=DV.DefaultUp.clone();var t=new mF,e=new eV,i=new gF,n=new mF(1,1,1);e.onChange(function(){i.setFromEuler(e,!1)}),i.onChange(function(){e.setFromQuaternion(i,void 0,!1)}),Object.defineProperties(this,{position:{enumerable:!0,value:t},rotation:{enumerable:!0,value:e},quaternion:{enumerable:!0,value:i},scale:{enumerable:!0,value:n},modelViewMatrix:{value:new vF},normalMatrix:{value:new JG}}),this.matrix=new vF,this.matrixWorld=new vF,this.matrixAutoUpdate=DV.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new iV,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={},this.onBeforeRender=function(){},this.onAfterRender=function(){}}function OV(t,e){this.start=void 0!==t?t:new mF,this.end=void 0!==e?e:new mF}function kV(t,e,i){this.a=void 0!==t?t:new mF,this.b=void 0!==e?e:new mF,this.c=void 0!==i?i:new mF}function zV(t,e,i,n,r,o){this.a=t,this.b=e,this.c=i,this.normal=n&&n.isVector3?n:new mF,this.vertexNormals=Array.isArray(n)?n:[],this.color=r&&r.isColor?r:new rG,this.vertexColors=Array.isArray(r)?r:[],this.materialIndex=void 0!==o?o:0}function NV(t){jG.call(this),this.type="MeshBasicMaterial",this.color=new rG(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=qN,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.lights=!1,this.setValues(t)}function BV(t,e,i){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.uuid=UB.generateUUID(),this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=!0===i,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.onUploadCallback=function(){},this.version=0}function FV(t,e){BV.call(this,new Int8Array(t),e)}function GV(t,e){BV.call(this,new Uint8Array(t),e)}function VV(t,e){BV.call(this,new Uint8ClampedArray(t),e)}function HV(t,e){BV.call(this,new Int16Array(t),e)}function UV(t,e){BV.call(this,new Uint16Array(t),e)}function WV(t,e){BV.call(this,new Int32Array(t),e)}function jV(t,e){BV.call(this,new Uint32Array(t),e)}function ZV(t,e){BV.call(this,new Float32Array(t),e)}function XV(t,e){BV.call(this,new Float64Array(t),e)}function qV(){this.indices=[],this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}function YV(t){for(var e=t.length,i=-1/0;e--;)t[e]>i&&(i=t[e]);return i}DV.DefaultUp=new mF(0,1,0),DV.DefaultMatrixAutoUpdate=!0,DV.prototype={constructor:DV,isObject3D:!0,applyMatrix:function(t){this.matrix.multiplyMatrices(t,this.matrix),this.matrix.decompose(this.position,this.quaternion,this.scale)},setRotationFromAxisAngle:function(t,e){this.quaternion.setFromAxisAngle(t,e)},setRotationFromEuler:function(t){this.quaternion.setFromEuler(t,!0)},setRotationFromMatrix:function(t){this.quaternion.setFromRotationMatrix(t)},setRotationFromQuaternion:function(t){this.quaternion.copy(t)},rotateOnAxis:(yV=new gF,function(t,e){return yV.setFromAxisAngle(t,e),this.quaternion.multiply(yV),this}),rotateX:(vV=new mF(1,0,0),function(t){return this.rotateOnAxis(vV,t)}),rotateY:(mV=new mF(0,1,0),function(t){return this.rotateOnAxis(mV,t)}),rotateZ:(gV=new mF(0,0,1),function(t){return this.rotateOnAxis(gV,t)}),translateOnAxis:(fV=new mF,function(t,e){return fV.copy(t).applyQuaternion(this.quaternion),this.position.add(fV.multiplyScalar(e)),this}),translateX:(pV=new mF(1,0,0),function(t){return this.translateOnAxis(pV,t)}),translateY:(dV=new mF(0,1,0),function(t){return this.translateOnAxis(dV,t)}),translateZ:(uV=new mF(0,0,1),function(t){return this.translateOnAxis(uV,t)}),localToWorld:function(t){return t.applyMatrix4(this.matrixWorld)},worldToLocal:(cV=new vF,function(t){return t.applyMatrix4(cV.getInverse(this.matrixWorld))}),lookAt:(hV=new vF,function(t){hV.lookAt(t,this.position,this.up),this.quaternion.setFromRotationMatrix(hV)}),add:function(t){if(1<arguments.length){for(var e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return t===this?console.error("THREE.Object3D.add: object can't be added as a child of itself.",t):t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,t.dispatchEvent({type:"added"}),this.children.push(t)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this},remove:function(t){if(1<arguments.length)for(var e=0;e<arguments.length;e++)this.remove(arguments[e]);var i=this.children.indexOf(t);-1!==i&&(t.parent=null,t.dispatchEvent({type:"removed"}),this.children.splice(i,1))},getObjectById:function(t){return this.getObjectByProperty("id",t)},getObjectByName:function(t){return this.getObjectByProperty("name",t)},getObjectByProperty:function(t,e){if(this[t]===e)return this;for(var i=0,n=this.children.length;i<n;i++){var r=this.children[i].getObjectByProperty(t,e);if(void 0!==r)return r}},getWorldPosition:function(t){var e=t||new mF;return this.updateMatrixWorld(!0),e.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:(sV=new mF,lV=new mF,function(t){var e=t||new gF;return this.updateMatrixWorld(!0),this.matrixWorld.decompose(sV,e,lV),e}),getWorldRotation:(aV=new gF,function(t){var e=t||new eV;return this.getWorldQuaternion(aV),e.setFromQuaternion(aV,this.rotation.order,!1)}),getWorldScale:(rV=new mF,oV=new gF,function(t){var e=t||new mF;return this.updateMatrixWorld(!0),this.matrixWorld.decompose(rV,oV,e),e}),getWorldDirection:(nV=new gF,function(t){var e=t||new mF;return this.getWorldQuaternion(nV),e.set(0,0,1).applyQuaternion(nV)}),raycast:function(){},traverse:function(t){t(this);for(var e=this.children,i=0,n=e.length;i<n;i++)e[i].traverse(t)},traverseVisible:function(t){if(!1!==this.visible){t(this);for(var e=this.children,i=0,n=e.length;i<n;i++)e[i].traverseVisible(t)}},traverseAncestors:function(t){var e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(t){!0===this.matrixAutoUpdate&&this.updateMatrix(),!0!==this.matrixWorldNeedsUpdate&&!0!==t||(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t=!(this.matrixWorldNeedsUpdate=!1));for(var e=this.children,i=0,n=e.length;i<n;i++)e[i].updateMatrixWorld(t)},toJSON:function(t){var e=void 0===t||""===t,i={};e&&(t={geometries:{},materials:{},textures:{},images:{}},i.metadata={version:4.4,type:"Object",generator:"Object3D.toJSON"});var n={};if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),!0===this.castShadow&&(n.castShadow=!0),!0===this.receiveShadow&&(n.receiveShadow=!0),!1===this.visible&&(n.visible=!1),n.matrix=this.matrix.toArray(),void 0!==this.geometry&&(void 0===t.geometries[this.geometry.uuid]&&(t.geometries[this.geometry.uuid]=this.geometry.toJSON(t)),n.geometry=this.geometry.uuid),void 0!==this.material&&(void 0===t.materials[this.material.uuid]&&(t.materials[this.material.uuid]=this.material.toJSON(t)),n.material=this.material.uuid),0<this.children.length){n.children=[];for(var r=0;r<this.children.length;r++)n.children.push(this.children[r].toJSON(t).object)}if(e){var o=h(t.geometries),a=h(t.materials),s=h(t.textures),l=h(t.images);0<o.length&&(i.geometries=o),0<a.length&&(i.materials=a),0<s.length&&(i.textures=s),0<l.length&&(i.images=l)}return i.object=n,i;function h(t){var e=[];for(var i in t){var n=t[i];delete n.metadata,e.push(n)}return e}},clone:function(t){return(new this.constructor).copy(this,t)},copy:function(t,e){if(void 0===e&&(e=!0),this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(var i=0;i<t.children.length;i++){var n=t.children[i];this.add(n.clone())}return this}},Object.assign(DV.prototype,pN.prototype),OV.prototype={constructor:OV,set:function(t,e){return this.start.copy(t),this.end.copy(e),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.start.copy(t.start),this.end.copy(t.end),this},getCenter:function(t){return(t||new mF).addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(t){return(t||new mF).subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(t,e){var i=e||new mF;return this.delta(i).multiplyScalar(t).add(this.start)},closestPointToPointParameter:(_V=new mF,xV=new mF,function(t,e){_V.subVectors(t,this.start),xV.subVectors(this.end,this.start);var i=xV.dot(xV),n=xV.dot(_V)/i;return e&&(n=UB.clamp(n,0,1)),n}),closestPointToPoint:function(t,e,i){var n=this.closestPointToPointParameter(t,e),r=i||new mF;return this.delta(r).multiplyScalar(n).add(this.start)},applyMatrix4:function(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this},equals:function(t){return t.start.equals(this.start)&&t.end.equals(this.end)}},kV.normal=(wV=new mF,function(t,e,i,n){var r=n||new mF;r.subVectors(i,e),wV.subVectors(t,e),r.cross(wV);var o=r.lengthSq();return 0<o?r.multiplyScalar(1/Math.sqrt(o)):r.set(0,0,0)}),kV.barycoordFromPoint=(bV=new mF,MV=new mF,SV=new mF,function(t,e,i,n,r){bV.subVectors(n,e),MV.subVectors(i,e),SV.subVectors(t,e);var o=bV.dot(bV),a=bV.dot(MV),s=bV.dot(SV),l=MV.dot(MV),h=MV.dot(SV),c=o*l-a*a,u=r||new mF;if(0===c)return u.set(-2,-1,-1);var d=1/c,p=(l*s-a*h)*d,f=(o*h-a*s)*d;return u.set(1-p-f,f,p)}),kV.containsPoint=(TV=new mF,function(t,e,i,n){var r=kV.barycoordFromPoint(t,e,i,n,TV);return 0<=r.x&&0<=r.y&&r.x+r.y<=1}),kV.prototype={constructor:kV,set:function(t,e,i){return this.a.copy(t),this.b.copy(e),this.c.copy(i),this},setFromPointsAndIndices:function(t,e,i,n){return this.a.copy(t[e]),this.b.copy(t[i]),this.c.copy(t[n]),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this},area:(LV=new mF,IV=new mF,function(){return LV.subVectors(this.c,this.b),IV.subVectors(this.a,this.b),.5*LV.cross(IV).length()}),midpoint:function(t){return(t||new mF).addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(t){return kV.normal(this.a,this.b,this.c,t)},plane:function(t){return(t||new KG).setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(t,e){return kV.barycoordFromPoint(t,this.a,this.b,this.c,e)},containsPoint:function(t){return kV.containsPoint(t,this.a,this.b,this.c)},closestPointToPoint:function(t,e){void 0===CV&&(CV=new KG,AV=[new OV,new OV,new OV],EV=new mF,PV=new mF);var i=e||new mF,n=1/0;if(CV.setFromCoplanarPoints(this.a,this.b,this.c),CV.projectPoint(t,EV),!0===this.containsPoint(EV))i.copy(EV);else{AV[0].set(this.a,this.b),AV[1].set(this.b,this.c),AV[2].set(this.c,this.a);for(var r=0;r<AV.length;r++){AV[r].closestPointToPoint(EV,!0,PV);var o=EV.distanceToSquared(PV);o<n&&(n=o,i.copy(PV))}}return i},equals:function(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}},zV.prototype={constructor:zV,clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.a=t.a,this.b=t.b,this.c=t.c,this.normal.copy(t.normal),this.color.copy(t.color),this.materialIndex=t.materialIndex;for(var e=0,i=t.vertexNormals.length;e<i;e++)this.vertexNormals[e]=t.vertexNormals[e].clone();for(e=0,i=t.vertexColors.length;e<i;e++)this.vertexColors[e]=t.vertexColors[e].clone();return this}},((NV.prototype=Object.create(jG.prototype)).constructor=NV).prototype.isMeshBasicMaterial=!0,NV.prototype.copy=function(t){return jG.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this},BV.prototype={constructor:BV,isBufferAttribute:!0,set needsUpdate(t){!0===t&&this.version++},setArray:function(t){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.count=void 0!==t?t.length/this.itemSize:0,this.array=t},setDynamic:function(t){return this.dynamic=t,this},copy:function(t){return this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.dynamic=t.dynamic,this},copyAt:function(t,e,i){t*=this.itemSize,i*=e.itemSize;for(var n=0,r=this.itemSize;n<r;n++)this.array[t+n]=e.array[i+n];return this},copyArray:function(t){return this.array.set(t),this},copyColorsArray:function(t){for(var e=this.array,i=0,n=0,r=t.length;n<r;n++){var o=t[n];void 0===o&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",n),o=new rG),e[i++]=o.r,e[i++]=o.g,e[i++]=o.b}return this},copyIndicesArray:function(t){for(var e=this.array,i=0,n=0,r=t.length;n<r;n++){var o=t[n];e[i++]=o.a,e[i++]=o.b,e[i++]=o.c}return this},copyVector2sArray:function(t){for(var e=this.array,i=0,n=0,r=t.length;n<r;n++){var o=t[n];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",n),o=new WB),e[i++]=o.x,e[i++]=o.y}return this},copyVector3sArray:function(t){for(var e=this.array,i=0,n=0,r=t.length;n<r;n++){var o=t[n];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",n),o=new mF),e[i++]=o.x,e[i++]=o.y,e[i++]=o.z}return this},copyVector4sArray:function(t){for(var e=this.array,i=0,n=0,r=t.length;n<r;n++){var o=t[n];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",n),o=new dF),e[i++]=o.x,e[i++]=o.y,e[i++]=o.z,e[i++]=o.w}return this},set:function(t,e){return void 0===e&&(e=0),this.array.set(t,e),this},getX:function(t){return this.array[t*this.itemSize]},setX:function(t,e){return this.array[t*this.itemSize]=e,this},getY:function(t){return this.array[t*this.itemSize+1]},setY:function(t,e){return this.array[t*this.itemSize+1]=e,this},getZ:function(t){return this.array[t*this.itemSize+2]},setZ:function(t,e){return this.array[t*this.itemSize+2]=e,this},getW:function(t){return this.array[t*this.itemSize+3]},setW:function(t,e){return this.array[t*this.itemSize+3]=e,this},setXY:function(t,e,i){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=i,this},setXYZ:function(t,e,i,n){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=n,this},setXYZW:function(t,e,i,n,r){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=n,this.array[t+3]=r,this},onUpload:function(t){return this.onUploadCallback=t,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)}},(FV.prototype=Object.create(BV.prototype)).constructor=FV,(GV.prototype=Object.create(BV.prototype)).constructor=GV,(VV.prototype=Object.create(BV.prototype)).constructor=VV,(HV.prototype=Object.create(BV.prototype)).constructor=HV,(UV.prototype=Object.create(BV.prototype)).constructor=UV,(WV.prototype=Object.create(BV.prototype)).constructor=WV,(jV.prototype=Object.create(BV.prototype)).constructor=jV,(ZV.prototype=Object.create(BV.prototype)).constructor=ZV,(XV.prototype=Object.create(BV.prototype)).constructor=XV,Object.assign(qV.prototype,{computeGroups:function(t){for(var e,i=[],n=void 0,r=t.faces,o=0;o<r.length;o++){var a=r[o];a.materialIndex!==n&&(n=a.materialIndex,void 0!==e&&(e.count=3*o-e.start,i.push(e)),e={start:3*o,materialIndex:n})}void 0!==e&&(e.count=3*o-e.start,i.push(e)),this.groups=i},fromGeometry:function(t){var e,i=t.faces,n=t.vertices,r=t.faceVertexUvs,o=r[0]&&0<r[0].length,a=r[1]&&0<r[1].length,s=t.morphTargets,l=s.length;if(0<l){e=[];for(var h=0;h<l;h++)e[h]=[];this.morphTargets.position=e}var c,u=t.morphNormals,d=u.length;if(0<d){c=[];for(h=0;h<d;h++)c[h]=[];this.morphTargets.normal=c}var p=t.skinIndices,f=t.skinWeights,g=p.length===n.length,m=f.length===n.length;for(h=0;h<i.length;h++){var v=i[h];this.vertices.push(n[v.a],n[v.b],n[v.c]);var y=v.vertexNormals;if(3===y.length)this.normals.push(y[0],y[1],y[2]);else{var _=v.normal;this.normals.push(_,_,_)}var x,w=v.vertexColors;if(3===w.length)this.colors.push(w[0],w[1],w[2]);else{var b=v.color;this.colors.push(b,b,b)}if(!0===o)void 0!==(x=r[0][h])?this.uvs.push(x[0],x[1],x[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",h),this.uvs.push(new WB,new WB,new WB));if(!0===a)void 0!==(x=r[1][h])?this.uvs2.push(x[0],x[1],x[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",h),this.uvs2.push(new WB,new WB,new WB));for(var M=0;M<l;M++){var S=s[M].vertices;e[M].push(S[v.a],S[v.b],S[v.c])}for(M=0;M<d;M++){var T=u[M].vertexNormals[h];c[M].push(T.a,T.b,T.c)}g&&this.skinIndices.push(p[v.a],p[v.b],p[v.c]),m&&this.skinWeights.push(f[v.a],f[v.b],f[v.c])}return this.computeGroups(t),this.verticesNeedUpdate=t.verticesNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,this}});var JV,KV,QV,$V,tH,eH,iH,nH,rH,oH,aH,sH,lH,hH,cH,uH,dH=0;function pH(){return dH++}function fH(){Object.defineProperty(this,"id",{value:pH()}),this.uuid=UB.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}function gH(){Object.defineProperty(this,"id",{value:pH()}),this.uuid=UB.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0}}function mH(t,e){DV.call(this),this.type="Mesh",this.geometry=void 0!==t?t:new gH,this.material=void 0!==e?e:new NV({color:16777215*Math.random()}),this.drawMode=DB,this.updateMorphTargets()}function vH(t,e,i,n,r,o){fH.call(this),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:i,widthSegments:n,heightSegments:r,depthSegments:o},this.fromBufferGeometry(new yH(t,e,i,n,r,o)),this.mergeVertices()}function yH(t,e,i,n,r,o){gH.call(this),this.type="BoxBufferGeometry",this.parameters={width:t,height:e,depth:i,widthSegments:n,heightSegments:r,depthSegments:o};var P=this;n=Math.floor(n)||1,r=Math.floor(r)||1,o=Math.floor(o)||1;var L=[],I=[],R=[],D=[],O=0,k=0;function a(t,e,i,n,r,o,a,s,l,h,c){var u,d,p=o/l,f=a/h,g=o/2,m=a/2,v=s/2,y=l+1,_=h+1,x=0,w=0,b=new mF;for(d=0;d<_;d++){var M=d*f-m;for(u=0;u<y;u++){var S=u*p-g;b[t]=S*n,b[e]=M*r,b[i]=v,I.push(b.x,b.y,b.z),b[t]=0,b[e]=0,b[i]=0<s?1:-1,R.push(b.x,b.y,b.z),D.push(u/l),D.push(1-d/h),x+=1}}for(d=0;d<h;d++)for(u=0;u<l;u++){var T=O+u+y*d,C=O+u+y*(d+1),A=O+(u+1)+y*(d+1),E=O+(u+1)+y*d;L.push(T,C,E),L.push(C,A,E),w+=6}P.addGroup(k,w,c),k+=w,O+=x}a("z","y","x",-1,-1,i,e,t,o,r,0),a("z","y","x",1,-1,i,e,-t,o,r,1),a("x","z","y",1,1,t,i,e,n,o,2),a("x","z","y",1,-1,t,i,-e,n,o,3),a("x","y","z",1,-1,t,e,i,n,r,4),a("x","y","z",-1,-1,t,e,-i,n,r,5),this.setIndex(L),this.addAttribute("position",new ZV(I,3)),this.addAttribute("normal",new ZV(R,3)),this.addAttribute("uv",new ZV(D,2))}function _H(t,e,i,n){fH.call(this),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:i,heightSegments:n},this.fromBufferGeometry(new xH(t,e,i,n))}function xH(t,e,i,n){gH.call(this),this.type="PlaneBufferGeometry",this.parameters={width:t,height:e,widthSegments:i,heightSegments:n};var r,o,a=t/2,s=e/2,l=Math.floor(i)||1,h=Math.floor(n)||1,c=l+1,u=h+1,d=t/l,p=e/h,f=[],g=[],m=[],v=[];for(o=0;o<u;o++){var y=o*p-s;for(r=0;r<c;r++){var _=r*d-a;g.push(_,-y,0),m.push(0,0,1),v.push(r/l),v.push(1-o/h)}}for(o=0;o<h;o++)for(r=0;r<l;r++){var x=r+c*o,w=r+c*(o+1),b=r+1+c*(o+1),M=r+1+c*o;f.push(x,w,M),f.push(w,b,M)}this.setIndex(f),this.addAttribute("position",new ZV(g,3)),this.addAttribute("normal",new ZV(m,3)),this.addAttribute("uv",new ZV(v,2))}function wH(){DV.call(this),this.type="Camera",this.matrixWorldInverse=new vF,this.projectionMatrix=new vF}function bH(t,e,i,n){wH.call(this),this.type="PerspectiveCamera",this.fov=void 0!==t?t:50,this.zoom=1,this.near=void 0!==i?i:.1,this.far=void 0!==n?n:2e3,this.focus=10,this.aspect=void 0!==e?e:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}function MH(t,e,i,n,r,o){wH.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=i,this.bottom=n,this.near=void 0!==r?r:.1,this.far=void 0!==o?o:2e3,this.updateProjectionMatrix()}function SH(r,o,a){var s,l,h;return{setMode:function(t){s=t},setIndex:function(t){t.array instanceof Uint32Array&&o.get("OES_element_index_uint")?(l=r.UNSIGNED_INT,h=4):t.array instanceof Uint16Array?(l=r.UNSIGNED_SHORT,h=2):(l=r.UNSIGNED_BYTE,h=1)},render:function(t,e){r.drawElements(s,e,l,t*h),a.calls++,a.vertices+=e,s===r.TRIANGLES&&(a.faces+=e/3)},renderInstances:function(t,e,i){var n=o.get("ANGLE_instanced_arrays");null!==n?(n.drawElementsInstancedANGLE(s,i,l,e*h,t.maxInstancedCount),a.calls++,a.vertices+=i*t.maxInstancedCount,s===r.TRIANGLES&&(a.faces+=t.maxInstancedCount*i/3)):console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.")}}}function TH(r,o,a){var s;return{setMode:function(t){s=t},render:function(t,e){r.drawArrays(s,t,e),a.calls++,a.vertices+=e,s===r.TRIANGLES&&(a.faces+=e/3)},renderInstances:function(t){var e=o.get("ANGLE_instanced_arrays");if(null!==e){var i=t.attributes.position,n=0;n=i.isInterleavedBufferAttribute?i.data.count:i.count,e.drawArraysInstancedANGLE(s,0,n,t.maxInstancedCount),a.calls++,a.vertices+=n*t.maxInstancedCount,s===r.TRIANGLES&&(a.faces+=t.maxInstancedCount*n/3)}else console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.")}}}function CH(){var i={};return{get:function(t){if(void 0!==i[t.id])return i[t.id];var e;switch(t.type){case"DirectionalLight":e={direction:new mF,color:new rG,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new WB};break;case"SpotLight":e={position:new mF,direction:new mF,color:new rG,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new WB};break;case"PointLight":e={position:new mF,color:new rG,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new WB};break;case"HemisphereLight":e={direction:new mF,skyColor:new rG,groundColor:new rG};break;case"RectAreaLight":e={color:new rG,position:new mF,halfWidth:new mF,halfHeight:new mF}}return i[t.id]=e}}}function AH(t,e,i){var n=t.createShader(e);return t.shaderSource(n,i),t.compileShader(n),!1===t.getShaderParameter(n,t.COMPILE_STATUS)&&console.error("THREE.WebGLShader: Shader couldn't compile."),""!==t.getShaderInfoLog(n)&&console.warn("THREE.WebGLShader: gl.getShaderInfoLog()",e===t.VERTEX_SHADER?"vertex":"fragment",t.getShaderInfoLog(n),function(t){for(var e=t.split("\n"),i=0;i<e.length;i++)e[i]=i+1+": "+e[i];return e.join("\n")}(i)),n}fH.prototype={constructor:fH,isGeometry:!0,applyMatrix:function(t){for(var e=(new JG).getNormalMatrix(t),i=0,n=this.vertices.length;i<n;i++){this.vertices[i].applyMatrix4(t)}for(i=0,n=this.faces.length;i<n;i++){var r=this.faces[i];r.normal.applyMatrix3(e).normalize();for(var o=0,a=r.vertexNormals.length;o<a;o++)r.vertexNormals[o].applyMatrix3(e).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(t){return void 0===eH&&(eH=new vF),eH.makeRotationX(t),this.applyMatrix(eH),this},rotateY:function(t){return void 0===tH&&(tH=new vF),tH.makeRotationY(t),this.applyMatrix(tH),this},rotateZ:function(t){return void 0===$V&&($V=new vF),$V.makeRotationZ(t),this.applyMatrix($V),this},translate:function(t,e,i){return void 0===QV&&(QV=new vF),QV.makeTranslation(t,e,i),this.applyMatrix(QV),this},scale:function(t,e,i){return void 0===KV&&(KV=new vF),KV.makeScale(t,e,i),this.applyMatrix(KV),this},lookAt:function(t){void 0===JV&&(JV=new DV),JV.lookAt(t),JV.updateMatrix(),this.applyMatrix(JV.matrix)},fromBufferGeometry:function(t){var o=this,e=null!==t.index?t.index.array:void 0,i=t.attributes,n=i.position.array,a=void 0!==i.normal?i.normal.array:void 0,s=void 0!==i.color?i.color.array:void 0,l=void 0!==i.uv?i.uv.array:void 0,h=void 0!==i.uv2?i.uv2.array:void 0;void 0!==h&&(this.faceVertexUvs[1]=[]);for(var c=[],u=[],d=[],r=0,p=0;r<n.length;r+=3,p+=2)o.vertices.push(new mF(n[r],n[r+1],n[r+2])),void 0!==a&&c.push(new mF(a[r],a[r+1],a[r+2])),void 0!==s&&o.colors.push(new rG(s[r],s[r+1],s[r+2])),void 0!==l&&u.push(new WB(l[p],l[p+1])),void 0!==h&&d.push(new WB(h[p],h[p+1]));function f(t,e,i,n){var r=new zV(t,e,i,void 0!==a?[c[t].clone(),c[e].clone(),c[i].clone()]:[],void 0!==s?[o.colors[t].clone(),o.colors[e].clone(),o.colors[i].clone()]:[],n);o.faces.push(r),void 0!==l&&o.faceVertexUvs[0].push([u[t].clone(),u[e].clone(),u[i].clone()]),void 0!==h&&o.faceVertexUvs[1].push([d[t].clone(),d[e].clone(),d[i].clone()])}if(void 0!==e){var g=t.groups;if(0<g.length)for(r=0;r<g.length;r++)for(var m=g[r],v=m.start,y=(p=v,v+m.count);p<y;p+=3)f(e[p],e[p+1],e[p+2],m.materialIndex);else for(r=0;r<e.length;r+=3)f(e[r],e[r+1],e[r+2])}else for(r=0;r<n.length/3;r+=3)f(r,r+1,r+2);return this.computeFaceNormals(),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),this},center:function(){this.computeBoundingBox();var t=this.boundingBox.getCenter().negate();return this.translate(t.x,t.y,t.z),t},normalize:function(){this.computeBoundingSphere();var t=this.boundingSphere.center,e=this.boundingSphere.radius,i=0===e?1:1/e,n=new vF;return n.set(i,0,0,-i*t.x,0,i,0,-i*t.y,0,0,i,-i*t.z,0,0,0,1),this.applyMatrix(n),this},computeFaceNormals:function(){for(var t=new mF,e=new mF,i=0,n=this.faces.length;i<n;i++){var r=this.faces[i],o=this.vertices[r.a],a=this.vertices[r.b],s=this.vertices[r.c];t.subVectors(s,a),e.subVectors(o,a),t.cross(e),t.normalize(),r.normal.copy(t)}},computeVertexNormals:function(t){var e,i,n,r,o,a;for(void 0===t&&(t=!0),a=new Array(this.vertices.length),e=0,i=this.vertices.length;e<i;e++)a[e]=new mF;if(t){var s,l,h,c=new mF,u=new mF;for(n=0,r=this.faces.length;n<r;n++)o=this.faces[n],s=this.vertices[o.a],l=this.vertices[o.b],h=this.vertices[o.c],c.subVectors(h,l),u.subVectors(s,l),c.cross(u),a[o.a].add(c),a[o.b].add(c),a[o.c].add(c)}else for(this.computeFaceNormals(),n=0,r=this.faces.length;n<r;n++)a[(o=this.faces[n]).a].add(o.normal),a[o.b].add(o.normal),a[o.c].add(o.normal);for(e=0,i=this.vertices.length;e<i;e++)a[e].normalize();for(n=0,r=this.faces.length;n<r;n++){var d=(o=this.faces[n]).vertexNormals;3===d.length?(d[0].copy(a[o.a]),d[1].copy(a[o.b]),d[2].copy(a[o.c])):(d[0]=a[o.a].clone(),d[1]=a[o.b].clone(),d[2]=a[o.c].clone())}0<this.faces.length&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){var t,e,i;for(this.computeFaceNormals(),t=0,e=this.faces.length;t<e;t++){var n=(i=this.faces[t]).vertexNormals;3===n.length?(n[0].copy(i.normal),n[1].copy(i.normal),n[2].copy(i.normal)):(n[0]=i.normal.clone(),n[1]=i.normal.clone(),n[2]=i.normal.clone())}0<this.faces.length&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var t,e,i,n,r;for(i=0,n=this.faces.length;i<n;i++)for((r=this.faces[i]).__originalFaceNormal?r.__originalFaceNormal.copy(r.normal):r.__originalFaceNormal=r.normal.clone(),r.__originalVertexNormals||(r.__originalVertexNormals=[]),t=0,e=r.vertexNormals.length;t<e;t++)r.__originalVertexNormals[t]?r.__originalVertexNormals[t].copy(r.vertexNormals[t]):r.__originalVertexNormals[t]=r.vertexNormals[t].clone();var o=new fH;for(o.faces=this.faces,t=0,e=this.morphTargets.length;t<e;t++){if(!this.morphNormals[t]){this.morphNormals[t]={},this.morphNormals[t].faceNormals=[],this.morphNormals[t].vertexNormals=[];var a=this.morphNormals[t].faceNormals,s=this.morphNormals[t].vertexNormals;for(i=0,n=this.faces.length;i<n;i++)l=new mF,h={a:new mF,b:new mF,c:new mF},a.push(l),s.push(h)}var l,h,c=this.morphNormals[t];for(o.vertices=this.morphTargets[t].vertices,o.computeFaceNormals(),o.computeVertexNormals(),i=0,n=this.faces.length;i<n;i++)r=this.faces[i],l=c.faceNormals[i],h=c.vertexNormals[i],l.copy(r.normal),h.a.copy(r.vertexNormals[0]),h.b.copy(r.vertexNormals[1]),h.c.copy(r.vertexNormals[2])}for(i=0,n=this.faces.length;i<n;i++)(r=this.faces[i]).normal=r.__originalFaceNormal,r.vertexNormals=r.__originalVertexNormals},computeLineDistances:function(){for(var t=0,e=this.vertices,i=0,n=e.length;i<n;i++)0<i&&(t+=e[i].distanceTo(e[i-1])),this.lineDistances[i]=t},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new qG),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new YG),this.boundingSphere.setFromPoints(this.vertices)},merge:function(t,e,i){if(!1!==(t&&t.isGeometry)){var n,r=this.vertices.length,o=this.vertices,a=t.vertices,s=this.faces,l=t.faces,h=this.faceVertexUvs[0],c=t.faceVertexUvs[0],u=this.colors,d=t.colors;void 0===i&&(i=0),void 0!==e&&(n=(new JG).getNormalMatrix(e));for(var p=0,f=a.length;p<f;p++){var g=a[p].clone();void 0!==e&&g.applyMatrix4(e),o.push(g)}for(p=0,f=d.length;p<f;p++)u.push(d[p].clone());for(p=0,f=l.length;p<f;p++){var m,v,y,_=l[p],x=_.vertexNormals,w=_.vertexColors;(m=new zV(_.a+r,_.b+r,_.c+r)).normal.copy(_.normal),void 0!==n&&m.normal.applyMatrix3(n).normalize();for(var b=0,M=x.length;b<M;b++)v=x[b].clone(),void 0!==n&&v.applyMatrix3(n).normalize(),m.vertexNormals.push(v);m.color.copy(_.color);for(b=0,M=w.length;b<M;b++)y=w[b],m.vertexColors.push(y.clone());m.materialIndex=_.materialIndex+i,s.push(m)}for(p=0,f=c.length;p<f;p++){var S=c[p],T=[];if(void 0!==S){for(b=0,M=S.length;b<M;b++)T.push(S[b].clone());h.push(T)}}}else console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",t)},mergeMesh:function(t){!1!==(t&&t.isMesh)?(t.matrixAutoUpdate&&t.updateMatrix(),this.merge(t.geometry,t.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",t)},mergeVertices:function(){var t,e,i,n,r,o,a,s,l={},h=[],c=[],u=Math.pow(10,4);for(i=0,n=this.vertices.length;i<n;i++)t=this.vertices[i],void 0===l[e=Math.round(t.x*u)+"_"+Math.round(t.y*u)+"_"+Math.round(t.z*u)]?(l[e]=i,h.push(this.vertices[i]),c[i]=h.length-1):c[i]=c[l[e]];var d=[];for(i=0,n=this.faces.length;i<n;i++){(r=this.faces[i]).a=c[r.a],r.b=c[r.b],r.c=c[r.c],o=[r.a,r.b,r.c];for(var p=0;p<3;p++)if(o[p]===o[(p+1)%3]){d.push(i);break}}for(i=d.length-1;0<=i;i--){var f=d[i];for(this.faces.splice(f,1),a=0,s=this.faceVertexUvs.length;a<s;a++)this.faceVertexUvs[a].splice(f,1)}var g=this.vertices.length-h.length;return this.vertices=h,g},sortFacesByMaterialIndex:function(){for(var t=this.faces,e=t.length,i=0;i<e;i++)t[i]._id=i;t.sort(function(t,e){return t.materialIndex-e.materialIndex});var n,r,o=this.faceVertexUvs[0],a=this.faceVertexUvs[1];o&&o.length===e&&(n=[]),a&&a.length===e&&(r=[]);for(i=0;i<e;i++){var s=t[i]._id;n&&n.push(o[s]),r&&r.push(a[s])}n&&(this.faceVertexUvs[0]=n),r&&(this.faceVertexUvs[1]=r)},toJSON:function(){var t={metadata:{version:4.4,type:"Geometry",generator:"Geometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),void 0!==this.parameters){var e=this.parameters;for(var i in e)void 0!==e[i]&&(t[i]=e[i]);return t}for(var n=[],r=0;r<this.vertices.length;r++){var o=this.vertices[r];n.push(o.x,o.y,o.z)}var a=[],s=[],l={},h=[],c={},u=[],d={};for(r=0;r<this.faces.length;r++){var p=this.faces[r],f=void 0!==this.faceVertexUvs[0][r],g=0<p.normal.length(),m=0<p.vertexNormals.length,v=1!==p.color.r||1!==p.color.g||1!==p.color.b,y=0<p.vertexColors.length,_=0;if(_=M(_=M(_=M(_=M(_=M(_=M(_=M(_=M(_,0,0),1,!0),2,!1),3,f),4,g),5,m),6,v),7,y),a.push(_),a.push(p.a,p.b,p.c),a.push(p.materialIndex),f){var x=this.faceVertexUvs[0][r];a.push(C(x[0]),C(x[1]),C(x[2]))}if(g&&a.push(S(p.normal)),m){var w=p.vertexNormals;a.push(S(w[0]),S(w[1]),S(w[2]))}if(v&&a.push(T(p.color)),y){var b=p.vertexColors;a.push(T(b[0]),T(b[1]),T(b[2]))}}function M(t,e,i){return i?t|1<<e:t&~(1<<e)}function S(t){var e=t.x.toString()+t.y.toString()+t.z.toString();return void 0!==l[e]||(l[e]=s.length/3,s.push(t.x,t.y,t.z)),l[e]}function T(t){var e=t.r.toString()+t.g.toString()+t.b.toString();return void 0!==c[e]||(c[e]=h.length,h.push(t.getHex())),c[e]}function C(t){var e=t.x.toString()+t.y.toString();return void 0!==d[e]||(d[e]=u.length/2,u.push(t.x,t.y)),d[e]}return t.data={},t.data.vertices=n,t.data.normals=s,0<h.length&&(t.data.colors=h),0<u.length&&(t.data.uvs=[u]),t.data.faces=a,t},clone:function(){return(new fH).copy(this)},copy:function(t){var e,i,n,r,o,a;this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=t.name;var s=t.vertices;for(e=0,i=s.length;e<i;e++)this.vertices.push(s[e].clone());var l=t.colors;for(e=0,i=l.length;e<i;e++)this.colors.push(l[e].clone());var h=t.faces;for(e=0,i=h.length;e<i;e++)this.faces.push(h[e].clone());for(e=0,i=t.faceVertexUvs.length;e<i;e++){var c=t.faceVertexUvs[e];for(void 0===this.faceVertexUvs[e]&&(this.faceVertexUvs[e]=[]),n=0,r=c.length;n<r;n++){var u=c[n],d=[];for(o=0,a=u.length;o<a;o++){var p=u[o];d.push(p.clone())}this.faceVertexUvs[e].push(d)}}var f=t.morphTargets;for(e=0,i=f.length;e<i;e++){var g={};if(g.name=f[e].name,void 0!==f[e].vertices)for(g.vertices=[],n=0,r=f[e].vertices.length;n<r;n++)g.vertices.push(f[e].vertices[n].clone());if(void 0!==f[e].normals)for(g.normals=[],n=0,r=f[e].normals.length;n<r;n++)g.normals.push(f[e].normals[n].clone());this.morphTargets.push(g)}var m=t.morphNormals;for(e=0,i=m.length;e<i;e++){var v={};if(void 0!==m[e].vertexNormals)for(v.vertexNormals=[],n=0,r=m[e].vertexNormals.length;n<r;n++){var y=m[e].vertexNormals[n],_={};_.a=y.a.clone(),_.b=y.b.clone(),_.c=y.c.clone(),v.vertexNormals.push(_)}if(void 0!==m[e].faceNormals)for(v.faceNormals=[],n=0,r=m[e].faceNormals.length;n<r;n++)v.faceNormals.push(m[e].faceNormals[n].clone());this.morphNormals.push(v)}var x=t.skinWeights;for(e=0,i=x.length;e<i;e++)this.skinWeights.push(x[e].clone());var w=t.skinIndices;for(e=0,i=w.length;e<i;e++)this.skinIndices.push(w[e].clone());var b=t.lineDistances;for(e=0,i=b.length;e<i;e++)this.lineDistances.push(b[e]);var M=t.boundingBox;null!==M&&(this.boundingBox=M.clone());var S=t.boundingSphere;return null!==S&&(this.boundingSphere=S.clone()),this.elementsNeedUpdate=t.elementsNeedUpdate,this.verticesNeedUpdate=t.verticesNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.lineDistancesNeedUpdate=t.lineDistancesNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}},Object.assign(fH.prototype,pN.prototype),gH.prototype={constructor:gH,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(t){Array.isArray(t)?this.index=new(65535<YV(t)?jV:UV)(t,1):this.index=t},addAttribute:function(t,e){return!1===(e&&e.isBufferAttribute)&&!1===(e&&e.isInterleavedBufferAttribute)?(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),void this.addAttribute(t,new BV(e,arguments[2]))):"index"===t?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),void this.setIndex(e)):(this.attributes[t]=e,this)},getAttribute:function(t){return this.attributes[t]},removeAttribute:function(t){return delete this.attributes[t],this},addGroup:function(t,e,i){this.groups.push({start:t,count:e,materialIndex:void 0!==i?i:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(t,e){this.drawRange.start=t,this.drawRange.count=e},applyMatrix:function(t){var e=this.attributes.position;void 0!==e&&(t.applyToBufferAttribute(e),e.needsUpdate=!0);var i=this.attributes.normal;void 0!==i&&((new JG).getNormalMatrix(t).applyToBufferAttribute(i),i.needsUpdate=!0);return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(t){return void 0===hH&&(hH=new vF),hH.makeRotationX(t),this.applyMatrix(hH),this},rotateY:function(t){return void 0===lH&&(lH=new vF),lH.makeRotationY(t),this.applyMatrix(lH),this},rotateZ:function(t){return void 0===sH&&(sH=new vF),sH.makeRotationZ(t),this.applyMatrix(sH),this},translate:function(t,e,i){return void 0===aH&&(aH=new vF),aH.makeTranslation(t,e,i),this.applyMatrix(aH),this},scale:function(t,e,i){return void 0===oH&&(oH=new vF),oH.makeScale(t,e,i),this.applyMatrix(oH),this},lookAt:function(t){void 0===rH&&(rH=new DV),rH.lookAt(t),rH.updateMatrix(),this.applyMatrix(rH.matrix)},center:function(){this.computeBoundingBox();var t=this.boundingBox.getCenter().negate();return this.translate(t.x,t.y,t.z),t},setFromObject:function(t){var e=t.geometry;if(t.isPoints||t.isLine){var i=new ZV(3*e.vertices.length,3),n=new ZV(3*e.colors.length,3);if(this.addAttribute("position",i.copyVector3sArray(e.vertices)),this.addAttribute("color",n.copyColorsArray(e.colors)),e.lineDistances&&e.lineDistances.length===e.vertices.length){var r=new ZV(e.lineDistances.length,1);this.addAttribute("lineDistance",r.copyArray(e.lineDistances))}null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone())}else t.isMesh&&e&&e.isGeometry&&this.fromGeometry(e);return this},updateFromObject:function(t){var e,i=t.geometry;if(t.isMesh){var n=i.__directGeometry;if(!0===i.elementsNeedUpdate&&(n=void 0,i.elementsNeedUpdate=!1),void 0===n)return this.fromGeometry(i);n.verticesNeedUpdate=i.verticesNeedUpdate,n.normalsNeedUpdate=i.normalsNeedUpdate,n.colorsNeedUpdate=i.colorsNeedUpdate,n.uvsNeedUpdate=i.uvsNeedUpdate,n.groupsNeedUpdate=i.groupsNeedUpdate,i.verticesNeedUpdate=!1,i.normalsNeedUpdate=!1,i.colorsNeedUpdate=!1,i.uvsNeedUpdate=!1,i.groupsNeedUpdate=!1,i=n}return!0===i.verticesNeedUpdate&&(void 0!==(e=this.attributes.position)&&(e.copyVector3sArray(i.vertices),e.needsUpdate=!0),i.verticesNeedUpdate=!1),!0===i.normalsNeedUpdate&&(void 0!==(e=this.attributes.normal)&&(e.copyVector3sArray(i.normals),e.needsUpdate=!0),i.normalsNeedUpdate=!1),!0===i.colorsNeedUpdate&&(void 0!==(e=this.attributes.color)&&(e.copyColorsArray(i.colors),e.needsUpdate=!0),i.colorsNeedUpdate=!1),i.uvsNeedUpdate&&(void 0!==(e=this.attributes.uv)&&(e.copyVector2sArray(i.uvs),e.needsUpdate=!0),i.uvsNeedUpdate=!1),i.lineDistancesNeedUpdate&&(void 0!==(e=this.attributes.lineDistance)&&(e.copyArray(i.lineDistances),e.needsUpdate=!0),i.lineDistancesNeedUpdate=!1),i.groupsNeedUpdate&&(i.computeGroups(t.geometry),this.groups=i.groups,i.groupsNeedUpdate=!1),this},fromGeometry:function(t){return t.__directGeometry=(new qV).fromGeometry(t),this.fromDirectGeometry(t.__directGeometry)},fromDirectGeometry:function(t){var e=new Float32Array(3*t.vertices.length);if(this.addAttribute("position",new BV(e,3).copyVector3sArray(t.vertices)),0<t.normals.length){var i=new Float32Array(3*t.normals.length);this.addAttribute("normal",new BV(i,3).copyVector3sArray(t.normals))}if(0<t.colors.length){var n=new Float32Array(3*t.colors.length);this.addAttribute("color",new BV(n,3).copyColorsArray(t.colors))}if(0<t.uvs.length){var r=new Float32Array(2*t.uvs.length);this.addAttribute("uv",new BV(r,2).copyVector2sArray(t.uvs))}if(0<t.uvs2.length){var o=new Float32Array(2*t.uvs2.length);this.addAttribute("uv2",new BV(o,2).copyVector2sArray(t.uvs2))}if(0<t.indices.length){var a=new(65535<YV(t.indices)?Uint32Array:Uint16Array)(3*t.indices.length);this.setIndex(new BV(a,1).copyIndicesArray(t.indices))}for(var s in this.groups=t.groups,t.morphTargets){for(var l=[],h=t.morphTargets[s],c=0,u=h.length;c<u;c++){var d=h[c],p=new ZV(3*d.length,3);l.push(p.copyVector3sArray(d))}this.morphAttributes[s]=l}if(0<t.skinIndices.length){var f=new ZV(4*t.skinIndices.length,4);this.addAttribute("skinIndex",f.copyVector4sArray(t.skinIndices))}if(0<t.skinWeights.length){var g=new ZV(4*t.skinWeights.length,4);this.addAttribute("skinWeight",g.copyVector4sArray(t.skinWeights))}return null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new qG);var t=this.attributes.position;void 0!==t?this.boundingBox.setFromBufferAttribute(t):this.boundingBox.makeEmpty(),(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:(iH=new qG,nH=new mF,function(){null===this.boundingSphere&&(this.boundingSphere=new YG);var t=this.attributes.position;if(t){var e=this.boundingSphere.center;iH.setFromBufferAttribute(t),iH.getCenter(e);for(var i=0,n=0,r=t.count;n<r;n++)nH.x=t.getX(n),nH.y=t.getY(n),nH.z=t.getZ(n),i=Math.max(i,e.distanceToSquared(nH));this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}),computeFaceNormals:function(){},computeVertexNormals:function(){var t=this.index,e=this.attributes,i=this.groups;if(e.position){var n=e.position.array;if(void 0===e.normal)this.addAttribute("normal",new BV(new Float32Array(n.length),3));else for(var r=e.normal.array,o=0,a=r.length;o<a;o++)r[o]=0;var s,l,h,c=e.normal.array,u=new mF,d=new mF,p=new mF,f=new mF,g=new mF;if(t){var m=t.array;0===i.length&&this.addGroup(0,m.length);for(var v=0,y=i.length;v<y;++v){var _=i[v],x=_.start;for(o=x,a=x+_.count;o<a;o+=3)s=3*m[o+0],l=3*m[o+1],h=3*m[o+2],u.fromArray(n,s),d.fromArray(n,l),p.fromArray(n,h),f.subVectors(p,d),g.subVectors(u,d),f.cross(g),c[s]+=f.x,c[s+1]+=f.y,c[s+2]+=f.z,c[l]+=f.x,c[l+1]+=f.y,c[l+2]+=f.z,c[h]+=f.x,c[h+1]+=f.y,c[h+2]+=f.z}}else for(o=0,a=n.length;o<a;o+=9)u.fromArray(n,o),d.fromArray(n,o+3),p.fromArray(n,o+6),f.subVectors(p,d),g.subVectors(u,d),f.cross(g),c[o]=f.x,c[o+1]=f.y,c[o+2]=f.z,c[o+3]=f.x,c[o+4]=f.y,c[o+5]=f.z,c[o+6]=f.x,c[o+7]=f.y,c[o+8]=f.z;this.normalizeNormals(),e.normal.needsUpdate=!0}},merge:function(t,e){if(!1!==(t&&t.isBufferGeometry)){void 0===e&&(e=0);var i=this.attributes;for(var n in i)if(void 0!==t.attributes[n])for(var r=i[n].array,o=t.attributes[n],a=o.array,s=0,l=o.itemSize*e;s<a.length;s++,l++)r[l]=a[s];return this}console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",t)},normalizeNormals:function(){for(var t,e,i,n,r=this.attributes.normal.array,o=0,a=r.length;o<a;o+=3)t=r[o],e=r[o+1],i=r[o+2],n=1/Math.sqrt(t*t+e*e+i*i),r[o]*=n,r[o+1]*=n,r[o+2]*=n},toNonIndexed:function(){if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var t=new gH,e=this.index.array,i=this.attributes;for(var n in i){for(var r=i[n],o=r.array,a=r.itemSize,s=new o.constructor(e.length*a),l=0,h=0,c=0,u=e.length;c<u;c++){l=e[c]*a;for(var d=0;d<a;d++)s[h++]=o[l++]}t.addAttribute(n,new BV(s,a))}return t},toJSON:function(){var t={metadata:{version:4.4,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),void 0!==this.parameters){var e=this.parameters;for(var i in e)void 0!==e[i]&&(t[i]=e[i]);return t}t.data={attributes:{}};var n=this.index;if(null!==n){var r=Array.prototype.slice.call(n.array);t.data.index={type:n.array.constructor.name,array:r}}var o=this.attributes;for(var i in o){var a=o[i];r=Array.prototype.slice.call(a.array);t.data.attributes[i]={itemSize:a.itemSize,type:a.array.constructor.name,array:r,normalized:a.normalized}}var s=this.groups;0<s.length&&(t.data.groups=JSON.parse(JSON.stringify(s)));var l=this.boundingSphere;return null!==l&&(t.data.boundingSphere={center:l.center.toArray(),radius:l.radius}),t},clone:function(){return(new gH).copy(this)},copy:function(t){var e,i,n;this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.name=t.name;var r=t.index;null!==r&&this.setIndex(r.clone());var o=t.attributes;for(e in o){var a=o[e];this.addAttribute(e,a.clone())}var s=t.morphAttributes;for(e in s){var l=[],h=s[e];for(i=0,n=h.length;i<n;i++)l.push(h[i].clone());this.morphAttributes[e]=l}var c=t.groups;for(i=0,n=c.length;i<n;i++){var u=c[i];this.addGroup(u.start,u.count,u.materialIndex)}var d=t.boundingBox;null!==d&&(this.boundingBox=d.clone());var p=t.boundingSphere;return null!==p&&(this.boundingSphere=p.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this},dispose:function(){this.dispatchEvent({type:"dispose"})}},gH.MaxIndex=65535,Object.assign(gH.prototype,pN.prototype),mH.prototype=Object.assign(Object.create(DV.prototype),{constructor:mH,isMesh:!0,setDrawMode:function(t){this.drawMode=t},copy:function(t){return DV.prototype.copy.call(this,t),this.drawMode=t.drawMode,this},updateMorphTargets:function(){var t=this.geometry.morphTargets;if(void 0!==t&&0<t.length){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var e=0,i=t.length;e<i;e++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[t[e].name]=e}},raycast:function(){var O=new vF,k=new tV,z=new YG,N=new mF,B=new mF,F=new mF,G=new mF,V=new mF,H=new mF,U=new WB,W=new WB,j=new WB,s=new mF,Z=new mF,h=new mF;function X(t,e,i,n,r,o,a){return kV.barycoordFromPoint(t,e,i,n,s),r.multiplyScalar(s.x),o.multiplyScalar(s.y),a.multiplyScalar(s.z),r.add(o).add(a),r.clone()}function q(t,e,i,n,r,o,a){var s=t.material;if(null===(s.side===CN?i.intersectTriangle(o,r,n,!0,a):i.intersectTriangle(n,r,o,s.side!==AN,a)))return null;h.copy(a),h.applyMatrix4(t.matrixWorld);var l=e.ray.origin.distanceTo(h);return l<e.near||l>e.far?null:{distance:l,point:h.clone(),object:t}}function Y(t,e,i,n,r,o,a,s){N.fromBufferAttribute(n,o),B.fromBufferAttribute(n,a),F.fromBufferAttribute(n,s);var l=q(t,e,i,N,B,F,Z);return l&&(r&&(U.fromBufferAttribute(r,o),W.fromBufferAttribute(r,a),j.fromBufferAttribute(r,s),l.uv=X(Z,N,B,F,U,W,j)),l.face=new zV(o,a,s,kV.normal(N,B,F)),l.faceIndex=o),l}return function(t,e){var i,n=this.geometry,r=this.material,o=this.matrixWorld;if(void 0!==r&&(null===n.boundingSphere&&n.computeBoundingSphere(),z.copy(n.boundingSphere),z.applyMatrix4(o),!1!==t.ray.intersectsSphere(z)&&(O.getInverse(o),k.copy(t.ray).applyMatrix4(O),null===n.boundingBox||!1!==k.intersectsBox(n.boundingBox))))if(n.isBufferGeometry){var a,s,l,h,c,u=n.index,d=n.attributes.position,p=n.attributes.uv;if(null!==u)for(h=0,c=u.count;h<c;h+=3)a=u.getX(h),s=u.getX(h+1),l=u.getX(h+2),(i=Y(this,t,k,d,p,a,s,l))&&(i.faceIndex=Math.floor(h/3),e.push(i));else for(h=0,c=d.count;h<c;h+=3)(i=Y(this,t,k,d,p,a=h,s=h+1,l=h+2))&&(i.index=a,e.push(i))}else if(n.isGeometry){var f,g,m,v,y=r&&r.isMultiMaterial,_=!0===y?r.materials:null,x=n.vertices,w=n.faces,b=n.faceVertexUvs[0];0<b.length&&(v=b);for(var M=0,S=w.length;M<S;M++){var T=w[M],C=!0===y?_[T.materialIndex]:r;if(void 0!==C){if(f=x[T.a],g=x[T.b],m=x[T.c],!0===C.morphTargets){var A=n.morphTargets,E=this.morphTargetInfluences;N.set(0,0,0),B.set(0,0,0),F.set(0,0,0);for(var P=0,L=A.length;P<L;P++){var I=E[P];if(0!==I){var R=A[P].vertices;N.addScaledVector(G.subVectors(R[T.a],f),I),B.addScaledVector(V.subVectors(R[T.b],g),I),F.addScaledVector(H.subVectors(R[T.c],m),I)}}N.add(f),B.add(g),F.add(m),f=N,g=B,m=F}if(i=q(this,t,k,f,g,m,Z)){if(v){var D=v[M];U.copy(D[0]),W.copy(D[1]),j.copy(D[2]),i.uv=X(Z,f,g,m,U,W,j)}i.face=T,i.faceIndex=M,e.push(i)}}}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),(vH.prototype=Object.create(fH.prototype)).constructor=vH,(yH.prototype=Object.create(gH.prototype)).constructor=yH,(_H.prototype=Object.create(fH.prototype)).constructor=_H,(xH.prototype=Object.create(gH.prototype)).constructor=xH,((wH.prototype=Object.create(DV.prototype)).constructor=wH).prototype.isCamera=!0,wH.prototype.getWorldDirection=(cH=new gF,function(t){var e=t||new mF;return this.getWorldQuaternion(cH),e.set(0,0,-1).applyQuaternion(cH)}),wH.prototype.lookAt=(uH=new vF,function(t){uH.lookAt(this.position,t,this.up),this.quaternion.setFromRotationMatrix(uH)}),wH.prototype.clone=function(){return(new this.constructor).copy(this)},wH.prototype.copy=function(t){return DV.prototype.copy.call(this,t),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this},bH.prototype=Object.assign(Object.create(wH.prototype),{constructor:bH,isPerspectiveCamera:!0,copy:function(t){return wH.prototype.copy.call(this,t),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this},setFocalLength:function(t){var e=.5*this.getFilmHeight()/t;this.fov=2*UB.RAD2DEG*Math.atan(e),this.updateProjectionMatrix()},getFocalLength:function(){var t=Math.tan(.5*UB.DEG2RAD*this.fov);return.5*this.getFilmHeight()/t},getEffectiveFOV:function(){return 2*UB.RAD2DEG*Math.atan(Math.tan(.5*UB.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(t,e,i,n,r,o){this.aspect=t/e,this.view={fullWidth:t,fullHeight:e,offsetX:i,offsetY:n,width:r,height:o},this.updateProjectionMatrix()},clearViewOffset:function(){this.view=null,this.updateProjectionMatrix()},updateProjectionMatrix:function(){var t=this.near,e=t*Math.tan(.5*UB.DEG2RAD*this.fov)/this.zoom,i=2*e,n=this.aspect*i,r=-.5*n,o=this.view;if(null!==o){var a=o.fullWidth,s=o.fullHeight;r+=o.offsetX*n/a,e-=o.offsetY*i/s,n*=o.width/a,i*=o.height/s}var l=this.filmOffset;0!==l&&(r+=t*l/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+n,e,e-i,t,this.far)},toJSON:function(t){var e=DV.prototype.toJSON.call(this,t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}),MH.prototype=Object.assign(Object.create(wH.prototype),{constructor:MH,isOrthographicCamera:!0,copy:function(t){return wH.prototype.copy.call(this,t),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this},setViewOffset:function(t,e,i,n,r,o){this.view={fullWidth:t,fullHeight:e,offsetX:i,offsetY:n,width:r,height:o},this.updateProjectionMatrix()},clearViewOffset:function(){this.view=null,this.updateProjectionMatrix()},updateProjectionMatrix:function(){var t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,n=(this.top+this.bottom)/2,r=i-t,o=i+t,a=n+e,s=n-e;if(null!==this.view){var l=this.zoom/(this.view.width/this.view.fullWidth),h=this.zoom/(this.view.height/this.view.fullHeight),c=(this.right-this.left)/this.view.width,u=(this.top-this.bottom)/this.view.height;o=(r+=c*(this.view.offsetX/l))+c*(this.view.width/l),s=(a-=u*(this.view.offsetY/h))-u*(this.view.height/h)}this.projectionMatrix.makeOrthographic(r,o,a,s,this.near,this.far)},toJSON:function(t){var e=DV.prototype.toJSON.call(this,t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}});var EH,PH,LH,IH,RH,DH,OH,kH,zH,NH,BH,FH=0;function GH(t){switch(t){case OB:return["Linear","( value )"];case kB:return["sRGB","( value )"];case NB:return["RGBE","( value )"];case BB:return["RGBM","( value, 7.0 )"];case FB:return["RGBM","( value, 16.0 )"];case GB:return["RGBD","( value, 256.0 )"];case zB:return["Gamma","( value, float( GAMMA_FACTOR ) )"];default:throw new Error("unsupported encoding: "+t)}}function VH(t,e){var i=GH(e);return"vec4 "+t+"( vec4 value ) { return "+i[0]+"ToLinear"+i[1]+"; }"}function HH(t){return""!==t}function UH(t,e){return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights)}function WH(t){return t.replace(/#include +<([\w\d.]+)>/g,function(t,e){var i=nG[e];if(void 0===i)throw new Error("Can not resolve #include <"+e+">");return WH(i)})}function jH(t){return t.replace(/for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,function(t,e,i,n){for(var r="",o=parseInt(e);o<parseInt(i);o++)r+=n.replace(/\[ i \]/g,"[ "+o+" ]");return r})}function ZH(t,e,i,n){var r=t.context,o=i.extensions,a=i.defines,s=i.__webglShader.vertexShader,l=i.__webglShader.fragmentShader,h="SHADOWMAP_TYPE_BASIC";n.shadowMapType===MN?h="SHADOWMAP_TYPE_PCF":n.shadowMapType===SN&&(h="SHADOWMAP_TYPE_PCF_SOFT");var c="ENVMAP_TYPE_CUBE",u="ENVMAP_MODE_REFLECTION",d="ENVMAP_BLENDING_MULTIPLY";if(n.envMap){switch(i.envMap.mapping){case iB:case nB:c="ENVMAP_TYPE_CUBE";break;case sB:case lB:c="ENVMAP_TYPE_CUBE_UV";break;case rB:case oB:c="ENVMAP_TYPE_EQUIREC";break;case aB:c="ENVMAP_TYPE_SPHERE"}switch(i.envMap.mapping){case nB:case oB:u="ENVMAP_MODE_REFRACTION"}switch(i.combine){case qN:d="ENVMAP_BLENDING_MULTIPLY";break;case YN:d="ENVMAP_BLENDING_MIX";break;case JN:d="ENVMAP_BLENDING_ADD"}}var p,f,g,m,v,y,_,x,w=0<t.gammaFactor?t.gammaFactor:1,b=(p=o,f=n,g=t.extensions,[(p=p||{}).derivatives||f.envMapCubeUV||f.bumpMap||f.normalMap||f.flatShading?"#extension GL_OES_standard_derivatives : enable":"",(p.fragDepth||f.logarithmicDepthBuffer)&&g.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"",p.drawBuffers&&g.get("WEBGL_draw_buffers")?"#extension GL_EXT_draw_buffers : require":"",(p.shaderTextureLOD||f.envMap)&&g.get("EXT_shader_texture_lod")?"#extension GL_EXT_shader_texture_lod : enable":""].filter(HH).join("\n")),M=function(t){var e=[];for(var i in t){var n=t[i];!1!==n&&e.push("#define "+i+" "+n)}return e.join("\n")}(a),S=r.createProgram();i.isRawShaderMaterial?(m=[M,"\n"].filter(HH).join("\n"),v=[b,M,"\n"].filter(HH).join("\n")):(m=["precision "+n.precision+" float;","precision "+n.precision+" int;","#define SHADER_NAME "+i.__webglShader.name,M,n.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+w,"#define MAX_BONES "+n.maxBones,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+u:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.displacementMap&&n.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.vertexColors?"#define USE_COLOR":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.useVertexTexture?"#define BONE_TEXTURE":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"","#define NUM_CLIPPING_PLANES "+n.numClippingPlanes,n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+h:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&t.extensions.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(HH).join("\n"),v=[b,"precision "+n.precision+" float;","precision "+n.precision+" int;","#define SHADER_NAME "+i.__webglShader.name,M,n.alphaTest?"#define ALPHATEST "+n.alphaTest:"","#define GAMMA_FACTOR "+w,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+c:"",n.envMap?"#define "+u:"",n.envMap?"#define "+d:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.vertexColors?"#define USE_COLOR":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"","#define NUM_CLIPPING_PLANES "+n.numClippingPlanes,"#define UNION_CLIPPING_PLANES "+(n.numClippingPlanes-n.numClipIntersection),n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+h:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&t.extensions.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"",n.envMap&&t.extensions.get("EXT_shader_texture_lod")?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",n.toneMapping!==KN?"#define TONE_MAPPING":"",n.toneMapping!==KN?nG.tonemapping_pars_fragment:"",n.toneMapping!==KN?function(t,e){var i;switch(e){case QN:i="Linear";break;case $N:i="Reinhard";break;case tB:i="Uncharted2";break;case eB:i="OptimizedCineon";break;default:throw new Error("unsupported toneMapping: "+e)}return"vec3 "+t+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}("toneMapping",n.toneMapping):"",n.outputEncoding||n.mapEncoding||n.envMapEncoding||n.emissiveMapEncoding?nG.encodings_pars_fragment:"",n.mapEncoding?VH("mapTexelToLinear",n.mapEncoding):"",n.envMapEncoding?VH("envMapTexelToLinear",n.envMapEncoding):"",n.emissiveMapEncoding?VH("emissiveMapTexelToLinear",n.emissiveMapEncoding):"",n.outputEncoding?(y="linearToOutputTexel",_=n.outputEncoding,x=GH(_),"vec4 "+y+"( vec4 value ) { return LinearTo"+x[0]+x[1]+"; }"):"",n.depthPacking?"#define DEPTH_PACKING "+i.depthPacking:"","\n"].filter(HH).join("\n")),s=UH(s=WH(s),n),l=UH(l=WH(l),n),i.isShaderMaterial||(s=jH(s),l=jH(l));var T=m+s,C=v+l,A=AH(r,r.VERTEX_SHADER,T),E=AH(r,r.FRAGMENT_SHADER,C);r.attachShader(S,A),r.attachShader(S,E),void 0!==i.index0AttributeName?r.bindAttribLocation(S,0,i.index0AttributeName):!0===n.morphTargets&&r.bindAttribLocation(S,0,"position"),r.linkProgram(S);var P,L,I=r.getProgramInfoLog(S),R=r.getShaderInfoLog(A),D=r.getShaderInfoLog(E),O=!0,k=!0;return!1===r.getProgramParameter(S,r.LINK_STATUS)?(O=!1,console.error("THREE.WebGLProgram: shader error: ",r.getError(),"gl.VALIDATE_STATUS",r.getProgramParameter(S,r.VALIDATE_STATUS),"gl.getProgramInfoLog",I,R,D)):""!==I?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",I):""!==R&&""!==D||(k=!1),k&&(this.diagnostics={runnable:O,material:i,programLog:I,vertexShader:{log:R,prefix:m},fragmentShader:{log:D,prefix:v}}),r.deleteShader(A),r.deleteShader(E),this.getUniforms=function(){return void 0===P&&(P=new eG(r,S,t)),P},this.getAttributes=function(){return void 0===L&&(L=function(t,e,i){for(var n={},r=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES),o=0;o<r;o++){var a=t.getActiveAttrib(e,o).name;n[a]=t.getAttribLocation(e,a)}return n}(r,S)),L},this.destroy=function(){r.deleteProgram(S),this.program=void 0},Object.defineProperties(this,{uniforms:{get:function(){return console.warn("THREE.WebGLProgram: .uniforms is now .getUniforms()."),this.getUniforms()}},attributes:{get:function(){return console.warn("THREE.WebGLProgram: .attributes is now .getAttributes()."),this.getAttributes()}}}),this.id=FH++,this.code=e,this.usedTimes=1,this.program=S,this.vertexShader=A,this.fragmentShader=E,this}function XH(c,u){var s=[],d={MeshDepthMaterial:"depth",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"phong",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points"},o=["precision","supportsVertexTextures","map","mapEncoding","envMap","envMapMode","envMapEncoding","lightMap","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","fog","useFog","fogExp","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking"];function p(t,e){var i;return t?t.isTexture?i=t.encoding:t.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),i=t.texture.encoding):i=OB,i===OB&&e&&(i=zB),i}this.getParameters=function(t,e,i,n,r,o){var a=d[t.type],s=function(t){if(u.floatVertexTextures&&t&&t.skeleton&&t.skeleton.useVertexTexture)return 1024;var e=u.maxVertexUniforms,i=Math.floor((e-20)/4);return void 0!==t&&t&&t.isSkinnedMesh&&(i=Math.min(t.skeleton.bones.length,i))<t.skeleton.bones.length&&console.warn("WebGLRenderer: too many bones - "+t.skeleton.bones.length+", this GPU supports just "+i+" (try OpenGL instead of ANGLE)"),i}(o),l=c.getPrecision();null!==t.precision&&(l=u.getMaxPrecision(t.precision))!==t.precision&&console.warn("THREE.WebGLProgram.getParameters:",t.precision,"not supported, using",l,"instead.");var h=c.getCurrentRenderTarget();return{shaderID:a,precision:l,supportsVertexTextures:u.vertexTextures,outputEncoding:p(h?h.texture:null,c.gammaOutput),map:!!t.map,mapEncoding:p(t.map,c.gammaInput),envMap:!!t.envMap,envMapMode:t.envMap&&t.envMap.mapping,envMapEncoding:p(t.envMap,c.gammaInput),envMapCubeUV:!!t.envMap&&(t.envMap.mapping===sB||t.envMap.mapping===lB),lightMap:!!t.lightMap,aoMap:!!t.aoMap,emissiveMap:!!t.emissiveMap,emissiveMapEncoding:p(t.emissiveMap,c.gammaInput),bumpMap:!!t.bumpMap,normalMap:!!t.normalMap,displacementMap:!!t.displacementMap,roughnessMap:!!t.roughnessMap,metalnessMap:!!t.metalnessMap,specularMap:!!t.specularMap,alphaMap:!!t.alphaMap,gradientMap:!!t.gradientMap,combine:t.combine,vertexColors:t.vertexColors,fog:!!i,useFog:t.fog,fogExp:i&&i.isFogExp2,flatShading:t.shading===EN,sizeAttenuation:t.sizeAttenuation,logarithmicDepthBuffer:u.logarithmicDepthBuffer,skinning:t.skinning,maxBones:s,useVertexTexture:u.floatVertexTextures&&o&&o.skeleton&&o.skeleton.useVertexTexture,morphTargets:t.morphTargets,morphNormals:t.morphNormals,maxMorphTargets:c.maxMorphTargets,maxMorphNormals:c.maxMorphNormals,numDirLights:e.directional.length,numPointLights:e.point.length,numSpotLights:e.spot.length,numRectAreaLights:e.rectArea.length,numHemiLights:e.hemi.length,numClippingPlanes:n,numClipIntersection:r,shadowMapEnabled:c.shadowMap.enabled&&o.receiveShadow&&0<e.shadows.length,shadowMapType:c.shadowMap.type,toneMapping:c.toneMapping,physicallyCorrectLights:c.physicallyCorrectLights,premultipliedAlpha:t.premultipliedAlpha,alphaTest:t.alphaTest,doubleSided:t.side===AN,flipSided:t.side===CN,depthPacking:void 0!==t.depthPacking&&t.depthPacking}},this.getProgramCode=function(t,e){var i=[];if(e.shaderID?i.push(e.shaderID):(i.push(t.fragmentShader),i.push(t.vertexShader)),void 0!==t.defines)for(var n in t.defines)i.push(n),i.push(t.defines[n]);for(var r=0;r<o.length;r++)i.push(e[o[r]]);return i.join()},this.acquireProgram=function(t,e,i){for(var n,r=0,o=s.length;r<o;r++){var a=s[r];if(a.code===i){++(n=a).usedTimes;break}}return void 0===n&&(n=new ZH(c,i,t,e),s.push(n)),n},this.releaseProgram=function(t){if(0==--t.usedTimes){var e=s.indexOf(t);s[e]=s[s.length-1],s.pop(),t.destroy()}},this.programs=s}function qH(r,o,a){var s={};function l(t){var e=t.target,i=s[e.id];null!==i.index&&h(i.index),function(t){for(var e in t)h(t[e])}(i.attributes),e.removeEventListener("dispose",l),delete s[e.id];var n=o.get(e);n.wireframe&&h(n.wireframe),o.delete(e);var r=o.get(i);r.wireframe&&h(r.wireframe),o.delete(i),a.memory.geometries--}function h(t){var e,i,n=(e=t).isInterleavedBufferAttribute?o.get(e.data).__webglBuffer:o.get(e).__webglBuffer;void 0!==n&&(r.deleteBuffer(n),(i=t).isInterleavedBufferAttribute?o.delete(i.data):o.delete(i))}return{get:function(t){var e,i=t.geometry;return void 0!==s[i.id]?s[i.id]:(i.addEventListener("dispose",l),i.isBufferGeometry?e=i:i.isGeometry&&(void 0===i._bufferGeometry&&(i._bufferGeometry=(new gH).setFromObject(t)),e=i._bufferGeometry),s[i.id]=e,a.memory.geometries++,e)}}}function YH(d,p,t){var h=new qH(d,p,t);function f(t,e){var i=t.isInterleavedBufferAttribute?t.data:t,n=p.get(i);void 0===n.__webglBuffer?function(t,e,i){t.__webglBuffer=d.createBuffer(),d.bindBuffer(i,t.__webglBuffer);var n=e.dynamic?d.DYNAMIC_DRAW:d.STATIC_DRAW;d.bufferData(i,e.array,n);var r=d.FLOAT,o=e.array;o instanceof Float32Array?r=d.FLOAT:o instanceof Float64Array?console.warn("Unsupported data buffer format: Float64Array"):o instanceof Uint16Array?r=d.UNSIGNED_SHORT:o instanceof Int16Array?r=d.SHORT:o instanceof Uint32Array?r=d.UNSIGNED_INT:o instanceof Int32Array?r=d.INT:o instanceof Int8Array?r=d.BYTE:o instanceof Uint8Array&&(r=d.UNSIGNED_BYTE);t.bytesPerElement=o.BYTES_PER_ELEMENT,t.type=r,t.version=e.version,e.onUploadCallback()}(n,i,e):n.version!==i.version&&function(t,e,i){d.bindBuffer(i,t.__webglBuffer),!1===e.dynamic?d.bufferData(i,e.array,d.STATIC_DRAW):-1===e.updateRange.count?d.bufferSubData(i,0,e.array):0===e.updateRange.count?console.error("THREE.WebGLObjects.updateBuffer: dynamic THREE.BufferAttribute marked as needsUpdate but updateRange.count is 0, ensure you are using set methods or updating manually."):(d.bufferSubData(i,e.updateRange.offset*e.array.BYTES_PER_ELEMENT,e.array.subarray(e.updateRange.offset,e.updateRange.offset+e.updateRange.count)),e.updateRange.count=0);t.version=e.version}(n,i,e)}return{getAttributeBuffer:function(t){return t.isInterleavedBufferAttribute?p.get(t.data).__webglBuffer:p.get(t).__webglBuffer},getAttributeProperties:function(t){return t.isInterleavedBufferAttribute?p.get(t.data):p.get(t)},getWireframeAttribute:function(t){var e=p.get(t);if(void 0!==e.wireframe)return e.wireframe;var i,n=[],r=t.index,o=t.attributes;if(null!==r)for(var a=0,s=(i=r.array).length;a<s;a+=3){var l=i[a+0],h=i[a+1],c=i[a+2];n.push(l,h,h,c,c,l)}else for(a=0,s=(i=o.position.array).length/3-1;a<s;a+=3)l=a+0,h=a+1,c=a+2,n.push(l,h,h,c,c,l);var u=new(65535<YV(n)?jV:UV)(n,1);return f(u,d.ELEMENT_ARRAY_BUFFER),e.wireframe=u},update:function(t){var e=h.get(t);t.geometry.isGeometry&&e.updateFromObject(t);var i=e.index,n=e.attributes;for(var r in null!==i&&f(i,d.ELEMENT_ARRAY_BUFFER),n)f(n[r],d.ARRAY_BUFFER);var o=e.morphAttributes;for(var r in o)for(var a=o[r],s=0,l=a.length;s<l;s++)f(a[s],d.ARRAY_BUFFER);return e}}}function JH(f,r,g,m,v,y,t){var _=t.memory,p="undefined"!=typeof WebGL2RenderingContext&&f instanceof WebGL2RenderingContext;function x(t,e){if(t.width>e||t.height>e){var i=e/Math.max(t.width,t.height),n=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return n.width=Math.floor(t.width*i),n.height=Math.floor(t.height*i),n.getContext("2d").drawImage(t,0,0,t.width,t.height,0,0,n.width,n.height),console.warn("THREE.WebGLRenderer: image is too big ("+t.width+"x"+t.height+"). Resized to "+n.width+"x"+n.height,t),n}return t}function w(t){return UB.isPowerOfTwo(t.width)&&UB.isPowerOfTwo(t.height)}function o(t){return t===dB||t===pB||t===fB?f.NEAREST:f.LINEAR}function b(t){var e=t.target;e.removeEventListener("dispose",b),function(t){var e=m.get(t);if(t.image&&e.__image__webglTextureCube)f.deleteTexture(e.__image__webglTextureCube);else{if(void 0===e.__webglInit)return;f.deleteTexture(e.__webglTexture)}m.delete(t)}(e),_.textures--}function a(t){var e=t.target;e.removeEventListener("dispose",a),function(t){var e=m.get(t),i=m.get(t.texture);if(!t)return;void 0!==i.__webglTexture&&f.deleteTexture(i.__webglTexture);t.depthTexture&&t.depthTexture.dispose();if(t.isWebGLRenderTargetCube)for(var n=0;n<6;n++)f.deleteFramebuffer(e.__webglFramebuffer[n]),e.__webglDepthbuffer&&f.deleteRenderbuffer(e.__webglDepthbuffer[n]);else f.deleteFramebuffer(e.__webglFramebuffer),e.__webglDepthbuffer&&f.deleteRenderbuffer(e.__webglDepthbuffer);m.delete(t.texture),m.delete(t)}(e),_.textures--}function s(t,e){var i=m.get(t);if(0<t.version&&i.__version!==t.version){var n=t.image;if(void 0===n)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined",t);else{if(!1!==n.complete)return void function(t,e,i){void 0===t.__webglInit&&(t.__webglInit=!0,e.addEventListener("dispose",b),t.__webglTexture=f.createTexture(),_.textures++);g.activeTexture(f.TEXTURE0+i),g.bindTexture(f.TEXTURE_2D,t.__webglTexture),f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,e.flipY),f.pixelStorei(f.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha),f.pixelStorei(f.UNPACK_ALIGNMENT,e.unpackAlignment);var n=x(e.image,v.maxTextureSize);r=e,(r.wrapS!==cB||r.wrapT!==cB||r.minFilter!==dB&&r.minFilter!==gB)&&!1===w(n)&&(n=function(t){if(t instanceof HTMLImageElement||t instanceof HTMLCanvasElement){var e=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return e.width=UB.nearestPowerOfTwo(t.width),e.height=UB.nearestPowerOfTwo(t.height),e.getContext("2d").drawImage(t,0,0,e.width,e.height),console.warn("THREE.WebGLRenderer: image is not power of two ("+t.width+"x"+t.height+"). Resized to "+e.width+"x"+e.height,t),e}return t}(n));var r;var o=w(n),a=y(e.format),s=y(e.type);M(f.TEXTURE_2D,e,o);var l,h=e.mipmaps;if(e.isDepthTexture){var c=f.DEPTH_COMPONENT;if(e.type===xB){if(!p)throw new Error("Float Depth Texture only supported in WebGL2.0");c=f.DEPTH_COMPONENT32F}else p&&(c=f.DEPTH_COMPONENT16);e.format===CB&&c===f.DEPTH_COMPONENT&&e.type!==yB&&e.type!==_B&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),e.type=yB,s=y(e.type)),e.format===AB&&(c=f.DEPTH_STENCIL,e.type!==bB&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),e.type=bB,s=y(e.type))),g.texImage2D(f.TEXTURE_2D,0,c,n.width,n.height,0,a,s,null)}else if(e.isDataTexture)if(0<h.length&&o){for(var u=0,d=h.length;u<d;u++)l=h[u],g.texImage2D(f.TEXTURE_2D,u,a,l.width,l.height,0,a,s,l.data);e.generateMipmaps=!1}else g.texImage2D(f.TEXTURE_2D,0,a,n.width,n.height,0,a,s,n.data);else if(e.isCompressedTexture)for(var u=0,d=h.length;u<d;u++)l=h[u],e.format!==SB&&e.format!==MB?-1<g.getCompressedTextureFormats().indexOf(a)?g.compressedTexImage2D(f.TEXTURE_2D,u,a,l.width,l.height,0,l.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):g.texImage2D(f.TEXTURE_2D,u,a,l.width,l.height,0,a,s,l.data);else if(0<h.length&&o){for(var u=0,d=h.length;u<d;u++)l=h[u],g.texImage2D(f.TEXTURE_2D,u,a,a,s,l);e.generateMipmaps=!1}else g.texImage2D(f.TEXTURE_2D,0,a,a,s,n);e.generateMipmaps&&o&&f.generateMipmap(f.TEXTURE_2D);t.__version=e.version,e.onUpdate&&e.onUpdate(e)}(i,t,e);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete",t)}}g.activeTexture(f.TEXTURE0+e),g.bindTexture(f.TEXTURE_2D,i.__webglTexture)}function M(t,e,i){var n;if(i?(f.texParameteri(t,f.TEXTURE_WRAP_S,y(e.wrapS)),f.texParameteri(t,f.TEXTURE_WRAP_T,y(e.wrapT)),f.texParameteri(t,f.TEXTURE_MAG_FILTER,y(e.magFilter)),f.texParameteri(t,f.TEXTURE_MIN_FILTER,y(e.minFilter))):(f.texParameteri(t,f.TEXTURE_WRAP_S,f.CLAMP_TO_EDGE),f.texParameteri(t,f.TEXTURE_WRAP_T,f.CLAMP_TO_EDGE),e.wrapS===cB&&e.wrapT===cB||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping.",e),f.texParameteri(t,f.TEXTURE_MAG_FILTER,o(e.magFilter)),f.texParameteri(t,f.TEXTURE_MIN_FILTER,o(e.minFilter)),e.minFilter!==dB&&e.minFilter!==gB&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.",e)),n=r.get("EXT_texture_filter_anisotropic")){if(e.type===xB&&null===r.get("OES_texture_float_linear"))return;if(e.type===wB&&null===r.get("OES_texture_half_float_linear"))return;(1<e.anisotropy||m.get(e).__currentAnisotropy)&&(f.texParameterf(t,n.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(e.anisotropy,v.getMaxAnisotropy())),m.get(e).__currentAnisotropy=e.anisotropy)}}function l(t,e,i,n){var r=y(e.texture.format),o=y(e.texture.type);g.texImage2D(n,0,r,e.width,e.height,0,r,o,null),f.bindFramebuffer(f.FRAMEBUFFER,t),f.framebufferTexture2D(f.FRAMEBUFFER,i,n,m.get(e.texture).__webglTexture,0),f.bindFramebuffer(f.FRAMEBUFFER,null)}function h(t,e){f.bindRenderbuffer(f.RENDERBUFFER,t),e.depthBuffer&&!e.stencilBuffer?(f.renderbufferStorage(f.RENDERBUFFER,f.DEPTH_COMPONENT16,e.width,e.height),f.framebufferRenderbuffer(f.FRAMEBUFFER,f.DEPTH_ATTACHMENT,f.RENDERBUFFER,t)):e.depthBuffer&&e.stencilBuffer?(f.renderbufferStorage(f.RENDERBUFFER,f.DEPTH_STENCIL,e.width,e.height),f.framebufferRenderbuffer(f.FRAMEBUFFER,f.DEPTH_STENCIL_ATTACHMENT,f.RENDERBUFFER,t)):f.renderbufferStorage(f.RENDERBUFFER,f.RGBA4,e.width,e.height),f.bindRenderbuffer(f.RENDERBUFFER,null)}function c(t){var e=m.get(t),i=!0===t.isWebGLRenderTargetCube;if(t.depthTexture){if(i)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,e){if(e&&e.isWebGLRenderTargetCube)throw new Error("Depth Texture with cube render targets is not supported!");if(f.bindFramebuffer(f.FRAMEBUFFER,t),!e.depthTexture||!e.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");m.get(e.depthTexture).__webglTexture&&e.depthTexture.image.width===e.width&&e.depthTexture.image.height===e.height||(e.depthTexture.image.width=e.width,e.depthTexture.image.height=e.height,e.depthTexture.needsUpdate=!0),s(e.depthTexture,0);var i=m.get(e.depthTexture).__webglTexture;if(e.depthTexture.format===CB)f.framebufferTexture2D(f.FRAMEBUFFER,f.DEPTH_ATTACHMENT,f.TEXTURE_2D,i,0);else{if(e.depthTexture.format!==AB)throw new Error("Unknown depthTexture format");f.framebufferTexture2D(f.FRAMEBUFFER,f.DEPTH_STENCIL_ATTACHMENT,f.TEXTURE_2D,i,0)}}(e.__webglFramebuffer,t)}else if(i){e.__webglDepthbuffer=[];for(var n=0;n<6;n++)f.bindFramebuffer(f.FRAMEBUFFER,e.__webglFramebuffer[n]),e.__webglDepthbuffer[n]=f.createRenderbuffer(),h(e.__webglDepthbuffer[n],t)}else f.bindFramebuffer(f.FRAMEBUFFER,e.__webglFramebuffer),e.__webglDepthbuffer=f.createRenderbuffer(),h(e.__webglDepthbuffer,t);f.bindFramebuffer(f.FRAMEBUFFER,null)}this.setTexture2D=s,this.setTextureCube=function(t,e){var i=m.get(t);if(6===t.image.length)if(0<t.version&&i.__version!==t.version){i.__image__webglTextureCube||(t.addEventListener("dispose",b),i.__image__webglTextureCube=f.createTexture(),_.textures++),g.activeTexture(f.TEXTURE0+e),g.bindTexture(f.TEXTURE_CUBE_MAP,i.__image__webglTextureCube),f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,t.flipY);for(var n=t&&t.isCompressedTexture,r=t.image[0]&&t.image[0].isDataTexture,o=[],a=0;a<6;a++)o[a]=n||r?r?t.image[a].image:t.image[a]:x(t.image[a],v.maxCubemapSize);var s=w(o[0]),l=y(t.format),h=y(t.type);for(M(f.TEXTURE_CUBE_MAP,t,s),a=0;a<6;a++)if(n)for(var c,u=o[a].mipmaps,d=0,p=u.length;d<p;d++)c=u[d],t.format!==SB&&t.format!==MB?-1<g.getCompressedTextureFormats().indexOf(l)?g.compressedTexImage2D(f.TEXTURE_CUBE_MAP_POSITIVE_X+a,d,l,c.width,c.height,0,c.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):g.texImage2D(f.TEXTURE_CUBE_MAP_POSITIVE_X+a,d,l,c.width,c.height,0,l,h,c.data);else r?g.texImage2D(f.TEXTURE_CUBE_MAP_POSITIVE_X+a,0,l,o[a].width,o[a].height,0,l,h,o[a].data):g.texImage2D(f.TEXTURE_CUBE_MAP_POSITIVE_X+a,0,l,l,h,o[a]);t.generateMipmaps&&s&&f.generateMipmap(f.TEXTURE_CUBE_MAP),i.__version=t.version,t.onUpdate&&t.onUpdate(t)}else g.activeTexture(f.TEXTURE0+e),g.bindTexture(f.TEXTURE_CUBE_MAP,i.__image__webglTextureCube)},this.setTextureCubeDynamic=function(t,e){g.activeTexture(f.TEXTURE0+e),g.bindTexture(f.TEXTURE_CUBE_MAP,m.get(t).__webglTexture)},this.setupRenderTarget=function(t){var e=m.get(t),i=m.get(t.texture);t.addEventListener("dispose",a),i.__webglTexture=f.createTexture(),_.textures++;var n=!0===t.isWebGLRenderTargetCube,r=w(t);if(n){e.__webglFramebuffer=[];for(var o=0;o<6;o++)e.__webglFramebuffer[o]=f.createFramebuffer()}else e.__webglFramebuffer=f.createFramebuffer();if(n){for(g.bindTexture(f.TEXTURE_CUBE_MAP,i.__webglTexture),M(f.TEXTURE_CUBE_MAP,t.texture,r),o=0;o<6;o++)l(e.__webglFramebuffer[o],t,f.COLOR_ATTACHMENT0,f.TEXTURE_CUBE_MAP_POSITIVE_X+o);t.texture.generateMipmaps&&r&&f.generateMipmap(f.TEXTURE_CUBE_MAP),g.bindTexture(f.TEXTURE_CUBE_MAP,null)}else g.bindTexture(f.TEXTURE_2D,i.__webglTexture),M(f.TEXTURE_2D,t.texture,r),l(e.__webglFramebuffer,t,f.COLOR_ATTACHMENT0,f.TEXTURE_2D),t.texture.generateMipmaps&&r&&f.generateMipmap(f.TEXTURE_2D),g.bindTexture(f.TEXTURE_2D,null);t.depthBuffer&&c(t)},this.updateRenderTargetMipmap=function(t){var e=t.texture;if(e.generateMipmaps&&w(t)&&e.minFilter!==dB&&e.minFilter!==gB){var i=t&&t.isWebGLRenderTargetCube?f.TEXTURE_CUBE_MAP:f.TEXTURE_2D,n=m.get(e).__webglTexture;g.bindTexture(i,n),f.generateMipmap(i),g.bindTexture(i,null)}}}function KH(){var n={};return{get:function(t){var e=t.uuid,i=n[e];return void 0===i&&(i={},n[e]=i),i},delete:function(t){delete n[t.uuid]},clear:function(){n={}}}}function QH(c,i,l){var e=new function(){var e=!1,o=new dF,i=null,a=new dF;return{setMask:function(t){i===t||e||(c.colorMask(t,t,t,t),i=t)},setLocked:function(t){e=t},setClear:function(t,e,i,n,r){!0===r&&(t*=n,e*=n,i*=n),o.set(t,e,i,n),!1===a.equals(o)&&(c.clearColor(t,e,i,n),a.copy(o))},reset:function(){e=!1,i=null,a.set(0,0,0,1)}}},n=new function(){var e=!1,i=null,n=null,r=null;return{setTest:function(t){t?k(c.DEPTH_TEST):z(c.DEPTH_TEST)},setMask:function(t){i===t||e||(c.depthMask(t),i=t)},setFunc:function(t){if(n!==t){if(t)switch(t){case GN:c.depthFunc(c.NEVER);break;case VN:c.depthFunc(c.ALWAYS);break;case HN:c.depthFunc(c.LESS);break;case UN:c.depthFunc(c.LEQUAL);break;case WN:c.depthFunc(c.EQUAL);break;case jN:c.depthFunc(c.GEQUAL);break;case ZN:c.depthFunc(c.GREATER);break;case XN:c.depthFunc(c.NOTEQUAL);break;default:c.depthFunc(c.LEQUAL)}else c.depthFunc(c.LEQUAL);n=t}},setLocked:function(t){e=t},setClear:function(t){r!==t&&(c.clearDepth(t),r=t)},reset:function(){e=!1,r=n=i=null}}},r=new function(){var e=!1,i=null,n=null,r=null,o=null,a=null,s=null,l=null,h=null;return{setTest:function(t){t?k(c.STENCIL_TEST):z(c.STENCIL_TEST)},setMask:function(t){i===t||e||(c.stencilMask(t),i=t)},setFunc:function(t,e,i){n===t&&r===e&&o===i||(c.stencilFunc(t,e,i),n=t,r=e,o=i)},setOp:function(t,e,i){a===t&&s===e&&l===i||(c.stencilOp(t,e,i),a=t,s=e,l=i)},setLocked:function(t){e=t},setClear:function(t){h!==t&&(c.clearStencil(t),h=t)},reset:function(){e=!1,h=l=s=a=o=r=n=i=null}}},t=c.getParameter(c.MAX_VERTEX_ATTRIBS),o=new Uint8Array(t),a=new Uint8Array(t),s=new Uint8Array(t),h={},u=null,d=null,p=null,f=null,g=null,m=null,v=null,y=null,_=!1,x=null,w=null,b=null,M=null,S=null,T=null,C=c.getParameter(c.MAX_TEXTURE_IMAGE_UNITS),A=parseFloat(/^WebGL\ ([0-9])/.exec(c.getParameter(c.VERSION))[1]),E=1<=parseFloat(A),P=null,L={},I=new dF,R=new dF;function D(t,e,i){var n=new Uint8Array(4),r=c.createTexture();c.bindTexture(t,r),c.texParameteri(t,c.TEXTURE_MIN_FILTER,c.NEAREST),c.texParameteri(t,c.TEXTURE_MAG_FILTER,c.NEAREST);for(var o=0;o<i;o++)c.texImage2D(e+o,0,c.RGBA,1,1,0,c.RGBA,c.UNSIGNED_BYTE,n);return r}var O={};function k(t){!0!==h[t]&&(c.enable(t),h[t]=!0)}function z(t){!1!==h[t]&&(c.disable(t),h[t]=!1)}function N(t,e,i,n,r,o,a,s){t!==IN?k(c.BLEND):z(c.BLEND),t===d&&s===_||(t===DN?s?(c.blendEquationSeparate(c.FUNC_ADD,c.FUNC_ADD),c.blendFuncSeparate(c.ONE,c.ONE,c.ONE,c.ONE)):(c.blendEquation(c.FUNC_ADD),c.blendFunc(c.SRC_ALPHA,c.ONE)):t===ON?s?(c.blendEquationSeparate(c.FUNC_ADD,c.FUNC_ADD),c.blendFuncSeparate(c.ZERO,c.ZERO,c.ONE_MINUS_SRC_COLOR,c.ONE_MINUS_SRC_ALPHA)):(c.blendEquation(c.FUNC_ADD),c.blendFunc(c.ZERO,c.ONE_MINUS_SRC_COLOR)):t===kN?s?(c.blendEquationSeparate(c.FUNC_ADD,c.FUNC_ADD),c.blendFuncSeparate(c.ZERO,c.SRC_COLOR,c.ZERO,c.SRC_ALPHA)):(c.blendEquation(c.FUNC_ADD),c.blendFunc(c.ZERO,c.SRC_COLOR)):s?(c.blendEquationSeparate(c.FUNC_ADD,c.FUNC_ADD),c.blendFuncSeparate(c.ONE,c.ONE_MINUS_SRC_ALPHA,c.ONE,c.ONE_MINUS_SRC_ALPHA)):(c.blendEquationSeparate(c.FUNC_ADD,c.FUNC_ADD),c.blendFuncSeparate(c.SRC_ALPHA,c.ONE_MINUS_SRC_ALPHA,c.ONE,c.ONE_MINUS_SRC_ALPHA)),d=t,_=s),t===zN?(r=r||e,o=o||i,a=a||n,e===p&&r===m||(c.blendEquationSeparate(l(e),l(r)),p=e,m=r),i===f&&n===g&&o===v&&a===y||(c.blendFuncSeparate(l(i),l(n),l(o),l(a)),f=i,g=n,v=o,y=a)):y=v=m=g=f=p=null}function B(t){n.setFunc(t)}function F(t){x!==t&&(t?c.frontFace(c.CW):c.frontFace(c.CCW),x=t)}function G(t){t!==xN?(k(c.CULL_FACE),t!==w&&(t===wN?c.cullFace(c.BACK):t===bN?c.cullFace(c.FRONT):c.cullFace(c.FRONT_AND_BACK))):z(c.CULL_FACE),w=t}function V(t){void 0===t&&(t=c.TEXTURE0+C-1),P!==t&&(c.activeTexture(t),P=t)}return O[c.TEXTURE_2D]=D(c.TEXTURE_2D,c.TEXTURE_2D,1),O[c.TEXTURE_CUBE_MAP]=D(c.TEXTURE_CUBE_MAP,c.TEXTURE_CUBE_MAP_POSITIVE_X,6),{buffers:{color:e,depth:n,stencil:r},init:function(){e.setClear(0,0,0,1),n.setClear(1),r.setClear(0),k(c.DEPTH_TEST),B(UN),F(!1),G(wN),k(c.CULL_FACE),k(c.BLEND),N(RN)},initAttributes:function(){for(var t=0,e=o.length;t<e;t++)o[t]=0},enableAttribute:function(t){o[t]=1,0===a[t]&&(c.enableVertexAttribArray(t),a[t]=1),0!==s[t]&&(i.get("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(t,0),s[t]=0)},enableAttributeAndDivisor:function(t,e,i){o[t]=1,0===a[t]&&(c.enableVertexAttribArray(t),a[t]=1),s[t]!==e&&(i.vertexAttribDivisorANGLE(t,e),s[t]=e)},disableUnusedAttributes:function(){for(var t=0,e=a.length;t!==e;++t)a[t]!==o[t]&&(c.disableVertexAttribArray(t),a[t]=0)},enable:k,disable:z,getCompressedTextureFormats:function(){if(null===u&&(u=[],i.get("WEBGL_compressed_texture_pvrtc")||i.get("WEBGL_compressed_texture_s3tc")||i.get("WEBGL_compressed_texture_etc1")))for(var t=c.getParameter(c.COMPRESSED_TEXTURE_FORMATS),e=0;e<t.length;e++)u.push(t[e]);return u},setBlending:N,setColorWrite:function(t){e.setMask(t)},setDepthTest:function(t){n.setTest(t)},setDepthWrite:function(t){n.setMask(t)},setDepthFunc:B,setStencilTest:function(t){r.setTest(t)},setStencilWrite:function(t){r.setMask(t)},setStencilFunc:function(t,e,i){r.setFunc(t,e,i)},setStencilOp:function(t,e,i){r.setOp(t,e,i)},setFlipSided:F,setCullFace:G,setLineWidth:function(t){t!==b&&(E&&c.lineWidth(t),b=t)},setPolygonOffset:function(t,e,i){t?(k(c.POLYGON_OFFSET_FILL),M===e&&S===i||(c.polygonOffset(e,i),M=e,S=i)):z(c.POLYGON_OFFSET_FILL)},getScissorTest:function(){return T},setScissorTest:function(t){(T=t)?k(c.SCISSOR_TEST):z(c.SCISSOR_TEST)},activeTexture:V,bindTexture:function(t,e){null===P&&V();var i=L[P];void 0===i&&(i={type:void 0,texture:void 0},L[P]=i),i.type===t&&i.texture===e||(c.bindTexture(t,e||O[t]),i.type=t,i.texture=e)},compressedTexImage2D:function(){try{c.compressedTexImage2D.apply(c,arguments)}catch(t){console.error(t)}},texImage2D:function(){try{c.texImage2D.apply(c,arguments)}catch(t){console.error(t)}},scissor:function(t){!1===I.equals(t)&&(c.scissor(t.x,t.y,t.z,t.w),I.copy(t))},viewport:function(t){!1===R.equals(t)&&(c.viewport(t.x,t.y,t.z,t.w),R.copy(t))},reset:function(){for(var t=0;t<a.length;t++)1===a[t]&&(c.disableVertexAttribArray(t),a[t]=0);h={},L={},w=x=d=P=u=null,e.reset(),n.reset(),r.reset()}}}function $H(e,i,t){var n;function r(t){if("highp"===t){if(0<e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision&&0<e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision)return"highp";t="mediump"}return"mediump"===t&&0<e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision&&0<e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision?"mediump":"lowp"}var o=void 0!==t.precision?t.precision:"highp",a=r(o);a!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",a,"instead."),o=a);var s=!0===t.logarithmicDepthBuffer&&!!i.get("EXT_frag_depth"),l=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),h=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),c=e.getParameter(e.MAX_TEXTURE_SIZE),u=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),d=e.getParameter(e.MAX_VERTEX_ATTRIBS),p=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),f=e.getParameter(e.MAX_VARYING_VECTORS),g=e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),m=0<h,v=!!i.get("OES_texture_float");return{getMaxAnisotropy:function(){if(void 0!==n)return n;var t=i.get("EXT_texture_filter_anisotropic");return n=null!==t?e.getParameter(t.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},getMaxPrecision:r,precision:o,logarithmicDepthBuffer:s,maxTextures:l,maxVertexTextures:h,maxTextureSize:c,maxCubemapSize:u,maxAttributes:d,maxVertexUniforms:p,maxVaryings:f,maxFragmentUniforms:g,vertexTextures:m,floatFragmentTextures:v,floatVertexTextures:m&&v}}function tU(i){var n={};return{get:function(t){if(void 0!==n[t])return n[t];var e;switch(t){case"WEBGL_depth_texture":e=i.getExtension("WEBGL_depth_texture")||i.getExtension("MOZ_WEBGL_depth_texture")||i.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":e=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":e=i.getExtension("WEBGL_compressed_texture_s3tc")||i.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||i.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":e=i.getExtension("WEBGL_compressed_texture_pvrtc")||i.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;case"WEBGL_compressed_texture_etc1":e=i.getExtension("WEBGL_compressed_texture_etc1");break;default:e=i.getExtension(t)}return null===e&&console.warn("THREE.WebGLRenderer: "+t+" extension not supported."),n[t]=e}}}function eU(){var c=this,u=null,d=0,p=!1,f=!1,g=new KG,m=new JG,v={value:null,needsUpdate:!1};function y(){v.value!==u&&(v.value=u,v.needsUpdate=0<d),c.numPlanes=d,c.numIntersection=0}function _(t,e,i,n){var r=null!==t?t.length:0,o=null;if(0!==r){if(o=v.value,!0!==n||null===o){var a=i+4*r,s=e.matrixWorldInverse;m.getNormalMatrix(s),(null===o||o.length<a)&&(o=new Float32Array(a));for(var l=0,h=i;l!==r;++l,h+=4)g.copy(t[l]).applyMatrix4(s,m),g.normal.toArray(o,h),o[h+3]=g.constant}v.value=o,v.needsUpdate=!0}return c.numPlanes=r,o}this.uniform=v,this.numPlanes=0,this.numIntersection=0,this.init=function(t,e,i){var n=0!==t.length||e||0!==d||p;return p=e,u=_(t,i,0),d=t.length,n},this.beginShadows=function(){f=!0,_(null)},this.endShadows=function(){f=!1,y()},this.setState=function(t,e,i,n,r,o){if(!p||null===t||0===t.length||f&&!i)f?_(null):y();else{var a=f?0:d,s=4*a,l=r.clippingState||null;v.value=l,l=_(t,n,s,o);for(var h=0;h!==s;++h)l[h]=u[h];r.clippingState=l,this.numIntersection=e?this.numPlanes:0,this.numPlanes+=a}}}function iU(t){console.log("THREE.WebGLRenderer","84");var n=void 0!==(t=t||{}).canvas?t.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),e=void 0!==t.context?t.context:null,i=void 0!==t.alpha&&t.alpha,r=void 0===t.depth||t.depth,o=void 0===t.stencil||t.stencil,a=void 0!==t.antialias&&t.antialias,s=void 0===t.premultipliedAlpha||t.premultipliedAlpha,l=void 0!==t.preserveDrawingBuffer&&t.preserveDrawingBuffer,f=[],h=[],c=-1,u=[],d=-1,P=new Float32Array(8),g=[],m=[];this.domElement=n,this.context=null,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.gammaInput=!1,this.gammaOutput=!1,this.physicallyCorrectLights=!1,this.toneMapping=QN,this.toneMappingExposure=1,this.toneMappingWhitePoint=1,this.maxMorphTargets=8,this.maxMorphNormals=4;var L,C=this,A=null,p=null,v=null,E=-1,I="",R=null,y=new dF,_=null,x=new dF,D=0,w=new rG(0),b=0,M=n.width,O=n.height,k=1,S=new dF(0,0,M,O),T=!1,z=new dF(0,0,M,O),N=new QG,B=new eU,F=!1,G=!1,V=new YG,H=new vF,U=new mF,W=new vF,j=new vF,Z={hash:"",ambient:[0,0,0],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],shadows:[]},X={calls:0,vertices:0,faces:0,points:0};this.info={render:X,memory:{geometries:0,textures:0},programs:null};try{var q={alpha:i,depth:r,stencil:o,antialias:a,premultipliedAlpha:s,preserveDrawingBuffer:l};if(null===(L=e||n.getContext("webgl",q)||n.getContext("experimental-webgl",q)))throw null!==n.getContext("webgl")?"Error creating WebGL context with your selected attributes.":"Error creating WebGL context.";void 0===L.getShaderPrecisionFormat&&(L.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}}),n.addEventListener("webglcontextlost",yt,!1)}catch(t){console.error("THREE.WebGLRenderer: "+t)}var Y=new tU(L);Y.get("WEBGL_depth_texture"),Y.get("OES_texture_float"),Y.get("OES_texture_float_linear"),Y.get("OES_texture_half_float"),Y.get("OES_texture_half_float_linear"),Y.get("OES_standard_derivatives"),Y.get("ANGLE_instanced_arrays"),Y.get("OES_element_index_uint")&&(gH.MaxIndex=4294967296);var J=new $H(L,Y,t),K=new QH(L,Y,Rt),Q=new KH,$=new JH(L,Y,K,Q,J,Rt,this.info),tt=new YH(L,Q,this.info),et=new XH(this,J),it=new CH;this.info.programs=et.programs;var nt,rt,ot,at,st=new TH(L,Y,X),lt=new SH(L,Y,X);function ht(){return null===p?k:1}function ct(){K.init(),K.scissor(y.copy(S).multiplyScalar(k)),K.viewport(x.copy(z).multiplyScalar(k)),K.buffers.color.setClear(w.r,w.g,w.b,b,s)}function ut(){R=A=null,I="",E=-1,K.reset()}ct(),this.context=L,this.capabilities=J,this.extensions=Y,this.properties=Q,this.state=K;var dt=new $G(this,Z,tt,J);this.shadowMap=dt;var pt,ft,gt,mt=new pG(this,g),vt=new dG(this,m);function yt(t){t.preventDefault(),ut(),ct(),Q.clear()}function _t(t){var e,i=t.target;i.removeEventListener("dispose",_t),xt(e=i),Q.delete(e)}function xt(t){var e=Q.get(t).program;(t.program=void 0)!==e&&et.releaseProgram(e)}function wt(t,e){return Math.abs(e[0])-Math.abs(t[0])}function bt(t,e){return t.object.renderOrder!==e.object.renderOrder?t.object.renderOrder-e.object.renderOrder:t.material.program&&e.material.program&&t.material.program!==e.material.program?t.material.program.id-e.material.program.id:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function Mt(t,e){return t.object.renderOrder!==e.object.renderOrder?t.object.renderOrder-e.object.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function St(t,e,i,n,r){var o,a;i.transparent?(o=u,a=++d):(o=h,a=++c);var s=o[a];void 0!==s?(s.id=t.id,s.object=t,s.geometry=e,s.material=i,s.z=U.z,s.group=r):(s={id:t.id,object:t,geometry:e,material:i,z:U.z,group:r},o.push(s))}function Tt(t){if(!N.intersectsSphere(t))return!1;var e=B.numPlanes;if(0===e)return!0;var i=C.clippingPlanes,n=t.center,r=-t.radius,o=0;do{if(i[o].distanceToPoint(n)<r)return!1}while(++o!==e);return!0}function Ct(t,e,i,n){for(var r=0,o=t.length;r<o;r++){var a=t[r],s=a.object,l=a.geometry,h=void 0===n?a.material:n,c=a.group;if(s.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,s.matrixWorld),s.normalMatrix.getNormalMatrix(s.modelViewMatrix),s.onBeforeRender(C,e,i,l,h,c),s.isImmediateRenderObject){At(h);var u=Et(i,e.fog,h,s);I="",s.render(function(t){C.renderBufferImmediate(t,u,h)})}else C.renderBufferDirect(i,e.fog,l,h,s,c);s.onAfterRender(C,e,i,l,h,c)}}function At(t){t.side===AN?K.disable(L.CULL_FACE):K.enable(L.CULL_FACE),K.setFlipSided(t.side===CN),!0===t.transparent?K.setBlending(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha):K.setBlending(IN),K.setDepthFunc(t.depthFunc),K.setDepthTest(t.depthTest),K.setDepthWrite(t.depthWrite),K.setColorWrite(t.colorWrite),K.setPolygonOffset(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits)}function Et(t,e,i,n){D=0;var r=Q.get(i);if(F&&(G||t!==R)){var o=t===R&&i.id===E;B.setState(i.clippingPlanes,i.clipIntersection,i.clipShadows,t,r,o)}!1===i.needsUpdate&&(void 0===r.program?i.needsUpdate=!0:i.fog&&r.fog!==e?i.needsUpdate=!0:i.lights&&r.lightsHash!==Z.hash?i.needsUpdate=!0:void 0===r.numClippingPlanes||r.numClippingPlanes===B.numPlanes&&r.numIntersection===B.numIntersection||(i.needsUpdate=!0)),i.needsUpdate&&(!function(t,e,i){var n=Q.get(t),r=et.getParameters(t,Z,e,B.numPlanes,B.numIntersection,i),o=et.getProgramCode(t,r),a=n.program,s=!0;if(void 0===a)t.addEventListener("dispose",_t);else if(a.code!==o)xt(t);else{if(void 0!==r.shaderID)return;s=!1}if(s){if(r.shaderID){var l=cG[r.shaderID];n.__webglShader={name:t.type,uniforms:iG.clone(l.uniforms),vertexShader:l.vertexShader,fragmentShader:l.fragmentShader}}else n.__webglShader={name:t.type,uniforms:t.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader};t.__webglShader=n.__webglShader,a=et.acquireProgram(t,r,o),n.program=a,t.program=a}var h=a.getAttributes();if(t.morphTargets)for(var c=t.numSupportedMorphTargets=0;c<C.maxMorphTargets;c++)0<=h["morphTarget"+c]&&t.numSupportedMorphTargets++;if(t.morphNormals)for(c=t.numSupportedMorphNormals=0;c<C.maxMorphNormals;c++)0<=h["morphNormal"+c]&&t.numSupportedMorphNormals++;var u=n.__webglShader.uniforms;(t.isShaderMaterial||t.isRawShaderMaterial)&&!0!==t.clipping||(n.numClippingPlanes=B.numPlanes,n.numIntersection=B.numIntersection,u.clippingPlanes=B.uniform),n.fog=e,n.lightsHash=Z.hash,t.lights&&(u.ambientLightColor.value=Z.ambient,u.directionalLights.value=Z.directional,u.spotLights.value=Z.spot,u.rectAreaLights.value=Z.rectArea,u.pointLights.value=Z.point,u.hemisphereLights.value=Z.hemi,u.directionalShadowMap.value=Z.directionalShadowMap,u.directionalShadowMatrix.value=Z.directionalShadowMatrix,u.spotShadowMap.value=Z.spotShadowMap,u.spotShadowMatrix.value=Z.spotShadowMatrix,u.pointShadowMap.value=Z.pointShadowMap,u.pointShadowMatrix.value=Z.pointShadowMatrix);var d=n.program.getUniforms(),p=eG.seqWithValue(d.seq,u);n.uniformsList=p}(i,e,n),i.needsUpdate=!1);var a,s,l,h,c,u,d,p,f,g,m,v,y=!1,_=!1,x=!1,w=r.program,b=w.getUniforms(),M=r.__webglShader.uniforms;if(w.id!==A&&(L.useProgram(w.program),A=w.id,x=_=y=!0),i.id!==E&&(E=i.id,_=!0),y||t!==R){if(b.set(L,t,"projectionMatrix"),J.logarithmicDepthBuffer&&b.setValue(L,"logDepthBufFC",2/(Math.log(t.far+1)/Math.LN2)),t!==R&&(R=t,x=_=!0),i.isShaderMaterial||i.isMeshPhongMaterial||i.isMeshStandardMaterial||i.envMap){var S=b.map.cameraPosition;void 0!==S&&S.setValue(L,U.setFromMatrixPosition(t.matrixWorld))}(i.isMeshPhongMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial||i.skinning)&&b.setValue(L,"viewMatrix",t.matrixWorldInverse),b.set(L,C,"toneMappingExposure"),b.set(L,C,"toneMappingWhitePoint")}if(i.skinning){b.setOptional(L,n,"bindMatrix"),b.setOptional(L,n,"bindMatrixInverse");var T=n.skeleton;T&&(J.floatVertexTextures&&T.useVertexTexture?(b.set(L,T,"boneTexture"),b.set(L,T,"boneTextureWidth"),b.set(L,T,"boneTextureHeight")):b.setOptional(L,T,"boneMatrices"))}return _&&(i.lights&&(v=x,(m=M).ambientLightColor.needsUpdate=v,m.directionalLights.needsUpdate=v,m.pointLights.needsUpdate=v,m.spotLights.needsUpdate=v,m.rectAreaLights.needsUpdate=v,m.hemisphereLights.needsUpdate=v),e&&i.fog&&(g=e,(f=M).fogColor.value=g.color,g.isFog?(f.fogNear.value=g.near,f.fogFar.value=g.far):g.isFogExp2&&(f.fogDensity.value=g.density)),(i.isMeshBasicMaterial||i.isMeshLambertMaterial||i.isMeshPhongMaterial||i.isMeshStandardMaterial||i.isMeshNormalMaterial||i.isMeshDepthMaterial)&&function(t,e){t.opacity.value=e.opacity,t.diffuse.value=e.color,e.emissive&&t.emissive.value.copy(e.emissive).multiplyScalar(e.emissiveIntensity);t.map.value=e.map,t.specularMap.value=e.specularMap,t.alphaMap.value=e.alphaMap,e.lightMap&&(t.lightMap.value=e.lightMap,t.lightMapIntensity.value=e.lightMapIntensity);e.aoMap&&(t.aoMap.value=e.aoMap,t.aoMapIntensity.value=e.aoMapIntensity);var i;e.map?i=e.map:e.specularMap?i=e.specularMap:e.displacementMap?i=e.displacementMap:e.normalMap?i=e.normalMap:e.bumpMap?i=e.bumpMap:e.roughnessMap?i=e.roughnessMap:e.metalnessMap?i=e.metalnessMap:e.alphaMap?i=e.alphaMap:e.emissiveMap&&(i=e.emissiveMap);if(void 0!==i){i.isWebGLRenderTarget&&(i=i.texture);var n=i.offset,r=i.repeat;t.offsetRepeat.value.set(n.x,n.y,r.x,r.y)}t.envMap.value=e.envMap,t.flipEnvMap.value=e.envMap&&e.envMap.isCubeTexture?-1:1,t.reflectivity.value=e.reflectivity,t.refractionRatio.value=e.refractionRatio}(M,i),i.isLineBasicMaterial?Pt(M,i):i.isLineDashedMaterial?(Pt(M,i),p=i,(d=M).dashSize.value=p.dashSize,d.totalSize.value=p.dashSize+p.gapSize,d.scale.value=p.scale):i.isPointsMaterial?function(t,e){if(t.diffuse.value=e.color,t.opacity.value=e.opacity,t.size.value=e.size*k,t.scale.value=.5*O,t.map.value=e.map,null!==e.map){var i=e.map.offset,n=e.map.repeat;t.offsetRepeat.value.set(i.x,i.y,n.x,n.y)}}(M,i):i.isMeshLambertMaterial?(c=M,(u=i).emissiveMap&&(c.emissiveMap.value=u.emissiveMap)):i.isMeshToonMaterial?(Lt(l=M,h=i),h.gradientMap&&(l.gradientMap.value=h.gradientMap)):i.isMeshPhongMaterial?Lt(M,i):i.isMeshPhysicalMaterial?(s=i,(a=M).clearCoat.value=s.clearCoat,a.clearCoatRoughness.value=s.clearCoatRoughness,It(a,s)):i.isMeshStandardMaterial?It(M,i):i.isMeshDepthMaterial?i.displacementMap&&(M.displacementMap.value=i.displacementMap,M.displacementScale.value=i.displacementScale,M.displacementBias.value=i.displacementBias):i.isMeshNormalMaterial&&function(t,e){e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale);e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale));e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(M,i),void 0!==M.ltcMat&&(M.ltcMat.value=THREE.UniformsLib.LTC_MAT_TEXTURE),void 0!==M.ltcMag&&(M.ltcMag.value=THREE.UniformsLib.LTC_MAG_TEXTURE),eG.upload(L,r.uniformsList,M,C)),b.set(L,n,"modelViewMatrix"),b.set(L,n,"normalMatrix"),b.setValue(L,"modelMatrix",n.matrixWorld),w}function Pt(t,e){t.diffuse.value=e.color,t.opacity.value=e.opacity}function Lt(t,e){t.specular.value=e.specular,t.shininess.value=Math.max(e.shininess,1e-4),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap),e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale)),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}function It(t,e){t.roughness.value=e.roughness,t.metalness.value=e.metalness,e.roughnessMap&&(t.roughnessMap.value=e.roughnessMap),e.metalnessMap&&(t.metalnessMap.value=e.metalnessMap),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap),e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale)),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias),e.envMap&&(t.envMapIntensity.value=e.envMapIntensity)}function Rt(t){var e;if(t===hB)return L.REPEAT;if(t===cB)return L.CLAMP_TO_EDGE;if(t===uB)return L.MIRRORED_REPEAT;if(t===dB)return L.NEAREST;if(t===pB)return L.NEAREST_MIPMAP_NEAREST;if(t===fB)return L.NEAREST_MIPMAP_LINEAR;if(t===gB)return L.LINEAR;if(1007===t)return L.LINEAR_MIPMAP_NEAREST;if(t===mB)return L.LINEAR_MIPMAP_LINEAR;if(t===vB)return L.UNSIGNED_BYTE;if(1017===t)return L.UNSIGNED_SHORT_4_4_4_4;if(1018===t)return L.UNSIGNED_SHORT_5_5_5_1;if(1019===t)return L.UNSIGNED_SHORT_5_6_5;if(1010===t)return L.BYTE;if(1011===t)return L.SHORT;if(t===yB)return L.UNSIGNED_SHORT;if(1013===t)return L.INT;if(t===_B)return L.UNSIGNED_INT;if(t===xB)return L.FLOAT;if(t===wB&&null!==(e=Y.get("OES_texture_half_float")))return e.HALF_FLOAT_OES;if(1021===t)return L.ALPHA;if(t===MB)return L.RGB;if(t===SB)return L.RGBA;if(1024===t)return L.LUMINANCE;if(1025===t)return L.LUMINANCE_ALPHA;if(t===CB)return L.DEPTH_COMPONENT;if(t===AB)return L.DEPTH_STENCIL;if(t===NN)return L.FUNC_ADD;if(101===t)return L.FUNC_SUBTRACT;if(102===t)return L.FUNC_REVERSE_SUBTRACT;if(200===t)return L.ZERO;if(201===t)return L.ONE;if(202===t)return L.SRC_COLOR;if(203===t)return L.ONE_MINUS_SRC_COLOR;if(t===BN)return L.SRC_ALPHA;if(t===FN)return L.ONE_MINUS_SRC_ALPHA;if(206===t)return L.DST_ALPHA;if(207===t)return L.ONE_MINUS_DST_ALPHA;if(208===t)return L.DST_COLOR;if(209===t)return L.ONE_MINUS_DST_COLOR;if(210===t)return L.SRC_ALPHA_SATURATE;if((2001===t||2002===t||2003===t||2004===t)&&null!==(e=Y.get("WEBGL_compressed_texture_s3tc"))){if(2001===t)return e.COMPRESSED_RGB_S3TC_DXT1_EXT;if(2002===t)return e.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(2003===t)return e.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(2004===t)return e.COMPRESSED_RGBA_S3TC_DXT5_EXT}if((2100===t||2101===t||2102===t||2103===t)&&null!==(e=Y.get("WEBGL_compressed_texture_pvrtc"))){if(2100===t)return e.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(2101===t)return e.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(2102===t)return e.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(2103===t)return e.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(2151===t&&null!==(e=Y.get("WEBGL_compressed_texture_etc1")))return e.COMPRESSED_RGB_ETC1_WEBGL;if((103===t||104===t)&&null!==(e=Y.get("EXT_blend_minmax"))){if(103===t)return e.MIN_EXT;if(104===t)return e.MAX_EXT}return t===bB&&null!==(e=Y.get("WEBGL_depth_texture"))?e.UNSIGNED_INT_24_8_WEBGL:0}this.getContext=function(){return L},this.getContextAttributes=function(){return L.getContextAttributes()},this.forceContextLoss=function(){Y.get("WEBGL_lose_context").loseContext()},this.getMaxAnisotropy=function(){return J.getMaxAnisotropy()},this.getPrecision=function(){return J.precision},this.getPixelRatio=function(){return k},this.setPixelRatio=function(t){void 0!==t&&(k=t,this.setSize(z.z,z.w,!1))},this.getSize=function(){return{width:M,height:O}},this.setSize=function(t,e,i){M=t,O=e,n.width=t*k,n.height=e*k,!1!==i&&(n.style.width=t+"px",n.style.height=e+"px"),this.setViewport(0,0,t,e)},this.setViewport=function(t,e,i,n){K.viewport(z.set(t,e,i,n))},this.setScissor=function(t,e,i,n){K.scissor(S.set(t,e,i,n))},this.setScissorTest=function(t){K.setScissorTest(T=t)},this.getClearColor=function(){return w},this.setClearColor=function(t,e){w.set(t),b=void 0!==e?e:1,K.buffers.color.setClear(w.r,w.g,w.b,b,s)},this.getClearAlpha=function(){return b},this.setClearAlpha=function(t){b=t,K.buffers.color.setClear(w.r,w.g,w.b,b,s)},this.clear=function(t,e,i){var n=0;(void 0===t||t)&&(n|=L.COLOR_BUFFER_BIT),(void 0===e||e)&&(n|=L.DEPTH_BUFFER_BIT),(void 0===i||i)&&(n|=L.STENCIL_BUFFER_BIT),L.clear(n)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.clearTarget=function(t,e,i,n){this.setRenderTarget(t),this.clear(e,i,n)},this.resetGLState=ut,this.dispose=function(){u=[],h=[],c=d=-1,n.removeEventListener("webglcontextlost",yt,!1)},this.renderBufferImmediate=function(t,e,i){K.initAttributes();var n=Q.get(t);t.hasPositions&&!n.position&&(n.position=L.createBuffer()),t.hasNormals&&!n.normal&&(n.normal=L.createBuffer()),t.hasUvs&&!n.uv&&(n.uv=L.createBuffer()),t.hasColors&&!n.color&&(n.color=L.createBuffer());var r=e.getAttributes();if(t.hasPositions&&(L.bindBuffer(L.ARRAY_BUFFER,n.position),L.bufferData(L.ARRAY_BUFFER,t.positionArray,L.DYNAMIC_DRAW),K.enableAttribute(r.position),L.vertexAttribPointer(r.position,3,L.FLOAT,!1,0,0)),t.hasNormals){if(L.bindBuffer(L.ARRAY_BUFFER,n.normal),!i.isMeshPhongMaterial&&!i.isMeshStandardMaterial&&!i.isMeshNormalMaterial&&i.shading===EN)for(var o=0,a=3*t.count;o<a;o+=9){var s=t.normalArray,l=(s[o+0]+s[o+3]+s[o+6])/3,h=(s[o+1]+s[o+4]+s[o+7])/3,c=(s[o+2]+s[o+5]+s[o+8])/3;s[o+0]=l,s[o+1]=h,s[o+2]=c,s[o+3]=l,s[o+4]=h,s[o+5]=c,s[o+6]=l,s[o+7]=h,s[o+8]=c}L.bufferData(L.ARRAY_BUFFER,t.normalArray,L.DYNAMIC_DRAW),K.enableAttribute(r.normal),L.vertexAttribPointer(r.normal,3,L.FLOAT,!1,0,0)}t.hasUvs&&i.map&&(L.bindBuffer(L.ARRAY_BUFFER,n.uv),L.bufferData(L.ARRAY_BUFFER,t.uvArray,L.DYNAMIC_DRAW),K.enableAttribute(r.uv),L.vertexAttribPointer(r.uv,2,L.FLOAT,!1,0,0)),t.hasColors&&i.vertexColors!==LN&&(L.bindBuffer(L.ARRAY_BUFFER,n.color),L.bufferData(L.ARRAY_BUFFER,t.colorArray,L.DYNAMIC_DRAW),K.enableAttribute(r.color),L.vertexAttribPointer(r.color,3,L.FLOAT,!1,0,0)),K.disableUnusedAttributes(),L.drawArrays(L.TRIANGLES,0,t.count),t.count=0},this.renderBufferDirect=function(t,e,i,n,r,o){At(n);var a=Et(t,e,n,r),s=!1,l=i.id+"_"+a.id+"_"+n.wireframe;l!==I&&(I=l,s=!0);var h=r.morphTargetInfluences;if(void 0!==h){for(var c=[],u=0,d=h.length;u<d;u++){var p=h[u];c.push([p,u])}c.sort(wt),8<c.length&&(c.length=8);var f=i.morphAttributes;for(u=0,d=c.length;u<d;u++){p=c[u];if(P[u]=p[0],0!==p[0]){var g=p[1];!0===n.morphTargets&&f.position&&i.addAttribute("morphTarget"+u,f.position[g]),!0===n.morphNormals&&f.normal&&i.addAttribute("morphNormal"+u,f.normal[g])}else!0===n.morphTargets&&i.removeAttribute("morphTarget"+u),!0===n.morphNormals&&i.removeAttribute("morphNormal"+u)}u=c.length;for(var m=P.length;u<m;u++)P[u]=0;a.getUniforms().setValue(L,"morphTargetInfluences",P),s=!0}g=i.index;var v,y=i.attributes.position,_=1;!0===n.wireframe&&(g=tt.getWireframeAttribute(i),_=2),null!==g?(v=lt).setIndex(g):v=st,s&&(!function(t,e,i,n){var r;if(i&&i.isInstancedBufferGeometry&&null===(r=Y.get("ANGLE_instanced_arrays")))return console.error("THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");void 0===n&&(n=0);K.initAttributes();var o=i.attributes,a=e.getAttributes(),s=t.defaultAttributeValues;for(var l in a){var h=a[l];if(0<=h){var c=o[l];if(void 0!==c){var u=c.normalized,d=c.itemSize,p=tt.getAttributeProperties(c),f=p.__webglBuffer,g=p.type,m=p.bytesPerElement;if(c.isInterleavedBufferAttribute){var v=c.data,y=v.stride,_=c.offset;v&&v.isInstancedInterleavedBuffer?(K.enableAttributeAndDivisor(h,v.meshPerAttribute,r),void 0===i.maxInstancedCount&&(i.maxInstancedCount=v.meshPerAttribute*v.count)):K.enableAttribute(h),L.bindBuffer(L.ARRAY_BUFFER,f),L.vertexAttribPointer(h,d,g,u,y*m,(n*y+_)*m)}else c.isInstancedBufferAttribute?(K.enableAttributeAndDivisor(h,c.meshPerAttribute,r),void 0===i.maxInstancedCount&&(i.maxInstancedCount=c.meshPerAttribute*c.count)):K.enableAttribute(h),L.bindBuffer(L.ARRAY_BUFFER,f),L.vertexAttribPointer(h,d,g,u,0,n*d*m)}else if(void 0!==s){var x=s[l];if(void 0!==x)switch(x.length){case 2:L.vertexAttrib2fv(h,x);break;case 3:L.vertexAttrib3fv(h,x);break;case 4:L.vertexAttrib4fv(h,x);break;default:L.vertexAttrib1fv(h,x)}}}}K.disableUnusedAttributes()}(n,a,i),null!==g&&L.bindBuffer(L.ELEMENT_ARRAY_BUFFER,tt.getAttributeBuffer(g)));var x=0;null!==g?x=g.count:void 0!==y&&(x=y.count);var w=i.drawRange.start*_,b=i.drawRange.count*_,M=null!==o?o.start*_:0,S=null!==o?o.count*_:1/0,T=Math.max(w,M),C=Math.min(x,w+b,M+S)-1,A=Math.max(0,C-T+1);if(0!==A){if(r.isMesh)if(!0===n.wireframe)K.setLineWidth(n.wireframeLinewidth*ht()),v.setMode(L.LINES);else switch(r.drawMode){case DB:v.setMode(L.TRIANGLES);break;case 1:v.setMode(L.TRIANGLE_STRIP);break;case 2:v.setMode(L.TRIANGLE_FAN)}else if(r.isLine){var E=n.linewidth;void 0===E&&(E=1),K.setLineWidth(E*ht()),r.isLineSegments?v.setMode(L.LINES):v.setMode(L.LINE_STRIP)}else r.isPoints&&v.setMode(L.POINTS);i&&i.isInstancedBufferGeometry?0<i.maxInstancedCount&&v.renderInstances(i,T,A):v.render(T,A)}},this.render=function(t,e,i,n){if(void 0===e||!0===e.isCamera){I="",E=-1,!(R=null)===t.autoUpdate&&t.updateMatrixWorld(),null===e.parent&&e.updateMatrixWorld(),e.matrixWorldInverse.getInverse(e.matrixWorld),H.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),N.setFromMatrix(H),f.length=0,d=c=-1,g.length=0,m.length=0,G=this.localClippingEnabled,F=B.init(this.clippingPlanes,G,e),function t(e,i){if(!1===e.visible)return;var n=0!=(e.layers.mask&i.layers.mask);if(n)if(e.isLight)f.push(e);else if(e.isSprite)!1!==e.frustumCulled&&!0!==(d=e,V.center.set(0,0,0),V.radius=.7071067811865476,V.applyMatrix4(d.matrixWorld),Tt(V))||g.push(e);else if(e.isLensFlare)m.push(e);else if(e.isImmediateRenderObject)!0===C.sortObjects&&(U.setFromMatrixPosition(e.matrixWorld),U.applyMatrix4(H)),St(e,null,e.material,U.z,null);else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.update(),!1===e.frustumCulled||!0===function(t){var e=t.geometry;null===e.boundingSphere&&e.computeBoundingSphere();return V.copy(e.boundingSphere).applyMatrix4(t.matrixWorld),Tt(V)}(e))){var r=e.material;if(!0===r.visible){!0===C.sortObjects&&(U.setFromMatrixPosition(e.matrixWorld),U.applyMatrix4(H));var o=tt.update(e);if(r.isMultiMaterial)for(var a=o.groups,s=r.materials,l=0,h=a.length;l<h;l++){var c=a[l],u=s[c.materialIndex];!0===u.visible&&St(e,o,u,U.z,c)}else St(e,o,r,U.z,null)}}var d;var p=e.children;for(var l=0,h=p.length;l<h;l++)t(p[l],i)}(t,e),h.length=c+1,u.length=d+1,!0===C.sortObjects&&(h.sort(bt),u.sort(Mt)),F&&B.beginShadows(),function(t){for(var e=0,i=0,n=t.length;i<n;i++){var r=t[i];r.castShadow&&(Z.shadows[e++]=r)}Z.shadows.length=e}(f),dt.render(t,e),function(t,e){var i,n,r,o,a,s,l,h=0,c=0,u=0,d=e.matrixWorldInverse,p=0,f=0,g=0,m=0,v=0;for(i=0,n=t.length;i<n;i++)if(r=t[i],o=r.color,a=r.intensity,s=r.distance,l=r.shadow&&r.shadow.map?r.shadow.map.texture:null,r.isAmbientLight)h+=o.r*a,c+=o.g*a,u+=o.b*a;else if(r.isDirectionalLight){var y=it.get(r);y.color.copy(r.color).multiplyScalar(r.intensity),y.direction.setFromMatrixPosition(r.matrixWorld),U.setFromMatrixPosition(r.target.matrixWorld),y.direction.sub(U),y.direction.transformDirection(d),y.shadow=r.castShadow,r.castShadow&&(y.shadowBias=r.shadow.bias,y.shadowRadius=r.shadow.radius,y.shadowMapSize=r.shadow.mapSize),Z.directionalShadowMap[p]=l,Z.directionalShadowMatrix[p]=r.shadow.matrix,Z.directional[p++]=y}else if(r.isSpotLight){var y=it.get(r);y.position.setFromMatrixPosition(r.matrixWorld),y.position.applyMatrix4(d),y.color.copy(o).multiplyScalar(a),y.distance=s,y.direction.setFromMatrixPosition(r.matrixWorld),U.setFromMatrixPosition(r.target.matrixWorld),y.direction.sub(U),y.direction.transformDirection(d),y.coneCos=Math.cos(r.angle),y.penumbraCos=Math.cos(r.angle*(1-r.penumbra)),y.decay=0===r.distance?0:r.decay,y.shadow=r.castShadow,r.castShadow&&(y.shadowBias=r.shadow.bias,y.shadowRadius=r.shadow.radius,y.shadowMapSize=r.shadow.mapSize),Z.spotShadowMap[g]=l,Z.spotShadowMatrix[g]=r.shadow.matrix,Z.spot[g++]=y}else if(r.isRectAreaLight){var y=it.get(r);y.color.copy(o).multiplyScalar(a/(r.width*r.height)),y.position.setFromMatrixPosition(r.matrixWorld),y.position.applyMatrix4(d),j.identity(),W.copy(r.matrixWorld),W.premultiply(d),j.extractRotation(W),y.halfWidth.set(.5*r.width,0,0),y.halfHeight.set(0,.5*r.height,0),y.halfWidth.applyMatrix4(j),y.halfHeight.applyMatrix4(j),Z.rectArea[m++]=y}else if(r.isPointLight){var y=it.get(r);y.position.setFromMatrixPosition(r.matrixWorld),y.position.applyMatrix4(d),y.color.copy(r.color).multiplyScalar(r.intensity),y.distance=r.distance,y.decay=0===r.distance?0:r.decay,y.shadow=r.castShadow,r.castShadow&&(y.shadowBias=r.shadow.bias,y.shadowRadius=r.shadow.radius,y.shadowMapSize=r.shadow.mapSize),Z.pointShadowMap[f]=l,void 0===Z.pointShadowMatrix[f]&&(Z.pointShadowMatrix[f]=new vF),U.setFromMatrixPosition(r.matrixWorld).negate(),Z.pointShadowMatrix[f].identity().setPosition(U),Z.point[f++]=y}else if(r.isHemisphereLight){var y=it.get(r);y.direction.setFromMatrixPosition(r.matrixWorld),y.direction.transformDirection(d),y.direction.normalize(),y.skyColor.copy(r.color).multiplyScalar(a),y.groundColor.copy(r.groundColor).multiplyScalar(a),Z.hemi[v++]=y}Z.ambient[0]=h,Z.ambient[1]=c,Z.ambient[2]=u,Z.directional.length=p,Z.spot.length=g,Z.rectArea.length=m,Z.point.length=f,Z.hemi.length=v,Z.hash=p+","+f+","+g+","+m+","+v+","+Z.shadows.length}(f,e),F&&B.endShadows(),X.calls=0,X.vertices=0,X.faces=0,void(X.points=0)===i&&(i=null),this.setRenderTarget(i);var r=t.background;if(null===r?K.buffers.color.setClear(w.r,w.g,w.b,b,s):r&&r.isColor&&(K.buffers.color.setClear(r.r,r.g,r.b,1,s),n=!0),(this.autoClear||n)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil),r&&r.isCubeTexture?(void 0===ot&&(ot=new bH,at=new mH(new yH(5,5,5),new ZG({uniforms:cG.cube.uniforms,vertexShader:cG.cube.vertexShader,fragmentShader:cG.cube.fragmentShader,side:CN,depthTest:!1,depthWrite:!1,fog:!1}))),ot.projectionMatrix.copy(e.projectionMatrix),ot.matrixWorld.extractRotation(e.matrixWorld),ot.matrixWorldInverse.getInverse(ot.matrixWorld),at.material.uniforms.tCube.value=r,at.modelViewMatrix.multiplyMatrices(ot.matrixWorldInverse,at.matrixWorld),tt.update(at),C.renderBufferDirect(ot,null,at.geometry,at.material,at,null)):r&&r.isTexture&&(void 0===nt&&(nt=new MH(-1,1,1,-1,0,1),rt=new mH(new xH(2,2),new NV({depthTest:!1,depthWrite:!1,fog:!1}))),rt.material.map=r,tt.update(rt),C.renderBufferDirect(nt,null,rt.geometry,rt.material,rt,null)),t.overrideMaterial){var o=t.overrideMaterial;Ct(h,t,e,o),Ct(u,t,e,o)}else K.setBlending(IN),Ct(h,t,e),Ct(u,t,e);mt.render(t,e),vt.render(t,e,x),i&&$.updateRenderTargetMipmap(i),K.setDepthTest(!0),K.setDepthWrite(!0),K.setColorWrite(!0)}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.setFaceCulling=function(t,e){K.setCullFace(t),K.setFlipSided(0===e)},this.allocTextureUnit=function(){var t=D;return t>=J.maxTextures&&console.warn("WebGLRenderer: trying to use "+t+" texture units while this GPU supports only "+J.maxTextures),D+=1,t},this.setTexture2D=(pt=!1,function(t,e){t&&t.isWebGLRenderTarget&&(pt||(console.warn("THREE.WebGLRenderer.setTexture2D: don't use render targets as textures. Use their .texture property instead."),pt=!0),t=t.texture),$.setTexture2D(t,e)}),this.setTexture=(ft=!1,function(t,e){ft||(console.warn("THREE.WebGLRenderer: .setTexture is deprecated, use setTexture2D instead."),ft=!0),$.setTexture2D(t,e)}),this.setTextureCube=(gt=!1,function(t,e){t&&t.isWebGLRenderTargetCube&&(gt||(console.warn("THREE.WebGLRenderer.setTextureCube: don't use cube render targets as textures. Use their .texture property instead."),gt=!0),t=t.texture),t&&t.isCubeTexture||Array.isArray(t.image)&&6===t.image.length?$.setTextureCube(t,e):$.setTextureCubeDynamic(t,e)}),this.getCurrentRenderTarget=function(){return p},this.setRenderTarget=function(t){(p=t)&&void 0===Q.get(t).__webglFramebuffer&&$.setupRenderTarget(t);var e,i=t&&t.isWebGLRenderTargetCube;if(t){var n=Q.get(t);e=i?n.__webglFramebuffer[t.activeCubeFace]:n.__webglFramebuffer,y.copy(t.scissor),_=t.scissorTest,x.copy(t.viewport)}else e=null,y.copy(S).multiplyScalar(k),_=T,x.copy(z).multiplyScalar(k);if(v!==e&&(L.bindFramebuffer(L.FRAMEBUFFER,e),v=e),K.scissor(y),K.setScissorTest(_),K.viewport(x),i){var r=Q.get(t.texture);L.framebufferTexture2D(L.FRAMEBUFFER,L.COLOR_ATTACHMENT0,L.TEXTURE_CUBE_MAP_POSITIVE_X+t.activeCubeFace,r.__webglTexture,t.activeMipMapLevel)}},this.readRenderTargetPixels=function(t,e,i,n,r,o){if(!1!==(t&&t.isWebGLRenderTarget)){var a=Q.get(t).__webglFramebuffer;if(a){var s=!1;a!==v&&(L.bindFramebuffer(L.FRAMEBUFFER,a),s=!0);try{var l=t.texture,h=l.format,c=l.type;if(h!==SB&&Rt(h)!==L.getParameter(L.IMPLEMENTATION_COLOR_READ_FORMAT))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!(c===vB||Rt(c)===L.getParameter(L.IMPLEMENTATION_COLOR_READ_TYPE)||c===xB&&(Y.get("OES_texture_float")||Y.get("WEBGL_color_buffer_float"))||c===wB&&Y.get("EXT_color_buffer_half_float")))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");L.checkFramebufferStatus(L.FRAMEBUFFER)===L.FRAMEBUFFER_COMPLETE?0<=e&&e<=t.width-n&&0<=i&&i<=t.height-r&&L.readPixels(e,i,n,r,Rt(h),Rt(c),o):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{s&&L.bindFramebuffer(L.FRAMEBUFFER,v)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")}}function nU(t,e){this.name="",this.color=new rG(t),this.density=void 0!==e?e:25e-5}function rU(t,e,i){this.name="",this.color=new rG(t),this.near=void 0!==e?e:1,this.far=void 0!==i?i:1e3}function oU(){DV.call(this),this.type="Scene",this.background=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0}function aU(t,e,i,n,r){DV.call(this),this.lensFlares=[],this.positionScreen=new mF,(this.customUpdateCallback=void 0)!==t&&this.add(t,e,i,n,r)}function sU(t){jG.call(this),this.type="SpriteMaterial",this.color=new rG(16777215),this.map=null,this.rotation=0,this.fog=!1,this.lights=!1,this.setValues(t)}function lU(t){DV.call(this),this.type="Sprite",this.material=void 0!==t?t:new sU}function hU(){DV.call(this),this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}})}function cU(t,e,i){if(this.useVertexTexture=void 0===i||i,this.identityMatrix=new vF,t=t||[],this.bones=t.slice(0),this.useVertexTexture){var n=Math.sqrt(4*this.bones.length);n=UB.nextPowerOfTwo(Math.ceil(n)),n=Math.max(n,4),this.boneTextureWidth=n,this.boneTextureHeight=n,this.boneMatrices=new Float32Array(this.boneTextureWidth*this.boneTextureHeight*4),this.boneTexture=new aG(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,SB,xB)}else this.boneMatrices=new Float32Array(16*this.bones.length);if(void 0===e)this.calculateInverses();else if(this.bones.length===e.length)this.boneInverses=e.slice(0);else{console.warn("THREE.Skeleton bonInverses is the wrong length."),this.boneInverses=[];for(var r=0,o=this.bones.length;r<o;r++)this.boneInverses.push(new vF)}}function uU(){DV.call(this),this.type="Bone"}function dU(t,e,i){mH.call(this,t,e),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new vF,this.bindMatrixInverse=new vF;var n=[];if(this.geometry&&void 0!==this.geometry.bones){for(var r,o,a=0,s=this.geometry.bones.length;a<s;++a)o=this.geometry.bones[a],r=new uU,n.push(r),r.name=o.name,r.position.fromArray(o.pos),r.quaternion.fromArray(o.rotq),void 0!==o.scl&&r.scale.fromArray(o.scl);for(a=0,s=this.geometry.bones.length;a<s;++a)-1!==(o=this.geometry.bones[a]).parent&&null!==o.parent&&void 0!==n[o.parent]?n[o.parent].add(n[a]):this.add(n[a])}this.normalizeSkinWeights(),this.updateMatrixWorld(!0),this.bind(new cU(n,void 0,i),this.matrixWorld)}function pU(t){jG.call(this),this.type="LineBasicMaterial",this.color=new rG(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.lights=!1,this.setValues(t)}function fU(t,e,i){if(1===i)return console.warn("THREE.Line: parameter THREE.LinePieces no longer supported. Created THREE.LineSegments instead."),new gU(t,e);DV.call(this),this.type="Line",this.geometry=void 0!==t?t:new gH,this.material=void 0!==e?e:new pU({color:16777215*Math.random()})}function gU(t,e){fU.call(this,t,e),this.type="LineSegments"}function mU(t){jG.call(this),this.type="PointsMaterial",this.color=new rG(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.lights=!1,this.setValues(t)}function vU(t,e){DV.call(this),this.type="Points",this.geometry=void 0!==t?t:new gH,this.material=void 0!==e?e:new mU({color:16777215*Math.random()})}function yU(){DV.call(this),this.type="Group"}function _U(e,t,i,n,r,o,a,s,l){uF.call(this,e,t,i,n,r,o,a,s,l),this.generateMipmaps=!1;var h=this;!function t(){requestAnimationFrame(t),e.readyState>=e.HAVE_CURRENT_DATA&&(h.needsUpdate=!0)}()}function xU(t,e,i,n,r,o,a,s,l,h,c,u){uF.call(this,null,o,a,s,l,h,n,r,c,u),this.image={width:e,height:i},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}function wU(t,e,i,n,r,o,a,s,l){uF.call(this,t,e,i,n,r,o,a,s,l),this.needsUpdate=!0}function bU(t,e,i,n,r,o,a,s,l,h){if((h=void 0!==h?h:CB)!==CB&&h!==AB)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===i&&h===CB&&(i=yB),void 0===i&&h===AB&&(i=bB),uF.call(this,null,n,r,o,a,s,h,i,l),this.image={width:t,height:e},this.magFilter=void 0!==a?a:dB,this.minFilter=void 0!==s?s:dB,this.flipY=!1,this.generateMipmaps=!1}function MU(t){gH.call(this),this.type="WireframeGeometry";var e,i,n,r,o,a,s,l,h=[],c=[0,0],u={},d=["a","b","c"];if(t&&t.isGeometry){var p=t.faces;for(e=0,n=p.length;e<n;e++){var f=p[e];for(i=0;i<3;i++)c[0]=f[d[i]],c[1]=f[d[(i+1)%3]],c.sort(w),void 0===u[s=c.toString()]&&(u[s]={index1:c[0],index2:c[1]})}for(s in u)a=u[s],l=t.vertices[a.index1],h.push(l.x,l.y,l.z),l=t.vertices[a.index2],h.push(l.x,l.y,l.z)}else if(t&&t.isBufferGeometry){var g,m,v,y,_,x;if(l=new mF,null!==t.index){for(g=t.attributes.position,m=t.index,0===(v=t.groups).length&&t.addGroup(0,m.count),r=0,o=v.length;r<o;++r)for(n=(e=(y=v[r]).start)+y.count;e<n;e+=3)for(i=0;i<3;i++)c[0]=m.getX(e+i),c[1]=m.getX(e+(i+1)%3),c.sort(w),void 0===u[s=c.toString()]&&(u[s]={index1:c[0],index2:c[1]});for(s in u)a=u[s],l.fromBufferAttribute(g,a.index1),h.push(l.x,l.y,l.z),l.fromBufferAttribute(g,a.index2),h.push(l.x,l.y,l.z)}else for(e=0,n=(g=t.attributes.position).count/3;e<n;e++)for(i=0;i<3;i++)_=3*e+i,l.fromBufferAttribute(g,_),h.push(l.x,l.y,l.z),x=3*e+(i+1)%3,l.fromBufferAttribute(g,x),h.push(l.x,l.y,l.z)}function w(t,e){return t-e}this.addAttribute("position",new ZV(h,3))}function SU(t,e,i){fH.call(this),this.type="ParametricGeometry",this.parameters={func:t,slices:e,stacks:i},this.fromBufferGeometry(new TU(t,e,i)),this.mergeVertices()}function TU(t,e,i){gH.call(this),this.type="ParametricBufferGeometry",this.parameters={func:t,slices:e,stacks:i};var n,r,o=[],a=[],s=[],l=e+1;for(n=0;n<=i;n++){var h=n/i;for(r=0;r<=e;r++){var c=r/e,u=t(c,h);a.push(u.x,u.y,u.z),s.push(c,h)}}for(n=0;n<i;n++)for(r=0;r<e;r++){var d=n*l+r,p=n*l+r+1,f=(n+1)*l+r+1,g=(n+1)*l+r;o.push(d,p,g),o.push(p,f,g)}this.setIndex(o),this.addAttribute("position",new ZV(a,3)),this.addAttribute("uv",new ZV(s,2)),this.computeVertexNormals()}function CU(t,e,i,n){fH.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:e,radius:i,detail:n},this.fromBufferGeometry(new AU(t,e,i,n)),this.mergeVertices()}function AU(n,o,t,e){gH.call(this),this.type="PolyhedronBufferGeometry",this.parameters={vertices:n,indices:o,radius:t,detail:e},t=t||1;var c=[],u=[];function a(t,e,i,n){var r,o,a=Math.pow(2,n),s=[];for(r=0;r<=a;r++){s[r]=[];var l=t.clone().lerp(i,r/a),h=e.clone().lerp(i,r/a),c=a-r;for(o=0;o<=c;o++)s[r][o]=0===o&&r===a?l:l.clone().lerp(h,o/c)}for(r=0;r<a;r++)for(o=0;o<2*(a-r)-1;o++){var u=Math.floor(o/2);o%2==0?(d(s[r][u+1]),d(s[r+1][u]),d(s[r][u])):(d(s[r][u+1]),d(s[r+1][u+1]),d(s[r+1][u]))}}function d(t){c.push(t.x,t.y,t.z)}function s(t,e){var i=3*t;e.x=n[i+0],e.y=n[i+1],e.z=n[i+2]}function p(t,e,i,n){n<0&&1===t.x&&(u[e]=t.x-1),0===i.x&&0===i.z&&(u[e]=n/2/Math.PI+.5)}function f(t){return Math.atan2(t.z,-t.x)}!function(t){for(var e=new mF,i=new mF,n=new mF,r=0;r<o.length;r+=3)s(o[r+0],e),s(o[r+1],i),s(o[r+2],n),a(e,i,n,t)}(e=e||0),function(t){for(var e=new mF,i=0;i<c.length;i+=3)e.x=c[i+0],e.y=c[i+1],e.z=c[i+2],e.normalize().multiplyScalar(t),c[i+0]=e.x,c[i+1]=e.y,c[i+2]=e.z}(t),function(){for(var t=new mF,e=0;e<c.length;e+=3){t.x=c[e+0],t.y=c[e+1],t.z=c[e+2];var i=f(t)/2/Math.PI+.5,n=(r=t,Math.atan2(-r.y,Math.sqrt(r.x*r.x+r.z*r.z))/Math.PI+.5);u.push(i,1-n)}var r;(function(){for(var t=new mF,e=new mF,i=new mF,n=new mF,r=new WB,o=new WB,a=new WB,s=0,l=0;s<c.length;s+=9,l+=6){t.set(c[s+0],c[s+1],c[s+2]),e.set(c[s+3],c[s+4],c[s+5]),i.set(c[s+6],c[s+7],c[s+8]),r.set(u[l+0],u[l+1]),o.set(u[l+2],u[l+3]),a.set(u[l+4],u[l+5]),n.copy(t).add(e).add(i).divideScalar(3);var h=f(n);p(r,l+0,t,h),p(o,l+2,e,h),p(a,l+4,i,h)}})(),function(){for(var t=0;t<u.length;t+=6){var e=u[t+0],i=u[t+2],n=u[t+4],r=Math.max(e,i,n),o=Math.min(e,i,n);.9<r&&o<.1&&(e<.2&&(u[t+0]+=1),i<.2&&(u[t+2]+=1),n<.2&&(u[t+4]+=1))}}()}(),this.addAttribute("position",new ZV(c,3)),this.addAttribute("normal",new ZV(c.slice(),3)),this.addAttribute("uv",new ZV(u,2)),this.normalizeNormals()}function EU(t,e){fH.call(this),this.type="TetrahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new PU(t,e)),this.mergeVertices()}function PU(t,e){AU.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],t,e),this.type="TetrahedronBufferGeometry",this.parameters={radius:t,detail:e}}function LU(t,e){fH.call(this),this.type="OctahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new IU(t,e)),this.mergeVertices()}function IU(t,e){AU.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],t,e),this.type="OctahedronBufferGeometry",this.parameters={radius:t,detail:e}}function RU(t,e){fH.call(this),this.type="IcosahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new DU(t,e)),this.mergeVertices()}function DU(t,e){var i=(1+Math.sqrt(5))/2;AU.call(this,[-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],t,e),this.type="IcosahedronBufferGeometry",this.parameters={radius:t,detail:e}}function OU(t,e){fH.call(this),this.type="DodecahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new kU(t,e)),this.mergeVertices()}function kU(t,e){var i=(1+Math.sqrt(5))/2,n=1/i;AU.call(this,[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-i,0,-n,i,0,n,-i,0,n,i,-n,-i,0,-n,i,0,n,-i,0,n,i,0,-i,0,-n,i,0,-n,-i,0,n,i,0,n],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],t,e),this.type="DodecahedronBufferGeometry",this.parameters={radius:t,detail:e}}function zU(t,e,i,n,r,o){fH.call(this),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:e,radius:i,radialSegments:n,closed:r},void 0!==o&&console.warn("THREE.TubeGeometry: taper has been removed.");var a=new NU(t,e,i,n,r);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals,this.fromBufferGeometry(a),this.mergeVertices()}function NU(s,l,h,c,t){gH.call(this),this.type="TubeBufferGeometry",this.parameters={path:s,tubularSegments:l,radius:h,radialSegments:c,closed:t},l=l||64,h=h||1,c=c||8,t=t||!1;var u=s.computeFrenetFrames(l,t);this.tangents=u.tangents,this.normals=u.normals,this.binormals=u.binormals;var r,d,p=new mF,f=new mF,e=new WB,g=[],m=[],i=[],o=[];function n(t){var e=s.getPointAt(t/l),i=u.normals[t],n=u.binormals[t];for(d=0;d<=c;d++){var r=d/c*Math.PI*2,o=Math.sin(r),a=-Math.cos(r);f.x=a*i.x+o*n.x,f.y=a*i.y+o*n.y,f.z=a*i.z+o*n.z,f.normalize(),m.push(f.x,f.y,f.z),p.x=e.x+h*f.x,p.y=e.y+h*f.y,p.z=e.z+h*f.z,g.push(p.x,p.y,p.z)}}!function(){for(r=0;r<l;r++)n(r);n(!1===t?l:0),function(){for(r=0;r<=l;r++)for(d=0;d<=c;d++)e.x=r/l,e.y=d/c,i.push(e.x,e.y)}(),function(){for(d=1;d<=l;d++)for(r=1;r<=c;r++){var t=(c+1)*(d-1)+(r-1),e=(c+1)*d+(r-1),i=(c+1)*d+r,n=(c+1)*(d-1)+r;o.push(t,e,n),o.push(e,i,n)}}()}(),this.setIndex(o),this.addAttribute("position",new ZV(g,3)),this.addAttribute("normal",new ZV(m,3)),this.addAttribute("uv",new ZV(i,2))}function BU(t,e,i,n,r,o,a){fH.call(this),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:e,tubularSegments:i,radialSegments:n,p:r,q:o},void 0!==a&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),this.fromBufferGeometry(new FU(t,e,i,n,r,o)),this.mergeVertices()}function FU(t,e,i,n,r,o){gH.call(this),this.type="TorusKnotBufferGeometry",this.parameters={radius:t,tube:e,tubularSegments:i,radialSegments:n,p:r,q:o},t=t||100,e=e||40,i=Math.floor(i)||64,n=Math.floor(n)||8,r=r||2,o=o||3;var a,s,l=[],h=[],c=[],u=[],d=new mF,p=new mF,f=(new WB,new mF),g=new mF,m=new mF,v=new mF,y=new mF;for(a=0;a<=i;++a){var _=a/i*r*Math.PI*2;for(A(_,r,o,t,f),A(_+.01,r,o,t,g),v.subVectors(g,f),y.addVectors(g,f),m.crossVectors(v,y),y.crossVectors(m,v),m.normalize(),y.normalize(),s=0;s<=n;++s){var x=s/n*Math.PI*2,w=-e*Math.cos(x),b=e*Math.sin(x);d.x=f.x+(w*y.x+b*m.x),d.y=f.y+(w*y.y+b*m.y),d.z=f.z+(w*y.z+b*m.z),h.push(d.x,d.y,d.z),p.subVectors(d,f).normalize(),c.push(p.x,p.y,p.z),u.push(a/i),u.push(s/n)}}for(s=1;s<=i;s++)for(a=1;a<=n;a++){var M=(n+1)*(s-1)+(a-1),S=(n+1)*s+(a-1),T=(n+1)*s+a,C=(n+1)*(s-1)+a;l.push(M,S,C),l.push(S,T,C)}function A(t,e,i,n,r){var o=Math.cos(t),a=Math.sin(t),s=i/e*t,l=Math.cos(s);r.x=n*(2+l)*.5*o,r.y=n*(2+l)*a*.5,r.z=n*Math.sin(s)*.5}this.setIndex(l),this.addAttribute("position",new ZV(h,3)),this.addAttribute("normal",new ZV(c,3)),this.addAttribute("uv",new ZV(u,2))}function GU(t,e,i,n,r){fH.call(this),this.type="TorusGeometry",this.parameters={radius:t,tube:e,radialSegments:i,tubularSegments:n,arc:r},this.fromBufferGeometry(new VU(t,e,i,n,r))}function VU(t,e,i,n,r){gH.call(this),this.type="TorusBufferGeometry",this.parameters={radius:t,tube:e,radialSegments:i,tubularSegments:n,arc:r},t=t||100,e=e||40,i=Math.floor(i)||8,n=Math.floor(n)||6,r=r||2*Math.PI;var o,a,s=[],l=[],h=[],c=[],u=new mF,d=new mF,p=new mF;for(o=0;o<=i;o++)for(a=0;a<=n;a++){var f=a/n*r,g=o/i*Math.PI*2;d.x=(t+e*Math.cos(g))*Math.cos(f),d.y=(t+e*Math.cos(g))*Math.sin(f),d.z=e*Math.sin(g),l.push(d.x,d.y,d.z),u.x=t*Math.cos(f),u.y=t*Math.sin(f),p.subVectors(d,u).normalize(),h.push(p.x,p.y,p.z),c.push(a/n),c.push(o/i)}for(o=1;o<=i;o++)for(a=1;a<=n;a++){var m=(n+1)*o+a-1,v=(n+1)*(o-1)+a-1,y=(n+1)*(o-1)+a,_=(n+1)*o+a;s.push(m,v,_),s.push(v,y,_)}this.setIndex(s),this.addAttribute("position",new ZV(l,3)),this.addAttribute("normal",new ZV(h,3)),this.addAttribute("uv",new ZV(c,2))}nU.prototype.isFogExp2=!0,nU.prototype.clone=function(){return new nU(this.color.getHex(),this.density)},nU.prototype.toJSON=function(t){return{type:"FogExp2",color:this.color.getHex(),density:this.density}},rU.prototype.isFog=!0,rU.prototype.clone=function(){return new rU(this.color.getHex(),this.near,this.far)},rU.prototype.toJSON=function(t){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}},((oU.prototype=Object.create(DV.prototype)).constructor=oU).prototype.copy=function(t,e){return DV.prototype.copy.call(this,t,e),null!==t.background&&(this.background=t.background.clone()),null!==t.fog&&(this.fog=t.fog.clone()),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.autoUpdate=t.autoUpdate,this.matrixAutoUpdate=t.matrixAutoUpdate,this},oU.prototype.toJSON=function(t){var e=DV.prototype.toJSON.call(this,t);return null!==this.background&&(e.object.background=this.background.toJSON(t)),null!==this.fog&&(e.object.fog=this.fog.toJSON()),e},aU.prototype=Object.assign(Object.create(DV.prototype),{constructor:aU,isLensFlare:!0,copy:function(t){DV.prototype.copy.call(this,t),this.positionScreen.copy(t.positionScreen),this.customUpdateCallback=t.customUpdateCallback;for(var e=0,i=t.lensFlares.length;e<i;e++)this.lensFlares.push(t.lensFlares[e]);return this},add:function(t,e,i,n,r,o){void 0===e&&(e=-1),void 0===i&&(i=0),void 0===o&&(o=1),void 0===r&&(r=new rG(16777215)),void 0===n&&(n=RN),i=Math.min(i,Math.max(0,i)),this.lensFlares.push({texture:t,size:e,distance:i,x:0,y:0,z:0,scale:1,rotation:0,opacity:o,color:r,blending:n})},updateLensFlares:function(){var t,e,i=this.lensFlares.length,n=2*-this.positionScreen.x,r=2*-this.positionScreen.y;for(t=0;t<i;t++)(e=this.lensFlares[t]).x=this.positionScreen.x+n*e.distance,e.y=this.positionScreen.y+r*e.distance,e.wantedRotation=e.x*Math.PI*.25,e.rotation+=.25*(e.wantedRotation-e.rotation)}}),((sU.prototype=Object.create(jG.prototype)).constructor=sU).prototype.copy=function(t){return jG.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.rotation=t.rotation,this},lU.prototype=Object.assign(Object.create(DV.prototype),{constructor:lU,isSprite:!0,raycast:(EH=new mF,function(t,e){EH.setFromMatrixPosition(this.matrixWorld);var i=t.ray.distanceSqToPoint(EH);this.scale.x*this.scale.y/4<i||e.push({distance:Math.sqrt(i),point:this.position,face:null,object:this})}),clone:function(){return new this.constructor(this.material).copy(this)}}),hU.prototype=Object.assign(Object.create(DV.prototype),{constructor:hU,copy:function(t){DV.prototype.copy.call(this,t,!1);for(var e=t.levels,i=0,n=e.length;i<n;i++){var r=e[i];this.addLevel(r.object.clone(),r.distance)}return this},addLevel:function(t,e){void 0===e&&(e=0),e=Math.abs(e);for(var i=this.levels,n=0;n<i.length&&!(e<i[n].distance);n++);i.splice(n,0,{distance:e,object:t}),this.add(t)},getObjectForDistance:function(t){for(var e=this.levels,i=1,n=e.length;i<n&&!(t<e[i].distance);i++);return e[i-1].object},raycast:(IH=new mF,function(t,e){IH.setFromMatrixPosition(this.matrixWorld);var i=t.ray.origin.distanceTo(IH);this.getObjectForDistance(i).raycast(t,e)}),update:(PH=new mF,LH=new mF,function(t){var e=this.levels;if(1<e.length){PH.setFromMatrixPosition(t.matrixWorld),LH.setFromMatrixPosition(this.matrixWorld);var i=PH.distanceTo(LH);e[0].object.visible=!0;for(var n=1,r=e.length;n<r&&i>=e[n].distance;n++)e[n-1].object.visible=!1,e[n].object.visible=!0;for(;n<r;n++)e[n].object.visible=!1}}),toJSON:function(t){var e=DV.prototype.toJSON.call(this,t);e.object.levels=[];for(var i=this.levels,n=0,r=i.length;n<r;n++){var o=i[n];e.object.levels.push({object:o.object.uuid,distance:o.distance})}return e}}),Object.assign(cU.prototype,{calculateInverses:function(){this.boneInverses=[];for(var t=0,e=this.bones.length;t<e;t++){var i=new vF;this.bones[t]&&i.getInverse(this.bones[t].matrixWorld),this.boneInverses.push(i)}},pose:function(){for(var t,e=0,i=this.bones.length;e<i;e++)(t=this.bones[e])&&t.matrixWorld.getInverse(this.boneInverses[e]);for(e=0,i=this.bones.length;e<i;e++)(t=this.bones[e])&&(t.parent&&t.parent.isBone?(t.matrix.getInverse(t.parent.matrixWorld),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))},update:(RH=new vF,function(){for(var t=0,e=this.bones.length;t<e;t++){var i=this.bones[t]?this.bones[t].matrixWorld:this.identityMatrix;RH.multiplyMatrices(i,this.boneInverses[t]),RH.toArray(this.boneMatrices,16*t)}this.useVertexTexture&&(this.boneTexture.needsUpdate=!0)}),clone:function(){return new cU(this.bones,this.boneInverses,this.useVertexTexture)}}),uU.prototype=Object.assign(Object.create(DV.prototype),{constructor:uU,isBone:!0}),dU.prototype=Object.assign(Object.create(mH.prototype),{constructor:dU,isSkinnedMesh:!0,bind:function(t,e){this.skeleton=t,void 0===e&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.getInverse(e)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){if(this.geometry&&this.geometry.isGeometry)for(var t=0;t<this.geometry.skinWeights.length;t++){var e=this.geometry.skinWeights[t];(r=1/e.lengthManhattan())!==1/0?e.multiplyScalar(r):e.set(1,0,0,0)}else if(this.geometry&&this.geometry.isBufferGeometry){var i=new dF,n=this.geometry.attributes.skinWeight;for(t=0;t<n.count;t++){var r;i.x=n.getX(t),i.y=n.getY(t),i.z=n.getZ(t),i.w=n.getW(t),(r=1/i.lengthManhattan())!==1/0?i.multiplyScalar(r):i.set(1,0,0,0),n.setXYZW(t,i.x,i.y,i.z,i.w)}}},updateMatrixWorld:function(t){mH.prototype.updateMatrixWorld.call(this,!0),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh unrecognized bindMode: "+this.bindMode)},clone:function(){return new this.constructor(this.geometry,this.material,this.skeleton.useVertexTexture).copy(this)}}),((pU.prototype=Object.create(jG.prototype)).constructor=pU).prototype.isLineBasicMaterial=!0,pU.prototype.copy=function(t){return jG.prototype.copy.call(this,t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this},fU.prototype=Object.assign(Object.create(DV.prototype),{constructor:fU,isLine:!0,raycast:(DH=new vF,OH=new tV,kH=new YG,function(t,e){var i=t.linePrecision,n=i*i,r=this.geometry,o=this.matrixWorld;if(null===r.boundingSphere&&r.computeBoundingSphere(),kH.copy(r.boundingSphere),kH.applyMatrix4(o),!1!==t.ray.intersectsSphere(kH)){DH.getInverse(o),OH.copy(t.ray).applyMatrix4(DH);var a=new mF,s=new mF,l=new mF,h=new mF,c=this&&this.isLineSegments?2:1;if(r.isBufferGeometry){var u=r.index,d=r.attributes.position.array;if(null!==u)for(var p=u.array,f=0,g=p.length-1;f<g;f+=c){var m=p[f],v=p[f+1];a.fromArray(d,3*m),s.fromArray(d,3*v),n<OH.distanceSqToSegment(a,s,h,l)||(h.applyMatrix4(this.matrixWorld),(x=t.ray.origin.distanceTo(h))<t.near||x>t.far||e.push({distance:x,point:l.clone().applyMatrix4(this.matrixWorld),index:f,face:null,faceIndex:null,object:this}))}else for(f=0,g=d.length/3-1;f<g;f+=c)a.fromArray(d,3*f),s.fromArray(d,3*f+3),n<OH.distanceSqToSegment(a,s,h,l)||(h.applyMatrix4(this.matrixWorld),(x=t.ray.origin.distanceTo(h))<t.near||x>t.far||e.push({distance:x,point:l.clone().applyMatrix4(this.matrixWorld),index:f,face:null,faceIndex:null,object:this}))}else if(r.isGeometry){var y=r.vertices,_=y.length;for(f=0;f<_-1;f+=c){var x;n<OH.distanceSqToSegment(y[f],y[f+1],h,l)||(h.applyMatrix4(this.matrixWorld),(x=t.ray.origin.distanceTo(h))<t.near||x>t.far||e.push({distance:x,point:l.clone().applyMatrix4(this.matrixWorld),index:f,face:null,faceIndex:null,object:this}))}}}}),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),gU.prototype=Object.assign(Object.create(fU.prototype),{constructor:gU,isLineSegments:!0}),((mU.prototype=Object.create(jG.prototype)).constructor=mU).prototype.isPointsMaterial=!0,mU.prototype.copy=function(t){return jG.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this},vU.prototype=Object.assign(Object.create(DV.prototype),{constructor:vU,isPoints:!0,raycast:(zH=new vF,NH=new tV,BH=new YG,function(o,a){var s=this,t=this.geometry,l=this.matrixWorld,e=o.params.Points.threshold;if(null===t.boundingSphere&&t.computeBoundingSphere(),BH.copy(t.boundingSphere),BH.applyMatrix4(l),!1!==o.ray.intersectsSphere(BH)){zH.getInverse(l),NH.copy(o.ray).applyMatrix4(zH);var i=e/((this.scale.x+this.scale.y+this.scale.z)/3),h=i*i,n=new mF;if(t.isBufferGeometry){var r=t.index,c=t.attributes.position.array;if(null!==r)for(var u=r.array,d=0,p=u.length;d<p;d++){var f=u[d];n.fromArray(c,3*f),v(n,f)}else{d=0;for(var g=c.length/3;d<g;d++)n.fromArray(c,3*d),v(n,d)}}else{var m=t.vertices;for(d=0,g=m.length;d<g;d++)v(m[d],d)}}function v(t,e){var i=NH.distanceSqToPoint(t);if(i<h){var n=NH.closestPointToPoint(t);n.applyMatrix4(l);var r=o.ray.origin.distanceTo(n);if(r<o.near||r>o.far)return;a.push({distance:r,distanceToRay:Math.sqrt(i),point:n.clone(),index:e,face:null,object:s})}}}),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),yU.prototype=Object.assign(Object.create(DV.prototype),{constructor:yU}),(_U.prototype=Object.create(uF.prototype)).constructor=_U,((xU.prototype=Object.create(uF.prototype)).constructor=xU).prototype.isCompressedTexture=!0,(wU.prototype=Object.create(uF.prototype)).constructor=wU,((bU.prototype=Object.create(uF.prototype)).constructor=bU).prototype.isDepthTexture=!0,(MU.prototype=Object.create(gH.prototype)).constructor=MU,(SU.prototype=Object.create(fH.prototype)).constructor=SU,(TU.prototype=Object.create(gH.prototype)).constructor=TU,(CU.prototype=Object.create(fH.prototype)).constructor=CU,(AU.prototype=Object.create(gH.prototype)).constructor=AU,(EU.prototype=Object.create(fH.prototype)).constructor=EU,(PU.prototype=Object.create(AU.prototype)).constructor=PU,(LU.prototype=Object.create(fH.prototype)).constructor=LU,(IU.prototype=Object.create(AU.prototype)).constructor=IU,(RU.prototype=Object.create(fH.prototype)).constructor=RU,(DU.prototype=Object.create(AU.prototype)).constructor=DU,(OU.prototype=Object.create(fH.prototype)).constructor=OU,(kU.prototype=Object.create(AU.prototype)).constructor=kU,(zU.prototype=Object.create(fH.prototype)).constructor=zU,(NU.prototype=Object.create(gH.prototype)).constructor=NU,(BU.prototype=Object.create(fH.prototype)).constructor=BU,(FU.prototype=Object.create(gH.prototype)).constructor=FU,(GU.prototype=Object.create(fH.prototype)).constructor=GU,(VU.prototype=Object.create(gH.prototype)).constructor=VU;var HU={area:function(t){for(var e=t.length,i=0,n=e-1,r=0;r<e;n=r++)i+=t[n].x*t[r].y-t[r].x*t[n].y;return.5*i},triangulate:function(){function m(t,e,i,n,r,o){var a,s,l,h,c,u,d,p,f,g,m,v,y,_,x,w,b;if(s=t[o[e]].x,l=t[o[e]].y,h=t[o[i]].x,c=t[o[i]].y,u=t[o[n]].x,(h-s)*((d=t[o[n]].y)-l)-(c-l)*(u-s)<=0)return!1;for(g=u-h,m=d-c,v=s-u,y=l-d,_=h-s,x=c-l,a=0;a<r;a++)if(p=t[o[a]].x,f=t[o[a]].y,!(p===s&&f===l||p===h&&f===c||p===u&&f===d)&&(w=_*(f-l)-x*(p-s),b=v*(f-d)-y*(p-u),g*(f-c)-m*(p-h)>=-Number.EPSILON&&b>=-Number.EPSILON&&w>=-Number.EPSILON))return!1;return!0}return function(t,e){var i=t.length;if(i<3)return null;var n,r,o,a=[],s=[],l=[];if(0<HU.area(t))for(r=0;r<i;r++)s[r]=r;else for(r=0;r<i;r++)s[r]=i-1-r;var h=i,c=2*h;for(r=h-1;2<h;){if(c--<=0)return console.warn("THREE.ShapeUtils: Unable to triangulate polygon! in triangulate()"),e?l:a;if(h<=(n=r)&&(n=0),h<=(r=n+1)&&(r=0),h<=(o=r+1)&&(o=0),m(t,n,r,o,h,s)){var u,d,p,f,g;for(u=s[n],d=s[r],p=s[o],a.push([t[u],t[d],t[p]]),l.push([s[n],s[r],s[o]]),g=(f=r)+1;g<h;f++,g++)s[f]=s[g];c=2*--h}}return e?l:a}}(),triangulateShape:function(t,e){function i(t){var e=t.length;2<e&&t[e-1].equals(t[0])&&t.pop()}function T(t,e,i){return t.x!==e.x?t.x<e.x?t.x<=i.x&&i.x<=e.x:e.x<=i.x&&i.x<=t.x:t.y<e.y?t.y<=i.y&&i.y<=e.y:e.y<=i.y&&i.y<=t.y}function S(t,e,i,n,r){var o=e.x-t.x,a=e.y-t.y,s=n.x-i.x,l=n.y-i.y,h=t.x-i.x,c=t.y-i.y,u=a*s-o*l,d=a*h-o*c;if(Math.abs(u)>Number.EPSILON){var p;if(0<u){if(d<0||u<d)return[];if((p=l*h-s*c)<0||u<p)return[]}else{if(0<d||d<u)return[];if(0<(p=l*h-s*c)||p<u)return[]}if(0===p)return!r||0!==d&&d!==u?[t]:[];if(p===u)return!r||0!==d&&d!==u?[e]:[];if(0===d)return[i];if(d===u)return[n];var f=p/u;return[{x:t.x+f*o,y:t.y+f*a}]}if(0!==d||l*h!=s*c)return[];var g,m,v,y,_,x,w,b,M=0===o&&0===a,S=0===s&&0===l;return M&&S?t.x!==i.x||t.y!==i.y?[]:[t]:M?T(i,n,t)?[t]:[]:S?T(t,e,i)?[i]:[]:(0!==o?(t.x<e.x?(v=(g=t).x,y=(m=e).x):(v=(g=e).x,y=(m=t).x),i.x<n.x?(w=(_=i).x,b=(x=n).x):(w=(_=n).x,b=(x=i).x)):(t.y<e.y?(v=(g=t).y,y=(m=e).y):(v=(g=e).y,y=(m=t).y),i.y<n.y?(w=(_=i).y,b=(x=n).y):(w=(_=n).y,b=(x=i).y)),v<=w?y<w?[]:y===w?r?[]:[_]:y<=b?[_,m]:[_,x]:b<v?[]:v===b?r?[]:[g]:y<=b?[g,m]:[g,x])}function C(t,e,i,n){var r=e.x-t.x,o=e.y-t.y,a=i.x-t.x,s=i.y-t.y,l=n.x-t.x,h=n.y-t.y,c=r*s-o*a,u=r*h-o*l;if(Math.abs(c)>Number.EPSILON){var d=l*s-h*a;return 0<c?0<=u&&0<=d:0<=u||0<=d}return 0<u}i(t),e.forEach(i);for(var n,r,o,a,s,l,h={},c=t.concat(),u=0,d=e.length;u<d;u++)Array.prototype.push.apply(c,e[u]);for(n=0,r=c.length;n<r;n++)void 0!==h[s=c[n].x+":"+c[n].y]&&console.warn("THREE.ShapeUtils: Duplicate point",s,n),h[s]=n;var p=function(t,a){var h,c=t.concat();function e(t,e){var i=c.length-1,n=t-1;n<0&&(n=i);var r=t+1;i<r&&(r=0);var o=C(c[t],c[n],c[r],h[e]);if(!o)return!1;var a=h.length-1,s=e-1;s<0&&(s=a);var l=e+1;return a<l&&(l=0),!!(o=C(h[e],h[s],h[l],c[t]))}function i(t,e){var i,n;for(i=0;i<c.length;i++)if(n=i+1,n%=c.length,0<S(t,e,c[i],c[n],!0).length)return!0;return!1}var s=[];function n(t,e){var i,n,r,o;for(i=0;i<s.length;i++)for(n=a[s[i]],r=0;r<n.length;r++)if(o=r+1,o%=n.length,0<S(t,e,n[r],n[o],!0).length)return!0;return!1}for(var r,o,l,u,d,p,f,g,m,v,y=[],_=0,x=a.length;_<x;_++)s.push(_);for(var w=0,b=2*s.length;0<s.length;){if(--b<0){console.log("Infinite Loop! Holes left:"+s.length+", Probably Hole outside Shape!");break}for(o=w;o<c.length;o++){for(l=c[o],r=-1,_=0;_<s.length;_++)if(d=s[_],void 0===y[p=l.x+":"+l.y+":"+d]){h=a[d];for(var M=0;M<h.length;M++)if(u=h[M],e(o,M)&&!i(l,u)&&!n(l,u)){r=M,s.splice(_,1),f=c.slice(0,o+1),g=c.slice(o),m=h.slice(r),v=h.slice(0,r+1),c=f.concat(m).concat(v).concat(g),w=o;break}if(0<=r)break;y[p]=!0}if(0<=r)break}}return c}(t,e),f=HU.triangulate(p,!1);for(n=0,r=f.length;n<r;n++)for(a=f[n],o=0;o<3;o++)void 0!==(l=h[s=a[o].x+":"+a[o].y])&&(a[o]=l);return f.concat()},isClockWise:function(t){return HU.area(t)<0}};function UU(t,e){void 0!==t?(fH.call(this),this.type="ExtrudeGeometry",t=Array.isArray(t)?t:[t],this.addShapeList(t,e),this.computeFaceNormals()):t=[]}function WU(t,e){var i=(e=e||{}).font;if(!1===(i&&i.isFont))return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new fH;var n=i.generateShapes(t,e.size,e.curveSegments);e.amount=void 0!==e.height?e.height:50,void 0===e.bevelThickness&&(e.bevelThickness=10),void 0===e.bevelSize&&(e.bevelSize=8),void 0===e.bevelEnabled&&(e.bevelEnabled=!1),UU.call(this,n,e),this.type="TextGeometry"}function jU(t,e,i,n,r,o,a){fH.call(this),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:i,phiStart:n,phiLength:r,thetaStart:o,thetaLength:a},this.fromBufferGeometry(new ZU(t,e,i,n,r,o,a))}function ZU(t,e,i,n,r,o,a){gH.call(this),this.type="SphereBufferGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:i,phiStart:n,phiLength:r,thetaStart:o,thetaLength:a},t=t||50,e=Math.max(3,Math.floor(e)||8),i=Math.max(2,Math.floor(i)||6),n=void 0!==n?n:0,r=void 0!==r?r:2*Math.PI;var s,l,h=(o=void 0!==o?o:0)+(a=void 0!==a?a:Math.PI),c=0,u=[],d=new mF,p=new mF,f=[],g=[],m=[],v=[];for(l=0;l<=i;l++){var y=[],_=l/i;for(s=0;s<=e;s++){var x=s/e;d.x=-t*Math.cos(n+x*r)*Math.sin(o+_*a),d.y=t*Math.cos(o+_*a),d.z=t*Math.sin(n+x*r)*Math.sin(o+_*a),g.push(d.x,d.y,d.z),p.set(d.x,d.y,d.z).normalize(),m.push(p.x,p.y,p.z),v.push(x,1-_),y.push(c++)}u.push(y)}for(l=0;l<i;l++)for(s=0;s<e;s++){var w=u[l][s+1],b=u[l][s],M=u[l+1][s],S=u[l+1][s+1];(0!==l||0<o)&&f.push(w,b,S),(l!==i-1||h<Math.PI)&&f.push(b,M,S)}this.setIndex(f),this.addAttribute("position",new ZV(g,3)),this.addAttribute("normal",new ZV(m,3)),this.addAttribute("uv",new ZV(v,2))}function XU(t,e,i,n,r,o){fH.call(this),this.type="RingGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:i,phiSegments:n,thetaStart:r,thetaLength:o},this.fromBufferGeometry(new qU(t,e,i,n,r,o))}function qU(t,e,i,n,r,o){gH.call(this),this.type="RingBufferGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:i,phiSegments:n,thetaStart:r,thetaLength:o},t=t||20,e=e||50,r=void 0!==r?r:0,o=void 0!==o?o:2*Math.PI,i=void 0!==i?Math.max(3,i):8;var a,s,l,h=[],c=[],u=[],d=[],p=t,f=(e-t)/(n=void 0!==n?Math.max(1,n):1),g=new mF,m=new WB;for(s=0;s<=n;s++){for(l=0;l<=i;l++)a=r+l/i*o,g.x=p*Math.cos(a),g.y=p*Math.sin(a),c.push(g.x,g.y,g.z),u.push(0,0,1),m.x=(g.x/e+1)/2,m.y=(g.y/e+1)/2,d.push(m.x,m.y);p+=f}for(s=0;s<n;s++){var v=s*(i+1);for(l=0;l<i;l++){var y=a=l+v,_=a+i+1,x=a+i+2,w=a+1;h.push(y,_,w),h.push(_,x,w)}}this.setIndex(h),this.addAttribute("position",new ZV(c,3)),this.addAttribute("normal",new ZV(u,3)),this.addAttribute("uv",new ZV(d,2))}function YU(t,e,i,n){fH.call(this),this.type="LatheGeometry",this.parameters={points:t,segments:e,phiStart:i,phiLength:n},this.fromBufferGeometry(new JU(t,e,i,n)),this.mergeVertices()}function JU(t,e,i,n){gH.call(this),this.type="LatheBufferGeometry",this.parameters={points:t,segments:e,phiStart:i,phiLength:n},e=Math.floor(e)||12,i=i||0,n=n||2*Math.PI,n=UB.clamp(n,0,2*Math.PI);var r,o,a,s=[],l=[],h=[],c=1/e,u=new mF,d=new WB;for(o=0;o<=e;o++){var p=i+o*c*n,f=Math.sin(p),g=Math.cos(p);for(a=0;a<=t.length-1;a++)u.x=t[a].x*f,u.y=t[a].y,u.z=t[a].x*g,l.push(u.x,u.y,u.z),d.x=o/e,d.y=a/(t.length-1),h.push(d.x,d.y)}for(o=0;o<e;o++)for(a=0;a<t.length-1;a++){var m=r=a+o*t.length,v=r+t.length,y=r+t.length+1,_=r+1;s.push(m,v,_),s.push(v,y,_)}if(this.setIndex(s),this.addAttribute("position",new ZV(l,3)),this.addAttribute("uv",new ZV(h,2)),this.computeVertexNormals(),n===2*Math.PI){var x=this.attributes.normal.array,w=new mF,b=new mF,M=new mF;for(r=e*t.length*3,a=o=0;o<t.length;o++,a+=3)w.x=x[a+0],w.y=x[a+1],w.z=x[a+2],b.x=x[r+a+0],b.y=x[r+a+1],b.z=x[r+a+2],M.addVectors(w,b).normalize(),x[a+0]=x[r+a+0]=M.x,x[a+1]=x[r+a+1]=M.y,x[a+2]=x[r+a+2]=M.z}}function KU(t,e){fH.call(this),this.type="ShapeGeometry","object"==typeof e&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),e=e.curveSegments),this.parameters={shapes:t,curveSegments:e},this.fromBufferGeometry(new QU(t,e)),this.mergeVertices()}function QU(t,f){gH.call(this),this.type="ShapeBufferGeometry",this.parameters={shapes:t,curveSegments:f},f=f||12;var g=[],m=[],v=[],y=[],e=0,_=0;if(!1===Array.isArray(t))n(t);else for(var i=0;i<t.length;i++)n(t[i]),this.addGroup(e,_,i),e+=_,_=0;function n(t){var e,i,n,r=m.length/3,o=t.extractPoints(f),a=o.shape,s=o.holes;if(!1===HU.isClockWise(a))for(a=a.reverse(),e=0,i=s.length;e<i;e++)n=s[e],!0===HU.isClockWise(n)&&(s[e]=n.reverse());var l=HU.triangulateShape(a,s);for(e=0,i=s.length;e<i;e++)n=s[e],a=a.concat(n);for(e=0,i=a.length;e<i;e++){var h=a[e];m.push(h.x,h.y,0),v.push(0,0,1),y.push(h.x,h.y)}for(e=0,i=l.length;e<i;e++){var c=l[e],u=c[0]+r,d=c[1]+r,p=c[2]+r;g.push(u,d,p),_+=3}}this.setIndex(g),this.addAttribute("position",new ZV(m,3)),this.addAttribute("normal",new ZV(v,3)),this.addAttribute("uv",new ZV(y,2))}function $U(t,e){gH.call(this),this.type="EdgesGeometry",this.parameters={thresholdAngle:e},e=void 0!==e?e:1;var i,n,r=[],o=Math.cos(UB.DEG2RAD*e),a=[0,0],s={},l=["a","b","c"];t.isBufferGeometry?(n=new fH).fromBufferGeometry(t):n=t.clone(),n.mergeVertices(),n.computeFaceNormals();for(var h=n.vertices,c=n.faces,u=0,d=c.length;u<d;u++)for(var p=c[u],f=0;f<3;f++)a[0]=p[l[f]],a[1]=p[l[(f+1)%3]],a.sort(v),void 0===s[i=a.toString()]?s[i]={index1:a[0],index2:a[1],face1:u,face2:void 0}:s[i].face2=u;for(i in s){var g=s[i];if(void 0===g.face2||c[g.face1].normal.dot(c[g.face2].normal)<=o){var m=h[g.index1];r.push(m.x,m.y,m.z),m=h[g.index2],r.push(m.x,m.y,m.z)}}function v(t,e){return t-e}this.addAttribute("position",new ZV(r,3))}function tW(t,e,i,n,r,o,a,s){fH.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:i,radialSegments:n,heightSegments:r,openEnded:o,thetaStart:a,thetaLength:s},this.fromBufferGeometry(new eW(t,e,i,n,r,o,a,s)),this.mergeVertices()}function eW(v,y,_,x,w,t,b,M){gH.call(this),this.type="CylinderBufferGeometry",this.parameters={radiusTop:v,radiusBottom:y,height:_,radialSegments:x,heightSegments:w,openEnded:t,thetaStart:b,thetaLength:M};var S=this;v=void 0!==v?v:20,y=void 0!==y?y:20,_=void 0!==_?_:100,x=Math.floor(x)||8,w=Math.floor(w)||1,t=void 0!==t&&t,b=void 0!==b?b:0,M=void 0!==M?M:2*Math.PI;var T=[],C=[],A=[],E=[],P=0,L=[],I=_/2,R=0;function e(t){var e,i,n,r=new WB,o=new mF,a=0,s=!0===t?v:y,l=!0===t?1:-1;for(i=P,e=1;e<=x;e++)C.push(0,I*l,0),A.push(0,l,0),E.push(.5,.5),P++;for(n=P,e=0;e<=x;e++){var h=e/x*M+b,c=Math.cos(h),u=Math.sin(h);o.x=s*u,o.y=I*l,o.z=s*c,C.push(o.x,o.y,o.z),A.push(0,l,0),r.x=.5*c+.5,r.y=.5*u*l+.5,E.push(r.x,r.y),P++}for(e=0;e<x;e++){var d=i+e,p=n+e;!0===t?T.push(p,p+1,d):T.push(p+1,p,d),a+=3}S.addGroup(R,a,!0===t?1:2),R+=a}!function(){var t,e,i=new mF,n=new mF,r=0,o=(y-v)/_;for(e=0;e<=w;e++){var a=[],s=e/w,l=s*(y-v)+v;for(t=0;t<=x;t++){var h=t/x,c=h*M+b,u=Math.sin(c),d=Math.cos(c);n.x=l*u,n.y=-s*_+I,n.z=l*d,C.push(n.x,n.y,n.z),i.set(u,o,d).normalize(),A.push(i.x,i.y,i.z),E.push(h,1-s),a.push(P++)}L.push(a)}for(t=0;t<x;t++)for(e=0;e<w;e++){var p=L[e][t],f=L[e+1][t],g=L[e+1][t+1],m=L[e][t+1];T.push(p,f,m),T.push(f,g,m),r+=6}S.addGroup(R,r,0),R+=r}(),!1===t&&(0<v&&e(!0),0<y&&e(!1)),this.setIndex(T),this.addAttribute("position",new ZV(C,3)),this.addAttribute("normal",new ZV(A,3)),this.addAttribute("uv",new ZV(E,2))}function iW(t,e,i,n,r,o,a){tW.call(this,0,t,e,i,n,r,o,a),this.type="ConeGeometry",this.parameters={radius:t,height:e,radialSegments:i,heightSegments:n,openEnded:r,thetaStart:o,thetaLength:a}}function nW(t,e,i,n,r,o,a){eW.call(this,0,t,e,i,n,r,o,a),this.type="ConeBufferGeometry",this.parameters={radius:t,height:e,radialSegments:i,heightSegments:n,openEnded:r,thetaStart:o,thetaLength:a}}function rW(t,e,i,n){fH.call(this),this.type="CircleGeometry",this.parameters={radius:t,segments:e,thetaStart:i,thetaLength:n},this.fromBufferGeometry(new oW(t,e,i,n))}function oW(t,e,i,n){gH.call(this),this.type="CircleBufferGeometry",this.parameters={radius:t,segments:e,thetaStart:i,thetaLength:n},t=t||50,e=void 0!==e?Math.max(3,e):8,i=void 0!==i?i:0,n=void 0!==n?n:2*Math.PI;var r,o,a=[],s=[],l=[],h=[],c=new mF,u=new WB;for(s.push(0,0,0),l.push(0,0,1),h.push(.5,.5),o=0,r=3;o<=e;o++,r+=3){var d=i+o/e*n;c.x=t*Math.cos(d),c.y=t*Math.sin(d),s.push(c.x,c.y,c.z),l.push(0,0,1),u.x=(s[r]/t+1)/2,u.y=(s[r+1]/t+1)/2,h.push(u.x,u.y)}for(r=1;r<=e;r++)a.push(r,r+1,0);this.setIndex(a),this.addAttribute("position",new ZV(s,3)),this.addAttribute("normal",new ZV(l,3)),this.addAttribute("uv",new ZV(h,2))}((UU.prototype=Object.create(fH.prototype)).constructor=UU).prototype.addShapeList=function(t,e){for(var i=t.length,n=0;n<i;n++){var r=t[n];this.addShape(r,e)}},UU.prototype.addShape=function(t,e){var i,n,r,o,a,s,l,h,c=void 0!==e.amount?e.amount:100,u=void 0!==e.bevelThickness?e.bevelThickness:6,d=void 0!==e.bevelSize?e.bevelSize:u-2,p=void 0!==e.bevelSegments?e.bevelSegments:3,f=void 0===e.bevelEnabled||e.bevelEnabled,g=void 0!==e.curveSegments?e.curveSegments:12,m=void 0!==e.steps?e.steps:1,v=e.extrudePath,y=!1,_=void 0!==e.UVGenerator?e.UVGenerator:UU.WorldUVGenerator;v&&(i=v.getSpacedPoints(m),f=!(y=!0),n=void 0!==e.frames?e.frames:v.computeFrenetFrames(m,!1),r=new mF,o=new mF,a=new mF),f||(d=u=p=0);var x=this,w=this.vertices.length,b=t.extractPoints(g),M=b.shape,S=b.holes,T=!HU.isClockWise(M);if(T){for(M=M.reverse(),l=0,h=S.length;l<h;l++)s=S[l],HU.isClockWise(s)&&(S[l]=s.reverse());T=!1}var C=HU.triangulateShape(M,S),A=M;for(l=0,h=S.length;l<h;l++)s=S[l],M=M.concat(s);function E(t,e,i){return e||console.error("THREE.ExtrudeGeometry: vec does not exist"),e.clone().multiplyScalar(i).add(t)}var P,L,I,R,D,O,k=M.length,z=C.length;function N(t,e,i){var n,r,o=1,a=t.x-e.x,s=t.y-e.y,l=i.x-t.x,h=i.y-t.y,c=a*a+s*s,u=a*h-s*l;if(Math.abs(u)>Number.EPSILON){var d=Math.sqrt(c),p=Math.sqrt(l*l+h*h),f=e.x-s/d,g=e.y+a/d,m=((i.x-h/p-f)*h-(i.y+l/p-g)*l)/(a*h-s*l),v=(n=f+a*m-t.x)*n+(r=g+s*m-t.y)*r;if(v<=2)return new WB(n,r);o=Math.sqrt(v/2)}else{var y=!1;a>Number.EPSILON?l>Number.EPSILON&&(y=!0):a<-Number.EPSILON?l<-Number.EPSILON&&(y=!0):Math.sign(s)===Math.sign(h)&&(y=!0),y?(n=-s,r=a,o=Math.sqrt(c)):(n=a,r=s,o=Math.sqrt(c/2))}return new WB(n/o,r/o)}for(var B=[],F=0,G=A.length,V=G-1,H=F+1;F<G;F++,V++,H++)V===G&&(V=0),H===G&&(H=0),B[F]=N(A[F],A[V],A[H]);var U,W,j=[],Z=B.concat();for(l=0,h=S.length;l<h;l++){for(s=S[l],U=[],F=0,V=(G=s.length)-1,H=F+1;F<G;F++,V++,H++)V===G&&(V=0),H===G&&(H=0),U[F]=N(s[F],s[V],s[H]);j.push(U),Z=Z.concat(U)}for(P=0;P<p;P++){for(I=P/p,R=u*Math.cos(I*Math.PI/2),L=d*Math.sin(I*Math.PI/2),F=0,G=A.length;F<G;F++)q((D=E(A[F],B[F],L)).x,D.y,-R);for(l=0,h=S.length;l<h;l++)for(s=S[l],U=j[l],F=0,G=s.length;F<G;F++)q((D=E(s[F],U[F],L)).x,D.y,-R)}for(L=d,F=0;F<k;F++)D=f?E(M[F],Z[F],L):M[F],y?(o.copy(n.normals[0]).multiplyScalar(D.x),r.copy(n.binormals[0]).multiplyScalar(D.y),a.copy(i[0]).add(o).add(r),q(a.x,a.y,a.z)):q(D.x,D.y,0);for(W=1;W<=m;W++)for(F=0;F<k;F++)D=f?E(M[F],Z[F],L):M[F],y?(o.copy(n.normals[W]).multiplyScalar(D.x),r.copy(n.binormals[W]).multiplyScalar(D.y),a.copy(i[W]).add(o).add(r),q(a.x,a.y,a.z)):q(D.x,D.y,c/m*W);for(P=p-1;0<=P;P--){for(I=P/p,R=u*Math.cos(I*Math.PI/2),L=d*Math.sin(I*Math.PI/2),F=0,G=A.length;F<G;F++)q((D=E(A[F],B[F],L)).x,D.y,c+R);for(l=0,h=S.length;l<h;l++)for(s=S[l],U=j[l],F=0,G=s.length;F<G;F++)D=E(s[F],U[F],L),y?q(D.x,D.y+i[m-1].y,i[m-1].x+R):q(D.x,D.y,c+R)}function X(t,e){var i,n;for(F=t.length;0<=--F;){(n=(i=F)-1)<0&&(n=t.length-1);var r=0,o=m+2*p;for(r=0;r<o;r++){var a=k*r,s=k*(r+1);J(e+i+a,e+n+a,e+n+s,e+i+s,t,r,o,i,n)}}}function q(t,e,i){x.vertices.push(new mF(t,e,i))}function Y(t,e,i){t+=w,e+=w,i+=w,x.faces.push(new zV(t,e,i,null,null,0));var n=_.generateTopUV(x,t,e,i);x.faceVertexUvs[0].push(n)}function J(t,e,i,n,r,o,a,s,l){t+=w,e+=w,i+=w,n+=w,x.faces.push(new zV(t,e,n,null,null,1)),x.faces.push(new zV(e,i,n,null,null,1));var h=_.generateSideWallUV(x,t,e,i,n);x.faceVertexUvs[0].push([h[0],h[1],h[3]]),x.faceVertexUvs[0].push([h[1],h[2],h[3]])}!function(){if(f){var t=0,e=k*t;for(F=0;F<z;F++)Y((O=C[F])[2]+e,O[1]+e,O[0]+e);for(e=k*(t=m+2*p),F=0;F<z;F++)Y((O=C[F])[0]+e,O[1]+e,O[2]+e)}else{for(F=0;F<z;F++)Y((O=C[F])[2],O[1],O[0]);for(F=0;F<z;F++)Y((O=C[F])[0]+k*m,O[1]+k*m,O[2]+k*m)}}(),function(){var t=0;for(X(A,t),t+=A.length,l=0,h=S.length;l<h;l++)X(s=S[l],t),t+=s.length}()},UU.WorldUVGenerator={generateTopUV:function(t,e,i,n){var r=t.vertices,o=r[e],a=r[i],s=r[n];return[new WB(o.x,o.y),new WB(a.x,a.y),new WB(s.x,s.y)]},generateSideWallUV:function(t,e,i,n,r){var o=t.vertices,a=o[e],s=o[i],l=o[n],h=o[r];return Math.abs(a.y-s.y)<.01?[new WB(a.x,1-a.z),new WB(s.x,1-s.z),new WB(l.x,1-l.z),new WB(h.x,1-h.z)]:[new WB(a.y,1-a.z),new WB(s.y,1-s.z),new WB(l.y,1-l.z),new WB(h.y,1-h.z)]}},(WU.prototype=Object.create(UU.prototype)).constructor=WU,(jU.prototype=Object.create(fH.prototype)).constructor=jU,(ZU.prototype=Object.create(gH.prototype)).constructor=ZU,(XU.prototype=Object.create(fH.prototype)).constructor=XU,(qU.prototype=Object.create(gH.prototype)).constructor=qU,(YU.prototype=Object.create(fH.prototype)).constructor=YU,(JU.prototype=Object.create(gH.prototype)).constructor=JU,(KU.prototype=Object.create(fH.prototype)).constructor=KU,(QU.prototype=Object.create(gH.prototype)).constructor=QU,($U.prototype=Object.create(gH.prototype)).constructor=$U,(tW.prototype=Object.create(fH.prototype)).constructor=tW,(eW.prototype=Object.create(gH.prototype)).constructor=eW,(iW.prototype=Object.create(tW.prototype)).constructor=iW,(nW.prototype=Object.create(eW.prototype)).constructor=nW,(rW.prototype=Object.create(fH.prototype)).constructor=rW,(oW.prototype=Object.create(gH.prototype)).constructor=oW;var aW=Object.freeze({WireframeGeometry:MU,ParametricGeometry:SU,ParametricBufferGeometry:TU,TetrahedronGeometry:EU,TetrahedronBufferGeometry:PU,OctahedronGeometry:LU,OctahedronBufferGeometry:IU,IcosahedronGeometry:RU,IcosahedronBufferGeometry:DU,DodecahedronGeometry:OU,DodecahedronBufferGeometry:kU,PolyhedronGeometry:CU,PolyhedronBufferGeometry:AU,TubeGeometry:zU,TubeBufferGeometry:NU,TorusKnotGeometry:BU,TorusKnotBufferGeometry:FU,TorusGeometry:GU,TorusBufferGeometry:VU,TextGeometry:WU,SphereGeometry:jU,SphereBufferGeometry:ZU,RingGeometry:XU,RingBufferGeometry:qU,PlaneGeometry:_H,PlaneBufferGeometry:xH,LatheGeometry:YU,LatheBufferGeometry:JU,ShapeGeometry:KU,ShapeBufferGeometry:QU,ExtrudeGeometry:UU,EdgesGeometry:$U,ConeGeometry:iW,ConeBufferGeometry:nW,CylinderGeometry:tW,CylinderBufferGeometry:eW,CircleGeometry:rW,CircleBufferGeometry:oW,BoxGeometry:vH,BoxBufferGeometry:yH});function sW(){ZG.call(this,{uniforms:iG.merge([hG.lights,{opacity:{value:1}}]),vertexShader:nG.shadow_vert,fragmentShader:nG.shadow_frag}),this.lights=!0,this.transparent=!0,Object.defineProperties(this,{opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(t){this.uniforms.opacity.value=t}}})}function lW(t){ZG.call(this,t),this.type="RawShaderMaterial"}function hW(t){this.uuid=UB.generateUUID(),this.type="MultiMaterial",this.materials=Array.isArray(t)?t:[],this.visible=!0}function cW(t){jG.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new rG(16777215),this.roughness=.5,this.metalness=.5,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new rG(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new WB(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function uW(t){cW.call(this),this.defines={PHYSICAL:""},this.type="MeshPhysicalMaterial",this.reflectivity=.5,this.clearCoat=0,this.clearCoatRoughness=0,this.setValues(t)}function dW(t){jG.call(this),this.type="MeshPhongMaterial",this.color=new rG(16777215),this.specular=new rG(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new rG(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new WB(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=qN,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function pW(t){dW.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.gradientMap=null,this.setValues(t)}function fW(t){jG.call(this,t),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new WB(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function gW(t){jG.call(this),this.type="MeshLambertMaterial",this.color=new rG(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new rG(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=qN,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function mW(t){jG.call(this),this.type="LineDashedMaterial",this.color=new rG(16777215),this.linewidth=1,this.scale=1,this.dashSize=3,this.gapSize=1,this.lights=!1,this.setValues(t)}((sW.prototype=Object.create(ZG.prototype)).constructor=sW).prototype.isShadowMaterial=!0,lW.prototype=Object.create(ZG.prototype),hW.prototype={constructor:hW,isMultiMaterial:(lW.prototype.constructor=lW).prototype.isRawShaderMaterial=!0,toJSON:function(t){for(var e={metadata:{version:4.2,type:"material",generator:"MaterialExporter"},uuid:this.uuid,type:this.type,materials:[]},i=this.materials,n=0,r=i.length;n<r;n++){var o=i[n].toJSON(t);delete o.metadata,e.materials.push(o)}return e.visible=this.visible,e},clone:function(){for(var t=new this.constructor,e=0;e<this.materials.length;e++)t.materials.push(this.materials[e].clone());return t.visible=this.visible,t}},((cW.prototype=Object.create(jG.prototype)).constructor=cW).prototype.isMeshStandardMaterial=!0,cW.prototype.copy=function(t){return jG.prototype.copy.call(this,t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},((uW.prototype=Object.create(cW.prototype)).constructor=uW).prototype.isMeshPhysicalMaterial=!0,uW.prototype.copy=function(t){return cW.prototype.copy.call(this,t),this.defines={PHYSICAL:""},this.reflectivity=t.reflectivity,this.clearCoat=t.clearCoat,this.clearCoatRoughness=t.clearCoatRoughness,this},((dW.prototype=Object.create(jG.prototype)).constructor=dW).prototype.isMeshPhongMaterial=!0,dW.prototype.copy=function(t){return jG.prototype.copy.call(this,t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},((pW.prototype=Object.create(dW.prototype)).constructor=pW).prototype.isMeshToonMaterial=!0,pW.prototype.copy=function(t){return dW.prototype.copy.call(this,t),this.gradientMap=t.gradientMap,this},((fW.prototype=Object.create(jG.prototype)).constructor=fW).prototype.isMeshNormalMaterial=!0,fW.prototype.copy=function(t){return jG.prototype.copy.call(this,t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},((gW.prototype=Object.create(jG.prototype)).constructor=gW).prototype.isMeshLambertMaterial=!0,gW.prototype.copy=function(t){return jG.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},((mW.prototype=Object.create(jG.prototype)).constructor=mW).prototype.isLineDashedMaterial=!0,mW.prototype.copy=function(t){return jG.prototype.copy.call(this,t),this.color.copy(t.color),this.linewidth=t.linewidth,this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this};var vW=Object.freeze({ShadowMaterial:sW,SpriteMaterial:sU,RawShaderMaterial:lW,ShaderMaterial:ZG,PointsMaterial:mU,MultiMaterial:hW,MeshPhysicalMaterial:uW,MeshStandardMaterial:cW,MeshPhongMaterial:dW,MeshToonMaterial:pW,MeshNormalMaterial:fW,MeshLambertMaterial:gW,MeshDepthMaterial:XG,MeshBasicMaterial:NV,LineDashedMaterial:mW,LineBasicMaterial:pU,Material:jG}),yW={enabled:!1,files:{},add:function(t,e){!1!==this.enabled&&(this.files[t]=e)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};function _W(t,e,i){var n=this,r=!1,o=0,a=0;this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=i,this.itemStart=function(t){a++,!1===r&&void 0!==n.onStart&&n.onStart(t,o,a),r=!0},this.itemEnd=function(t){o++,void 0!==n.onProgress&&n.onProgress(t,o,a),o===a&&(r=!1,void 0!==n.onLoad&&n.onLoad())},this.itemError=function(t){void 0!==n.onError&&n.onError(t)}}var xW=new _W;function wW(t){this.manager=void 0!==t?t:xW}function bW(t){this.manager=void 0!==t?t:xW,this._parser=null}function MW(t){this.manager=void 0!==t?t:xW,this._parser=null}function SW(t){this.manager=void 0!==t?t:xW}function TW(t){this.manager=void 0!==t?t:xW}function CW(t){this.manager=void 0!==t?t:xW}function AW(t,e){DV.call(this),this.type="Light",this.color=new rG(t),this.intensity=void 0!==e?e:1,this.receiveShadow=void 0}function EW(t,e,i){AW.call(this,t,i),this.type="HemisphereLight",this.castShadow=void 0,this.position.copy(DV.DefaultUp),this.updateMatrix(),this.groundColor=new rG(e)}function PW(t){this.camera=t,this.bias=0,this.radius=1,this.mapSize=new WB(512,512),this.map=null,this.matrix=new vF}function LW(){PW.call(this,new bH(50,1,.5,500))}function IW(t,e,i,n,r,o){AW.call(this,t,e),this.type="SpotLight",this.position.copy(DV.DefaultUp),this.updateMatrix(),this.target=new DV,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(t){this.intensity=t/Math.PI}}),this.distance=void 0!==i?i:0,this.angle=void 0!==n?n:Math.PI/3,this.penumbra=void 0!==r?r:0,this.decay=void 0!==o?o:1,this.shadow=new LW}function RW(t,e,i,n){AW.call(this,t,e),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(t){this.intensity=t/(4*Math.PI)}}),this.distance=void 0!==i?i:0,this.decay=void 0!==n?n:1,this.shadow=new PW(new bH(90,1,.5,500))}function DW(){PW.call(this,new MH(-5,5,5,-5,.5,500))}function OW(t,e){AW.call(this,t,e),this.type="DirectionalLight",this.position.copy(DV.DefaultUp),this.updateMatrix(),this.target=new DV,this.shadow=new DW}function kW(t,e){AW.call(this,t,e),this.type="AmbientLight",this.castShadow=void 0}Object.assign(wW.prototype,{load:function(i,n,e,r){void 0===i&&(i=""),void 0!==this.path&&(i=this.path+i);var o=this,t=yW.get(i);if(void 0!==t)return o.manager.itemStart(i),setTimeout(function(){n&&n(t),o.manager.itemEnd(i)},0),t;var a=i.match(/^data:(.*?)(;base64)?,(.*)$/);if(a){var s=a[1],l=!!a[2],h=a[3];h=window.decodeURIComponent(h),l&&(h=window.atob(h));try{var c,u=(this.responseType||"").toLowerCase();switch(u){case"arraybuffer":case"blob":c=new ArrayBuffer(h.length);for(var d=new Uint8Array(c),p=0;p<h.length;p++)d[p]=h.charCodeAt(p);"blob"===u&&(c=new Blob([c],{type:s}));break;case"document":var f=new DOMParser;c=f.parseFromString(h,s);break;case"json":c=JSON.parse(h);break;default:c=h}window.setTimeout(function(){n&&n(c),o.manager.itemEnd(i)},0)}catch(t){window.setTimeout(function(){r&&r(t),o.manager.itemError(i)},0)}}else{var g=new XMLHttpRequest;g.open("GET",i,!0),g.addEventListener("load",function(t){var e=t.target.response;yW.add(i,e),200===this.status?(n&&n(e),o.manager.itemEnd(i)):0===this.status?(console.warn("THREE.FileLoader: HTTP Status 0 received."),n&&n(e),o.manager.itemEnd(i)):(r&&r(t),o.manager.itemError(i))},!1),void 0!==e&&g.addEventListener("progress",function(t){e(t)},!1),g.addEventListener("error",function(t){r&&r(t),o.manager.itemError(i)},!1),void 0!==this.responseType&&(g.responseType=this.responseType),void 0!==this.withCredentials&&(g.withCredentials=this.withCredentials),g.overrideMimeType&&g.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain"),g.send(null)}return o.manager.itemStart(i),g},setPath:function(t){return this.path=t,this},setResponseType:function(t){return this.responseType=t,this},setWithCredentials:function(t){return this.withCredentials=t,this},setMimeType:function(t){return this.mimeType=t,this}}),Object.assign(bW.prototype,{load:function(t,o,e,n){var a=this,s=[],l=new xU;l.image=s;var r=new wW(this.manager);function i(i){r.load(t[i],function(t){var e=a._parser(t,!0);s[i]={width:e.width,height:e.height,format:e.format,mipmaps:e.mipmaps},6===(h+=1)&&(1===e.mipmapCount&&(l.minFilter=gB),l.format=e.format,l.needsUpdate=!0,o&&o(l))},e,n)}if(r.setPath(this.path),r.setResponseType("arraybuffer"),Array.isArray(t))for(var h=0,c=0,u=t.length;c<u;++c)i(c);else r.load(t,function(t){var e=a._parser(t,!0);if(e.isCubemap)for(var i=e.mipmaps.length/e.mipmapCount,n=0;n<i;n++){s[n]={mipmaps:[]};for(var r=0;r<e.mipmapCount;r++)s[n].mipmaps.push(e.mipmaps[n*e.mipmapCount+r]),s[n].format=e.format,s[n].width=e.width,s[n].height=e.height}else l.image.width=e.width,l.image.height=e.height,l.mipmaps=e.mipmaps;1===e.mipmapCount&&(l.minFilter=gB),l.format=e.format,l.needsUpdate=!0,o&&o(l)},e,n);return l},setPath:function(t){return this.path=t,this}}),Object.assign(MW.prototype,{load:function(t,i,e,n){var r=this,o=new aG,a=new wW(this.manager);return a.setResponseType("arraybuffer"),a.load(t,function(t){var e=r._parser(t);e&&(void 0!==e.image?o.image=e.image:void 0!==e.data&&(o.image.width=e.width,o.image.height=e.height,o.image.data=e.data),o.wrapS=void 0!==e.wrapS?e.wrapS:cB,o.wrapT=void 0!==e.wrapT?e.wrapT:cB,o.magFilter=void 0!==e.magFilter?e.magFilter:gB,o.minFilter=void 0!==e.minFilter?e.minFilter:mB,o.anisotropy=void 0!==e.anisotropy?e.anisotropy:1,void 0!==e.format&&(o.format=e.format),void 0!==e.type&&(o.type=e.type),void 0!==e.mipmaps&&(o.mipmaps=e.mipmaps),1===e.mipmapCount&&(o.minFilter=gB),o.needsUpdate=!0,i&&i(o,e))},e,n),o}}),Object.assign(SW.prototype,{load:function(e,t,i,n){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e);var r=this,o=yW.get(e);if(void 0!==o)return r.manager.itemStart(e),setTimeout(function(){t&&t(o),r.manager.itemEnd(e)},0),o;var a=document.createElementNS("http://www.w3.org/1999/xhtml","img");return a.addEventListener("load",function(){yW.add(e,this),t&&t(this),r.manager.itemEnd(e)},!1),a.addEventListener("error",function(t){n&&n(t),r.manager.itemError(e)},!1),void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),r.manager.itemStart(e),a.src=e,a},setCrossOrigin:function(t){return this.crossOrigin=t,this},setPath:function(t){return this.path=t,this}}),Object.assign(TW.prototype,{load:function(t,i,e,n){var r=new yF,o=new SW(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);var a=0;function s(e){o.load(t[e],function(t){r.images[e]=t,6===++a&&(r.needsUpdate=!0,i&&i(r))},void 0,n)}for(var l=0;l<t.length;++l)s(l);return r},setCrossOrigin:function(t){return this.crossOrigin=t,this},setPath:function(t){return this.path=t,this}}),Object.assign(CW.prototype,{load:function(i,n,t,e){var r=new uF,o=new SW(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(i,function(t){var e=0<i.search(/\.(jpg|jpeg)$/)||0===i.search(/^data\:image\/jpeg/);r.format=e?MB:SB,r.image=t,r.needsUpdate=!0,void 0!==n&&n(r)},t,e),r},setCrossOrigin:function(t){return this.crossOrigin=t,this},setPath:function(t){return this.path=t,this}}),AW.prototype=Object.assign(Object.create(DV.prototype),{constructor:AW,isLight:!0,copy:function(t){return DV.prototype.copy.call(this,t),this.color.copy(t.color),this.intensity=t.intensity,this},toJSON:function(t){var e=DV.prototype.toJSON.call(this,t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),void 0!==this.shadow&&(e.object.shadow=this.shadow.toJSON()),e}}),EW.prototype=Object.assign(Object.create(AW.prototype),{constructor:EW,isHemisphereLight:!0,copy:function(t){return AW.prototype.copy.call(this,t),this.groundColor.copy(t.groundColor),this}}),Object.assign(PW.prototype,{copy:function(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var t={};return 0!==this.bias&&(t.bias=this.bias),1!==this.radius&&(t.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}),LW.prototype=Object.assign(Object.create(PW.prototype),{constructor:LW,isSpotLightShadow:!0,update:function(t){var e=2*UB.RAD2DEG*t.angle,i=this.mapSize.width/this.mapSize.height,n=t.distance||500,r=this.camera;e===r.fov&&i===r.aspect&&n===r.far||(r.fov=e,r.aspect=i,r.far=n,r.updateProjectionMatrix())}}),IW.prototype=Object.assign(Object.create(AW.prototype),{constructor:IW,isSpotLight:!0,copy:function(t){return AW.prototype.copy.call(this,t),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}),RW.prototype=Object.assign(Object.create(AW.prototype),{constructor:RW,isPointLight:!0,copy:function(t){return AW.prototype.copy.call(this,t),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}),DW.prototype=Object.assign(Object.create(PW.prototype),{constructor:DW}),OW.prototype=Object.assign(Object.create(AW.prototype),{constructor:OW,isDirectionalLight:!0,copy:function(t){return AW.prototype.copy.call(this,t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}),kW.prototype=Object.assign(Object.create(AW.prototype),{constructor:kW,isAmbientLight:!0});var zW,NW,BW,FW,GW,VW,HW={arraySlice:function(t,e,i){return HW.isTypedArray(t)?new t.constructor(t.subarray(e,i)):t.slice(e,i)},convertArray:function(t,e,i){return!t||!i&&t.constructor===e?t:"number"==typeof e.BYTES_PER_ELEMENT?new e(t):Array.prototype.slice.call(t)},isTypedArray:function(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)},getKeyframeOrder:function(i){for(var t=i.length,e=new Array(t),n=0;n!==t;++n)e[n]=n;return e.sort(function(t,e){return i[t]-i[e]}),e},sortedArray:function(t,e,i){for(var n=t.length,r=new t.constructor(n),o=0,a=0;a!==n;++o)for(var s=i[o]*e,l=0;l!==e;++l)r[a++]=t[s+l];return r},flattenJSON:function(t,e,i,n){for(var r=1,o=t[0];void 0!==o&&void 0===o[n];)o=t[r++];if(void 0!==o){var a=o[n];if(void 0!==a)if(Array.isArray(a))for(;void 0!==(a=o[n])&&(e.push(o.time),i.push.apply(i,a)),void 0!==(o=t[r++]););else if(void 0!==a.toArray)for(;void 0!==(a=o[n])&&(e.push(o.time),a.toArray(i,i.length)),void 0!==(o=t[r++]););else for(;void 0!==(a=o[n])&&(e.push(o.time),i.push(a)),void 0!==(o=t[r++]););}}};function UW(t,e,i,n){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==n?n:new e.constructor(i),this.sampleValues=e,this.valueSize=i}function WW(t,e,i,n){UW.call(this,t,e,i,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function jW(t,e,i,n){UW.call(this,t,e,i,n)}function ZW(t,e,i,n){UW.call(this,t,e,i,n)}function XW(t,e,i,n){if(void 0===t)throw new Error("track name is undefined");if(void 0===e||0===e.length)throw new Error("no keyframes in track named "+t);this.name=t,this.times=HW.convertArray(e,this.TimeBufferType),this.values=HW.convertArray(i,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation),this.validate(),this.optimize()}function qW(t,e,i,n){XW.call(this,t,e,i,n)}function YW(t,e,i,n){UW.call(this,t,e,i,n)}function JW(t,e,i,n){XW.call(this,t,e,i,n)}function KW(t,e,i,n){XW.call(this,t,e,i,n)}function QW(t,e,i,n){XW.call(this,t,e,i,n)}function $W(t,e,i){XW.call(this,t,e,i)}function tj(t,e,i,n){XW.call(this,t,e,i,n)}function ej(t,e,i,n){XW.apply(this,arguments)}function ij(t,e,i){this.name=t,this.tracks=i,this.duration=void 0!==e?e:-1,this.uuid=UB.generateUUID(),this.duration<0&&this.resetDuration(),this.optimize()}function nj(t){this.manager=void 0!==t?t:xW,this.textures={}}function rj(t){this.manager=void 0!==t?t:xW}function oj(){this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){}}function aj(t){"boolean"==typeof t&&(console.warn("THREE.JSONLoader: showStatus parameter has been removed from constructor."),t=void 0),this.manager=void 0!==t?t:xW,this.withCredentials=!1}function sj(t){this.manager=void 0!==t?t:xW,this.texturePath=""}function lj(t,e,i,n,r){var o=.5*(n-e),a=.5*(r-i),s=t*t;return(2*i-2*n+o+a)*(t*s)+(-3*i+3*n-2*o-a)*s+o*t+i}function hj(t,e,i,n){return(a=1-t)*a*e+2*(1-(o=t))*o*i+(r=t)*r*n;var r,o,a}function cj(t,e,i,n,r){return(h=1-t)*h*h*e+3*(l=1-(s=t))*l*s*i+3*(1-(a=t))*a*a*n+(o=t)*o*o*r;var o,a,s,l,h}function uj(){}function dj(t,e){this.v1=t,this.v2=e}function pj(){this.curves=[],this.autoClose=!1}function fj(t,e,i,n,r,o,a,s){this.aX=t,this.aY=e,this.xRadius=i,this.yRadius=n,this.aStartAngle=r,this.aEndAngle=o,this.aClockwise=a,this.aRotation=s||0}function gj(t){this.points=void 0===t?[]:t}function mj(t,e,i,n){this.v0=t,this.v1=e,this.v2=i,this.v3=n}function vj(t,e,i){this.v0=t,this.v1=e,this.v2=i}UW.prototype={constructor:UW,evaluate:function(t){var e=this.parameterPositions,i=this._cachedIndex,n=e[i],r=e[i-1];t:{e:{var o;i:{n:if(!(t<n)){for(var a=i+2;;){if(void 0===n){if(t<r)break n;return i=e.length,this._cachedIndex=i,this.afterEnd_(i-1,t,r)}if(i===a)break;if(r=n,t<(n=e[++i]))break e}o=e.length;break i}if(r<=t)break t;var s=e[1];t<s&&(i=2,r=s);for(a=i-2;;){if(void 0===r)return this._cachedIndex=0,this.beforeStart_(0,t,n);if(i===a)break;if(n=r,(r=e[--i-1])<=t)break e}o=i,i=0}for(;i<o;){var l=i+o>>>1;t<e[l]?o=l:i=l+1}if(n=e[i],void 0===(r=e[i-1]))return this._cachedIndex=0,this.beforeStart_(0,t,n);if(void 0===n)return i=e.length,this._cachedIndex=i,this.afterEnd_(i-1,r,t)}this._cachedIndex=i,this.intervalChanged_(i,r,n)}return this.interpolate_(i,r,t,n)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(t){for(var e=this.resultBuffer,i=this.sampleValues,n=this.valueSize,r=t*n,o=0;o!==n;++o)e[o]=i[r+o];return e},interpolate_:function(t,e,i,n){throw new Error("call to abstract method")},intervalChanged_:function(t,e,i){}},Object.assign(UW.prototype,{beforeStart_:UW.prototype.copySampleValue_,afterEnd_:UW.prototype.copySampleValue_}),WW.prototype=Object.assign(Object.create(UW.prototype),{constructor:WW,DefaultSettings_:{endingStart:LB,endingEnd:LB},intervalChanged_:function(t,e,i){var n=this.parameterPositions,r=t-2,o=t+1,a=n[r],s=n[o];if(void 0===a)switch(this.getSettings_().endingStart){case IB:r=t,a=2*e-i;break;case RB:a=e+n[r=n.length-2]-n[r+1];break;default:r=t,a=i}if(void 0===s)switch(this.getSettings_().endingEnd){case IB:o=t,s=2*i-e;break;case RB:s=i+n[o=1]-n[0];break;default:o=t-1,s=e}var l=.5*(i-e),h=this.valueSize;this._weightPrev=l/(e-a),this._weightNext=l/(s-i),this._offsetPrev=r*h,this._offsetNext=o*h},interpolate_:function(t,e,i,n){for(var r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=t*a,l=s-a,h=this._offsetPrev,c=this._offsetNext,u=this._weightPrev,d=this._weightNext,p=(i-e)/(n-e),f=p*p,g=f*p,m=-u*g+2*u*f-u*p,v=(1+u)*g+(-1.5-2*u)*f+(-.5+u)*p+1,y=(-1-d)*g+(1.5+d)*f+.5*p,_=d*g-d*f,x=0;x!==a;++x)r[x]=m*o[h+x]+v*o[l+x]+y*o[s+x]+_*o[c+x];return r}}),jW.prototype=Object.assign(Object.create(UW.prototype),{constructor:jW,interpolate_:function(t,e,i,n){for(var r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=t*a,l=s-a,h=(i-e)/(n-e),c=1-h,u=0;u!==a;++u)r[u]=o[l+u]*c+o[s+u]*h;return r}}),ZW.prototype=Object.assign(Object.create(UW.prototype),{constructor:ZW,interpolate_:function(t,e,i,n){return this.copySampleValue_(t-1)}}),zW={TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:PB,InterpolantFactoryMethodDiscrete:function(t){return new ZW(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodLinear:function(t){return new jW(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:function(t){return new WW(this.times,this.values,this.getValueSize(),t)},setInterpolation:function(t){var e;switch(t){case EB:e=this.InterpolantFactoryMethodDiscrete;break;case PB:e=this.InterpolantFactoryMethodLinear;break;case 2302:e=this.InterpolantFactoryMethodSmooth}if(void 0!==e)this.createInterpolant=e;else{var i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(i);this.setInterpolation(this.DefaultInterpolation)}console.warn(i)}},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return EB;case this.InterpolantFactoryMethodLinear:return PB;case this.InterpolantFactoryMethodSmooth:return 2302}},getValueSize:function(){return this.values.length/this.times.length},shift:function(t){if(0!==t)for(var e=this.times,i=0,n=e.length;i!==n;++i)e[i]+=t;return this},scale:function(t){if(1!==t)for(var e=this.times,i=0,n=e.length;i!==n;++i)e[i]*=t;return this},trim:function(t,e){for(var i=this.times,n=i.length,r=0,o=n-1;r!==n&&i[r]<t;)++r;for(;-1!==o&&i[o]>e;)--o;if(++o,0!==r||o!==n){o<=r&&(r=(o=Math.max(o,1))-1);var a=this.getValueSize();this.times=HW.arraySlice(i,r,o),this.values=HW.arraySlice(this.values,r*a,o*a)}return this},validate:function(){var t=!0,e=this.getValueSize();e-Math.floor(e)!=0&&(console.error("invalid value size in track",this),t=!1);var i=this.times,n=this.values,r=i.length;0===r&&(console.error("track is empty",this),t=!1);for(var o=null,a=0;a!==r;a++){var s=i[a];if("number"==typeof s&&isNaN(s)){console.error("time is not a valid number",this,a,s),t=!1;break}if(null!==o&&s<o){console.error("out of order keys",this,a,s,o),t=!1;break}o=s}if(void 0!==n&&HW.isTypedArray(n)){a=0;for(var l=n.length;a!==l;++a){var h=n[a];if(isNaN(h)){console.error("value is not a valid number",this,a,h),t=!1;break}}}return t},optimize:function(){for(var t=this.times,e=this.values,i=this.getValueSize(),n=2302===this.getInterpolation(),r=1,o=t.length-1,a=1;a<o;++a){var s=!1,l=t[a];if(l!==t[a+1]&&(1!==a||l!==l[0]))if(n)s=!0;else for(var h=a*i,c=h-i,u=h+i,d=0;d!==i;++d){var p=e[h+d];if(p!==e[c+d]||p!==e[u+d]){s=!0;break}}if(s){if(a!==r){t[r]=t[a];var f=a*i,g=r*i;for(d=0;d!==i;++d)e[g+d]=e[f+d]}++r}}if(0<o){t[r]=t[o];for(f=o*i,g=r*i,d=0;d!==i;++d)e[g+d]=e[f+d];++r}return r!==t.length&&(this.times=HW.arraySlice(t,0,r),this.values=HW.arraySlice(e,0,r*i)),this}},qW.prototype=Object.assign(Object.create(zW),{constructor:qW,ValueTypeName:"vector"}),YW.prototype=Object.assign(Object.create(UW.prototype),{constructor:YW,interpolate_:function(t,e,i,n){for(var r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=t*a,l=(i-e)/(n-e),h=s+a;s!==h;s+=4)gF.slerpFlat(r,0,o,s-a,o,s,l);return r}}),JW.prototype=Object.assign(Object.create(zW),{constructor:JW,ValueTypeName:"quaternion",DefaultInterpolation:PB,InterpolantFactoryMethodLinear:function(t){return new YW(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:void 0}),KW.prototype=Object.assign(Object.create(zW),{constructor:KW,ValueTypeName:"number"}),QW.prototype=Object.assign(Object.create(zW),{constructor:QW,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:EB,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),$W.prototype=Object.assign(Object.create(zW),{constructor:$W,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:EB,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),tj.prototype=Object.assign(Object.create(zW),{constructor:tj,ValueTypeName:"color"}),(ej.prototype=zW).constructor=ej,Object.assign(ej,{parse:function(t){if(void 0===t.type)throw new Error("track type undefined, can not parse");var e=ej._getTrackTypeForValueTypeName(t.type);if(void 0===t.times){var i=[],n=[];HW.flattenJSON(t.keys,i,n,"value"),t.times=i,t.values=n}return void 0!==e.parse?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)},toJSON:function(t){var e,i=t.constructor;if(void 0!==i.toJSON)e=i.toJSON(t);else{e={name:t.name,times:HW.convertArray(t.times,Array),values:HW.convertArray(t.values,Array)};var n=t.getInterpolation();n!==t.DefaultInterpolation&&(e.interpolation=n)}return e.type=t.ValueTypeName,e},_getTrackTypeForValueTypeName:function(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return KW;case"vector":case"vector2":case"vector3":case"vector4":return qW;case"color":return tj;case"quaternion":return JW;case"bool":case"boolean":return $W;case"string":return QW}throw new Error("Unsupported typeName: "+t)}}),ij.prototype={constructor:ij,resetDuration:function(){for(var t=0,e=0,i=this.tracks.length;e!==i;++e){var n=this.tracks[e];t=Math.max(t,n.times[n.times.length-1])}this.duration=t},trim:function(){for(var t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this},optimize:function(){for(var t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this}},Object.assign(ij,{parse:function(t){for(var e=[],i=t.tracks,n=1/(t.fps||1),r=0,o=i.length;r!==o;++r)e.push(ej.parse(i[r]).scale(n));return new ij(t.name,t.duration,e)},toJSON:function(t){for(var e=[],i=t.tracks,n={name:t.name,duration:t.duration,tracks:e},r=0,o=i.length;r!==o;++r)e.push(ej.toJSON(i[r]));return n},CreateFromMorphTargetSequence:function(t,e,i,n){for(var r=e.length,o=[],a=0;a<r;a++){var s=[],l=[];s.push((a+r-1)%r,a,(a+1)%r),l.push(0,1,0);var h=HW.getKeyframeOrder(s);s=HW.sortedArray(s,1,h),l=HW.sortedArray(l,1,h),n||0!==s[0]||(s.push(r),l.push(l[0])),o.push(new KW(".morphTargetInfluences["+e[a].name+"]",s,l).scale(1/i))}return new ij(t,-1,o)},findByName:function(t,e){var i=t;if(!Array.isArray(t)){var n=t;i=n.geometry&&n.geometry.animations||n.animations}for(var r=0;r<i.length;r++)if(i[r].name===e)return i[r];return null},CreateClipsFromMorphTargetSequences:function(t,e,i){for(var n={},r=/^([\w-]*?)([\d]+)$/,o=0,a=t.length;o<a;o++){var s=t[o],l=s.name.match(r);if(l&&1<l.length){var h=n[u=l[1]];h||(n[u]=h=[]),h.push(s)}}var c=[];for(var u in n)c.push(ij.CreateFromMorphTargetSequence(u,n[u],e,i));return c},parseAnimation:function(t,e){if(!t)return console.error("  no animation in JSONLoader data"),null;for(var i=function(t,e,i,n,r){if(0!==i.length){var o=[],a=[];HW.flattenJSON(i,o,a,n),0!==o.length&&r.push(new t(e,o,a))}},n=[],r=t.name||"default",o=t.length||-1,a=t.fps||30,s=t.hierarchy||[],l=0;l<s.length;l++){var h=s[l].keys;if(h&&0!==h.length)if(h[0].morphTargets){for(var c={},u=0;u<h.length;u++)if(h[u].morphTargets)for(var d=0;d<h[u].morphTargets.length;d++)c[h[u].morphTargets[d]]=-1;for(var p in c){var f=[],g=[];for(d=0;d!==h[u].morphTargets.length;++d){var m=h[u];f.push(m.time),g.push(m.morphTarget===p?1:0)}n.push(new KW(".morphTargetInfluence["+p+"]",f,g))}o=c.length*(a||1)}else{var v=".bones["+e[l].name+"]";i(qW,v+".position",h,"pos",n),i(JW,v+".quaternion",h,"rot",n),i(qW,v+".scale",h,"scl",n)}}return 0===n.length?null:new ij(r,o,n)}}),Object.assign(nj.prototype,{load:function(t,e,i,n){var r=this;new wW(r.manager).load(t,function(t){e(r.parse(JSON.parse(t)))},i,n)},setTextures:function(t){this.textures=t},parse:function(t){var e=this.textures;function i(t){return void 0===e[t]&&console.warn("THREE.MaterialLoader: Undefined texture",t),e[t]}var n=new vW[t.type];if(void 0!==t.uuid&&(n.uuid=t.uuid),void 0!==t.name&&(n.name=t.name),void 0!==t.color&&n.color.setHex(t.color),void 0!==t.roughness&&(n.roughness=t.roughness),void 0!==t.metalness&&(n.metalness=t.metalness),void 0!==t.emissive&&n.emissive.setHex(t.emissive),void 0!==t.specular&&n.specular.setHex(t.specular),void 0!==t.shininess&&(n.shininess=t.shininess),void 0!==t.clearCoat&&(n.clearCoat=t.clearCoat),void 0!==t.clearCoatRoughness&&(n.clearCoatRoughness=t.clearCoatRoughness),void 0!==t.uniforms&&(n.uniforms=t.uniforms),void 0!==t.vertexShader&&(n.vertexShader=t.vertexShader),void 0!==t.fragmentShader&&(n.fragmentShader=t.fragmentShader),void 0!==t.vertexColors&&(n.vertexColors=t.vertexColors),void 0!==t.fog&&(n.fog=t.fog),void 0!==t.shading&&(n.shading=t.shading),void 0!==t.blending&&(n.blending=t.blending),void 0!==t.side&&(n.side=t.side),void 0!==t.opacity&&(n.opacity=t.opacity),void 0!==t.transparent&&(n.transparent=t.transparent),void 0!==t.alphaTest&&(n.alphaTest=t.alphaTest),void 0!==t.depthTest&&(n.depthTest=t.depthTest),void 0!==t.depthWrite&&(n.depthWrite=t.depthWrite),void 0!==t.colorWrite&&(n.colorWrite=t.colorWrite),void 0!==t.wireframe&&(n.wireframe=t.wireframe),void 0!==t.wireframeLinewidth&&(n.wireframeLinewidth=t.wireframeLinewidth),void 0!==t.wireframeLinecap&&(n.wireframeLinecap=t.wireframeLinecap),void 0!==t.wireframeLinejoin&&(n.wireframeLinejoin=t.wireframeLinejoin),void 0!==t.skinning&&(n.skinning=t.skinning),void 0!==t.morphTargets&&(n.morphTargets=t.morphTargets),void 0!==t.size&&(n.size=t.size),void 0!==t.sizeAttenuation&&(n.sizeAttenuation=t.sizeAttenuation),void 0!==t.map&&(n.map=i(t.map)),void 0!==t.alphaMap&&(n.alphaMap=i(t.alphaMap),n.transparent=!0),void 0!==t.bumpMap&&(n.bumpMap=i(t.bumpMap)),void 0!==t.bumpScale&&(n.bumpScale=t.bumpScale),void 0!==t.normalMap&&(n.normalMap=i(t.normalMap)),void 0!==t.normalScale){var r=t.normalScale;!1===Array.isArray(r)&&(r=[r,r]),n.normalScale=(new WB).fromArray(r)}if(void 0!==t.displacementMap&&(n.displacementMap=i(t.displacementMap)),void 0!==t.displacementScale&&(n.displacementScale=t.displacementScale),void 0!==t.displacementBias&&(n.displacementBias=t.displacementBias),void 0!==t.roughnessMap&&(n.roughnessMap=i(t.roughnessMap)),void 0!==t.metalnessMap&&(n.metalnessMap=i(t.metalnessMap)),void 0!==t.emissiveMap&&(n.emissiveMap=i(t.emissiveMap)),void 0!==t.emissiveIntensity&&(n.emissiveIntensity=t.emissiveIntensity),void 0!==t.specularMap&&(n.specularMap=i(t.specularMap)),void 0!==t.envMap&&(n.envMap=i(t.envMap)),void 0!==t.reflectivity&&(n.reflectivity=t.reflectivity),void 0!==t.lightMap&&(n.lightMap=i(t.lightMap)),void 0!==t.lightMapIntensity&&(n.lightMapIntensity=t.lightMapIntensity),void 0!==t.aoMap&&(n.aoMap=i(t.aoMap)),void 0!==t.aoMapIntensity&&(n.aoMapIntensity=t.aoMapIntensity),void 0!==t.gradientMap&&(n.gradientMap=i(t.gradientMap)),void 0!==t.materials)for(var o=0,a=t.materials.length;o<a;o++)n.materials.push(this.parse(t.materials[o]));return n}}),Object.assign(rj.prototype,{load:function(t,e,i,n){var r=this;new wW(r.manager).load(t,function(t){e(r.parse(JSON.parse(t)))},i,n)},parse:function(t){var e=new gH,i=t.data.index,n={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};if(void 0!==i){var r=new n[i.type](i.array);e.setIndex(new BV(r,1))}var o=t.data.attributes;for(var a in o){var s=o[a];r=new n[s.type](s.array);e.addAttribute(a,new BV(r,s.itemSize,s.normalized))}var l=t.data.groups||t.data.drawcalls||t.data.offsets;if(void 0!==l)for(var h=0,c=l.length;h!==c;++h){var u=l[h];e.addGroup(u.start,u.count,u.materialIndex)}var d=t.data.boundingSphere;if(void 0!==d){var p=new mF;void 0!==d.center&&p.fromArray(d.center),e.boundingSphere=new YG(p,d.radius)}return e}}),oj.prototype={constructor:oj,crossOrigin:void 0,extractUrlBase:function(t){var e=t.split("/");return 1===e.length?"./":(e.pop(),e.join("/")+"/")},initMaterials:function(t,e,i){for(var n=[],r=0;r<t.length;++r)n[r]=this.createMaterial(t[r],e,i);return n},createMaterial:(GW={NoBlending:IN,NormalBlending:RN,AdditiveBlending:DN,SubtractiveBlending:ON,MultiplyBlending:kN,CustomBlending:zN},function(t,h,c){void 0===NW&&(NW=new rG),void 0===BW&&(BW=new CW),void 0===FW&&(FW=new nj);var u={};function e(t,e,i,n,r){var o,a=h+t,s=oj.Handlers.get(a);null!==s?o=s.load(a):(BW.setCrossOrigin(c),o=BW.load(a)),void 0!==e&&(o.repeat.fromArray(e),1!==e[0]&&(o.wrapS=hB),1!==e[1]&&(o.wrapT=hB)),void 0!==i&&o.offset.fromArray(i),void 0!==n&&("repeat"===n[0]&&(o.wrapS=hB),"mirror"===n[0]&&(o.wrapS=uB),"repeat"===n[1]&&(o.wrapT=hB),"mirror"===n[1]&&(o.wrapT=uB)),void 0!==r&&(o.anisotropy=r);var l=UB.generateUUID();return u[l]=o,l}var i={uuid:UB.generateUUID(),type:"MeshLambertMaterial"};for(var n in t){var r=t[n];switch(n){case"DbgColor":case"DbgIndex":case"opticalDensity":case"illumination":break;case"DbgName":i.name=r;break;case"blending":i.blending=GW[r];break;case"colorAmbient":case"mapAmbient":console.warn("THREE.Loader.createMaterial:",n,"is no longer supported.");break;case"colorDiffuse":i.color=NW.fromArray(r).getHex();break;case"colorSpecular":i.specular=NW.fromArray(r).getHex();break;case"colorEmissive":i.emissive=NW.fromArray(r).getHex();break;case"specularCoef":i.shininess=r;break;case"shading":"basic"===r.toLowerCase()&&(i.type="MeshBasicMaterial"),"phong"===r.toLowerCase()&&(i.type="MeshPhongMaterial"),"standard"===r.toLowerCase()&&(i.type="MeshStandardMaterial");break;case"mapDiffuse":i.map=e(r,t.mapDiffuseRepeat,t.mapDiffuseOffset,t.mapDiffuseWrap,t.mapDiffuseAnisotropy);break;case"mapDiffuseRepeat":case"mapDiffuseOffset":case"mapDiffuseWrap":case"mapDiffuseAnisotropy":break;case"mapEmissive":i.emissiveMap=e(r,t.mapEmissiveRepeat,t.mapEmissiveOffset,t.mapEmissiveWrap,t.mapEmissiveAnisotropy);break;case"mapEmissiveRepeat":case"mapEmissiveOffset":case"mapEmissiveWrap":case"mapEmissiveAnisotropy":break;case"mapLight":i.lightMap=e(r,t.mapLightRepeat,t.mapLightOffset,t.mapLightWrap,t.mapLightAnisotropy);break;case"mapLightRepeat":case"mapLightOffset":case"mapLightWrap":case"mapLightAnisotropy":break;case"mapAO":i.aoMap=e(r,t.mapAORepeat,t.mapAOOffset,t.mapAOWrap,t.mapAOAnisotropy);break;case"mapAORepeat":case"mapAOOffset":case"mapAOWrap":case"mapAOAnisotropy":break;case"mapBump":i.bumpMap=e(r,t.mapBumpRepeat,t.mapBumpOffset,t.mapBumpWrap,t.mapBumpAnisotropy);break;case"mapBumpScale":i.bumpScale=r;break;case"mapBumpRepeat":case"mapBumpOffset":case"mapBumpWrap":case"mapBumpAnisotropy":break;case"mapNormal":i.normalMap=e(r,t.mapNormalRepeat,t.mapNormalOffset,t.mapNormalWrap,t.mapNormalAnisotropy);break;case"mapNormalFactor":i.normalScale=[r,r];break;case"mapNormalRepeat":case"mapNormalOffset":case"mapNormalWrap":case"mapNormalAnisotropy":break;case"mapSpecular":i.specularMap=e(r,t.mapSpecularRepeat,t.mapSpecularOffset,t.mapSpecularWrap,t.mapSpecularAnisotropy);break;case"mapSpecularRepeat":case"mapSpecularOffset":case"mapSpecularWrap":case"mapSpecularAnisotropy":break;case"mapMetalness":i.metalnessMap=e(r,t.mapMetalnessRepeat,t.mapMetalnessOffset,t.mapMetalnessWrap,t.mapMetalnessAnisotropy);break;case"mapMetalnessRepeat":case"mapMetalnessOffset":case"mapMetalnessWrap":case"mapMetalnessAnisotropy":break;case"mapRoughness":i.roughnessMap=e(r,t.mapRoughnessRepeat,t.mapRoughnessOffset,t.mapRoughnessWrap,t.mapRoughnessAnisotropy);break;case"mapRoughnessRepeat":case"mapRoughnessOffset":case"mapRoughnessWrap":case"mapRoughnessAnisotropy":break;case"mapAlpha":i.alphaMap=e(r,t.mapAlphaRepeat,t.mapAlphaOffset,t.mapAlphaWrap,t.mapAlphaAnisotropy);break;case"mapAlphaRepeat":case"mapAlphaOffset":case"mapAlphaWrap":case"mapAlphaAnisotropy":break;case"flipSided":i.side=CN;break;case"doubleSided":i.side=AN;break;case"transparency":console.warn("THREE.Loader.createMaterial: transparency has been renamed to opacity"),i.opacity=r;break;case"depthTest":case"depthWrite":case"colorWrite":case"opacity":case"reflectivity":case"transparent":case"visible":case"wireframe":i[n]=r;break;case"vertexColors":!0===r&&(i.vertexColors=2),"face"===r&&(i.vertexColors=1);break;default:console.error("THREE.Loader.createMaterial: Unsupported",n,r)}}return"MeshBasicMaterial"===i.type&&delete i.emissive,"MeshPhongMaterial"!==i.type&&delete i.specular,i.opacity<1&&(i.transparent=!0),FW.setTextures(u),FW.parse(i)})},oj.Handlers={handlers:[],add:function(t,e){this.handlers.push(t,e)},get:function(t){for(var e=this.handlers,i=0,n=e.length;i<n;i+=2){var r=e[i],o=e[i+1];if(r.test(t))return o}return null}},Object.assign(aj.prototype,{load:function(o,a,t,e){var s=this,l=this.texturePath&&"string"==typeof this.texturePath?this.texturePath:oj.prototype.extractUrlBase(o),i=new wW(this.manager);i.setWithCredentials(this.withCredentials),i.load(o,function(t){var e=JSON.parse(t),i=e.metadata;if(void 0!==i){var n=i.type;if(void 0!==n){if("object"===n.toLowerCase())return void console.error("THREE.JSONLoader: "+o+" should be loaded with THREE.ObjectLoader instead.");if("scene"===n.toLowerCase())return void console.error("THREE.JSONLoader: "+o+" should be loaded with THREE.SceneLoader instead.")}}var r=s.parse(e,l);a(r.geometry,r.materials)},t,e)},setTexturePath:function(t){this.texturePath=t},parse:function(O,t){var k=new fH,e=void 0!==O.scale?1/O.scale:1;if(function(t){function e(t,e){return t&1<<e}var i,n,r,o,a,s,l,h,c,u,d,p,f,g,m,v,y,_,x,w,b,M,S,T,C,A,E,P=O.faces,L=O.vertices,I=O.normals,R=O.colors,D=0;if(void 0!==O.uvs){for(i=0;i<O.uvs.length;i++)O.uvs[i].length&&D++;for(i=0;i<D;i++)k.faceVertexUvs[i]=[]}o=0,a=L.length;for(;o<a;)(_=new mF).x=L[o++]*t,_.y=L[o++]*t,_.z=L[o++]*t,k.vertices.push(_);o=0,a=P.length;for(;o<a;)if(u=P[o++],d=e(u,0),p=e(u,1),f=e(u,3),g=e(u,4),m=e(u,5),v=e(u,6),y=e(u,7),d){if((w=new zV).a=P[o],w.b=P[o+1],w.c=P[o+3],(b=new zV).a=P[o+1],b.b=P[o+2],b.c=P[o+3],o+=4,p&&(c=P[o++],w.materialIndex=c,b.materialIndex=c),r=k.faces.length,f)for(i=0;i<D;i++)for(T=O.uvs[i],k.faceVertexUvs[i][r]=[],k.faceVertexUvs[i][r+1]=[],n=0;n<4;n++)h=P[o++],A=T[2*h],E=T[2*h+1],C=new WB(A,E),2!==n&&k.faceVertexUvs[i][r].push(C),0!==n&&k.faceVertexUvs[i][r+1].push(C);if(g&&(l=3*P[o++],w.normal.set(I[l++],I[l++],I[l]),b.normal.copy(w.normal)),m)for(i=0;i<4;i++)l=3*P[o++],S=new mF(I[l++],I[l++],I[l]),2!==i&&w.vertexNormals.push(S),0!==i&&b.vertexNormals.push(S);if(v&&(s=P[o++],M=R[s],w.color.setHex(M),b.color.setHex(M)),y)for(i=0;i<4;i++)s=P[o++],M=R[s],2!==i&&w.vertexColors.push(new rG(M)),0!==i&&b.vertexColors.push(new rG(M));k.faces.push(w),k.faces.push(b)}else{if((x=new zV).a=P[o++],x.b=P[o++],x.c=P[o++],p&&(c=P[o++],x.materialIndex=c),r=k.faces.length,f)for(i=0;i<D;i++)for(T=O.uvs[i],k.faceVertexUvs[i][r]=[],n=0;n<3;n++)h=P[o++],A=T[2*h],E=T[2*h+1],C=new WB(A,E),k.faceVertexUvs[i][r].push(C);if(g&&(l=3*P[o++],x.normal.set(I[l++],I[l++],I[l])),m)for(i=0;i<3;i++)l=3*P[o++],S=new mF(I[l++],I[l++],I[l]),x.vertexNormals.push(S);if(v&&(s=P[o++],x.color.setHex(R[s])),y)for(i=0;i<3;i++)s=P[o++],x.vertexColors.push(new rG(R[s]));k.faces.push(x)}}(e),function(){var t=void 0!==O.influencesPerVertex?O.influencesPerVertex:2;if(O.skinWeights)for(var e=0,i=O.skinWeights.length;e<i;e+=t){var n=O.skinWeights[e],r=1<t?O.skinWeights[e+1]:0,o=2<t?O.skinWeights[e+2]:0,a=3<t?O.skinWeights[e+3]:0;k.skinWeights.push(new dF(n,r,o,a))}if(O.skinIndices)for(var e=0,i=O.skinIndices.length;e<i;e+=t){var s=O.skinIndices[e],l=1<t?O.skinIndices[e+1]:0,h=2<t?O.skinIndices[e+2]:0,c=3<t?O.skinIndices[e+3]:0;k.skinIndices.push(new dF(s,l,h,c))}k.bones=O.bones,k.bones&&0<k.bones.length&&(k.skinWeights.length!==k.skinIndices.length||k.skinIndices.length!==k.vertices.length)&&console.warn("When skinning, number of vertices ("+k.vertices.length+"), skinIndices ("+k.skinIndices.length+"), and skinWeights ("+k.skinWeights.length+") should match.")}(),function(t){if(void 0!==O.morphTargets)for(var e=0,i=O.morphTargets.length;e<i;e++){k.morphTargets[e]={},k.morphTargets[e].name=O.morphTargets[e].name,k.morphTargets[e].vertices=[];for(var n=k.morphTargets[e].vertices,r=O.morphTargets[e].vertices,o=0,a=r.length;o<a;o+=3){var s=new mF;s.x=r[o]*t,s.y=r[o+1]*t,s.z=r[o+2]*t,n.push(s)}}if(void 0!==O.morphColors&&0<O.morphColors.length){console.warn('THREE.JSONLoader: "morphColors" no longer supported. Using them as face colors.');for(var l=k.faces,h=O.morphColors[0].colors,e=0,i=l.length;e<i;e++)l[e].color.fromArray(h,3*e)}}(e),function(){var t=[],e=[];void 0!==O.animation&&e.push(O.animation);void 0!==O.animations&&(O.animations.length?e=e.concat(O.animations):e.push(O.animations));for(var i=0;i<e.length;i++){var n=ij.parseAnimation(e[i],k.bones);n&&t.push(n)}if(k.morphTargets){var r=ij.CreateClipsFromMorphTargetSequences(k.morphTargets,10);t=t.concat(r)}0<t.length&&(k.animations=t)}(),k.computeFaceNormals(),k.computeBoundingSphere(),void 0===O.materials||0===O.materials.length)return{geometry:k};var i=oj.prototype.initMaterials(O.materials,t,this.crossOrigin);return{geometry:k,materials:i}}}),Object.assign(sj.prototype,{load:function(n,r,t,o){""===this.texturePath&&(this.texturePath=n.substring(0,n.lastIndexOf("/")+1));var a=this;new wW(a.manager).load(n,function(t){var e=null;try{e=JSON.parse(t)}catch(t){return void 0!==o&&o(t),void console.error("THREE:ObjectLoader: Can't parse "+n+".",t.message)}var i=e.metadata;void 0!==i&&void 0!==i.type&&"geometry"!==i.type.toLowerCase()?a.parse(e,r):console.error("THREE.ObjectLoader: Can't load "+n+". Use THREE.JSONLoader instead.")},t,o)},setTexturePath:function(t){this.texturePath=t},setCrossOrigin:function(t){this.crossOrigin=t},parse:function(t,e){var i=this.parseGeometries(t.geometries),n=this.parseImages(t.images,function(){void 0!==e&&e(a)}),r=this.parseTextures(t.textures,n),o=this.parseMaterials(t.materials,r),a=this.parseObject(t.object,i,o);return t.animations&&(a.animations=this.parseAnimations(t.animations)),void 0!==t.images&&0!==t.images.length||void 0!==e&&e(a),a},parseGeometries:function(t){var e={};if(void 0!==t)for(var i=new aj,n=new rj,r=0,o=t.length;r<o;r++){var a,s=t[r];switch(s.type){case"PlaneGeometry":case"PlaneBufferGeometry":a=new aW[s.type](s.width,s.height,s.widthSegments,s.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":a=new aW[s.type](s.width,s.height,s.depth,s.widthSegments,s.heightSegments,s.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":a=new aW[s.type](s.radius,s.segments,s.thetaStart,s.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":a=new aW[s.type](s.radiusTop,s.radiusBottom,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":a=new aW[s.type](s.radius,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":a=new aW[s.type](s.radius,s.widthSegments,s.heightSegments,s.phiStart,s.phiLength,s.thetaStart,s.thetaLength);break;case"DodecahedronGeometry":case"IcosahedronGeometry":case"OctahedronGeometry":case"TetrahedronGeometry":a=new aW[s.type](s.radius,s.detail);break;case"RingGeometry":case"RingBufferGeometry":a=new aW[s.type](s.innerRadius,s.outerRadius,s.thetaSegments,s.phiSegments,s.thetaStart,s.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":a=new aW[s.type](s.radius,s.tube,s.radialSegments,s.tubularSegments,s.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":a=new aW[s.type](s.radius,s.tube,s.tubularSegments,s.radialSegments,s.p,s.q);break;case"LatheGeometry":case"LatheBufferGeometry":a=new aW[s.type](s.points,s.segments,s.phiStart,s.phiLength);break;case"BufferGeometry":a=n.parse(s);break;case"Geometry":a=i.parse(s.data,this.texturePath).geometry;break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+s.type+'"');continue}a.uuid=s.uuid,void 0!==s.name&&(a.name=s.name),e[s.uuid]=a}return e},parseMaterials:function(t,e){var i={};if(void 0!==t){var n=new nj;n.setTextures(e);for(var r=0,o=t.length;r<o;r++){var a=n.parse(t[r]);i[a.uuid]=a}}return i},parseAnimations:function(t){for(var e=[],i=0;i<t.length;i++){var n=ij.parse(t[i]);e.push(n)}return e},parseImages:function(t,e){var i=this,n={};function r(t){return i.manager.itemStart(t),o.load(t,function(){i.manager.itemEnd(t)},void 0,function(){i.manager.itemError(t)})}if(void 0!==t&&0<t.length){var o=new SW(new _W(e));o.setCrossOrigin(this.crossOrigin);for(var a=0,s=t.length;a<s;a++){var l=t[a],h=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(l.url)?l.url:i.texturePath+l.url;n[l.uuid]=r(h)}}return n},parseTextures:function(t,e){var i={UVMapping:300,CubeReflectionMapping:iB,CubeRefractionMapping:nB,EquirectangularReflectionMapping:rB,EquirectangularRefractionMapping:oB,SphericalReflectionMapping:aB,CubeUVReflectionMapping:sB,CubeUVRefractionMapping:lB},n={RepeatWrapping:hB,ClampToEdgeWrapping:cB,MirroredRepeatWrapping:uB},r={NearestFilter:dB,NearestMipMapNearestFilter:pB,NearestMipMapLinearFilter:fB,LinearFilter:gB,LinearMipMapNearestFilter:1007,LinearMipMapLinearFilter:mB};function o(t,e){return"number"==typeof t?t:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",t),e[t])}var a={};if(void 0!==t)for(var s=0,l=t.length;s<l;s++){var h=t[s];void 0===h.image&&console.warn('THREE.ObjectLoader: No "image" specified for',h.uuid),void 0===e[h.image]&&console.warn("THREE.ObjectLoader: Undefined image",h.image);var c=new uF(e[h.image]);c.needsUpdate=!0,c.uuid=h.uuid,void 0!==h.name&&(c.name=h.name),void 0!==h.mapping&&(c.mapping=o(h.mapping,i)),void 0!==h.offset&&c.offset.fromArray(h.offset),void 0!==h.repeat&&c.repeat.fromArray(h.repeat),void 0!==h.wrap&&(c.wrapS=o(h.wrap[0],n),c.wrapT=o(h.wrap[1],n)),void 0!==h.minFilter&&(c.minFilter=o(h.minFilter,r)),void 0!==h.magFilter&&(c.magFilter=o(h.magFilter,r)),void 0!==h.anisotropy&&(c.anisotropy=h.anisotropy),void 0!==h.flipY&&(c.flipY=h.flipY),a[h.uuid]=c}return a},parseObject:(VW=new vF,function(t,e,i){var n;function r(t){return void 0===e[t]&&console.warn("THREE.ObjectLoader: Undefined geometry",t),e[t]}function o(t){if(void 0!==t)return void 0===i[t]&&console.warn("THREE.ObjectLoader: Undefined material",t),i[t]}switch(t.type){case"Scene":n=new oU,void 0!==t.background&&Number.isInteger(t.background)&&(n.background=new rG(t.background)),void 0!==t.fog&&("Fog"===t.fog.type?n.fog=new rU(t.fog.color,t.fog.near,t.fog.far):"FogExp2"===t.fog.type&&(n.fog=new nU(t.fog.color,t.fog.density)));break;case"PerspectiveCamera":n=new bH(t.fov,t.aspect,t.near,t.far),void 0!==t.focus&&(n.focus=t.focus),void 0!==t.zoom&&(n.zoom=t.zoom),void 0!==t.filmGauge&&(n.filmGauge=t.filmGauge),void 0!==t.filmOffset&&(n.filmOffset=t.filmOffset),void 0!==t.view&&(n.view=Object.assign({},t.view));break;case"OrthographicCamera":n=new MH(t.left,t.right,t.top,t.bottom,t.near,t.far);break;case"AmbientLight":n=new kW(t.color,t.intensity);break;case"DirectionalLight":n=new OW(t.color,t.intensity);break;case"PointLight":n=new RW(t.color,t.intensity,t.distance,t.decay);break;case"SpotLight":n=new IW(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay);break;case"HemisphereLight":n=new EW(t.color,t.groundColor,t.intensity);break;case"Mesh":var a=r(t.geometry),s=o(t.material);n=a.bones&&0<a.bones.length?new dU(a,s):new mH(a,s);break;case"LOD":n=new hU;break;case"Line":n=new fU(r(t.geometry),o(t.material),t.mode);break;case"LineSegments":n=new gU(r(t.geometry),o(t.material));break;case"PointCloud":case"Points":n=new vU(r(t.geometry),o(t.material));break;case"Sprite":n=new lU(o(t.material));break;case"Group":n=new yU;break;case"SkinnedMesh":console.warn("THREE.ObjectLoader.parseObject() does not support SkinnedMesh type. Instantiates Object3D instead.");default:n=new DV}if(n.uuid=t.uuid,void 0!==t.name&&(n.name=t.name),void 0!==t.matrix?(VW.fromArray(t.matrix),VW.decompose(n.position,n.quaternion,n.scale)):(void 0!==t.position&&n.position.fromArray(t.position),void 0!==t.rotation&&n.rotation.fromArray(t.rotation),void 0!==t.quaternion&&n.quaternion.fromArray(t.quaternion),void 0!==t.scale&&n.scale.fromArray(t.scale)),void 0!==t.castShadow&&(n.castShadow=t.castShadow),void 0!==t.receiveShadow&&(n.receiveShadow=t.receiveShadow),t.shadow&&(void 0!==t.shadow.bias&&(n.shadow.bias=t.shadow.bias),void 0!==t.shadow.radius&&(n.shadow.radius=t.shadow.radius),void 0!==t.shadow.mapSize&&n.shadow.mapSize.fromArray(t.shadow.mapSize),void 0!==t.shadow.camera&&(n.shadow.camera=this.parseObject(t.shadow.camera))),void 0!==t.visible&&(n.visible=t.visible),void 0!==t.userData&&(n.userData=t.userData),void 0!==t.children)for(var l in t.children)n.add(this.parseObject(t.children[l],e,i));if("LOD"===t.type)for(var h=t.levels,c=0;c<h.length;c++){var u=h[c];void 0!==(l=n.getObjectByProperty("uuid",u.object))&&n.addLevel(l,u.distance)}return n})}),uj.prototype={constructor:uj,getPoint:function(t){return console.warn("THREE.Curve: Warning, getPoint() not implemented!"),null},getPointAt:function(t){var e=this.getUtoTmapping(t);return this.getPoint(e)},getPoints:function(t){isNaN(t)&&(t=5);for(var e=[],i=0;i<=t;i++)e.push(this.getPoint(i/t));return e},getSpacedPoints:function(t){isNaN(t)&&(t=5);for(var e=[],i=0;i<=t;i++)e.push(this.getPointAt(i/t));return e},getLength:function(){var t=this.getLengths();return t[t.length-1]},getLengths:function(t){if(isNaN(t)&&(t=this.__arcLengthDivisions?this.__arcLengthDivisions:200),this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var e,i,n=[],r=this.getPoint(0),o=0;for(n.push(0),i=1;i<=t;i++)o+=(e=this.getPoint(i/t)).distanceTo(r),n.push(o),r=e;return this.cacheArcLengths=n},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(t,e){var i,n=this.getLengths(),r=0,o=n.length;i=e||t*n[o-1];for(var a,s=0,l=o-1;s<=l;)if((a=n[r=Math.floor(s+(l-s)/2)]-i)<0)s=r+1;else{if(!(0<a)){l=r;break}l=r-1}if(n[r=l]===i)return r/(o-1);var h=n[r];return(r+(i-h)/(n[r+1]-h))/(o-1)},getTangent:function(t){var e=t-1e-4,i=t+1e-4;e<0&&(e=0),1<i&&(i=1);var n=this.getPoint(e);return this.getPoint(i).clone().sub(n).normalize()},getTangentAt:function(t){var e=this.getUtoTmapping(t);return this.getTangent(e)},computeFrenetFrames:function(t,e){var i,n,r,o=new mF,a=[],s=[],l=[],h=new mF,c=new vF;for(i=0;i<=t;i++)n=i/t,a[i]=this.getTangentAt(n),a[i].normalize();s[0]=new mF,l[0]=new mF;var u=Number.MAX_VALUE,d=Math.abs(a[0].x),p=Math.abs(a[0].y),f=Math.abs(a[0].z);for(d<=u&&(u=d,o.set(1,0,0)),p<=u&&(u=p,o.set(0,1,0)),f<=u&&o.set(0,0,1),h.crossVectors(a[0],o).normalize(),s[0].crossVectors(a[0],h),l[0].crossVectors(a[0],s[0]),i=1;i<=t;i++)s[i]=s[i-1].clone(),l[i]=l[i-1].clone(),h.crossVectors(a[i-1],a[i]),h.length()>Number.EPSILON&&(h.normalize(),r=Math.acos(UB.clamp(a[i-1].dot(a[i]),-1,1)),s[i].applyMatrix4(c.makeRotationAxis(h,r))),l[i].crossVectors(a[i],s[i]);if(!0===e)for(r=Math.acos(UB.clamp(s[0].dot(s[t]),-1,1)),r/=t,0<a[0].dot(h.crossVectors(s[0],s[t]))&&(r=-r),i=1;i<=t;i++)s[i].applyMatrix4(c.makeRotationAxis(a[i],r*i)),l[i].crossVectors(a[i],s[i]);return{tangents:a,normals:s,binormals:l}}},((dj.prototype=Object.create(uj.prototype)).constructor=dj).prototype.isLineCurve=!0,dj.prototype.getPoint=function(t){if(1===t)return this.v2.clone();var e=this.v2.clone().sub(this.v1);return e.multiplyScalar(t).add(this.v1),e},dj.prototype.getPointAt=function(t){return this.getPoint(t)},dj.prototype.getTangent=function(t){return this.v2.clone().sub(this.v1).normalize()},pj.prototype=Object.assign(Object.create(uj.prototype),{constructor:pj,add:function(t){this.curves.push(t)},closePath:function(){var t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.curves.push(new dj(e,t))},getPoint:function(t){for(var e=t*this.getLength(),i=this.getCurveLengths(),n=0;n<i.length;){if(i[n]>=e){var r=i[n]-e,o=this.curves[n],a=o.getLength(),s=0===a?0:1-r/a;return o.getPointAt(s)}n++}return null},getLength:function(){var t=this.getCurveLengths();return t[t.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var t=[],e=0,i=0,n=this.curves.length;i<n;i++)e+=this.curves[i].getLength(),t.push(e);return this.cacheLengths=t},getSpacedPoints:function(t){isNaN(t)&&(t=40);for(var e=[],i=0;i<=t;i++)e.push(this.getPoint(i/t));return this.autoClose&&e.push(e[0]),e},getPoints:function(t){t=t||12;for(var e,i=[],n=0,r=this.curves;n<r.length;n++)for(var o=r[n],a=o&&o.isEllipseCurve?2*t:o&&o.isLineCurve?1:o&&o.isSplineCurve?t*o.points.length:t,s=o.getPoints(a),l=0;l<s.length;l++){var h=s[l];e&&e.equals(h)||(i.push(h),e=h)}return this.autoClose&&1<i.length&&!i[i.length-1].equals(i[0])&&i.push(i[0]),i},createPointsGeometry:function(t){var e=this.getPoints(t);return this.createGeometry(e)},createSpacedPointsGeometry:function(t){var e=this.getSpacedPoints(t);return this.createGeometry(e)},createGeometry:function(t){for(var e=new fH,i=0,n=t.length;i<n;i++){var r=t[i];e.vertices.push(new mF(r.x,r.y,r.z||0))}return e}}),((fj.prototype=Object.create(uj.prototype)).constructor=fj).prototype.isEllipseCurve=!0,fj.prototype.getPoint=function(t){for(var e=2*Math.PI,i=this.aEndAngle-this.aStartAngle,n=Math.abs(i)<Number.EPSILON;i<0;)i+=e;for(;e<i;)i-=e;i<Number.EPSILON&&(i=n?0:e),!0!==this.aClockwise||n||(i===e?i=-e:i-=e);var r=this.aStartAngle+t*i,o=this.aX+this.xRadius*Math.cos(r),a=this.aY+this.yRadius*Math.sin(r);if(0!==this.aRotation){var s=Math.cos(this.aRotation),l=Math.sin(this.aRotation),h=o-this.aX,c=a-this.aY;o=h*s-c*l+this.aX,a=h*l+c*s+this.aY}return new WB(o,a)},((gj.prototype=Object.create(uj.prototype)).constructor=gj).prototype.isSplineCurve=!0,gj.prototype.getPoint=function(t){var e=this.points,i=(e.length-1)*t,n=Math.floor(i),r=i-n,o=e[0===n?n:n-1],a=e[n],s=e[n>e.length-2?e.length-1:n+1],l=e[n>e.length-3?e.length-1:n+2];return new WB(lj(r,o.x,a.x,s.x,l.x),lj(r,o.y,a.y,s.y,l.y))},((mj.prototype=Object.create(uj.prototype)).constructor=mj).prototype.getPoint=function(t){var e=this.v0,i=this.v1,n=this.v2,r=this.v3;return new WB(cj(t,e.x,i.x,n.x,r.x),cj(t,e.y,i.y,n.y,r.y))},((vj.prototype=Object.create(uj.prototype)).constructor=vj).prototype.getPoint=function(t){var e=this.v0,i=this.v1,n=this.v2;return new WB(hj(t,e.x,i.x,n.x),hj(t,e.y,i.y,n.y))};var yj,_j=Object.assign(Object.create(pj.prototype),{fromPoints:function(t){this.moveTo(t[0].x,t[0].y);for(var e=1,i=t.length;e<i;e++)this.lineTo(t[e].x,t[e].y)},moveTo:function(t,e){this.currentPoint.set(t,e)},lineTo:function(t,e){var i=new dj(this.currentPoint.clone(),new WB(t,e));this.curves.push(i),this.currentPoint.set(t,e)},quadraticCurveTo:function(t,e,i,n){var r=new vj(this.currentPoint.clone(),new WB(t,e),new WB(i,n));this.curves.push(r),this.currentPoint.set(i,n)},bezierCurveTo:function(t,e,i,n,r,o){var a=new mj(this.currentPoint.clone(),new WB(t,e),new WB(i,n),new WB(r,o));this.curves.push(a),this.currentPoint.set(r,o)},splineThru:function(t){var e=new gj([this.currentPoint.clone()].concat(t));this.curves.push(e),this.currentPoint.copy(t[t.length-1])},arc:function(t,e,i,n,r,o){var a=this.currentPoint.x,s=this.currentPoint.y;this.absarc(t+a,e+s,i,n,r,o)},absarc:function(t,e,i,n,r,o){this.absellipse(t,e,i,i,n,r,o)},ellipse:function(t,e,i,n,r,o,a,s){var l=this.currentPoint.x,h=this.currentPoint.y;this.absellipse(t+l,e+h,i,n,r,o,a,s)},absellipse:function(t,e,i,n,r,o,a,s){var l=new fj(t,e,i,n,r,o,a,s);if(0<this.curves.length){var h=l.getPoint(0);h.equals(this.currentPoint)||this.lineTo(h.x,h.y)}this.curves.push(l);var c=l.getPoint(1);this.currentPoint.copy(c)}});function xj(t){pj.call(this),this.currentPoint=new WB,t&&this.fromPoints(t)}function wj(){xj.apply(this,arguments),this.holes=[]}function bj(){this.subPaths=[],this.currentPath=null}function Mj(t){this.data=t}function Sj(t){this.manager=void 0!==t?t:xW}(xj.prototype=_j).constructor=xj,wj.prototype=Object.assign(Object.create(_j),{constructor:wj,getPointsHoles:function(t){for(var e=[],i=0,n=this.holes.length;i<n;i++)e[i]=this.holes[i].getPoints(t);return e},extractAllPoints:function(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}},extractPoints:function(t){return this.extractAllPoints(t)}}),bj.prototype={moveTo:function(t,e){this.currentPath=new xj,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,e)},lineTo:function(t,e){this.currentPath.lineTo(t,e)},quadraticCurveTo:function(t,e,i,n){this.currentPath.quadraticCurveTo(t,e,i,n)},bezierCurveTo:function(t,e,i,n,r,o){this.currentPath.bezierCurveTo(t,e,i,n,r,o)},splineThru:function(t){this.currentPath.splineThru(t)},toShapes:function(t,e){function i(t){for(var e=[],i=0,n=t.length;i<n;i++){var r=t[i],o=new wj;o.curves=r.curves,e.push(o)}return e}function n(t,e){for(var i=e.length,n=!1,r=i-1,o=0;o<i;r=o++){var a=e[r],s=e[o],l=s.x-a.x,h=s.y-a.y;if(Math.abs(h)>Number.EPSILON){if(h<0&&(a=e[o],l=-l,s=e[r],h=-h),t.y<a.y||t.y>s.y)continue;if(t.y===a.y){if(t.x===a.x)return!0}else{var c=h*(t.x-a.x)-l*(t.y-a.y);if(0===c)return!0;if(c<0)continue;n=!n}}else{if(t.y!==a.y)continue;if(s.x<=t.x&&t.x<=a.x||a.x<=t.x&&t.x<=s.x)return!0}}return n}var r=HU.isClockWise,o=this.subPaths;if(0===o.length)return[];if(!0===e)return i(o);var a,s,l,h=[];if(1===o.length)return s=o[0],(l=new wj).curves=s.curves,h.push(l),h;var c=!r(o[0].getPoints());c=t?!c:c;var u,d,p=[],f=[],g=[],m=0;f[m]=void 0,g[m]=[];for(var v=0,y=o.length;v<y;v++)a=r(u=(s=o[v]).getPoints()),(a=t?!a:a)?(!c&&f[m]&&m++,f[m]={s:new wj,p:u},f[m].s.curves=s.curves,c&&m++,g[m]=[]):g[m].push({h:s,p:u[0]});if(!f[0])return i(o);if(1<f.length){for(var _=!1,x=[],w=0,b=f.length;w<b;w++)p[w]=[];for(w=0,b=f.length;w<b;w++)for(var M=g[w],S=0;S<M.length;S++){for(var T=M[S],C=!0,A=0;A<f.length;A++)n(T.p,f[A].p)&&(w!==A&&x.push({froms:w,tos:A,hole:S}),C?(C=!1,p[A].push(T)):_=!0);C&&p[w].push(T)}0<x.length&&(_||(g=p))}v=0;for(var E=f.length;v<E;v++){l=f[v].s,h.push(l);for(var P=0,L=(d=g[v]).length;P<L;P++)l.holes.push(d[P].h)}return h}},Object.assign(Mj.prototype,{isFont:!0,generateShapes:function(t,c,M){function u(t,e,i,n){var r=S.glyphs[t]||S.glyphs["?"];if(r){var o,a,s,l,h,c,u,d,p,f,g,m=new bj,v=[];if(r.o)for(var y=r._cachedOutline||(r._cachedOutline=r.o.split(" ")),_=0,x=y.length;_<x;){switch(y[_++]){case"m":o=y[_++]*e+i,a=y[_++]*e+n,m.moveTo(o,a);break;case"l":o=y[_++]*e+i,a=y[_++]*e+n,m.lineTo(o,a);break;case"q":if(s=y[_++]*e+i,l=y[_++]*e+n,u=y[_++]*e+i,d=y[_++]*e+n,m.quadraticCurveTo(u,d,s,l),g=v[v.length-1]){h=g.x,c=g.y;for(var w=1;w<=M;w++){hj(b=w/M,h,u,s),hj(b,c,d,l)}}break;case"b":if(s=y[_++]*e+i,l=y[_++]*e+n,u=y[_++]*e+i,d=y[_++]*e+n,p=y[_++]*e+i,f=y[_++]*e+n,m.bezierCurveTo(u,d,p,f,s,l),g=v[v.length-1]){h=g.x,c=g.y;for(w=1;w<=M;w++){var b;cj(b=w/M,h,u,p,s),cj(b,c,d,f,l)}}}}return{offsetX:r.ha*e,path:m}}}void 0===c&&(c=100),void 0===M&&(M=4);for(var S=this.data,e=function(t){for(var e=String(t).split(""),i=c/S.resolution,n=(S.boundingBox.yMax-S.boundingBox.yMin+S.underlineThickness)*i,r=0,o=0,a=[],s=0;s<e.length;s++){var l=e[s];if("\n"===l)r=0,o-=n;else{var h=u(l,i,r,o);r+=h.offsetX,a.push(h.path)}}return a}(t),i=[],n=0,r=e.length;n<r;n++)Array.prototype.push.apply(i,e[n].toShapes());return i}}),Object.assign(Sj.prototype,{load:function(t,n,e,i){var r=this;new wW(this.manager).load(t,function(e){var i;try{i=JSON.parse(e)}catch(t){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),i=JSON.parse(e.substring(65,e.length-2))}var t=r.parse(i);n&&n(t)},e,i)},parse:function(t){return new Mj(t)}});var Tj,Cj,Aj,Ej,Pj,Lj,Ij,Rj,Dj,Oj,kj,zj,Nj,Bj,Fj,Gj,Vj,Hj,Uj,Wj,jj,Zj,Xj,qj,Yj,Jj,Kj,Qj,$j,tZ,eZ,iZ,nZ,rZ,oZ,aZ,sZ,lZ,hZ={getContext:function(){return void 0===yj&&(yj=new(window.AudioContext||window.webkitAudioContext)),yj},setContext:function(t){yj=t}};function cZ(t){this.manager=void 0!==t?t:xW}function uZ(t,e,i,n){AW.call(this,t,e),this.type="RectAreaLight",this.position.set(0,1,0),this.updateMatrix(),this.width=void 0!==i?i:10,this.height=void 0!==n?n:10}function dZ(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new bH,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new bH,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1}function pZ(t,e,i){DV.call(this),this.type="CubeCamera";var r=new bH(90,1,t,e);r.up.set(0,-1,0),r.lookAt(new mF(1,0,0)),this.add(r);var o=new bH(90,1,t,e);o.up.set(0,-1,0),o.lookAt(new mF(-1,0,0)),this.add(o);var a=new bH(90,1,t,e);a.up.set(0,0,1),a.lookAt(new mF(0,1,0)),this.add(a);var s=new bH(90,1,t,e);s.up.set(0,0,-1),s.lookAt(new mF(0,-1,0)),this.add(s);var l=new bH(90,1,t,e);l.up.set(0,-1,0),l.lookAt(new mF(0,0,1)),this.add(l);var h=new bH(90,1,t,e);h.up.set(0,-1,0),h.lookAt(new mF(0,0,-1)),this.add(h);var n={format:MB,magFilter:gB,minFilter:gB};this.renderTarget=new fF(i,i,n),this.updateCubeMap=function(t,e){null===this.parent&&this.updateMatrixWorld();var i=this.renderTarget,n=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,i.activeCubeFace=0,t.render(e,r,i),i.activeCubeFace=1,t.render(e,o,i),i.activeCubeFace=2,t.render(e,a,i),i.activeCubeFace=3,t.render(e,s,i),i.activeCubeFace=4,t.render(e,l,i),i.texture.generateMipmaps=n,i.activeCubeFace=5,t.render(e,h,i),t.setRenderTarget(null)}}function fZ(){DV.call(this),this.type="AudioListener",this.context=hZ.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null}function gZ(t){DV.call(this),this.type="Audio",this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.loop=!1,this.startTime=0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType="empty",this.filters=[]}function mZ(t){gZ.call(this,t),this.panner=this.context.createPanner(),this.panner.connect(this.gain)}function vZ(t,e){this.analyser=t.context.createAnalyser(),this.analyser.fftSize=void 0!==e?e:2048,this.data=new Uint8Array(this.analyser.frequencyBinCount),t.getOutput().connect(this.analyser)}function yZ(t,e,i){this.binding=t,this.valueSize=i;var n,r=Float64Array;switch(e){case"quaternion":n=this._slerp;break;case"string":case"bool":r=Array,n=this._select;break;default:n=this._lerp}this.buffer=new r(4*i),this._mixBufferRegion=n,this.cumulativeWeight=0,this.useCount=0,this.referenceCount=0}function _Z(t,e,i){this.path=e,this.parsedPath=i||_Z.parseTrackName(e),this.node=_Z.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t}function xZ(t){this.uuid=UB.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var e={};this._indicesByUUID=e;for(var i=0,n=arguments.length;i!==n;++i)e[arguments[i].uuid]=i;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var r=this;this.stats={objects:{get total(){return r._objects.length},get inUse(){return this.total-r.nCachedObjects_}},get bindingsPerObject(){return r._bindings.length}}}function wZ(t,e,i){this._mixer=t,this._clip=e,this._localRoot=i||null;for(var n=e.tracks,r=n.length,o=new Array(r),a={endingStart:LB,endingEnd:LB},s=0;s!==r;++s){var l=n[s].createInterpolant(null);(o[s]=l).settings=a}this._interpolantSettings=a,this._interpolants=o,this._propertyBindings=new Array(r),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}function bZ(t){this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}function MZ(t){"string"==typeof t&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),t=arguments[1]),this.value=t}function SZ(){gH.call(this),this.type="InstancedBufferGeometry",this.maxInstancedCount=void 0}function TZ(t,e,i,n){this.uuid=UB.generateUUID(),this.data=t,this.itemSize=e,this.offset=i,this.normalized=!0===n}function CZ(t,e){this.uuid=UB.generateUUID(),this.array=t,this.stride=e,this.count=void 0!==t?t.length/e:0,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.onUploadCallback=function(){},this.version=0}function AZ(t,e,i){CZ.call(this,t,e),this.meshPerAttribute=i||1}function EZ(t,e,i){BV.call(this,t,e),this.meshPerAttribute=i||1}function PZ(t,e,i,n){this.ray=new tV(t,e),this.near=i||0,this.far=n||1/0,this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function LZ(t,e){return t.distance-e.distance}function IZ(t,e,i,n){if(!1!==t.visible&&(t.raycast(e,i),!0===n))for(var r=t.children,o=0,a=r.length;o<a;o++)IZ(r[o],e,i,!0)}function RZ(t){this.autoStart=void 0===t||t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}function DZ(t,e,i){return this.radius=void 0!==t?t:1,this.phi=void 0!==e?e:0,this.theta=void 0!==i?i:0,this}function OZ(t,e,i){return this.radius=void 0!==t?t:1,this.theta=void 0!==e?e:0,this.y=void 0!==i?i:0,this}function kZ(t,e){mH.call(this,t,e),this.animationsMap={},this.animationsList=[];var i=this.geometry.morphTargets.length,n=i-1,r=i/1;this.createAnimation("__default",0,n,r),this.setAnimationWeight("__default",1)}function zZ(t){DV.call(this),this.material=t,this.render=function(t){}}function NZ(t,e,i,n){this.object=t,this.size=void 0!==e?e:1;var r=void 0!==i?i:16711680,o=void 0!==n?n:1,a=0,s=this.object.geometry;s&&s.isGeometry?a=3*s.faces.length:s&&s.isBufferGeometry&&(a=s.attributes.normal.count);var l=new gH,h=new ZV(2*a*3,3);l.addAttribute("position",h),gU.call(this,l,new pU({color:r,linewidth:o})),this.matrixAutoUpdate=!1,this.update()}function BZ(t){DV.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1;for(var e=new gH,i=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],n=0,r=1;n<32;n++,r++){var o=n/32*Math.PI*2,a=r/32*Math.PI*2;i.push(Math.cos(o),Math.sin(o),1,Math.cos(a),Math.sin(a),1)}e.addAttribute("position",new ZV(i,3));var s=new pU({fog:!1});this.cone=new gU(e,s),this.add(this.cone),this.update()}function FZ(t){this.bones=this.getBoneList(t);for(var e=new gH,i=[],n=[],r=new rG(0,0,1),o=new rG(0,1,0),a=0;a<this.bones.length;a++){var s=this.bones[a];s.parent&&s.parent.isBone&&(i.push(0,0,0),i.push(0,0,0),n.push(r.r,r.g,r.b),n.push(o.r,o.g,o.b))}e.addAttribute("position",new ZV(i,3)),e.addAttribute("color",new ZV(n,3));var l=new pU({vertexColors:2,depthTest:!1,depthWrite:!1,transparent:!0});gU.call(this,e,l),this.root=t,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.update()}function GZ(t,e){this.light=t,this.light.updateMatrixWorld();var i=new ZU(e,4,2),n=new NV({wireframe:!0,fog:!1});n.color.copy(this.light.color).multiplyScalar(this.light.intensity),mH.call(this,i,n),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1}function VZ(t){DV.call(this),this.light=t,this.light.updateMatrixWorld();var e=new NV({color:t.color,fog:!1}),i=new NV({color:t.color,fog:!1,wireframe:!0}),n=new gH;n.addAttribute("position",new BV(new Float32Array(18),3)),this.add(new mH(n,e)),this.add(new mH(n,i)),this.update()}function HZ(t,e){DV.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1;var i=new IU(e);i.rotateY(.5*Math.PI);var n=new NV({vertexColors:2,wireframe:!0}),r=i.getAttribute("position"),o=new Float32Array(3*r.count);i.addAttribute("color",new BV(o,3)),this.add(new mH(i,n)),this.update()}function UZ(t,e,i,n){t=t||10,e=e||10,i=new rG(void 0!==i?i:4473924),n=new rG(void 0!==n?n:8947848);for(var r=e/2,o=t/e,a=t/2,s=[],l=[],h=0,c=0,u=-a;h<=e;h++,u+=o){s.push(-a,0,u,a,0,u),s.push(u,0,-a,u,0,a);var d=h===r?i:n;d.toArray(l,c),c+=3,d.toArray(l,c),c+=3,d.toArray(l,c),c+=3,d.toArray(l,c),c+=3}var p=new gH;p.addAttribute("position",new ZV(s,3)),p.addAttribute("color",new ZV(l,3));var f=new pU({vertexColors:2});gU.call(this,p,f)}function WZ(t,e,i,n,r,o){t=t||10,e=e||16,i=i||8,n=n||64,r=new rG(void 0!==r?r:4473924),o=new rG(void 0!==o?o:8947848);var a,s,l,h,c,u,d,p=[],f=[];for(h=0;h<=e;h++)l=h/e*(2*Math.PI),a=Math.sin(l)*t,s=Math.cos(l)*t,p.push(0,0,0),p.push(a,0,s),d=1&h?r:o,f.push(d.r,d.g,d.b),f.push(d.r,d.g,d.b);for(h=0;h<=i;h++)for(d=1&h?r:o,u=t-t/i*h,c=0;c<n;c++)l=c/n*(2*Math.PI),a=Math.sin(l)*u,s=Math.cos(l)*u,p.push(a,0,s),f.push(d.r,d.g,d.b),l=(c+1)/n*(2*Math.PI),a=Math.sin(l)*u,s=Math.cos(l)*u,p.push(a,0,s),f.push(d.r,d.g,d.b);var g=new gH;g.addAttribute("position",new ZV(p,3)),g.addAttribute("color",new ZV(f,3));var m=new pU({vertexColors:2});gU.call(this,g,m)}function jZ(t,e,i,n){this.object=t,this.size=void 0!==e?e:1;var r=void 0!==i?i:16776960,o=void 0!==n?n:1,a=0,s=this.object.geometry;s&&s.isGeometry?a=s.faces.length:console.warn("THREE.FaceNormalsHelper: only THREE.Geometry is supported. Use THREE.VertexNormalsHelper, instead.");var l=new gH,h=new ZV(2*a*3,3);l.addAttribute("position",h),gU.call(this,l,new pU({color:r,linewidth:o})),this.matrixAutoUpdate=!1,this.update()}function ZZ(t,e){DV.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,void 0===e&&(e=1);var i=new gH;i.addAttribute("position",new ZV([-e,e,0,e,e,0,e,-e,0,-e,-e,0,-e,e,0],3));var n=new pU({fog:!1});this.add(new fU(i,n)),(i=new gH).addAttribute("position",new ZV([0,0,0,0,0,1],3)),this.add(new fU(i,n)),this.update()}function XZ(t){var e=new gH,i=new pU({color:16777215,vertexColors:1}),n=[],r=[],o={},a=new rG(16755200),s=new rG(16711680),l=new rG(43775),h=new rG(16777215),c=new rG(3355443);function u(t,e,i){d(t,i),d(e,i)}function d(t,e){n.push(0,0,0),r.push(e.r,e.g,e.b),void 0===o[t]&&(o[t]=[]),o[t].push(n.length/3-1)}u("n1","n2",a),u("n2","n4",a),u("n4","n3",a),u("n3","n1",a),u("f1","f2",a),u("f2","f4",a),u("f4","f3",a),u("f3","f1",a),u("n1","f1",a),u("n2","f2",a),u("n3","f3",a),u("n4","f4",a),u("p","n1",s),u("p","n2",s),u("p","n3",s),u("p","n4",s),u("u1","u2",l),u("u2","u3",l),u("u3","u1",l),u("c","t",h),u("p","c",c),u("cn1","cn2",c),u("cn3","cn4",c),u("cf1","cf2",c),u("cf3","cf4",c),e.addAttribute("position",new ZV(n,3)),e.addAttribute("color",new ZV(r,3)),gU.call(this,e,i),this.camera=t,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update()}function qZ(t,e){void 0===e&&(e=16776960);var i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new Float32Array(24),r=new gH;r.setIndex(new BV(i,1)),r.addAttribute("position",new BV(n,3)),gU.call(this,r,new pU({color:e})),void 0!==t&&this.update(t)}function YZ(t,e,i,n,r,o){DV.call(this),void 0===n&&(n=16776960),void 0===i&&(i=1),void 0===r&&(r=.2*i),void 0===o&&(o=.2*r),void 0===oZ&&((oZ=new gH).addAttribute("position",new ZV([0,0,0,0,1,0],3)),(aZ=new eW(0,.5,1,5,1)).translate(0,-.5,0)),this.position.copy(e),this.line=new fU(oZ,new pU({color:n})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new mH(aZ,new NV({color:n})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(t),this.setLength(i,r,o)}function JZ(t){var e=[0,0,0,t=t||1,0,0,0,0,0,0,t,0,0,0,0,0,0,t],i=new gH;i.addAttribute("position",new ZV(e,3)),i.addAttribute("color",new ZV([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));var n=new pU({vertexColors:2});gU.call(this,i,n)}function KZ(){var r=0,o=0,a=0,s=0;function h(t,e,i,n){a=-3*(r=t)+3*e-2*(o=i)-n,s=2*t-2*e+i+n}return{initCatmullRom:function(t,e,i,n,r){h(e,i,r*(i-t),r*(n-e))},initNonuniformCatmullRom:function(t,e,i,n,r,o,a){var s=(e-t)/r-(i-t)/(r+o)+(i-e)/o,l=(i-e)/o-(n-e)/(o+a)+(n-i)/a;h(e,i,s*=o,l*=o)},calc:function(t){var e=t*t;return r+o*t+a*e+s*(e*t)}}}Object.assign(cZ.prototype,{load:function(t,e,i,n){var r=new wW(this.manager);r.setResponseType("arraybuffer"),r.load(t,function(t){hZ.getContext().decodeAudioData(t,function(t){e(t)})},i,n)}}),uZ.prototype=Object.assign(Object.create(AW.prototype),{constructor:uZ,isRectAreaLight:!0,copy:function(t){return AW.prototype.copy.call(this,t),this.width=t.width,this.height=t.height,this}}),Object.assign(dZ.prototype,{update:(Rj=new vF,Dj=new vF,function(t){if(Tj!==this||Cj!==t.focus||Aj!==t.fov||Ej!==t.aspect*this.aspect||Pj!==t.near||Lj!==t.far||Ij!==t.zoom){Tj=this,Cj=t.focus,Aj=t.fov,Ej=t.aspect*this.aspect,Pj=t.near,Lj=t.far,Ij=t.zoom;var e,i,n=t.projectionMatrix.clone(),r=this.eyeSep/2,o=r*Pj/Cj,a=Pj*Math.tan(UB.DEG2RAD*Aj*.5)/Ij;Dj.elements[12]=-r,Rj.elements[12]=r,e=-a*Ej+o,i=a*Ej+o,n.elements[0]=2*Pj/(i-e),n.elements[8]=(i+e)/(i-e),this.cameraL.projectionMatrix.copy(n),e=-a*Ej-o,i=a*Ej-o,n.elements[0]=2*Pj/(i-e),n.elements[8]=(i+e)/(i-e),this.cameraR.projectionMatrix.copy(n)}this.cameraL.matrixWorld.copy(t.matrixWorld).multiply(Dj),this.cameraR.matrixWorld.copy(t.matrixWorld).multiply(Rj)})}),(pZ.prototype=Object.create(DV.prototype)).constructor=pZ,fZ.prototype=Object.assign(Object.create(DV.prototype),{constructor:fZ,getInput:function(){return this.gain},removeFilter:function(){null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null)},getFilter:function(){return this.filter},setFilter:function(t){null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=t,this.gain.connect(this.filter),this.filter.connect(this.context.destination)},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(t){this.gain.gain.value=t},updateMatrixWorld:(Oj=new mF,kj=new gF,zj=new mF,Nj=new mF,function(t){DV.prototype.updateMatrixWorld.call(this,t);var e=this.context.listener,i=this.up;this.matrixWorld.decompose(Oj,kj,zj),Nj.set(0,0,-1).applyQuaternion(kj),e.positionX?(e.positionX.setValueAtTime(Oj.x,this.context.currentTime),e.positionY.setValueAtTime(Oj.y,this.context.currentTime),e.positionZ.setValueAtTime(Oj.z,this.context.currentTime),e.forwardX.setValueAtTime(Nj.x,this.context.currentTime),e.forwardY.setValueAtTime(Nj.y,this.context.currentTime),e.forwardZ.setValueAtTime(Nj.z,this.context.currentTime),e.upX.setValueAtTime(i.x,this.context.currentTime),e.upY.setValueAtTime(i.y,this.context.currentTime),e.upZ.setValueAtTime(i.z,this.context.currentTime)):(e.setPosition(Oj.x,Oj.y,Oj.z),e.setOrientation(Nj.x,Nj.y,Nj.z,i.x,i.y,i.z))})}),gZ.prototype=Object.assign(Object.create(DV.prototype),{constructor:gZ,getOutput:function(){return this.gain},setNodeSource:function(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this},setBuffer:function(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this},play:function(){if(!0!==this.isPlaying){if(!1!==this.hasPlaybackControl){var t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.onended=this.onEnded.bind(this),t.playbackRate.setValueAtTime(this.playbackRate,this.startTime),t.start(0,this.startTime),this.isPlaying=!0,this.source=t,this.connect()}console.warn("THREE.Audio: this Audio has no playback control.")}else console.warn("THREE.Audio: Audio is already playing.")},pause:function(){if(!1!==this.hasPlaybackControl)return this.source.stop(),this.startTime=this.context.currentTime,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")},stop:function(){if(!1!==this.hasPlaybackControl)return this.source.stop(),this.startTime=0,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")},connect:function(){if(0<this.filters.length){this.source.connect(this.filters[0]);for(var t=1,e=this.filters.length;t<e;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(0<this.filters.length){this.source.disconnect(this.filters[0]);for(var t=1,e=this.filters.length;t<e;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(t){return t||(t=[]),!0===this.isPlaying?(this.disconnect(),this.filters=t,this.connect()):this.filters=t,this},getFilter:function(){return this.getFilters()[0]},setFilter:function(t){return this.setFilters(t?[t]:[])},setPlaybackRate:function(t){if(!1!==this.hasPlaybackControl)return this.playbackRate=t,!0===this.isPlaying&&this.source.playbackRate.setValueAtTime(this.playbackRate,this.context.currentTime),this;console.warn("THREE.Audio: this Audio has no playback control.")},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop},setLoop:function(t){if(!1!==this.hasPlaybackControl)return this.loop=t,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")},getVolume:function(){return this.gain.gain.value},setVolume:function(t){return this.gain.gain.value=t,this}}),mZ.prototype=Object.assign(Object.create(gZ.prototype),{constructor:mZ,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(t){this.panner.refDistance=t},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(t){this.panner.rolloffFactor=t},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(t){this.panner.distanceModel=t},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(t){this.panner.maxDistance=t},updateMatrixWorld:(Bj=new mF,function(t){DV.prototype.updateMatrixWorld.call(this,t),Bj.setFromMatrixPosition(this.matrixWorld),this.panner.setPosition(Bj.x,Bj.y,Bj.z)})}),Object.assign(vZ.prototype,{getFrequencyData:function(){return this.analyser.getByteFrequencyData(this.data),this.data},getAverageFrequency:function(){for(var t=0,e=this.getFrequencyData(),i=0;i<e.length;i++)t+=e[i];return t/e.length}}),yZ.prototype={constructor:yZ,accumulate:function(t,e){var i=this.buffer,n=this.valueSize,r=t*n+n,o=this.cumulativeWeight;if(0===o){for(var a=0;a!==n;++a)i[r+a]=i[a];o=e}else{var s=e/(o+=e);this._mixBufferRegion(i,r,0,s,n)}this.cumulativeWeight=o},apply:function(t){var e=this.valueSize,i=this.buffer,n=t*e+e,r=this.cumulativeWeight,o=this.binding;if(this.cumulativeWeight=0,r<1){var a=3*e;this._mixBufferRegion(i,n,a,1-r,e)}for(var s=e,l=e+e;s!==l;++s)if(i[s]!==i[s+e]){o.setValue(i,n);break}},saveOriginalState:function(){var t=this.binding,e=this.buffer,i=this.valueSize,n=3*i;t.getValue(e,n);for(var r=i,o=n;r!==o;++r)e[r]=e[n+r%i];this.cumulativeWeight=0},restoreOriginalState:function(){var t=3*this.valueSize;this.binding.setValue(this.buffer,t)},_select:function(t,e,i,n,r){if(.5<=n)for(var o=0;o!==r;++o)t[e+o]=t[i+o]},_slerp:function(t,e,i,n,r){gF.slerpFlat(t,e,t,e,t,i,n)},_lerp:function(t,e,i,n,r){for(var o=1-n,a=0;a!==r;++a){var s=e+a;t[s]=t[s]*o+t[i+a]*n}}},_Z.prototype={constructor:_Z,getValue:function(t,e){this.bind(),this.getValue(t,e)},setValue:function(t,e){this.bind(),this.setValue(t,e)},bind:function(){var t=this.node,e=this.parsedPath,i=e.objectName,n=e.propertyName,r=e.propertyIndex;if(t||(t=_Z.findNode(this.rootNode,e.nodeName)||this.rootNode,this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,t){if(i){var o=e.objectIndex;switch(i){case"materials":if(!t.material)return void console.error("  can not bind to material as node does not have a material",this);if(!t.material.materials)return void console.error("  can not bind to material.materials as node.material does not have a materials array",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("  can not bind to bones as node does not have a skeleton",this);t=t.skeleton.bones;for(var a=0;a<t.length;a++)if(t[a].name===o){o=a;break}break;default:if(void 0===t[i])return void console.error("  can not bind to objectName of node, undefined",this);t=t[i]}if(void 0!==o){if(void 0===t[o])return void console.error("  trying to bind to objectIndex of objectName, but is undefined:",this,t);t=t[o]}}var s=t[n];if(void 0!==s){var l=this.Versioning.None;void 0!==t.needsUpdate?(l=this.Versioning.NeedsUpdate,this.targetObject=t):void 0!==t.matrixWorldNeedsUpdate&&(l=this.Versioning.MatrixWorldNeedsUpdate,this.targetObject=t);var h=this.BindingType.Direct;if(void 0!==r){if("morphTargetInfluences"===n){if(!t.geometry)return void console.error("  can not bind to morphTargetInfluences becasuse node does not have a geometry",this);if(!t.geometry.morphTargets)return void console.error("  can not bind to morphTargetInfluences becasuse node does not have a geometry.morphTargets",this);for(a=0;a<this.node.geometry.morphTargets.length;a++)if(t.geometry.morphTargets[a].name===r){r=a;break}}h=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=r}else void 0!==s.fromArray&&void 0!==s.toArray?(h=this.BindingType.HasFromToArray,this.resolvedProperty=s):void 0!==s.length?(h=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=n;this.getValue=this.GetterByBindingType[h],this.setValue=this.SetterByBindingTypeAndVersioning[h][l]}else{var c=e.nodeName;console.error("  trying to update property for track: "+c+"."+n+" but it wasn't found.",t)}}else console.error("  trying to update node for track: "+this.path+" but it wasn't found.")},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}},Object.assign(_Z.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},_getValue_unbound:_Z.prototype.getValue,_setValue_unbound:_Z.prototype.setValue,BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(t,e){t[e]=this.node[this.propertyName]},function(t,e){for(var i=this.resolvedProperty,n=0,r=i.length;n!==r;++n)t[e++]=i[n]},function(t,e){t[e]=this.resolvedProperty[this.propertyIndex]},function(t,e){this.resolvedProperty.toArray(t,e)}],SetterByBindingTypeAndVersioning:[[function(t,e){this.node[this.propertyName]=t[e]},function(t,e){this.node[this.propertyName]=t[e],this.targetObject.needsUpdate=!0},function(t,e){this.node[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){for(var i=this.resolvedProperty,n=0,r=i.length;n!==r;++n)i[n]=t[e++]},function(t,e){for(var i=this.resolvedProperty,n=0,r=i.length;n!==r;++n)i[n]=t[e++];this.targetObject.needsUpdate=!0},function(t,e){for(var i=this.resolvedProperty,n=0,r=i.length;n!==r;++n)i[n]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){this.resolvedProperty[this.propertyIndex]=t[e]},function(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0},function(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){this.resolvedProperty.fromArray(t,e)},function(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0},function(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}]]}),(_Z.Composite=function(t,e,i){var n=i||_Z.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,n)}).prototype={constructor:_Z.Composite,getValue:function(t,e){this.bind();var i=this._targetGroup.nCachedObjects_,n=this._bindings[i];void 0!==n&&n.getValue(t,e)},setValue:function(t,e){for(var i=this._bindings,n=this._targetGroup.nCachedObjects_,r=i.length;n!==r;++n)i[n].setValue(t,e)},bind:function(){for(var t=this._bindings,e=this._targetGroup.nCachedObjects_,i=t.length;e!==i;++e)t[e].bind()},unbind:function(){for(var t=this._bindings,e=this._targetGroup.nCachedObjects_,i=t.length;e!==i;++e)t[e].unbind()}},_Z.create=function(t,e,i){return t&&t.isAnimationObjectGroup?new _Z.Composite(t,e,i):new _Z(t,e,i)},_Z.parseTrackName=function(t){var e=/^((?:[\w-]+[\/:])*)([\w-]+)?(?:\.([\w-]+)(?:\[(.+)\])?)?\.([\w-]+)(?:\[(.+)\])?$/.exec(t);if(!e)throw new Error("cannot parse trackName at all: "+t);var i={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]};if(null===i.propertyName||0===i.propertyName.length)throw new Error("can not parse propertyName from trackName: "+t);return i},_Z.findNode=function(t,r){if(!r||""===r||"root"===r||"."===r||-1===r||r===t.name||r===t.uuid)return t;if(t.skeleton){var e=function(t){for(var e=0;e<t.bones.length;e++){var i=t.bones[e];if(i.name===r)return i}return null}(t.skeleton);if(e)return e}if(t.children){var o=function(t){for(var e=0;e<t.length;e++){var i=t[e];if(i.name===r||i.uuid===r)return i;var n=o(i.children);if(n)return n}return null},i=o(t.children);if(i)return i}return null},xZ.prototype={constructor:xZ,isAnimationObjectGroup:!0,add:function(t){for(var e=this._objects,i=e.length,n=this.nCachedObjects_,r=this._indicesByUUID,o=this._paths,a=this._parsedPaths,s=this._bindings,l=s.length,h=0,c=arguments.length;h!==c;++h){var u=arguments[h],d=u.uuid,p=r[d],f=void 0;if(void 0===p){p=i++,r[d]=p,e.push(u);for(var g=0,m=l;g!==m;++g)s[g].push(new _Z(u,o[g],a[g]))}else if(p<n){f=e[p];var v=--n,y=e[v];e[r[y.uuid]=p]=y,e[r[d]=v]=u;for(g=0,m=l;g!==m;++g){var _=s[g],x=_[v],w=_[p];_[p]=x,void 0===w&&(w=new _Z(u,o[g],a[g])),_[v]=w}}else e[p]!==f&&console.error("Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes...")}this.nCachedObjects_=n},remove:function(t){for(var e=this._objects,i=this.nCachedObjects_,n=this._indicesByUUID,r=this._bindings,o=r.length,a=0,s=arguments.length;a!==s;++a){var l=arguments[a],h=l.uuid,c=n[h];if(void 0!==c&&i<=c){var u=i++,d=e[u];e[n[d.uuid]=c]=d,e[n[h]=u]=l;for(var p=0,f=o;p!==f;++p){var g=r[p],m=g[u],v=g[c];g[c]=m,g[u]=v}}}this.nCachedObjects_=i},uncache:function(t){for(var e=this._objects,i=e.length,n=this.nCachedObjects_,r=this._indicesByUUID,o=this._bindings,a=o.length,s=0,l=arguments.length;s!==l;++s){var h=arguments[s].uuid,c=r[h];if(void 0!==c)if(delete r[h],c<n){var u=--n,d=e[u],p=e[y=--i];e[r[d.uuid]=c]=d,e[r[p.uuid]=u]=p,e.pop();for(var f=0,g=a;f!==g;++f){var m=(_=o[f])[u],v=_[y];_[c]=m,_[u]=v,_.pop()}}else{var y;e[r[(p=e[y=--i]).uuid]=c]=p,e.pop();for(f=0,g=a;f!==g;++f){var _;(_=o[f])[c]=_[y],_.pop()}}}this.nCachedObjects_=n},subscribe_:function(t,e){var i=this._bindingsIndicesByPath,n=i[t],r=this._bindings;if(void 0!==n)return r[n];var o=this._paths,a=this._parsedPaths,s=this._objects,l=s.length,h=this.nCachedObjects_,c=new Array(l);n=r.length,i[t]=n,o.push(t),a.push(e),r.push(c);for(var u=h,d=s.length;u!==d;++u){var p=s[u];c[u]=new _Z(p,t,e)}return c},unsubscribe_:function(t){var e=this._bindingsIndicesByPath,i=e[t];if(void 0!==i){var n=this._paths,r=this._parsedPaths,o=this._bindings,a=o.length-1,s=o[a];o[e[t[a]]=i]=s,o.pop(),r[i]=r[a],r.pop(),n[i]=n[a],n.pop()}}},wZ.prototype={constructor:wZ,play:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(t){return this._startTime=t,this},setLoop:function(t,e){return this.loop=t,this.repetitions=e,this},setEffectiveWeight:function(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(t){return this._scheduleFading(t,0,1)},fadeOut:function(t){return this._scheduleFading(t,1,0)},crossFadeFrom:function(t,e,i){if(t.fadeOut(e),this.fadeIn(e),i){var n=this._clip.duration,r=t._clip.duration,o=r/n,a=n/r;t.warp(1,o,e),this.warp(a,1,e)}return this},crossFadeTo:function(t,e,i){return t.crossFadeFrom(this,e,i)},stopFading:function(){var t=this._weightInterpolant;return null!==t&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this},setEffectiveTimeScale:function(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(t){return this.timeScale=this._clip.duration/t,this.stopWarping()},syncWith:function(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()},halt:function(t){return this.warp(this._effectiveTimeScale,0,t)},warp:function(t,e,i){var n=this._mixer,r=n.time,o=this._timeScaleInterpolant,a=this.timeScale;null===o&&(o=n._lendControlInterpolant(),this._timeScaleInterpolant=o);var s=o.parameterPositions,l=o.sampleValues;return s[0]=r,s[1]=r+i,l[0]=t/a,l[1]=e/a,this},stopWarping:function(){var t=this._timeScaleInterpolant;return null!==t&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(t,e,i,n){var r=this._startTime;if(null!==r){var o=(t-r)*i;if(o<0||0===i)return;this._startTime=null,e=i*o}e*=this._updateTimeScale(t);var a=this._updateTime(e),s=this._updateWeight(t);if(0<s)for(var l=this._interpolants,h=this._propertyBindings,c=0,u=l.length;c!==u;++c)l[c].evaluate(a),h[c].accumulate(n,s)},_updateWeight:function(t){var e=0;if(this.enabled){e=this.weight;var i=this._weightInterpolant;if(null!==i){var n=i.evaluate(t)[0];e*=n,t>i.parameterPositions[1]&&(this.stopFading(),0===n&&(this.enabled=!1))}}return this._effectiveWeight=e},_updateTimeScale:function(t){var e=0;if(!this.paused){e=this.timeScale;var i=this._timeScaleInterpolant;if(null!==i)e*=i.evaluate(t)[0],t>i.parameterPositions[1]&&(this.stopWarping(),0===e?this.paused=!0:this.timeScale=e)}return this._effectiveTimeScale=e},_updateTime:function(t){var e=this.time+t;if(0===t)return e;var i=this._clip.duration,n=this.loop,r=this._loopCount;if(2200===n){-1===r&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(i<=e)e=i;else{if(!(e<0))break t;e=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{var o=2202===n;if(-1===r&&(0<=t?(r=0,this._setEndings(!0,0===this.repetitions,o)):this._setEndings(0===this.repetitions,!0,o)),i<=e||e<0){var a=Math.floor(e/i);e-=i*a,r+=Math.abs(a);var s=this.repetitions-r;if(s<0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,e=0<t?i:0,this._mixer.dispatchEvent({type:"finished",action:this,direction:0<t?1:-1});else{if(0===s){var l=t<0;this._setEndings(l,!l,o)}else this._setEndings(!1,!1,o);this._loopCount=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:a})}}if(o&&1==(1&r))return i-(this.time=e)}return this.time=e},_setEndings:function(t,e,i){var n=this._interpolantSettings;i?(n.endingStart=IB,n.endingEnd=IB):(n.endingStart=t?this.zeroSlopeAtStart?IB:LB:RB,n.endingEnd=e?this.zeroSlopeAtEnd?IB:LB:RB)},_scheduleFading:function(t,e,i){var n=this._mixer,r=n.time,o=this._weightInterpolant;null===o&&(o=n._lendControlInterpolant(),this._weightInterpolant=o);var a=o.parameterPositions,s=o.sampleValues;return a[0]=r,s[0]=e,a[1]=r+t,s[1]=i,this}},bZ.prototype={constructor:bZ,clipAction:function(t,e){var i=e||this._root,n=i.uuid,r="string"==typeof t?ij.findByName(i,t):t,o=null!==r?r.uuid:t,a=this._actionsByClip[o],s=null;if(void 0!==a){var l=a.actionByRoot[n];if(void 0!==l)return l;s=a.knownActions[0],null===r&&(r=s._clip)}if(null===r)return null;var h=new wZ(this,r,e);return this._bindAction(h,s),this._addInactiveAction(h,o,n),h},existingAction:function(t,e){var i=e||this._root,n=i.uuid,r="string"==typeof t?ij.findByName(i,t):t,o=r?r.uuid:t,a=this._actionsByClip[o];return void 0!==a&&a.actionByRoot[n]||null},stopAllAction:function(){var t=this._actions,e=this._nActiveActions,i=this._bindings,n=this._nActiveBindings;this._nActiveActions=0;for(var r=this._nActiveBindings=0;r!==e;++r)t[r].reset();for(r=0;r!==n;++r)i[r].useCount=0;return this},update:function(t){t*=this.timeScale;for(var e=this._actions,i=this._nActiveActions,n=this.time+=t,r=Math.sign(t),o=this._accuIndex^=1,a=0;a!==i;++a){var s=e[a];s.enabled&&s._update(n,t,r,o)}var l=this._bindings,h=this._nActiveBindings;for(a=0;a!==h;++a)l[a].apply(o);return this},getRoot:function(){return this._root},uncacheClip:function(t){var e=this._actions,i=t.uuid,n=this._actionsByClip,r=n[i];if(void 0!==r){for(var o=r.knownActions,a=0,s=o.length;a!==s;++a){var l=o[a];this._deactivateAction(l);var h=l._cacheIndex,c=e[e.length-1];l._cacheIndex=null,l._byClipCacheIndex=null,e[c._cacheIndex=h]=c,e.pop(),this._removeInactiveBindingsForAction(l)}delete n[i]}},uncacheRoot:function(t){var e=t.uuid,i=this._actionsByClip;for(var n in i){var r=i[n].actionByRoot[e];void 0!==r&&(this._deactivateAction(r),this._removeInactiveAction(r))}var o=this._bindingsByRootAndName[e];if(void 0!==o)for(var a in o){var s=o[a];s.restoreOriginalState(),this._removeInactiveBinding(s)}},uncacheAction:function(t,e){var i=this.existingAction(t,e);null!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}},Object.assign(bZ.prototype,{_bindAction:function(t,e){var i=t._localRoot||this._root,n=t._clip.tracks,r=n.length,o=t._propertyBindings,a=t._interpolants,s=i.uuid,l=this._bindingsByRootAndName,h=l[s];void 0===h&&(h={},l[s]=h);for(var c=0;c!==r;++c){var u=n[c],d=u.name,p=h[d];if(void 0!==p)o[c]=p;else{if(void 0!==(p=o[c])){null===p._cacheIndex&&(++p.referenceCount,this._addInactiveBinding(p,s,d));continue}var f=e&&e._propertyBindings[c].binding.parsedPath;++(p=new yZ(_Z.create(i,d,f),u.ValueTypeName,u.getValueSize())).referenceCount,this._addInactiveBinding(p,s,d),o[c]=p}a[c].resultBuffer=p.buffer}},_activateAction:function(t){if(!this._isActiveAction(t)){if(null===t._cacheIndex){var e=(t._localRoot||this._root).uuid,i=t._clip.uuid,n=this._actionsByClip[i];this._bindAction(t,n&&n.knownActions[0]),this._addInactiveAction(t,i,e)}for(var r=t._propertyBindings,o=0,a=r.length;o!==a;++o){var s=r[o];0==s.useCount++&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(t)}},_deactivateAction:function(t){if(this._isActiveAction(t)){for(var e=t._propertyBindings,i=0,n=e.length;i!==n;++i){var r=e[i];0==--r.useCount&&(r.restoreOriginalState(),this._takeBackBinding(r))}this._takeBackAction(t)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}},_isActiveAction:function(t){var e=t._cacheIndex;return null!==e&&e<this._nActiveActions},_addInactiveAction:function(t,e,i){var n=this._actions,r=this._actionsByClip,o=r[e];if(void 0===o)o={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,r[e]=o;else{var a=o.knownActions;t._byClipCacheIndex=a.length,a.push(t)}t._cacheIndex=n.length,n.push(t),o.actionByRoot[i]=t},_removeInactiveAction:function(t){var e=this._actions,i=e[e.length-1],n=t._cacheIndex;e[i._cacheIndex=n]=i,e.pop(),t._cacheIndex=null;var r=t._clip.uuid,o=this._actionsByClip,a=o[r],s=a.knownActions,l=s[s.length-1],h=t._byClipCacheIndex;s[l._byClipCacheIndex=h]=l,s.pop(),t._byClipCacheIndex=null,delete a.actionByRoot[(e._localRoot||this._root).uuid],0===s.length&&delete o[r],this._removeInactiveBindingsForAction(t)},_removeInactiveBindingsForAction:function(t){for(var e=t._propertyBindings,i=0,n=e.length;i!==n;++i){var r=e[i];0==--r.referenceCount&&this._removeInactiveBinding(r)}},_lendAction:function(t){var e=this._actions,i=t._cacheIndex,n=this._nActiveActions++,r=e[n];e[t._cacheIndex=n]=t,e[r._cacheIndex=i]=r},_takeBackAction:function(t){var e=this._actions,i=t._cacheIndex,n=--this._nActiveActions,r=e[n];e[t._cacheIndex=n]=t,e[r._cacheIndex=i]=r},_addInactiveBinding:function(t,e,i){var n=this._bindingsByRootAndName,r=n[e],o=this._bindings;void 0===r&&(r={},n[e]=r),(r[i]=t)._cacheIndex=o.length,o.push(t)},_removeInactiveBinding:function(t){var e=this._bindings,i=t.binding,n=i.rootNode.uuid,r=i.path,o=this._bindingsByRootAndName,a=o[n],s=e[e.length-1],l=t._cacheIndex;e[s._cacheIndex=l]=s,e.pop(),delete a[r];t:{for(var h in a)break t;delete o[n]}},_lendBinding:function(t){var e=this._bindings,i=t._cacheIndex,n=this._nActiveBindings++,r=e[n];e[t._cacheIndex=n]=t,e[r._cacheIndex=i]=r},_takeBackBinding:function(t){var e=this._bindings,i=t._cacheIndex,n=--this._nActiveBindings,r=e[n];e[t._cacheIndex=n]=t,e[r._cacheIndex=i]=r},_lendControlInterpolant:function(){var t=this._controlInterpolants,e=this._nActiveControlInterpolants++,i=t[e];return void 0===i&&(t[(i=new jW(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer)).__cacheIndex=e]=i),i},_takeBackControlInterpolant:function(t){var e=this._controlInterpolants,i=t.__cacheIndex,n=--this._nActiveControlInterpolants,r=e[n];e[t.__cacheIndex=n]=t,e[r.__cacheIndex=i]=r},_controlInterpolantsResultBuffer:new Float32Array(1)}),Object.assign(bZ.prototype,pN.prototype),MZ.prototype.clone=function(){return new MZ(void 0===this.value.clone?this.value:this.value.clone())},((SZ.prototype=Object.create(gH.prototype)).constructor=SZ).prototype.isInstancedBufferGeometry=!0,SZ.prototype.addGroup=function(t,e,i){this.groups.push({start:t,count:e,materialIndex:i})},SZ.prototype.copy=function(t){var e=t.index;null!==e&&this.setIndex(e.clone());var i=t.attributes;for(var n in i){var r=i[n];this.addAttribute(n,r.clone())}for(var o=t.groups,a=0,s=o.length;a<s;a++){var l=o[a];this.addGroup(l.start,l.count,l.materialIndex)}return this},TZ.prototype={constructor:TZ,isInterleavedBufferAttribute:!0,get count(){return this.data.count},get array(){return this.data.array},setX:function(t,e){return this.data.array[t*this.data.stride+this.offset]=e,this},setY:function(t,e){return this.data.array[t*this.data.stride+this.offset+1]=e,this},setZ:function(t,e){return this.data.array[t*this.data.stride+this.offset+2]=e,this},setW:function(t,e){return this.data.array[t*this.data.stride+this.offset+3]=e,this},getX:function(t){return this.data.array[t*this.data.stride+this.offset]},getY:function(t){return this.data.array[t*this.data.stride+this.offset+1]},getZ:function(t){return this.data.array[t*this.data.stride+this.offset+2]},getW:function(t){return this.data.array[t*this.data.stride+this.offset+3]},setXY:function(t,e,i){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=i,this},setXYZ:function(t,e,i,n){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=i,this.data.array[t+2]=n,this},setXYZW:function(t,e,i,n,r){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=i,this.data.array[t+2]=n,this.data.array[t+3]=r,this}},CZ.prototype={constructor:CZ,isInterleavedBuffer:!0,set needsUpdate(t){!0===t&&this.version++},setArray:function(t){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.count=void 0!==t?t.length/this.stride:0,this.array=t},setDynamic:function(t){return this.dynamic=t,this},copy:function(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.dynamic=t.dynamic,this},copyAt:function(t,e,i){t*=this.stride,i*=e.stride;for(var n=0,r=this.stride;n<r;n++)this.array[t+n]=e.array[i+n];return this},set:function(t,e){return void 0===e&&(e=0),this.array.set(t,e),this},clone:function(){return(new this.constructor).copy(this)},onUpload:function(t){return this.onUploadCallback=t,this}},((AZ.prototype=Object.create(CZ.prototype)).constructor=AZ).prototype.isInstancedInterleavedBuffer=!0,AZ.prototype.copy=function(t){return CZ.prototype.copy.call(this,t),this.meshPerAttribute=t.meshPerAttribute,this},((EZ.prototype=Object.create(BV.prototype)).constructor=EZ).prototype.isInstancedBufferAttribute=!0,EZ.prototype.copy=function(t){return BV.prototype.copy.call(this,t),this.meshPerAttribute=t.meshPerAttribute,this},PZ.prototype={constructor:PZ,linePrecision:1,set:function(t,e){this.ray.set(t,e)},setFromCamera:function(t,e){e&&e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize()):e&&e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld)):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(t,e){var i=[];return IZ(t,this,i,e),i.sort(LZ),i},intersectObjects:function(t,e){var i=[];if(!1===Array.isArray(t))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),i;for(var n=0,r=t.length;n<r;n++)IZ(t[n],this,i,e);return i.sort(LZ),i}},RZ.prototype={constructor:RZ,start:function(){this.startTime=(performance||Date).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var t=0;if(this.autoStart&&!this.running&&this.start(),this.running){var e=(performance||Date).now();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}},DZ.prototype={constructor:DZ,set:function(t,e,i){return this.radius=t,this.phi=e,this.theta=i,this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this},makeSafe:function(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this},setFromVector3:function(t){return this.radius=t.length(),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t.x,t.z),this.phi=Math.acos(UB.clamp(t.y/this.radius,-1,1))),this}},OZ.prototype={constructor:OZ,set:function(t,e,i){return this.radius=t,this.theta=e,this.y=i,this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.radius=t.radius,this.theta=t.theta,this.y=t.y,this},setFromVector3:function(t){return this.radius=Math.sqrt(t.x*t.x+t.z*t.z),this.theta=Math.atan2(t.x,t.z),this.y=t.y,this}},((kZ.prototype=Object.create(mH.prototype)).constructor=kZ).prototype.createAnimation=function(t,e,i,n){var r={start:e,end:i,length:i-e+1,fps:n,duration:(i-e)/n,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1};this.animationsMap[t]=r,this.animationsList.push(r)},kZ.prototype.autoCreateAnimations=function(t){for(var e,i=/([a-z]+)_?(\d+)/i,n={},r=this.geometry,o=0,a=r.morphTargets.length;o<a;o++){var s=r.morphTargets[o].name.match(i);if(s&&1<s.length)n[l=s[1]]||(n[l]={start:1/0,end:-1/0}),o<(h=n[l]).start&&(h.start=o),o>h.end&&(h.end=o),e||(e=l)}for(var l in n){var h=n[l];this.createAnimation(l,h.start,h.end,t)}this.firstAnimation=e},kZ.prototype.setAnimationDirectionForward=function(t){var e=this.animationsMap[t];e&&(e.direction=1,e.directionBackwards=!1)},kZ.prototype.setAnimationDirectionBackward=function(t){var e=this.animationsMap[t];e&&(e.direction=-1,e.directionBackwards=!0)},kZ.prototype.setAnimationFPS=function(t,e){var i=this.animationsMap[t];i&&(i.fps=e,i.duration=(i.end-i.start)/i.fps)},kZ.prototype.setAnimationDuration=function(t,e){var i=this.animationsMap[t];i&&(i.duration=e,i.fps=(i.end-i.start)/i.duration)},kZ.prototype.setAnimationWeight=function(t,e){var i=this.animationsMap[t];i&&(i.weight=e)},kZ.prototype.setAnimationTime=function(t,e){var i=this.animationsMap[t];i&&(i.time=e)},kZ.prototype.getAnimationTime=function(t){var e=0,i=this.animationsMap[t];return i&&(e=i.time),e},kZ.prototype.getAnimationDuration=function(t){var e=-1,i=this.animationsMap[t];return i&&(e=i.duration),e},kZ.prototype.playAnimation=function(t){var e=this.animationsMap[t];e?(e.time=0,e.active=!0):console.warn("THREE.MorphBlendMesh: animation["+t+"] undefined in .playAnimation()")},kZ.prototype.stopAnimation=function(t){var e=this.animationsMap[t];e&&(e.active=!1)},kZ.prototype.update=function(t){for(var e=0,i=this.animationsList.length;e<i;e++){var n=this.animationsList[e];if(n.active){var r=n.duration/n.length;n.time+=n.direction*t,n.mirroredLoop?(n.time>n.duration||n.time<0)&&(n.direction*=-1,n.time>n.duration&&(n.time=n.duration,n.directionBackwards=!0),n.time<0&&(n.time=0,n.directionBackwards=!1)):(n.time=n.time%n.duration,n.time<0&&(n.time+=n.duration));var o=n.start+UB.clamp(Math.floor(n.time/r),0,n.length-1),a=n.weight;o!==n.currentFrame&&(this.morphTargetInfluences[n.lastFrame]=0,this.morphTargetInfluences[n.currentFrame]=1*a,this.morphTargetInfluences[o]=0,n.lastFrame=n.currentFrame,n.currentFrame=o);var s=n.time%r/r;n.directionBackwards&&(s=1-s),n.currentFrame!==n.lastFrame?(this.morphTargetInfluences[n.currentFrame]=s*a,this.morphTargetInfluences[n.lastFrame]=(1-s)*a):this.morphTargetInfluences[n.currentFrame]=a}}},((zZ.prototype=Object.create(DV.prototype)).constructor=zZ).prototype.isImmediateRenderObject=!0,((NZ.prototype=Object.create(gU.prototype)).constructor=NZ).prototype.update=(Fj=new mF,Gj=new mF,Vj=new JG,function(){var t=["a","b","c"];this.object.updateMatrixWorld(!0),Vj.getNormalMatrix(this.object.matrixWorld);var e=this.object.matrixWorld,i=this.geometry.attributes.position,n=this.object.geometry;if(n&&n.isGeometry)for(var r=n.vertices,o=n.faces,a=0,s=0,l=o.length;s<l;s++)for(var h=o[s],c=0,u=h.vertexNormals.length;c<u;c++){var d=r[h[t[c]]],p=h.vertexNormals[c];Fj.copy(d).applyMatrix4(e),Gj.copy(p).applyMatrix3(Vj).normalize().multiplyScalar(this.size).add(Fj),i.setXYZ(a,Fj.x,Fj.y,Fj.z),a+=1,i.setXYZ(a,Gj.x,Gj.y,Gj.z),a+=1}else if(n&&n.isBufferGeometry){var f=n.attributes.position,g=n.attributes.normal;for(c=a=0,u=f.count;c<u;c++)Fj.set(f.getX(c),f.getY(c),f.getZ(c)).applyMatrix4(e),Gj.set(g.getX(c),g.getY(c),g.getZ(c)),Gj.applyMatrix3(Vj).normalize().multiplyScalar(this.size).add(Fj),i.setXYZ(a,Fj.x,Fj.y,Fj.z),a+=1,i.setXYZ(a,Gj.x,Gj.y,Gj.z),a+=1}return i.needsUpdate=!0,this}),((BZ.prototype=Object.create(DV.prototype)).constructor=BZ).prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},BZ.prototype.update=(Hj=new mF,Uj=new mF,function(){var t=this.light.distance?this.light.distance:1e3,e=t*Math.tan(this.light.angle);this.cone.scale.set(e,e,t),Hj.setFromMatrixPosition(this.light.matrixWorld),Uj.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(Uj.sub(Hj)),this.cone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)}),((FZ.prototype=Object.create(gU.prototype)).constructor=FZ).prototype.getBoneList=function(t){var e=[];t&&t.isBone&&e.push(t);for(var i=0;i<t.children.length;i++)e.push.apply(e,this.getBoneList(t.children[i]));return e},FZ.prototype.update=(Wj=new mF,jj=new vF,Zj=new vF,function(){var t=this.geometry,e=t.getAttribute("position");Zj.getInverse(this.root.matrixWorld);for(var i=0,n=0;i<this.bones.length;i++){var r=this.bones[i];r.parent&&r.parent.isBone&&(jj.multiplyMatrices(Zj,r.matrixWorld),Wj.setFromMatrixPosition(jj),e.setXYZ(n,Wj.x,Wj.y,Wj.z),jj.multiplyMatrices(Zj,r.parent.matrixWorld),Wj.setFromMatrixPosition(jj),e.setXYZ(n+1,Wj.x,Wj.y,Wj.z),n+=2)}t.getAttribute("position").needsUpdate=!0}),((GZ.prototype=Object.create(mH.prototype)).constructor=GZ).prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},GZ.prototype.update=function(){this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)},((VZ.prototype=Object.create(DV.prototype)).constructor=VZ).prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose(),this.children[1].geometry.dispose(),this.children[1].material.dispose()},VZ.prototype.update=(Xj=new mF,qj=new mF,function(){var t=this.children[0],e=this.children[1];if(this.light.target){Xj.setFromMatrixPosition(this.light.matrixWorld),qj.setFromMatrixPosition(this.light.target.matrixWorld);var i=qj.clone().sub(Xj);t.lookAt(i),e.lookAt(i)}t.material.color.copy(this.light.color).multiplyScalar(this.light.intensity),e.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);var n=.5*this.light.width,r=.5*this.light.height,o=t.geometry.getAttribute("position"),a=o.array;a[0]=n,a[1]=-r,a[2]=0,a[3]=n,a[4]=r,a[5]=0,a[6]=-n,a[7]=r,a[8]=0,a[9]=-n,a[10]=r,a[11]=0,a[12]=-n,a[13]=-r,a[14]=0,a[15]=n,a[16]=-r,a[17]=0,o.needsUpdate=!0}),((HZ.prototype=Object.create(DV.prototype)).constructor=HZ).prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},HZ.prototype.update=(Yj=new mF,Jj=new rG,Kj=new rG,function(){var t=this.children[0],e=t.geometry.getAttribute("color");Jj.copy(this.light.color).multiplyScalar(this.light.intensity),Kj.copy(this.light.groundColor).multiplyScalar(this.light.intensity);for(var i=0,n=e.count;i<n;i++){var r=i<n/2?Jj:Kj;e.setXYZ(i,r.r,r.g,r.b)}t.lookAt(Yj.setFromMatrixPosition(this.light.matrixWorld).negate()),e.needsUpdate=!0}),(UZ.prototype=Object.create(gU.prototype)).constructor=UZ,(WZ.prototype=Object.create(gU.prototype)).constructor=WZ,((jZ.prototype=Object.create(gU.prototype)).constructor=jZ).prototype.update=(Qj=new mF,$j=new mF,tZ=new JG,function(){this.object.updateMatrixWorld(!0),tZ.getNormalMatrix(this.object.matrixWorld);for(var t=this.object.matrixWorld,e=this.geometry.attributes.position,i=this.object.geometry,n=i.vertices,r=i.faces,o=0,a=0,s=r.length;a<s;a++){var l=r[a],h=l.normal;Qj.copy(n[l.a]).add(n[l.b]).add(n[l.c]).divideScalar(3).applyMatrix4(t),$j.copy(h).applyMatrix3(tZ).normalize().multiplyScalar(this.size).add(Qj),e.setXYZ(o,Qj.x,Qj.y,Qj.z),o+=1,e.setXYZ(o,$j.x,$j.y,$j.z),o+=1}return e.needsUpdate=!0,this}),((ZZ.prototype=Object.create(DV.prototype)).constructor=ZZ).prototype.dispose=function(){var t=this.children[0],e=this.children[1];t.geometry.dispose(),t.material.dispose(),e.geometry.dispose(),e.material.dispose()},ZZ.prototype.update=(eZ=new mF,iZ=new mF,nZ=new mF,function(){eZ.setFromMatrixPosition(this.light.matrixWorld),iZ.setFromMatrixPosition(this.light.target.matrixWorld),nZ.subVectors(iZ,eZ);var t=this.children[0],e=this.children[1];t.lookAt(nZ),t.material.color.copy(this.light.color).multiplyScalar(this.light.intensity),e.lookAt(nZ),e.scale.z=nZ.length()}),((XZ.prototype=Object.create(gU.prototype)).constructor=XZ).prototype.update=function(){var l,h,c=new mF,u=new wH;function t(t,e,i,n){c.set(e,i,n).unproject(u);var r=h[t];if(void 0!==r)for(var o=l.getAttribute("position"),a=0,s=r.length;a<s;a++)o.setXYZ(r[a],c.x,c.y,c.z)}return function(){l=this.geometry,h=this.pointMap;u.projectionMatrix.copy(this.camera.projectionMatrix),t("c",0,0,-1),t("t",0,0,1),t("n1",-1,-1,-1),t("n2",1,-1,-1),t("n3",-1,1,-1),t("n4",1,1,-1),t("f1",-1,-1,1),t("f2",1,-1,1),t("f3",-1,1,1),t("f4",1,1,1),t("u1",.7,1.1,-1),t("u2",-.7,1.1,-1),t("u3",0,2,-1),t("cf1",-1,0,1),t("cf2",1,0,1),t("cf3",0,-1,1),t("cf4",0,1,1),t("cn1",-1,0,-1),t("cn2",1,0,-1),t("cn3",0,-1,-1),t("cn4",0,1,-1),l.getAttribute("position").needsUpdate=!0}}(),((qZ.prototype=Object.create(gU.prototype)).constructor=qZ).prototype.update=(rZ=new qG,function(t){if(t&&t.isBox3?rZ.copy(t):rZ.setFromObject(t),!rZ.isEmpty()){var e=rZ.min,i=rZ.max,n=this.geometry.attributes.position,r=n.array;r[0]=i.x,r[1]=i.y,r[2]=i.z,r[3]=e.x,r[4]=i.y,r[5]=i.z,r[6]=e.x,r[7]=e.y,r[8]=i.z,r[9]=i.x,r[10]=e.y,r[11]=i.z,r[12]=i.x,r[13]=i.y,r[14]=e.z,r[15]=e.x,r[16]=i.y,r[17]=e.z,r[18]=e.x,r[19]=e.y,r[20]=e.z,r[21]=i.x,r[22]=e.y,r[23]=e.z,n.needsUpdate=!0,this.geometry.computeBoundingSphere()}}),((YZ.prototype=Object.create(DV.prototype)).constructor=YZ).prototype.setDirection=(lZ=new mF,function(t){.99999<t.y?this.quaternion.set(0,0,0,1):t.y<-.99999?this.quaternion.set(1,0,0,0):(lZ.set(t.z,0,-t.x).normalize(),sZ=Math.acos(t.y),this.quaternion.setFromAxisAngle(lZ,sZ))}),YZ.prototype.setLength=function(t,e,i){void 0===e&&(e=.2*t),void 0===i&&(i=.2*e),this.line.scale.set(1,Math.max(0,t-e),1),this.line.updateMatrix(),this.cone.scale.set(i,e,i),this.cone.position.y=t,this.cone.updateMatrix()},YZ.prototype.setColor=function(t){this.line.material.color.copy(t),this.cone.material.color.copy(t)},(JZ.prototype=Object.create(gU.prototype)).constructor=JZ;var QZ=new mF,$Z=new KZ,tX=new KZ,eX=new KZ;function iX(t){this.points=t||[],this.closed=!1}function nX(t,e,i,n){this.v0=t,this.v1=e,this.v2=i,this.v3=n}function rX(t,e,i){this.v0=t,this.v1=e,this.v2=i}function oX(t,e){this.v1=t,this.v2=e}function aX(t,e,i,n,r,o){fj.call(this,t,e,i,i,n,r,o)}((iX.prototype=Object.create(uj.prototype)).constructor=iX).prototype.getPoint=function(t){var e=this.points,i=e.length;i<2&&console.log("duh, you need at least 2 points");var n,r,o,a,s=(i-(this.closed?0:1))*t,l=Math.floor(s),h=s-l;if(this.closed?l+=0<l?0:(Math.floor(Math.abs(l)/e.length)+1)*e.length:0===h&&l===i-1&&(l=i-2,h=1),this.closed||0<l?n=e[(l-1)%i]:(QZ.subVectors(e[0],e[1]).add(e[0]),n=QZ),r=e[l%i],o=e[(l+1)%i],this.closed||l+2<i?a=e[(l+2)%i]:(QZ.subVectors(e[i-1],e[i-2]).add(e[i-1]),a=QZ),void 0===this.type||"centripetal"===this.type||"chordal"===this.type){var c="chordal"===this.type?.5:.25,u=Math.pow(n.distanceToSquared(r),c),d=Math.pow(r.distanceToSquared(o),c),p=Math.pow(o.distanceToSquared(a),c);d<1e-4&&(d=1),u<1e-4&&(u=d),p<1e-4&&(p=d),$Z.initNonuniformCatmullRom(n.x,r.x,o.x,a.x,u,d,p),tX.initNonuniformCatmullRom(n.y,r.y,o.y,a.y,u,d,p),eX.initNonuniformCatmullRom(n.z,r.z,o.z,a.z,u,d,p)}else if("catmullrom"===this.type){var f=void 0!==this.tension?this.tension:.5;$Z.initCatmullRom(n.x,r.x,o.x,a.x,f),tX.initCatmullRom(n.y,r.y,o.y,a.y,f),eX.initCatmullRom(n.z,r.z,o.z,a.z,f)}return new mF($Z.calc(h),tX.calc(h),eX.calc(h))},((nX.prototype=Object.create(uj.prototype)).constructor=nX).prototype.getPoint=function(t){var e=this.v0,i=this.v1,n=this.v2,r=this.v3;return new mF(cj(t,e.x,i.x,n.x,r.x),cj(t,e.y,i.y,n.y,r.y),cj(t,e.z,i.z,n.z,r.z))},((rX.prototype=Object.create(uj.prototype)).constructor=rX).prototype.getPoint=function(t){var e=this.v0,i=this.v1,n=this.v2;return new mF(hj(t,e.x,i.x,n.x),hj(t,e.y,i.y,n.y),hj(t,e.z,i.z,n.z))},((oX.prototype=Object.create(uj.prototype)).constructor=oX).prototype.getPoint=function(t){if(1===t)return this.v2.clone();var e=new mF;return e.subVectors(this.v2,this.v1),e.multiplyScalar(t),e.add(this.v1),e},(aX.prototype=Object.create(fj.prototype)).constructor=aX;var sX={createMultiMaterialObject:function(t,e){for(var i=new yU,n=0,r=e.length;n<r;n++)i.add(new mH(t,e[n]));return i},detach:function(t,e,i){t.applyMatrix(e.matrixWorld),e.remove(t),i.add(t)},attach:function(t,e,i){var n=new vF;n.getInverse(i.matrixWorld),t.applyMatrix(n),e.remove(t),i.add(t)}};var lX;function hX(t){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),iX.call(this,t),this.type="catmullrom",this.closed=!0}function cX(t){console.warn("THREE.SplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),iX.call(this,t),this.type="catmullrom"}function uX(t){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),iX.call(this,t),this.type="catmullrom"}uj.create=function(t,e){return console.log("THREE.Curve.create() has been deprecated"),t.prototype=Object.create(uj.prototype),(t.prototype.constructor=t).prototype.getPoint=e,t},hX.prototype=Object.create(iX.prototype),cX.prototype=Object.create(iX.prototype),uX.prototype=Object.create(iX.prototype),Object.assign(uX.prototype,{initFromArray:function(t){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(t){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(t){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}}),UZ.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},Object.assign(uG.prototype,{center:function(t){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(t)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(t){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},size:function(t){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(t)}}),Object.assign(qG.prototype,{center:function(t){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(t)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(t){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},isIntersectionSphere:function(t){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)},size:function(t){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(t)}}),OV.prototype.center=function(t){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(t)},UB.random16=function(){return console.warn("THREE.Math.random16() has been deprecated. Use Math.random() instead."),Math.random()},Object.assign(JG.prototype,{flattenToArrayOffset:function(t,e){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},multiplyVector3:function(t){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},multiplyVector3Array:function(t){return console.warn("THREE.Matrix3: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead."),this.applyToVector3Array(t)},applyToBuffer:function(t,e,i){return console.warn("THREE.Matrix3: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(t)},applyToVector3Array:function(t,e,i){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")}}),Object.assign(vF.prototype,{extractPosition:function(t){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(t)},flattenToArrayOffset:function(t,e){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},getPosition:function(){return void 0===lX&&(lX=new mF),console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),lX.setFromMatrixColumn(this,3)},setRotationFromQuaternion:function(t){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(t)},multiplyVector3:function(t){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},multiplyVector4:function(t){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},multiplyVector3Array:function(t){return console.warn("THREE.Matrix4: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead."),this.applyToVector3Array(t)},rotateAxis:function(t){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),t.transformDirection(this)},crossVector:function(t){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBuffer:function(t,e,i){return console.warn("THREE.Matrix4: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(t)},applyToVector3Array:function(t,e,i){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(t,e,i,n,r,o){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(t,e,n,i,r,o)}}),KG.prototype.isIntersectionLine=function(t){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(t)},gF.prototype.multiplyVector3=function(t){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),t.applyQuaternion(this)},Object.assign(tV.prototype,{isIntersectionBox:function(t){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},isIntersectionPlane:function(t){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(t)},isIntersectionSphere:function(t){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)}}),Object.assign(wj.prototype,{extrude:function(t){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new UU(this,t)},makeGeometry:function(t){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new KU(this,t)}}),Object.assign(WB.prototype,{fromAttribute:function(t,e,i){return console.error("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,i)}}),Object.assign(mF.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(t){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(t)},getScaleFromMatrix:function(t){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(t)},getColumnFromMatrix:function(t,e){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,t)},applyProjection:function(t){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(t)},fromAttribute:function(t,e,i){return console.error("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,i)}}),Object.assign(dF.prototype,{fromAttribute:function(t,e,i){return console.error("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,i)}}),fH.prototype.computeTangents=function(){console.warn("THREE.Geometry: .computeTangents() has been removed.")},Object.assign(DV.prototype,{getChildByName:function(t){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(t)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(t,e){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(e,t)}}),Object.defineProperties(DV.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(t){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=t}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.defineProperties(hU.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),bH.prototype.setLens=function(t,e){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==e&&(this.filmGauge=e),this.setFocalLength(t)},Object.defineProperties(AW.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(t){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=t}},shadowCameraLeft:{set:function(t){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=t}},shadowCameraRight:{set:function(t){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=t}},shadowCameraTop:{set:function(t){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=t}},shadowCameraBottom:{set:function(t){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=t}},shadowCameraNear:{set:function(t){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=t}},shadowCameraFar:{set:function(t){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=t}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(t){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=t}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(t){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=t}},shadowMapHeight:{set:function(t){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=t}}}),Object.defineProperties(BV.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}}}),Object.assign(gH.prototype,{addIndex:function(t){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(t)},addDrawCall:function(t,e,i){void 0!==i&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(t,e)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")}}),Object.defineProperties(gH.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.defineProperties(MZ.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),Object.defineProperties(jG.prototype,{wrapAround:{get:function(){console.warn("THREE."+this.type+": .wrapAround has been removed.")},set:function(){console.warn("THREE."+this.type+": .wrapAround has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE."+this.type+": .wrapRGB has been removed."),new rG}}}),Object.defineProperties(dW.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(ZG.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(t){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=t}}}),Object.assign(iU.prototype,{supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(t){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(t)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")}}),Object.defineProperties(iU.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=t}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=t}},shadowMapCullFace:{get:function(){return this.shadowMap.cullFace},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapCullFace is now .shadowMap.cullFace."),this.shadowMap.cullFace=t}}}),Object.defineProperties($G.prototype,{cullFace:{get:function(){return this.renderReverseSided?bN:wN},set:function(t){var e=t!==wN;console.warn("WebGLRenderer: .shadowMap.cullFace is deprecated. Set .shadowMap.renderReverseSided to "+e+"."),this.renderReverseSided=e}}}),Object.defineProperties(pF.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=t}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=t}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=t}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=t}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(t){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=t}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(t){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=t}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(t){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=t}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(t){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=t}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(t){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=t}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(t){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=t}}}),gZ.prototype.load=function(t){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var e=this;return(new cZ).load(t,function(t){e.setBuffer(t)}),this},vZ.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()};var dX={merge:function(t,e,i){var n;console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead."),e.isMesh&&(e.matrixAutoUpdate&&e.updateMatrix(),n=e.matrix,e=e.geometry),t.merge(e,n,i)},center:function(t){return console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),t.center()}},pX={crossOrigin:void 0,loadTexture:function(t,e,i,n){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var r=new CW;r.setCrossOrigin(this.crossOrigin);var o=r.load(t,i,void 0,n);return e&&(o.mapping=e),o},loadTextureCube:function(t,e,i,n){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var r=new TW;r.setCrossOrigin(this.crossOrigin);var o=r.load(t,i,void 0,n);return e&&(o.mapping=e),o},loadCompressedTexture:function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},loadCompressedTextureCube:function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")}};function fX(){console.error("THREE.CanvasRenderer has been moved to /examples/js/renderers/CanvasRenderer.js"),this.domElement=document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),this.clear=function(){},this.render=function(){},this.setClearColor=function(){},this.setSize=function(){}}var gX=Object.freeze({WebGLRenderTargetCube:fF,WebGLRenderTarget:pF,WebGLRenderer:iU,ShaderLib:cG,UniformsLib:hG,UniformsUtils:iG,ShaderChunk:nG,FogExp2:nU,Fog:rU,Scene:oU,LensFlare:aU,Sprite:lU,LOD:hU,SkinnedMesh:dU,Skeleton:cU,Bone:uU,Mesh:mH,LineSegments:gU,Line:fU,Points:vU,Group:yU,VideoTexture:_U,DataTexture:aG,CompressedTexture:xU,CubeTexture:yF,CanvasTexture:wU,DepthTexture:bU,Texture:uF,CompressedTextureLoader:bW,DataTextureLoader:MW,CubeTextureLoader:TW,TextureLoader:CW,ObjectLoader:sj,MaterialLoader:nj,BufferGeometryLoader:rj,DefaultLoadingManager:xW,LoadingManager:_W,JSONLoader:aj,ImageLoader:SW,FontLoader:Sj,FileLoader:wW,Loader:oj,Cache:yW,AudioLoader:cZ,SpotLightShadow:LW,SpotLight:IW,PointLight:RW,RectAreaLight:uZ,HemisphereLight:EW,DirectionalLightShadow:DW,DirectionalLight:OW,AmbientLight:kW,LightShadow:PW,Light:AW,StereoCamera:dZ,PerspectiveCamera:bH,OrthographicCamera:MH,CubeCamera:pZ,Camera:wH,AudioListener:fZ,PositionalAudio:mZ,AudioContext:hZ,AudioAnalyser:vZ,Audio:gZ,VectorKeyframeTrack:qW,StringKeyframeTrack:QW,QuaternionKeyframeTrack:JW,NumberKeyframeTrack:KW,ColorKeyframeTrack:tj,BooleanKeyframeTrack:$W,PropertyMixer:yZ,PropertyBinding:_Z,KeyframeTrack:ej,AnimationUtils:HW,AnimationObjectGroup:xZ,AnimationMixer:bZ,AnimationClip:ij,Uniform:MZ,InstancedBufferGeometry:SZ,BufferGeometry:gH,GeometryIdCount:pH,Geometry:fH,InterleavedBufferAttribute:TZ,InstancedInterleavedBuffer:AZ,InterleavedBuffer:CZ,InstancedBufferAttribute:EZ,Face3:zV,Object3D:DV,Raycaster:PZ,Layers:iV,EventDispatcher:pN,Clock:RZ,QuaternionLinearInterpolant:YW,LinearInterpolant:jW,DiscreteInterpolant:ZW,CubicInterpolant:WW,Interpolant:UW,Triangle:kV,Math:UB,Spherical:DZ,Cylindrical:OZ,Plane:KG,Frustum:QG,Sphere:YG,Ray:tV,Matrix4:vF,Matrix3:JG,Box3:qG,Box2:uG,Line3:OV,Euler:eV,Vector4:dF,Vector3:mF,Vector2:WB,Quaternion:gF,Color:rG,MorphBlendMesh:kZ,ImmediateRenderObject:zZ,VertexNormalsHelper:NZ,SpotLightHelper:BZ,SkeletonHelper:FZ,PointLightHelper:GZ,RectAreaLightHelper:VZ,HemisphereLightHelper:HZ,GridHelper:UZ,PolarGridHelper:WZ,FaceNormalsHelper:jZ,DirectionalLightHelper:ZZ,CameraHelper:XZ,BoxHelper:qZ,ArrowHelper:YZ,AxisHelper:JZ,CatmullRomCurve3:iX,CubicBezierCurve3:nX,QuadraticBezierCurve3:rX,LineCurve3:oX,ArcCurve:aX,EllipseCurve:fj,SplineCurve:gj,CubicBezierCurve:mj,QuadraticBezierCurve:vj,LineCurve:dj,Shape:wj,Path:xj,ShapePath:bj,Font:Mj,CurvePath:pj,Curve:uj,ShapeUtils:HU,SceneUtils:sX,WireframeGeometry:MU,ParametricGeometry:SU,ParametricBufferGeometry:TU,TetrahedronGeometry:EU,TetrahedronBufferGeometry:PU,OctahedronGeometry:LU,OctahedronBufferGeometry:IU,IcosahedronGeometry:RU,IcosahedronBufferGeometry:DU,DodecahedronGeometry:OU,DodecahedronBufferGeometry:kU,PolyhedronGeometry:CU,PolyhedronBufferGeometry:AU,TubeGeometry:zU,TubeBufferGeometry:NU,TorusKnotGeometry:BU,TorusKnotBufferGeometry:FU,TorusGeometry:GU,TorusBufferGeometry:VU,TextGeometry:WU,SphereGeometry:jU,SphereBufferGeometry:ZU,RingGeometry:XU,RingBufferGeometry:qU,PlaneGeometry:_H,PlaneBufferGeometry:xH,LatheGeometry:YU,LatheBufferGeometry:JU,ShapeGeometry:KU,ShapeBufferGeometry:QU,ExtrudeGeometry:UU,EdgesGeometry:$U,ConeGeometry:iW,ConeBufferGeometry:nW,CylinderGeometry:tW,CylinderBufferGeometry:eW,CircleGeometry:rW,CircleBufferGeometry:oW,BoxGeometry:vH,BoxBufferGeometry:yH,ShadowMaterial:sW,SpriteMaterial:sU,RawShaderMaterial:lW,ShaderMaterial:ZG,PointsMaterial:mU,MultiMaterial:hW,MeshPhysicalMaterial:uW,MeshStandardMaterial:cW,MeshPhongMaterial:dW,MeshToonMaterial:pW,MeshNormalMaterial:fW,MeshLambertMaterial:gW,MeshDepthMaterial:XG,MeshBasicMaterial:NV,LineDashedMaterial:mW,LineBasicMaterial:pU,Material:jG,Float64BufferAttribute:XV,Float32BufferAttribute:ZV,Uint32BufferAttribute:jV,Int32BufferAttribute:WV,Uint16BufferAttribute:UV,Int16BufferAttribute:HV,Uint8ClampedBufferAttribute:VV,Uint8BufferAttribute:GV,Int8BufferAttribute:FV,BufferAttribute:BV,REVISION:"84",MOUSE:{LEFT:0,MIDDLE:1,RIGHT:2},CullFaceNone:xN,CullFaceBack:wN,CullFaceFront:bN,CullFaceFrontBack:3,FrontFaceDirectionCW:0,FrontFaceDirectionCCW:1,BasicShadowMap:0,PCFShadowMap:MN,PCFSoftShadowMap:SN,FrontSide:TN,BackSide:CN,DoubleSide:AN,FlatShading:EN,SmoothShading:PN,NoColors:LN,FaceColors:1,VertexColors:2,NoBlending:IN,NormalBlending:RN,AdditiveBlending:DN,SubtractiveBlending:ON,MultiplyBlending:kN,CustomBlending:zN,AddEquation:NN,SubtractEquation:101,ReverseSubtractEquation:102,MinEquation:103,MaxEquation:104,ZeroFactor:200,OneFactor:201,SrcColorFactor:202,OneMinusSrcColorFactor:203,SrcAlphaFactor:BN,OneMinusSrcAlphaFactor:FN,DstAlphaFactor:206,OneMinusDstAlphaFactor:207,DstColorFactor:208,OneMinusDstColorFactor:209,SrcAlphaSaturateFactor:210,NeverDepth:GN,AlwaysDepth:VN,LessDepth:HN,LessEqualDepth:UN,EqualDepth:WN,GreaterEqualDepth:jN,GreaterDepth:ZN,NotEqualDepth:XN,MultiplyOperation:qN,MixOperation:YN,AddOperation:JN,NoToneMapping:KN,LinearToneMapping:QN,ReinhardToneMapping:$N,Uncharted2ToneMapping:tB,CineonToneMapping:eB,UVMapping:300,CubeReflectionMapping:iB,CubeRefractionMapping:nB,EquirectangularReflectionMapping:rB,EquirectangularRefractionMapping:oB,SphericalReflectionMapping:aB,CubeUVReflectionMapping:sB,CubeUVRefractionMapping:lB,RepeatWrapping:hB,ClampToEdgeWrapping:cB,MirroredRepeatWrapping:uB,NearestFilter:dB,NearestMipMapNearestFilter:pB,NearestMipMapLinearFilter:fB,LinearFilter:gB,LinearMipMapNearestFilter:1007,LinearMipMapLinearFilter:mB,UnsignedByteType:vB,ByteType:1010,ShortType:1011,UnsignedShortType:yB,IntType:1013,UnsignedIntType:_B,FloatType:xB,HalfFloatType:wB,UnsignedShort4444Type:1017,UnsignedShort5551Type:1018,UnsignedShort565Type:1019,UnsignedInt248Type:bB,AlphaFormat:1021,RGBFormat:MB,RGBAFormat:SB,LuminanceFormat:1024,LuminanceAlphaFormat:1025,RGBEFormat:TB,DepthFormat:CB,DepthStencilFormat:AB,RGB_S3TC_DXT1_Format:2001,RGBA_S3TC_DXT1_Format:2002,RGBA_S3TC_DXT3_Format:2003,RGBA_S3TC_DXT5_Format:2004,RGB_PVRTC_4BPPV1_Format:2100,RGB_PVRTC_2BPPV1_Format:2101,RGBA_PVRTC_4BPPV1_Format:2102,RGBA_PVRTC_2BPPV1_Format:2103,RGB_ETC1_Format:2151,LoopOnce:2200,LoopRepeat:2201,LoopPingPong:2202,InterpolateDiscrete:EB,InterpolateLinear:PB,InterpolateSmooth:2302,ZeroCurvatureEnding:LB,ZeroSlopeEnding:IB,WrapAroundEnding:RB,TrianglesDrawMode:DB,TriangleStripDrawMode:1,TriangleFanDrawMode:2,LinearEncoding:OB,sRGBEncoding:kB,GammaEncoding:zB,RGBEEncoding:NB,LogLuvEncoding:3003,RGBM7Encoding:BB,RGBM16Encoding:FB,RGBDEncoding:GB,BasicDepthPacking:VB,RGBADepthPacking:HB,CubeGeometry:vH,Face4:function(t,e,i,n,r,o,a){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new zV(t,e,i,r,o,a)},LineStrip:0,LinePieces:1,MeshFaceMaterial:function(t){return console.warn("THREE.MeshFaceMaterial has been renamed to THREE.MultiMaterial."),new hW(t)},PointCloud:function(t,e){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new vU(t,e)},Particle:function(t){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new lU(t)},ParticleSystem:function(t,e){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new vU(t,e)},PointCloudMaterial:function(t){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new mU(t)},ParticleBasicMaterial:function(t){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new mU(t)},ParticleSystemMaterial:function(t){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new mU(t)},Vertex:function(t,e,i){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new mF(t,e,i)},DynamicBufferAttribute:function(t,e){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setDynamic( true ) instead."),new BV(t,e).setDynamic(!0)},Int8Attribute:function(t,e){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new FV(t,e)},Uint8Attribute:function(t,e){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new GV(t,e)},Uint8ClampedAttribute:function(t,e){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new VV(t,e)},Int16Attribute:function(t,e){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new HV(t,e)},Uint16Attribute:function(t,e){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new UV(t,e)},Int32Attribute:function(t,e){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new WV(t,e)},Uint32Attribute:function(t,e){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new jV(t,e)},Float32Attribute:function(t,e){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new ZV(t,e)},Float64Attribute:function(t,e){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new XV(t,e)},ClosedSplineCurve3:hX,SplineCurve3:cX,Spline:uX,BoundingBoxHelper:function(t,e){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new qZ(t,e)},EdgesHelper:function(t,e){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new gU(new $U(t.geometry),new pU({color:void 0!==e?e:16777215}))},WireframeHelper:function(t,e){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new gU(new MU(t.geometry),new pU({color:void 0!==e?e:16777215}))},XHRLoader:function(t){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new wW(t)},BinaryTextureLoader:function(t){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new MW(t)},GeometryUtils:dX,ImageUtils:pX,Projector:function(){console.error("THREE.Projector has been moved to /examples/js/renderers/Projector.js."),this.projectVector=function(t,e){console.warn("THREE.Projector: .projectVector() is now vector.project()."),t.project(e)},this.unprojectVector=function(t,e){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject()."),t.unproject(e)},this.pickingRay=function(){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")}},CanvasRenderer:fX}),mX=Math.PI/180,vX=function(t){function e(){return u(this,e),v(this,t.apply(this,arguments))}return m(e,t),e.prototype.draw=function(){this.renderScene()},e.prototype.drawOnInteracting=function(){this.renderScene()},e.prototype.coordinateToVector3=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=this.getMap();if(!i)return null;var n=i.coordinateToPoint(t,_X(i));return new mF(n.x,n.y,-e)},e.prototype.distanceToVector3=function(t,e,i){var n=this.getMap(),r=_X(n),o=i||n.getCenter(),a=n.locate(o,t,e),s=n.coordinateToPoint(o,r),l=n.coordinateToPoint(a,r);return new mF(Math.abs(l.x-s.x)*N(t),Math.abs(l.y-s.y)*N(e),0)},e.prototype.toShape=function(t){var e=this;if(!t)return null;if(t instanceof $n)return t.getGeometries().map(function(t){return e.toShape(t)});var i=t.getCenter(),n=this.coordinateToVector3(i),r=new wj(t.getShell().map(function(t){return e.coordinateToVector3(t).sub(n)})),o=t.getHoles();return o&&0<o.length&&(r.holes=o.map(function(t){return new wj(t.map(function(t){return e.coordinateToVector3(t).sub(n)}))})),r},e.prototype.toExtrudeMesh=function(t,e,i,n){var r=this;if(!t)return null;if(t instanceof $n)return t.getGeometries().map(function(t){return r.toExtrudeGeometry(t,e,i,n)});var o=t.getCoordinates();o.forEach(function(t){for(var e=t.length-1;1<=e;e--)t[e].equals(t[e-1])&&t.splice(e,1)}),t.setCoordinates(o);var a=this.toShape(t),s=this.coordinateToVector3(t.getCenter());n=w(n)?this.distanceToVector3(n,n).x:e;var l=this.distanceToVector3(e,e).x,h=new UU(a,{amount:n,bevelEnabled:!0}),c=new gH;c.fromGeometry(h);var u=new mH(c,i);return u.position.set(s.x,s.y,-l),u},e.prototype.clearMesh=function(){var t=this.getScene();if(!t)return this;for(var e=t.children.length-1;0<=e;e--)t.children[e]instanceof mH&&t.remove(t.children[e]);return this},e.prototype.lookAt=function(t){var e=this._getRenderer();return e&&e.context.lookAt(t),this},e.prototype.getCamera=function(){var t=this._getRenderer();return t?t.camera:null},e.prototype.getScene=function(){var t=this._getRenderer();return t?t.scene:null},e.prototype.renderScene=function(){var t=this._getRenderer();return t?t.renderScene():this},e.prototype.getThreeRenderer=function(){var t=this._getRenderer();return t?t.context:null},e.prototype._getFovRatio=function(){var t=this.getMap().getFov();return Math.tan(t/2*mX)},e}($o);vX.mergeOptions({renderer:"gl",doubleBuffer:!0,glOptions:null});var yX=function(t){function e(){return u(this,e),v(this,t.apply(this,arguments))}return m(e,t),e.prototype.getPrepareParams=function(){return[this.scene,this.camera]},e.prototype.getDrawParams=function(){return[this.scene,this.camera]},e.prototype._drawLayer=function(){t.prototype._drawLayer.apply(this,arguments),this.renderScene()},e.prototype.hitDetect=function(){return!1},e.prototype.createCanvas=function(){if(!this.canvas){var t=this.getMap().getSize(),e=ae.retina?2:1,i=e*t.width,n=e*t.height;if(this.layer._canvas){var r=this.layer._canvas;r.width=i,r.height=n,r.style&&(r.style.width=t.width+"px",r.style.height=t.height+"px"),this.canvas=this.layer._canvas}else this.canvas=ni.createCanvas(i,n);this._initThreeRenderer(),this.onCanvasCreate(),this.layer.fire("canvascreate",{context:this.context,gl:this.gl})}},e.prototype._initThreeRenderer=function(){var t,e=this.getMap(),i=e.getSize(),n=this.layer.options.renderer;"gl"===n?((t=new iU(_({canvas:this.canvas,alpha:!0,preserveDrawingBuffer:!0},this.layer.options.glOptions))).autoClear=!1,t.clear()):"canvas"===n&&(t=new fX(_({canvas:this.canvas,alpha:!0},this.layer.options.glOptions))),t.setSize(this.canvas.width,this.canvas.height),t.setClearColor(new rG(1,1,1),0),t.canvas=this.canvas,this.context=t;var r=e.getScale(e.getMinZoom())/e.getScale(_X(e))*i.height/2/this.layer._getFovRatio(),o=this.scene=new oU,a=e.getFov(),s=this.camera=new bH(a,i.width/i.height,1,r);o.add(s)},e.prototype.onCanvasCreate=function(){t.prototype.onCanvasCreate.call(this),this.layer.onCanvasCreate(this.context,this.scene,this.camera)},e.prototype.resizeCanvas=function(t){if(this.canvas){var e;e=t||this.getMap().getSize();var i=ae.retina?2:1;this.canvas.height=i*e.height,this.canvas.width=i*e.width,this.camera.aspect=this.canvas.width/this.canvas.height,this.camera.updateProjectionMatrix(),this.context.setSize(this.canvas.width,this.canvas.height)}},e.prototype.clearCanvas=function(){this.canvas&&this.context.clear()},e.prototype.prepareCanvas=function(){return this.canvas?this.clearCanvas():this.createCanvas(),this.layer.fire("renderstart",{context:this.context}),null},e.prototype.renderScene=function(){this._locateCamera(),this.context.render(this.scene,this.camera),this.completeRender()},e.prototype.remove=function(){delete this._drawContext,t.prototype.remove.call(this)},e.prototype._locateCamera=function(){var t=this.getMap(),e=t.getSize(),i=t.getScale(),n=this.camera,r=t.coordinateToPoint(t.getCenter(),_X(t)),o=t.getPitch()*mX,a=t.getBearing()*mX,s=this.layer._getFovRatio(),l=-i*e.height/2/s;n.position.z=l*Math.cos(o);var h=Math.sin(o)*l;n.position.x=r.x+h*Math.sin(a),n.position.y=r.y-h*Math.cos(a),n.up.set(Math.sin(a),-Math.cos(a),0),n.lookAt(new mF(r.x,r.y,0)),n.updateProjectionMatrix()},e}(Ko);function _X(t){return t.getMaxNativeZoom()}vX.registerRenderer("canvas",yX),vX.registerRenderer("gl",yX),vX.THREE=gX;var xX=d+"_edit_stage_";function wX(t,e){return{markerType:t,markerFill:"#fff",markerLineColor:"#000",markerLineWidth:2,markerWidth:10,markerHeight:10,opacity:e}}var bX={fixAspectRatio:!1,symbol:null,removeVertexOn:"contextmenu",centerHandleSymbol:wX("ellipse",1),vertexHandleSymbol:wX("square",1),newVertexHandleSymbol:wX("square",.4)},MX=function(n){function r(t,e){u(this,r);var i=v(this,n.call(this,e));return i._geometry=t,i._geometry?i:v(i)}return m(r,n),r.prototype.getMap=function(){return this._geometry.getMap()},r.prototype.prepare=function(){this.getMap()&&(this.options.symbol&&(this._originalSymbol=this._geometry.getSymbol(),this._geometry.setSymbol(this.options.symbol)),this._prepareEditStageLayer())},r.prototype._prepareEditStageLayer=function(){var t=this.getMap(),e=L(),i=xX+e,n=xX+e+"_shadow";this._editStageLayer=t.getLayer(i),this._shadowLayer=t.getLayer(n),this._editStageLayer||(this._editStageLayer=new wr(i),t.addLayer(this._editStageLayer)),this._shadowLayer||(this._shadowLayer=new wr(n),t.addLayer(this._shadowLayer))},r.prototype.start=function(){var t=this;if(this._geometry&&this._geometry.getMap()&&!this._geometry.editing){var e=this.getMap();this.editing=!0;var i=this._geometry;this._geometryDraggble=i.options.draggable,i.config("draggable",!1),this.prepare();var n=i.copy();n.setSymbol(i._getInternalSymbol()),n.copyEventListeners(i),i._getParent()&&n.copyEventListeners(i._getParent()),n.setId(null).config({draggable:!1}),this._shadow=n,this._switchGeometryEvents("on"),i.hide(),(i instanceof Wn||i instanceof ir||i instanceof rr||i instanceof nr)&&this._createOrRefreshOutline(),this._shadowLayer.bringToFront().addGeometry(n),this._editStageLayer.bringToFront(),this._addListener([e,"zoomstart",function(){t._editStageLayer.hide()}]),this._addListener([e,"zoomend",function(){t._editStageLayer.show()}]),i instanceof Wn?(n.config("draggable",!0),n.on("dragend",this._onMarkerDragEnd,this)):this._createCenterHandle(),i instanceof Wn?this.createMarkerEditor():i instanceof ir?this.createCircleEditor():i instanceof rr?this.createEllipseOrRectEditor():i instanceof nr?this.createEllipseOrRectEditor():i instanceof or||(i instanceof Hn||i instanceof Zn)&&this.createPolygonEditor()}},r.prototype.stop=function(){delete this._history,delete this._historyPointer,delete this._editOutline,this._switchGeometryEvents("off"),this.getMap()&&(delete this._shadow,this._geometry.config("draggable",this._geometryDraggble),delete this._geometryDraggble,this._geometry.show(),this._editStageLayer.remove(),this._shadowLayer.remove(),this._clearAllListeners(),this._refreshHooks=[],this.options.symbol&&(this._geometry.setSymbol(this._originalSymbol),delete this._originalSymbol),this.editing=!1)},r.prototype.isEditing=function(){return!Y(this.editing)&&this.editing},r.prototype._getGeometryEvents=function(){return{symbolchange:this._onGeoSymbolChange,"positionchange shapechange":this._exeAndReset}},r.prototype._switchGeometryEvents=function(t){if(this._geometry){var e=this._getGeometryEvents();for(var i in e)this._geometry[t](i,e[i],this)}},r.prototype._onGeoSymbolChange=function(t){this._shadow&&this._shadow.setSymbol(t.target._getInternalSymbol())},r.prototype._onMarkerDragEnd=function(){this._update("setCoordinates",this._shadow.getCoordinates().toArray()),this._refresh()},r.prototype._createOrRefreshOutline=function(){var t=this._geometry,e=this._editOutline;return e?(e.remove(),this._editOutline=e=t.getOutline(),this._editStageLayer.addGeometry(e)):(e=t.getOutline(),this._editStageLayer.addGeometry(e),this._editOutline=e,this._addRefreshHook(this._createOrRefreshOutline)),e},r.prototype._createCenterHandle=function(){var e=this,t=this._shadow.getCenter(),i=this.options.centerHandleSymbol,n=void 0,r=this.createHandle(t,{symbol:i,cursor:"move",onDown:function(){var t=kt((n=e._shadow.copy())._getInternalSymbol(),.5);n.setSymbol(t).addTo(e._editStageLayer)},onMove:function(t,e){var i=e.coordOffset;n.translate(i)},onUp:function(){e._update("setCoordinates",yi.toNumberArrays(n.getCoordinates())),n.remove(),e._refresh()}});this._addRefreshHook(function(){var t=e._shadow.getCenter();r.setCoordinates(t)})},r.prototype._createHandleInstance=function(t,e){var i=e.symbol;return new Wn(t,{draggable:!0,dragShadow:!1,dragOnAxis:e.axis,cursor:e.cursor,symbol:i})},r.prototype.createHandle=function(t,i){i||(i={});var n=this.getMap(),r=this._createHandleInstance(t,i),o=this;function e(t){return i.onDown&&i.onDown.call(o,t.viewPoint,t),!1}function a(t){o._hideContext();var e=n._prjToViewPoint(r._getPrjCoordinates());return i.onMove&&i.onMove.call(o,e,t),!1}function s(t){return i.onUp&&i.onUp.call(o,t),!1}return r.on("dragstart",e,this),r.on("dragging",a,this),r.on("dragend",s,this),r.on("removestart",function t(){r.config("draggable",!1),r.off("dragstart",e,o),r.off("dragging",a,o),r.off("dragend",s,o),r.off("removestart",t,o),delete r["mapcan--editor-refresh-fn"]},this),i.onRefresh&&(r["mapcan--editor-refresh-fn"]=i.onRefresh),this._editStageLayer.addGeometry(r),r},r.prototype._createResizeHandles=function(a,s,l){var h=this,c=["nw-resize","n-resize","ne-resize","w-resize","e-resize","sw-resize","s-resize","se-resize"],u=[null,"y",null,"x","x",null,"y",null],d=this._geometry;a||(a=[]);var p=this,f=[],g={},m=this.getMap(),v=this.options.vertexHandleSymbol,t=function(){for(var t,e=d._getPainter().get2DExtent(),o=[(t=e).getMin(),new le((t.xmax+t.xmin)/2,t.ymin),new le(t.xmax,t.ymin),new le(t.xmin,(t.ymax+t.ymin)/2),new le(t.xmax,(t.ymax+t.ymin)/2),new le(t.xmin,t.ymax),new le((t.xmax+t.xmin)/2,t.ymax),t.getMax()],i=function(e){if(Array.isArray(a)&&a.some(function(t){return t===e}))return"continue";var i,t=o[e],n=m.pointToCoordinate(t);if(f.length<o.length-a.length){var r=h.createHandle(n,{symbol:v,cursor:c[e],axis:u[e],onMove:(i=e,function(t){p._updating=!0,s(t,i),d.fire("resizing")}),onUp:function(){p._updating=!1,l(),h._refresh()}});r.setId(e),g[e]=f.length,f.push(r)}else f[g[e]].setCoordinates(n)},n=0;n<o.length;n++)i(n)};return t(),this._addRefreshHook(t),f},r.prototype.createMarkerEditor=function(){var d=this,p=this._geometry,f=this._shadow,g=this.getMap();if(f._canEdit()){this._history||this._recordHistory(i());var t=f._getInternalSymbol(),m=new le(0,0);w(t.markerDx)&&(m.x=t.markerDx),w(t.markerDy)&&(m.y=t.markerDy);var v=null;gn.test(t)?"pin"!==t.markerType&&"pie"!==t.markerType&&"bar"!==t.markerType||(v=[5,6,7]):(vn.test(t)||wn.test(t))&&(v=[5,6,7]);var y=[2,1,2,0,0,2,1,2],_=void 0;if(this.options.fixAspectRatio){var e=f.getSize();_=e.width/e.height}var x=this._createResizeHandles(null,function(t,e){if(v&&0<=v.indexOf(e)){var i=g.viewPointToCoordinate(t.sub(m)),n=f.getCoordinates();i.x=n.x,f.setCoordinates(i),d._updateCoordFromShadow(!0);var r=x[x.length-1-e];t=g.coordToViewPoint(r.getCoordinates())}var o=g._pointToViewPoint(f._getCenter2DPoint()).add(m),a=f._getInternalSymbol(),s=t.sub(o);v&&t.y>o.y&&(s.y=0);var l=v?1:2,h=2*Math.abs(s.x),c=Math.abs(s.y)*l;_&&(c=(h=Math.max(h,c*_))/_);var u=y[e];f instanceof pr?((_||0===u||2===u)&&(f.setWidth(h),p.setWidth(h)),(_||1===u||2===u)&&(f.setHeight(c),p.setHeight(c))):((_||0===u||2===u)&&(a.markerWidth=h),(_||1===u||2===u)&&(a.markerHeight=c),f.setSymbol(a),p.setSymbol(a))},function(){d._update(i())});this._addListener([g,"zoomend",function(){this._refresh()}])}else console&&console.warn("A marker can't be resized with symbol:",f.getSymbol());function i(){var t=[["setCoordinates",f.getCoordinates().toArray()]];return f instanceof pr?(t.push(["setWidth",f.getWidth()]),t.push(["setHeight",f.getHeight()])):t.push(["setSymbol",f.getSymbol()]),t}},r.prototype.createCircleEditor=function(){var t=this,a=this._geometry,s=this._shadow,l=this.getMap();this._history||this._recordHistory([["setCoordinates",s.getCoordinates().toArray()],["setRadius",s.getRadius()]]),this._createResizeHandles(null,function(t){var e=l._pointToViewPoint(s._getCenter2DPoint()),i=t.sub(e),n=Math.abs(i.x),r=Math.abs(i.y),o=void 0;o=r<n?l.pixelToDistance(n,0):l.pixelToDistance(0,r),s.setRadius(o),a.setRadius(o)},function(){t._update("setRadius",s.getRadius())})},r.prototype.createEllipseOrRectEditor=function(){var p=this,f=[2,1,2,0,0,2,1,2],g=this._geometry,m=this._shadow;this._history||this._recordHistory(t());var v=this.getMap(),y=this._geometry instanceof rr,_=void 0;this.options.fixAspectRatio&&(_=g.getWidth()/g.getHeight());var x=this._createResizeHandles(null,function(t,e){var i=y?1:2,n=void 0,r=void 0,o=void 0,a=t,s=f[e];if(y){var l=x[7-e],h=v.coordToViewPoint(l.getCoordinates()),c=(n=a.sub(h)).abs();r=v.pixelToDistance(c.x,0),o=v.pixelToDistance(0,c.y);var u=g.getSize();0===s?(_&&(c.y=c.x/_,u.height=Math.abs(c.y),o=r/_),a.y=h.y-u.height/2):1===s?(_&&(c.x=c.y*_,u.width=Math.abs(c.x),r=o*_),a.x=h.x-u.width/2):_&&(o*_<r?(o=r/_,a.y=h.y+c.x*N(n.y)/_):(r=o*_,a.x=h.x+c.y*N(n.x)*_));var d=v.viewPointToCoordinate(new le(Math.min(a.x,h.x),Math.min(a.y,h.y)));m.setCoordinates(d),p._updateCoordFromShadow(!0)}else{n=v.coordToViewPoint(g.getCenter()).sub(a)._abs(),r=v.pixelToDistance(n.x,0),o=v.pixelToDistance(0,n.y),_&&(o=(r=Math.max(r,o*_))/_)}(_||0===s||2===s)&&(m.setWidth(r*i),g.setWidth(r*i)),(_||1===s||2===s)&&(m.setHeight(o*i),g.setHeight(o*i))},function(){p._update(t())});function t(){return[["setCoordinates",m.getCoordinates().toArray()],["setWidth",m.getWidth()],["setHeight",m.getHeight()]]}},r.prototype.createPolygonEditor=function(){var a=this.getMap(),s=this._shadow,l=this,h=a.getProjection();this._history||this._recordHistory("setCoordinates",yi.toNumberArrays(s.getCoordinates()));var r=s instanceof Hn?3:2,c="mapcan--editor-refresh-fn",u="mapcan--editor-vertex-index",o=[],d=[];function p(){if(s instanceof Hn){var t=s.getCoordinates()[0];return t.slice(0,t.length-1)}return s.getCoordinates()}function f(){return s._getPrjCoordinates()}function g(){for(var t=o.length-1;0<=t;t--)o[t][u]=t;for(var e=d.length-1;0<=e;e--)d[e][u]=e;l._updateCoordFromShadow()}function n(t){var e=t.target[u],i=f();if(!(i.length<=r)){i.splice(e,1),s._setPrjCoordinates(i),s._updateCache(),o.splice(e,1)[0].remove(),e<d.length&&d.splice(e,1)[0].remove();var n=void 0;n=0===e?d.length-1:e-1,d.splice(n,1)[0].remove(),d.splice(n,0,y.call(l,n)),g(),l._refresh()}}function m(t,e){var i=f(),n=a._viewPointToPrj(t),r=i[e];r.x=n.x,r.y=n.y,s._updateCache(),s.onShapeChanged(),l._updateCoordFromShadow(!0);var o=void 0;o=0===e?d.length-1:e-1,d[e]&&d[e][c](),d[o]&&d[o][c]()}function v(t){var e=p()[t],i=l.createHandle(e,{symbol:l.options.vertexHandleSymbol,cursor:"pointer",axis:null,onMove:function(t){m(t,i[u])},onRefresh:function(){e=p()[i[u]],i.setCoordinates(e)},onUp:function(){l._refresh(),l._updateCoordFromShadow()}});return i[u]=t,i.on(l.options.removeVertexOn,n),i}function y(t){var n=p(),e=void 0;e=t+1>=n.length?n[0]:n[t+1];var i=n[t].add(e).multi(.5),a=l.createHandle(i,{symbol:l.options.newVertexHandleSymbol,cursor:"pointer",axis:null,onDown:function(t,e){if(!e||!e.domEvent||2!==e.domEvent.button){var i=f(),n=a[u],r=h.project(a.getCoordinates());i.splice(n+1,0,r),s._setPrjCoordinates(i),s._updateCache();var o=a.getSymbol();delete o.opacity,a.setSymbol(o),d.splice(n,0,y.call(l,n),y.call(l,n+1))}},onMove:function(t){m(t,a[u]+1)},onUp:function(t){if(!t||!t.domEvent||2!==t.domEvent.button){var e=a[u];O(a,d),a.remove(),o.splice(e+1,0,v.call(l,e+1)),g(),l._updateCoordFromShadow(),l._refresh()}},onRefresh:function(){n=p();var t=a[u],e=void 0;e=t===n.length-1?0:t+1;var i=n[t].add(n[e]).multi(.5);a.setCoordinates(i)}});return a[u]=t,a}for(var t=p(),e=0,i=t.length;e<i;e++)o.push(v.call(this,e)),e<i-1&&d.push(y.call(this,e));s instanceof Hn&&d.push(y.call(this,t.length-1)),this._addRefreshHook(function(){for(var t=d.length-1;0<=t;t--)d[t][c]();for(var e=o.length-1;0<=e;e--)o[e][c]()})},r.prototype._refresh=function(){if(this._refreshHooks)for(var t=this._refreshHooks.length-1;0<=t;t--)this._refreshHooks[t].call(this)},r.prototype._hideContext=function(){this._geometry&&(this._geometry.closeMenu(),this._geometry.closeInfoWindow())},r.prototype._addListener=function(t){this._eventListeners||(this._eventListeners=[]),this._eventListeners.push(t),t[0].on(t[1],t[2],this)},r.prototype._clearAllListeners=function(){if(this._eventListeners&&0<this._eventListeners.length){for(var t=this._eventListeners.length-1;0<=t;t--){var e=this._eventListeners[t];e[0].off(e[1],e[2],this)}this._eventListeners=[]}},r.prototype._addRefreshHook=function(t){t&&(this._refreshHooks||(this._refreshHooks=[]),this._refreshHooks.push(t))},r.prototype._update=function(t){for(var e=arguments.length,i=Array(1<e?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];this._exeHistory([t,i]),this._recordHistory.apply(this,[t].concat(i))},r.prototype._updateCoordFromShadow=function(t){if(this._shadow){var e=this._shadow.getCoordinates(),i=this._geometry,n=this._updating;this._updating=!0,i.setCoordinates(e),t||this._recordHistory("setCoordinates",yi.toNumberArrays(i.getCoordinates())),this._updating=n}},r.prototype._recordHistory=function(t){this._history||(this._history=[],this._historyPointer=0),this._historyPointer<this._history.length-1&&this._history.splice(this._historyPointer+1);for(var e=arguments.length,i=Array(1<e?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];this._history.push([t,i]),this._historyPointer=this._history.length-1,this._geometry.fire("editrecord")},r.prototype.undo=function(){if(!this._history||0===this._historyPointer)return this;var t=this._history[--this._historyPointer];return this._exeAndReset(t),this},r.prototype.redo=function(){if(!this._history||this._historyPointer===this._history.length-1)return null;var t=this._history[++this._historyPointer];return this._exeAndReset(t),this},r.prototype._exeAndReset=function(t){if(!this._updating){this._exeHistory(t);var e=this._history,i=this._historyPointer;this.stop(),this._history=e,this._historyPointer=i,this.start()}},r.prototype._exeHistory=function(t){var n=this;if(Array.isArray(t)){var e=this._updating;this._updating=!0;var r=this._geometry;Array.isArray(t[0])?t[0].forEach(function(t){var e=t[0],i=t.slice(1);n._shadow[e].apply(n._shadow,i),r[e].apply(r,i)}):(this._shadow[t[0]].apply(this._shadow,t[1]),r[t[0]].apply(r,t[1])),this._updating=e}},r}(li(ci));MX.mergeOptions(bX);var SX={startEditText:function(){return this.getMap()&&(this.hide(),this.endEditText(),this._prepareEditor(),this._fireEvent("edittextstart")),this},endEditText:function(){if(this._textEditor){var t=this._textEditor.innerHTML;t=t.replace(/<p>/gi,"").replace(/<\/p>/gi,"<br/>"),this._textEditor.innerHTML=t;var e=this._textEditor.innerText.replace(/[\r\n]+$/gi,"");this.setContent(e),$e(this._textEditor,"mousedown dblclick",Be),this.getMap().off("mousedown",this.endEditText,this),this._editUIMarker.remove(),delete this._editUIMarker,this._textEditor.onkeyup=null,delete this._textEditor,this.show(),this._fireEvent("edittextend")}return this},isEditingText:function(){return!!this._textEditor},getTextEditor:function(){return this._editUIMarker},_prepareEditor:function(){var t=this.getMap(),e=this._createEditor();this._textEditor=e,t.on("mousedown",this.endEditText,this);var i=this._getEditorOffset();this._editUIMarker=new ho(this.getCoordinates(),{animation:null,content:e,dx:i.dx,dy:i.dy}).addTo(t),this._setCursorToLast(this._textEditor)},_getEditorOffset:function(){var t=this._getInternalSymbol()||{},e=0,i=0,n=t.textHorizontalAlignment;return"middle"===n||Y(n)?(e=(t.textDx||0)-2,i=(t.textDy||0)-2):(e=(t.markerDx||0)-2,i=(t.markerDy||0)-2),{dx:e,dy:i}},_createEditor:function(){var t=this.getContent(),e=this.getSize(),i=this._getInternalSymbol()||{},n=e.width,r=i.textFill||"#000000",o=i.textSize||12,a=e.height,s=i.markerLineColor||"#000",l=i.markerFill||"#3398CC",h=i.textLineSpacing||0,c=Ie("div");return c.contentEditable=!0,c.style.cssText="background:"+l+"; border:1px solid "+s+";\n            color:"+r+";font-size:"+o+"px;width:"+(n-2)+"px;height:"+(a-2)+"px;margin: auto;\n            line-height:"+(o+h)+"px;outline: 0; padding:0; margin:0;word-wrap: break-word;\n            overflow: hidden;-webkit-user-modify: read-write-plaintext-only;",c.innerText=t,Qe(c,"mousedown dblclick",Be),c.onkeyup=function(t){var e=c.style.height||0;13===t.keyCode&&(c.style.height=parseInt(e)+o/2+"px")},c},_setCursorToLast:function(t){var e=void 0;window.getSelection?(t.focus(),(e=window.getSelection()).selectAllChildren(t),e.collapseToEnd()):document.selection&&((e=document.selection.createRange()).moveToElementText(t),e.collapse(!1),e.select())}};dr.include(SX),Pn.include({animate:function(t,e,h){var c=this;this._animPlayer&&this._animPlayer.finish(),b(e)&&(h=e),e||(e={});var u=this.getMap(),d=this._getProjection(),p=this.getSymbol()||{},i=this._prepareAnimationStyles(t),f=void 0,g=e.focus;if(delete this._animationStarted,u){var n=u._getRenderer();e.framer=function(t){n.callInNextFrame(t)}}var m=Nn.animate(i,e,function(t){if(u&&u.isRemoved())m.finish();else{u&&!c._animationStarted&&g&&u.onMoveStart();var e=t.styles;for(var i in e)if("symbol"!==i&&"translate"!==i&&e.hasOwnProperty(i)){var n="set"+i[0].toUpperCase()+i.slice(1);c[n](e[i])}var r=e.translate;if(r){var o=r;f&&(o=r.sub(f)),f=r,c.translate(o)}var a=e.symbol;if(a&&c.setSymbol(zt(p,a)),u&&g){var s=d.project(c.getCenter());u._setPrjCenter(s);var l=u._parseEventFromCoord(d.unproject(s));"running"!==m.playState?u.onMoveEnd(l):u.onMoving(l)}c._fireAnimateEvent(m.playState),h&&h(t)}});return this._animPlayer=m,this._animPlayer.play()},_prepareAnimationStyles:function(t){var e=this._getInternalSymbol(),i={};for(var n in t)if(t.hasOwnProperty(n)){var r=t[n];if("translate"!==n&&"symbol"!==n){var o=this["get"+n[0].toUpperCase()+n.substring(1)]();i[n]=[o,r]}else if("symbol"===n){var a=void 0;if(Array.isArray(t.symbol)){if(!Array.isArray(e))throw new Error("geometry'symbol isn't a composite symbol, while the symbol in styles is.");a=[];for(var s=t.symbol,l=0;l<s.length;l++)if(s[l]){var h={};for(var c in s[l])s[l].hasOwnProperty(c)&&(h[c]=[e[l][c],s[l][c]]);a.push(h)}else a.push(null)}else{if(Array.isArray(e))throw new Error("geometry'symbol is a composite symbol, while the symbol in styles isn't.");for(var u in a={},r)r.hasOwnProperty(u)&&(a[u]=[e[u],r[u]])}i.symbol=a}else"translate"===n&&(i.translate=new yi(r))}return i},_fireAnimateEvent:function(t){"finished"===t?(delete this._animationStarted,this._fireEvent("animateend")):"running"===t&&(this._animationStarted?this._fireEvent("animating"):(this._fireEvent("animatestart"),this._animationStarted=!0))}});var TX=d+"_drag_stage",CX=ae.touch?"touchstart mousedown":"mousedown",AX=function(e){function i(t){return u(this,i),v(this,e.call(this,t))}return m(i,e),i.prototype.addHooks=function(){this.target.on(CX,this._startDrag,this)},i.prototype.removeHooks=function(){this._endDrag(),this.target.off(CX,this._startDrag,this),delete this.container},i.prototype._prepareDragHandler=function(){this._dragHandler=new vi(this.container),this._dragHandler.on("dragging",this._dragging,this).on("mouseup",this._endDrag,this).enable()},i.prototype._prepareShadow=function(){var t=this.target;this._prepareDragStageLayer(),this._shadow&&this._shadow.remove();var e=this._shadow=t.copy();if(this._shadow.setSymbol(t._getInternalSymbol()),t.options.dragShadow){var i=kt(e._getInternalSymbol(),.5);e.setSymbol(i)}e.setId(null),this._prepareShadowConnectors()},i.prototype._prepareShadowConnectors=function(){var t=this.target,e=this._shadow,i=this._dragStageLayer._getRenderer().resources,n=[];if(vr._hasConnectors(t))for(var r=vr._getConnectors(t),o=0,a=r.length;o<a;o++){var s=r[o],l=s.config(),h=s._getInternalSymbol();l.symbol=kt(h,.5);var c=void 0;c=s.getConnectSource()===t?new s.constructor(e,s.getConnectTarget(),l):new s.constructor(s.getConnectSource(),e,l),n.push(c),s.getLayer()&&s.getLayer()._getRenderer()&&i.merge(s.getLayer()._getRenderer().resources)}(this._shadowConnectors=n).push(e),this._dragStageLayer.bringToFront().addGeometry(n)},i.prototype._onTargetUpdated=function(){this._shadow&&this._shadow.setSymbol(this.target._getSymbol())},i.prototype._prepareDragStageLayer=function(){var t=this.target.getMap(),e=this.target.getLayer();this._dragStageLayer=t.getLayer(TX),this._dragStageLayer||(this._dragStageLayer=new wr(TX,{enableAltitude:e.options.enableAltitude,altitudeProperty:e.options.altitudeProperty}),t.addLayer(this._dragStageLayer));var i=new Yi;i.merge(e._getRenderer().resources),this._dragStageLayer._getRenderer().resources=i},i.prototype._startDrag=function(t){var e=this.target.getMap();if(e&&(!this.target._getParent()&&!this.isDragging())){var i=t.domEvent;i.touches&&1<i.touches.length||2===i.button||(this.container=e._panels.mapWrapper||e._containerDOM,this.target.on("click",this._endDrag,this),this._lastCoord=this._correctCoord(t.coordinate),this._lastPoint=t.containerPoint,this._prepareDragHandler(),this._dragHandler.onMouseDown(t.domEvent),Qe(this.container,"mouseleave",this._endDrag,this),this._startParam=t,this._moved=!1)}},i.prototype._dragging=function(t){var e=this.target,i=e.getMap()._parseEvent(t.domEvent),n=i.domEvent;if(!(n.touches&&1<n.touches.length)){if(!this._moved)return this._moved=!0,e.on("symbolchange",this._onTargetUpdated,this),this._isDragging=!0,this._prepareShadow(),e.options.dragShadow||e.hide(),this._shadow._fireEvent("dragstart",i),this.target._fireEvent("dragstart",this._startParam||i),void delete this._startParam;if(this._shadow){var r=this._shadow.options.dragOnAxis,o=this._correctCoord(i.coordinate),a=i.containerPoint;this._lastPoint=this._lastPoint||a,this._lastCoord=this._lastCoord||o;var s=a.sub(this._lastPoint),l=o.sub(this._lastCoord);"x"===r?s.y=l.y=0:"y"===r&&(s.x=l.x=0),this._lastPoint=a,this._lastCoord=o,this._shadow.translate(l),e.options.dragShadow||e.translate(l),i.coordOffset=l,i.pointOffset=s,this._shadow._fireEvent("dragging",i),e._fireEvent("dragging",i)}}},i.prototype._endDrag=function(t){if(this._dragHandler&&(this._dragHandler.disable(),delete this._dragHandler),this.container&&$e(this.container,"mouseleave",this._endDrag,this),this.target){var e=this.target;e.off("click",this._endDrag,this),e.off("symbolchange",this._onTargetUpdated,this),delete this._lastCoord,delete this._lastPoint,this._isDragging=!1;var i=e.getMap();if(this.enabled()&&i){var n=i._parseEvent(t?t.domEvent:null);this._updateTargetAndRemoveShadow(n),this._moved&&e._fireEvent("dragend",n)}}},i.prototype.isDragging=function(){return!!this._isDragging},i.prototype._updateTargetAndRemoveShadow=function(t){var e=this.target,i=e.getMap();e.options.dragShadow||e.show();var n=this._shadow;n&&(e.options.dragShadow&&e.setCoordinates(n.getCoordinates()),n._fireEvent("dragend",t),n.remove(),delete this._shadow),this._shadowConnectors&&(i.getLayer(TX).removeGeometry(this._shadowConnectors),delete this._shadowConnectors),this._dragStageLayer&&this._dragStageLayer.remove()},i.prototype._correctCoord=function(t){var e=this.target.getMap();if(!e.getPitch())return t;var i=this.target._getPainter();if(!i.getMinAltitude())return t;var n=(i.getMinAltitude()+i.getMaxAltitude())/2;return e.locateByPoint(t,0,-n)},i}(hi);Pn.mergeOptions({draggable:!1,dragShadow:!0,dragOnAxis:null}),Pn.addInitHook("addHandler","draggable",AX),Pn.include({isDragging:function(){return this._getParent()?this._getParent().isDragging():!!this.draggable&&this.draggable.isDragging()}}),Pn.include({startEdit:function(t){return this.getMap()&&this.options.editable&&(this.endEdit(),this._editor=new MX(this,t),this._editor.start(),this.fire("editstart")),this},endEdit:function(){return this._editor&&(this._editor.stop(),delete this._editor,this.fire("editend")),this},redoEdit:function(){return this.isEditing()&&(this._editor.redo(),this.fire("redoedit")),this},undoEdit:function(){return this.isEditing()&&(this._editor.undo(),this.fire("undoedit")),this},isEditing:function(){return!!this._editor&&this._editor.isEditing()}}),Pn.include({_onEvent:function(t,e){if(this.getMap()){var i=e||this._getEventTypeToFire(t);"contextmenu"===i&&this.listens("contextmenu")&&(Be(t),Ne(t));var n=this._getEventParams(t);this._fireEvent(i,n)}},_getEventTypeToFire:function(t){return t.type},_getEventParams:function(t){var e=this.getMap(),i={domEvent:t},n=t.touches&&0<t.touches.length?t.touches[0]:t.changedTouches&&0<t.changedTouches.length?t.changedTouches[0]:t;if(n){var r=He(n,e._containerDOM);i.coordinate=e.containerPointToCoordinate(r),i.containerPoint=r,i.viewPoint=e.containerPointToViewPoint(r),i.pont2d=e._containerPointToPoint(r)}return i}}),Pn.include({setInfoWindow:function(t){return this.removeInfoWindow(),t instanceof po?(this._infoWindow=t,this._infoWinOptions=_({},this._infoWindow.options),this._infoWindow.addTo(this)):(this._infoWinOptions=_({},t),this._infoWindow?this._infoWindow.setOptions(t):this.getMap()&&this._bindInfoWindow(this._infoWinOptions)),this},getInfoWindow:function(){return this._infoWindow?this._infoWindow:null},openInfoWindow:function(t){return this.getMap()&&(t||(t=this.getCenter()),this._infoWindow?this._infoWindow.show(t):this._infoWinOptions&&this.getMap()&&(this._bindInfoWindow(this._infoWinOptions),this._infoWindow.show(t))),this},closeInfoWindow:function(){return this._infoWindow&&this._infoWindow.hide(),this},removeInfoWindow:function(){return this._unbindInfoWindow(),delete this._infoWinOptions,delete this._infoWindow,this},_bindInfoWindow:function(t){return this._infoWindow=new po(t),this._infoWindow.addTo(this),this},_unbindInfoWindow:function(){return this._infoWindow&&(this.closeInfoWindow(),this._infoWindow.remove(),delete this._infoWindow),this}});var EX=function(){function i(t,e){u(this,i),this.max=t,this.onRemove=e,this.reset()}return i.prototype.reset=function(){for(var t in this.data)this.onRemove(this.data[t]);return this.data={},this.order=[],this},i.prototype.clear=function(){this.reset(),delete this.onRemove},i.prototype.add=function(t,e){if(this.has(t))this.order.splice(this.order.indexOf(t),1),this.data[t]=e,this.order.push(t);else if(this.data[t]=e,this.order.push(t),this.order.length>this.max){var i=this.getAndRemove(this.order[0]);i&&this.onRemove(i)}return this},i.prototype.has=function(t){return t in this.data},i.prototype.keys=function(){return this.order},i.prototype.getAndRemove=function(t){if(!this.has(t))return null;var e=this.data[t];return delete this.data[t],this.order.splice(this.order.indexOf(t),1),e},i.prototype.get=function(t){return this.has(t)?this.data[t]:null},i.prototype.remove=function(t){if(!this.has(t))return this;var e=this.data[t];return delete this.data[t],this.onRemove(e),this.order.splice(this.order.indexOf(t),1),this},i.prototype.setMaxSize=function(t){for(this.max=t;this.order.length>this.max;){var e=this.getAndRemove(this.order[0]);e&&this.onRemove(e)}return this},i}(),PX=function(i){function n(t){u(this,n);var e=v(this,i.call(this,t));return e.tilesInView={},e.tilesLoading={},e._parentTiles=[],e._childTiles=[],e.tileCache=new EX(t.options.maxCacheSize,e.deleteTile.bind(e)),e}return m(n,i),n.prototype.draw=function(){var t=this.getMap();if(this.isDrawable()){var e=this.prepareCanvas();if(!e||e.intersects(this._extent2D)){var i=this.layer.getTiles().tileGrids;if(i){this._tileCountToLoad=0;var n=!1,r={},o=[],a=[],s={},l=[],h={},c=[],u={},d={},p=this._markTiles(),f=this._getTileLimitOnInteracting(),g=i.length;this._tileZoom=i[0].zoom,this._tileOffset=i[0].offset;for(var m=0;m<g;m++)for(var v=i[m],y=v.tiles,_=this._generatePlaceHolder(v.zoom),x=0,w=y.length;x<w;x++){var b=y[x],M=b.id,S=this._getCachedTile(M),T=!1;if(this._isLoadingTile(M))T=n=!0,this.tilesLoading[M].current=!0;else if(S)this.getTileOpacity(S.image)<1&&(T=n=!0),o.push(S);else{T=n=!0,f&&this._tileCountToLoad+p[0]>f||t.isInteracting()&&!t.isMoving()&&!t.isRotating()||(this._tileCountToLoad++,d[M+"@"+b.point.toArray().join()]=b)}if(T&&!r[b.dupKey]){r[b.dupKey]=1,_&&!u[b.dupKey]&&(b.cache=!1,c.push({image:_,info:b}),u[b.dupKey]=1);var C=this._findParentTile(b);if(C){var A=C.info.dupKey;void 0===s[A]&&(s[A]=a.length,a.push(C))}else{var E=this._findChildTiles(b);E.length&&E.forEach(function(t){h[t.info.dupKey]||(l.push(t),h[t.info.dupKey]=1)})}}}this._drawTiles(o,a,l,c),0===this._tileCountToLoad?n||(!t.isAnimating()&&0<this._parentTiles.length&&(this._parentTiles=[],this._childTiles=[],this.setToRedraw()),this.completeRender()):this.loadTileQueue(d),this._retireTiles()}else this.completeRender()}else this.completeRender()}},n.prototype.isTileCachedOrLoading=function(t){return this.tilesLoading[t]||this.tilesInView[t]||this.tileCache.has(t)},n.prototype._drawTiles=function(t,e,i,n){var r=this;0<e.length&&(this._parentTiles=[],e.sort(function(t,e){return Math.abs(e.info.z-r._tileZoom)-Math.abs(t.info.z-r._tileZoom)}),e.forEach(function(t){r._parentTiles.push(t)})),0<i.length&&(this._childTiles=[],i.forEach(function(t){r._childTiles.push(t)}));var o={tiles:t,parentTiles:e,childTiles:i};this.onDrawTileStart(o),this._parentTiles.forEach(function(t){return r._drawTileAndCache(t)}),this._childTiles.forEach(function(t){return r._drawTileOffset(t.info,t.image)}),n.forEach(function(t){return r._drawTileOffset(t.info,t.image)});var a=this.layer,s=this.getMap();if(!a.options.cascadeTiles||s.getPitch()<=a.options.minPitchToCascade)t.forEach(function(t){return r._drawTileAndCache(t)});else{this.writeZoomStencil();for(var l=!1,h=0,c=t.length;h<c;h++)t[h].info.z!==this._tileZoom?l?this.resumeZoomStencilTest():(this.startZoomStencilTest(),l=!0):l&&this.pauseZoomStencilTest(),this._drawTileAndCache(t[h]);this.endZoomStencilTest()}this.onDrawTileEnd(o)},n.prototype.writeZoomStencil=function(){},n.prototype.startZoomStencilTest=function(){},n.prototype.endZoomStencilTest=function(){},n.prototype.pauseZoomStencilTest=function(){},n.prototype.resumeZoomStencilTest=function(){},n.prototype.onDrawTileStart=function(){},n.prototype.onDrawTileEnd=function(){},n.prototype._drawTileOffset=function(t,e){var i=this._tileOffset;if(i[0]||i[1]){var n=this.getMap(),r=n._getResolution(this._tileZoom)/n._getResolution(t.z);i[0]*=r,i[1]*=r,t.point._sub(i),t.extent2d._sub(i),this.drawTile(t,e),t.point._add(i),t.extent2d._add(i),i[0]/=r,i[1]/=r}else this.drawTile(t,e)},n.prototype._drawTileAndCache=function(t){t.current=!0,this.tilesInView[t.info.id]=t,this._drawTileOffset(t.info,t.image),this.tileCache.add(t.info.id,t)},n.prototype.drawOnInteracting=function(){this.draw()},n.prototype.needToRedraw=function(){var t=this.getMap();return t.getPitch()?i.prototype.needToRedraw.call(this):!(!t.isRotating()&&!t.isZooming())||(t.isMoving()?!!this.layer.options.forceRenderOnMoving:i.prototype.needToRedraw.call(this))},n.prototype.hitDetect=function(){return!1},n.prototype._getTileLimitOnInteracting=function(){return this.getMap().isInteracting()?this.layer.options.loadingLimitOnInteracting:0},n.prototype.isDrawable=function(){return!this.getMap().getPitch()||(console&&console.warn("TileLayer with canvas renderer can't be pitched, use gl renderer ('renderer' : 'gl') instead."),this.clear(),!1)},n.prototype.clear=function(){this._retireTiles(!0),this.tileCache.reset(),this.tilesInView={},this.tilesLoading={},this._parentTiles=[],this._childTiles=[],i.prototype.clear.call(this)},n.prototype._isLoadingTile=function(t){return!!this.tilesLoading[t]},n.prototype.clipCanvas=function(t){return this.layer.getMask()?i.prototype.clipCanvas.call(this,t):this._clipByPitch(t)},n.prototype._clipByPitch=function(t){var e=this.getMap();if(e.getPitch()<=e.options.maxVisualPitch)return!1;if(!this.layer.options.clipByPitch)return!1;var i=e.getContainerExtent(),n=ae.retina?2:1;return t.save(),t.strokeStyle="rgba(0, 0, 0, 0)",t.beginPath(),t.rect(0,Math.ceil(i.ymin)*n,Math.ceil(i.getWidth())*n,Math.ceil(i.getHeight())*n),t.stroke(),t.clip(),!0},n.prototype.loadTileQueue=function(t){for(var e in t)if(t.hasOwnProperty(e)){var i=t[e],n=this.loadTile(i);void 0===n.loadTime&&(this.tilesLoading[i.id]={image:n,current:!0,info:i})}},n.prototype.loadTile=function(t){var e=this.layer.getTileSize(),i=new Image;i.width=e.width,i.height=e.height,i.onload=this.onTileLoad.bind(this,i,t),i.onerror=this.onTileError.bind(this,i,t);var n=this.layer.options.crossOrigin;return Y(n)||(i.crossOrigin=n),this.loadTileImage(i,t.url),i},n.prototype.loadTileImage=function(t,e){return E(t,[e])},n.prototype.cancelTileLoading=function(t){t&&(t.onload=LX,t.onerror=LX,t.src=$)},n.prototype.onTileLoad=function(t,e){if(this.layer){var i=e.id;this.tilesInView&&(t.loadTime=y(),delete this.tilesLoading[i],this._addTileToCache(e,t),this.setToRedraw(),this.layer.fire("tileload",{tile:e,tileImage:t}))}},n.prototype.onTileError=function(t,e){this.layer&&(t instanceof Image&&this.cancelTileLoading(t),t.loadTime=0,delete this.tilesLoading[e.id],this._addTileToCache(e,t),this.setToRedraw(),this.layer.fire("tileerror",{tile:e}))},n.prototype.drawTile=function(t,e){if(e&&this.getMap()){var i=t.point,n=t.z,r=t.id,o=this.getMap(),a=t.size,s=o.getZoom(),l=this.context,h=o._pointToContainerPoint(i,n),c=o.getBearing(),u=c||s!==n,d=this.getTileOpacity(e),p=l.globalAlpha;d<1&&(l.globalAlpha=d,this.setToRedraw()),u||h._round();var f=h.x,g=h.y,m=a[0],v=a[1];if(u){if(m++,v++,l.save(),l.translate(f,g),c&&l.rotate(-c*Math.PI/180),s!==n){var y=o._getResolution(n)/o._getResolution();l.scale(y,y)}f=g=0}if(ni.image(l,e,f,g,m,v),this.layer.options.debug){var _=new le(f,g),x=this.layer.options.debugOutline,w=r.split("__");l.save(),l.strokeStyle=x,l.fillStyle=x,l.strokeWidth=10,l.font="15px monospace",ni.rectangle(l,_,a,1,0),ni.fillText(l,"x:"+w[2]+", y:"+w[1]+", z:"+w[3],_.add(10,20),x),ni.drawCross(l,_.add(m/2,v/2),2,x),l.restore()}u&&l.restore(),l.globalAlpha!==p&&(l.globalAlpha=p),this.setCanvasUpdated()}},n.prototype._findChildTiles=function(t){var e=this._getLayerOfTile(t.layer);if(!e.options.background)return[];for(var i=this.getMap(),n=[],r=t.extent2d.getMin(),o=t.extent2d.getMax(),a=e._project(i._pointToPrj(r,t.z)),s=e._project(i._pointToPrj(o,t.z)),l=1;l<3;l++)this._findChildTilesAt(n,a,s,e,t.z+l);return n},n.prototype._findChildTilesAt=function(t,e,i,n,r){for(var o=n.getId(),a=n.getSpatialReference().getResolution(r),s=n._getTileConfig().getTileIndex(e,a),l=n._getTileConfig().getTileIndex(i,a),h=Math.min(s.idx,l.idx),c=Math.max(s.idx,l.idx),u=Math.min(s.idy,l.idy),d=Math.max(s.idy,l.idy),p=void 0,f=void 0,g=h;g<c;g++)for(var m=u;m<d;m++)p=n._getTileId({idx:g,idy:m},r,o),this.tileCache.has(p)&&(f=this.tileCache.getAndRemove(p),t.push(f),this.tileCache.add(p,f))},n.prototype._findParentTile=function(t){var e=this.getMap(),i=this._getLayerOfTile(t.layer);if(!i.options.background)return null;for(var n=i.getSpatialReference(),r=n.getZoomDirection(),o=i.options.backgroundZoomDiff,a=t.extent2d.getCenter(),s=i._project(e._pointToPrj(a,t.z)),l=1;l<=o;l++){var h=t.z-r*l,c=n.getResolution(h),u=i._getTileConfig().getTileIndex(s,c),d=i._getTileId(u,h,t.layer);if(this.tileCache.has(d)){var p=this.tileCache.getAndRemove(d);return this.tileCache.add(d,p),p}}return null},n.prototype._getLayerOfTile=function(t){return this.layer.getChildLayer?this.layer.getChildLayer(t):this.layer},n.prototype._getCachedTile=function(t){var e=this.tilesInView,i=this.tileCache.getAndRemove(t);if(i){e[t]=i;var n=this.tilesLoading;n&&n[t]&&(n[t].current=!1,this.cancelTileLoading(n[t]),delete n[t])}else i=e[t];return i},n.prototype._addTileToCache=function(t,e){this.tilesInView[t.id]={image:e,current:!0,info:t}},n.prototype.getTileOpacity=function(t){return this.layer.options.fadeAnimation&&t.loadTime?Math.min(1,(y()-t.loadTime)/(1e3/60*10)):1},n.prototype.onRemove=function(){this.clear(),delete this.tileCache,delete this._tilePlaceHolder,i.prototype.onRemove.call(this)},n.prototype._markTiles=function(){var t=0,e=0;if(this.tilesLoading)for(var i in this.tilesLoading)this.tilesLoading[i].current=!1,t++;if(this.tilesInView)for(var n in this.tilesInView)this.tilesInView[n].current=!1,e++;return[t,e]},n.prototype._retireTiles=function(t){for(var e in this.tilesLoading){var i=this.tilesLoading[e];!t&&i.current||(i.image&&this.cancelTileLoading(i.image),this.deleteTile(i),delete this.tilesLoading[e])}for(var n in this.tilesInView){var r=this.tilesInView[n];r.current||(delete this.tilesInView[n],this.tileCache.has(n)||this.deleteTile(r))}},n.prototype.deleteTile=function(t){t&&t.image&&(delete t.image.onload,delete t.image.onerror)},n.prototype._generatePlaceHolder=function(t){var e=this.getMap(),i=this.layer.options.placeholder;if(!i||e.getPitch())return null;var n=this.layer.getTileSize(),r=e._getResolution(t)/e._getResolution(),o=this._tilePlaceHolder=this._tilePlaceHolder||ni.createCanvas(1,1);return o.width=n.width*r,o.height=n.height*r,b(i)?i(o):function(t){var e=t.getContext("2d"),i=t.width,n=t.height,r=i/16,o=n/16;e.beginPath();for(var a=0;a<16;a++)e.moveTo(0,a*o),e.lineTo(i,a*o),e.moveTo(a*r,0),e.lineTo(a*r,n);e.strokeStyle="rgba(180, 180, 180, 0.1)",e.lineWidth=1,e.stroke(),e.beginPath();for(var s=[[0,0],[i,0],[0,n],[i,n],[0,0],[0,n],[i,0],[i,n],[0,n/2],[i,n/2],[i/2,0],[i/2,n]],l=1;l<s.length;l+=2)e.moveTo(s[l-1][0],s[l-1][1]),e.lineTo(s[l][0],s[l][1]);e.lineWidth=4,e.stroke()}(o),o},n}(qi);function LX(){return!1}Oo.registerRenderer("canvas",PX);var IX=function(c){function t(){return u(this,t),v(this,c.apply(this,arguments))}return m(t,c),t.prototype.isDrawable=function(){return!0},t.prototype.needToRedraw=function(){var t=this.getMap();return!(!this._gl()||t.getPitch()||!t.isZooming()||t.isMoving()||t.isRotating())||c.prototype.needToRedraw.call(this)},t.prototype.drawTile=function(t,e){var i=this.getMap();if(t&&i&&e.src!==$){var n=i.getGLScale(t.z),r=t.size[0]*n,o=t.size[1]*n;if(!1!==t.cache&&this._bindGLBuffer(e,r,o),this._gl()){var a=t.point,s=a.x*n,l=a.y*n,h=this.getTileOpacity(e);this.drawGLImage(e,s,l,r,o,h),h<1?this.setToRedraw():this.setCanvasUpdated()}else c.prototype.drawTile.call(this,t,e)}},t.prototype.writeZoomStencil=function(){var t=this.gl;t.stencilFunc(t.ALWAYS,1,255),t.stencilOp(t.KEEP,t.KEEP,t.REPLACE)},t.prototype.startZoomStencilTest=function(){var t=this.gl;t.stencilOp(t.KEEP,t.KEEP,t.KEEP),t.stencilFunc(t.EQUAL,0,255)},t.prototype.endZoomStencilTest=function(){this.pauseZoomStencilTest()},t.prototype.pauseZoomStencilTest=function(){var t=this.gl;t.stencilFunc(t.ALWAYS,1,255)},t.prototype.resumeZoomStencilTest=function(){var t=this.gl;t.stencilFunc(t.EQUAL,0,255)},t.prototype._bindGLBuffer=function(t,e,i){t.glBuffer||(t.glBuffer=this.bufferTileData(0,0,e,i))},t.prototype.loadTileImage=function(t,e){t.crossOrigin=this.layer.options.crossOrigin||"",t.src=e},t.prototype.onCanvasCreate=function(){this.createCanvas2()},t.prototype.createContext=function(){c.prototype.createContext.call(this),this.createGLContext()},t.prototype.resizeCanvas=function(t){this.canvas&&(c.prototype.resizeCanvas.call(this,t),this.resizeGLCanvas())},t.prototype.clearCanvas=function(){this.canvas&&(c.prototype.clearCanvas.call(this),this.clearGLCanvas())},t.prototype.getCanvasImage=function(){if(!this._gl())return c.prototype.getCanvasImage.call(this);var t=c.prototype.getCanvasImage.call(this);return t&&(t.image=this.canvas2),t},t.prototype._gl=function(){return this.getMap()&&!!this.getMap().getPitch()||this.layer&&!!this.layer.options.fragmentShader},t.prototype.deleteTile=function(t){c.prototype.deleteTile.call(this,t),t&&t.image&&this.disposeImage(t.image)},t.prototype.onRemove=function(){this.removeGLCanvas()},t}(jo(PX));function RX(e){var t=this.layer.getTileSize(),i=this.canvas.constructor,n=this.getMap(),r=ae.retina?2:1,o=ni.createCanvas(t.width*r,t.height*r,i);o.layer=this.layer;var a=this,s=new wi(n.pointToCoordinate(e.point),n.pointToCoordinate(e.point.add(t.toPoint())),n.getProjection());return this.layer.drawTile(o,{url:e.url,point:e.point,center:n.pointToCoordinate(e.point.add(t.width/2,t.height/2)),extent:s,z:e.z,x:e.x,y:e.y},function(t){t?a.onTileError(o,e):a.onTileLoad(o,e)}),o}Oo.registerRenderer("gl",IX);var DX=function(t){function e(){return u(this,e),v(this,t.apply(this,arguments))}return m(e,t),e.prototype.loadTile=function(){return RX.apply(this,arguments)},e}(PX),OX=function(t){function e(){return u(this,e),v(this,t.apply(this,arguments))}return m(e,t),e.prototype.loadTile=function(){return RX.apply(this,arguments)},e}(PX);Bo.registerRenderer("canvas",DX),Bo.registerRenderer("gl",OX);var kX=function(i){function n(t){u(this,n);var e=v(this,i.call(this));return e.map=t,e._handlerQueue={},e}return m(n,i),n.prototype.callInNextFrame=function(t){this._handlerQueue.push(t)},n.prototype.executeFrameCallbacks=function(){var t=this._handlerQueue;this._handlerQueue=[];for(var e=0,i=t.length;e<i;e++)t[e]()},n.prototype.offsetPlatform=function(t){if(!this.map._panels.front)return this;if(0===t.x&&0===t.y)return this;var e=this.map.offsetPlatform().add(t)._round(),i=this.map._panels;return Ge(i.back,e),Ge(i.front,e),this},n.prototype.resetContainer=function(){if(this.map&&(this.map._resetMapViewPoint(),this.map._panels.front)){var t=new le(0,0);Ge(this.map._panels.back,t),Ge(this.map._panels.front,t)}},n.prototype.onZoomEnd=function(){this.resetContainer()},n.prototype.onLoad=function(){this._frameLoop()},n}(ci),zX=function(i){function n(t){u(this,n);var e=v(this,i.call(this,t));return e._containerIsCanvas=!!t._containerDOM.getContext,e._registerEvents(),e._loopTime=0,e}return m(n,i),n.prototype.load=function(){this.initContainer()},n.prototype.renderFrame=function(t){if(!this.map)return!1;var e=this.map;e._fireEvent("framestart"),this.updateMapDOM();var i=this._getAllLayerToRender();return this.drawLayers(i,t),this.drawLayerCanvas(i),e._fireEvent("frameend"),this._recordView(),this._mapview=this._getMapView(),delete this._spatialRefChanged,this._fireLayerLoadEvents(),this.executeFrameCallbacks(),!(this._needRedraw=!1)},n.prototype.updateMapDOM=function(){var t=this.map;if(!t.isZooming()){var e=t._getViewPointFrameOffset();e&&t.offsetPlatform(e)}},n.prototype.drawLayers=function(t,e){for(var i=this.map,n=i.isInteracting(),r=[],o=[],a=i.options.fpsOnInteracting||0,s=0===a?0:1e3/a,l=this.map.options.layerCanvasLimitOnInteracting,h=t.length,c=i.getBaseLayer(),u=0,d=0;d<h;d++){var p=t[d];if(p.isVisible()){var f=p.isCanvasRender();f&&r.push(p.getId());var g=p._getRenderer();if(g){var m=this._checkLayerRedraw(p);if(f&&g.isCanvasUpdated()&&(m||o.push(p.getId()),this.setToRedraw()),delete g.__shouldZoomTransform,m){if(n&&f){if(0<l&&l<h-1-d&&p!==c){p._getRenderer().clearCanvas();continue}u+=this._drawCanvasLayerOnInteracting(p,u,s,e)}else n&&g.drawOnInteracting?(g.prepareRender&&g.prepareRender(),g.drawOnInteracting(this._eventParam,e)):g.render(e);f&&(o.push(p.getId()),this.setToRedraw())}else f&&n&&(i.isZooming()&&!i.getPitch()?(g.prepareRender(),g.__shouldZoomTransform=!0):(i.getPitch()||i.isRotating())&&g.clearCanvas())}}}var v=this._canvasIds||[],y=this._updatedIds||[];if(this._canvasIds=r,this._updatedIds=o,!this._needToRedraw()){v.join("---")===r.join("---")&&y.join("---")===o.join("---")||this.setToRedraw()}},n.prototype._checkLayerRedraw=function(t){if(this.isSpatialReferenceChanged())return!0;var e=this.map,i=t._getRenderer();return t.isCanvasRender()?i.testIfNeedRedraw():!(!i.needToRedraw||!i.needToRedraw())||(e.isInteracting()||this.isViewChanged())},n.prototype._drawCanvasLayerOnInteracting=function(t,e,i,n){var r=this.map,o=t._getRenderer(),a=o.getDrawTime(),s=0===i||0<i&&e+a<=i;if(o.mustRenderOnInteracting&&o.mustRenderOnInteracting())o.render(n);else{if(o.drawOnInteracting&&(t===r.getBaseLayer()||s||r.isZooming()&&t.options.forceRenderOnZooming||r.isMoving()&&t.options.forceRenderOnMoving||r.isRotating()&&t.options.forceRenderOnRotating))return o.prepareRender(),o.prepareCanvas(),o.drawOnInteracting(this._eventParam,n),a;!r.isZooming()||r.getPitch()||r.isRotating()?(r.getPitch()||r.isRotating())&&o.clearCanvas():(o.prepareRender(),o.__shouldZoomTransform=!0)}return o.drawOnInteracting&&!s&&o.onSkipDrawOnInteracting(this._eventParam,n),0},n.prototype._fireLayerLoadEvents=function(){if(this._updatedIds&&0<this._updatedIds.length){var n=this.map;this._updatedIds.reverse().forEach(function(t){var e=n.getLayer(t);if(e){var i=e._getRenderer();i&&i.isRenderComplete()&&e.fire("layerload")}})}},n.prototype._needToRedraw=function(){return this._needRedraw},n.prototype.setToRedraw=function(){this._needRedraw=!0},n.prototype.drawLayerCanvas=function(t){var e=this.map;if(e&&(this._needToRedraw()||this.isViewChanged())){this.canvas||this.createCanvas(),e._fireEvent("renderstart",{context:this.context}),this._updateCanvasSize()||this.clearCanvas();for(var i=e.isInteracting(),n=e.options.layerCanvasLimitOnInteracting,r=t.length,o=void 0,a=[],s=0;s<r;s++){if(t[s].isVisible()&&t[s].isCanvasRender())if(t[s]._getRenderer()){var l=this._getLayerImage(t[s]);l&&l.image&&(t[s]===e.getBaseLayer()?o=[t[s],l]:a.push([t[s],l]))}}o&&(this._drawLayerCanvasImage(o[0],o[1]),this._drawFog()),r=a.length;for(var h=i&&0<=n&&n<r?r-n:0;h<r;h++)this._drawLayerCanvasImage(a[h][0],a[h][1]);this._drawCenterCross(),e._fireEvent("renderend",{context:this.context})}},n.prototype.updateMapSize=function(t){if(t&&!this._containerIsCanvas){var e=t.width+"px",i=t.height+"px",n=this.map._panels;n.mapWrapper.style.width=e,n.mapWrapper.style.height=i,this._updateCanvasSize()}},n.prototype.getMainPanel=function(){return this.map?this._containerIsCanvas?this.map._containerDOM:this.map._panels?this.map._panels.mapWrapper:null:null},n.prototype.toDataURL=function(t){return this.canvas?this.canvas.toDataURL(t):null},n.prototype.remove=function(){ae.webgl&&"undefined"!=typeof document&&ke(document,"visibilitychange",this._onVisibilitychange),this._resizeInterval&&clearInterval(this._resizeInterval),delete this.context,delete this.canvas,delete this.map,delete this._spatialRefChanged,this._cancelFrameLoop()},n.prototype.hitDetect=function(t){var e=this.map;if(e&&e.options.hitDetect&&!e.isInteracting()){for(var i=e._getLayers(),n="default",r=e.options.hitDetectLimit||0,o=0,a=i.length-1;0<=a;a--){var s=i[a];if(!s.isEmpty||!s.isEmpty()){var l=s._getRenderer();if(l&&l.hitDetect&&(!l.isBlank||!l.isBlank())){if("default"!==s.options.cursor&&l.hitDetect(t)){n=s.options.cursor||"pointer";break}if(o++,0<r&&r<o)break}}}e._trySetCursor(n)}},n.prototype._getLayerImage=function(t){var e=t._getRenderer();return e.getCanvasImage?e.getCanvasImage():null},n.prototype.initContainer=function(){var o=this.map._panels;function t(t,e,i,n){var r=Ie("div",e);return i&&(r.style.cssText=i),o[t]=r,n||Fe(r),r}var e=this.map._containerDOM;if(!this._containerIsCanvas){var i="position:absolute;top:0px;left:0px;",n=t("mapWrapper","mapcan-wrapper","position:absolute;overflow:hidden;",!(e.innerHTML="")),r=t("allLayers","mapcan-all-layers",i+"padding:0px;margin:0px;z-index:0;overflow:visible;",!0),a=t("backStatic","mapcan-back-static",i+"z-index:0;",!0),s=t("back","mapcan-back",i+"z-index:1;"),l=t("backLayer","mapcan-back-layer",i),h=t("canvasContainer","mapcan-canvas-layer",i+"border:none;z-index:2;"),c=t("frontStatic","mapcan-front-static",i+"z-index:3;",!0),u=t("front","mapcan-front",i+"z-index:4;",!0),d=t("frontLayer","mapcan-front-layer",i+"z-index:0;"),p=t("ui","mapcan-ui",i+"border:none;z-index:1;",!0),f=t("control","mapcan-control","z-index:1",!0);e.appendChild(n),r.appendChild(a),s.appendChild(l),r.appendChild(s),r.appendChild(h),u.appendChild(d),r.appendChild(c),r.appendChild(u),u.appendChild(p),n.appendChild(r),n.appendChild(f),this.createCanvas(),this.resetContainer();var g=this.map._getContainerDomSize();this.updateMapSize(g)}},n.prototype.isViewChanged=function(){var t=this._mapview,e=this._getMapView();return!t||!tt(t,e)},n.prototype._recordView=function(){var t=this.map;!t._onViewChange||t.isInteracting()||t.isAnimating()||tt(t.getView(),t._getCurrentView())||t._onViewChange(t.getView())},n.prototype.isSpatialReferenceChanged=function(){return this._spatialRefChanged},n.prototype._getMapView=function(){var t=this.map,e=t._getPrjCenter();return{x:e.x,y:e.y,zoom:t.getZoom(),pitch:t.getPitch(),bearing:t.getBearing(),width:t.width,height:t.height}},n.prototype._frameLoop=function(t){var e=this;this.map?(this.renderFrame(t),this._animationFrame=h(function(t){e._frameLoop(t)})):this._cancelFrameLoop()},n.prototype._cancelFrameLoop=function(){this._animationFrame&&c(this._animationFrame)},n.prototype._drawLayerCanvasImage=function(t,e){var i=this.context,n=e.point.round();ae.retina&&n._multi(2);var r=e.image;if(!(n.x+r.width<=0||n.y+r.height<=0)){var o=t.options.opacity;if(w(o)||(o=1),!(o<=0)){var a=e.opacity;if(w(a)||(a=1),!(a<=0)){var s=i.globalAlpha;o<1&&(i.globalAlpha*=o),a<1&&(i.globalAlpha*=a),t.options.cssFilter&&(i.filter=t.options.cssFilter);var l=this._zoomMatrix,h=!!t._getRenderer().__shouldZoomTransform,c=t.getRenderer().clipCanvas(this.context);l&&h&&(i.save(),i.setTransform.apply(i,l)),i.drawImage(r,n.x,n.y),l&&h&&i.restore(),c&&i.restore(),"none"!==i.filter&&(i.filter="none"),i.globalAlpha=s}}}},n.prototype._drawCenterCross=function(){var t=this.map.options.centerCross;if(t){var e=this.context,i=new le(this.canvas.width/2,this.canvas.height/2);b(t)?t(e,i):ni.drawCross(this.context,i,2,"#f00")}},n.prototype._drawFog=function(){var t=this.map;if(!(t.getPitch()<=t.options.maxVisualPitch)&&t.options.fog){var e=ae.retina?2:1,i=this.context,n=t.getContainerExtent(),r=(t.height-t._getVisualHeight(75))*e;r<0&&(r=0);var o=n.ymin*e,a=Math.ceil(o-r),s=t.options.fogColor.join(),l=i.createLinearGradient(0,r,0,o+30),h=1-30/(a+30);l.addColorStop(0,"rgba("+s+", 0)"),l.addColorStop(.3,"rgba("+s+", 0.3)"),l.addColorStop(h,"rgba("+s+", 1)"),l.addColorStop(1,"rgba("+s+", 0)"),i.beginPath(),i.fillStyle=l,i.fillRect(0,r,Math.ceil(n.getWidth())*e,Math.ceil(a+30))}},n.prototype._getAllLayerToRender=function(){return this.map._getLayers()},n.prototype.clearCanvas=function(){this.canvas&&ni.clearRect(this.context,0,0,this.canvas.width,this.canvas.height)},n.prototype._updateCanvasSize=function(){if(!this.canvas||this._containerIsCanvas)return!1;var t=this.map.getSize(),e=this.canvas,i=ae.retina?2:1;return(t.width*i!==e.width||t.height*i!==e.height)&&(e.height=i*t.height,e.width=i*t.width,e.style&&(e.style.width=t.width+"px",e.style.height=t.height+"px"),!0)},n.prototype.createCanvas=function(){this._containerIsCanvas?this.canvas=this.map._containerDOM:(this.canvas=Ie("canvas"),this._updateCanvasSize(),this.map._panels.canvasContainer.appendChild(this.canvas)),this.context=this.canvas.getContext("2d")},n.prototype._checkSize=function(){this.map&&!this.map.isInteracting()&&(Ve(this.map._containerDOM),this.map.checkSize())},n.prototype._setCheckSizeInterval=function(t){var e=this;clearInterval(this._resizeInterval),this._checkSizeInterval=t,this._resizeInterval=setInterval(function(){!e.map||e.map.isRemoved()?clearInterval(e._resizeInterval):e._checkSize()},this._checkSizeInterval)},n.prototype._registerEvents=function(){var e=this,i=this.map;i.options.checkSize&&!C&&"undefined"!=typeof window&&this._setCheckSizeInterval(1e3),ae.mobile||i.on("_mousemove",this._onMapMouseMove,this),i.on("_dragrotatestart _dragrotating _dragrotateend _movestart _moving _moveend _zoomstart",function(t){e._eventParam=t}),i.on("_zooming",function(t){i.getPitch()||(e._zoomMatrix=t.matrix.container),e._eventParam=t}),i.on("_zoomend",function(t){e._eventParam=t,delete e._zoomMatrix}),i.on("_spatialreferencechange",function(){e._spatialRefChanged=!0}),ae.webgl&&"undefined"!=typeof document&&Oe(document,"visibilitychange",this._onVisibilitychange,this)},n.prototype._onMapMouseMove=function(t){var e=this,i=this.map;!i.isInteracting()&&i.options.hitDetect&&(this._hitDetectFrame&&c(this._hitDetectFrame),this._hitDetectFrame=h(function(){e.hitDetect(t.containerPoint)}))},n.prototype._getCanvasLayers=function(){return this.map._getLayers(function(t){return t.isCanvasRender()})},n.prototype._onVisibilitychange=function(){if("visible"===document.visibilityState)for(var t=this._getAllLayerToRender(),e=0,i=t.length;e<i;e++){var n=t[e].getRenderer();n&&n.canvas&&n.setToRedraw&&n.setToRedraw()}},n}(kX);en.registerRenderer("canvas",zX),en.mergeOptions({fog:!0,fogColor:[233,233,233]});var NX=Object.freeze({ResourceCache:Yi,CanvasRenderer:qi,ImageGLRenderable:jo,MapRenderer:kX,MapCanvasRenderer:zX,Renderable:Ui,ImageLayerCanvasRenderer:Yo,ImageLayerGLRenderer:Jo,TileLayerCanvasRenderer:PX,TileLayerGLRenderer:IX,CanvasTileLayerCanvasRenderer:DX,CanvasTileLayerGLRenderer:OX,OverlayLayerCanvasRenderer:ea,VectorLayerCanvasRenderer:na,CanvasLayerRenderer:Ko}),BX={_getRenderPoints:function(){return[[this._getCenter2DPoint(this.getMap().getGLZoom())],null]}};Wn.include(BX),nr.include(BX),ir.include(BX),or.include(BX),rr.include({_getRenderPoints:function(t){var e=this.getMap();if("vertex"===t){for(var i=this._trimRing(this.getShell()),n=[],r=0,o=i.length;r<o;r++)n.push(e.coordToPoint(i[r],e.getGLZoom()));return[n,null]}return[[e.coordToPoint(this.getCenter(),e.getGLZoom())],null]}});var FX={_getRenderPoints:function(t){var e=this.getMap(),i=e.getGLZoom(),n=void 0,r=null;if("point"===t)(n=this._getPath2DPoints(this._getPrjCoordinates(),!1,i))&&0<n.length&&Array.isArray(n[0])&&(n=n[0].concat(n[1]));else if("vertex"===t)if(r=[],(n=this._getPath2DPoints(this._getPrjCoordinates(),!1,i))&&0<n.length&&Array.isArray(n[0])){for(var o=0,a=n.length;o<a;o++)for(var s=0,l=n[o].length;s<l;s++)0===s?r.push([n[o][s],n[o][s+1]]):r.push([n[o][s-1],n[o][s]]);n=n[0].concat(n[1])}else for(var h=0,c=n.length;h<c;h++)0===h?r.push([n[h],n[h+1]]):r.push([n[h-1],n[h]]);else if("line"===t){n=[],r=[];var u=this._getPath2DPoints(this._getPrjCoordinates(),!1,i);if(0<u.length&&Array.isArray(u[0]))for(var d=void 0,p=1,f=u.length;p<f;p++){d=u[p],this instanceof Hn&&0<d.length&&!d[0].equals(d[d.length-1])&&d.push(d[0]);for(var g=1,m=d.length;g<m;g++)n.push(d[g].add(d[g-1])._multi(.5)),r.push([d[g-1],d[g]])}else{this instanceof Hn&&0<u.length&&!u[0].equals(u[u.length-1])&&u.push(u[0]);for(var v=1,y=u.length;v<y;v++)n.push(u[v].add(u[v-1])._multi(.5)),r.push([u[v-1],u[v]])}}else if("vertex-first"===t){var _=this._getPrjCoordinates();n=[e._prjToPoint(_[0],i)],r=[[e._prjToPoint(_[0],i),e._prjToPoint(_[1],i)]]}else if("vertex-last"===t){var x=this._getPrjCoordinates(),w=x.length;n=[e._prjToPoint(x[w-1],i)],r=[[e._prjToPoint(x[w-2],i),e._prjToPoint(x[w-1],i)]]}else{var b=this._getProjection().project(this.getCenter());n=[e._prjToPoint(b,i)]}return[n,r]}};Zn.include(FX),Hn.include(FX),Pn.include({_redrawWhenPitch:function(){return!1},_redrawWhenRotate:function(){return!1}});var GX={_redrawWhenPitch:function(){return!0},_redrawWhenRotate:function(){return this instanceof nr||this instanceof or},_paintAsPath:function(){var t=this.getMap();return 0<this._getPainter().getAltitude()||t.getPitch()||this instanceof nr&&t.getBearing()},_getPaintParams:function(){var t=this.getMap();if(this._paintAsPath())return Hn.prototype._getPaintParams.call(this,!0);var e=this._getPrjCoordinates(),i=t._prjToPoint(e,t.getGLZoom()),n=this._getRenderSize();return[i,n.width,n.height]},_paintOn:function(){return this._paintAsPath()?ni.polygon.apply(ni,arguments):ni.ellipse.apply(ni,arguments)},_getRenderSize:function(){var t=this.getMap(),e=t.getGLZoom(),i=this._getPrjExtent(),n=t._prjToPoint(i.getMin(),e),r=t._prjToPoint(i.getMax(),e);return new he(Math.abs(r.x-n.x)/2,Math.abs(r.y-n.y)/2)}};nr.include(GX),ir.include(GX),rr.include({_getPaintParams:function(){var t=this.getMap().getGLZoom(),e=this._getPrjShell();return[this._getPath2DPoints(e,!1,t)]},_paintOn:ni.polygon}),or.include(GX,{_redrawWhenPitch:function(){return!0},_getPaintParams:function(){if(this._paintAsPath())return Hn.prototype._getPaintParams.call(this,!0);var t=this.getMap();return[t._prjToPoint(this._getPrjCoordinates(),t.getGLZoom()),this._getRenderSize().width,[this.getStartAngle(),this.getEndAngle()]]},_paintOn:function(){if(this._paintAsPath())return ni.polygon.apply(ni,arguments);var t=this.getMap().getBearing(),e=arguments;return t&&(e[3]=e[3].slice(0),e[3][0]+=t,e[3][1]+=t),ni.sector.apply(ni,e)}}),Gn.include({_paintAsPath:function(){return!0}}),Zn.include({arrowStyles:{classic:[3,4]},_getArrowShape:function(t,e,i,n,r){r||(r=0);var o=i*n[0],a=i*n[1]+r,s=o/2+r,l=void 0;(l=e.nextCtrlPoint||e.prevCtrlPoint?e.prevCtrlPoint?e.sub(new le(e.prevCtrlPoint)):e.sub(new le(e.nextCtrlPoint)):e.sub(t))._unit();var h=e.sub(l.multi(a));l._perp();var c=h.add(l.multi(s));return l._multi(-1),[c,e,h.add(l.multi(s)),c]},_getPaintParams:function(){var t=this._getPrjCoordinates();return[this._getPath2DPoints(t,!1,this.getMap().getGLZoom())]},_paintOn:function(t,e,i,n,r){this.options.smoothness?ni.paintSmoothLine(t,e,i,this.options.smoothness):ni.path(t,e,i,null,r),this._paintArrow(t,e,i)},_getArrowPlacement:function(){return this.options.arrowPlacement},_getArrowStyle:function(){var t=this.options.arrowStyle;return t?Array.isArray(t)?t:this.arrowStyles[t]:null},_getArrows:function(t,e,i){var n=this._getArrowStyle();if(!n||t.length<2)return[];for(var r=0<t.length&&Array.isArray(t[0])?t:[t],o=this._getArrowPlacement(),a=[],s=this.getMap(),l=s.coordToContainerPoint(this.getFirstCoordinate()),h=s.coordToContainerPoint(this.getLastCoordinate()),c=r.length-1;0<=c;c--)("vertex-first"===o||"vertex-firstlast"===o&&r[c][0].closeTo(l,.01))&&a.push(this._getArrowShape(r[c][1],r[c][0],e,n,i)),"vertex-last"===o||"vertex-firstlast"===o&&r[c][r[c].length-1].closeTo(h,.01)?a.push(this._getArrowShape(r[c][r[c].length-2],r[c][r[c].length-1],e,n,i)):"point"===o&&this._getArrowPoints(a,r[c],e,n,i);return a},_getArrowPoints:function(t,e,i,n,r){for(var o=0,a=e.length-1;o<a;o++)t.push(this._getArrowShape(e[o],e[o+1],i,n,r))},_paintArrow:function(t,e,i){var n=this._getInternalSymbol().lineWidth;(!w(n)||n<3)&&(n=3);var r=this._getArrows(e,n);if(r.length){t.setLineDash&&t.setLineDash([]);for(var o=r.length-1;0<=o;o--)t.fillStyle=t.strokeStyle,ni.polygon(t,r[o],i,i)}}}),Hn.include({_getPaintParams:function(t){var e=this.getMap().getGLZoom(),i=this._getPrjShell(),n=this._getPath2DPoints(i,t,e),r=0<n.length&&Array.isArray(n[0]);r&&(n=[[n[0]],[n[1]]]);var o=this._getPrjHoles(),a=[];if(o&&0<o.length)for(var s=0;s<o.length;s++){var l=this._getPath2DPoints(o[s],t,e);Array.isArray(l)&&r?Array.isArray(l[0])?(n[0].push(l[0]),n[1].push(l[1])):n[0].push(l):a.push(l)}return r||D(n=[n],a),[n]},_paintOn:function(t,e,i,n,r){ni.polygon(t,e,i,n,r,this.options.smoothness)}}),t.Util=Nt,t.DomUtil=ti,t.StringUtil=Te,t.MapboxUtil=Ct,t.ui=yo,t.control=Eo,t.renderer=NX,t.symbolizer=Sn,t.animation=Bn,t.Browser=ae,t.Ajax=ei,t.Canvas=ni,t.Class=ci,t.Eventable=li,t.JSONAble=di,t.Handlerable=pi,t.Handler=hi,t.DragHandler=vi,t.MapTool=Mr,t.DrawTool=Tr,t.AreaTool=ro,t.DistanceTool=no,t.SpatialReference=$i,t.INTERNAL_LAYER_PREFIX=d,t.GEOMETRY_COLLECTION_TYPES=e,t.GEOJSON_TYPES=a,t.RESOURCE_PROPERTIES=f,t.RESOURCE_SIZE_PROPERTIES=g,t.NUMERICAL_PROPERTIES=n,t.COLOR_PROPERTIES=i,t.projection=Hi,t.measurer=ki,t.Coordinate=yi,t.CRS=_i,t.Extent=wi,t.Point=le,t.PointExtent=bi,t.Size=he,t.Transformation=Mi,t.Map=en,t.Layer=Ji,t.TileLayer=Oo,t.GroupTileLayer=ko,t.WMSTileLayer=No,t.CanvasTileLayer=Bo,t.ImageLayer=Xo,t.OverlayLayer=_r,t.VectorLayer=wr,t.CanvasLayer=$o,t.ParticleLayer=ta,t.TileSystem=Po,t.TileConfig=Io,t.ClusterLayer=ra,t.E3Layer=hN,t.HeatLayer=dN,t.ThreeLayer=vX,t.ArcCurve=sr,t.Circle=ir,t.ConnectorLine=vr,t.ArcConnectorLine=yr,t.CubicBezierCurve=lr,t.Curve=ar,t.Ellipse=nr,t.GeoJSON=er,t.Geometry=Pn,t.GeometryCollection=Xn,t.Label=fr,t.LineString=Zn,t.Marker=Wn,t.MultiLineString=Qn,t.MultiPoint=Jn,t.MultiPolygon=$n,t.Polygon=Hn,t.QuadBezierCurve=hr,t.Rectangle=rr,t.Sector=or,t.TextBox=pr,t.TextMarker=dr,Object.defineProperty(t,"__esModule",{value:!0}),"undefined"!=typeof console&&console.log("mapcan v0.40.2")});